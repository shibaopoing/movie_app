<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="description" content="Single-page Gradle User Manual for Gradle 6.4.1">
<title>Gradle User Manual: Version 6.4.1</title>
<style>
/*
 * Copyright 2018 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* Lato (normal, regular) */
@font-face {
    font-family: Lato;
    font-weight: 400;
    font-style: normal;
    src: url("https://assets.gradle.com/lato/fonts/lato-normal/lato-normal.woff2") format("woff2"),
    url("https://assets.gradle.com/lato/fonts/lato-normal/lato-normal.woff") format("woff");
}
/* Lato (normal, italic) */
@font-face {
    font-display: swap;
    font-family: Lato;
    font-weight: 400;
    font-style: italic;
    src: url("https://assets.gradle.com/lato/fonts/lato-normal-italic/lato-normal-italic.woff2") format("woff2"),
    url("https://assets.gradle.com/lato/fonts/lato-normal-italic/lato-normal-italic.woff") format("woff");
}
/* Lato (bold, regular) */
@font-face {
    font-display: swap;
    font-family: Lato;
    font-weight: 500;
    font-style: normal;
    src: url("https://assets.gradle.com/lato/fonts/lato-semibold/lato-semibold.woff2") format("woff2"),
    url("https://assets.gradle.com/lato/fonts/lato-semibold/lato-semibold.woff") format("woff");
}
/* Lato (bold, regular) */
@font-face {
    font-display: swap;
    font-family: Lato;
    font-weight: 800;
    font-style: normal;
    src: url("https://assets.gradle.com/lato/fonts/lato-heavy/lato-heavy.woff2") format("woff2"),
    url("https://assets.gradle.com/lato/fonts/lato-heavy/lato-heavy.woff") format("woff");
}


/* BEGIN asciidoc.css */

/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
    h1 { font-size: 2.75em; }
    h2 { font-size: 2.3125em; }
    h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
    h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
    body.toc2 { padding-left: 15em; padding-right: 0; }
    #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
    #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
    #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
    #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
    #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
    body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
    body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
    #toc.toc2 { width: 20em; }
    #toc.toc2 #toctitle { font-size: 1.375em; }
    #toc.toc2 > ul { font-size: 0.95em; }
    #toc.toc2 ul ul { padding-left: 1.25em; }
    body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] {
    cursor: default;
    color: transparent;
    font-size: 3.5em;
    text-shadow: 0 0 #00c489;
    opacity: 0.7;
}
.admonitionblock td.icon .icon-note:before { content: "\2728"; }
.admonitionblock td.icon .icon-tip:before { content: "\1F4A1"; }
.admonitionblock td.icon .icon-warning:before { content: "\2757"; }
.admonitionblock td.icon .icon-caution:before { content: "\26A0"; }
.admonitionblock td.icon .icon-important:before { content: "\26A0"; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
    * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
    a { color: inherit !important; text-decoration: underline !important; }
    a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
    a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
    abbr[title]:after { content: " (" attr(title) ")"; }
    pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
    thead { display: table-header-group; }
    svg { max-width: 100%; }
    p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
    h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
    #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
    #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
    .sect1 { padding-bottom: 0 !important; }
    .sect1 + .sect1 { border: 0 !important; }
    #header > h1:first-child { margin-top: 1.25rem; }
    body.book #header { text-align: center; }
    body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
    body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
    body.book #header .details span:first-child { margin-left: 0 !important; }
    body.book #header .details br { display: block; }
    body.book #header .details br + span:before { content: none !important; }
    body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
    body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
    .listingblock code[data-lang]:before { display: block; }
    #footer { background: none !important; padding: 0 0.9375em; }
    #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
    .hide-on-print { display: none !important; }
    .print-only { display: block !important; }
    .hide-for-print { display: none !important; }
    .show-for-print { display: inherit !important; } }

/* END asciidoc.css */

html,
body {
    margin: 0;
    padding: 0;
}

html {
    font-size: 16px;
    font-weight: 400;
    line-height: 1.5;
}

body {
    color: #02303A;
    background-color: #f7f7f8;
    font-family: "Lato", "Helvetica Neue", Arial, sans-serif;
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
}

/* Links */
a {
    color: #1DA2BD;
    text-decoration: none;
}

a:hover,
a:focus {
    text-decoration: underline;
}

#content a[href^='../dsl/'],
#content a[href^='../javadoc/'] {
    font-family: 'Inconsolata', monospace;
    font-style: normal;
    border-bottom: 1px dotted rgba(29, 162, 189, 0.5);
    padding: 0 1px;
}

#content a[href^='../dsl/']:hover,
#content a[href^='../dsl/']:focus,
#content a[href^='../javadoc/']:hover,
#content a[href^='../javadoc/']:focus {
    text-decoration: none;
}

/* Copy */

p {
    font-size: 1rem;
}

pre,
pre > code,
code {
    font-family: 'Inconsolata', monospace;
}

h1,
h2,
h3,
h4,
h5,
h6,
#toctitle,
.sidebarblock > .content > .title {
    font-family: inherit;
    font-weight: 500;
    color: inherit;
}

h1 {
    font-size: 2rem;
}

h2 {
    font-size: 1.5rem;
}

h3 {
    font-size: 1.125rem;
}

h4 {
    font-size: 1.0625rem;
}

h5, h6 {
    font-size: 1rem;
}

b, strong {
    font-weight: 500;
}

dl {
    margin: 0 0 1.25rem 1.5rem;
}

.dlist dt code {
    color: #02303A;
    font-size: 1em;
    font-weight: bold;
}

.dlist p {
    margin-bottom: 0.625rem;
}

.sr-only {
    border: 0;
    clip: rect(0, 0, 0, 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
}

/* Layout */
.main-content > .appendix,
.main-content > .book,
.main-content > .chapter,
.main-content > .footer {
    background-color: white;
    border-radius: 5px;
    max-width: 45rem;
    padding: 1.5rem;
}

@media screen and (max-width: 45em) {
    .footer {
        max-width: 100%;
    }

    .main-content > .appendix,
    .main-content > .book,
    .main-content > .chapter {
        margin-top: 0;
        margin-bottom: 0;
    }
}

/* Override asciidoc styles */
#header {
    position: static;
}

#header, #content {
    padding: 0;
}

#header .details {
    /* TODO: Pretty sure there's a way to avoid Asciidoc generating details */
    display: none;
}

p {
    color: #02303A;
}

h1,
h2,
p,
p strong,
td.content,
td.content strong,
div.footnote strong,
span.alt {
    letter-spacing: normal;
}

.subheader,
.admonitionblock td.content > .title,
.audioblock > .title,
.exampleblock > .title,
.imageblock > .title,
.listingblock > .title,
.literalblock > .title,
.stemblock > .title,
.openblock > .title,
.paragraph > .title,
.quoteblock > .title,
table.tableblock > .title,
.verseblock > .title,
.videoblock > .title,
.dlist > .title,
.olist > .title,
.ulist > .title,
.qlist > .title,
.hdlist > .title {
    color: inherit;
    font-family: inherit;
}

.listingblock .title,
.listingblock .title code {
    font-style: normal;
    font-weight: bold;
}

.admonitionblock td.content > .title {
    font-family: inherit;
    font-style: normal;
    font-size: 1.25em;
    color: #555;
}

.admonitionblock table tr td {
    padding: 0;
}

.imageblock,
.videoblock {
    padding: 0.25em;
}

p.lead,
.paragraph.lead > p,
#preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: 1.0625rem;
}

.paragraph.lead > p,
#preamble > .sectionbody > .paragraph:first-of-type p {
    color: inherit;
}

.sect1 {
    padding-bottom: 0;
}

.sect1 + .sect1 {
    border: 0 none;
}

.admonitionblock .icon .title {
    font-size: 2.3em;
}

.admonitionblock > table td.icon .title {
    font-family: "Lato", Arial, sans-serif;
}

.admonitionblock .content,
.admonitionblock p {
    color: #666;
}

.verseblock pre {
    font-family: "Lato", Arial, sans-serif;
}

td.hdlist1 {
    padding-bottom: 0.625rem;
}

td.hdlist2 p {
    margin-bottom: 0.625rem;
}

body.book #header > h1 {
    border: 0;
}

#header > h1:first-child {
    margin-top: 0;
}

#content a.link {
    color: #02303A;
}

.highlight .com {
    color: #777;
}

.listingblock pre.highlightjs > code {
    overflow-x: auto;
}

.listingblock pre.highlight {
    overflow-x: auto;
}

.listingblock pre.highlight > code {
    white-space: pre;
}

.conum[data-value] {
    font-family: "Lato", Arial, sans-serif;
}

.colist > table tr > td:first-of-type {
    padding-top: 0.25em;
    padding-bottom: 0.25em;
    line-height: 1.4;
    vertical-align: baseline;
}

/*
 * Samples
 */
.exampleblock > .content {
    background-color: inherit;
    border: 0 none;
    box-shadow: none;
    padding: 0;
}

.exampleblock > .content .title {
    background-color: #f7f7f8;
    border-top: 1px solid #ccc;
    font-family: 'Inconsolata', monospace;
    margin: 0;
    padding: 1em 1em 0;
}

.exampleblock .listingblock {
    margin: 0;
}

/* Multi-language selection */
.multi-language-selector .language-option[data-lang='groovy'],
.exampleblock[data-lang=groovy] > .content .title {
    background-image: url('data:image/svg+xml;base64,PHN2Zw0KICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIg0KICAgd2lkdGg9IjYxNC4wNjA4NSINCiAgIGhlaWdodD0iMzAzLjU5ODYiDQogICB2ZXJzaW9uPSIxLjEiPg0KICA8Zw0KICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzUuMzk2NTk5LC0zMC41NTgxOTYpIj4NCiAgICA8cGF0aA0KICAgICAgIGQ9Im0gMTU0Ljk3Njg3LDMzMi42OTE2MiBjIDAsLTAuODA1ODcgMTAuODMxMjMsLTE4LjYyMTcyIDI0LjA2OTQsLTM5LjU5MDc2IDEzLjIzODE5LC0yMC45NjkwNSAyMi42NjA1NywtMzguNjIwNjYgMjAuOTM4NjcsLTM5LjIyNTc3IC0xLjcyMTkxLC0wLjYwNTEgLTcuNjc5OTIsMC40ODU2NyAtMTMuMjQwMDIsMi40MjM5MyAtMTYuNzQ1MjQsNS44Mzc0MyAtMjAuMTg2MDUsNC4yOTAxNiAtMzIuNjkzMDgsLTE0LjcwMTU1IC0xMy41MzI2NSwtMjAuNTQ5MDYgLTE0LjAxNzI0LC0yMi42Njk4MyAtNi45NjE1OCwtMzAuNDY2MjQgNC42MDg3NiwtNS4wOTI1NiA0LjMzMTU5LC02LjI3OTY3IC0zLjIzMTksLTEzLjg0MzE2IC00LjU1MDA5LC00LjU1MDEgLTguMjcyODksLTkuNjQzMDkgLTguMjcyODksLTExLjMxNzc2IDAsLTIuODE2NzkgLTMwLjk5MTQ1LC0xNS41ODkzMyAtNzkuOTg5NDk2LC0zMi45NjYxNSAtMTEuMTA5NjYsLTMuOTM5OTcgLTIwLjE5OTM3NSwtNy44MjkyOCAtMjAuMTk5Mzc1LC04LjY0MjkxIDAsLTAuODEzNjYgMjMuNDcwNzM4LC0xLjAwNDc2IDUyLjE1NzE5MSwtMC40MjQ2OSBsIDUyLjE1NzIxLDEuMDU0NjYgNS4wOTEyNywtOC4wMzAwMSBjIDIxLjUxNjQ0LC0zMy45MzU5MiA1NC4wMDk1MiwtNjQuNTg4MjEyIDY4LjQ2NzA1LC02NC41ODgyMTIgMy4wMTA2LDAgOS4xMjE0MSwyLjg2OTE4IDEzLjU3OTUzLDYuMzc1OTQ1IDcuMjU5NDYsNS43MTAyODMgOC4yNTY1LDkuMjQ4NjMyIDkuNTQ5OTQsMzMuODkxOTY3IDAuNzk0MywxNS4xMzM4MiAyLjQyNDIyLDI4LjQ5NjAxIDMuNjIxOTgsMjkuNjkzNzkgMS4xOTc3NSwxLjE5Nzc2IDQuOTk3NjksLTAuMzc0MjUgOC40NDQzMSwtMy40OTMzOSA0LjQwMTQsLTMuOTgzMjMgOS4wMzQ4NCwtNS4wNjMxMyAxNS41Njc2MSwtMy42MjgzIDYuNzY3NTYsMS40ODY0MSAxMC42MjcxLDAuNDY4OTUgMTQuMTY5MzgsLTMuNzM1NDMgNS4zMTM2LC02LjMwNjY2IDMxLjkwNTk2LC00OC45MzcyMDEgMzEuOTA1OTYsLTUxLjE0ODc0NCAwLC0wLjc1MTU4OCA1LjI2NTA5LC05Ljc1NzMwNiAxMS43MDAyMywtMjAuMDEyNzAzIDYuNDM1MDksLTEwLjI1NTM5NyAxMy44NDY2NCwtMjIuMDgwNjMxIDE2LjQ3MDA3LC0yNi4yNzgyODMgNC42NjU1OCwtNy40NjUyMDEgNS4zOTY2LC02LjU4MTczNSAzMy40MjY5Miw0MC4zOTg3MzYgMjguOTQxMjEsNDguNTA3MTY0IDQ0LjUxNzY3LDY2LjQwNjU1NCA1Mi4zMTU3LDYwLjExNzYzNCA1LjQ0MiwtNC4zODg4OSAzNC4wMDA1NSwtNC42Mzc5NCA0MS45ODI0NiwtMC4zNjYxNCA0LjUzNjY1LDIuNDI3OTMgNy40MTkxNiwyLjM5NjEgOS45MjQ4NCwtMC4xMDk2MiA1LjIwMDA3LC01LjIwMDA2IDE3LjY0OTgyLC00LjI5NDM3IDIwLjkwNDEyLDEuNTIwNzggMi41NjM5Myw0LjU4MTQ2IDMuMjE3ODQsNC41ODE0NiA3LjAyMDE0LDAgMi4zMDYwNiwtMi43Nzg2NyA5LjEzNjE5LC01LjA1MjA4IDE1LjE3ODAzLC01LjA1MjA4IDguNTM4ODQsMCAxMS43OTMzNiwxLjc3MzY3IDE0LjYxNDAzLDcuOTY0MzcgbCAzLjYyODgxLDcuOTY0MzYgNTYuMDkyMDMsLTEuOTg1OCBjIDMwLjg1MDYyLC0xLjA5MjIyIDU2LjA5MjA0LC0xLjI4Njg4IDU2LjA5MjA0LC0wLjQzMjU1IDAsMC44NTQyNyAtMjIuOTA2MDgsMTAuMDcxOTUgLTUwLjkwMjQxLDIwLjQ4MzcxIC0yNy45OTYzMiwxMC40MTE3MiAtNTEuMzY3LDE5LjI0MzA1IC01MS45MzQ4NCwxOS42MjUxMiAtMC41Njc4NSwwLjM4MjA3IDAuNjk4NDcsOS40OTI3MyAyLjgxNDA1LDIwLjI0NTg4IDUuNTA0NTcsMjcuOTc5MTcgMS45MTQ1OCw0Ni42MjU4OSAtMTEuOTI2MjksNjEuOTQ2MDQgLTYuMjA5LDYuODcyNjMgLTE2LjI4MzM4LDE0LjE0Mzk1IC0yMi4zODc1MywxNi4xNTg0OSAtNi4xMDQxNSwyLjAxNDU0IC0xMS4wOTg0NCw0LjM4NjE0IC0xMS4wOTg0NCw1LjI3MDE5IDAsMC44ODQwNiA2LjUxNTI1LDExLjY3ODkzIDE0LjQ3ODM1LDIzLjk4ODU5IDcuOTYzMDksMTIuMzA5NjkgMTMuMjgyOCwyMi4zODEyNSAxMS44MjE1MiwyMi4zODEyNSAtMi4zODUwNCwwIC02MC40Njk4NywtMjIuNDQyMzggLTE1MC43ODg5OCwtNTguMjYwNyAtMTcuODA5LC03LjA2MjU4IC0zNC4wMjY4MywtMTIuODQxMDkgLTM2LjAzOTYxLC0xMi44NDEwOSAtMy43NTM2MywwIC0zNi4xNjY5LDEyLjI4NjYyIC0xMzEuMjI0MjMsNDkuNzQyMDYgLTU1LjEyNTI1LDIxLjcyMTAzIC01Ny4yOTIxNywyMi40NzM0OCAtNTcuMjkyMTcsMTkuODk0NTEgeiBtIDExMy4xMTY0OCwtNTEuMjUyNjUgYyAyOS4zMjk0OSwtMTEuMzk1MDYgNTguNDE2NTcsLTIyLjUzMDggNjQuNjM3OTgsLTI0Ljc0NjA3IDEwLjcwMDY4LC0zLjgxMDE5IDE0LjI3OTE4LC0yLjg1NDkzIDY2LjI1Mzk0LDE3LjY4NjM0IDMwLjIxODI1LDExLjk0Mjc0IDYwLjAzMjUyLDIzLjU3NTg3IDY2LjI1MzkyLDI1Ljg1MTM0IDYuMjIxNDEsMi4yNzU1MiAxOS4wNDMxNyw3LjIyMDU5IDI4LjQ5Mjc1LDEwLjk4OTA4IDEwLjc3NTAzLDQuMjk3MDQgMTYuMjgyNTEsNS4zMzE2NiAxNC43NzEwOCwyLjc3NDg0IC0xNi44ODM3LC0yOC41NjExMyAtMTcuMzk5OCwtMjkuMDM3MTYgLTI5LjEwMDgzLC0yNi44NDIwNSAtMTQuMTEzNjEsMi42NDc3MiAtMjIuODc4OTcsLTAuMDY4NSAtMjcuMzgzNjksLTguNDg1NTQgLTIuOTIxMTIsLTUuNDU4MTYgLTIuMDI5NDQsLTguMTI3NTkgNS4yNTQ0MiwtMTUuNzMwMzEgMTAuODQ4ODcsLTExLjMyMzc3IDkuMTQ0NTcsLTIxLjc0MTQ0IC00Ljg0NDI5LC0yOS42MTA5OSAtNS4zNjc2NCwtMy4wMTk1OSAtMTIuMTQwNTksLTEwLjQ4MzcyIC0xNS4wNTEwMiwtMTYuNTg2OTcgbCAtNS4yOTE2OSwtMTEuMDk2ODIgLTExLjM0NTUxLDcuNjk5MjggYyAtMTMuOTQ0NTgsOS40NjMwNCAtMzAuOTUwNjIsOS45NTA2MyAtNDUuMTQ3NjQsMS4yOTQ0OCBsIC0xMC40NjQ4OCwtNi4zODA2NSAtMTIuMTU4NDEsOC4yNjI4NCBjIC0xMi4xNzQ2Miw4LjI3Mzg2IC0yNi4xOTEwOCw5LjM0MjggLTQwLjQzNzUyLDMuMDgzOTIgLTMuOTI0OTgsLTEuNzI0MzkgLTUuNjU1ODMsLTEuMDU0MTUgLTUuNjU1ODMsMi4xOTAwOCAwLDIuNTcxMTggLTMuNzA0MjksNi4zNjI2NSAtOC4yMzE4MSw4LjQyNTUzIC0xMy41NzQyLDYuMTg0NzkgLTI2LjgyMTA3LDQuNTQyNDcgLTM1LjgwMjI5LC00LjQzODc1IGwgLTguMTg5NDQsLTguMTg5NDQgLTYuNjA5ODIsOC40MDMwMyBjIC0zLjYzNTM5LDQuNjIxNjYgLTEyLjA0OTUyLDExLjgzNjk4IC0xOC42OTgwNSwxNi4wMzM5OCAtOC4yMjk2NSw1LjE5NTE4IC0xOC40MTc0MSwxNy44NzE4MiAtMzEuOTE2NCwzOS43MTM2MSAtMTAuOTA1NDksMTcuNjQ1NDYgLTE5LjgyODE2LDMyLjk4MDQyIC0xOS44MjgxNiwzNC4wNzc3NiAwLDEuMDk3MyA4LjM2MjU1LC0xLjUyNzM2IDE4LjU4MzQyLC01LjgzMjU5IDEwLjIyMDg5LC00LjMwNTIxIDQyLjU4MDI4LC0xNy4xNTA4NyA3MS45MDk3NywtMjguNTQ1OTMgeiBtIDI0OC43NjcyOSwtMTIuMjU4NDYgYyAyMi4yNTU1NywtMTIuNTA4MzMgMjcuNDE0MjQsLTM1LjY0ODA4IDE3LjU3Njg1LC03OC44NDMxOCAtOC4yMjE0LC0zNi4wOTk2MSAtMTIuMzI1NSwtNDcuOTEzMjcgLTE3LjE5NDk0LC00OS40OTU5NyAtMy4zNjkwMiwtMS4wOTUwMyAtMy44ODY3NCwwLjEwNjk5IC0xLjk4ODU4LDQuNjE2MzUgMTIuMzE1MTYsMjkuMjU3NzEgMTIuOTk5NjMsNDMuOTQ2NjIgMi4yNDAyMiw0OC4wNzU0MSAtNy4zOTE1MSwyLjgzNjQyIC0xNS4yMzIzOSwtNy43OTA3NSAtMjEuMzk5MDIsLTI5LjAwMzI2IC00Ljc3NTEyLC0xNi40MjU4NyAtOS43Njg2MSwtMjMuODI4MzcgLTEzLjUzMzg3LC0yMC4wNjMxMSAtMC45MDE1NywwLjkwMTYgMC42Nzg0OCw2LjEyMTE3IDMuNTExMjQsMTEuNTk5MTMgMi44MzI3Myw1LjQ3NzkgNi43MTcyMSwyMS45NzQ1NSA4LjYzMjE3LDM2LjY1OTIgMS45MTQ5NywxNC42ODQ2MiA1LjYxMzg1LDMwLjA2MDczIDguMjE5NzMsMzQuMTY5MTIgNi43NzE5OCwxMC42NzY2MSAxNy41NTEyOCw4LjEwMzYgMjQuNTIzODIsLTUuODUzODQgNi44OTM3MywtMTMuNzk5NzUgNy42NzI4NCwtNC42MDc4MSAwLjk2OTMsMTEuNDM2MDIgLTYuOTYwNzQsMTYuNjU5MzcgLTI3LjYzNDQyLDIxLjY1NDgxIC01MS41ODQxOCwxMi40NjQ0MiAtMy44MzMzLC0xLjQ3MDk2IC01LjEzMDM5LDAuMDUxNSAtNS4xMzAzOSw2LjAyMDk3IDAsNC4zOTQzMSAtMi45MzYxOCwxMS43MjI0NSAtNi41MjQ4OCwxNi4yODQ3IGwgLTYuNTI0ODgsOC4yOTUwNiA4Ljk0ODgxLDEuNTExMjMgYyAxNS40NDk0NSwyLjYwOTA5IDM2LjYzMzI4LC0wLjc3NjQyIDQ5LjI1ODYsLTcuODcyMjUgeiBtIC0zMjAuMzY2NSwtMjcuNTM3MzMgYyA0Ni40NTk2NSwtMTMuMzU0NSA1NC43NjE4OCwtMjguOTMwOTMgMzkuMzI4ODUsLTczLjc4NzgyIC0zLjU4MTg1LC0xMC40MTA3OSAtNi41MTI0MywtMjEuNjA5NzEgLTYuNTEyNDMsLTI0Ljg4NjU0IDAsLTExLjE1NzEyIC01LjYxMTUyLC02LjAwMTYxIC05LjgxNzEzLDkuMDE5NDMgLTUuNTYyMDMsMTkuODY1NjEgLTIyLjI5MTE1LDM2Ljc1MDUzIC0zNi4zNDUxNiwzNi42ODM2NCAtMTIuMjA1NDcsLTAuMDU4MiAtMTYuMTgyNTEsLTIuMjgwMDggLTIxLjIyMzc4LC0xMS44NTc2OCAtOS4wNDc0OCwtMTcuMTg4ODIgMC44MTQ2OSwtNDMuNTY3OTcgMjUuOTY5NTQsLTY5LjQ2MjcyIDE4LjQyNDMxLC0xOC45NjYzMDQgMjguNDg4OTMsLTIwLjY4Mzk2NSAyOC40ODg5MywtNC44NjIwNSAwLDI0LjY3MzIgLTE3LjAxMTM0LDYwLjk5NDcgLTI1Ljk3MzA5LDU1LjQ1NjA0IC00LjM4MjA1LC0yLjcwODI2IC0zLjY3MTM4LC0xNC42Njc1MiAxLjQxNzIyLC0yMy44NTAwOSA0LjMyNzM1LC03LjgwODgyIDMuNDQ4MTQsLTE5LjcwNzcxIC0xLjQ1NjIsLTE5LjcwNzcxIC01LjY4Njg5LDAgLTE2Ljk0NTQ3LDIwLjcxMTk2IC0xOC40MzMxOCwzMy45MTA3NCAtMS4zMTUxNSwxMS42NjgyNiAtMC40OTI4NiwxNC41MDU0NSA1LjA2NjUyLDE3LjQ4MDcyIDE5LjQ4MjQ0LDEwLjQyNjcgNDUuMDA1MzEsLTIxLjM5NTQ1IDQ2LjI5MDgzLC01Ny43MTU4NCAwLjY3NTA0LC0xOS4wNzMxODEgLTMuMDE2NzYsLTI0LjQ0MTEwNSAtMTQuNzc5MDYsLTIxLjQ4ODk1MSAtMTcuMTE4NzksNC4yOTY1NDMgLTYzLjIzNDgzLDYzLjc4NjY0MSAtNjMuMjM0ODMsODEuNTczNDYxIDAsMTMuOTEyOCA2Ljk4NzM3LDIzLjY5NzI4IDE5LjI4ODI3LDI3LjAwOTYgMjAuOTE0MTksNS42MzE2MiA0MS4xMzUzOSwtNC4zNzM4OSA1NS40NjMzLC0yNy40NDMzOCBsIDYuMDIxNzUsLTkuNjk1NzEgMC4wMTMyLDEzLjE3MjIzIGMgMC4wMTYyLDE5LjA3MzggLTEyLjQyNjE5LDI5LjEyNzQgLTUxLjY5ODE3LDQxLjc2NzkzIC05Ljc3NjQ5LDMuMTQ2OCAtMTguMTgzMzIsNi4wNTQ0MSAtMTguNjgxOCw2LjQ2MTM3IC0xLjgyMDU2LDEuNDg2MzIgMTYuNjg3MzksMjcuNDc1NzEgMTkuNTY2NDQsMjcuNDc1NzEgMS42MzI2MiwwIDExLjE5MTE1LC0yLjM2MzU5IDIxLjI0MTIzLC01LjI1MjM4IHogTSA0NzYuNDExLDIxNy45NjMwMSBjIDQuNjYzNDcsLTUuMTUzMSA1LjQ4NTUxLC0xMC43NTEwMyA0LjQ4NTc5LC0zMC41NDgyMyAtMS4wODczOSwtMjEuNTMzMzEgLTIuMjc3NDYsLTI1LjMzODUxIC0xMC42NjE0MywtMzQuMDg5NDkgLTE1LjE0ODgyLC0xNS44MTE5NCAtMzMuODYxMjMsLTExLjc3ODI4IC0yMi45MDgxOSw0LjkzODE0IDUuODIyNTYsOC44ODYzNyAxMi45MjU0LDcuMzY4NjQgMTAuNDE2NDEsLTIuMjI1ODEgLTEuOTk4NjQsLTcuNjQyNzYgMS43Mjk5OCwtNy44NDM1OCA4LjIyODM5LC0wLjQ0MzIyIDEyLjE5MzAxLDEzLjg4NTM3IDkuMTE1MzQsMzMuMTI2OTggLTUuMjk4NiwzMy4xMjY5OCAtOS44NjcxNiwwIC0xMi45NDE5NSwtNC4yMzE3NiAtMTkuMzczNTMsLTI2LjY2MzE4IC0yLjkzMDU5LC0xMC4yMjA4NyAtNi40OTk2NCwtMTguNTgzNDMgLTcuOTMxMjcsLTE4LjU4MzQzIC00Ljc2ODk5LDAgLTYuODkyODcsNC4yMDg3OCAtMy45MjcyMSw3Ljc4MjQgMS42MTA4OCwxLjk0MTEgNi4wNzIxOCwxNS44OTEyNyA5LjkxNDA0LDMxLjAwMDQxIDkuNjY5MDMsMzguMDI1OTYgMjMuMTc2NjYsNTEuMDQxNDUgMzcuMDU1NiwzNS43MDU0MyB6IG0gLTE4My43NzEyNSwwLjYwMzk1IGMgMS45ODk3OCwtMS4zMzUgMi44OTk3NSwtNy42NDg5MyAyLjA3ODY1LC0xNC40MjMgLTEuMzI0NDksLTEwLjkyNzAyIC0yLjA2NjYyLC0xMS43MjQxIC03Ljk3MjcsLTguNTYzMjcgLTguNDg3MzMsNC41NDIyNyAtMTcuNjA4MzksLTQuMDYzNTEgLTIwLjcwMjIyLC0xOS41MzI2IC0yLjM0NzA3LC0xMS43MzUzOCAtMy4wNjUyNiwtMTEuNTA0ODkgMTQuMDI1NzYsLTQuNTAxNDkgMi4xNDI4OCwwLjg3ODA4IDcuNTk2NzEsLTIuMTA0MDIgMTIuMTE5NjMsLTYuNjI2OTQgOC4yNzQwOCwtOC4yNzQwOCAxMC45OTgwMiwtMTguMjEyOTkgNC45OTE1NiwtMTguMjEyOTkgLTEuNzc3NTQsMCAtMy4yMzE5LDEuNDU0MzYgLTMuMjMxOSwzLjIzMTkgMCw0LjY0OTIzIC04Ljg0MjMxLDMuOTg5ODIgLTEwLjgzNDY1LC0wLjgwNzk3IC0xLjE2MjI0LC0yLjc5ODc5IC0zLjYzODA3LC0xLjgwNTkxIC04LjA1OTE1LDMuMjMxOSAtMy41MDk4NSwzLjk5OTQ4IC03Ljc5NjczLDcuMjcxNzggLTkuNTI2NDEsNy4yNzE3OCAtMS43Mjk2OSwwIC00LjA2NTYsLTMuMjcyMyAtNS4xOTA4OCwtNy4yNzE3OCAtMS45NzE5NSwtNy4wMDg1NiAtMi4yMTM2NiwtNy4wNTI3NyAtNi42NzczNywtMS4yMjE2OSAtMy45MTA2LDUuMTA4NTQgLTMuOTQ1NTcsNi43MzU4MyAtMC4yMjQ2MSwxMC40NTY2MSAzLjk0MDYyLDMuOTQwNjQgMTEuNDI2MTUsMzAuODcxMDIgMTEuNDI2MTUsNDEuMTA3NDQgMCwxMi43Mjg2NyAxNy41MjkzMywyMi43MzgzMiAyNy43NzgzLDE1Ljg2MjEgeiBtIDU4Ljk0MzA5LC0xNi44NzUzMSBjIDEyLjE0NTY3LC0xMi4xNDU2NyAxNS43NDQ1MiwtMzAuMzUxNDMgOS4xMjk0MywtNDYuMTgzNTcgLTUuMTcwMTYsLTEyLjM3Mzk3IC0xNC4xNDQ2NiwtMTcuMDA1MTYgLTI2Ljc5ODc4LC0xMy44MjkxOCAtOS40MDI2MywyLjM1OTkxIC0yMy43MjMxMSwyOS43NzY1OSAtMjMuNzczODcsNDUuNTE1MzYgLTAuMDc5MiwyNC41MjkwMiAyMy4yNTA1MywzMi42OTAwNSA0MS40NDMyMiwxNC40OTczOSB6IG0gLTIyLjA4MzQxLC0xOS40MzQwNyBjIC0zLjU1NTEsLTMuNTU1MSAtNi40MTc1NSwtMTAuNDYzMjggLTYuMzYxMDIsLTE1LjM1MTUzIDAuMDkzNCwtOC4wNzk2NSAwLjQ5MzE1LC04LjM3MzUgNC4zOTYxOSwtMy4yMzE5IDQuODI0NjQsNi4zNTU2OSAxMy4zOTc5Nyw3LjQ1NjY2IDE2LjY4MjQxLDIuMTQyMzIgMS4xOTQzMiwtMS45MzI0MSAwLjU1Mjk1LC01LjEzMjAyIC0xLjQyNTIsLTcuMTEwMTcgLTUuMDgxMzIsLTUuMDgxMzIgLTQuNDY1NjEsLTExLjk5OTYzIDEuMDY3OTIsLTExLjk5OTYzIDYuMTUxMzcsMCAxNC43MjY3OSwxMi41MTQ3NyAxNC43MjY3OSwyMS40OTE5MSAwLDYuNjA2NzQgLTEzLjQ0NDQsMjAuNTIyOCAtMTkuODI3MjQsMjAuNTIyOCAtMS41Mzc4NSwwIC01LjcwNDc2LC0yLjkwODcyIC05LjI1OTg1LC02LjQ2MzggeiBtIDg2LjM0ODk3LDE4LjU4MzQxIGMgMTMuNDEwNzQsLTE0LjYwMjYzIDEyLjEwMzc2LC0zNy4wOTggLTMuMDk4MjUsLTUzLjMyNjM0IC03Ljg1MDU3LC04LjM4MDYgLTI1LjI5Mjk4LC05LjgyNTUyIC0zMi40MzE4NSwtMi42ODY2NCAtNi41ODc2MSw2LjU4NzYxIC0xMy4xNjQ2NSwzMi40OTMwMyAtMTAuNzIxMjIsNDIuMjI4NDEgNS4yMTEyMiwyMC43NjMxOCAzMi40MDA0MSwyOC44NjY1MiA0Ni4yNTEzMiwxMy43ODQ1NyB6IG0gLTI3LjQ1NTY1LC0yMy42MTQ1MiBjIC01LjMwNjIzLC0zLjcxNjY0IC03LjEyOTQxLC04LjE0OTc0IC02Ljk3ODA2LC0xNi45Njc0NyAwLjE2OTM1LC05Ljg2MDMzIDAuNjg0MywtMTAuNzQ5ODEgMi45NjE0NSwtNS4xMTQxNSAzLjM0NTczLDguMjgwMzIgMTAuMzYyOTIsMTEuNDA3MzQgMTYuNTE4MTQsNy4zNjA5IDMuODE3NTMsLTIuNTA5NjMgMy42MzkyOSwtMy42OTU5NyAtMS4xMDEwNCwtNy4zMjkwNyAtNi4zMjE4OSwtNC44NDUyMyAtNy41NTUwOCwtMTEuNzAxOTEgLTIuMTA0NjUsLTExLjcwMTkxIDQuODczNjQsMCAyMi4zMDQwMiwxOS4wNjY2NiAyMi4zMDQwMiwyNC4zOTc3OCAwLDUuMjAzMTYgLTEyLjM3NzM5LDE0LjM4NTAzIC0xOS4zOTEzOSwxNC4zODUwMyAtMi43NjQwNSwwIC04LjI1NzksLTIuMjY0MDIgLTEyLjIwODQ3LC01LjAzMTExIHogbSAxODkuOTYyOTIsLTE0LjI4ODg3IDMzLjkzNDk1LC0xMi43MzY4MiAtMzYuMzU4ODgsLTAuMTMxMjUgYyAtMzIuNTM5MiwtMC4xMTczNiAtMzYuMzU0MjQsMC40NjMwNyAtMzYuMzE0NzUsNS41MjQ3NSAwLjA0MDEsNS4xMjc1NyAzLjMzMDczLDIwLjI4Mzk1IDQuMzcyNywyMC4xMzk2NyAwLjIzNzIyLC0wLjAzMjkgMTUuNzAxNzcsLTUuNzkxMjQgMzQuMzY1OTgsLTEyLjc5NjQ4IHogbSAtNDQzLjQ5MzQzLC0yLjI3OTMgMy40NjgyNSwtMTAuMjg3NjEgLTMwLjQ2Njg2LC0xLjAyNDA0IGMgLTE2Ljc1Njc0NCwtMC41NjMyMiAtMzAuNDYzNTg0LC0wLjEzMjEzIC0zMC40NTk1OCwwLjk1ODA0IDAuMDA1OCwxLjU5NTEzIDUyLjUwNjU3LDIyLjEwNzA3IDUzLjY2MTc0LDIwLjk2NTUyIDAuMTgwMzUsLTAuMTc4NCAxLjg4ODkyLC00Ljk1MzcyIDMuNzk2NDUsLTEwLjYxMTkxIHogbSAyMDguOTA5MiwtMzEuODg2OTUgYyA3LjE2NjY3LDEuMTQ2IDE1LjI0OTgxLDQuMDc5MjQgMTcuOTYyNTYsNi41MTgzNSA0LjIxMjc5LDMuNzg3ODMgNi4wNDUyOCwzLjUyOTY2IDEyLjU2MjA3LC0xLjc2OTg1IDQuMTk2NDMsLTMuNDEyNSA5LjY1MDI2LC02LjIwNDU3IDEyLjExOTYzLC02LjIwNDU3IDIuNDY5MzksMCA0LjQ4OTgyLC0wLjcxMzA4IDQuNDg5ODIsLTEuNTg0NjcgMCwtMy4wMDkxOCAtNDYuNTM5NTQsLTc5LjIxMjUyIC00OC4zMTQ0NywtNzkuMTA5NjEgLTIuMDg1LDAuMTIwODcyIC00OS43ODYwMyw4MC4wODc5OCAtNTEuMjU0NjQsODUuOTI0MzcgLTAuNjE2MzQsMi40NDk1MiAxLjMxODA0LDMuMzUzNzEgNS4wNzM2NCwyLjM3MTYgMy4zMzgzNiwtMC44NzMgNy45NTQxNiwwLjY4MzI2IDEwLjI1NzI3LDMuNDU4MzYgMy43MzU0LDQuNTAwODcgNS4yNjEwOCw0LjE0MjI5IDE0LjEzMDY4LC0zLjMyMDk3IDguNDI2NDcsLTcuMDkwNDEgMTEuOTMwOCwtOC4wNDg4IDIyLjk3MzQ0LC02LjI4MzAxIHoiDQogICAgICAgc3R5bGU9ImZpbGw6IzMzMzMzMztmaWxsLW9wYWNpdHk6MSIgLz4NCiAgICA8cGF0aA0KICAgICAgIHN0eWxlPSJmaWxsOiM2Mzk4YWE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiDQogICAgICAgZD0ibSAzMDkuNTQ1NzksMTQwLjg3OTIyIGMgLTAuNTAwNzUsLTAuMjMzMTEgLTEuMTE4MDQsLTAuNzY3OTkgLTIuNTI3OCwtMi4xOTAzNSAtMS45MTE4OCwtMS45Mjg5NyAtMi42NzE4OCwtMi40OTAxMyAtNC4yNjEwOCwtMy4xNDYyOCAtMi4wODc5MSwtMC44NjIwNCAtNC4zNTQ5LC0xLjA5NDIzIC02LjQ4MjMxLC0wLjY2MzkxIC0xLjg5ODA4LDAuMzgzOTMgLTIuNDI0MzUsMC40MjUyNyAtMy4yODI0MiwwLjI1NzggLTEuNDMyMjQsLTAuMjc5NTMgLTEuOTQxNTcsLTEuMTQ5MjkgLTEuNTM1ODMsLTIuNjIyNzIgMC41MDU3MywtMS44MzY1NyA0LjMzNjkzLC04Ljk0MjU1IDEyLjAwODk5LC0yMi4yNzM4NyAxNS41ODM3LC0yNy4wNzg5ODggMzYuNTM2MjQsLTYxLjIyMDk2OCAzOC44NTA1NiwtNjMuMzA2NjYyIDAuMjU2MzEsLTAuMjMwOTk0IDAuMjY1LC0wLjIzMDk5NCAwLjUyMjQ4LDAgMS4zNzc2OCwxLjIzNTk3NiA5LjQ3NjIsMTMuNzI1ODg5IDIwLjU0MDM2LDMxLjY3ODI5OCAxNC45NjY5NiwyNC4yODUwMDQgMjcuNDExMDIsNDUuNjQzNzE0IDI3LjQxMTAyLDQ3LjA0NzcwNCAwLDAuODU3MjkgLTEuMzE2MDgsMS4zNzIxNSAtNC4wODU5MSwxLjU5ODQ1IC0zLjQ0MjI2LDAuMjgxMjQgLTcuNDI0NzgsMi4zMDE4OCAtMTIuODY4ODcsNi41MjkzNiAtMi41ODcxMiwyLjAwODk4IC0zLjY5MTI2LDIuNzU5MzMgLTQuOTUwNjIsMy4zNjQzOCAtMS4wNDkyOCwwLjUwNDExIC0xLjEzNjkyLDAuNTI0MzcgLTIuMjY4NTQsMC41MjQzNyAtMS4xMTM2OCwwIC0xLjIyNjYxLC0wLjAyNDkgLTIuMDk2MjMsLTAuNDYxMjggLTAuNTEyMTMsLTAuMjU3MDIgLTEuNTA0NjksLTAuOTQ5MyAtMi4yNDE1NSwtMS41NjM0MiAtMi4xNzg0OCwtMS44MTU2MSAtNC43OTkxOCwtMy4xMzYxNCAtOS4wNzE5NywtNC41NzEyNCAtNS40Mjk5NywtMS44MjM3NiAtMTEuMjQ0NTQsLTIuOTE4NCAtMTYuMTk1NTEsLTMuMDQ4OTYgLTMuOTA5MzQsLTAuMTAzMDggLTUuNzEyMDEsMC4yNDc5OCAtOC42NzYwMiwxLjY4OTYzIC0yLjQxOTg4LDEuMTc2OTggLTMuNTg2MjEsMi4wMTMxMSAtOS4xMjQ3NSw2LjU0MTQ1IC01LjYzMzc2LDQuNjA2MTcgLTcuNjM0NDIsNS41NjIwNSAtOS42NjQsNC42MTcyNSB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDEyOC42Mzc4NiwxNzAuNzM5IGMgLTEwLjE1OSwtMi45NjA3IC00NS41MDMxNzEsLTE2LjkxOTYyIC01MC40NTA5MjQsLTE5LjkyNTIzIC0wLjY4MjkxNiwtMC40MTQ4NCAtMC43MzgwOTgsLTAuNDc3ODcgLTAuNTQzMjA3LC0wLjYyMDM4IDEuMTMxNTYzLC0wLjgyNzQxIDEyLjMzNzk4MywtMS4yMzkwMSAyNS4wMDQwMzEsLTAuOTE4MzYgNS4wNTEzMSwwLjEyNzg4IDM1LjUwMTMyLDEuMTMzMjMgMzUuNTUwOSwxLjE3Mzc3IDAuMDk5NywwLjA4MTUgLTYuNTIxNjQsMTkuMjg4OCAtNy4wMzA1MSwyMC4zOTQzMyAtMC4yMTI1MSwwLjQ2MTcgLTAuNjUwNjMsMC40NDM2NyAtMi41MzAyOSwtMC4xMDQxMyB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDU0My42OTQxMywxNzUuMzEwNTUgYyAtMS4zODYyLC0yLjcxMjg3IC0zLjg4NzY5LC0xNC45NzA2NyAtMy45NjA3OCwtMTkuNDA4NTggLTAuMDI4NCwtMS43MjQyNCAwLjE4NjY3LC0yLjQyNzQxIDAuOTYwNiwtMy4xNDA4IDEuNzczNzgsLTEuNjM1MDEgNS4zNzkzOCwtMi4yMjMyIDE1LjI5MDE3LC0yLjQ5NDM0IDUuMDAzNDcsLTAuMTM2ODkgMjguMTAxOSwtMC4xNTc5NiA0NC40MTEyNywtMC4wNDA1IGwgMTEuNDI4NTksMC4wODIzIC0yNy41MTc3LDEwLjMxNDI3IGMgLTI1LjA5MjkyLDkuNDA1NCAtMzkuNjg0NzMsMTQuODQxMjYgLTQwLjIyNDkxLDE0Ljk4NDkgLTAuMTM1MTcsMC4wMzYgLTAuMjY5ODEsLTAuMDY3NCAtMC4zODcyNCwtMC4yOTcyMyBsIDAsMCB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDE3OC4wODgzNSwzMTUuNTE0MzMgYyAwLC0wLjc3MDc4IDMuMjY4OSwtNi41MzMxIDExLjU1Mzk1LC0yMC4zNjY5OCAxOS44NTExOCwtMzMuMTQ2MzEgMjguOTI3MTUsLTQ1LjE2MDEyIDQwLjA3MjkyLC01My4wNDQyOSA5Ljk3MTI3LC03LjA1MzM3IDE1LjMwMjc5LC0xMS45Mjk0IDIxLjI0NTM5LC0xOS40MzAzMyBsIDMuNjY0MDksLTQuNjI0OTIgNC45Mzk5LDQuODU2NTIgYyA4LjY0Nzg0LDguNTAxODkgMTMuODYxMywxMC45NjY2OCAyMy4yOTcxNywxMS4wMTQzMiAxMS41NDA1OCwwLjA1ODMgMjQuMTc4NDksLTYuMzg4MSAyNC4xNzg0OSwtMTIuMzMyOTkgMCwtMS4zMzk4IDAuOTU0MDQsLTIuNzIyMzYgMS44Nzg1NywtMi43MjIzNiAwLjM5MTMyLDAgMi42MTY4NiwwLjY4MzY1IDQuOTQ1NjUsMS41MTkyMyA2LjA2OTkyLDIuMTc3OSA5LjYzMDI4LDIuOTY1NDggMTQuNjA5MTIsMy4yMzE2NSA0LjkzOTk4LDAuMjY0MDkgOC41NDg0OCwtMC4xNzA0IDEzLjM1ODE3LC0xLjYwODQxIDQuNzI1NjEsLTEuNDEyODggNy40NDcwOSwtMi44NTkwNSAxNS41OTgzMywtOC4yODg4MiA0LjEwNzYsLTIuNzM2MTggNy41OTk1NCwtNC45NzQ4NyA3Ljc1OTg4LC00Ljk3NDg3IDAuMTYwMzMsMCAzLjEyNTM0LDEuNzE4OTYgNi41ODg5LDMuODE5OTEgMy40NjM1NiwyLjEwMDk1IDcuNjI1NDIsNC4zODEzMyA5LjI0ODU5LDUuMDY3NTEgMTEuMDY4NjIsNC42NzkxOCAyMy4wMjQ0NSw0LjM3MzkgMzMuOTcxMjYsLTAuODY3NDEgMS45NTc5NSwtMC45Mzc0NyA2LjU2NzkzLC0zLjczMDc0IDEwLjI0NDQsLTYuMjA3MjcgMy42NzY0OCwtMi40NzY1MyA2LjczNjEzLC00LjQ0NTc2IDYuNzk5MjMsLTQuMzc2MDYgMC4wNjMxLDAuMDY5NyAxLjQ1NjA1LDIuOTIwOCAzLjA5NTQ0LDYuMzM1NzggMS42Mzk0LDMuNDE0OTggMy42OTg5NSw3LjI2NjcgNC41NzY3OSw4LjU1OTM3IDMuODAwMDEsNS41OTU3OCA4LjE3NTg4LDkuNzUxNDEgMTQuMDgzNDMsMTMuMzc0NjQgNi4wODEyMiwzLjcyOTc1IDkuODMyMDYsOC42ODY4IDEwLjIxODgyLDEzLjUwNTA3IDAuMzgzNjcsNC43Nzk2OCAtMS43MDMyOSw5LjAxOTM5IC03LjcyMTg5LDE1LjY4NzIxIC00LjY5NzQ3LDUuMjA0MTkgLTUuODczMyw3LjIzNTQgLTUuODYxMTMsMTAuMTI0OTEgMC4wMTIyLDIuODkyNjIgMS43MDEwMyw2LjIyODU0IDQuNjY5NjQsOS4yMjM3OSA0LjgwNTMzLDQuODQ4NDQgMTIuMzQ2MDUsNi4yODc3NyAyMy40MzUzNCw0LjQ3MzE5IDIuNDc0MDgsLTAuNDA0ODQgNS41OTQ3OSwtMC43Mzc1NyA2LjkzNDkxLC0wLjczOTM4IDQuMjg1NTEsLTAuMDA2IDYuOTAzMTksMi4wOTU5NSAxMS44OTI1MSw5LjU0ODU5IDMuNDQzNTEsNS4xNDM2NSAxMC45NzM5NiwxNy43NTUwOCAxMC45NzM5NiwxOC4zNzgzNiAwLDAuMzI0MDcgLTAuMzUxNDUsMC41NTIwOCAtMC44NTA5NywwLjU1MjA4IC0xLjA1MTA5LDAgLTUuNjIzMTQsLTEuMjQzOCAtOC45MzIxNCwtMi40Mjk5NCAtNC4zNDg1LC0xLjU1ODc1IC01Ny4yNzIzOCwtMjIuMDA1MjYgLTc0Ljc0Nzg2LC0yOC44Nzc5NSAtNDYuNjYzNSwtMTguMzUxNjIgLTYyLjAyODA1LC0yNC4yMTI0NiAtNjkuNTM2NTcsLTI2LjUyNDg5IC04LjExNDE3LC0yLjQ5ODk1IC0xMy42NDAyOSwtMy4wODUyMiAtMTguMTI2NjEsLTEuOTIzMDYgLTUuNTc5OTYsMS40NDU0NiAtODEuNzIwNjcsMzAuODY4ODggLTEyNi4xMzI0NSw0OC43NDE5NSAtMjEuOTMxMTksOC44MjYgLTI0LjY3NzQ5LDkuODc1NzcgLTI4Ljc4MTE2LDExLjAwMTU5IC0zLjI2MzAzLDAuODk1MjEgLTMuMTQ0MDcsMC44ODI5NCAtMy4xNDQwNywwLjMyNDI2IHoiIC8+DQogIDwvZz4NCjwvc3ZnPg==');
    background-position: 16px 80%;
    background-repeat: no-repeat;
    background-size: 20px 12px;
    padding-left: 2.5em;
}

.multi-language-selector .language-option[data-lang='kotlin'],
.exampleblock[data-lang=kotlin] > .content .title {
    background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA2MCA2MCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjAgNjA7Ij4NCjxnPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iWE1MSURfM18iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUuOTU5NCIgeTE9Ii0xMy4wMTQzIiB4Mj0iNDQuMzA2OCIgeTI9IjE1LjMzMzIiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPg0KCQk8c3RvcCAgb2Zmc2V0PSI5LjY3NzAwMGUtMDIiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDk1RDUiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC4zMDA3IiBzdHlsZT0ic3RvcC1jb2xvcjojMjM4QUQ5Ii8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNjIxMSIgc3R5bGU9InN0b3AtY29sb3I6IzU1N0JERSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjg2NDMiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NDcyRTIiLz4NCgkJPHN0b3AgIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6IzgwNkVFMyIvPg0KCTwvbGluZWFyR3JhZGllbnQ+DQoJPHBvbHlnb24gaWQ9IlhNTElEXzJfIiBzdHlsZT0iZmlsbDp1cmwoI1hNTElEXzNfKTsiIHBvaW50cz0iMCw2MCAzMC4xLDI5LjkgNjAsNjAgCSIvPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNC4yMDkyIiB5MT0iNDguOTQwOSIgeDI9IjIwLjY3MzQiIHkyPSI2NS40MDUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjExODMiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDk1RDUiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC40MTc4IiBzdHlsZT0ic3RvcC1jb2xvcjojM0M4M0RDIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNjk2MiIgc3R5bGU9InN0b3AtY29sb3I6IzZENzRFMSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjgzMzMiIHN0eWxlPSJzdG9wLWNvbG9yOiM4MDZFRTMiLz4NCgk8L2xpbmVhckdyYWRpZW50Pg0KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOnVybCgjU1ZHSURfMV8pOyIgcG9pbnRzPSIwLDAgMzAuMSwwIDAsMzIuNSAJIi8+DQogICAgPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSItMTAuMTAxNyIgeTE9IjUuODM2MiIgeDI9IjQ1LjczMTUiIHkyPSI2MS42Njk0IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIC0xIDAgNjEpIj4NCgkJPHN0b3AgIG9mZnNldD0iMC4xMDc1IiBzdHlsZT0ic3RvcC1jb2xvcjojQzc1N0JDIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuMjEzOCIgc3R5bGU9InN0b3AtY29sb3I6I0QwNjA5QSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjQyNTQiIHN0eWxlPSJzdG9wLWNvbG9yOiNFMTcyNUMiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC42MDQ4IiBzdHlsZT0ic3RvcC1jb2xvcjojRUU3RTJGIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNzQzIiBzdHlsZT0ic3RvcC1jb2xvcjojRjU4NjEzIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuODIzMiIgc3R5bGU9InN0b3AtY29sb3I6I0Y4ODkwOSIvPg0KCTwvbGluZWFyR3JhZGllbnQ+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6dXJsKCNTVkdJRF8yXyk7IiBwb2ludHM9IjMwLjEsMCAwLDMxLjcgMCw2MCAzMC4xLDI5LjkgNjAsMCAJIi8+DQo8L2c+DQo8L3N2Zz4=');
    background-position: 17px 80%;
    background-repeat: no-repeat;
    background-size: 11px 11px;
    padding-left: 2.3em;
}

.multi-language-selector {
    display: block;
}

.multi-language-selector .language-option[data-lang='groovy'] {
    background-position: 20px center;
    padding-left: 32px;
}

.multi-language-selector .language-option[data-lang='kotlin'] {
    background-position: 30px center;
    padding-left: 27px;
}

.multi-language-selector .language-option {
    background-color: white;
    border: 1px solid #f7f7f8;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    display: inline-block;
    font-weight: normal;
    font-family: 'Lato', Arial, sans-serif;
    margin: 0;
    padding: 4px 20px;
    min-width: 130px;
    max-width: 320px;
    text-align: center;
    filter: grayscale(1);
    -webkit-filter: grayscale(1);
    opacity: 0.7;
}

.multi-language-selector .language-option.selected {
    background-color: #f7f7f8;
    color: #02303a;
    filter: none;
    -webkit-filter: none;
    opacity: 1;
}

.multi-language-text.hidden,
.multi-language-selector ~ .multi-language-sample.hidden {
    display: none;
}

.multi-language-sample {
    border-radius: 0 0 4px 4px;
}

/*
 * Ensure that blocks of code do not wrap by applying the behavior of `[listing%nowrap]` by default.
 *
 * These styles are copied from a CSS ruleset in asciidoctor.css that has the same group of
 * selectors except that they end with `.nowrap`.
 */
.literalblock pre,
.literalblock pre[class],
.listingblock pre,
.listingblock pre[class] {
    overflow-x: auto;
    white-space: pre;
    word-wrap: normal;
}

/*
 * This CSS ruleset solves: https://github.com/gradle/guides/issues/113#issuecomment-314826749.
 */
.literalblock pre::after,
.literalblock pre[class]::after,
.listingblock pre::after,
.listingblock pre[class]::after {
    content: "";
}

.quoteblock blockquote,
.quoteblock blockquote p {
    text-align: left;
    text-align: start;
}

div.screenshot {
    box-shadow: 0 0 20px 1px rgba(0, 0, 0, 0.2);
    margin-left: auto;
    margin-right: auto;
    width: 90%;
}

.inset {
    box-shadow: 0 0 1px 1px rgba(0, 0, 0, 0.1);
    padding: 1em;
}

.image.inline-icon img {
    vertical-align: sub;
}

/* TOC */
#header > h1:first-child + #toc {
    background: none;
    border: 0 none;
    margin-top: 0;
}

#header #toctitle {
    margin-bottom: 0.425rem;
}

#toc,
#content #toc {
    border: 0 none;
}

#toc > ul {
    margin-left: 0;
    font-family: inherit;
}

#toc > ul > li {
    line-height: 1.25;
    margin-top: 0;
    padding-bottom: 0.5rem;
}

#toc > ul > li:last-of-type {
    padding-bottom: 0;
}

#toc a {
    font-style: normal;
}

#toc a:hover,
#toc a:focus,
#toc a:hover code,
#toc a:focus code {
    color: #1DA2BD;
}

#toc a:active {
    text-decoration: none;
}

@media screen and (min-width: 75rem) and (min-height: 48rem) {
    #header #toc {
        font-size: 1rem;
        background: #f7f7f8;
        border-radius: 0;
        margin-bottom: 0;
        padding: 15px 0 0;
    }

    #header #toctitle {
        font-size: 1rem;
        font-weight: 700;
        margin: 0.4rem 0 0.5rem 0;
    }

    #toc a {
        color: #02303A;
    }

    #toc a.active {
        color: #1BA8C4;
    }
}

/* Site header specific styles */
.hamburger {
    background-color: transparent;
    background-image: none;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-left: auto;
    padding: 11px 10px;
}

.hamburger:focus {
    outline: 0;
}

.hamburger__bar {
    display: block;
    width: 22px;
    height: 2px;
    background-color: black;
    border-radius: 1px;
}

.hamburger__bar + .hamburger__bar {
    margin-top: 4px;
}

.site-header {
    background-color: white;
}

/* Override javadoc styles */
.site-header div {
    font-family: 'Lato', Arial, sans-serif;
}

.site-header__navigation-header a {
    align-self: center;
    border-bottom: 0 none;
    height: 36px;
}

.site-header .site-header-version {
    align-self: flex-end;
    color: #1da2bd;
    font-size: 20px;
    padding-left: 1px;
}

.site-header__navigation {
    display: flex;
    flex-direction: column;
}

.site-header__navigation-header {
    display: flex;
    flex: 0 0 auto;
    margin-left: 12px;
}

.site-header__navigation-collapsible {
    flex: 1 1 auto;
    height: 210px;
    overflow: visible;
    transition: height 0.3s ease;
}

.site-header__navigation-items {
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    align-items: flex-start;
    max-height: 210px; /* This matches the collapsible height above */
    margin: 0 20px;
    padding-top: 12px;
    padding-left: 0;
    list-style-type: none;
}

.site-header__navigation-item {
    flex: 0 1 auto;
    font-size: 16px;
    width: 250px;
}

.site-header__navigation-item .site-header__navigation-link {
    position: relative;
    display: inline-block;
    cursor: pointer;
    width: 100%;
    padding: 5px;
    line-height: 20px;
    border: 0 none;
    color: #02303A;
    text-decoration: none;
    transition: none;
    -o-transition: none;
    -moz-transition: none;
    -webkit-transition: none;
}

.site-header__navigation-item .site-header__navigation-link:hover {
    color: #1DA2BD;
}

.site-header__navigation-item .site-header__navigation-link.active {
    font-weight: 500;
}

/* Navigation submenu styles */
.site-header__navigation-submenu-section {
    position: relative;
}

.site-header__navigation-submenu-section .site-header__down-arrow {
    width: 8px;
    height: 8px;
    margin-left: 2px;
    margin-top: 0;
}

.site-header__navigation-submenu-section .site-header__navigation-link:hover {
    color: #02303A;
}

.site-header__navigation-submenu-section .site-header__navigation-link:hover path {
    fill: none;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link:hover {
    color: #1DA2BD;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu {
    display: none;
    width: 170px;
    background-color: white;
    top: 40px;
    left: 21px; /* NOTE: This must match the padding of .site-header__navigation-link */
    padding: 3px 10px 6px 10px;
    z-index: 100;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link {
    width: 100%;
    color: #02303A;
    white-space: nowrap;
    display: inline-block;
    padding-top: 3px;
    border: 0 none;
    transition: none;
    -o-transition: none;
    -moz-transition: none;
    -webkit-transition: none;
}

.site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link .site-header__navigation-submenu-item-link-text {
    display: inline-block;
    font-size: 16px;
}

.site-header__navigation-submenu-section.open .site-header__navigation-submenu {
    display: block;
}

/* Top navigation mobile styles */
@media (max-width: 1023px) {
    .site-header__navigation-collapsible--collapse {
        height: 0;
        overflow-y: hidden;
    }

    .site-header__navigation-submenu-section .site-header__navigation-submenu {
        padding: 0 1rem 0.5rem 1.5rem;
        display: block;
        top: 30px !important;
        left: 0 !important;
    }

    .site-header__navigation-item,
    .site-header__navigation-submenu-section .site-header__navigation-submenu .site-header__navigation-submenu-item-link .site-header__navigation-submenu-item-link-text {
        font-size: 18px;
    }

    .site-header {
        padding: 5px 12px;
    }

    .site-header-version {
        display: none;
    }

    .site-footer__navigation {
        flex-direction: column;
    }

    .site-footer__links {
        flex-wrap: wrap;
    }

    .site-footer__link-group {
        margin-bottom: 1rem;
    }
}

/* Top navigation desktop styles */
@media (min-width: 1024px) {
    .site-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        -webkit-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .15);
        -moz-box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .15);
        box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .15);
        z-index: 1;
    }

    /*
      Pushes the section headings to just below the top nav bar when a user
      navigates directly to section anchors.
     */
    #content h2[id], #content h3[id], #content h4[id], #content h5[id] {
        padding-top: 60px;
    }

    #content h2[id] {
        /* Little extra room above h2s */
        margin-top: -1em;
    }

    #content h3[id], #content h4[id], #content h5[id] {
        margin-top: -60px;
    }

    .site-header__navigation {
        flex-direction: row;
    }

    .site-header__navigation-button {
        display: none;
    }

    .site-header__navigation-items {
        flex-direction: row;
        align-items: center;
        float: right;
        width: auto;
        padding-top: 0;
    }

    .site-header__navigation-item {
        width: auto;
    }

    .site-header__navigation-item .site-header__navigation-link {
        padding: 15px 18px;
    }

    .site-header__navigation-item:last-of-type .site-header__navigation-link {
        padding-right: 0;
    }

    .site-header__navigation-link--button {
        padding: 6px 12px;
    }

    .site-header__navigation-collapsible {
        height: auto;
    }

    .site-header__navigation-submenu-section .site-header__navigation-submenu {
        position: absolute;
        border: 1px solid #9a9a9a;
        border-radius: 3px;
    }

    .site-header__navigation-submenu-section:hover .site-header__navigation-submenu {
        display: block;
    }

    /*
      Pushes the section headings to just below the top nav bar when a user
      navigates directly to section anchors. It doesn't work if you try
      to apply the padding and margin to the `h` elements directly.
     */
    .chapter a[name],
    .chapter .anchor {
        padding-top: 60px;
        margin-top: -60px;
        text-decoration: none;
        border: none;
        display: inline-block;
    }
}

/* Side Navigation styles */
/* Docs Navigation */
.docs-navigation {
    display: none;
    padding-left: 5px;
}

.docs-navigation .search-container {
    display: none;
    margin-bottom: 1rem;
}

.docs-navigation .search-input {
    height: 30px;
    line-height: 30px;
    box-sizing: border-box;
    padding: 0 20px 0 30px;
    border: 1px solid #e3e3e3;
    border-radius: 3px;
    color: #666;
    outline: none;
    margin-right: 10px;
    transition: border-color 0.2s ease;
    background: white url('data:image/svg+xml;utf8,<svg height="20px" version="1.1" viewBox="0 0 32 32" width="20px" xmlns="http://www.w3.org/2000/svg"><g fill="#cccccc" fill-rule="evenodd" stroke="none" stroke-width="1"><path d="M19.4271164,21.4271164 C18.0372495,22.4174803 16.3366522,23 14.5,23 C9.80557939,23 6,19.1944206 6,14.5 C6,9.80557939 9.80557939,6 14.5,6 C19.1944206,6 23,9.80557939 23,14.5 C23,16.3366522 22.4174803,18.0372495 21.4271164,19.4271164 L27.0119176,25.0119176 C27.5621186,25.5621186 27.5575313,26.4424687 27.0117185,26.9882815 L26.9882815,27.0117185 C26.4438648,27.5561352 25.5576204,27.5576204 25.0119176,27.0119176 L19.4271164,21.4271164 L19.4271164,21.4271164 Z M14.5,21 C18.0898511,21 21,18.0898511 21,14.5 C21,10.9101489 18.0898511,8 14.5,8 C10.9101489,8 8,10.9101489 8,14.5 C8,18.0898511 10.9101489,21 14.5,21 L14.5,21 Z"/></g></svg>') no-repeat 8px 5px;
    background-size: 20px;
    vertical-align: middle !important;
    max-width: 100%;
}

.docs-navigation .search-input:focus {
    border-color: #1BA8CB;
}

.docs-navigation .search-input::placeholder {
    color: #ccc;
}

/* Docsearch overrides */
.docs-navigation .algolia-autocomplete {
    display: block !important;
    flex: 1;
}

.docs-navigation .algolia-autocomplete .ds-dropdown-menu {
    width: 100%;
    min-width: 0 !important;
    max-width: none !important;
    padding: .75rem 0 !important;
    background-color: #fff !important;
    background-clip: padding-box;
    border: 1px solid #e3e3e3 !important;
    box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .175) !important;
}

@media (min-width: 768px) {
    .docs-navigation .algolia-autocomplete .ds-dropdown-menu {
        width: 300%;
    }
}

.docs-navigation .algolia-autocomplete .ds-dropdown-menu [class^="ds-dataset-"] {
    padding: 0 !important;
    overflow: visible !important;
    background-color: transparent !important;
    border: 0 !important;
}

.docs-navigation .algolia-autocomplete .ds-dropdown-menu .ds-suggestions {
    margin-top: 0 !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion {
    padding: 0 15px !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--category-header {
    font-weight: 800 !important;
    color: #1BA8CB !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--wrapper {}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--subcategory-column {}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--content {
    padding: 0 !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--title {
    display: block !important;
    color: #02303A;
    padding: .25rem 1rem !important;
    margin-bottom: 0 !important;
    font-weight: 500 !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--text {
    padding: 0 1rem .5rem !important;
    margin-top: -.25rem !important;
    font-size: 0.9em !important;
    font-weight: 400 !important;
    line-height: 1.25 !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-footer {
    float: none !important;
    width: auto !important;
    height: auto !important;
    padding: .75rem 1rem 0;
    font-size: .875rem !important;
    line-height: 1 !important;
    color: #767676 !important;
    border-top: 1px solid #e3e3e3 !important;
    text-align: right;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-footer a {
    font-size: .875rem;
    text-decoration: underline;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-footer--logo {
    display: inline !important;
    overflow: visible !important;
    color: inherit !important;
    text-indent: 0 !important;
    background: none !important;
}

.docs-navigation .algolia-autocomplete .algolia-docsearch-suggestion--highlight {
    background-color: rgba(143, 187, 237, .1) !important;
}

.docs-navigation .algolia-autocomplete .ds-suggestion .ds-cursor .algolia-docsearch-suggestion--content {
    background-color: rgba(208, 189, 236, .15) !important;
}

.docs-navigation a {
    color: #02303A;
    display: block;
    font-size: 1rem;
    line-height: 1.25;
}

.docs-navigation a code {
    color: #02303A;
    overflow-wrap: break-word;
    padding: 0;
    word-break: break-all;
}

.docs-navigation a.active {
    color: #1BA8C4;
}

.docs-navigation ul {
    list-style-type: none;
    margin: 0.5em 0;
    padding: 0;
}

.docs-navigation ul:last-of-type {
    margin-bottom: 0;
}

.docs-navigation li:first-of-type {
    margin-top: 0;
}

.docs-navigation li {
    margin-bottom: 0.5em;
}

.docs-navigation li:last-of-type {
    margin-bottom: 0;
}

.docs-navigation .nav-dropdown {
    background: transparent url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iNiIgdmlld0JveD0iMCAwIDE5IDExIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIHRyYW5zZm9ybT0icm90YXRlKC0xODAgOS4zNzQgNS40OTQpIiBkPSJNMTcuOTk5MSAxMC40MjI4MjVMOS4zNzQxIDAuNTY1NTc1IDAuNzQ5MSAxMC40MjI4MjUiIHN0cm9rZT0iIzAyMzAzQSIgb3BhY2l0eT0iMC43IiBzdHJva2Utd2lkdGg9IjEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+') no-repeat center right;
}

.docs-navigation > ul ul,
.docs-navigation > ul ul ul {
    display: none;
    height: 0;
    margin-left: 1rem;
}

.docs-navigation > ul ul:target,
.docs-navigation > ul ul:target ul,
.docs-navigation > ul .nav-dropdown.expanded ~ ul {
    display: block;
    height: auto;
}

.docs-navigation h3 {
    font-size: 1rem;
    font-weight: 700;
    line-height: 1.5;
    margin: 1.5em 0 0;
}

.docs-navigation .docs-home-link {
    position: relative;
}

.docs-navigation .pdf-link-container {
    display: inline-block;
    position: absolute;
    top: -1.25em;
    right: 0;
}

.docs-navigation .pdf-link-container a {
    color: #999;
    font-size: 12px;
}

.docs-navigation .pdf-link-container svg {
    fill: #999;
    height: 12px;
    vertical-align: bottom;
}

@media screen and (min-width: 45rem) {
    .main-content {
        display: flex;
        justify-content: center;
    }
}

/* User guide navigation appears for desktops */
@media screen and (min-width: 64rem) {
    .main-content {
        padding-top: 75px;
    }

    .docs-navigation {
        display: block;
        flex: 0 0 auto;
        width: 13.75rem;
    }

    .main-content > .appendix,
    .main-content > .book,
    .main-content > .chapter {
        flex: 0 0 45rem;
        margin: 0 20px;
    }
}

/* Fixed intra-chapter navigation for desktops */
@media screen and (min-width: 75rem) and (min-height: 48rem) {
    .appendix #header #toc,
    .book #header #toc,
    .chapter #header #toc {
        position: fixed;
        left: calc(50% + 380px);
        top: 50px;
        width: 13.75rem;
        padding-top: 15px;
        font-size: 1rem;
        background-color: #F7F7F8;
    }

    .appendix #toc a,
    .book #toc a,
    .chapter #toc a {
        color: #02303A;
        display: inline-block;
    }

    .appendix #toc a.active,
    .book #toc a.active,
    .chapter #toc a.active {
        color: #1BA8C4;
    }

    .docs-navigation {
        flex-basis: 13.75rem;
    }

    /* Sneaky way to make room for TOC */
    .secondary-navigation {
        flex: 0 0 13.75rem;
    }
}

@media screen and (min-width: 84.375rem) and (min-height: 48rem) {
    .appendix #header #toc,
    .book #header #toc,
    .chapter #header #toc {
        left: calc(50% + 26.25rem);
    }
}

@media screen and (min-width: 93.75rem) and (min-height: 48rem) {
    .appendix #header #toc,
    .book #header #toc,
    .chapter #header #toc {
        left: calc(50% + 31.25rem);
    }
}

/* Userguide Meta */
.chapter-meta {
    float: right;
    text-align: right;
}

.chapter-meta .edit-link {
    color: #999;
    font-size: 0.9em;
    padding-right: 3px;
}

.chapter-meta .edit-link svg {
    margin-right: 1px;
}

/* Clever use of RTL to fill in all stars to left of hover position */
.rating {
    direction: rtl;
}

.rating > .star {
    cursor: pointer;
    display: table-cell;
    padding: 3px;
}

.rating > .star:hover > svg > g,
.rating > .star:hover ~ .star > svg > g,
.rating > .star.selected > svg > g,
.rating > .star.selected ~ .star > svg > g {
    fill: #999;
}

/* Footer styles */
.site-footer {
}

.site-footer__navigation {
    display: flex;
    max-width: 75rem;
    margin: 3rem auto 0 auto;
    padding: 0.5rem 0.75rem;
}

.site-footer__links {
    display: flex;
    flex: 1 1 auto;
}

.site-footer__links .site-footer__links-list {
    list-style-type: none;
    margin: 0;
}

.site-footer__links .site-footer__links-list a {
    color: #666;
}

.site-footer__link-group {
    flex: 1 1 auto;
    flex-basis: 175px;
}

.site-footer__link-group header {
    color: #555;
}

.site-footer__subscribe-newsletter {
    flex: 0 0 350px;
}

.site-footer__subscribe-newsletter .newsletter-form__header h5 {
    color: #555;
    margin-top: 0;
}

.site-footer__subscribe-newsletter p {
    font-size: 0.875rem;
    margin: 2px 0 0 2px;
    opacity: 0.7;
}

.site-footer__subscribe-newsletter .disclaimer {
    font-size: 0.75rem;
    opacity: 0.55;
}

.site-footer__subscribe-newsletter .newsletter-form {
    padding-top: 6px;
    display: flex;
    justify-content: flex-start;
}

.site-footer__subscribe-newsletter .email,
.site-footer__subscribe-newsletter .submit {
    height: 40px;
}

.site-footer__subscribe-newsletter .email {
    line-height: 40px;
    width: 250px;
    color: #1DA2BD;
    font-size: 16px;
    padding-left: 20px;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    border-style: none;
}

.site-footer__subscribe-newsletter .submit {
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
    width: 100px;
    background-color: #1BA8CB;
    color: white;
    font-weight: 500;
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
    border-style: none;
    cursor: pointer;
    transition: all .3s ease;
}

/* Secondary footer (below) */
.site-footer-secondary {
    background-color: white;
}

.site-footer-secondary__contents {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 75rem;
    margin-left: auto;
    margin-right: auto;
    font-size: 0.875rem;
    padding: 0.5rem 0.75rem;
}

/*
 * 1. Value is the largest computed width among 'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__copy,
.site-footer__secondary-links {
    flex-grow: 0;
    flex-basis: 280px;
    /* 1. */
}

/*
 * 1. 'flex-shrink: 1' is applied to the element with the smallest computed width among
 *    'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__copy {
    flex-shrink: 1;
    /* 1. */
}

.site-footer__logo {
    flex: 0 0 auto;
    margin-right: 10px;
    margin-left: 10px;
}

.site-footer__logo svg {
    width: 35px;
    height: 35px;
}

/*
 * 1. 'flex-shrink: 0' is applied to the element with the largest computed width among
 *    'site-footer__copy' and 'site-footer__links'.
 */
.site-footer__secondary-links {
    flex-shrink: 0;
    /* 1 */
    text-align: right;
    white-space: nowrap;
}

.site-footer-secondary a {
    color: #999;
}

.site-footer-secondary__links a:not(:last-child) {
    padding-right: 10px;
}

.site-footer-secondary__links a:not(:first-child) {
    padding-left: 10px;
}

@media all and (max-width: 29.99rem) {
    .site-footer__rights,
    .site-footer-secondary__links {
        display: none;
    }

    .site-footer__logo {
        order: 1;
        text-align: left;
    }

    .site-footer__copy {
        order: 2;
        text-align: right;
    }
}

/* Avoid the footer taking up much of the screen on short displays */
@media all and (max-height: 56.25rem) {
    .site-footer__navigation {
        margin: 1.5rem auto 0 auto;
        padding-top: 0;
        padding-bottom: 0;
    }
}

@media screen and (min-width: 84.375rem) {
    .ui-logos .ui-logo {
        box-shadow: 0 6px 15px 1px rgba(0, 0, 0, 0.56);
    }

    .main-content > .appendix,
    .main-content > .book,
    .main-content > .chapter {
        flex-basis: 50rem;
        max-width: 50rem;
    }
}

@media screen and (min-width: 93.75rem) {
    .main-content > .appendix,
    .main-content > .book,
    .main-content > .chapter {
        flex-basis: 60rem;
        max-width: 60rem;
    }
}

/* User Manual Home */
.technology-logos,
.ui-logos {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-around;
}

.technology-logo,
.ui-logo {
    flex: 0 1 auto;
}

.ui-logo {
    width: 224px;
    height: 135px;
    margin: 12px;
}

/* Samples download button */
.download {
  display: flex;
}

.download a {
  border-style: solid;
  border-width: 1px;
  text-decoration: none;
  padding: 5px;
  display: block;
  width: 10em;
  margin: 5px;
}

.download ul {
  list-style: none;
  list-style-type: none;
}

.download li {
  float: right;
}

</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<meta name="adoc-src-path" content="userguide_single.adoc">
<meta name="robots" content="noindex">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@gradle">
<meta name="twitter:creator" content="@gradle">
<meta name="twitter:title" content="Gradle User Manual: Version {gradleVersion}">
<meta name="twitter:description" content="Single-page Gradle User Manual for Gradle 6.4.1">
<meta name="twitter:url" content="https://docs.gradle.org/6.4.1/userguide/userguide_single.html">
<meta name="twitter:image" content="https://gradle.org/images/gradle-256x256.png">

<link crossorigin href="//assets.gradle.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"/>

<style type="text/css">.multi-language-selector .language-option[data-lang='groovy'],
.exampleblock[data-lang=groovy] > .content .title {
    background-image: url('data:image/svg+xml;base64,PHN2Zw0KICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIg0KICAgd2lkdGg9IjYxNC4wNjA4NSINCiAgIGhlaWdodD0iMzAzLjU5ODYiDQogICB2ZXJzaW9uPSIxLjEiPg0KICA8Zw0KICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzUuMzk2NTk5LC0zMC41NTgxOTYpIj4NCiAgICA8cGF0aA0KICAgICAgIGQ9Im0gMTU0Ljk3Njg3LDMzMi42OTE2MiBjIDAsLTAuODA1ODcgMTAuODMxMjMsLTE4LjYyMTcyIDI0LjA2OTQsLTM5LjU5MDc2IDEzLjIzODE5LC0yMC45NjkwNSAyMi42NjA1NywtMzguNjIwNjYgMjAuOTM4NjcsLTM5LjIyNTc3IC0xLjcyMTkxLC0wLjYwNTEgLTcuNjc5OTIsMC40ODU2NyAtMTMuMjQwMDIsMi40MjM5MyAtMTYuNzQ1MjQsNS44Mzc0MyAtMjAuMTg2MDUsNC4yOTAxNiAtMzIuNjkzMDgsLTE0LjcwMTU1IC0xMy41MzI2NSwtMjAuNTQ5MDYgLTE0LjAxNzI0LC0yMi42Njk4MyAtNi45NjE1OCwtMzAuNDY2MjQgNC42MDg3NiwtNS4wOTI1NiA0LjMzMTU5LC02LjI3OTY3IC0zLjIzMTksLTEzLjg0MzE2IC00LjU1MDA5LC00LjU1MDEgLTguMjcyODksLTkuNjQzMDkgLTguMjcyODksLTExLjMxNzc2IDAsLTIuODE2NzkgLTMwLjk5MTQ1LC0xNS41ODkzMyAtNzkuOTg5NDk2LC0zMi45NjYxNSAtMTEuMTA5NjYsLTMuOTM5OTcgLTIwLjE5OTM3NSwtNy44MjkyOCAtMjAuMTk5Mzc1LC04LjY0MjkxIDAsLTAuODEzNjYgMjMuNDcwNzM4LC0xLjAwNDc2IDUyLjE1NzE5MSwtMC40MjQ2OSBsIDUyLjE1NzIxLDEuMDU0NjYgNS4wOTEyNywtOC4wMzAwMSBjIDIxLjUxNjQ0LC0zMy45MzU5MiA1NC4wMDk1MiwtNjQuNTg4MjEyIDY4LjQ2NzA1LC02NC41ODgyMTIgMy4wMTA2LDAgOS4xMjE0MSwyLjg2OTE4IDEzLjU3OTUzLDYuMzc1OTQ1IDcuMjU5NDYsNS43MTAyODMgOC4yNTY1LDkuMjQ4NjMyIDkuNTQ5OTQsMzMuODkxOTY3IDAuNzk0MywxNS4xMzM4MiAyLjQyNDIyLDI4LjQ5NjAxIDMuNjIxOTgsMjkuNjkzNzkgMS4xOTc3NSwxLjE5Nzc2IDQuOTk3NjksLTAuMzc0MjUgOC40NDQzMSwtMy40OTMzOSA0LjQwMTQsLTMuOTgzMjMgOS4wMzQ4NCwtNS4wNjMxMyAxNS41Njc2MSwtMy42MjgzIDYuNzY3NTYsMS40ODY0MSAxMC42MjcxLDAuNDY4OTUgMTQuMTY5MzgsLTMuNzM1NDMgNS4zMTM2LC02LjMwNjY2IDMxLjkwNTk2LC00OC45MzcyMDEgMzEuOTA1OTYsLTUxLjE0ODc0NCAwLC0wLjc1MTU4OCA1LjI2NTA5LC05Ljc1NzMwNiAxMS43MDAyMywtMjAuMDEyNzAzIDYuNDM1MDksLTEwLjI1NTM5NyAxMy44NDY2NCwtMjIuMDgwNjMxIDE2LjQ3MDA3LC0yNi4yNzgyODMgNC42NjU1OCwtNy40NjUyMDEgNS4zOTY2LC02LjU4MTczNSAzMy40MjY5Miw0MC4zOTg3MzYgMjguOTQxMjEsNDguNTA3MTY0IDQ0LjUxNzY3LDY2LjQwNjU1NCA1Mi4zMTU3LDYwLjExNzYzNCA1LjQ0MiwtNC4zODg4OSAzNC4wMDA1NSwtNC42Mzc5NCA0MS45ODI0NiwtMC4zNjYxNCA0LjUzNjY1LDIuNDI3OTMgNy40MTkxNiwyLjM5NjEgOS45MjQ4NCwtMC4xMDk2MiA1LjIwMDA3LC01LjIwMDA2IDE3LjY0OTgyLC00LjI5NDM3IDIwLjkwNDEyLDEuNTIwNzggMi41NjM5Myw0LjU4MTQ2IDMuMjE3ODQsNC41ODE0NiA3LjAyMDE0LDAgMi4zMDYwNiwtMi43Nzg2NyA5LjEzNjE5LC01LjA1MjA4IDE1LjE3ODAzLC01LjA1MjA4IDguNTM4ODQsMCAxMS43OTMzNiwxLjc3MzY3IDE0LjYxNDAzLDcuOTY0MzcgbCAzLjYyODgxLDcuOTY0MzYgNTYuMDkyMDMsLTEuOTg1OCBjIDMwLjg1MDYyLC0xLjA5MjIyIDU2LjA5MjA0LC0xLjI4Njg4IDU2LjA5MjA0LC0wLjQzMjU1IDAsMC44NTQyNyAtMjIuOTA2MDgsMTAuMDcxOTUgLTUwLjkwMjQxLDIwLjQ4MzcxIC0yNy45OTYzMiwxMC40MTE3MiAtNTEuMzY3LDE5LjI0MzA1IC01MS45MzQ4NCwxOS42MjUxMiAtMC41Njc4NSwwLjM4MjA3IDAuNjk4NDcsOS40OTI3MyAyLjgxNDA1LDIwLjI0NTg4IDUuNTA0NTcsMjcuOTc5MTcgMS45MTQ1OCw0Ni42MjU4OSAtMTEuOTI2MjksNjEuOTQ2MDQgLTYuMjA5LDYuODcyNjMgLTE2LjI4MzM4LDE0LjE0Mzk1IC0yMi4zODc1MywxNi4xNTg0OSAtNi4xMDQxNSwyLjAxNDU0IC0xMS4wOTg0NCw0LjM4NjE0IC0xMS4wOTg0NCw1LjI3MDE5IDAsMC44ODQwNiA2LjUxNTI1LDExLjY3ODkzIDE0LjQ3ODM1LDIzLjk4ODU5IDcuOTYzMDksMTIuMzA5NjkgMTMuMjgyOCwyMi4zODEyNSAxMS44MjE1MiwyMi4zODEyNSAtMi4zODUwNCwwIC02MC40Njk4NywtMjIuNDQyMzggLTE1MC43ODg5OCwtNTguMjYwNyAtMTcuODA5LC03LjA2MjU4IC0zNC4wMjY4MywtMTIuODQxMDkgLTM2LjAzOTYxLC0xMi44NDEwOSAtMy43NTM2MywwIC0zNi4xNjY5LDEyLjI4NjYyIC0xMzEuMjI0MjMsNDkuNzQyMDYgLTU1LjEyNTI1LDIxLjcyMTAzIC01Ny4yOTIxNywyMi40NzM0OCAtNTcuMjkyMTcsMTkuODk0NTEgeiBtIDExMy4xMTY0OCwtNTEuMjUyNjUgYyAyOS4zMjk0OSwtMTEuMzk1MDYgNTguNDE2NTcsLTIyLjUzMDggNjQuNjM3OTgsLTI0Ljc0NjA3IDEwLjcwMDY4LC0zLjgxMDE5IDE0LjI3OTE4LC0yLjg1NDkzIDY2LjI1Mzk0LDE3LjY4NjM0IDMwLjIxODI1LDExLjk0Mjc0IDYwLjAzMjUyLDIzLjU3NTg3IDY2LjI1MzkyLDI1Ljg1MTM0IDYuMjIxNDEsMi4yNzU1MiAxOS4wNDMxNyw3LjIyMDU5IDI4LjQ5Mjc1LDEwLjk4OTA4IDEwLjc3NTAzLDQuMjk3MDQgMTYuMjgyNTEsNS4zMzE2NiAxNC43NzEwOCwyLjc3NDg0IC0xNi44ODM3LC0yOC41NjExMyAtMTcuMzk5OCwtMjkuMDM3MTYgLTI5LjEwMDgzLC0yNi44NDIwNSAtMTQuMTEzNjEsMi42NDc3MiAtMjIuODc4OTcsLTAuMDY4NSAtMjcuMzgzNjksLTguNDg1NTQgLTIuOTIxMTIsLTUuNDU4MTYgLTIuMDI5NDQsLTguMTI3NTkgNS4yNTQ0MiwtMTUuNzMwMzEgMTAuODQ4ODcsLTExLjMyMzc3IDkuMTQ0NTcsLTIxLjc0MTQ0IC00Ljg0NDI5LC0yOS42MTA5OSAtNS4zNjc2NCwtMy4wMTk1OSAtMTIuMTQwNTksLTEwLjQ4MzcyIC0xNS4wNTEwMiwtMTYuNTg2OTcgbCAtNS4yOTE2OSwtMTEuMDk2ODIgLTExLjM0NTUxLDcuNjk5MjggYyAtMTMuOTQ0NTgsOS40NjMwNCAtMzAuOTUwNjIsOS45NTA2MyAtNDUuMTQ3NjQsMS4yOTQ0OCBsIC0xMC40NjQ4OCwtNi4zODA2NSAtMTIuMTU4NDEsOC4yNjI4NCBjIC0xMi4xNzQ2Miw4LjI3Mzg2IC0yNi4xOTEwOCw5LjM0MjggLTQwLjQzNzUyLDMuMDgzOTIgLTMuOTI0OTgsLTEuNzI0MzkgLTUuNjU1ODMsLTEuMDU0MTUgLTUuNjU1ODMsMi4xOTAwOCAwLDIuNTcxMTggLTMuNzA0MjksNi4zNjI2NSAtOC4yMzE4MSw4LjQyNTUzIC0xMy41NzQyLDYuMTg0NzkgLTI2LjgyMTA3LDQuNTQyNDcgLTM1LjgwMjI5LC00LjQzODc1IGwgLTguMTg5NDQsLTguMTg5NDQgLTYuNjA5ODIsOC40MDMwMyBjIC0zLjYzNTM5LDQuNjIxNjYgLTEyLjA0OTUyLDExLjgzNjk4IC0xOC42OTgwNSwxNi4wMzM5OCAtOC4yMjk2NSw1LjE5NTE4IC0xOC40MTc0MSwxNy44NzE4MiAtMzEuOTE2NCwzOS43MTM2MSAtMTAuOTA1NDksMTcuNjQ1NDYgLTE5LjgyODE2LDMyLjk4MDQyIC0xOS44MjgxNiwzNC4wNzc3NiAwLDEuMDk3MyA4LjM2MjU1LC0xLjUyNzM2IDE4LjU4MzQyLC01LjgzMjU5IDEwLjIyMDg5LC00LjMwNTIxIDQyLjU4MDI4LC0xNy4xNTA4NyA3MS45MDk3NywtMjguNTQ1OTMgeiBtIDI0OC43NjcyOSwtMTIuMjU4NDYgYyAyMi4yNTU1NywtMTIuNTA4MzMgMjcuNDE0MjQsLTM1LjY0ODA4IDE3LjU3Njg1LC03OC44NDMxOCAtOC4yMjE0LC0zNi4wOTk2MSAtMTIuMzI1NSwtNDcuOTEzMjcgLTE3LjE5NDk0LC00OS40OTU5NyAtMy4zNjkwMiwtMS4wOTUwMyAtMy44ODY3NCwwLjEwNjk5IC0xLjk4ODU4LDQuNjE2MzUgMTIuMzE1MTYsMjkuMjU3NzEgMTIuOTk5NjMsNDMuOTQ2NjIgMi4yNDAyMiw0OC4wNzU0MSAtNy4zOTE1MSwyLjgzNjQyIC0xNS4yMzIzOSwtNy43OTA3NSAtMjEuMzk5MDIsLTI5LjAwMzI2IC00Ljc3NTEyLC0xNi40MjU4NyAtOS43Njg2MSwtMjMuODI4MzcgLTEzLjUzMzg3LC0yMC4wNjMxMSAtMC45MDE1NywwLjkwMTYgMC42Nzg0OCw2LjEyMTE3IDMuNTExMjQsMTEuNTk5MTMgMi44MzI3Myw1LjQ3NzkgNi43MTcyMSwyMS45NzQ1NSA4LjYzMjE3LDM2LjY1OTIgMS45MTQ5NywxNC42ODQ2MiA1LjYxMzg1LDMwLjA2MDczIDguMjE5NzMsMzQuMTY5MTIgNi43NzE5OCwxMC42NzY2MSAxNy41NTEyOCw4LjEwMzYgMjQuNTIzODIsLTUuODUzODQgNi44OTM3MywtMTMuNzk5NzUgNy42NzI4NCwtNC42MDc4MSAwLjk2OTMsMTEuNDM2MDIgLTYuOTYwNzQsMTYuNjU5MzcgLTI3LjYzNDQyLDIxLjY1NDgxIC01MS41ODQxOCwxMi40NjQ0MiAtMy44MzMzLC0xLjQ3MDk2IC01LjEzMDM5LDAuMDUxNSAtNS4xMzAzOSw2LjAyMDk3IDAsNC4zOTQzMSAtMi45MzYxOCwxMS43MjI0NSAtNi41MjQ4OCwxNi4yODQ3IGwgLTYuNTI0ODgsOC4yOTUwNiA4Ljk0ODgxLDEuNTExMjMgYyAxNS40NDk0NSwyLjYwOTA5IDM2LjYzMzI4LC0wLjc3NjQyIDQ5LjI1ODYsLTcuODcyMjUgeiBtIC0zMjAuMzY2NSwtMjcuNTM3MzMgYyA0Ni40NTk2NSwtMTMuMzU0NSA1NC43NjE4OCwtMjguOTMwOTMgMzkuMzI4ODUsLTczLjc4NzgyIC0zLjU4MTg1LC0xMC40MTA3OSAtNi41MTI0MywtMjEuNjA5NzEgLTYuNTEyNDMsLTI0Ljg4NjU0IDAsLTExLjE1NzEyIC01LjYxMTUyLC02LjAwMTYxIC05LjgxNzEzLDkuMDE5NDMgLTUuNTYyMDMsMTkuODY1NjEgLTIyLjI5MTE1LDM2Ljc1MDUzIC0zNi4zNDUxNiwzNi42ODM2NCAtMTIuMjA1NDcsLTAuMDU4MiAtMTYuMTgyNTEsLTIuMjgwMDggLTIxLjIyMzc4LC0xMS44NTc2OCAtOS4wNDc0OCwtMTcuMTg4ODIgMC44MTQ2OSwtNDMuNTY3OTcgMjUuOTY5NTQsLTY5LjQ2MjcyIDE4LjQyNDMxLC0xOC45NjYzMDQgMjguNDg4OTMsLTIwLjY4Mzk2NSAyOC40ODg5MywtNC44NjIwNSAwLDI0LjY3MzIgLTE3LjAxMTM0LDYwLjk5NDcgLTI1Ljk3MzA5LDU1LjQ1NjA0IC00LjM4MjA1LC0yLjcwODI2IC0zLjY3MTM4LC0xNC42Njc1MiAxLjQxNzIyLC0yMy44NTAwOSA0LjMyNzM1LC03LjgwODgyIDMuNDQ4MTQsLTE5LjcwNzcxIC0xLjQ1NjIsLTE5LjcwNzcxIC01LjY4Njg5LDAgLTE2Ljk0NTQ3LDIwLjcxMTk2IC0xOC40MzMxOCwzMy45MTA3NCAtMS4zMTUxNSwxMS42NjgyNiAtMC40OTI4NiwxNC41MDU0NSA1LjA2NjUyLDE3LjQ4MDcyIDE5LjQ4MjQ0LDEwLjQyNjcgNDUuMDA1MzEsLTIxLjM5NTQ1IDQ2LjI5MDgzLC01Ny43MTU4NCAwLjY3NTA0LC0xOS4wNzMxODEgLTMuMDE2NzYsLTI0LjQ0MTEwNSAtMTQuNzc5MDYsLTIxLjQ4ODk1MSAtMTcuMTE4NzksNC4yOTY1NDMgLTYzLjIzNDgzLDYzLjc4NjY0MSAtNjMuMjM0ODMsODEuNTczNDYxIDAsMTMuOTEyOCA2Ljk4NzM3LDIzLjY5NzI4IDE5LjI4ODI3LDI3LjAwOTYgMjAuOTE0MTksNS42MzE2MiA0MS4xMzUzOSwtNC4zNzM4OSA1NS40NjMzLC0yNy40NDMzOCBsIDYuMDIxNzUsLTkuNjk1NzEgMC4wMTMyLDEzLjE3MjIzIGMgMC4wMTYyLDE5LjA3MzggLTEyLjQyNjE5LDI5LjEyNzQgLTUxLjY5ODE3LDQxLjc2NzkzIC05Ljc3NjQ5LDMuMTQ2OCAtMTguMTgzMzIsNi4wNTQ0MSAtMTguNjgxOCw2LjQ2MTM3IC0xLjgyMDU2LDEuNDg2MzIgMTYuNjg3MzksMjcuNDc1NzEgMTkuNTY2NDQsMjcuNDc1NzEgMS42MzI2MiwwIDExLjE5MTE1LC0yLjM2MzU5IDIxLjI0MTIzLC01LjI1MjM4IHogTSA0NzYuNDExLDIxNy45NjMwMSBjIDQuNjYzNDcsLTUuMTUzMSA1LjQ4NTUxLC0xMC43NTEwMyA0LjQ4NTc5LC0zMC41NDgyMyAtMS4wODczOSwtMjEuNTMzMzEgLTIuMjc3NDYsLTI1LjMzODUxIC0xMC42NjE0MywtMzQuMDg5NDkgLTE1LjE0ODgyLC0xNS44MTE5NCAtMzMuODYxMjMsLTExLjc3ODI4IC0yMi45MDgxOSw0LjkzODE0IDUuODIyNTYsOC44ODYzNyAxMi45MjU0LDcuMzY4NjQgMTAuNDE2NDEsLTIuMjI1ODEgLTEuOTk4NjQsLTcuNjQyNzYgMS43Mjk5OCwtNy44NDM1OCA4LjIyODM5LC0wLjQ0MzIyIDEyLjE5MzAxLDEzLjg4NTM3IDkuMTE1MzQsMzMuMTI2OTggLTUuMjk4NiwzMy4xMjY5OCAtOS44NjcxNiwwIC0xMi45NDE5NSwtNC4yMzE3NiAtMTkuMzczNTMsLTI2LjY2MzE4IC0yLjkzMDU5LC0xMC4yMjA4NyAtNi40OTk2NCwtMTguNTgzNDMgLTcuOTMxMjcsLTE4LjU4MzQzIC00Ljc2ODk5LDAgLTYuODkyODcsNC4yMDg3OCAtMy45MjcyMSw3Ljc4MjQgMS42MTA4OCwxLjk0MTEgNi4wNzIxOCwxNS44OTEyNyA5LjkxNDA0LDMxLjAwMDQxIDkuNjY5MDMsMzguMDI1OTYgMjMuMTc2NjYsNTEuMDQxNDUgMzcuMDU1NiwzNS43MDU0MyB6IG0gLTE4My43NzEyNSwwLjYwMzk1IGMgMS45ODk3OCwtMS4zMzUgMi44OTk3NSwtNy42NDg5MyAyLjA3ODY1LC0xNC40MjMgLTEuMzI0NDksLTEwLjkyNzAyIC0yLjA2NjYyLC0xMS43MjQxIC03Ljk3MjcsLTguNTYzMjcgLTguNDg3MzMsNC41NDIyNyAtMTcuNjA4MzksLTQuMDYzNTEgLTIwLjcwMjIyLC0xOS41MzI2IC0yLjM0NzA3LC0xMS43MzUzOCAtMy4wNjUyNiwtMTEuNTA0ODkgMTQuMDI1NzYsLTQuNTAxNDkgMi4xNDI4OCwwLjg3ODA4IDcuNTk2NzEsLTIuMTA0MDIgMTIuMTE5NjMsLTYuNjI2OTQgOC4yNzQwOCwtOC4yNzQwOCAxMC45OTgwMiwtMTguMjEyOTkgNC45OTE1NiwtMTguMjEyOTkgLTEuNzc3NTQsMCAtMy4yMzE5LDEuNDU0MzYgLTMuMjMxOSwzLjIzMTkgMCw0LjY0OTIzIC04Ljg0MjMxLDMuOTg5ODIgLTEwLjgzNDY1LC0wLjgwNzk3IC0xLjE2MjI0LC0yLjc5ODc5IC0zLjYzODA3LC0xLjgwNTkxIC04LjA1OTE1LDMuMjMxOSAtMy41MDk4NSwzLjk5OTQ4IC03Ljc5NjczLDcuMjcxNzggLTkuNTI2NDEsNy4yNzE3OCAtMS43Mjk2OSwwIC00LjA2NTYsLTMuMjcyMyAtNS4xOTA4OCwtNy4yNzE3OCAtMS45NzE5NSwtNy4wMDg1NiAtMi4yMTM2NiwtNy4wNTI3NyAtNi42NzczNywtMS4yMjE2OSAtMy45MTA2LDUuMTA4NTQgLTMuOTQ1NTcsNi43MzU4MyAtMC4yMjQ2MSwxMC40NTY2MSAzLjk0MDYyLDMuOTQwNjQgMTEuNDI2MTUsMzAuODcxMDIgMTEuNDI2MTUsNDEuMTA3NDQgMCwxMi43Mjg2NyAxNy41MjkzMywyMi43MzgzMiAyNy43NzgzLDE1Ljg2MjEgeiBtIDU4Ljk0MzA5LC0xNi44NzUzMSBjIDEyLjE0NTY3LC0xMi4xNDU2NyAxNS43NDQ1MiwtMzAuMzUxNDMgOS4xMjk0MywtNDYuMTgzNTcgLTUuMTcwMTYsLTEyLjM3Mzk3IC0xNC4xNDQ2NiwtMTcuMDA1MTYgLTI2Ljc5ODc4LC0xMy44MjkxOCAtOS40MDI2MywyLjM1OTkxIC0yMy43MjMxMSwyOS43NzY1OSAtMjMuNzczODcsNDUuNTE1MzYgLTAuMDc5MiwyNC41MjkwMiAyMy4yNTA1MywzMi42OTAwNSA0MS40NDMyMiwxNC40OTczOSB6IG0gLTIyLjA4MzQxLC0xOS40MzQwNyBjIC0zLjU1NTEsLTMuNTU1MSAtNi40MTc1NSwtMTAuNDYzMjggLTYuMzYxMDIsLTE1LjM1MTUzIDAuMDkzNCwtOC4wNzk2NSAwLjQ5MzE1LC04LjM3MzUgNC4zOTYxOSwtMy4yMzE5IDQuODI0NjQsNi4zNTU2OSAxMy4zOTc5Nyw3LjQ1NjY2IDE2LjY4MjQxLDIuMTQyMzIgMS4xOTQzMiwtMS45MzI0MSAwLjU1Mjk1LC01LjEzMjAyIC0xLjQyNTIsLTcuMTEwMTcgLTUuMDgxMzIsLTUuMDgxMzIgLTQuNDY1NjEsLTExLjk5OTYzIDEuMDY3OTIsLTExLjk5OTYzIDYuMTUxMzcsMCAxNC43MjY3OSwxMi41MTQ3NyAxNC43MjY3OSwyMS40OTE5MSAwLDYuNjA2NzQgLTEzLjQ0NDQsMjAuNTIyOCAtMTkuODI3MjQsMjAuNTIyOCAtMS41Mzc4NSwwIC01LjcwNDc2LC0yLjkwODcyIC05LjI1OTg1LC02LjQ2MzggeiBtIDg2LjM0ODk3LDE4LjU4MzQxIGMgMTMuNDEwNzQsLTE0LjYwMjYzIDEyLjEwMzc2LC0zNy4wOTggLTMuMDk4MjUsLTUzLjMyNjM0IC03Ljg1MDU3LC04LjM4MDYgLTI1LjI5Mjk4LC05LjgyNTUyIC0zMi40MzE4NSwtMi42ODY2NCAtNi41ODc2MSw2LjU4NzYxIC0xMy4xNjQ2NSwzMi40OTMwMyAtMTAuNzIxMjIsNDIuMjI4NDEgNS4yMTEyMiwyMC43NjMxOCAzMi40MDA0MSwyOC44NjY1MiA0Ni4yNTEzMiwxMy43ODQ1NyB6IG0gLTI3LjQ1NTY1LC0yMy42MTQ1MiBjIC01LjMwNjIzLC0zLjcxNjY0IC03LjEyOTQxLC04LjE0OTc0IC02Ljk3ODA2LC0xNi45Njc0NyAwLjE2OTM1LC05Ljg2MDMzIDAuNjg0MywtMTAuNzQ5ODEgMi45NjE0NSwtNS4xMTQxNSAzLjM0NTczLDguMjgwMzIgMTAuMzYyOTIsMTEuNDA3MzQgMTYuNTE4MTQsNy4zNjA5IDMuODE3NTMsLTIuNTA5NjMgMy42MzkyOSwtMy42OTU5NyAtMS4xMDEwNCwtNy4zMjkwNyAtNi4zMjE4OSwtNC44NDUyMyAtNy41NTUwOCwtMTEuNzAxOTEgLTIuMTA0NjUsLTExLjcwMTkxIDQuODczNjQsMCAyMi4zMDQwMiwxOS4wNjY2NiAyMi4zMDQwMiwyNC4zOTc3OCAwLDUuMjAzMTYgLTEyLjM3NzM5LDE0LjM4NTAzIC0xOS4zOTEzOSwxNC4zODUwMyAtMi43NjQwNSwwIC04LjI1NzksLTIuMjY0MDIgLTEyLjIwODQ3LC01LjAzMTExIHogbSAxODkuOTYyOTIsLTE0LjI4ODg3IDMzLjkzNDk1LC0xMi43MzY4MiAtMzYuMzU4ODgsLTAuMTMxMjUgYyAtMzIuNTM5MiwtMC4xMTczNiAtMzYuMzU0MjQsMC40NjMwNyAtMzYuMzE0NzUsNS41MjQ3NSAwLjA0MDEsNS4xMjc1NyAzLjMzMDczLDIwLjI4Mzk1IDQuMzcyNywyMC4xMzk2NyAwLjIzNzIyLC0wLjAzMjkgMTUuNzAxNzcsLTUuNzkxMjQgMzQuMzY1OTgsLTEyLjc5NjQ4IHogbSAtNDQzLjQ5MzQzLC0yLjI3OTMgMy40NjgyNSwtMTAuMjg3NjEgLTMwLjQ2Njg2LC0xLjAyNDA0IGMgLTE2Ljc1Njc0NCwtMC41NjMyMiAtMzAuNDYzNTg0LC0wLjEzMjEzIC0zMC40NTk1OCwwLjk1ODA0IDAuMDA1OCwxLjU5NTEzIDUyLjUwNjU3LDIyLjEwNzA3IDUzLjY2MTc0LDIwLjk2NTUyIDAuMTgwMzUsLTAuMTc4NCAxLjg4ODkyLC00Ljk1MzcyIDMuNzk2NDUsLTEwLjYxMTkxIHogbSAyMDguOTA5MiwtMzEuODg2OTUgYyA3LjE2NjY3LDEuMTQ2IDE1LjI0OTgxLDQuMDc5MjQgMTcuOTYyNTYsNi41MTgzNSA0LjIxMjc5LDMuNzg3ODMgNi4wNDUyOCwzLjUyOTY2IDEyLjU2MjA3LC0xLjc2OTg1IDQuMTk2NDMsLTMuNDEyNSA5LjY1MDI2LC02LjIwNDU3IDEyLjExOTYzLC02LjIwNDU3IDIuNDY5MzksMCA0LjQ4OTgyLC0wLjcxMzA4IDQuNDg5ODIsLTEuNTg0NjcgMCwtMy4wMDkxOCAtNDYuNTM5NTQsLTc5LjIxMjUyIC00OC4zMTQ0NywtNzkuMTA5NjEgLTIuMDg1LDAuMTIwODcyIC00OS43ODYwMyw4MC4wODc5OCAtNTEuMjU0NjQsODUuOTI0MzcgLTAuNjE2MzQsMi40NDk1MiAxLjMxODA0LDMuMzUzNzEgNS4wNzM2NCwyLjM3MTYgMy4zMzgzNiwtMC44NzMgNy45NTQxNiwwLjY4MzI2IDEwLjI1NzI3LDMuNDU4MzYgMy43MzU0LDQuNTAwODcgNS4yNjEwOCw0LjE0MjI5IDE0LjEzMDY4LC0zLjMyMDk3IDguNDI2NDcsLTcuMDkwNDEgMTEuOTMwOCwtOC4wNDg4IDIyLjk3MzQ0LC02LjI4MzAxIHoiDQogICAgICAgc3R5bGU9ImZpbGw6IzMzMzMzMztmaWxsLW9wYWNpdHk6MSIgLz4NCiAgICA8cGF0aA0KICAgICAgIHN0eWxlPSJmaWxsOiM2Mzk4YWE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiDQogICAgICAgZD0ibSAzMDkuNTQ1NzksMTQwLjg3OTIyIGMgLTAuNTAwNzUsLTAuMjMzMTEgLTEuMTE4MDQsLTAuNzY3OTkgLTIuNTI3OCwtMi4xOTAzNSAtMS45MTE4OCwtMS45Mjg5NyAtMi42NzE4OCwtMi40OTAxMyAtNC4yNjEwOCwtMy4xNDYyOCAtMi4wODc5MSwtMC44NjIwNCAtNC4zNTQ5LC0xLjA5NDIzIC02LjQ4MjMxLC0wLjY2MzkxIC0xLjg5ODA4LDAuMzgzOTMgLTIuNDI0MzUsMC40MjUyNyAtMy4yODI0MiwwLjI1NzggLTEuNDMyMjQsLTAuMjc5NTMgLTEuOTQxNTcsLTEuMTQ5MjkgLTEuNTM1ODMsLTIuNjIyNzIgMC41MDU3MywtMS44MzY1NyA0LjMzNjkzLC04Ljk0MjU1IDEyLjAwODk5LC0yMi4yNzM4NyAxNS41ODM3LC0yNy4wNzg5ODggMzYuNTM2MjQsLTYxLjIyMDk2OCAzOC44NTA1NiwtNjMuMzA2NjYyIDAuMjU2MzEsLTAuMjMwOTk0IDAuMjY1LC0wLjIzMDk5NCAwLjUyMjQ4LDAgMS4zNzc2OCwxLjIzNTk3NiA5LjQ3NjIsMTMuNzI1ODg5IDIwLjU0MDM2LDMxLjY3ODI5OCAxNC45NjY5NiwyNC4yODUwMDQgMjcuNDExMDIsNDUuNjQzNzE0IDI3LjQxMTAyLDQ3LjA0NzcwNCAwLDAuODU3MjkgLTEuMzE2MDgsMS4zNzIxNSAtNC4wODU5MSwxLjU5ODQ1IC0zLjQ0MjI2LDAuMjgxMjQgLTcuNDI0NzgsMi4zMDE4OCAtMTIuODY4ODcsNi41MjkzNiAtMi41ODcxMiwyLjAwODk4IC0zLjY5MTI2LDIuNzU5MzMgLTQuOTUwNjIsMy4zNjQzOCAtMS4wNDkyOCwwLjUwNDExIC0xLjEzNjkyLDAuNTI0MzcgLTIuMjY4NTQsMC41MjQzNyAtMS4xMTM2OCwwIC0xLjIyNjYxLC0wLjAyNDkgLTIuMDk2MjMsLTAuNDYxMjggLTAuNTEyMTMsLTAuMjU3MDIgLTEuNTA0NjksLTAuOTQ5MyAtMi4yNDE1NSwtMS41NjM0MiAtMi4xNzg0OCwtMS44MTU2MSAtNC43OTkxOCwtMy4xMzYxNCAtOS4wNzE5NywtNC41NzEyNCAtNS40Mjk5NywtMS44MjM3NiAtMTEuMjQ0NTQsLTIuOTE4NCAtMTYuMTk1NTEsLTMuMDQ4OTYgLTMuOTA5MzQsLTAuMTAzMDggLTUuNzEyMDEsMC4yNDc5OCAtOC42NzYwMiwxLjY4OTYzIC0yLjQxOTg4LDEuMTc2OTggLTMuNTg2MjEsMi4wMTMxMSAtOS4xMjQ3NSw2LjU0MTQ1IC01LjYzMzc2LDQuNjA2MTcgLTcuNjM0NDIsNS41NjIwNSAtOS42NjQsNC42MTcyNSB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDEyOC42Mzc4NiwxNzAuNzM5IGMgLTEwLjE1OSwtMi45NjA3IC00NS41MDMxNzEsLTE2LjkxOTYyIC01MC40NTA5MjQsLTE5LjkyNTIzIC0wLjY4MjkxNiwtMC40MTQ4NCAtMC43MzgwOTgsLTAuNDc3ODcgLTAuNTQzMjA3LC0wLjYyMDM4IDEuMTMxNTYzLC0wLjgyNzQxIDEyLjMzNzk4MywtMS4yMzkwMSAyNS4wMDQwMzEsLTAuOTE4MzYgNS4wNTEzMSwwLjEyNzg4IDM1LjUwMTMyLDEuMTMzMjMgMzUuNTUwOSwxLjE3Mzc3IDAuMDk5NywwLjA4MTUgLTYuNTIxNjQsMTkuMjg4OCAtNy4wMzA1MSwyMC4zOTQzMyAtMC4yMTI1MSwwLjQ2MTcgLTAuNjUwNjMsMC40NDM2NyAtMi41MzAyOSwtMC4xMDQxMyB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDU0My42OTQxMywxNzUuMzEwNTUgYyAtMS4zODYyLC0yLjcxMjg3IC0zLjg4NzY5LC0xNC45NzA2NyAtMy45NjA3OCwtMTkuNDA4NTggLTAuMDI4NCwtMS43MjQyNCAwLjE4NjY3LC0yLjQyNzQxIDAuOTYwNiwtMy4xNDA4IDEuNzczNzgsLTEuNjM1MDEgNS4zNzkzOCwtMi4yMjMyIDE1LjI5MDE3LC0yLjQ5NDM0IDUuMDAzNDcsLTAuMTM2ODkgMjguMTAxOSwtMC4xNTc5NiA0NC40MTEyNywtMC4wNDA1IGwgMTEuNDI4NTksMC4wODIzIC0yNy41MTc3LDEwLjMxNDI3IGMgLTI1LjA5MjkyLDkuNDA1NCAtMzkuNjg0NzMsMTQuODQxMjYgLTQwLjIyNDkxLDE0Ljk4NDkgLTAuMTM1MTcsMC4wMzYgLTAuMjY5ODEsLTAuMDY3NCAtMC4zODcyNCwtMC4yOTcyMyBsIDAsMCB6IiAvPg0KICAgIDxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzYzOThhYTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSINCiAgICAgICBkPSJtIDE3OC4wODgzNSwzMTUuNTE0MzMgYyAwLC0wLjc3MDc4IDMuMjY4OSwtNi41MzMxIDExLjU1Mzk1LC0yMC4zNjY5OCAxOS44NTExOCwtMzMuMTQ2MzEgMjguOTI3MTUsLTQ1LjE2MDEyIDQwLjA3MjkyLC01My4wNDQyOSA5Ljk3MTI3LC03LjA1MzM3IDE1LjMwMjc5LC0xMS45Mjk0IDIxLjI0NTM5LC0xOS40MzAzMyBsIDMuNjY0MDksLTQuNjI0OTIgNC45Mzk5LDQuODU2NTIgYyA4LjY0Nzg0LDguNTAxODkgMTMuODYxMywxMC45NjY2OCAyMy4yOTcxNywxMS4wMTQzMiAxMS41NDA1OCwwLjA1ODMgMjQuMTc4NDksLTYuMzg4MSAyNC4xNzg0OSwtMTIuMzMyOTkgMCwtMS4zMzk4IDAuOTU0MDQsLTIuNzIyMzYgMS44Nzg1NywtMi43MjIzNiAwLjM5MTMyLDAgMi42MTY4NiwwLjY4MzY1IDQuOTQ1NjUsMS41MTkyMyA2LjA2OTkyLDIuMTc3OSA5LjYzMDI4LDIuOTY1NDggMTQuNjA5MTIsMy4yMzE2NSA0LjkzOTk4LDAuMjY0MDkgOC41NDg0OCwtMC4xNzA0IDEzLjM1ODE3LC0xLjYwODQxIDQuNzI1NjEsLTEuNDEyODggNy40NDcwOSwtMi44NTkwNSAxNS41OTgzMywtOC4yODg4MiA0LjEwNzYsLTIuNzM2MTggNy41OTk1NCwtNC45NzQ4NyA3Ljc1OTg4LC00Ljk3NDg3IDAuMTYwMzMsMCAzLjEyNTM0LDEuNzE4OTYgNi41ODg5LDMuODE5OTEgMy40NjM1NiwyLjEwMDk1IDcuNjI1NDIsNC4zODEzMyA5LjI0ODU5LDUuMDY3NTEgMTEuMDY4NjIsNC42NzkxOCAyMy4wMjQ0NSw0LjM3MzkgMzMuOTcxMjYsLTAuODY3NDEgMS45NTc5NSwtMC45Mzc0NyA2LjU2NzkzLC0zLjczMDc0IDEwLjI0NDQsLTYuMjA3MjcgMy42NzY0OCwtMi40NzY1MyA2LjczNjEzLC00LjQ0NTc2IDYuNzk5MjMsLTQuMzc2MDYgMC4wNjMxLDAuMDY5NyAxLjQ1NjA1LDIuOTIwOCAzLjA5NTQ0LDYuMzM1NzggMS42Mzk0LDMuNDE0OTggMy42OTg5NSw3LjI2NjcgNC41NzY3OSw4LjU1OTM3IDMuODAwMDEsNS41OTU3OCA4LjE3NTg4LDkuNzUxNDEgMTQuMDgzNDMsMTMuMzc0NjQgNi4wODEyMiwzLjcyOTc1IDkuODMyMDYsOC42ODY4IDEwLjIxODgyLDEzLjUwNTA3IDAuMzgzNjcsNC43Nzk2OCAtMS43MDMyOSw5LjAxOTM5IC03LjcyMTg5LDE1LjY4NzIxIC00LjY5NzQ3LDUuMjA0MTkgLTUuODczMyw3LjIzNTQgLTUuODYxMTMsMTAuMTI0OTEgMC4wMTIyLDIuODkyNjIgMS43MDEwMyw2LjIyODU0IDQuNjY5NjQsOS4yMjM3OSA0LjgwNTMzLDQuODQ4NDQgMTIuMzQ2MDUsNi4yODc3NyAyMy40MzUzNCw0LjQ3MzE5IDIuNDc0MDgsLTAuNDA0ODQgNS41OTQ3OSwtMC43Mzc1NyA2LjkzNDkxLC0wLjczOTM4IDQuMjg1NTEsLTAuMDA2IDYuOTAzMTksMi4wOTU5NSAxMS44OTI1MSw5LjU0ODU5IDMuNDQzNTEsNS4xNDM2NSAxMC45NzM5NiwxNy43NTUwOCAxMC45NzM5NiwxOC4zNzgzNiAwLDAuMzI0MDcgLTAuMzUxNDUsMC41NTIwOCAtMC44NTA5NywwLjU1MjA4IC0xLjA1MTA5LDAgLTUuNjIzMTQsLTEuMjQzOCAtOC45MzIxNCwtMi40Mjk5NCAtNC4zNDg1LC0xLjU1ODc1IC01Ny4yNzIzOCwtMjIuMDA1MjYgLTc0Ljc0Nzg2LC0yOC44Nzc5NSAtNDYuNjYzNSwtMTguMzUxNjIgLTYyLjAyODA1LC0yNC4yMTI0NiAtNjkuNTM2NTcsLTI2LjUyNDg5IC04LjExNDE3LC0yLjQ5ODk1IC0xMy42NDAyOSwtMy4wODUyMiAtMTguMTI2NjEsLTEuOTIzMDYgLTUuNTc5OTYsMS40NDU0NiAtODEuNzIwNjcsMzAuODY4ODggLTEyNi4xMzI0NSw0OC43NDE5NSAtMjEuOTMxMTksOC44MjYgLTI0LjY3NzQ5LDkuODc1NzcgLTI4Ljc4MTE2LDExLjAwMTU5IC0zLjI2MzAzLDAuODk1MjEgLTMuMTQ0MDcsMC44ODI5NCAtMy4xNDQwNywwLjMyNDI2IHoiIC8+DQogIDwvZz4NCjwvc3ZnPg==');
    background-position: 16px 80%;
    background-repeat: no-repeat;
    background-size: 20px 12px;
    padding-left: 2.5em;
}

.multi-language-selector .language-option[data-lang='kotlin'],
.exampleblock[data-lang=kotlin] > .content .title {
    background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA2MCA2MCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjAgNjA7Ij4NCjxnPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iWE1MSURfM18iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUuOTU5NCIgeTE9Ii0xMy4wMTQzIiB4Mj0iNDQuMzA2OCIgeTI9IjE1LjMzMzIiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPg0KCQk8c3RvcCAgb2Zmc2V0PSI5LjY3NzAwMGUtMDIiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDk1RDUiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC4zMDA3IiBzdHlsZT0ic3RvcC1jb2xvcjojMjM4QUQ5Ii8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNjIxMSIgc3R5bGU9InN0b3AtY29sb3I6IzU1N0JERSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjg2NDMiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NDcyRTIiLz4NCgkJPHN0b3AgIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6IzgwNkVFMyIvPg0KCTwvbGluZWFyR3JhZGllbnQ+DQoJPHBvbHlnb24gaWQ9IlhNTElEXzJfIiBzdHlsZT0iZmlsbDp1cmwoI1hNTElEXzNfKTsiIHBvaW50cz0iMCw2MCAzMC4xLDI5LjkgNjAsNjAgCSIvPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNC4yMDkyIiB5MT0iNDguOTQwOSIgeDI9IjIwLjY3MzQiIHkyPSI2NS40MDUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjExODMiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDk1RDUiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC40MTc4IiBzdHlsZT0ic3RvcC1jb2xvcjojM0M4M0RDIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNjk2MiIgc3R5bGU9InN0b3AtY29sb3I6IzZENzRFMSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjgzMzMiIHN0eWxlPSJzdG9wLWNvbG9yOiM4MDZFRTMiLz4NCgk8L2xpbmVhckdyYWRpZW50Pg0KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOnVybCgjU1ZHSURfMV8pOyIgcG9pbnRzPSIwLDAgMzAuMSwwIDAsMzIuNSAJIi8+DQogICAgPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSItMTAuMTAxNyIgeTE9IjUuODM2MiIgeDI9IjQ1LjczMTUiIHkyPSI2MS42Njk0IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIC0xIDAgNjEpIj4NCgkJPHN0b3AgIG9mZnNldD0iMC4xMDc1IiBzdHlsZT0ic3RvcC1jb2xvcjojQzc1N0JDIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuMjEzOCIgc3R5bGU9InN0b3AtY29sb3I6I0QwNjA5QSIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIwLjQyNTQiIHN0eWxlPSJzdG9wLWNvbG9yOiNFMTcyNUMiLz4NCgkJPHN0b3AgIG9mZnNldD0iMC42MDQ4IiBzdHlsZT0ic3RvcC1jb2xvcjojRUU3RTJGIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuNzQzIiBzdHlsZT0ic3RvcC1jb2xvcjojRjU4NjEzIi8+DQoJCTxzdG9wICBvZmZzZXQ9IjAuODIzMiIgc3R5bGU9InN0b3AtY29sb3I6I0Y4ODkwOSIvPg0KCTwvbGluZWFyR3JhZGllbnQ+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6dXJsKCNTVkdJRF8yXyk7IiBwb2ludHM9IjMwLjEsMCAwLDMxLjcgMCw2MCAzMC4xLDI5LjkgNjAsMCAJIi8+DQo8L2c+DQo8L3N2Zz4=');
    background-position: 17px 80%;
    background-repeat: no-repeat;
    background-size: 11px 11px;
    padding-left: 2.3em;
}

.multi-language-selector {
    display: block;
}

.multi-language-selector .language-option[data-lang='groovy'] {
    background-position: 20px center;
    padding-left: 32px;
}

.multi-language-selector .language-option[data-lang='kotlin'] {
    background-position: 30px center;
    padding-left: 27px;
}

.multi-language-selector .language-option {
    background-color: white;
    border: 1px solid #f7f7f8;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    display: inline-block;
    font-weight: normal;
    font-family: 'Lato', Arial, sans-serif;
    margin: 0;
    padding: 4px 20px;
    min-width: 130px;
    max-width: 320px;
    text-align: center;
    filter: grayscale(1);
    -webkit-filter: grayscale(1);
    opacity: 0.7;
}

.multi-language-selector .language-option.selected {
    background-color: #f7f7f8;
    color: #02303a;
    filter: none;
    -webkit-filter: none;
    opacity: 1;
}

.multi-language-text.hidden,
.multi-language-selector ~ .multi-language-sample.hidden {
    display: none;
}

.multi-language-sample {
    border-radius: 0 0 4px 4px;
}
</style><script type="text/javascript">function postProcessCodeBlocks() {
    // Assumptions:
    //  1) All siblings that are marked with class="multi-language-sample" should be grouped
    //  2) Only one language can be selected per domain (to allow selection to persist across all docs pages)
    //  3) There is exactly 1 small set of languages to choose from. This does not allow for multiple language preferences. For example, users cannot prefer both Kotlin and ZSH.
    //  4) Only 1 sample of each language can exist in the same collection.

    var GRADLE_DSLs = ["groovy", "kotlin"];
    var preferredBuildScriptLanguage = initPreferredBuildScriptLanguage();

    // Ensure preferred DSL is valid, defaulting to Groovy DSL
    function initPreferredBuildScriptLanguage() {
        var lang = window.localStorage.getItem("preferred-gradle-dsl");
        if (GRADLE_DSLs.indexOf(lang) === -1) {
            window.localStorage.setItem("preferred-gradle-dsl", "groovy");
            lang = "groovy";
        }
        return lang;
    }

    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }

    function processSampleEl(sampleEl, prefLangId) {
        var codeEl = sampleEl.querySelector("code[data-lang]");
        if (codeEl != null) {
            sampleEl.setAttribute("data-lang", codeEl.getAttribute("data-lang"));
            if (codeEl.getAttribute("data-lang") !== prefLangId) {
                sampleEl.classList.add("hidden");
            } else {
                sampleEl.classList.remove("hidden");
            }
        }
    }

    function switchSampleLanguage(languageId) {
        var multiLanguageSampleElements = [].slice.call(document.querySelectorAll(".multi-language-sample"));

        // Array of Arrays, each top-level array representing a single collection of samples
        var multiLanguageSets = [];
        for (var i = 0; i < multiLanguageSampleElements.length; i++) {
            var currentCollection = [multiLanguageSampleElements[i]];
            var currentSampleElement = multiLanguageSampleElements[i];
            processSampleEl(currentSampleElement, languageId);
            while (currentSampleElement.nextElementSibling != null && currentSampleElement.nextElementSibling.classList.contains("multi-language-sample")) {
                currentCollection.push(currentSampleElement.nextElementSibling);
                currentSampleElement = currentSampleElement.nextElementSibling;
                processSampleEl(currentSampleElement, languageId);
                i++;
            }

            multiLanguageSets.push(currentCollection);
        }

        multiLanguageSets.forEach(function (sampleCollection) {
            // Create selector element if not existing
            if (sampleCollection.length > 1 &&
                (sampleCollection[0].previousElementSibling == null ||
                    !sampleCollection[0].previousElementSibling.classList.contains("multi-language-selector"))) {
                var languageSelectorFragment = document.createDocumentFragment();
                var multiLanguageSelectorElement = document.createElement("div");
                multiLanguageSelectorElement.classList.add("multi-language-selector");
                languageSelectorFragment.appendChild(multiLanguageSelectorElement);


                sampleCollection.forEach(function (sampleEl) {
                    var optionEl = document.createElement("code");
                    var sampleLanguage = sampleEl.getAttribute("data-lang");
                    optionEl.setAttribute("data-lang", sampleLanguage);
                    optionEl.setAttribute("role", "button");
                    optionEl.classList.add("language-option");

                    optionEl.innerText = capitalizeFirstLetter(sampleLanguage);

                    optionEl.addEventListener("click", function updatePreferredLanguage(evt) {
                        var preferredLanguageId = optionEl.getAttribute("data-lang");
                        window.localStorage.setItem("preferred-gradle-dsl", preferredLanguageId);

                        // Record how far down the page the clicked element is before switching all samples
                        var beforeOffset = evt.target.offsetTop;

                        switchSampleLanguage(preferredLanguageId);

                        // Scroll the window to account for content height differences between different sample languages
                        window.scrollBy(0, evt.target.offsetTop - beforeOffset);
                    });
                    multiLanguageSelectorElement.appendChild(optionEl);
                });
                sampleCollection[0].parentNode.insertBefore(languageSelectorFragment, sampleCollection[0]);
            }
        });

        [].slice.call(document.querySelectorAll(".multi-language-selector .language-option")).forEach(function (optionEl) {
            if (optionEl.getAttribute("data-lang") === languageId) {
                optionEl.classList.add("selected");
            } else {
                optionEl.classList.remove("selected");
            }
        });

        [].slice.call(document.querySelectorAll(".multi-language-text")).forEach(function (el) {
            if (!el.classList.contains("lang-" + languageId)) {
                el.classList.add("hidden");
            } else {
                el.classList.remove("hidden");
            }
        });
    }

    switchSampleLanguage(preferredBuildScriptLanguage);
}

document.addEventListener("DOMContentLoaded", function () {
    postProcessCodeBlocks();
});
</script>
</head>
<body class="book">
<header class="site-layout__header site-header" itemscope="itemscope" itemtype="https://schema.org/WPHeader">
    <nav class="site-header__navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
        <div class="site-header__navigation-header">
            <a target="_top" class="logo" href="https://docs.gradle.org" title="Gradle Docs">
                <svg width="139px" height="43px" viewBox="0 0 278 86" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <style>.cls-1 {
                            fill: #02303a;
                        }</style>
                    </defs>
                    <title>Gradle</title>
                    <path class="cls-1"
                          d="M155,56.32V70.27a18.32,18.32,0,0,1-5.59,2.83,21.82,21.82,0,0,1-6.36.89,21.08,21.08,0,0,1-7.64-1.31A17.12,17.12,0,0,1,129.59,69a16.14,16.14,0,0,1-3.73-5.58,18.78,18.78,0,0,1-1.31-7.08,19.58,19.58,0,0,1,1.26-7.14A15.68,15.68,0,0,1,135,40a20.39,20.39,0,0,1,7.45-1.29,22,22,0,0,1,3.92.33,20.43,20.43,0,0,1,3.39.92,15.16,15.16,0,0,1,2.85,1.42A17.3,17.3,0,0,1,155,43.25l-1.84,2.91a1.72,1.72,0,0,1-1.12.84,2,2,0,0,1-1.5-.34L149,45.75a10.49,10.49,0,0,0-1.75-.79,14.33,14.33,0,0,0-2.17-.54,15.29,15.29,0,0,0-2.78-.22,11.91,11.91,0,0,0-4.61.86,9.66,9.66,0,0,0-3.52,2.46,10.9,10.9,0,0,0-2.24,3.84,14.88,14.88,0,0,0-.79,5,15.23,15.23,0,0,0,.85,5.28,11.06,11.06,0,0,0,2.38,3.94A10.15,10.15,0,0,0,138.05,68a14.28,14.28,0,0,0,8.25.44,17.1,17.1,0,0,0,2.94-1.09V61.14h-4.35a1.3,1.3,0,0,1-1-.35,1.15,1.15,0,0,1-.35-.85V56.32Zm10.47-2.93a10.53,10.53,0,0,1,2.72-3.45,5.77,5.77,0,0,1,3.72-1.25,4.5,4.5,0,0,1,2.72.74l-.38,4.41a1.18,1.18,0,0,1-.34.61,1,1,0,0,1-.61.18,6.76,6.76,0,0,1-1.06-.12,8.22,8.22,0,0,0-1.38-.12,5,5,0,0,0-1.74.28,4.37,4.37,0,0,0-1.37.83,5.55,5.55,0,0,0-1.07,1.3,12.26,12.26,0,0,0-.87,1.74V73.61H160V49.14h3.45a1.94,1.94,0,0,1,1.27.32,1.9,1.9,0,0,1,.48,1.16Zm11.36-.84A14.49,14.49,0,0,1,187,48.69a9.92,9.92,0,0,1,3.84.7,8.06,8.06,0,0,1,2.86,2,8.38,8.38,0,0,1,1.78,3,11.64,11.64,0,0,1,.61,3.82V73.61h-2.68a2.64,2.64,0,0,1-1.28-.25,1.72,1.72,0,0,1-.72-1l-.52-1.77a20.25,20.25,0,0,1-1.82,1.47,10.86,10.86,0,0,1-1.83,1.06,10.36,10.36,0,0,1-2,.66,12,12,0,0,1-2.4.22,9.64,9.64,0,0,1-2.86-.41,6.28,6.28,0,0,1-2.27-1.26,5.6,5.6,0,0,1-1.48-2.07,7.38,7.38,0,0,1-.52-2.89,5.7,5.7,0,0,1,.31-1.85,5.3,5.3,0,0,1,1-1.75,8.25,8.25,0,0,1,1.83-1.57,11.17,11.17,0,0,1,2.75-1.29,23.28,23.28,0,0,1,3.81-.9,36.77,36.77,0,0,1,5-.41V58.16a5.35,5.35,0,0,0-1.05-3.64,3.83,3.83,0,0,0-3-1.18,7.3,7.3,0,0,0-2.38.33,9.39,9.39,0,0,0-1.65.75l-1.3.75a2.52,2.52,0,0,1-1.3.34,1.7,1.7,0,0,1-1.05-.32,2.61,2.61,0,0,1-.69-.76Zm13.5,10.61a31.66,31.66,0,0,0-4.3.45,11,11,0,0,0-2.79.82,3.57,3.57,0,0,0-1.5,1.17,2.89,2.89,0,0,0,.47,3.67,3.93,3.93,0,0,0,2.39.67,7,7,0,0,0,3.14-.66,9.52,9.52,0,0,0,2.59-2Zm32.53-25V73.61h-3.6a1.39,1.39,0,0,1-1.48-1.07l-.5-2.36a12.4,12.4,0,0,1-3.4,2.74,9.17,9.17,0,0,1-4.47,1,7.95,7.95,0,0,1-6.55-3.26A11.61,11.61,0,0,1,201,66.79a19.71,19.71,0,0,1-.66-5.34,16.77,16.77,0,0,1,.74-5.06,12.21,12.21,0,0,1,2.13-4,9.88,9.88,0,0,1,3.31-2.69,9.64,9.64,0,0,1,4.34-1,8.63,8.63,0,0,1,3.51.64,9,9,0,0,1,2.6,1.74V38.17ZM217,55.39a5.94,5.94,0,0,0-2.18-1.72,6.54,6.54,0,0,0-2.54-.5,5.68,5.68,0,0,0-2.41.5A4.87,4.87,0,0,0,208,55.19a7.19,7.19,0,0,0-1.17,2.57,14.83,14.83,0,0,0-.4,3.69,16.34,16.34,0,0,0,.34,3.63,7.14,7.14,0,0,0,1,2.44,3.79,3.79,0,0,0,1.58,1.36,5,5,0,0,0,2.07.41,6,6,0,0,0,3.13-.76A9.19,9.19,0,0,0,217,66.36Zm17.67-17.22V73.61h-5.89V38.17ZM245.1,62.11a11.37,11.37,0,0,0,.67,3.26,6.54,6.54,0,0,0,1.38,2.27,5.39,5.39,0,0,0,2,1.33,7.26,7.26,0,0,0,2.61.44,8.21,8.21,0,0,0,2.47-.33,11.51,11.51,0,0,0,1.81-.74c.52-.27,1-.52,1.36-.74a2.31,2.31,0,0,1,1.13-.33,1.21,1.21,0,0,1,1.1.55L261.36,70a9.45,9.45,0,0,1-2.19,1.92,12.18,12.18,0,0,1-2.54,1.24,14,14,0,0,1-2.7.66,18.78,18.78,0,0,1-2.65.19,12.93,12.93,0,0,1-4.75-.85,10.65,10.65,0,0,1-3.82-2.5,11.8,11.8,0,0,1-2.55-4.1,15.9,15.9,0,0,1-.93-5.67,13.55,13.55,0,0,1,.81-4.71,11.34,11.34,0,0,1,2.33-3.84,11,11,0,0,1,3.69-2.59,12.31,12.31,0,0,1,4.93-1,11.86,11.86,0,0,1,4.27.74,9.25,9.25,0,0,1,3.36,2.16,9.84,9.84,0,0,1,2.21,3.48,13,13,0,0,1,.8,4.71,3.82,3.82,0,0,1-.29,1.8,1.19,1.19,0,0,1-1.1.46Zm11.23-3.55A7.28,7.28,0,0,0,256,56.4a5.16,5.16,0,0,0-1-1.77,4.44,4.44,0,0,0-1.63-1.21,5.68,5.68,0,0,0-2.3-.44,5.46,5.46,0,0,0-4,1.45,7.13,7.13,0,0,0-1.87,4.13ZM112.26,14a13.72,13.72,0,0,0-19.08-.32,1.27,1.27,0,0,0-.41.93,1.31,1.31,0,0,0,.38.95l1.73,1.73a1.31,1.31,0,0,0,1.71.12,7.78,7.78,0,0,1,4.71-1.57,7.87,7.87,0,0,1,5.57,13.43C96,40.2,81.41,9.66,48.4,25.37a4.48,4.48,0,0,0-2,6.29l5.66,9.79a4.49,4.49,0,0,0,6.07,1.67l.14-.08-.11.08,2.51-1.41a57.72,57.72,0,0,0,7.91-5.89,1.37,1.37,0,0,1,1.8-.06h0a1.29,1.29,0,0,1,0,2A59.79,59.79,0,0,1,62.11,44l-.09.05-2.51,1.4a7,7,0,0,1-3.47.91,7.19,7.19,0,0,1-6.23-3.57l-5.36-9.24C34.17,40.81,27.93,54.8,31.28,72.5a1.31,1.31,0,0,0,1.29,1.06h6.09A1.3,1.3,0,0,0,40,72.42a8.94,8.94,0,0,1,17.73,0A1.3,1.3,0,0,0,59,73.56h5.94a1.31,1.31,0,0,0,1.3-1.14,8.93,8.93,0,0,1,17.72,0,1.3,1.3,0,0,0,1.29,1.14h5.87a1.3,1.3,0,0,0,1.3-1.28c.14-8.28,2.37-17.79,8.74-22.55C123.15,33.25,117.36,19.12,112.26,14ZM89.79,38.92l-4.2-2.11h0a2.64,2.64,0,1,1,4.2,2.12Z"/>
                </svg>
            </a>
            <div class="site-header__doc-type sr-only">User Manual</div>
            <div class="site-header-version"></div>
            <button type="button" aria-label="Navigation Menu" class="site-header__navigation-button hamburger">
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
            </button>
        </div>
        <div class="site-header__navigation-collapsible site-header__navigation-collapsible--collapse">
            <ul class="site-header__navigation-items">
                <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                    <span class="site-header__navigation-link">
                        Community
                        <svg class="site-header__down-arrow site-header__icon-light" width="19" height="11" viewBox="0 0 19 11" xmlns="http://www.w3.org/2000/svg"><title>Open Community Menu</title><path transform="rotate(-180 9.374 5.494)" d="M17.9991 10.422825L9.3741 0.565575 0.7491 10.422825" stroke="#02303A" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </span>
                    <div class="site-header__navigation-submenu">
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://gradle.org/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Home</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://discuss.gradle.org/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Forums</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://plugins.gradle.org" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Plugins</span>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.com/training/" itemprop="url">Training</a>
                </li>
                <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                    <span class="site-header__navigation-link">
                        News
                        <svg class="site-header__down-arrow site-header__icon-light" width="19" height="11" viewBox="0 0 19 11" xmlns="http://www.w3.org/2000/svg"><title>Open Community Menu</title><path transform="rotate(-180 9.374 5.494)" d="M17.9991 10.422825L9.3741 0.565575 0.7491 10.422825" stroke="#02303A" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </span>
                    <div class="site-header__navigation-submenu">
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a class="site-header__navigation-submenu-item-link" href="https://newsletter.gradle.com" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Newsletter</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a class="site-header__navigation-submenu-item-link" href="https://blog.gradle.org" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Blog</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item">
                            <a class="site-header__navigation-submenu-item-link" href="https://twitter.com/gradle">
                                <span class="site-header__navigation-submenu-item-link-text">Twitter</span>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.com" itemprop="url">Enterprise</a>
                </li>
                <li class="site-header__navigation-item">
                    <a class="site-header__navigation-link" title="Gradle on GitHub" href="https://github.com/gradle/gradle"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>github</title><path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill="#02303A" fill-rule="evenodd"/></svg></a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<main class="main-content">
    <!-- Primary Navigation -->
    <nav class="docs-navigation">
        <div class="search-container">
            <input type="search" name="q" id="search-input" class="search-input" placeholder="Search the docs"/>
        </div>
        <ul>
            <li><a href="../userguide/userguide.html">Docs Home</a></li>
            <li><a href="https://guides.gradle.org">Tutorials</a></li>
            <li><a href="../samples/index.html">Samples</a></li>
            <li><a href="../release-notes.html">Release Notes</a></li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#gradle-api" aria-expanded="false" aria-controls="gradle-api">Gradle API</a>
                <ul id="gradle-api">
                    <li><a href="../javadoc/index.html?overview-summary.html">Javadoc</a></li>
                    <li><a href="../dsl/index.html">Groovy DSL Reference</a></li>
                    <li><a href="../userguide/groovy_build_script_primer.html">Groovy DSL Primer</a></li>
                    <li><a href="https://gradle.github.io/kotlin-dsl-docs/api/" target="_blank">Kotlin DSL API</a></li>
                    <li><a href="../userguide/kotlin_dsl.html">Kotlin DSL Primer</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="user-manual">User Manual </h3>
        <div class="docs-home-link">
            <div class="pdf-link-container">
                <a href="../userguide/userguide.pdf">
                    <svg width="10px" height="12px" viewBox="0 0 10 12" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M6.01302083,0.857142857 C6.2421875,0.857142857 6.4296875,1.05 6.4296875,1.28571429 L6.4296875,5.14285714 L8.875,5.14285714 C9.05989583,5.14285714 9.15364583,5.37321429 9.0234375,5.50714286 L5.29427083,9.35357143 C5.13020833,9.52232143 4.8671875,9.52232143 4.703125,9.35357143 L0.979166667,5.50714286 C0.848958333,5.37321429 0.940104167,5.14285714 1.12760417,5.14285714 L3.57291667,5.14285714 L3.57291667,1.28571429 C3.57291667,1.05 3.76041667,0.857142857 3.98958333,0.857142857 L6.01302083,0.857142857 Z M6.01302083,0 L3.98958333,0 C3.29947917,0 2.73958333,0.575892857 2.73958333,1.28571429 L2.73958333,4.28571429 L1.12760417,4.28571429 C0.203125,4.28571429 -0.265625,5.4375 0.390625,6.1125 L4.11458333,9.95892857 C4.60416667,10.4625 5.39583333,10.4625 5.88541667,9.95892857 L9.61197917,6.11517857 C10.265625,5.44285714 9.80208333,4.28839286 8.875,4.28839286 L7.26302083,4.28839286 L7.26302083,1.28571429 C7.26302083,0.575892857 6.70052083,0 6.01302083,0 Z M10,11.6785714 L10,11.4642857 C10,11.2875 9.859375,11.1428571 9.6875,11.1428571 L0.3125,11.1428571 C0.140625,11.1428571 0,11.2875 0,11.4642857 L0,11.6785714 C0,11.8553571 0.140625,12 0.3125,12 L9.6875,12 C9.859375,12 10,11.8553571 10,11.6785714 Z"></path></svg>
                    PDF
                </a>
            </div>
        </div>
        <ul>
            <li><a href="../userguide/getting_started.html">Getting Started</a></li>
            <li><a href="../userguide/installation.html">Installing Gradle</a></li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#upgrading-gradle" aria-expanded="false" aria-controls="upgrading-gradle">Upgrading Gradle...</a>
                <ul id="upgrading-gradle">
                    <li><a href="../userguide/upgrading_version_6.html">version 6.X to latest</a></li>
                    <li><a href="../userguide/upgrading_version_5.html">version 5.X to 6.0</a></li>
                    <li><a href="../userguide/upgrading_version_4.html">version 4.X to 5.0</a></li>
                    <li><a href="../userguide/feature_lifecycle.html">Gradle's Feature Lifecycle</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#migrating-to-gradle" aria-expanded="false" aria-controls="migrating-to-gradle">Migrating to Gradle...</a>
                <ul id="migrating-to-gradle">
                    <li><a href="../userguide/migrating_from_maven.html">from Maven</a></li>
                    <li><a href="../userguide/migrating_from_ant.html">from Ant</a></li>
                </ul>
            </li>
            <li><a href="../userguide/compatibility.html">Compatibility Notes</a></li>
            <li><a href="../userguide/troubleshooting.html">Troubleshooting Builds</a></li>
        </ul>

        <h3 id="running-gradle-builds">Running Gradle Builds</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#customizing-execution" aria-expanded="false" aria-controls="customizing-execution">Customizing Execution</a>
                <ul id="customizing-execution">
                    <li><a href="../userguide/build_environment.html">Configuring the Build Environment</a></li>
                    <li><a href="../userguide/gradle_daemon.html">Configuring the Gradle Daemon</a></li>
                    <li><a href="../userguide/init_scripts.html">Using Initialization Scripts</a></li>
                </ul>
            </li>
            <li><a href="../userguide/intro_multi_project_builds.html">Executing Multi-Project Builds</a></li>
            <li><a href="https://guides.gradle.org/creating-build-scans/">Inspecting Gradle Builds</a></li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#optimizing-build-performance" aria-expanded="false" aria-controls="optimizing-build-performance">Optimizing Build Times</a>
                <ul id="optimizing-build-performance">
                    <li><a href="https://guides.gradle.org/performance/">Build Performance Guide</a></li>
                    <li><a href="../userguide/build_cache.html">Enabling and Configuring the Build Cache</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="authoring-gradle-builds">Authoring Gradle Builds</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#learning-the-basics" aria-expanded="false" aria-controls="learning-the-basics">Learning the Basics</a>
                <ul id="learning-the-basics">
                    <li><a href="../userguide/tutorial_using_tasks.html">Introducing the Basics of Build Scripts</a></li>
                    <li><a href="../userguide/more_about_tasks.html">Working with Tasks</a></li>
                    <li><a href="../userguide/writing_build_scripts.html">Learning More About Build Scripts</a></li>
                    <li><a href="../userguide/working_with_files.html">Working with Files</a></li>
                    <li><a href="../userguide/plugins.html">Using Gradle Plugins</a></li>
                    <li><a href="../userguide/build_lifecycle.html">Understanding the Build Lifecycle</a></li>
                    <li><a href="../userguide/logging.html">Working with Logging</a></li>
                    <li><a href="../userguide/multi_project_builds.html">Configuring Multi-Project Builds</a></li>
                    <li><a href="../userguide/potential_traps.html">Avoiding Traps</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#authoring-sustainable-builds" aria-expanded="false" aria-controls="authoring-sustainable-builds">Authoring Sustainable Builds</a>
                <ul id="authoring-sustainable-builds">
                    <li><a href="../userguide/organizing_gradle_projects.html">Organizing Build Logic</a></li>
                    <li><a href="../userguide/authoring_maintainable_build_scripts.html">Following Best Practices</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#advanced-techniques" aria-expanded="false" aria-controls="advanced-techniques">Advanced Techniques</a>
            <ul id="advanced-techniques">
                <li><a href="https://guides.gradle.org/using-the-worker-api/">Developing Parallel Tasks</a></li>
                <li><a href="../userguide/test_kit.html">Testing a Build with TestKit</a></li>
                <li><a href="../userguide/ant.html">Using Ant from Gradle</a></li>
            </ul>
        </ul>

        <h3 id="authoring-gradle-builds-java">Authoring JVM Builds</h3>
        <ul>
            <li><a href="../userguide/building_java_projects.html">Building Java &amp; JVM projects</a></li>
            <li><a href="../userguide/java_testing.html">Testing Java &amp; JVM projects</a></li>
            <li><a href="../userguide/dependency_management_for_java_projects.html">Managing Dependencies</a></li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#jvm-plugins" aria-expanded="false" aria-controls="jvm-plugins">JVM Plugins</a>
                <ul id="jvm-plugins">
                    <li><a href="../userguide/java_library_plugin.html">Java Library Plugin</a></li>
                    <li><a href="../userguide/application_plugin.html">Java Application Plugin</a></li>
                    <li><a href="../userguide/java_platform_plugin.html">Java Platform Plugin</a></li>
                    <li><a href="../userguide/groovy_plugin.html">Groovy Plugin</a></li>
                    <li><a href="../userguide/scala_plugin.html">Scala Plugin</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="authoring-gradle-builds-native">Authoring C++/Swift Builds</h3>
        <ul>
            <li><a href="../userguide/building_cpp_projects.html">Building C++ projects</a></li>
            <li><a href="../userguide/cpp_testing.html">Testing C++ projects</a></li>
            <li><a href="../userguide/building_swift_projects.html">Building Swift projects</a></li>
            <li><a href="../userguide/swift_testing.html">Testing Swift projects</a></li>
        </ul>

        <h3 id="managing-dependencies">Working with Dependencies</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#learning-the-basics-dependency-management" aria-expanded="false" aria-controls="learning-the-basics-dependency-management">Learning the Basics</a>
                <ul id="learning-the-basics-dependency-management">
                    <li><a href="../userguide/core_dependency_management.html">What is Dependency Management?</a></li>
                    <li><a href="../userguide/declaring_repositories.html">Declaring Repositories</a></li>
                    <li><a href="../userguide/declaring_dependencies.html">Declaring Dependencies</a></li>
                    <li><a href="../userguide/library_vs_application.html">Understanding Library and Application Differences</a></li>
                    <li><a href="../userguide/viewing_debugging_dependencies.html">Viewing and Debugging Dependencies</a></li>
                    <li><a href="../userguide/dependency_resolution.html">Understanding Resolution</a></li>
                    <li><a href="../userguide/dependency_verification.html">Verifying dependencies</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#declaring-dependency-versions" aria-expanded="false" aria-controls="declaring-dependency-versions">Declaring Versions</a>
                <ul id="declaring-dependency-versions">
                    <li><a href="../userguide/single_versions.html">Declaring Versions and Ranges</a></li>
                    <li><a href="../userguide/rich_versions.html">Declaring Rich Versions</a></li>
                    <li><a href="../userguide/dynamic_versions.html">Handling Changing Versions</a></li>
                    <li><a href="../userguide/dependency_locking.html">Locking Versions</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#controlling-transitive-dependencies" aria-expanded="false" aria-controls="controlling-transitive-dependencies">Controlling Transitives</a>
                <ul id="controlling-transitive-dependencies">
                    <li><a href="../userguide/dependency_constraints.html">Upgrading Versions</a></li>
                    <li><a href="../userguide/dependency_downgrade_and_exclude.html">Downgrading and Excluding</a></li>
                    <li><a href="../userguide/platforms.html">Sharing Versions</a></li>
                    <li><a href="../userguide/dependency_version_alignment.html">Aligning Dependencies</a></li>
                    <li><a href="../userguide/dependency_capability_conflict.html">Handling Mutually Exclusive Dependencies</a></li>
                    <li><a href="../userguide/component_metadata_rules.html">Fixing Metadata</a></li>
                    <li><a href="../userguide/resolution_rules.html">Customizing Resolution</a></li>
                    <li><a href="../userguide/resolution_strategy_tuning.html">Preventing accidental upgrades</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#modeling-features" aria-expanded="false" aria-controls="modeling-features">Producing and Consuming Variants of Libraries</a>
                <ul id="modeling-features">
                    <li><a href="../userguide/component_capabilities.html">Declaring Capabilities of a Library</a></li>
                    <li><a href="../userguide/feature_variants.html">Modeling Feature Variants and Optional Dependencies</a></li>
                    <li><a href="../userguide/variant_model.html">Understanding Variant Selection</a></li>
                    <li><a href="../userguide/variant_attributes.html">Declaring Variant Attributes</a></li>
                    <li><a href="../userguide/cross_project_publications.html">Sharing Outputs of Projects</a></li>
                    <li><a href="../userguide/artifact_transforms.html">Transforming Artifacts</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#multi-repo" aria-expanded="false" aria-controls="multi-repo">Working in a Multi-repo Environment</a>
                <ul id="multi-repo">
                    <li><a href="../userguide/composite_builds.html">Composing Builds</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#publishing" aria-expanded="false" aria-controls="publishing">Publishing Libraries</a>
                <ul id="publishing">
                    <li><a href="../userguide/publishing_setup.html">Setting up Publishing</a></li>
                    <li><a href="../userguide/publishing_gradle_module_metadata.html">Understanding Gradle Module Metadata</a></li>
                    <li><a href="../userguide/publishing_signing.html">Signing Artifacts</a></li>
                    <li><a href="../userguide/publishing_customization.html">Customizing Publishing</a></li>
                    <li><a href="../userguide/publishing_maven.html">Maven Publish Plugin</a></li>
                    <li><a href="../userguide/publishing_ivy.html">Ivy Publish Plugin</a></li>
                </ul>
            </li>
            <li><a href="../userguide/dependency_management_terminology.html">Terminology</a></li>
        </ul>

        <h3 id="extending-gradle">Extending Gradle</h3>
        <ul>
            <li><a href="https://gradle.org/guides/?q=Plugin%20Development">Plugin Development Tutorials</a></li>
            <li><a href="../userguide/custom_tasks.html">Writing Gradle Task Types</a></li>
            <li><a href="../userguide/custom_plugins.html">Writing Gradle Plugins</a></li>
            <li><a href="../userguide/custom_gradle_types.html">Writing Custom Gradle Types</a></li>
            <li><a href="../userguide/lazy_configuration.html">Configuring Tasks Lazily</a></li>
            <li><a href="../userguide/task_configuration_avoidance.html">Using Task Configuration Avoidance</a></li>
        </ul>

        <h3 id="reference">Reference</h3>
        <ul>
            <li><a href="../userguide/plugin_reference.html">Core Plugins</a></li>
            <li><a href="../userguide/command_line_interface.html">Command-Line Interface</a></li>
            <li id="third-party-integration"><a href="../userguide/third_party_integration.html">Gradle &amp; Third-party Tools</a></li>
            <li><a href="../userguide/gradle_wrapper.html">The Gradle Wrapper</a></li>
            <li><a href="../userguide/directory_layout.html">Gradle-managed Directories</a></li>
        </ul>
    </nav>
    <!-- End Primary Navigation -->
    <div class="chapter">
<div id="header">
<h1>Gradle User Manual: Version 6.4.1</h1>
<div class="details">
<span id="revnumber">version 6.4.1</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#part:about_gradle">About Gradle</a>
<ul class="sectlevel2">
<li><a href="#what_is_gradle">What is Gradle?</a></li>
</ul>
</li>
<li><a href="#part:getting_started">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#getting_started">Getting Started</a></li>
<li><a href="#installation">Installing Gradle</a></li>
<li><a href="#troubleshooting">Troubleshooting builds</a></li>
<li><a href="#compatibility">Compatibility Matrix</a></li>
</ul>
</li>
<li><a href="#part:upgrading_and_migrating">Upgrading and Migrating</a>
<ul class="sectlevel2">
<li><a href="#upgrading_version_6">Upgrading your build from Gradle 6.x to the latest</a></li>
<li><a href="#upgrading_version_5">Upgrading your build from Gradle 5.x to 6.0</a></li>
<li><a href="#upgrading_version_4">Upgrading your build from Gradle 4.x to 5.0</a></li>
<li><a href="#migrating_from_maven">Migrating Builds From Apache Maven</a></li>
<li><a href="#migrating_from_ant">Migrating Builds From Apache Ant</a></li>
</ul>
</li>
<li><a href="#part:running_builds">Running Gradle Builds</a>
<ul class="sectlevel2">
<li><a href="#build_environment">Build Environment</a></li>
<li><a href="#gradle_daemon">The Gradle Daemon</a></li>
<li><a href="#init_scripts">Initialization Scripts</a></li>
<li><a href="#intro_multi_project_builds">Executing Multi-Project Builds</a></li>
<li><a href="#build_cache">Build Cache</a></li>
</ul>
</li>
<li><a href="#part:authoring_builds">Authoring Gradle Builds</a>
<ul class="sectlevel2">
<li><a href="#tutorial_using_tasks">Build Script Basics</a></li>
<li><a href="#more_about_tasks">Authoring Tasks</a></li>
<li><a href="#writing_build_scripts">Writing Build Scripts</a></li>
<li><a href="#working_with_files">Working With Files</a></li>
<li><a href="#plugins">Using Gradle Plugins</a></li>
<li><a href="#build_lifecycle">Build Lifecycle</a></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#multi_project_builds">Authoring Multi-Project Builds</a></li>
<li><a href="#organizing_gradle_projects">Organizing Gradle Projects</a></li>
<li><a href="#authoring_maintainable_build_scripts">Best practices for authoring maintainable builds</a></li>
<li><a href="#lazy_configuration">Lazy Configuration</a></li>
<li><a href="#test_kit">Testing Build Logic with TestKit</a></li>
<li><a href="#ant">Using Ant from Gradle</a></li>
</ul>
</li>
<li><a href="#part:dependency_management">Dependency Management</a>
<ul class="sectlevel2">
<li><a href="#learning_the_basics">Learning the Basics</a></li>
<li><a href="#declaring_versions">Declaring Versions</a></li>
<li><a href="#controlling_transitive_dependencies">Controlling Transitive Dependencies</a></li>
<li><a href="#producing_and_consuming_variants_of_libraries">Producing and Consuming Variants of Libraries</a></li>
<li><a href="#working_in_a_multi_repo_environment">Working in a Multi-repo Environment</a></li>
<li><a href="#publishing_libraries">Publishing Libraries</a></li>
</ul>
</li>
<li><a href="#part:jvm_projects">Java &amp; Other JVM Projects</a>
<ul class="sectlevel2">
<li><a href="#building_java_projects">Building Java &amp; JVM projects</a></li>
<li><a href="#java_testing">Testing in Java &amp; JVM projects</a></li>
<li><a href="#dependency_management_for_java_projects">Managing Dependencies of JVM Projects</a></li>
</ul>
</li>
<li><a href="#part:native_projects">C++ &amp; Other Native Projects</a>
<ul class="sectlevel2">
<li><a href="#building_cpp_projects">Building C&#43;&#43; projects</a></li>
<li><a href="#cpp_testing">Testing in C++ projects</a></li>
<li><a href="#building_swift_projects">Building Swift projects</a></li>
<li><a href="#swift_testing">Testing in Swift projects</a></li>
</ul>
</li>
<li><a href="#native_projects_using_the_software_model">Native Projects using the Software Model</a>
<ul class="sectlevel2">
<li><a href="#native_software">Building native software</a></li>
<li><a href="#software_model_concepts">Software model concepts</a></li>
<li><a href="#software_model">Rule based model configuration</a></li>
<li><a href="#rule_source">Implementing model rules in a plugin</a></li>
<li><a href="#software_model_extend">Extending the software model</a></li>
</ul>
</li>
<li><a href="#part:extending_gradle">Extending Gradle</a>
<ul class="sectlevel2">
<li><a href="#custom_tasks">Developing Custom Gradle Task Types</a></li>
<li><a href="#custom_plugins">Developing Custom Gradle Plugins</a></li>
<li><a href="#custom_gradle_types">Developing Custom Gradle Types</a></li>
<li><a href="#java_gradle_plugin">Gradle Plugin Development Plugin</a></li>
</ul>
</li>
<li><a href="#part:reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#groovy_build_script_primer">A Groovy Build Script Primer</a></li>
<li><a href="#kotlin_dsl">Gradle Kotlin DSL Primer</a></li>
<li><a href="#plugin_reference">Gradle Plugin Reference</a></li>
<li><a href="#command_line_interface">Command-Line Interface</a></li>
<li><a href="#third_party_integration">Gradle &amp; Third-party Tools</a></li>
<li><a href="#gradle_wrapper">The Gradle Wrapper</a></li>
<li><a href="#directory_layout">The Directories and Files Gradle Uses</a></li>
</ul>
</li>
<li><a href="#part:plugins">Plugins</a>
<ul class="sectlevel2">
<li><a href="#antlr_plugin">The ANTLR Plugin</a></li>
<li><a href="#application_plugin">The Application Plugin</a></li>
<li><a href="#base_plugin">The Base Plugin</a></li>
<li><a href="#build_init_plugin">Build Init Plugin</a></li>
<li><a href="#checkstyle_plugin">The Checkstyle Plugin</a></li>
<li><a href="#codenarc_plugin">The CodeNarc Plugin</a></li>
<li><a href="#distribution_plugin">The Distribution Plugin</a></li>
<li><a href="#ear_plugin">The Ear Plugin</a></li>
<li><a href="#eclipse_plugin">The Eclipse Plugins</a></li>
<li><a href="#groovy_plugin">The Groovy Plugin</a></li>
<li><a href="#idea_plugin">The IDEA Plugin</a></li>
<li><a href="#publishing_ivy">Ivy Publish Plugin</a></li>
<li><a href="#jacoco_plugin">The JaCoCo Plugin</a></li>
<li><a href="#java_plugin">The Java Plugin</a></li>
<li><a href="#java_library_plugin">The Java Library Plugin</a></li>
<li><a href="#java_library_distribution_plugin">The Java Library Distribution Plugin</a></li>
<li><a href="#java_platform_plugin">The Java Platform Plugin</a></li>
<li><a href="#publishing_maven">Maven Publish Plugin</a></li>
<li><a href="#maven_plugin">Maven Plugin</a></li>
<li><a href="#pmd_plugin">The PMD Plugin</a></li>
<li><a href="#scala_plugin">The Scala Plugin</a></li>
<li><a href="#signing_plugin">The Signing Plugin</a></li>
<li><a href="#war_plugin">The War Plugin</a></li>
</ul>
</li>
<li><a href="#license_information">License Information</a></li>
<li><a href="#licenses">License Information</a>
<ul class="sectlevel2">
<li><a href="#sec:gradle_documentation">Gradle Documentation</a></li>
<li><a href="#licenses:build_scan_plugin">Gradle Build Scan Plugin</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:about_gradle"><a class="anchor" href="#part:about_gradle"></a><a class="link" href="#part:about_gradle">About Gradle</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="what_is_gradle"><a class="anchor" href="#what_is_gradle"></a><a class="link" href="#what_is_gradle">What is Gradle?</a></h3>
<div class="sect3">
<h4 id="gradle_overview"><a class="anchor" href="#gradle_overview"></a><a class="link" href="#gradle_overview">Overview</a></h4>
<div class="paragraph">
<p>Gradle is an open-source <a href="https://en.wikipedia.org/wiki/Build_automation">build automation</a> tool that is designed to be flexible enough to build almost any type of software. The following is a high-level overview of some of its most important features:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">High performance</dt>
<dd>
<p>Gradle avoids unnecessary work by only running the tasks that need to run because their inputs or outputs have changed. You can also use a build cache to enable the reuse of task outputs from previous runs or even from a different machine (with a shared build cache).</p>
<div class="paragraph">
<p>There are many other optimizations that Gradle implements and the development team continually work to improve Gradle&#8217;s performance.</p>
</div>
</dd>
<dt class="hdlist1">JVM foundation</dt>
<dd>
<p>Gradle runs on the JVM and you must have a Java Development Kit (JDK) installed to use it. This is a bonus for users familiar with the Java platform as you can use the standard Java APIs in your build logic, such as custom task types and plugins. It also makes it easy to run Gradle on different platforms.</p>
<div class="paragraph">
<p>Note that Gradle isn&#8217;t limited to building just JVM projects, and it even comes packaged with support for building native projects.</p>
</div>
</dd>
<dt class="hdlist1">Conventions</dt>
<dd>
<p>Gradle takes a leaf out of Maven&#8217;s book and makes common types of projects such as Java projects easy to build by implementing conventions. Apply the appropriate plugins and you can easily end up with slim build scripts for many projects. But these conventions don&#8217;t limit you: Gradle allows you to override them, add your own tasks, and make many other customizations to your convention-based builds.</p>
</dd>
<dt class="hdlist1">Extensibility</dt>
<dd>
<p>You can readily extend Gradle to provide your own task types or even build model. See the Android build support for an example of this: it adds many new build concepts such as flavors and build types.</p>
</dd>
<dt class="hdlist1">IDE support</dt>
<dd>
<p>Several major IDEs allow you to import Gradle builds and interact with them: Android Studio, IntelliJ IDEA, Eclipse, and NetBeans. Gradle also has support for generating the solution files required to load a project into Visual Studio.</p>
</dd>
<dt class="hdlist1">Insight</dt>
<dd>
<p><a href="https://scans.gradle.com/">Build scans</a> provide extensive information about a build run that you can use to identify build issues. They are particularly good at helping you to identify problems with a build&#8217;s performance. You can also share build scans with others, which is particularly useful if you need to ask for advice in fixing an issue with the build.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="five_things"><a class="anchor" href="#five_things"></a><a class="link" href="#five_things">Five things you need to know about Gradle</a></h4>
<div class="paragraph">
<p>Gradle is a flexible and powerful build tool that can easily feel intimidating when you first start. However, understanding the following core principles will make Gradle much more approachable and you will become adept with the tool before you know it.</p>
</div>
<div class="sect4">
<h5 id="1_gradle_is_a_general_purpose_build_tool"><a class="anchor" href="#1_gradle_is_a_general_purpose_build_tool"></a><a class="link" href="#1_gradle_is_a_general_purpose_build_tool">1. Gradle is a general-purpose build tool</a></h5>
<div class="paragraph">
<p>Gradle allows you to build any software, because it makes few assumptions about what you&#8217;re trying to build or how it should be done. The most notable restriction is that dependency management currently only supports Maven- and Ivy-compatible repositories and the filesystem.</p>
</div>
<div class="paragraph">
<p>This doesn&#8217;t mean you have to do a lot of work to create a build. Gradle makes it easy to build common types of project say Java libraries  by adding a layer of conventions and prebuilt functionality through <a href="#plugins"><em>plugins</em></a>. You can even create and publish custom plugins to encapsulate your own conventions and build functionality.</p>
</div>
</div>
<div class="sect4">
<h5 id="the_core_model_is_based_on_tasks"><a class="anchor" href="#the_core_model_is_based_on_tasks"></a><a class="link" href="#the_core_model_is_based_on_tasks">2. The core model is based on tasks</a></h5>
<div class="paragraph">
<p>Gradle models its builds as Directed Acyclic Graphs (DAGs) of tasks (units of work). What this means is that a build essentially configures a set of tasks and wires them together based on their dependencies to create that DAG. Once the task graph has been created, Gradle determines which tasks need to be run in which order and then proceeds to execute them.</p>
</div>
<div class="paragraph">
<p>This diagram shows two example task graphs, one abstract and the other concrete, with the dependencies between the tasks represented as arrows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/task-dag-examples.png" alt="Example task graphs">
</div>
<div class="title">Figure 1. Two examples of Gradle task graphs</div>
</div>
<div class="paragraph">
<p>Almost any build process can be modeled as a graph of tasks in this way, which is one of the reasons why Gradle is so flexible. And that task graph can be defined by both plugins and your own build scripts, with tasks linked together via the <a href="#sec:task_dependencies">task dependency mechanism</a>.</p>
</div>
<div class="paragraph">
<p>Tasks themselves consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actions pieces of work that do something, like copy files or compile source</p>
</li>
<li>
<p>Inputs values, files and directories that the actions use or operate on</p>
</li>
<li>
<p>Outputs files and directories that the actions modify or generate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In fact, all of the above are optional depending on what the task needs to do. Some tasks such as the <a href="#sec:base_tasks">standard lifecycle tasks</a> don&#8217;t even have any actions. They simply aggregate multiple tasks together as a convenience.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You choose which task to run. Save time by specifying the task that does what you need, but no more than that. If you just want to run the unit tests, choose the task that does that typically <code>test</code>. If you want to package an application, most builds have an <code>assemble</code> task for that.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One last thing: Gradle&#8217;s <a href="#sec:up_to_date_checks">incremental build</a> support is robust and reliable, so keep your builds running fast by avoiding the <code>clean</code> task unless you actually do want to perform a clean.</p>
</div>
</div>
<div class="sect4">
<h5 id="3_gradle_has_several_fixed_build_phases"><a class="anchor" href="#3_gradle_has_several_fixed_build_phases"></a><a class="link" href="#3_gradle_has_several_fixed_build_phases">3. Gradle has several fixed build phases</a></h5>
<div class="paragraph">
<p>It&#8217;s important to understand that Gradle evaluates and executes build scripts in three phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialization</p>
<div class="paragraph">
<p>Sets up the environment for the build and determine which projects will take part in it.</p>
</div>
</li>
<li>
<p>Configuration</p>
<div class="paragraph">
<p>Constructs and configures the task graph for the build and then determines which tasks need to run and in which order, based on the task the user wants to run.</p>
</div>
</li>
<li>
<p>Execution</p>
<div class="paragraph">
<p>Runs the tasks selected at the end of the configuration phase.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>These phases form Gradle&#8217;s <a href="#build_lifecycle">Build Lifecycle</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Comparison to Apache Maven terminology</div>
<div class="paragraph">
<p>Gradle&#8217;s build phases are not like Maven&#8217;s phases. Maven uses its phases to divide the build execution into multiple stages. They serve a similar role to Gradle&#8217;s task graph, although less flexibly.</p>
</div>
<div class="paragraph">
<p>Maven&#8217;s concept of a build lifecycle is loosely similar to Gradle&#8217;s <a href="#sec:base_tasks">lifecycle tasks</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Well-designed build scripts consist mostly of <a href="#sec:avoid_imperative_logic_in_scripts">declarative configuration rather than imperative logic</a>. That configuration is understandably evaluated during the configuration phase. Even so, many such builds also have task actions  for example via <code>doLast {}</code> and <code>doFirst {}</code> blocks  which are evaluated during the execution phase. This is important because code evaluated during the configuration phase won&#8217;t see changes that happen during the execution phase.</p>
</div>
<div class="paragraph">
<p>Another important aspect of the configuration phase is that everything involved in it is evaluated <em>every time the build runs</em>. That is why it&#8217;s best practice to <a href="#sec:minimize_logic_executed_configuration_phase">avoid expensive work during the configuration phase</a>. <a href="https://scans.gradle.com/">Build scans</a> can help you identify such hotspots, among other things.</p>
</div>
</div>
<div class="sect4">
<h5 id="4_gradle_is_extensible_in_more_ways_than_one"><a class="anchor" href="#4_gradle_is_extensible_in_more_ways_than_one"></a><a class="link" href="#4_gradle_is_extensible_in_more_ways_than_one">4. Gradle is extensible in more ways than one</a></h5>
<div class="paragraph">
<p>It would be great if you could build your project using only the build logic bundled with Gradle, but that&#8217;s rarely possible. Most builds have some special requirements that mean you need to add custom build logic.</p>
</div>
<div class="paragraph">
<p>Gradle provides several mechanisms that allow you to extend it, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#">Custom task types</a>.</p>
<div class="paragraph">
<p>When you want the build to do some work that an existing task can&#8217;t do, you can simply write your own task type. It&#8217;s typically best to put the source file for a custom task type in the <a href="#sec:build_sources"><em>buildSrc</em></a> directory or in a packaged plugin. Then you can use the custom task type just like any of the Gradle-provided ones.</p>
</div>
</li>
<li>
<p>Custom task actions.</p>
<div class="paragraph">
<p>You can attach custom build logic that executes before or after a task via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doFirst(org.gradle.api.Action)">Task.doFirst()</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doLast(org.gradle.api.Action)">Task.doLast()</a> methods.</p>
</div>
</li>
<li>
<p><a href="#sec:extra_properties">Extra properties</a> on projects and tasks.</p>
<div class="paragraph">
<p>These allows you to add your own properties to a project or task that you can then use from your own custom actions or any other build logic. Extra properties can even be applied to tasks that aren&#8217;t explicitly created by you, such as those created by Gradle&#8217;s core plugins.</p>
</div>
</li>
<li>
<p>Custom conventions.</p>
<div class="paragraph">
<p>Conventions are a powerful way to simplify builds so that users can understand and use them more easily. This can be seen with builds that use standard project structures and naming conventions, such as <a href="#building_java_projects">Java builds</a>. You can write your own plugins that provide conventions  they just need to configure default values for the relevant aspects of a build.</p>
</div>
</li>
<li>
<p><a href="https://guides.gradle.org/implementing-gradle-plugins/#modeling_dsl_like_apis">A custom model</a>.</p>
<div class="paragraph">
<p>Gradle allows you to introduce new concepts into a build beyond tasks, files and dependency configurations. You can see this with most language plugins, which add the concept of <a href="#sec:java_source_sets"><em>source sets</em></a> to a build. Appropriate modeling of a build process can greatly improve a build&#8217;s ease of use and its efficiency.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="5_build_scripts_operate_against_an_api"><a class="anchor" href="#5_build_scripts_operate_against_an_api"></a><a class="link" href="#5_build_scripts_operate_against_an_api">5. Build scripts operate against an API</a></h5>
<div class="paragraph">
<p>It&#8217;s easy to view Gradle&#8217;s build scripts as executable code, because that&#8217;s what they are. But that&#8217;s an implementation detail: well-designed build scripts describe <em>what</em> steps are needed to build the software, not <em>how</em> those steps should do the work. That&#8217;s a job for custom task types and plugins.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is a common misconception that Gradle&#8217;s power and flexibility come from the fact that its build scripts are code. This couldn&#8217;t be further from the truth. It&#8217;s the underlying model and API that provide the power. As we recommend in our best practices, you should <a href="#sec:avoid_imperative_logic_in_scripts">avoid putting much, if any, imperative logic in your build scripts</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Yet there is one area in which it is useful to view a build script as executable code: in understanding how the syntax of the build script maps to Gradle&#8217;s API. The API documentation  formed of the <a href="https://docs.gradle.org/6.4.1/dsl/">Groovy DSL Reference</a> and the <a href="https://docs.gradle.org/6.4.1/javadoc/">Javadocs</a> lists methods and properties, and refers to closures and actions. What do these mean within the context of a build script? Check out the <a href="#groovy_build_script_primer">Groovy Build Script Primer</a> to learn the answer to that question so that you can make effective use of the API documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As Gradle runs on the JVM, build scripts can also use the standard <a href="https://docs.oracle.com/javase/8/docs/api">Java API</a>. Groovy build scripts can additionally use the Groovy APIs, while Kotlin build scripts can use the Kotlin ones.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:getting_started"><a class="anchor" href="#part:getting_started"></a><a class="link" href="#part:getting_started">Getting Started</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="getting_started"><a class="anchor" href="#getting_started"></a><a class="link" href="#getting_started">Getting Started</a></h3>
<div class="paragraph">
<p>Everyone has to start somewhere and if you&#8217;re new to Gradle, this is where to begin.</p>
</div>
<div class="sect3">
<h4 id="before_you_start"><a class="anchor" href="#before_you_start"></a><a class="link" href="#before_you_start">Before you start</a></h4>
<div class="paragraph">
<p>In order to use Gradle effectively, you need to know what it is and understand some of its fundamental concepts. So before you start using Gradle in earnest, we highly recommend you read <a href="#what_is_gradle">What is Gradle?</a>.</p>
</div>
<div class="paragraph">
<p>Even if you&#8217;re experienced with using Gradle, we suggest you read the section <a href="#five_things">5 things you need to know about Gradle</a> as it clears up some common misconceptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="gs:installation"><a class="anchor" href="#gs:installation"></a><a class="link" href="#gs:installation">Installation</a></h4>
<div class="paragraph">
<p>If all you want to do is run an existing Gradle build, then you don&#8217;t need to install Gradle if the build has a <a href="#gradle_wrapper">Gradle Wrapper</a>, identifiable via the <em>gradlew</em> and/or <em>gradlew.bat</em> files in the root of the build. You just need to make sure your system <a href="#sec:prerequisites">satisfies Gradle&#8217;s prerequisites</a>.</p>
</div>
<div class="paragraph">
<p>Android Studio comes with a working installation of Gradle, so you don&#8217;t need to install Gradle separately in that case.</p>
</div>
<div class="paragraph">
<p>In order to create a new build or add a Wrapper to an existing build, you will need to install Gradle <a href="#installation">according to these instructions</a>. Note that there may be other ways to install Gradle in addition to those described on that page, since it&#8217;s nearly impossible to keep track of all the package managers out there.</p>
</div>
</div>
<div class="sect3">
<h4 id="try_gradle"><a class="anchor" href="#try_gradle"></a><a class="link" href="#try_gradle">Try Gradle</a></h4>
<div class="paragraph">
<p>Actively using Gradle is a great way to learn about it, so once you&#8217;ve installed Gradle, try one of the introductory hands-on tutorials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating a basic Gradle build</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/building-android-apps/">Building Android apps</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/building-java-libraries/">Building Java libraries</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/building-kotlin-jvm-libraries/">Building Kotlin JVM libraries</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/building-cpp-libraries/">Building C++ libraries</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/creating-build-scans/">Creating build scans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also many other <a href="https://guides.gradle.org/">tutorials and guides</a> available, which you can filter by category for example <a href="https://guides.gradle.org/?q=Fundamentals">Fundamentals</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="command_line_vs_ides"><a class="anchor" href="#command_line_vs_ides"></a><a class="link" href="#command_line_vs_ides">Command line vs IDEs</a></h4>
<div class="paragraph">
<p>Some folks are hard-core command-line users, while others prefer to never leave the comfort of their IDE.
Many people happily use both and Gradle endeavors not to discriminate.
Gradle is supported by <a href="#ides">several major IDEs</a> and everything that can be done from the <a href="#command_line_interface">command line</a> is available to IDEs via the <a href="#embedding">Tooling API</a>.</p>
</div>
<div class="paragraph">
<p>Android Studio and IntelliJ IDEA users should consider using <a href="#kotlin_dsl">Kotlin DSL build scripts</a> for the superior IDE support when editing them.</p>
</div>
</div>
<div class="sect3">
<h4 id="executing_gradle_builds"><a class="anchor" href="#executing_gradle_builds"></a><a class="link" href="#executing_gradle_builds">Executing Gradle builds</a></h4>
<div class="paragraph">
<p>If you follow any of the tutorials <a href="#try_gradle">linked above</a>, you will execute a Gradle build. But what do you do if you&#8217;re given a Gradle build without any instructions?</p>
</div>
<div class="paragraph">
<p>Here are some useful steps to follow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine whether the project has a Gradle wrapperand <a href="#sec:using_wrapper">use it if it&#8217;s there</a>  the main IDEs default to using the wrapper when it&#8217;s available.</p>
</li>
<li>
<p>Discover the project structure.</p>
<div class="paragraph">
<p>Either import the build with an IDE or run <code>gradle projects</code> from the command line. If only the root project is listed, it&#8217;s a single-project build. Otherwise it&#8217;s a <a href="#intro_multi_project_builds">multi-project build</a>.</p>
</div>
</li>
<li>
<p>Find out what tasks you can run.</p>
<div class="paragraph">
<p>If you have imported the build into an IDE, you should have access to a view that displays all the available tasks. From the command line, run <code>gradle tasks</code>.</p>
</div>
</li>
<li>
<p>Learn more about the tasks via <code>gradle help --task &lt;taskname&gt;</code>.</p>
<div class="paragraph">
<p>The <code>help</code> task can display extra information about a task, including which projects contain that task and what options the task supports.</p>
</div>
</li>
<li>
<p>Run the task that you are interested in.</p>
<div class="paragraph">
<p>Many convention-based builds integrate with Gradle&#8217;s <a href="#sec:base_tasks">lifecycle tasks</a>, so use those when you don&#8217;t have something more specific you want to do with the build. For example, most builds have <code>clean</code>, <code>check</code>, <code>assemble</code> and <code>build</code> tasks.</p>
</div>
<div class="paragraph">
<p>From the command line, just run <code>gradle &lt;taskname&gt;</code> to execute a particular task. You can learn more about command-line execution in the <a href="#command_line_interface">corresponding user manual chapter</a>. If you&#8217;re using an IDE, check its documentation to find out how to run a task.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle builds often follow standard conventions on project structure and tasks, so if you&#8217;re familiar with other builds of the same type  such as Java, Android or native builds  then the file and directory structure of the build should be familiar, as well as many of the tasks and project properties.</p>
</div>
<div class="paragraph">
<p>For more specialized builds or those with significant customizations, you should ideally have access to documentation on how to run the build and what <a href="#build_environment">build properties</a> you can configure.</p>
</div>
</div>
<div class="sect3">
<h4 id="authoring_gradle_builds"><a class="anchor" href="#authoring_gradle_builds"></a><a class="link" href="#authoring_gradle_builds">Authoring Gradle builds</a></h4>
<div class="paragraph">
<p>Learning to create and maintain Gradle builds is a process, and one that takes a little time. We recommend that you start with the appropriate core plugins and their conventions for your project, and then gradually incorporate customizations as you learn more about the tool.</p>
</div>
<div class="paragraph">
<p>Here are some useful first steps on your journey to mastering Gradle:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try one or two <a href="#try_gradle">basic tutorials</a> to see what a Gradle build looks like, particularly the ones that match the type of project you work with (Java, native, Android, etc.).</p>
</li>
<li>
<p>Make sure you&#8217;ve read <a href="#five_things">5 things you need to know about Gradle</a>!</p>
</li>
<li>
<p>Learn about the fundamental elements of a Gradle build: <a href="#sec:projects_and_tasks">projects</a>, <a href="#more_about_tasks">tasks</a>, and the <a href="#working_with_files">file API</a>.</p>
</li>
<li>
<p>If you are building software for the JVM, be sure to read about the specifics of those types of projects in <a href="#building_java_projects">Building Java &amp; JVM projects</a> and <a href="#java_testing">Testing in Java &amp; JVM projects</a>.</p>
</li>
<li>
<p>Familiarize yourself with the <a href="#plugin_reference">core plugins</a> that come packaged with Gradle, as they provide a lot of useful functionality out of the box.</p>
</li>
<li>
<p>Learn how to <a href="#authoring_maintainable_build_scripts">author maintainable build scripts</a> and <a href="#organizing_gradle_projects">best organize your Gradle projects</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The user manual contains a lot of other useful information and you can find more tutorials on various Gradle features among the <a href="https://guides.gradle.org/">Gradle Guides</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="integrating_3rd_party_tools_with_gradle"><a class="anchor" href="#integrating_3rd_party_tools_with_gradle"></a><a class="link" href="#integrating_3rd_party_tools_with_gradle">Integrating 3rd-party tools with Gradle</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s flexibility means that it readily works with other tools, such as those listed on our <a href="#third_party_integration">Gradle &amp; Third-party Tools</a> page.</p>
</div>
<div class="paragraph">
<p>There are two main modes of integration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A tool drives Gradle  uses it to extract information about a build and run it via the <a href="#embedding">Tooling API</a></p>
</li>
<li>
<p>Gradle invokes or generates information for a tool via the 3rd-party tool&#8217;s APIs this is usually done via plugins and custom task types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tools that have existing Java-based APIs are generally straightforward to integrate. You can find many such integrations on Gradle&#8217;s <a href="https://plugins.gradle.org/">plugin portal</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation"><a class="anchor" href="#installation"></a><a class="link" href="#installation">Installing Gradle</a></h3>
<div class="paragraph">
<p>You can install the Gradle build tool on Linux, macOS, or Windows.
This document covers installing using a package manager like SDKMAN! or Homebrew, as well as manual installation.</p>
</div>
<div class="paragraph">
<p>Use of the <a href="#sec:upgrading_wrapper">Gradle Wrapper</a> is the recommended way to upgrade Gradle.</p>
</div>
<div class="paragraph">
<p>You can find all releases and their checksums on the <a href="https://gradle.org/releases">releases page</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:prerequisites"><a class="anchor" href="#sec:prerequisites"></a><a class="link" href="#sec:prerequisites">Prerequisites</a></h4>
<div class="paragraph">
<p>Gradle runs on all major operating systems and requires only a <a href="https://jdk.java.net/">Java Development Kit</a> version 8 or higher to run. To check, run <code>java -version</code>. You should see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> java -version
java version "1.8.0_151"
Java(TM) SE Runtime Environment (build 1.8.0_151-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode)</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle ships with its own Groovy library, therefore Groovy does not need to be installed. Any existing Groovy installation is ignored by Gradle.</p>
</div>
<div class="paragraph">
<p>Gradle uses whatever JDK it finds in your path. Alternatively, you can set the <code>JAVA_HOME</code> environment variable to point to the installation directory of the desired JDK.</p>
</div>
<div class="paragraph">
<p><a href="#compatibility">See the full compatibility notes for Java, Groovy, Kotlin and Android.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="installing_with_a_package_manager"><a class="anchor" href="#installing_with_a_package_manager"></a><a class="link" href="#installing_with_a_package_manager">Installing with a package manager</a></h4>
<div class="paragraph">
<p><a href="http://sdkman.io">SDKMAN!</a> is a tool for managing parallel versions of multiple Software Development Kits on most Unix-like systems (macOS, Linux, Cygwin, Solaris and FreeBSD). We deploy and maintain the versions available from SDKMAN!.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> sdk install gradle</pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://brew.sh">Homebrew</a> is "the missing package manager for macOS".</p>
</div>
<div class="listingblock">
<div class="content">
<pre> brew install gradle</pre>
</div>
</div>
<div class="paragraph">
<p>Other package managers are available, but the version of Gradle distributed by them is not controlled by Gradle, Inc. Linux package managers may distribute a modified version of Gradle that is incompatible or incomplete when compared to the official version (available from SDKMAN! or below).</p>
</div>
<div class="paragraph">
<p><a href="#sec:installation_next_steps"> Proceed to next steps</a></p>
</div>
</div>
<div class="sect3">
<h4 id="installing_manually"><a class="anchor" href="#installing_manually"></a><a class="link" href="#installing_manually">Installing manually</a></h4>
<div class="sect4">
<h5 id="step_1_download_the_latest_gradle_distribution"><a class="anchor" href="#step_1_download_the_latest_gradle_distribution"></a><a class="link" href="#step_1_download_the_latest_gradle_distribution">Step 1. <a href="https://gradle.org/releases">Download</a> the latest Gradle distribution</a></h5>
<div class="paragraph">
<p>The distribution ZIP file comes in two flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary-only (bin)</p>
</li>
<li>
<p>Complete (all) with docs and sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Need to work with an older version? See the <a href="https://gradle.org/releases">releases page</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="step_2_unpack_the_distribution"><a class="anchor" href="#step_2_unpack_the_distribution"></a><a class="link" href="#step_2_unpack_the_distribution">Step 2. Unpack the distribution</a></h5>
<div class="sect5">
<h6 id="linux_macos_users"><a class="anchor" href="#linux_macos_users"></a><a class="link" href="#linux_macos_users">Linux &amp; MacOS users</a></h6>
<div class="paragraph">
<p>Unzip the distribution zip file in the directory of your choosing, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> mkdir /opt/gradle
 unzip -d /opt/gradle gradle-6.4.1-bin.zip
 ls /opt/gradle/gradle-6.4.1
LICENSE  NOTICE  bin  README  init.d  lib  media</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="microsoft_windows_users"><a class="anchor" href="#microsoft_windows_users"></a><a class="link" href="#microsoft_windows_users">Microsoft Windows users</a></h6>
<div class="paragraph">
<p>Create a new directory <code>C:\Gradle</code> with <strong>File Explorer</strong>.</p>
</div>
<div class="paragraph">
<p>Open a second <strong>File Explorer</strong> window and go to the directory where the Gradle distribution was downloaded. Double-click the ZIP archive to expose the content. Drag the content folder <code>gradle-6.4.1</code> to your newly created <code>C:\Gradle</code> folder.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can unpack the Gradle distribution ZIP into <code>C:\Gradle</code> using an archiver tool of your choice.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="step_3_configure_your_system_environment"><a class="anchor" href="#step_3_configure_your_system_environment"></a><a class="link" href="#step_3_configure_your_system_environment">Step 3. Configure your system environment</a></h5>
<div class="paragraph">
<p>To run Gradle, the path to the unpacked files from the Gradle website need to be on your terminal&#8217;s path. The steps to do this are different for each operating system.</p>
</div>
<div class="sect5">
<h6 id="linux_macos_users_2"><a class="anchor" href="#linux_macos_users_2"></a><a class="link" href="#linux_macos_users_2">Linux &amp; MacOS users</a></h6>
<div class="paragraph">
<p>Configure your <code>PATH</code> environment variable to include the <code>bin</code> directory of the unzipped distribution, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> export PATH=$PATH:/opt/gradle/gradle-6.4.1/bin</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could also add the environment variable <code>GRADLE_HOME</code> and point this to the unzipped distribution.  Instead of adding a specific version of Gradle to your <code>PATH</code>, you can add <code><em>$GRADLE_HOME</em>/bin</code> to your <code>PATH</code>.  When upgrading to a different version of Gradle, just change the <code>GRADLE_HOME</code> environment variable.</p>
</div>
</div>
<div class="sect5">
<h6 id="microsoft_windows_users_2"><a class="anchor" href="#microsoft_windows_users_2"></a><a class="link" href="#microsoft_windows_users_2">Microsoft Windows users</a></h6>
<div class="paragraph">
<p>In <strong>File Explorer</strong> right-click on the <code>This PC</code> (or <code>Computer</code>) icon, then click <code>Properties</code> &#8594; <code>Advanced System Settings</code> &#8594; <code>Environmental Variables</code>.</p>
</div>
<div class="paragraph">
<p>Under <code>System Variables</code> select <code>Path</code>, then click <code>Edit</code>. Add an entry for <code>C:\Gradle\gradle-6.4.1\bin</code>. Click OK to save.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could also add the environment variable <code>GRADLE_HOME</code> and point this to the unzipped distribution.  Instead of adding a specific version of Gradle to your <code>Path</code>, you can add <code><em>%GRADLE_HOME%</em>/bin</code> to your <code>Path</code>.  When upgrading to a different version of Gradle, just change the <code>GRADLE_HOME</code> environment variable.</p>
</div>
<div class="paragraph">
<p><a href="#sec:installation_next_steps"> Proceed to next steps</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:running_and_testing_your_installation"><a class="anchor" href="#sec:running_and_testing_your_installation"></a><a class="link" href="#sec:running_and_testing_your_installation">Verifying installation</a></h4>
<div class="paragraph">
<p>Open a console (or a Windows command prompt) and run <code>gradle -v</code> to run gradle and display the version, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> gradle -v

------------------------------------------------------------
Gradle 6.4.1
------------------------------------------------------------

(environment specific information)</pre>
</div>
</div>
<div class="paragraph">
<p>If you run into any trouble, see the <a href="#sec:troubleshooting_installation">section on troubleshooting installation</a>.</p>
</div>
<div class="paragraph">
<p>You can verify the integrity of the Gradle distribution by downloading the SHA-256 file (available from the <a href="https://gradle.org/releases">releases page</a>) and following these <a href="#sec:verification">verification instructions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:installation_next_steps"><a class="anchor" href="#sec:installation_next_steps"></a><a class="link" href="#sec:installation_next_steps">Next steps</a></h4>
<div class="paragraph">
<p>Now that you have Gradle installed, use these resources for getting started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create your first Gradle project by following the <a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating New Gradle Builds</a> tutorial.</p>
</li>
<li>
<p>Sign up for a <a href="https://gradle.org/training/intro-to-gradle/">live introductory Gradle training</a> with a core engineer.</p>
</li>
<li>
<p>Learn how to achieve common tasks through the <a href="#command_line_interface">command-line interface</a>.</p>
</li>
<li>
<p><a href="#build_environment">Configure Gradle execution</a>, such as use of an HTTP proxy for downloading dependencies.</p>
</li>
<li>
<p>Subscribe to the <a href="https://newsletter.gradle.com/">Gradle Newsletter</a> for monthly release and community updates.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a><a class="link" href="#troubleshooting">Troubleshooting builds</a></h3>
<div class="paragraph">
<p>The following is a collection of common issues and suggestions for addressing them. You can get other tips and search the <a href="https://discuss.gradle.org/c/help-discuss">Gradle forums</a> and <a href="https://stackoverflow.com/questions/tagged/gradle">StackOverflow #gradle</a> answers, as well as Gradle documentation from <a href="https://help.gradle.org/">help.gradle.org</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:troubleshooting_installation"><a class="anchor" href="#sec:troubleshooting_installation"></a><a class="link" href="#sec:troubleshooting_installation">Troubleshooting Gradle installation</a></h4>
<div class="paragraph">
<p>If you followed the <a href="#installation">installation instructions</a>, and arent able to execute your Gradle build, here are some tips that may help.</p>
</div>
<div class="paragraph">
<p>If you installed Gradle outside of just invoking the <a href="#gradle_wrapper">Gradle Wrapper</a>, you can check your Gradle installation by running <code>gradle --version</code> in a terminal.</p>
</div>
<div class="paragraph">
<p>You should see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> gradle --version

-----------------------------------------------------------
Gradle 4.6
------------------------------------------------------------

Build time:   2018-02-21 15:28:42 UTC
Revision:     819e0059da49f469d3e9b2896dc4e72537c4847d

Groovy:       2.4.12
Ant:          Apache Ant(TM) version 1.9.9 compiled on February 2 2017
JVM:          1.8.0_151 (Oracle Corporation 25.151-b12)
OS:           Mac OS X 10.13.3 x86_64</pre>
</div>
</div>
<div class="paragraph">
<p>If not, here are some things you might see instead.</p>
</div>
<div class="sect4">
<h5 id="command_not_found_gradle"><a class="anchor" href="#command_not_found_gradle"></a><a class="link" href="#command_not_found_gradle">Command not found: gradle</a></h5>
<div class="paragraph">
<p>If you get "command not found: gradle", you need to ensure that Gradle is properly added to your <code>PATH</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="java_home_is_set_to_an_invalid_directory"><a class="anchor" href="#java_home_is_set_to_an_invalid_directory"></a><a class="link" href="#java_home_is_set_to_an_invalid_directory">JAVA_HOME is set to an invalid directory</a></h5>
<div class="paragraph">
<p>If you get something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ERROR: JAVA_HOME is set to an invalid directory

Please set the JAVA_HOME variable in your environment to match the location of your Java installation.</pre>
</div>
</div>
<div class="paragraph">
<p>Youll need to ensure that a <a href="https://jdk.java.net/">Java Development Kit</a> version 8 or higher is <a href="https://www.java.com/en/download/help/index_installing.xml">properly installed</a>, the <code>JAVA_HOME</code> environment variable is set, and <a href="https://www.java.com/en/download/help/path.xml">Java is added to your <code>PATH</code></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="permission_denied"><a class="anchor" href="#permission_denied"></a><a class="link" href="#permission_denied">Permission denied</a></h5>
<div class="paragraph">
<p>If you get "permission denied", that means that Gradle likely exists in the correct place, but it is not executable.
You can fix this using <code>chmod +x path/to/executable</code> on *nix-based systems.</p>
</div>
</div>
<div class="sect4">
<h5 id="other_installation_failures"><a class="anchor" href="#other_installation_failures"></a><a class="link" href="#other_installation_failures">Other installation failures</a></h5>
<div class="paragraph">
<p>If <code>gradle --version</code> works, but all of your builds fail with the same error, it is possible there is a problem with one of your Gradle build configuration scripts.</p>
</div>
<div class="paragraph">
<p>You can verify the problem is with Gradle scripts by running <code>gradle help</code> which executes configuration scripts, but no Gradle tasks. If the error persists, build configuration is problematic.
If not, then the problem exists within the execution of one or more of the requested tasks (Gradle executes configuration scripts first, and then executes build steps).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:troubleshooting_dependency_resolution"><a class="anchor" href="#sec:troubleshooting_dependency_resolution"></a><a class="link" href="#sec:troubleshooting_dependency_resolution">Debugging dependency resolution</a></h4>
<div class="paragraph">
<p>Common dependency resolution issues such as resolving version conflicts are covered in <a href="#">Troubleshooting Dependency Resolution</a>.</p>
</div>
<div class="paragraph">
<p>You can see a dependency tree and see which resolved dependency versions differed from what was requested by clicking the <em>Dependencies</em> view and using the search functionality, specifying the resolution reason.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/troubleshooting-dependency-management-build-scan.png" alt="troubleshooting dependency management build scan">
</div>
<div class="title">Figure 2. Debugging dependency conflicts with build scans</div>
</div>
<div class="paragraph">
<p>The <a href="https://scans.gradle.com/s/sample/troubleshooting-userguide/dependencies?expandAll&amp;filters=WzFd&amp;toggled=W1swXSxbMF0sWzAsMF0sWzAsMV1d">actual build scan</a> with filtering criteria is available for exploration.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:troubleshooting_performance"><a class="anchor" href="#sec:troubleshooting_performance"></a><a class="link" href="#sec:troubleshooting_performance">Troubleshooting slow Gradle builds</a></h4>
<div class="paragraph">
<p>For build performance issues (including slow sync time), see the guide to <a href="https://guides.gradle.org/performance/">Improving the Performance of Gradle Builds</a>.</p>
</div>
<div class="paragraph">
<p>Android developers should watch a presentation by the Android SDK Tools team about <a href="https://youtu.be/7ll-rkLCtyk">Speeding Up Your Android Gradle Builds</a>.
Many tips are also covered in the Android Studio user guide <a href="https://developer.android.com/studio/build/optimize-your-build.html">on optimizing build speed</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:troubleshooting_build_logic"><a class="anchor" href="#sec:troubleshooting_build_logic"></a><a class="link" href="#sec:troubleshooting_build_logic">Debugging build logic</a></h4>
<div class="sect4">
<h5 id="attaching_a_debugger_to_your_build"><a class="anchor" href="#attaching_a_debugger_to_your_build"></a><a class="link" href="#attaching_a_debugger_to_your_build">Attaching a debugger to your build</a></h5>
<div class="paragraph">
<p>You can set breakpoints and debug <a href="#sec:packaging_a_plugin">buildSrc and standalone plugins</a> in your Gradle build itself by setting the <code>org.gradle.debug</code> property to true and then attaching a remote debugger to port 5005.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> gradle help -Dorg.gradle.debug=true</pre>
</div>
</div>
<div class="paragraph">
<p>In addition, if youve adopted the Kotlin DSL, you can also debug build scripts themselves.</p>
</div>
<div class="paragraph">
<p>The following video demonstrates how to debug an example build using IntelliJ IDEA.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/remote-debug-gradle.gif" alt="remote debug gradle">
</div>
<div class="title">Figure 3. Interactive debugging of a build script</div>
</div>
</div>
<div class="sect4">
<h5 id="adding_and_changing_logging"><a class="anchor" href="#adding_and_changing_logging"></a><a class="link" href="#adding_and_changing_logging">Adding and changing logging</a></h5>
<div class="paragraph">
<p>In addition to <a href="#sec:command_line_logging">controlling logging verbosity</a>, you can also control display of task outcomes (e.g. UP-TO-DATE) in lifecycle logging using the <a href="#sec:command_line_customizing_log_format"><code>--console=verbose</code> flag</a>.</p>
</div>
<div class="paragraph">
<p>You can also replace much of Gradles logging with your own by registering various event listeners. One example of a <a href="#sec:changing_what_gradle_logs">custom event logger is explained in the logging documentation</a>. You can also <a href="#sec:external_tools">control logging from external tools</a>, making them more verbose in order to debug their execution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Additional logs from the <a href="#gradle_daemon">Gradle Daemon</a> can be found under <code>GRADLE_USER_HOME/daemon/&lt;gradle-version&gt;/</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="task_executed_when_it_should_have_been_up_to_date"><a class="anchor" href="#task_executed_when_it_should_have_been_up_to_date"></a><a class="link" href="#task_executed_when_it_should_have_been_up_to_date">Task executed when it should have been UP-TO-DATE</a></h5>
<div class="paragraph">
<p><code>--info</code> logs explain why a task was executed, though build scans do this in a searchable, visual way by going to the <em>Timeline</em> view and clicking on the task you want to inspect.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/troubleshooting-task-execution-build-scan.png" alt="troubleshooting task execution build scan">
</div>
<div class="title">Figure 4. Debugging incremental build with a build scan</div>
</div>
<div class="paragraph">
<p>You can learn what the task outcomes mean from <a href="#sec:task_outcomes">this listing</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:troubleshooting_ide_integration"><a class="anchor" href="#sec:troubleshooting_ide_integration"></a><a class="link" href="#sec:troubleshooting_ide_integration">Debugging IDE integration</a></h4>
<div class="paragraph">
<p>Many infrequent errors within IDEs can be solved by "refreshing" Gradle.
See also more documentation on working with Gradle <a href="https://www.jetbrains.com/help/idea/gradle.html">in IntelliJ IDEA</a> and <a href="http://www.vogella.com/tutorials/EclipseGradle/article.html">in Eclipse</a>.</p>
</div>
<div class="sect4">
<h5 id="refreshing_intellij_idea"><a class="anchor" href="#refreshing_intellij_idea"></a><a class="link" href="#refreshing_intellij_idea">Refreshing IntelliJ IDEA</a></h5>
<div class="paragraph">
<p><strong>NOTE:</strong> This only works for Gradle projects <a href="https://www.jetbrains.com/help/idea/gradle.html#link_gradle_project">linked to IntelliJ</a>.</p>
</div>
<div class="paragraph">
<p>From the main menu, go to <code>View</code> &gt; <code>Tool Windows</code> &gt; <code>Gradle</code>. Then click on the <em>Refresh</em> icon.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/troubleshooting-refresh-intellij.png" alt="troubleshooting refresh intellij">
</div>
<div class="title">Figure 5. Refreshing a Gradle project in IntelliJ IDEA</div>
</div>
</div>
<div class="sect4">
<h5 id="refreshing_eclipse_using_buildship"><a class="anchor" href="#refreshing_eclipse_using_buildship"></a><a class="link" href="#refreshing_eclipse_using_buildship">Refreshing Eclipse (using Buildship)</a></h5>
<div class="paragraph">
<p>If you&#8217;re using <a href="https://projects.eclipse.org/projects/tools.buildship">Buildship</a> for the Eclipse IDE, you can re-synchronize your Gradle build by opening the "Gradle Tasks" view and clicking the "Refresh" icon, or by executing the <code>Gradle</code> &gt; <code>Refresh Gradle Project</code> command from the context menu while editing a Gradle script.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/troubleshooting-refresh-eclipse.png" alt="troubleshooting refresh eclipse">
</div>
<div class="title">Figure 6. Refreshing a Gradle project in Eclipse Buildship</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting_additional_help"><a class="anchor" href="#getting_additional_help"></a><a class="link" href="#getting_additional_help">Getting additional help</a></h4>
<div class="paragraph">
<p>If you didn&#8217;t find a fix for your issue here, please reach out to the Gradle community on the <a href="https://discuss.gradle.org/c/help-discuss">help forum</a> or search relevant developer resources using <a href="https://help.gradle.org/">help.gradle.org</a>.</p>
</div>
<div class="paragraph">
<p>If you believe you&#8217;ve found a bug in Gradle, please <a href="https://github.com/gradle/gradle/issues">file an issue</a> on GitHub.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compatibility"><a class="anchor" href="#compatibility"></a><a class="link" href="#compatibility">Compatibility Matrix</a></h3>
<div class="paragraph">
<p>The sections below describe Gradle&#8217;s compatibility with several integrations. Other versions not listed here may or may not work.</p>
</div>
<div class="sect3">
<h4 id="java"><a class="anchor" href="#java"></a><a class="link" href="#java">Java</a></h4>
<div class="paragraph">
<p>A Java version between 8 and 14 is required to execute Gradle. Java 15 and later versions are not yet supported.</p>
</div>
<div class="paragraph">
<p>Java 6 and 7 can still be used for <a href="#sec:java_cross_compilation">compilation and forked test execution</a>.</p>
</div>
<div class="paragraph">
<p>Any supported version of Java can be used for compile or test.</p>
</div>
</div>
<div class="sect3">
<h4 id="kotlin"><a class="anchor" href="#kotlin"></a><a class="link" href="#kotlin">Kotlin</a></h4>
<div class="paragraph">
<p>Gradle is tested with Kotlin 1.3.21 through 1.3.71.</p>
</div>
</div>
<div class="sect3">
<h4 id="groovy"><a class="anchor" href="#groovy"></a><a class="link" href="#groovy">Groovy</a></h4>
<div class="paragraph">
<p>Gradle is tested with Groovy 1.5.8 through 2.5.10.</p>
</div>
</div>
<div class="sect3">
<h4 id="android"><a class="anchor" href="#android"></a><a class="link" href="#android">Android</a></h4>
<div class="paragraph">
<p>Gradle is tested with Android Gradle Plugin 3.4, 3.5 and 3.6.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:upgrading_and_migrating"><a class="anchor" href="#part:upgrading_and_migrating"></a><a class="link" href="#part:upgrading_and_migrating">Upgrading and Migrating</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="upgrading_version_6"><a class="anchor" href="#upgrading_version_6"></a><a class="link" href="#upgrading_version_6">Upgrading your build from Gradle 6.x to the latest</a></h3>
<div class="paragraph">
<p>This chapter provides the information you need to migrate your Gradle 6.x builds to the latest Gradle release. For migrating from Gradle 4.x or 5.x, see the <a href="#upgrading_version_5">older migration guide</a> first.</p>
</div>
<div class="paragraph">
<p>We recommend the following steps for all users:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try running <code>gradle help --scan</code> and view the <a href="https://gradle.com/enterprise/releases/2018.4/#identify-usages-of-deprecated-gradle-functionality">deprecations view</a> of the generated build scan.</p>
<div class="imageblock">
<div class="content">
<img src="img/deprecations.png" alt="Deprecations View of a Gradle Build Scan">
</div>
</div>
<div class="paragraph">
<p>This is so that you can see any deprecation warnings that apply to your build.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could run <code>gradle help --warning-mode=all</code> to see the deprecations in the console, though it may not report as much detailed information.</p>
</div>
</li>
<li>
<p>Update your plugins.</p>
<div class="paragraph">
<p>Some plugins will break with this new version of Gradle, for example because they use internal APIs that have been removed or changed. The previous step will help you identify potential problems by issuing deprecation warnings when a plugin does try to use a deprecated part of the API.</p>
</div>
</li>
<li>
<p>Run <code>gradle wrapper --gradle-version 6.4.1</code> to update the project to 6.4.1.</p>
</li>
<li>
<p>Try to run the project and debug any errors using the <a href="#troubleshooting">Troubleshooting Guide</a>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="changes_6.4"><a class="anchor" href="#changes_6.4"></a><a class="link" href="#changes_6.4">Upgrading from 6.3</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes"><a class="anchor" href="#potential_breaking_changes"></a><a class="link" href="#potential_breaking_changes">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="upgrade:pmd_expects_6"><a class="anchor" href="#upgrade:pmd_expects_6"></a><a class="link" href="#upgrade:pmd_expects_6">PMD plugin expects PMD 6.0.0 or higher by default</a></h6>
<div class="paragraph">
<p>Gradle 6.4 enabled incremental analysis by default.
Incremental analysis is only available in PMD 6.0.0 or higher.
If you want to use an older PMD version, you need to disable incremental analysis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>pmd {
    incrementalAnalysis = false
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="changes_in_dependency_locking"><a class="anchor" href="#changes_in_dependency_locking"></a><a class="link" href="#changes_in_dependency_locking">Changes in dependency locking</a></h6>
<div class="paragraph">
<p>With Gradle 6.4, the incubating API for <a href="#fine_tuning_dependency_locking_behaviour_with_lock_mode">dependency locking <code>LockMode</code></a> has changed.
The value is now set via a <code>Property&lt;LockMode&gt;</code> instead of a direct setter.
This means that the notation to set the value has to be updated for the Kotlin DSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>dependencyLocking {
    lockMode.set(LockMode.STRICT)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Users of the Groovy DSL should not be impacted as the notation <code>lockMode = LockMode.STRICT</code> remains valid.</p>
</div>
</div>
<div class="sect5">
<h6 id="java_versions_in_published_metadata"><a class="anchor" href="#java_versions_in_published_metadata"></a><a class="link" href="#java_versions_in_published_metadata">Java versions in published metadata</a></h6>
<div class="paragraph">
<p>If a Java library is published with Gradle Module Metadata, the information which Java version it supports is encoded in the <code>org.gradle.jvm.version</code> attribute.
By default, this attribute was set to what you configured in <code>java.targetCompatibility</code>.
If that was not configured, it was set to the current Java version running Gradle.
Changing the version of a particular compile task, e.g. <code>javaCompile.targetCompatibility</code> had no effect on that attribute, leading to wrong information if the attribute was not adjusted manually.
This is now fixed and the attribute defaults to the setting of the compile task that is associated with the sources from which the published jar is built.</p>
</div>
</div>
<div class="sect5">
<h6 id="ivy_repositories_with_custom_layouts"><a class="anchor" href="#ivy_repositories_with_custom_layouts"></a><a class="link" href="#ivy_repositories_with_custom_layouts">Ivy repositories with custom layouts</a></h6>
<div class="paragraph">
<p>Gradle versions from 6.0 to 6.3.x included could generate bad Gradle Module Metadata when publishing on an Ivy repository which had a custom repository layout.
Starting from 6.4, Gradle will no longer publish Gradle Module Metadata if it detects that you are using a custom repository layout.</p>
</div>
</div>
<div class="sect5">
<h6 id="new_properties_may_shadow_variables_in_build_scripts"><a class="anchor" href="#new_properties_may_shadow_variables_in_build_scripts"></a><a class="link" href="#new_properties_may_shadow_variables_in_build_scripts">New properties may shadow variables in build scripts</a></h6>
<div class="paragraph">
<p>This release introduces some new properties&#8201;&#8212;&#8201;<code>mainClass</code>, <code>mainModule</code>, <code>modularity</code>&#8201;&#8212;&#8201;in different places.
Since these are very generic names, there is a chance that you use one of them in your build scripts as variable name.
A new property might then shadow one of your variables in an undesired way, leading to a build failure where the property is accessed instead of the local variable with the same name.
You can fix it by renaming the corresponding variable in the build script.</p>
</div>
<div class="paragraph">
<p>Affected is configuration code inside the <code>application {}</code> and <code>java {}</code> configuration blocks, inside a java execution setup with <code>project.javaexec {}</code>, and inside various task configurations
(<code>JavaExec</code>, <code>CreateStartScripts</code>, <code>JavaCompile</code>, <code>Test</code>, <code>Javadoc</code>).</p>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_bundled_gradle_dependencies"><a class="anchor" href="#updates_to_bundled_gradle_dependencies"></a><a class="link" href="#updates_to_bundled_gradle_dependencies">Updates to bundled Gradle dependencies</a></h6>
<div class="ulist">
<ul>
<li>
<p>Kotlin has been updated to <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.3.71">Kotlin 1.3.71</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deprecations"><a class="anchor" href="#deprecations"></a><a class="link" href="#deprecations">Deprecations</a></h5>
<div class="paragraph">
<p>There were no deprecations between Gradle 6.3 and 6.4.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_6.3"><a class="anchor" href="#changes_6.3"></a><a class="link" href="#changes_6.3">Upgrading from 6.2</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_2"><a class="anchor" href="#potential_breaking_changes_2"></a><a class="link" href="#potential_breaking_changes_2">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="fewer_dependencies_available_in_idea"><a class="anchor" href="#fewer_dependencies_available_in_idea"></a><a class="link" href="#fewer_dependencies_available_in_idea">Fewer dependencies available in IDEA</a></h6>
<div class="paragraph">
<p>Gradle no longer includes the annotation processor classpath as provided dependencies in IDEA.
The dependencies IDEA sees at compile time are the same as what Gradle sees after resolving the compile classpath (configuration named <code>compileClasspath</code>).
This prevents the leakage of annotation processor dependencies into the project&#8217;s code.</p>
</div>
<div class="paragraph">
<p>Before Gradle introduced <a href="#sec:incremental_annotation_processing">incremental annotation processing support</a>, IDEA required all annotation processors to be on the compilation classpath to be able to run annotation processing when compiling in IDEA.
This is no longer necessary because Gradle has a separate <a href="#tab:configurations">annotation processor classpath</a>.
The dependencies for annotation processors are not added to an IDEA module&#8217;s classpath when a Gradle project with annotation processors is imported.</p>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_bundled_gradle_dependencies_2"><a class="anchor" href="#updates_to_bundled_gradle_dependencies_2"></a><a class="link" href="#updates_to_bundled_gradle_dependencies_2">Updates to bundled Gradle dependencies</a></h6>
<div class="ulist">
<ul>
<li>
<p>Kotlin has been updated to <a href="https://blog.jetbrains.com/kotlin/2020/03/kotlin-1-3-70-released/">Kotlin 1.3.70</a>.</p>
</li>
<li>
<p>Groovy has been updated to <a href="http://groovy-lang.org/changelogs/changelog-2.5.10.html">Groovy 2.5.10</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_default_tool_integration_versions"><a class="anchor" href="#updates_to_default_tool_integration_versions"></a><a class="link" href="#updates_to_default_tool_integration_versions">Updates to default tool integration versions</a></h6>
<div class="ulist">
<ul>
<li>
<p>PMD has been updated to <a href="https://pmd.github.io/pmd-6.21.0/pmd_release_notes.html#24-january-2020---6210">PMD 6.21.0</a>.</p>
</li>
<li>
<p>CodeNarc has been updated to <a href="https://github.com/CodeNarc/CodeNarc/blob/v1.5/CHANGELOG.md#version-15----nov-2019">CodeNarc 1.5</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="rich_console_support_removed_for_some_32_bit_operating_systems"><a class="anchor" href="#rich_console_support_removed_for_some_32_bit_operating_systems"></a><a class="link" href="#rich_console_support_removed_for_some_32_bit_operating_systems">Rich console support removed for some 32-bit operating systems</a></h6>
<div class="paragraph">
<p>Gradle 6.3 does not support the <a href="#sec:rich_console">rich console</a> for 32-bit Unix systems and for old FreeBSD versions (older than FreeBSD 10). Microsoft Windows 32-bit is unaffected.</p>
</div>
<div class="paragraph">
<p>Gradle will continue building projects on 32-bit systems but will no longer show the rich console.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deprecations_2"><a class="anchor" href="#deprecations_2"></a><a class="link" href="#deprecations_2">Deprecations</a></h5>
<div class="sect5">
<h6 id="using_default_and_archives_configurations"><a class="anchor" href="#using_default_and_archives_configurations"></a><a class="link" href="#using_default_and_archives_configurations">Using default and archives configurations</a></h6>
<div class="paragraph">
<p>Almost every Gradle project has the <em>default</em> and <em>archives</em> configurations which are added by the <em>base</em> plugin.
These configurations are no longer used in modern Gradle builds that use <a href="#">variant aware dependency management</a> and the <a href="#">new publishing plugins</a>.</p>
</div>
<div class="paragraph">
<p>While the configurations will stay in Gradle for backwards compatibility for now, using them to declare dependencies or to resolve dependencies is now deprecated.</p>
</div>
<div class="paragraph">
<p>Resolving these configurations was never an intended use case and only possible because in earlier Gradle versions <em>every</em> configuration was resolvable.
For declaring dependencies, please use the configurations provided by the plugins you use, for example by the <a href="#sec:java_library_configurations_graph">Java Library plugin</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_6.2"><a class="anchor" href="#changes_6.2"></a><a class="link" href="#changes_6.2">Upgrading from 6.1</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_3"><a class="anchor" href="#potential_breaking_changes_3"></a><a class="link" href="#potential_breaking_changes_3">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="compile_and_runtime_classpath_now_request_library_variants_by_default"><a class="anchor" href="#compile_and_runtime_classpath_now_request_library_variants_by_default"></a><a class="link" href="#compile_and_runtime_classpath_now_request_library_variants_by_default">Compile and runtime classpath now request library variants by default</a></h6>
<div class="paragraph">
<p>A classpath in a JVM project now explicitly requests the <code>org.gradle.category=library</code> attribute.
This leads to clearer error messages if a certain library cannot be used.
For example, when the library does not support the required Java version.
The practical effect is that now all <a href="#sec:java_platform_consumption">platform dependencies</a> have to be declared as such.
Before, platform dependencies also worked, accidentally, when the <code>platform()</code> keyword was omitted for local platforms or platforms published with Gradle Module Metadata.</p>
</div>
</div>
<div class="sect5">
<h6 id="properties_from_project_root_gradle_properties_leaking_into_buildsrc_and_included_builds"><a class="anchor" href="#properties_from_project_root_gradle_properties_leaking_into_buildsrc_and_included_builds"></a><a class="link" href="#properties_from_project_root_gradle_properties_leaking_into_buildsrc_and_included_builds">Properties from project root <code>gradle.properties</code> leaking into <code>buildSrc</code> and included builds</a></h6>
<div class="paragraph">
<p>There was a regression in Gradle 6.2 and Gradle 6.2.1 that caused Gradle properties set in the project root <code>gradle.properties</code> file to leak into the <code>buildSrc</code> build and any builds included by the root.</p>
</div>
<div class="paragraph">
<p>This could cause your build to start failing if the <code>buildSrc</code> build or an included build suddenly found an unexpected or incompatible value for a property coming from the project root <code>gradle.properties</code> file.</p>
</div>
<div class="paragraph">
<p>The regression has been fixed in Gradle 6.2.2.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deprecations_3"><a class="anchor" href="#deprecations_3"></a><a class="link" href="#deprecations_3">Deprecations</a></h5>
<div class="paragraph">
<p>There were no deprecations between Gradle 6.1 and 6.2.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_6.1"><a class="anchor" href="#changes_6.1"></a><a class="link" href="#changes_6.1">Upgrading from 6.0 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_4"><a class="anchor" href="#deprecations_4"></a><a class="link" href="#deprecations_4">Deprecations</a></h5>
<div class="sect5">
<h6 id="querying_a_mapped_output_property_of_a_task_before_the_task_has_completed"><a class="anchor" href="#querying_a_mapped_output_property_of_a_task_before_the_task_has_completed"></a><a class="link" href="#querying_a_mapped_output_property_of_a_task_before_the_task_has_completed">Querying a mapped output property of a task before the task has completed</a></h6>
<div class="paragraph">
<p>Querying the value of a mapped output property before the task has completed can cause strange build failures because it indicates stale or non-existent outputs may be used by mistake. This behavior is deprecated and will emit a deprecation warning. This will become an error in Gradle 7.0.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates this problem where the Producer&#8217;s output file is parsed before the Producer executes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>class Consumer extends DefaultTask {
    @Input
    final Property&lt;Integer&gt; threadPoolSize = ...
}

class Producer extends DefaultTask {
    @OutputFile
    final RegularFileProperty outputFile = ...
}

// threadPoolSize is read from the producer's outputFile
consumer.threadPoolSize = producer.outputFile.map { it.text.toInteger() }

// Emits deprecation warning
println("thread pool size = " + consumer.threadPoolSize.get())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Querying the value of <code>consumer.threadPoolSize</code> will produce a deprecation warning if done prior to <code>producer</code> completing, as the output file has not yet been generated.</p>
</div>
</div>
<div class="sect5">
<h6 id="discontinued_methods"><a class="anchor" href="#discontinued_methods"></a><a class="link" href="#discontinued_methods">Discontinued methods</a></h6>
<div class="paragraph">
<p>The following methods have been discontinued and should no longer be used. They will be removed in Gradle 7.0.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasePluginConvention.setProject(ProjectInternal)</code></p>
</li>
<li>
<p><code>BasePluginConvention.getProject()</code></p>
</li>
<li>
<p><code>StartParameter.useEmptySettings()</code></p>
</li>
<li>
<p><code>StartParameter.isUseEmptySettings()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="upgrading_jvm_plugins"><a class="anchor" href="#upgrading_jvm_plugins"></a><a class="link" href="#upgrading_jvm_plugins">Alternative JVM plugins (a.k.a "Software Model")</a></h6>
<div class="paragraph">
<p>A set of alternative plugins for Java and Scala development were introduced in Gradle 2.x as an experiment based on the "software model".  These plugins are now deprecated and will eventually be removed.  If you are still using one of these old plugins (<code>java-lang</code>, <code>scala-lang</code>, <code>jvm-component</code>, <code>jvm-resources</code>, <code>junit-test-suite</code>) please consult the documentation on <a href="#">Building Java &amp; JVM projects</a> to determine which of the stable JVM plugins are appropriate for your project.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_4"><a class="anchor" href="#potential_breaking_changes_4"></a><a class="link" href="#potential_breaking_changes_4">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="projectlayout_is_no_longer_available_to_worker_actions_as_a_service"><a class="anchor" href="#projectlayout_is_no_longer_available_to_worker_actions_as_a_service"></a><a class="link" href="#projectlayout_is_no_longer_available_to_worker_actions_as_a_service"><code>ProjectLayout</code> is no longer available to worker actions as a service</a></h6>
<div class="paragraph">
<p>In Gradle 6.0, the <code>ProjectLayout</code> service was made available to worker actions via service injection. This service allowed for mutable state to leak into a worker action and introduced a way for dependencies to go undeclared in the worker action.</p>
</div>
<div class="paragraph">
<p><code>ProjectLayout</code> has been removed from the available services.  Worker actions that were using <code>ProjectLayout</code> should switch to injecting the <code>projectDirectory</code> or <code>buildDirectory</code> as a parameter instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_bundled_gradle_dependencies_3"><a class="anchor" href="#updates_to_bundled_gradle_dependencies_3"></a><a class="link" href="#updates_to_bundled_gradle_dependencies_3">Updates to bundled Gradle dependencies</a></h6>
<div class="ulist">
<ul>
<li>
<p>Kotlin has been updated to <a href="https://blog.jetbrains.com/kotlin/2019/11/kotlin-1-3-60-released/">Kotlin 1.3.61</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_default_tool_integration_versions_2"><a class="anchor" href="#updates_to_default_tool_integration_versions_2"></a><a class="link" href="#updates_to_default_tool_integration_versions_2">Updates to default tool integration versions</a></h6>
<div class="ulist">
<ul>
<li>
<p>Checkstyle has been updated to <a href="https://checkstyle.org/releasenotes.html#Release_8.27">Checkstyle 8.27</a>.</p>
</li>
<li>
<p>PMD has been updated to <a href="https://pmd.github.io/pmd-6.20.0/pmd_release_notes.html#29-november-2019---6200">PMD 6.20.0</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="publishing_spring_boot_applications"><a class="anchor" href="#publishing_spring_boot_applications"></a><a class="link" href="#publishing_spring_boot_applications">Publishing Spring Boot applications</a></h6>
<div class="paragraph">
<p>Starting from Gradle 6.2, Gradle performs a sanity check before uploading, to make sure you don&#8217;t upload stale files (files produced by another build).
This introduces a problem with Spring Boot applications which are uploaded using the <code>components.java</code> component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Artifact my-application-0.0.1-SNAPSHOT.jar wasn't produced by this build.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is caused by the fact that the main <code>jar</code> task is disabled by the Spring Boot application, and the component expects it to be present.
Because the <code>bootJar</code> task uses the <em>same file</em> as the main <code>jar</code> task by default, previous releases of Gradle would either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>publish a stale <code>bootJar</code> artifact</p>
</li>
<li>
<p>or fail if the <code>bootJar</code> task hasn&#8217;t been called previously</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A workaround is to tell Gradle what to upload.
If you want to upload the <code>bootJar</code>, then you need to configure the outgoing configurations to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>configurations {
   [apiElements, runtimeElements].each {
       it.outgoing.artifacts.removeIf { it.buildDependencies.getDependencies(null).contains(jar) }
       it.outgoing.artifact(bootJar)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you might want to re-enable the <code>jar</code> task, and add the <code>bootJar</code> with a different classifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>jar {
   enabled = true
}

bootJar {
   classifier = 'application'
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_version_5"><a class="anchor" href="#upgrading_version_5"></a><a class="link" href="#upgrading_version_5">Upgrading your build from Gradle 5.x to 6.0</a></h3>
<div class="paragraph">
<p>This chapter provides the information you need to migrate your Gradle 5.x builds to Gradle 6.0. For migrating from Gradle 4.x, complete the <a href="#upgrading_version_4">4.x to 5.0 guide</a> first.</p>
</div>
<div class="paragraph">
<p>We recommend the following steps for all users:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try running <code>gradle help --scan</code> and view the <a href="https://gradle.com/enterprise/releases/2018.4/#identify-usages-of-deprecated-gradle-functionality">deprecations view</a> of the generated build scan.</p>
<div class="imageblock">
<div class="content">
<img src="img/deprecations.png" alt="Deprecations View of a Gradle Build Scan">
</div>
</div>
<div class="paragraph">
<p>This is so that you can see any deprecation warnings that apply to your build.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could run <code>gradle help --warning-mode=all</code> to see the deprecations in the console, though it may not report as much detailed information.</p>
</div>
</li>
<li>
<p>Update your plugins.</p>
<div class="paragraph">
<p>Some plugins will break with this new version of Gradle, for example because they use internal APIs that have been removed or changed. The previous step will help you identify potential problems by issuing deprecation warnings when a plugin does try to use a deprecated part of the API.</p>
</div>
</li>
<li>
<p>Run <code>gradle wrapper --gradle-version 6.4.1</code> to update the project to 6.4.1.</p>
</li>
<li>
<p>Try to run the project and debug any errors using the <a href="#troubleshooting">Troubleshooting Guide</a>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="changes_6.0"><a class="anchor" href="#changes_6.0"></a><a class="link" href="#changes_6.0">Upgrading from 5.6 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_5"><a class="anchor" href="#deprecations_5"></a><a class="link" href="#deprecations_5">Deprecations</a></h5>
<div class="sect5">
<h6 id="dependencies_should_no_longer_be_declared_using_the_compile_and_runtime_configurations"><a class="anchor" href="#dependencies_should_no_longer_be_declared_using_the_compile_and_runtime_configurations"></a><a class="link" href="#dependencies_should_no_longer_be_declared_using_the_compile_and_runtime_configurations">Dependencies should no longer be declared using the <code>compile</code> and <code>runtime</code> configurations</a></h6>
<div class="paragraph">
<p>The usage of the <code>compile</code> and <code>runtime</code> configurations in the Java ecosystem plugins has been discouraged since <a href="https://docs.gradle.org/3.4/release-notes.html#the-java-library-plugin">Gradle 3.4</a>.</p>
</div>
<div class="paragraph">
<p>These configurations are used for compiling and running code from the <code>main</code> source set.
Other sources sets create similar configurations (e.g. <code>testCompile</code> and <code>testRuntime</code> for the <code>test</code> source set), should not be used either.
The <code>implementation</code>, <code>api</code>, <code>compileOnly</code> and <code>runtimeOnly</code> configurations should be used to declare dependencies and the <code>compileClasspath</code> and <code>runtimeClasspath</code> configurations to resolve dependencies.
See <a href="#sec:java_library_configurations_graph">the relationship of these configurations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="legacy_publication_system_is_deprecated_and_replaced_with_the_publish_plugins"><a class="anchor" href="#legacy_publication_system_is_deprecated_and_replaced_with_the_publish_plugins"></a><a class="link" href="#legacy_publication_system_is_deprecated_and_replaced_with_the_publish_plugins">Legacy publication system is deprecated and replaced with the <code>*-publish</code> plugins</a></h6>
<div class="paragraph">
<p>The <code>uploadArchives</code> task and the <code>maven</code> plugin are deprecated.</p>
</div>
<div class="paragraph">
<p>Users should migrate to the <a href="#">publishing system</a> of Gradle by using either the <a href="#"><code>maven-publish</code></a> or <a href="#"><code>ivy-publish</code></a> plugins.
These plugins have been stable since Gradle 4.8.</p>
</div>
<div class="paragraph">
<p>The publishing system is also the only way to ensure the publication of <a href="#">Gradle Module Metadata</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="problems_with_tasks_emit_deprecation_warnings"><a class="anchor" href="#problems_with_tasks_emit_deprecation_warnings"></a><a class="link" href="#problems_with_tasks_emit_deprecation_warnings">Problems with tasks emit deprecation warnings</a></h6>
<div class="paragraph">
<p>When Gradle detects problems with task definitions (such as incorrectly defined inputs or outputs) it will show the following message on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Deprecated Gradle features were used in this build, making it incompatible with Gradle 7.0.
Use '--warning-mode all' to show the individual deprecation warnings.
See https://docs.gradle.org/6.0/userguide/command_line_interface.html#sec:command_line_warnings</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deprecation warnings show up in <a href="https://scans.gradle.com/s/txrptciitl2ha/deprecations">build scans</a> for every build, regardless of the command-line switches used.</p>
</div>
<div class="paragraph">
<p>When the build is executed with <code>--warning-mode all</code>, the individual warnings will be shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; Task :myTask
Property 'inputDirectory' is declared without normalization specified. Properties of cacheable work must declare their normalization via @PathSensitive, @Classpath or @CompileClasspath. Defaulting to PathSensitivity.ABSOLUTE. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.
Property 'outputFile' is not annotated with an input or output annotation. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you own the code of the tasks in question, you can fix them by <a href="#sec:task_input_validation">following the suggestions</a>. You can also use <code>--stacktrace</code> to see where in the code each warning originates from.</p>
</div>
<div class="paragraph">
<p>Otherwise, you&#8217;ll need to report the problems to the maintainer of the relevant task or plugin.</p>
</div>
</div>
<div class="sect5">
<h6 id="old_api_for_incremental_tasks_incrementaltaskinputs_has_been_deprecated"><a class="anchor" href="#old_api_for_incremental_tasks_incrementaltaskinputs_has_been_deprecated"></a><a class="link" href="#old_api_for_incremental_tasks_incrementaltaskinputs_has_been_deprecated">Old API for incremental tasks, <code>IncrementalTaskInputs</code>, has been deprecated</a></h6>
<div class="paragraph">
<p>In Gradle 5.4 we introduced a new API for implementing <a href="#incremental_tasks">incremental tasks</a>: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a>. The old API based on <code>IncrementalTaskInputs</code> has been deprecated.</p>
</div>
</div>
<div class="sect5">
<h6 id="forced_dependencies"><a class="anchor" href="#forced_dependencies"></a><a class="link" href="#forced_dependencies">Forced dependencies</a></h6>
<div class="paragraph">
<p>Forcing dependency versions using <code>force = true</code> on a first-level dependency has been deprecated.</p>
</div>
<div class="paragraph">
<p>Force has both a semantic and ordering issue which can be avoided by using a <a href="#rich-version-constraints">strict version constraint</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="search_upwards_related_apis_in_startparameter_have_been_deprecated"><a class="anchor" href="#search_upwards_related_apis_in_startparameter_have_been_deprecated"></a><a class="link" href="#search_upwards_related_apis_in_startparameter_have_been_deprecated">Search upwards related APIs in <code>StartParameter</code> have been deprecated</a></h6>
<div class="paragraph">
<p>In Gradle 5.0, we removed the <code>--no-search-upward</code> CLI parameter.</p>
</div>
<div class="paragraph">
<p>The related APIs in <code>StartParameter</code> (like <code>isSearchUpwards()</code>) are now deprecated.</p>
</div>
</div>
<div class="sect5">
<h6 id="apis_buildlistener_buildstarted_and_gradle_buildstarted_have_been_deprecated"><a class="anchor" href="#apis_buildlistener_buildstarted_and_gradle_buildstarted_have_been_deprecated"></a><a class="link" href="#apis_buildlistener_buildstarted_and_gradle_buildstarted_have_been_deprecated">APIs <code>BuildListener.buildStarted</code> and <code>Gradle.buildStarted</code> have been deprecated</a></h6>
<div class="paragraph">
<p>These methods currently do not work as expected since the callbacks will never be called after the build has started.</p>
</div>
<div class="paragraph">
<p>The methods are being deprecated to avoid confusion.</p>
</div>
</div>
<div class="sect5">
<h6 id="implicit_duplicate_strategy_for_copy_or_archive_tasks_has_been_deprecated"><a class="anchor" href="#implicit_duplicate_strategy_for_copy_or_archive_tasks_has_been_deprecated"></a><a class="link" href="#implicit_duplicate_strategy_for_copy_or_archive_tasks_has_been_deprecated">Implicit duplicate strategy for <code>Copy</code> or archive tasks has been deprecated</a></h6>
<div class="paragraph">
<p>Archive tasks <code>Tar</code> and <code>Zip</code> by default allow multiple entries for the same path to exist in the created archive.
This can cause <a href="https://github.com/gradle/gradle/issues/9990">"grossly invalid zip files" that can trigger zip bomb detection</a>.</p>
</div>
<div class="paragraph">
<p>To prevent this from happening accidentally, encountering duplicates while creating an archive now produces a deprecation message and will fail the build starting with Gradle 7.0.</p>
</div>
<div class="paragraph">
<p><code>Copy</code> tasks also happily copy multiple sources with the same relative path to the destination directory.
This behavior has also been deprecated.</p>
</div>
<div class="paragraph">
<p>If you want to allow duplicates, you can specify that explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>task archive(type: Zip) {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE // allow duplicates
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="executing_gradle_without_a_settings_file_has_been_deprecated"><a class="anchor" href="#executing_gradle_without_a_settings_file_has_been_deprecated"></a><a class="link" href="#executing_gradle_without_a_settings_file_has_been_deprecated">Executing Gradle without a settings file has been deprecated</a></h6>
<div class="paragraph">
<p>A Gradle build is defined by a <code>settings.gradle[.kts]</code> file in the current or parent directory.
Without a settings file, a Gradle build is undefined and will emit a deprecation warning.</p>
</div>
<div class="paragraph">
<p>In Gradle 7.0, Gradle will only allow you to invoke the <code>init</code> task or diagnostic command line flags, such as <code>--version</code>, with undefined builds.</p>
</div>
</div>
<div class="sect5">
<h6 id="calling_project_afterevaluate_on_an_evaluated_project_has_been_deprecated"><a class="anchor" href="#calling_project_afterevaluate_on_an_evaluated_project_has_been_deprecated"></a><a class="link" href="#calling_project_afterevaluate_on_an_evaluated_project_has_been_deprecated">Calling <code>Project.afterEvaluate</code> on an evaluated project has been deprecated</a></h6>
<div class="paragraph">
<p>Once a project is evaluated, Gradle ignores all configuration passed to <code>Project#afterEvaluate</code> and emits a deprecation warning. This scenario will become an error in Gradle 7.0.</p>
</div>
</div>
<div class="sect5">
<h6 id="deprecated_plugins"><a class="anchor" href="#deprecated_plugins"></a><a class="link" href="#deprecated_plugins">Deprecated plugins</a></h6>
<div class="paragraph">
<p>The following bundled plugins were never announced and will be removed in the next major release of Gradle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.coffeescript-base</code></p>
</li>
<li>
<p><code>org.gradle.envjs</code></p>
</li>
<li>
<p><code>org.gradle.javascript-base</code></p>
</li>
<li>
<p><code>org.gradle.jshint</code></p>
</li>
<li>
<p><code>org.gradle.rhino</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of these plugins may have replacements on the <a href="https://plugins.gradle.org/">Plugin Portal</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_5"><a class="anchor" href="#potential_breaking_changes_5"></a><a class="link" href="#potential_breaking_changes_5">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="android_gradle_plugin_3_3_and_earlier_is_no_longer_supported"><a class="anchor" href="#android_gradle_plugin_3_3_and_earlier_is_no_longer_supported"></a><a class="link" href="#android_gradle_plugin_3_3_and_earlier_is_no_longer_supported">Android Gradle Plugin 3.3 and earlier is no longer supported</a></h6>
<div class="paragraph">
<p>Gradle 6.0 supports Android Gradle Plugin versions 3.4 and later.</p>
</div>
</div>
<div class="sect5">
<h6 id="build_scan_plugin_2_x_is_no_longer_supported"><a class="anchor" href="#build_scan_plugin_2_x_is_no_longer_supported"></a><a class="link" href="#build_scan_plugin_2_x_is_no_longer_supported">Build scan plugin 2.x is no longer supported</a></h6>
<div class="paragraph">
<p>For Gradle 6, usage of the build scan plugin must be replaced with the Gradle Enterprise plugin.
This also requires changing how the plugin is applied.
Please see <a href="https://gradle.com/help/gradle-6-build-scan-plugin" class="bare">https://gradle.com/help/gradle-6-build-scan-plugin</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_bundled_gradle_dependencies_4"><a class="anchor" href="#updates_to_bundled_gradle_dependencies_4"></a><a class="link" href="#updates_to_bundled_gradle_dependencies_4">Updates to bundled Gradle dependencies</a></h6>
<div class="ulist">
<ul>
<li>
<p>Groovy has been updated to <a href="http://groovy-lang.org/changelogs/changelog-2.5.8.html">Groovy 2.5.8</a>.</p>
</li>
<li>
<p>Kotlin has been updated to <a href="https://blog.jetbrains.com/kotlin/2019/08/kotlin-1-3-50-released/">Kotlin 1.3.50</a>.</p>
</li>
<li>
<p>Ant has been updated to <a href="https://archive.apache.org/dist/ant/RELEASE-NOTES-1.10.7.html">Ant 1.10.7</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="updates_to_default_integration_versions"><a class="anchor" href="#updates_to_default_integration_versions"></a><a class="link" href="#updates_to_default_integration_versions">Updates to default integration versions</a></h6>
<div class="ulist">
<ul>
<li>
<p>Checkstyle has been updated to <a href="https://checkstyle.org/releasenotes.html#Release_8.24">Checkstyle 8.24</a>.</p>
</li>
<li>
<p>CodeNarc has been updated to <a href="https://github.com/CodeNarc/CodeNarc/blob/master/CHANGELOG.md#version-14---may-2019">CodeNarc 1.4</a>.</p>
</li>
<li>
<p>PMD has been updated to <a href="https://pmd.github.io/latest/pmd_release_notes.html#28-july-2019---6170">PMD 6.17.0</a>.</p>
</li>
<li>
<p>JaCoCo has been updated to <a href="http://www.jacoco.org/jacoco/trunk/doc/changes.html">0.8.5</a>. Contributed by <a href="https://github.com/Godin">Evgeny Mandrikov</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_build_and_task_names_in_composite_builds"><a class="anchor" href="#changes_to_build_and_task_names_in_composite_builds"></a><a class="link" href="#changes_to_build_and_task_names_in_composite_builds">Changes to build and task names in composite builds</a></h6>
<div class="paragraph">
<p>Previously, Gradle used the name of the root project as the build name for an included build.
Now, the name of the build&#8217;s root directory is used and the root project name is not considered if different.
A different name for the build can be specified if the build is being included via a settings file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeBuild(&quot;some-other-build&quot;) {
    name = &quot;another-name&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous behavior was problematic as it caused different names to be used at different times during the build.</p>
</div>
</div>
<div class="sect5">
<h6 id="buildsrc_is_now_reserved_as_a_project_and_subproject_build_name"><a class="anchor" href="#buildsrc_is_now_reserved_as_a_project_and_subproject_build_name"></a><a class="link" href="#buildsrc_is_now_reserved_as_a_project_and_subproject_build_name">buildSrc is now reserved as a project and subproject build name</a></h6>
<div class="paragraph">
<p>Previously, Gradle did not prevent using the name buildSrc for a subproject of a multi-project build or as the name of an included build.
Now, this is not allowed.
The name buildSrc is now reserved for the conventional buildSrc project that builds extra build logic.</p>
</div>
<div class="paragraph">
<p>Typical use of buildSrc is unaffected by this change.
You will only be affected if your settings file specifies <code>include("buildSrc")</code> or <code>includeBuild("buildSrc")</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="scala_zinc_compiler"><a class="anchor" href="#scala_zinc_compiler"></a><a class="link" href="#scala_zinc_compiler">Scala Zinc compiler</a></h6>
<div class="paragraph">
<p>The Zinc compiler has been upgraded to version 1.3.0. Gradle no longer supports building for Scala 2.9.</p>
</div>
<div class="paragraph">
<p>The minimum Zinc compiler supported by Gradle is 1.2.0 and the maximum tested version is 1.3.0.</p>
</div>
<div class="paragraph">
<p>To make it easier to select the version of the Zinc compiler, you can now configure a <code>zincVersion</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>scala {
    zincVersion = "1.2.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please remove any explicit dependencies you&#8217;ve added to the <code>zinc</code> configuration and use this property instead.
If you try to use the <code>com.typesafe.zinc:zinc</code> dependency, Gradle will switch to the new Zinc implementation.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_build_cache"><a class="anchor" href="#changes_to_build_cache"></a><a class="link" href="#changes_to_build_cache">Changes to Build Cache</a></h6>

</div>
<div class="sect5">
<h6 id="local_build_cache_is_always_a_directory_cache"><a class="anchor" href="#local_build_cache_is_always_a_directory_cache"></a><a class="link" href="#local_build_cache_is_always_a_directory_cache">Local build cache is always a directory cache</a></h6>
<div class="paragraph">
<p>In the past, it was possible to use any build cache implementation as the <code>local</code> cache.  This is no longer allowed as the local cache must always be a <code>DirectoryBuildCache</code>.</p>
</div>
<div class="paragraph">
<p>Calls to <code>BuildCacheConfiguration.local(Class)</code> with anything other than <code>DirectoryBuildCache</code> as the type will fail the build. Calling these methods with the <code>DirectoryBuildCache</code> type will produce a deprecation warning.</p>
</div>
<div class="paragraph">
<p>Use <code>getLocal()</code> and <code>local(Action)</code> instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="failing_to_pack_or_unpack_cached_results_will_now_fail_the_build"><a class="anchor" href="#failing_to_pack_or_unpack_cached_results_will_now_fail_the_build"></a><a class="link" href="#failing_to_pack_or_unpack_cached_results_will_now_fail_the_build">Failing to pack or unpack cached results will now fail the build</a></h6>
<div class="paragraph">
<p>In the past, when Gradle encountered a problem while packing the results of a cached task, Gradle would ignore the problem and continue running the build.</p>
</div>
<div class="paragraph">
<p>When encountering a corrupt cached artifact, Gradle would remove whatever was already unpacked and re-execute the task to make sure the build had a chance to succeed.</p>
</div>
<div class="paragraph">
<p>While this behavior was intended to make a build successful, this had the adverse effect of hiding problems and led to reduced cache performance.</p>
</div>
<div class="paragraph">
<p>In Gradle 6.0, both pack and unpack errors will cause the build to fail, so that these problems will be surfaced more easily.</p>
</div>
</div>
<div class="sect5">
<h6 id="buildsrc_projects_automatically_use_build_cache_configuration"><a class="anchor" href="#buildsrc_projects_automatically_use_build_cache_configuration"></a><a class="link" href="#buildsrc_projects_automatically_use_build_cache_configuration">buildSrc projects automatically use build cache configuration</a></h6>
<div class="paragraph">
<p>Previously, in order to to use the build cache for the buildSrc build you needed to duplicate your build cache config in the buildSrc build.
Now, it automatically uses the build cache configuration defined by the top level settings script.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_dependency_management"><a class="anchor" href="#changes_to_dependency_management"></a><a class="link" href="#changes_to_dependency_management">Changes to Dependency Management</a></h6>

</div>
<div class="sect5">
<h6 id="gradle_module_metadata_is_always_published"><a class="anchor" href="#gradle_module_metadata_is_always_published"></a><a class="link" href="#gradle_module_metadata_is_always_published">Gradle Module Metadata is always published</a></h6>
<div class="paragraph">
<p>Officially introduced in Gradle 5.3, <a href="https://blog.gradle.org/gradle-metadata-1.0">Gradle Module Metadata</a> was created to solve many of the problems that have plagued dependency management for years, in particular, but not exclusively, in the Java ecosystem.</p>
</div>
<div class="paragraph">
<p>With Gradle 6.0, Gradle Module Metadata is enabled by default.</p>
</div>
<div class="paragraph">
<p>This means, if you are publishing libraries with Gradle and using the <a href="#">maven-publish</a> or <a href="#">ivy-publish</a> plugin, the Gradle Module Metadata file is always published <strong>in addition</strong> to traditional metadata.</p>
</div>
<div class="paragraph">
<p>The traditional metadata file will contain a marker so that Gradle knows that there is additional metadata to consume.</p>
</div>
</div>
<div class="sect5">
<h6 id="gradle_module_metadata_has_stricter_validation"><a class="anchor" href="#gradle_module_metadata_has_stricter_validation"></a><a class="link" href="#gradle_module_metadata_has_stricter_validation">Gradle Module Metadata has stricter validation</a></h6>
<div class="paragraph">
<p>The following rules are verified when publishing Gradle Module Metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variant names must be unique,</p>
</li>
<li>
<p>Each variant must have at least <a href="#">one attribute</a>,</p>
</li>
<li>
<p>Two variants cannot have the <a href="#">exact same attributes and capabilities</a>,</p>
</li>
<li>
<p>If there are dependencies, at least one, across all variants, must carry <a href="#">version information</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are documented in the <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">specification</a> as well.</p>
</div>
</div>
<div class="sect5">
<h6 id="maven_or_ivy_repositories_are_no_longer_queried_for_artifacts_without_metadata_by_default"><a class="anchor" href="#maven_or_ivy_repositories_are_no_longer_queried_for_artifacts_without_metadata_by_default"></a><a class="link" href="#maven_or_ivy_repositories_are_no_longer_queried_for_artifacts_without_metadata_by_default">Maven or Ivy repositories are no longer queried for artifacts without metadata by default</a></h6>
<div class="paragraph">
<p>If Gradle fails to locate the metadata file (<code>.pom</code> or <code>ivy.xml</code>) of a module in a repository defined in the <code>repositories { }</code> section, it now assumes that the module does not exist in that repository.</p>
</div>
<div class="paragraph">
<p>For dynamic versions, the <code>maven-metadata.xml</code> for the corresponding module needs to be present in a Maven repository.</p>
</div>
<div class="paragraph">
<p>Previously, Gradle would also look for a default artifact (<code>.jar</code>).
This behavior often caused a large number of unnecessary requests when using multiple repositories that slowed builds down.</p>
</div>
<div class="paragraph">
<p>You can opt into the old behavior for selected repositories by adding the <code>artifact()</code> <a href="#sec:supported_metadata_sources">metadata source</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="changing_the_pom_packaging_property_no_longer_changes_the_artifact_extension"><a class="anchor" href="#changing_the_pom_packaging_property_no_longer_changes_the_artifact_extension"></a><a class="link" href="#changing_the_pom_packaging_property_no_longer_changes_the_artifact_extension">Changing the pom <code>packaging</code> property no longer changes the artifact extension</a></h6>
<div class="paragraph">
<p>Previously, if the pom packaging was not <em>jar</em>, <em>ejb</em>, <em>bundle</em> or <em>maven-plugin</em>, the extension of the main artifact published to a Maven repository was changed during publishing to match the pom packaging.</p>
</div>
<div class="paragraph">
<p>This behavior led to broken Gradle Module Metadata and was difficult to understand due to handling of different packaging types.</p>
</div>
<div class="paragraph">
<p>Build authors can change the artifact name when the artifact is created to obtain the same result as before  e.g. by setting <code>jar.archiveExtension.set(pomPackaging)</code> explicitly.</p>
</div>
</div>
<div class="sect5">
<h6 id="an_ivy_xml_published_for_java_libraries_contains_more_information"><a class="anchor" href="#an_ivy_xml_published_for_java_libraries_contains_more_information"></a><a class="link" href="#an_ivy_xml_published_for_java_libraries_contains_more_information">An <code>ivy.xml</code> published for Java libraries contains more information</a></h6>
<div class="paragraph">
<p>A number of fixes were made to produce more correct <code>ivy.xml</code> metadata in the <code>ivy-publish</code> plugin.</p>
</div>
<div class="paragraph">
<p>As a consequence, the internal structure of the <code>ivy.xml</code> file has changed. The <code>runtime</code> configuration now contains more information, which corresponds to the <em>runtimeElements</em> variant of a Java library. The <code>default</code> configuration should yield the same result as before.</p>
</div>
<div class="paragraph">
<p>In general, users are advised to migrate from <code>ivy.xml</code> to the new Gradle Module Metadata format.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_plugins_and_build_scripts"><a class="anchor" href="#changes_to_plugins_and_build_scripts"></a><a class="link" href="#changes_to_plugins_and_build_scripts">Changes to Plugins and Build scripts</a></h6>

</div>
<div class="sect5">
<h6 id="classes_from_buildsrc_are_no_longer_visible_to_settings_scripts"><a class="anchor" href="#classes_from_buildsrc_are_no_longer_visible_to_settings_scripts"></a><a class="link" href="#classes_from_buildsrc_are_no_longer_visible_to_settings_scripts">Classes from <code>buildSrc</code> are no longer visible to settings scripts</a></h6>
<div class="paragraph">
<p>Previously, the buildSrc project was built before applying the project&#8217;s settings script and its classes were visible within the script.
Now, buildSrc is built after the settings script and its classes are not visible to it.
The buildSrc classes remain visible to project build scripts and script plugins.</p>
</div>
<div class="paragraph">
<p>Custom logic can be used from a settings script by <a href="#sec:build_script_external_dependencies">declaring external dependencies</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_pluginmanagement_block_in_settings_scripts_is_now_isolated"><a class="anchor" href="#the_pluginmanagement_block_in_settings_scripts_is_now_isolated"></a><a class="link" href="#the_pluginmanagement_block_in_settings_scripts_is_now_isolated">The <code>pluginManagement</code> block in settings scripts is now isolated</a></h6>
<div class="paragraph">
<p>Previously, any <code>pluginManagement {}</code> blocks inside a settings script were executed during the normal execution of the script.</p>
</div>
<div class="paragraph">
<p>Now, they are executed earlier in a similar manner to <code>buildscript {}</code> or <code>plugins {}</code>. This means that code inside such a block cannot reference anything declared elsewhere in the script.</p>
</div>
<div class="paragraph">
<p>This change has been made so that <code>pluginManagement</code> configuration can also be applied when resolving plugins for the settings script itself.</p>
</div>
</div>
<div class="sect5">
<h6 id="plugins_and_classes_loaded_in_settings_scripts_are_visible_to_project_scripts_and_buildsrc"><a class="anchor" href="#plugins_and_classes_loaded_in_settings_scripts_are_visible_to_project_scripts_and_buildsrc"></a><a class="link" href="#plugins_and_classes_loaded_in_settings_scripts_are_visible_to_project_scripts_and_buildsrc">Plugins and classes loaded in settings scripts are visible to project scripts and <code>buildSrc</code></a></h6>
<div class="paragraph">
<p>Previously, any classes added to the a settings script by using <code>buildscript {}</code> were not visible outside of the script.
Now, they they are visible to all of the project build scripts.</p>
</div>
<div class="paragraph">
<p>They are also visible to the <code>buildSrc</code> build script and its settings script.</p>
</div>
<div class="paragraph">
<p>This change has been made so that plugins applied to the settings script can contribute logic to the entire build.</p>
</div>
</div>
<div class="sect5">
<h6 id="plugin_validation_changes"><a class="anchor" href="#plugin_validation_changes"></a><a class="link" href="#plugin_validation_changes">Plugin validation changes</a></h6>
<div class="ulist">
<ul>
<li>
<p>The <code>validateTaskProperties</code> task is now deprecated, use <code>validatePlugins</code> instead.
The new name better reflects the fact that it also validates artifact transform parameters and other non-property definitions.</p>
</li>
<li>
<p>The <code>ValidateTaskProperties</code> type is replaced by <code>ValidatePlugins</code>.</p>
</li>
<li>
<p>The <code>setClasses()</code> method is now removed. Use <code>getClasses().setFrom()</code> instead.</p>
</li>
<li>
<p>The <code>setClasspath()</code> method is also removed. use <code>getClasspath().setFrom()</code> instead.</p>
</li>
<li>
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/ValidatePlugins.html#getFailOnWarning--">failOnWarning</a> option is now enabled by default.</p>
</li>
<li>
<p>The following task validation errors now fail the build at runtime and are promoted to errors for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/ValidatePlugins.html">ValidatePlugins</a>:</p>
<div class="ulist">
<ul>
<li>
<p>A task property is annotated with a property annotation not allowed for tasks, like <code>@InputArtifact</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_kotlin_dsl"><a class="anchor" href="#changes_to_kotlin_dsl"></a><a class="link" href="#changes_to_kotlin_dsl">Changes to Kotlin DSL</a></h6>

</div>
<div class="sect5">
<h6 id="using_the_embedded_kotlin_plugin_now_requires_a_repository"><a class="anchor" href="#using_the_embedded_kotlin_plugin_now_requires_a_repository"></a><a class="link" href="#using_the_embedded_kotlin_plugin_now_requires_a_repository">Using the <code>embedded-kotlin</code> plugin now requires a repository</a></h6>
<div class="paragraph">
<p>Just like when using the <code>kotlin-dsl</code> plugin, it is now required to declare a repository where Kotlin dependencies can be found if you apply the <code>embedded-kotlin</code> plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `embedded-kotlin`
}

repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="kotlin_dsl_ide_support_now_requires_kotlin_intellij_plugin_1_3_50"><a class="anchor" href="#kotlin_dsl_ide_support_now_requires_kotlin_intellij_plugin_1_3_50"></a><a class="link" href="#kotlin_dsl_ide_support_now_requires_kotlin_intellij_plugin_1_3_50">Kotlin DSL IDE support now requires Kotlin IntelliJ Plugin &gt;= 1.3.50</a></h6>
<div class="paragraph">
<p>With Kotlin IntelliJ plugin versions prior to 1.3.50, Kotlin DSL scripts will be wrongly highlighted when the <em>Gradle JVM</em> is set to a version different from the one in <em>Project SDK</em>.
Simply upgrade your IDE plugin to a version &gt;= 1.3.50 to restore the correct Kotlin DSL script highlighting behavior.</p>
</div>
</div>
<div class="sect5">
<h6 id="kotlin_dsl_script_base_types_no_longer_extend_project_settings_or_gradle"><a class="anchor" href="#kotlin_dsl_script_base_types_no_longer_extend_project_settings_or_gradle"></a><a class="link" href="#kotlin_dsl_script_base_types_no_longer_extend_project_settings_or_gradle">Kotlin DSL script base types no longer extend <code>Project</code>, <code>Settings</code> or <code>Gradle</code></a></h6>
<div class="paragraph">
<p>In previous versions, Kotlin DSL scripts were compiled to classes that implemented one of the three core Gradle configuration interfaces in order to implicitly expose their APIs to scripts. <code>org.gradle.api.Project</code> for project scripts, <code>org.gradle.api.initialization.Settings</code> for settings scripts and <code>org.gradle.api.invocation.Gradle</code> for init scripts.</p>
</div>
<div class="paragraph">
<p>Having the script instance implement the core Gradle interface of the model object it was supposed to configure was convenient because it made the model object API immediately available to the body of the script but it was also a lie that could cause all sorts of trouble whenever the script itself was used in place of the model object, a project script <strong>was not</strong> a proper <code>Project</code> instance just because it implemented the core <code>Project</code> interface and the same was true for settings and init scripts.</p>
</div>
<div class="paragraph">
<p>In 6.0 all Kotlin DSL scripts are compiled to classes that implement the newly introduced <code>org.gradle.kotlin.dsl.KotlinScript</code> interface and the corresponding model objects are now available as <em>implicit receivers</em> in the body of the scripts. In other words, a project script behaves as if the body of the script is enclosed within a <code>with(project) { &#8230;&#8203; }</code> block, a settings script as if the body of the script is enclosed within a <code>with(settings) { &#8230;&#8203; }</code> block and an init script as if the body of the script is enclosed within a <code>with(gradle) { &#8230;&#8203; }</code> block. This implies the corresponding model object is also available as a property in the body of the script, the <code>project</code> property for project scripts, the <code>settings</code> property for settings scripts and the <code>gradle</code> property for init scripts.</p>
</div>
<div class="paragraph">
<p>As part of the change, the <code>SettingsScriptApi</code> interface is no longer implemented by settings scripts and the <code>InitScriptApi</code> interface is no longer implemented by init scripts. They should be replaced with the corresponding model object interfaces, <code>Settings</code> and <code>Gradle</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="miscellaneous"><a class="anchor" href="#miscellaneous"></a><a class="link" href="#miscellaneous">Miscellaneous</a></h6>

</div>
<div class="sect5">
<h6 id="javadoc_and_groovydoc_dont_include_timestamps_by_default"><a class="anchor" href="#javadoc_and_groovydoc_dont_include_timestamps_by_default"></a><a class="link" href="#javadoc_and_groovydoc_dont_include_timestamps_by_default">Javadoc and Groovydoc don&#8217;t include timestamps by default</a></h6>
<div class="paragraph">
<p>Timestamps in the generated documentation have very limited practical use, however they make it impossible to have repeatable documentation builds.
Therefore, the <code>Javadoc</code> and <code>Groovydoc</code> tasks are now configured to not include timestamps by default any more.</p>
</div>
</div>
<div class="sect5">
<h6 id="user_provided_config_loc_properties_are_ignored_by_checkstyle"><a class="anchor" href="#user_provided_config_loc_properties_are_ignored_by_checkstyle"></a><a class="link" href="#user_provided_config_loc_properties_are_ignored_by_checkstyle">User provided 'config_loc' properties are ignored by Checkstyle</a></h6>
<div class="paragraph">
<p>Gradle always uses <code>configDirectory</code> as the value for 'config_loc' when running Checkstyle.</p>
</div>
</div>
<div class="sect5">
<h6 id="new_tooling_api_progress_event"><a class="anchor" href="#new_tooling_api_progress_event"></a><a class="link" href="#new_tooling_api_progress_event">New Tooling API progress event</a></h6>
<div class="paragraph">
<p>In Gradle 6.0, we introduced a new progress event (<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/tooling/events/test/TestOutputEvent.html">org.gradle.tooling.events.test.TestOutputEvent</a>) to expose the output of test execution. This new event breaks the convention of having a <code>StartEvent</code>-<code>FinisEvent</code> pair to express progress. <code>TaskOutputEvent</code> is a simple <code>ProgressEvent</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_the_task_container_behavior"><a class="anchor" href="#changes_to_the_task_container_behavior"></a><a class="link" href="#changes_to_the_task_container_behavior">Changes to the task container behavior</a></h6>
<div class="paragraph">
<p>The following deprecated methods on the task container now result in errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TaskContainer.add()</code></p>
</li>
<li>
<p><code>TaskContainer.addAll()</code></p>
</li>
<li>
<p><code>TaskContainer.remove()</code></p>
</li>
<li>
<p><code>TaskContainer.removeAll()</code></p>
</li>
<li>
<p><code>TaskContainer.retainAll()</code></p>
</li>
<li>
<p><code>TaskContainer.clear()</code></p>
</li>
<li>
<p><code>TaskContainer.iterator().remove()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the following deprecated functionality now results in an error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replacing a task that has already been realized.</p>
</li>
<li>
<p>Replacing a registered (unrealized) task with an incompatible type. A compatible type is the same type or a sub-type of the registered type.</p>
</li>
<li>
<p>Replacing a task that has never been registered.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="replaced_and_removed_apis"><a class="anchor" href="#replaced_and_removed_apis"></a><a class="link" href="#replaced_and_removed_apis">Replaced and Removed APIs</a></h6>

</div>
<div class="sect5">
<h6 id="methods_on_defaulttask_and_projectlayout_replaced_with_objectfactory"><a class="anchor" href="#methods_on_defaulttask_and_projectlayout_replaced_with_objectfactory"></a><a class="link" href="#methods_on_defaulttask_and_projectlayout_replaced_with_objectfactory">Methods on <code>DefaultTask</code> and <code>ProjectLayout</code> replaced with <code>ObjectFactory</code></a></h6>
<div class="paragraph">
<p>Use <code>ObjectFactory.fileProperty()</code> instead of the following methods that are now removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DefaultTask.newInputFile()</code></p>
</li>
<li>
<p><code>DefaultTask.newOutputFile()</code></p>
</li>
<li>
<p><code>ProjectLayout.fileProperty()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use <code>ObjectFactory.directoryProperty()</code> instead of the following methods that are now removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DefaultTask.newInputDirectory()</code></p>
</li>
<li>
<p><code>DefaultTask.newOutputDirectory()</code></p>
</li>
<li>
<p><code>ProjectLayout.directoryProperty()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="annotation_nullable_has_been_removed"><a class="anchor" href="#annotation_nullable_has_been_removed"></a><a class="link" href="#annotation_nullable_has_been_removed">Annotation <code>@Nullable</code> has been removed</a></h6>
<div class="paragraph">
<p>The <code>org.gradle.api.Nullable</code> annotation type has been removed. Use <code>javax.annotation.Nullable</code> from JSR-305 instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_findbugs_plugin_has_been_removed"><a class="anchor" href="#the_findbugs_plugin_has_been_removed"></a><a class="link" href="#the_findbugs_plugin_has_been_removed">The FindBugs plugin has been removed</a></h6>
<div class="paragraph">
<p>The deprecated FindBugs plugin has been removed.
As an alternative, you can use the <a href="https://plugins.gradle.org/plugin/com.github.spotbugs">SpotBugs plugin</a> from the <a href="https://plugins.gradle.org/search?term=spotbugs">Gradle Plugin Portal</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_jdepend_plugin_has_been_removed"><a class="anchor" href="#the_jdepend_plugin_has_been_removed"></a><a class="link" href="#the_jdepend_plugin_has_been_removed">The JDepend plugin has been removed</a></h6>
<div class="paragraph">
<p>The deprecated JDepend plugin has been removed.
There are a number of community-provided plugins for code and architecture analysis available on the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_osgi_plugin_has_been_removed"><a class="anchor" href="#the_osgi_plugin_has_been_removed"></a><a class="link" href="#the_osgi_plugin_has_been_removed">The OSGI plugin has been removed</a></h6>
<div class="paragraph">
<p>The deprecated OSGI plugin has been removed.
There are a number of community-provided OSGI plugins available on the <a href="https://plugins.gradle.org/search?term=osgi">Gradle Plugin Portal</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_announce_and_build_announcements_plugins_have_been_removed"><a class="anchor" href="#the_announce_and_build_announcements_plugins_have_been_removed"></a><a class="link" href="#the_announce_and_build_announcements_plugins_have_been_removed">The announce and build-announcements plugins have been removed</a></h6>
<div class="paragraph">
<p>The deprecated announce and build-announcements plugins have been removed.
There are a number of community-provided plugins for sending out notifications available on the <a href="https://plugins.gradle.org">Gradle Plugin Portal</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_compare_gradle_builds_plugin_has_been_removed"><a class="anchor" href="#the_compare_gradle_builds_plugin_has_been_removed"></a><a class="link" href="#the_compare_gradle_builds_plugin_has_been_removed">The Compare Gradle Builds plugin has been removed</a></h6>
<div class="paragraph">
<p>The deprecated Compare Gradle Builds plugin has been removed.
Please use <a href="https://scans.gradle.com/">build scans</a> for build analysis and comparison.</p>
</div>
</div>
<div class="sect5">
<h6 id="the_play_plugins_have_been_removed"><a class="anchor" href="#the_play_plugins_have_been_removed"></a><a class="link" href="#the_play_plugins_have_been_removed">The Play plugins have been removed</a></h6>
<div class="paragraph">
<p>The deprecated Play plugin has been removed.
An external replacement, the <a href="https://gradle.github.io/playframework">Play Framework plugin</a>, is available from the plugin portal.</p>
</div>
</div>
<div class="sect5">
<h6 id="method_abstractcompile_compile_method_has_been_removed"><a class="anchor" href="#method_abstractcompile_compile_method_has_been_removed"></a><a class="link" href="#method_abstractcompile_compile_method_has_been_removed">Method <code>AbstractCompile.compile()</code> method has been removed</a></h6>
<div class="paragraph">
<p>The abstract method <code>compile()</code> is no longer declared by <code>AbstractCompile</code>.</p>
</div>
<div class="paragraph">
<p>Tasks extending <code>AbstractCompile</code> can implement their own <code>@TaskAction</code> method with the name of their choosing.</p>
</div>
<div class="paragraph">
<p>They are also free to add a method annotated with <code>@TaskAction</code> using an <code>InputChanges</code> parameter without having to implement a parameter-less one as well.</p>
</div>
</div>
<div class="sect5">
<h6 id="other_deprecated_behaviors_and_apis"><a class="anchor" href="#other_deprecated_behaviors_and_apis"></a><a class="link" href="#other_deprecated_behaviors_and_apis">Other Deprecated Behaviors and APIs</a></h6>
<div class="ulist">
<ul>
<li>
<p>The <code>org.gradle.util.GUtil.savePropertiesNoDateComment</code> has been removed. There is no public replacement for this internal method.</p>
</li>
<li>
<p>The deprecated class <code>org.gradle.api.tasks.compile.CompilerArgumentProvider</code> has been removed.
Use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/process/CommandLineArgumentProvider.html">org.gradle.process.CommandLineArgumentProvider</a> instead.</p>
</li>
<li>
<p>The deprecated class <code>org.gradle.api.ConventionProperty</code> has been removed.
Use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Providers</a> instead of convention properties.</p>
</li>
<li>
<p>The deprecated class <code>org.gradle.reporting.DurationFormatter</code> has been removed.</p>
</li>
<li>
<p>The bridge method <code>org.gradle.api.tasks.TaskInputs.property(String name, @Nullable Object value)</code> returning <code>TaskInputs</code> has been removed.
A plugin using the method must be compiled with Gradle 4.3 to work on Gradle 6.0.</p>
</li>
<li>
<p>The following setters have been removed from <code>JacocoReportBase</code>:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html#org.gradle.testing.jacoco.tasks.JacocoReport:executionData">executionData</a> - use <code>getExecutionData().setFrom()</code> instead.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html#org.gradle.testing.jacoco.tasks.JacocoReport:sourceDirectories">sourceDirectories</a> - use <code>getSourceDirectories().setFrom()</code> instead.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html#org.gradle.testing.jacoco.tasks.JacocoReport:classDirectories">classDirectories</a> - use <code>getClassDirectories().setFrom()</code> instead.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html#org.gradle.testing.jacoco.tasks.JacocoReport:additionalClassDirs">additionalClassDirs</a> - use <code>getAdditionalClassDirs().setFrom()</code> instead.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html#org.gradle.testing.jacoco.tasks.JacocoReport:additionalSourceDirs">additionalSourceDirs</a> - use <code>getAdditionalSourceDirs().setFrom()</code> instead.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>append</code> property on <code>JacocoTaskExtension</code> has been removed.
<code>append</code> is now always configured to be true for the Jacoco agent.</p>
</li>
<li>
<p>The <code>configureDefaultOutputPathForJacocoMerge</code> method on <code>JacocoPlugin</code> has been removed.
The method was never meant to be public.</p>
</li>
<li>
<p>File paths in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ear/descriptor/DeploymentDescriptor.html#getFileName--">deployment descriptor file name</a> for the ear plugin are not allowed any more.
Use a simple name, like <code>application.xml</code>, instead.</p>
</li>
<li>
<p>The <code>org.gradle.testfixtures.ProjectBuilder</code> constructor has been removed. Please use <code>ProjectBuilder.builder()</code> instead.</p>
</li>
<li>
<p>When <a href="#sec:incremental_groovy_compilation">incremental Groovy compilation</a> is enabled, a wrong configuration of the source roots or enabling Java annotation for Groovy now fails the build.
Disable incremental Groovy compilation when you want to compile in those cases.</p>
</li>
<li>
<p><code>ComponentSelectionRule</code> no longer can inject the metadata or ivy descriptor.
Use the methods on the <a href="#sec:component_selection_rules"><code>ComponentSelection</code> parameter</a> instead.</p>
</li>
<li>
<p>Declaring an <a href="#incremental_tasks">incremental task</a> without declaring outputs is now an error.
Declare file outputs or use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-">TaskOutputs.upToDateWhen()</a> instead.</p>
</li>
<li>
<p>The <code>getEffectiveAnnotationProcessorPath()</code> method is removed from the <code>JavaCompile</code> and <code>ScalaCompile</code> tasks.</p>
</li>
<li>
<p>Changing the value of a task property with type <code>Property&lt;T&gt;</code> after the task has started execution now results in an error.</p>
</li>
<li>
<p>The <code>isLegacyLayout()</code> method is removed from <code>SourceSetOutput</code>.</p>
</li>
<li>
<p>The map returned by <code>TaskInputs.getProperties()</code> is now unmodifiable.
Trying to modify it will result in an <code>UnsupportedOperationException</code> being thrown.</p>
</li>
<li>
<p>There are slight changes in the incubating <a href="#sub:selecting-between-candidates">capabilities resolution</a> API, which has been introduced in 5.6, to also allow variant selection based on variant name</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.6"><a class="anchor" href="#changes_5.6"></a><a class="link" href="#changes_5.6">Upgrading from 5.5 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_6"><a class="anchor" href="#deprecations_6"></a><a class="link" href="#deprecations_6">Deprecations</a></h5>
<div class="sect5">
<h6 id="changing_the_contents_of_configurablefilecollection_task_properties_after_task_starts_execution"><a class="anchor" href="#changing_the_contents_of_configurablefilecollection_task_properties_after_task_starts_execution"></a><a class="link" href="#changing_the_contents_of_configurablefilecollection_task_properties_after_task_starts_execution">Changing the contents of <code>ConfigurableFileCollection</code> task properties after task starts execution</a></h6>
<div class="paragraph">
<p>When a task property has type <code>ConfigurableFileCollection</code>, then the file collection referenced by the property will ignore changes made to the contents of the collection once the task
starts execution. This has two benefits. Firstly, this prevents accidental changes to the property value during task execution which can cause Gradle up-to-date checks and build cache lookup
using different values to those used by the task action. Secondly, this improves performance as Gradle can calculate the value once and cache the result.</p>
</div>
<div class="paragraph">
<p>This will become an error in Gradle 6.0.</p>
</div>
</div>
<div class="sect5">
<h6 id="creating_signoperation_instances"><a class="anchor" href="#creating_signoperation_instances"></a><a class="link" href="#creating_signoperation_instances">Creating <code>SignOperation</code> instances</a></h6>
<div class="paragraph">
<p>Creating <code>SignOperation</code> instances directly is now deprecated. Instead, the methods of <code>SigningExtension</code> should be used to create these instances.</p>
</div>
<div class="paragraph">
<p>This will become an error in Gradle 6.0.</p>
</div>
</div>
<div class="sect5">
<h6 id="declaring_an_incremental_task_without_outputs"><a class="anchor" href="#declaring_an_incremental_task_without_outputs"></a><a class="link" href="#declaring_an_incremental_task_without_outputs">Declaring an incremental task without outputs</a></h6>
<div class="paragraph">
<p>Declaring an <a href="#incremental_tasks">incremental task</a> without declaring outputs is now deprecated.
Declare file outputs or use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-">TaskOutputs.upToDateWhen()</a> instead.</p>
</div>
<div class="paragraph">
<p>This will become an error in Gradle 6.0.</p>
</div>
</div>
<div class="sect5">
<h6 id="method_workerexecutor_submit_is_deprecated"><a class="anchor" href="#method_workerexecutor_submit_is_deprecated"></a><a class="link" href="#method_workerexecutor_submit_is_deprecated">Method <code>WorkerExecutor.submit()</code> is deprecated</a></h6>
<div class="paragraph">
<p>The <code>WorkerExecutor.submit()</code> method is now deprecated.
The new <code>noIsolation()</code>, <code>classLoaderIsolation()</code> and <code>processIsolation()</code> methods should now be used to submit work.
See <a href="#using-the-worker-api">the userguide</a> for more information on using these methods.</p>
</div>
<div class="paragraph">
<p><code>WorkerExecutor.submit()</code> will be removed in Gradle 7.0.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_6"><a class="anchor" href="#potential_breaking_changes_6"></a><a class="link" href="#potential_breaking_changes_6">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="task_dependencies_are_honored_for_task_input_properties_whose_value_is_a_property"><a class="anchor" href="#task_dependencies_are_honored_for_task_input_properties_whose_value_is_a_property"></a><a class="link" href="#task_dependencies_are_honored_for_task_input_properties_whose_value_is_a_property">Task dependencies are honored for task <code>@Input</code> properties whose value is a <code>Property</code></a></h6>
<div class="paragraph">
<p>Previously, task dependencies would be ignored for task <code>@Input</code> properties of type <code>Property&lt;T&gt;</code>. These are now honored, so that it is possible to attach a task output property to a task <code>@Input</code> property.</p>
</div>
<div class="paragraph">
<p>This may introduce unexpected cycles in the task dependency graph, where the value of an output property is mapped to produce a value for an input property.</p>
</div>
</div>
<div class="sect5">
<h6 id="declaring_task_dependencies_using_a_file_provider_that_does_not_represent_a_task_output"><a class="anchor" href="#declaring_task_dependencies_using_a_file_provider_that_does_not_represent_a_task_output"></a><a class="link" href="#declaring_task_dependencies_using_a_file_provider_that_does_not_represent_a_task_output">Declaring task dependencies using a file <code>Provider</code> that does not represent a task output</a></h6>
<div class="paragraph">
<p>Previously, it was possible to pass <code>Task.dependsOn()</code> a <code>Provider&lt;File&gt;</code>, <code>Provider&lt;RegularFile&gt;</code> or <code>Provider&lt;Directory&gt;</code> instance that did not represent a task output. These providers would be silently ignored.</p>
</div>
<div class="paragraph">
<p>This is now an error because Gradle does not know how to build files that are not task outputs.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> that it is still possible to to pass <code>Task.dependsOn()</code> a <code>Provider</code> that returns a file and that represents a task output, for example <code>myTask.dependsOn(jar.archiveFile)</code> or <code>myTask.dependsOn(taskProvider.flatMap { it.outputDirectory })</code>, when the <code>Provider</code> is an annotated <code>@OutputFile</code> or <code>@OutputDirectory</code> property of a task.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting_property_value_to_null_uses_the_property_convention"><a class="anchor" href="#setting_property_value_to_null_uses_the_property_convention"></a><a class="link" href="#setting_property_value_to_null_uses_the_property_convention">Setting <code>Property</code> value to <code>null</code> uses the property convention</a></h6>
<div class="paragraph">
<p>Previously, calling <code>Property.set(null)</code> would always reset the value of the property to 'not defined'. Now, the convention that is associated with the property using the <code>convention()</code> method
will be used to determine the value of the property.</p>
</div>
</div>
<div class="sect5">
<h6 id="enhanced_validation_of_names_for_publishing_publications_and_publishing_repositories"><a class="anchor" href="#enhanced_validation_of_names_for_publishing_publications_and_publishing_repositories"></a><a class="link" href="#enhanced_validation_of_names_for_publishing_publications_and_publishing_repositories">Enhanced validation of names for <code>publishing.publications</code> and <code>publishing.repositories</code></a></h6>
<div class="paragraph">
<p>The repository and publication names are used to construct task names for publishing. It was possible to supply a name that would result in an invalid task name. Names for publications and repositories are now restricted to <code>[A-Za-z0-9_\\-.]+</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="restricted_worker_api_classloader_and_process_classpath"><a class="anchor" href="#restricted_worker_api_classloader_and_process_classpath"></a><a class="link" href="#restricted_worker_api_classloader_and_process_classpath">Restricted Worker API classloader and process classpath</a></h6>
<div class="paragraph">
<p>Gradle now prevents internal dependencies (like Guava) from leaking into the classpath used by Worker API actions. This fixes <a href="https://github.com/gradle/gradle/issues/3698">an issue</a> where a worker needs to use a dependency that is also used by Gradle internally.</p>
</div>
<div class="paragraph">
<p>In previous releases, it was possible to rely on these leaked classes. Plugins relying on this behavior will now fail.  To fix the plugin, the worker should explicitly include all required dependencies in its classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="default_pmd_version_upgraded_to_6_15_0"><a class="anchor" href="#default_pmd_version_upgraded_to_6_15_0"></a><a class="link" href="#default_pmd_version_upgraded_to_6_15_0">Default PMD version upgraded to 6.15.0</a></h6>
<div class="paragraph">
<p><a href="#pmd_plugin">The PMD plugin</a> has been upgraded to use <a href="https://pmd.github.io/pmd-6.15.0/pmd_release_notes.html">PMD version 6.15.0</a> instead of 6.8.0 by default.</p>
</div>
<div class="paragraph">
<p>Contributed by <a href="https://github.com/wreulicke">wreulicke</a></p>
</div>
</div>
<div class="sect5">
<h6 id="configuration_copies_have_unique_names"><a class="anchor" href="#configuration_copies_have_unique_names"></a><a class="link" href="#configuration_copies_have_unique_names">Configuration copies have unique names</a></h6>
<div class="paragraph">
<p>Previously, all copies of a configuration always had the name <code>&lt;OriginConfigurationName&gt;Copy</code>. Now when creating multiple copies, each will have a unique name by adding an index starting from the second copy. (e.g. <code>CompileOnlyCopy2</code>)</p>
</div>
</div>
<div class="sect5">
<h6 id="changed_classpath_filtering_for_eclipse"><a class="anchor" href="#changed_classpath_filtering_for_eclipse"></a><a class="link" href="#changed_classpath_filtering_for_eclipse">Changed classpath filtering for Eclipse</a></h6>
<div class="paragraph">
<p>Gradle 5.6 no longer supplies custom classpath attributes in the Eclipse model. Instead, it provides the attributes for <a href="https://www.eclipse.org/eclipse/news/4.8/jdt.php#jdt-test-sources">Eclipse test sources</a>. This change requires Buildship version 3.1.1 or later.</p>
</div>
</div>
<div class="sect5">
<h6 id="embedded_kotlin_upgraded_to_1_3_41"><a class="anchor" href="#embedded_kotlin_upgraded_to_1_3_41"></a><a class="link" href="#embedded_kotlin_upgraded_to_1_3_41">Embedded Kotlin upgraded to 1.3.41</a></h6>
<div class="paragraph">
<p>Gradle Kotlin DSL scripts and Gradle Plugins authored using the <code>kotlin-dsl</code> plugin are now compiled using Kotlin 1.3.41.</p>
</div>
<div class="paragraph">
<p>Please see the Kotlin <a href="https://blog.jetbrains.com/kotlin/2019/06/kotlin-1-3-40-released/">blog post</a> and <a href="https://github.com/JetBrains/kotlin/blob/1.3.40/ChangeLog.md">changelog</a> for more information about the included changes.</p>
</div>
<div class="paragraph">
<p>The minimum supported Kotlin Gradle Plugin version is now 1.2.31. Previously it was 1.2.21.</p>
</div>
</div>
<div class="sect5">
<h6 id="automatic_capability_conflict_resolution"><a class="anchor" href="#automatic_capability_conflict_resolution"></a><a class="link" href="#automatic_capability_conflict_resolution">Automatic capability conflict resolution</a></h6>
<div class="paragraph">
<p>Previous versions of Gradle would automatically select, in case of capability conflicts, the module which has the highest capability version.
Starting from 5.6, this is an opt-in behavior that can be activated using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>configurations.all {
   resolutionStrategy.capabilitiesResolution.all { selectHighestVersion() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sub:capabilities">the capabilities section of the documentation</a> for more options.</p>
</div>
</div>
<div class="sect5">
<h6 id="file_removal_operations_dont_follow_symlinked_directories"><a class="anchor" href="#file_removal_operations_dont_follow_symlinked_directories"></a><a class="link" href="#file_removal_operations_dont_follow_symlinked_directories">File removal operations don&#8217;t follow symlinked directories</a></h6>
<div class="paragraph">
<p>When Gradle has to remove the output files of a task for various reasons, it will not follow symlinked directories.
The symlink itself will be deleted, but the contents of the linked directory will stay intact.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="disabled_debug_argument_parsing_in_javaexec"><a class="anchor" href="#disabled_debug_argument_parsing_in_javaexec"></a><a class="link" href="#disabled_debug_argument_parsing_in_javaexec">Disabled debug argument parsing in JavaExec</a></h5>
<div class="paragraph">
<p>Gradle 5.6 introduced a new DSL element (<code>JavaForkOptions.debugOptions(Action&lt;JavaDebugOptions&gt;)</code>) to configure debug properties for forked Java processes. Due to this change, Gradle no longer parses debug-related JVM arguments. Consequently, <code>JavaForkOptions.getDebu()</code> no longer returns <code>true</code> if the <code>-Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005</code> or the <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005</code> argument is specified to the process.</p>
</div>
</div>
<div class="sect4">
<h5 id="scala_2_9_and_zinc_compiler"><a class="anchor" href="#scala_2_9_and_zinc_compiler"></a><a class="link" href="#scala_2_9_and_zinc_compiler">Scala 2.9 and Zinc compiler</a></h5>
<div class="paragraph">
<p>Gradle no longer supports building applications using Scala 2.9.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.5"><a class="anchor" href="#changes_5.5"></a><a class="link" href="#changes_5.5">Upgrading from 5.4 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_7"><a class="anchor" href="#deprecations_7"></a><a class="link" href="#deprecations_7">Deprecations</a></h5>
<div class="sect5">
<h6 id="play"><a class="anchor" href="#play"></a><a class="link" href="#play">Play</a></h6>
<div class="paragraph">
<p>The built-in <a href="play_plugin.html#play_plugin">Play plugin</a> has been deprecated and will be replaced by a new <a href="https://gradle.github.io/playframework">Play Framework plugin</a> available from the plugin portal.</p>
</div>
</div>
<div class="sect5">
<h6 id="build_comparison"><a class="anchor" href="#build_comparison"></a><a class="link" href="#build_comparison">Build Comparison</a></h6>
<div class="paragraph">
<p>The <em>build comparison</em> plugin has been deprecated and will be removed in the next major version of Gradle.</p>
</div>
<div class="paragraph">
<p><a href="https://gradle.com/build-scans">Build scans</a> show much deeper insights into your build and you can use <a href="https://gradle.com/">Gradle Enterprise</a> to directly compare two build&#8217;s build-scans.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_7"><a class="anchor" href="#potential_breaking_changes_7"></a><a class="link" href="#potential_breaking_changes_7">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="user_supplied_eclipse_project_names_may_be_ignored_on_conflict"><a class="anchor" href="#user_supplied_eclipse_project_names_may_be_ignored_on_conflict"></a><a class="link" href="#user_supplied_eclipse_project_names_may_be_ignored_on_conflict">User supplied Eclipse project names may be ignored on conflict</a></h6>
<div class="paragraph">
<p>Project names configured via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/EclipseProject.html"><code>EclipseProject.setName(&#8230;&#8203;)</code></a> were honored by Gradle and Buildship in all cases, even
when the names caused conflicts and import/synchronization errors.</p>
</div>
<div class="paragraph">
<p>Gradle can now deduplicate these names if they conflict with other project names in an Eclipse workspace. This may lead to different Eclipse project names for projects with user-specified names.</p>
</div>
<div class="paragraph">
<p>The upcoming 3.1.1 version of Buildship is required to take advantage of this behavior.</p>
</div>
<div class="paragraph">
<p>Contributed by <a href="https://github.com/fraenkelc">Christian Frnkel</a></p>
</div>
</div>
<div class="sect5">
<h6 id="default_jacoco_version_upgraded_to_0_8_4"><a class="anchor" href="#default_jacoco_version_upgraded_to_0_8_4"></a><a class="link" href="#default_jacoco_version_upgraded_to_0_8_4">Default JaCoCo version upgraded to 0.8.4</a></h6>
<div class="paragraph">
<p><a href="#jacoco_plugin">The JaCoCo plugin</a> has been upgraded to use <a href="http://www.jacoco.org/jacoco/trunk/doc/changes.html">JaCoCo version 0.8.4</a> instead of 0.8.3 by default.</p>
</div>
<div class="paragraph">
<p>Contributed by <a href="https://github.com/Godin">Evgeny Mandrikov</a></p>
</div>
</div>
<div class="sect5">
<h6 id="embedded_ant_version_upgraded_to_1_9_14"><a class="anchor" href="#embedded_ant_version_upgraded_to_1_9_14"></a><a class="link" href="#embedded_ant_version_upgraded_to_1_9_14">Embedded Ant version upgraded to 1.9.14</a></h6>
<div class="paragraph">
<p>The version of Ant distributed with Gradle has been upgraded to <a href="https://archive.apache.org/dist/ant/RELEASE-NOTES-1.9.14.html">1.9.14</a> from 1.9.13.</p>
</div>
</div>
<div class="sect5">
<h6 id="type_dependencyhandler_now_statically_exposes_extensionaware"><a class="anchor" href="#type_dependencyhandler_now_statically_exposes_extensionaware"></a><a class="link" href="#type_dependencyhandler_now_statically_exposes_extensionaware">Type <code>DependencyHandler</code> now statically exposes <code>ExtensionAware</code></a></h6>
<div class="paragraph">
<p>This affects Kotlin DSL build scripts that make use of <code>ExtensionAware</code> extension members such as the <code>extra</code> properties accessor inside the <code>dependencies {}</code> block. The receiver for those members will no longer be the enclosing <code>Project</code> instance but the <code>dependencies</code> object itself, the innermost <code>ExtensionAware</code> conforming receiver. In order to address <code>Project</code> extra properties inside <code>dependencies {}</code> the receiver must be explicitly qualified i.e. <code>project.extra</code> instead of just <code>extra</code>. Affected extensions also include <code>the&lt;T&gt;()</code> and <code>configure&lt;T&gt;(T.() &#8594; Unit)</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="improved_processing_of_dependency_excludes"><a class="anchor" href="#improved_processing_of_dependency_excludes"></a><a class="link" href="#improved_processing_of_dependency_excludes">Improved processing of dependency excludes</a></h6>
<div class="paragraph">
<p>Previous versions of Gradle could, in some complex dependency graphs, have a wrong result or a randomized dependency order when lots of excludes were present.
To mitigate this, the algorithm that computes exclusions has been rewritten.
In some rare cases this may cause some differences in resolution, due to the correctness changes.</p>
</div>
</div>
<div class="sect5">
<h6 id="improved_classpath_separation_for_worker_processes"><a class="anchor" href="#improved_classpath_separation_for_worker_processes"></a><a class="link" href="#improved_classpath_separation_for_worker_processes">Improved classpath separation for worker processes</a></h6>
<div class="paragraph">
<p>The system classpath for worker daemons started by the <a href="#worker_api">Worker API</a> when using <code>PROCESS</code> isolation has been reduced to a minimum set of Gradle infrastructure. User code is still segregated into a separate classloader to isolate it from the Gradle runtime. This should be a transparent change for tasks using the worker API, but previous versions of Gradle mixed user code and Gradle internals in the worker process. Worker actions that rely on things like the <code>java.class.path</code> system property may be affected, since <code>java.class.path</code> now represents only the classpath of the Gradle internals.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.4"><a class="anchor" href="#changes_5.4"></a><a class="link" href="#changes_5.4">Upgrading from 5.3 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_8"><a class="anchor" href="#deprecations_8"></a><a class="link" href="#deprecations_8">Deprecations</a></h5>
<div class="sect5">
<h6 id="using_custom_local_build_cache_implementations"><a class="anchor" href="#using_custom_local_build_cache_implementations"></a><a class="link" href="#using_custom_local_build_cache_implementations">Using custom local build cache implementations</a></h6>
<div class="paragraph">
<p>Using a custom build cache implementation for the local build cache is now deprecated.
The only allowed type will be <code>DirectoryBuildCache</code> going forward.
There is no change in the support for using custom build cache implementations as the remote build cache.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_8"><a class="anchor" href="#potential_breaking_changes_8"></a><a class="link" href="#potential_breaking_changes_8">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="use_https_when_configuring_google_hosted_libraries_via_googleapis"><a class="anchor" href="#use_https_when_configuring_google_hosted_libraries_via_googleapis"></a><a class="link" href="#use_https_when_configuring_google_hosted_libraries_via_googleapis">Use HTTPS when configuring Google Hosted Libraries via <code>googleApis()</code></a></h6>
<div class="paragraph">
<p>The Google Hosted Libraries URL accessible via <code>JavaScriptRepositoriesExtension#GOOGLE_APIS_REPO_URL</code> was changed to use the HTTPS protocol.
The change also affect the Ivy repository configured via <code>googleApis()</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.3"><a class="anchor" href="#changes_5.3"></a><a class="link" href="#changes_5.3">Upgrading from 5.2 and earlier</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_9"><a class="anchor" href="#potential_breaking_changes_9"></a><a class="link" href="#potential_breaking_changes_9">Potential breaking changes</a></h5>
<div class="sect5">
<h6 id="bug_fixes_in_platform_resolution"><a class="anchor" href="#bug_fixes_in_platform_resolution"></a><a class="link" href="#bug_fixes_in_platform_resolution">Bug fixes in platform resolution</a></h6>
<div class="paragraph">
<p>There was a bug from Gradle 5.0 to 5.2.1 (included) where enforced platforms would potentially include dependencies instead of constraints.
This would happen whenever a POM file defined both dependencies and "constraints" (via <code>&lt;dependencyManagement&gt;</code>) and that you used <code>enforcedPlatform</code>.
Gradle 5.3 fixes this bug, meaning that you might have differences in the resolution result if you relied on this broken behavior.
Similarly, Gradle 5.3 will no longer try to download jars for <code>platform</code> and <code>enforcedPlatform</code> dependencies (as they should only bring in constraints).</p>
</div>
</div>
<div class="sect5">
<h6 id="automatic_target_jvm_version"><a class="anchor" href="#automatic_target_jvm_version"></a><a class="link" href="#automatic_target_jvm_version">Automatic target JVM version</a></h6>
<div class="paragraph">
<p>If you apply any of the Java plugins, Gradle will now do its best to select dependencies which match the target compatibility of the module being compiled.
What it means, in practice, is that if you have module A built for Java 8, and module B built for Java 8, then there&#8217;s no change.
However if B is built for Java 9+, then it&#8217;s not binary compatible anymore, and Gradle would complain with an error message like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Unable to find a matching variant of project :producer:
  - Variant 'apiElements' capability test:producer:unspecified:
      - Provides org.gradle.dependency.bundling 'external'
      - Required org.gradle.jvm.version '8' and found incompatible value '9'.
      - Required org.gradle.usage 'java-api' and found value 'java-api-jars'.
  - Variant 'runtimeElements' capability test:producer:unspecified:
      - Provides org.gradle.dependency.bundling 'external'
      - Required org.gradle.jvm.version '8' and found incompatible value '9'.
      - Required org.gradle.usage 'java-api' and found value 'java-runtime-jars'.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, this is a sign that your project is misconfigured and that your dependencies are not compatible.
However, there are cases where you still may want to do this, for example when only a <em>subset</em> of classes of your module actually need the Java 9 dependencies, and are not intended to be used on earlier releases.
Java in general doesn&#8217;t encourage you to do this (you should split your module instead), but if you face this problem, you can workaround by disabling this new behavior on the consumer side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>java {
   disableAutoTargetJvm()
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bug_fix_in_maven_ivy_interoperability_with_dependency_substitution"><a class="anchor" href="#bug_fix_in_maven_ivy_interoperability_with_dependency_substitution"></a><a class="link" href="#bug_fix_in_maven_ivy_interoperability_with_dependency_substitution">Bug fix in Maven / Ivy interoperability with dependency substitution</a></h6>
<div class="paragraph">
<p>If you have a Maven dependency pointing to an Ivy dependency where the <code>default</code> configuration dependencies do not match the <code>compile</code> + <code>runtime</code> + <code>master</code> ones
<em>and</em> that Ivy dependency was substituted (using a <code>resolutionStrategy.force</code>, <code>resolutionStrategy.eachDependency</code> or <code>resolutionStrategy.dependencySubstitution</code>)
then this fix will impact you.
The legacy behaviour of Gradle, prior to 5.0, was still in place instead of being replaced by the changes introduced by improved pom support.</p>
</div>
</div>
<div class="sect5">
<h6 id="delete_operations_correctly_handle_symbolic_links_on_windows"><a class="anchor" href="#delete_operations_correctly_handle_symbolic_links_on_windows"></a><a class="link" href="#delete_operations_correctly_handle_symbolic_links_on_windows">Delete operations correctly handle symbolic links on Windows</a></h6>
<div class="paragraph">
<p>Gradle no longer ignores the <code>followSymlink</code> option on Windows for the <code>clean</code> task, all <code>Delete</code> tasks, and <code>project.delete {}</code> operations in the presence of junction points and symbolic links.</p>
</div>
</div>
<div class="sect5">
<h6 id="fix_in_publication_of_additional_artifacts"><a class="anchor" href="#fix_in_publication_of_additional_artifacts"></a><a class="link" href="#fix_in_publication_of_additional_artifacts">Fix in publication of additional artifacts</a></h6>
<div class="paragraph">
<p>In previous Gradle versions, additional artifacts registered at the project level were not published by <code>maven-publish</code> or <code>ivy-publish</code> unless they were also added as artifacts in the publication configuration.</p>
</div>
<div class="paragraph">
<p>With Gradle 5.3, these artifacts are now properly accounted for and published.</p>
</div>
<div class="paragraph">
<p>This means that artifacts that are registered both on the project <em>and</em> the publication, Ivy or Maven, will cause publication to fail since it will create duplicate entries.
The fix is to remove these artifacts from the publication configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.2"><a class="anchor" href="#changes_5.2"></a><a class="link" href="#changes_5.2">Upgrading from 5.1 and earlier</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_10"><a class="anchor" href="#potential_breaking_changes_10"></a><a class="link" href="#potential_breaking_changes_10">Potential breaking changes</a></h5>
<div class="paragraph">
<p>none</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.1"><a class="anchor" href="#changes_5.1"></a><a class="link" href="#changes_5.1">Upgrading from 5.0 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_9"><a class="anchor" href="#deprecations_9"></a><a class="link" href="#deprecations_9">Deprecations</a></h5>
<div class="paragraph">
<p>Follow the API links to learn how to deal with these deprecations (if no extra information is provided here):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setters for <code>classes</code> and <code>classpath</code> on <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/ValidateTaskProperties.html"><code>ValidateTaskProperties</code></a></p>
</li>
<li>
<p>There should not be setters for lazy properties like <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html"><code>ConfigurableFileCollection</code></a>.  Use <code>setFrom</code> instead. For example,</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>    validateTaskProperties.getClasses().setFrom(fileCollection)
    validateTaskProperties.getClasspath().setFrom(fileCollection)</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_11"><a class="anchor" href="#potential_breaking_changes_11"></a><a class="link" href="#potential_breaking_changes_11">Potential breaking changes</a></h5>
<div class="paragraph">
<p>The following changes were not previously deprecated:</p>
</div>
<div class="sect5">
<h6 id="signing_api_changes"><a class="anchor" href="#signing_api_changes"></a><a class="link" href="#signing_api_changes">Signing API changes</a></h6>
<div class="paragraph">
<p>Input and output files of <code>Sign</code> tasks are now tracked via <code>Signature.getToSign()</code> and <code>Signature.getFile()</code>, respectively.</p>
</div>
</div>
<div class="sect5">
<h6 id="collection_properties_default_to_empty_collection"><a class="anchor" href="#collection_properties_default_to_empty_collection"></a><a class="link" href="#collection_properties_default_to_empty_collection">Collection properties default to empty collection</a></h6>
<div class="paragraph">
<p>In Gradle 5.0, the collection property instances created using <code>ObjectFactory</code> would have no value defined, requiring plugin authors to explicitly set an initial value. This proved to be awkward and error prone so <code>ObjectFactory</code> now returns instances with an empty collection as their initial value.</p>
</div>
</div>
<div class="sect5">
<h6 id="worker_api_working_directory_of_a_worker_can_no_longer_be_set"><a class="anchor" href="#worker_api_working_directory_of_a_worker_can_no_longer_be_set"></a><a class="link" href="#worker_api_working_directory_of_a_worker_can_no_longer_be_set">Worker API: working directory of a worker can no longer be set</a></h6>
<div class="paragraph">
<p>Since JDK 11 no longer supports changing the working directory of a running process, setting the working directory of a worker via its fork options is now prohibited.
All workers now use the same working directory to enable reuse.
Please pass files and directories as arguments instead. See examples in the <a href="#worker_api">Worker API documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_native_linking_tasks"><a class="anchor" href="#changes_to_native_linking_tasks"></a><a class="link" href="#changes_to_native_linking_tasks">Changes to native linking tasks</a></h6>
<div class="paragraph">
<p>To expand our idiomatic <a href="#">Provider API</a> practices, the install name property from <code>org.gradle.nativeplatform.tasks.LinkSharedLibrary</code> is affected by this change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getInstallName()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setInstallName(String)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="passing_arguments_to_windows_resource_compiler"><a class="anchor" href="#passing_arguments_to_windows_resource_compiler"></a><a class="link" href="#passing_arguments_to_windows_resource_compiler">Passing arguments to Windows Resource Compiler</a></h6>
<div class="paragraph">
<p>To expand our idiomatic <a href="#">Provider API</a> practices, the <code>WindowsResourceCompile</code> task has been converted to use the Provider API.</p>
</div>
<div class="paragraph">
<p>Passing additional compiler arguments now follow the same pattern as the <code>CppCompile</code> and other tasks.</p>
</div>
</div>
<div class="sect5">
<h6 id="copied_configuration_no_longer_shares_a_list_of_beforeresolve_actions_with_original"><a class="anchor" href="#copied_configuration_no_longer_shares_a_list_of_beforeresolve_actions_with_original"></a><a class="link" href="#copied_configuration_no_longer_shares_a_list_of_beforeresolve_actions_with_original">Copied configuration no longer shares a list of <code>beforeResolve</code> actions with original</a></h6>
<div class="paragraph">
<p>The list of <code>beforeResolve</code> actions are no longer shared between a copied configuration and the original.
Instead, a copied configuration receives a copy of the <code>beforeResolve</code> actions at the time the copy is made.
Any <code>beforeResolve</code> actions added after copying (to either configuration) will not be shared between the original and the copy.
This may break plugins that relied on the previous behaviour.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_incubating_pom_customization_types"><a class="anchor" href="#changes_to_incubating_pom_customization_types"></a><a class="link" href="#changes_to_incubating_pom_customization_types">Changes to incubating POM customization types</a></h6>
<div class="ulist">
<ul>
<li>
<p>The type of <code>MavenPomDeveloper.properties</code> has changed from <code>Property&lt;Map&lt;String, String&gt;&gt;</code> to <code>MapProperty&lt;String, String&gt;</code>.</p>
</li>
<li>
<p>The type of <code>MavenPomContributor.properties</code> has changed from <code>Property&lt;Map&lt;String, String&gt;&gt;</code> to <code>MapProperty&lt;String, String&gt;</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="changes_to_specifying_operating_system_for_native_projects"><a class="anchor" href="#changes_to_specifying_operating_system_for_native_projects"></a><a class="link" href="#changes_to_specifying_operating_system_for_native_projects">Changes to specifying operating system for native projects</a></h6>
<div class="paragraph">
<p>The incubating <code>operatingSystems</code> property on native components has been replaced with the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/cpp/CppComponent.html#getTargetMachines()">targetMachines</a> property.</p>
</div>
</div>
<div class="sect5">
<h6 id="changes_for_archive_tasks_zip_jar_war_ear_tar"><a class="anchor" href="#changes_for_archive_tasks_zip_jar_war_ear_tar"></a><a class="link" href="#changes_for_archive_tasks_zip_jar_war_ear_tar">Changes for archive tasks (<code>Zip</code>, <code>Jar</code>, <code>War</code>, <code>Ear</code>, <code>Tar</code>)</a></h6>
<div class="sect6">
<h7 id="change_in_behavior_for_tasks_extending_abstractarchivetask"><a class="anchor" href="#change_in_behavior_for_tasks_extending_abstractarchivetask"></a><a class="link" href="#change_in_behavior_for_tasks_extending_abstractarchivetask">Change in behavior for tasks extending <code>AbstractArchiveTask</code></a></h7>
<div class="paragraph">
<p>The <code>AbstractArchiveTask</code> has several new properties using the <a href="#lazy_configuration_reference">Provider API</a>.
Plugins that extend these types and override methods from the base class may no longer behave the same way.
Internally, <code>AbstractArchiveTask</code> prefers the new properties and methods like <code>getArchiveName()</code> are faades over the new properties.</p>
</div>
<div class="paragraph">
<p>If your plugin/build only uses these types (and does not extend them), nothing has changed.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_version_4"><a class="anchor" href="#upgrading_version_4"></a><a class="link" href="#upgrading_version_4">Upgrading your build from Gradle 4.x to 5.0</a></h3>
<div class="paragraph">
<p>This chapter provides the information you need to migrate your older Gradle 4.x builds to Gradle 5.0. In most cases, you will need to apply the changes from all versions that come after the one you&#8217;re upgrading from. For example, if you&#8217;re upgrading from Gradle 4.3 to 5.0, you will also need to apply the changes since 4.4, 4.5, etc up to 5.0.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are using Gradle for Android, you need to move to version 3.3 or higher of both the Android Gradle Plugin and Android Studio.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="for_all_users"><a class="anchor" href="#for_all_users"></a><a class="link" href="#for_all_users">For all users</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are not already on the latest 4.10.x release, read the sections <a href="#changes_4.10">below</a> for help upgrading your project to the latest 4.10.x release. We recommend upgrading to the latest 4.10.x release to get the most useful warnings and deprecations information before moving to 5.0. Avoid upgrading Gradle and migrating to Kotlin DSL at the same time in order to ease troubleshooting in case of potential issues.</p>
</li>
<li>
<p>Try running <code>gradle help --scan</code> and view the <a href="https://gradle.com/enterprise/releases/2018.4/#identify-usages-of-deprecated-gradle-functionality">deprecations view</a> of the generated build scan. If there are no warnings, the Deprecations tab will not appear.</p>
<div class="imageblock">
<div class="content">
<img src="img/deprecations.png" alt="Deprecations View of a Gradle Build Scan">
</div>
</div>
<div class="paragraph">
<p>This is so that you can see any deprecation warnings that apply to your build. Gradle 5.x will generate (potentially less obvious) errors if you try to upgrade directly to it.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could run <code>gradle help --warning-mode=all</code> to see the deprecations in the console, though it may not report as much detailed information.</p>
</div>
</li>
<li>
<p>Update your plugins.</p>
<div class="paragraph">
<p>Some plugins will break with this new version of Gradle, for example because they use internal APIs that have been removed or changed. The previous step will help you identify potential problems by issuing deprecation warnings when a plugin does try to use a deprecated part of the API.</p>
</div>
<div class="paragraph">
<p>In particular, you will need to use at least a 2.x version of the <a href="https://plugins.gradle.org/plugin/com.github.johnrengelman.shadow"><strong>Shadow Plugin</strong></a>.</p>
</div>
</li>
<li>
<p>Run <code>gradle wrapper --gradle-version 5.0</code> to update the project to 5.0</p>
</li>
<li>
<p>Move to Java 8 or higher if you haven&#8217;t already. Whereas Gradle 4.x requires Java 7, Gradle 5 requires Java 8 to run.</p>
</li>
<li>
<p>Read the <a href="#changes_5.0">Upgrading from 4.10</a> section and make any necessary changes.</p>
</li>
<li>
<p>Try to run the project and debug any errors using the <a href="#troubleshooting">Troubleshooting Guide</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition, Gradle has added several significant new and improved features that you should consider using in your builds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rel4.8:switch_to_publishing_plugins">Maven Publish and Ivy Publish Plugins</a> that now support digital signatures with the <a href="#signing_plugin">Signing Plugin</a>.</p>
</li>
<li>
<p>Use native <a href="#rel5.0:bom_import">BOM import</a> in your builds.</p>
</li>
<li>
<p>The <a href="#worker_api">Worker API</a> for enabling units of work to run in parallel.</p>
</li>
<li>
<p>A new API for <a href="#rel4.9:lazy_task_creation">creating and configuring tasks lazily</a> that can significantly improve your build&#8217;s configuration time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other notable changes to be aware of that may break your build include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rel5.0:pom_compile_runtime_separation">Separation of compile and runtime dependencies when consuming POMs</a></p>
</li>
<li>
<p>A change that means you should <a href="#rel4.8:configure_internal_tasks">configure existing <code>wrapper</code> and <code>init</code> tasks</a> rather than defining your own.</p>
</li>
<li>
<p>The <a href="#rel4.8:pom_wildcard_exclusions">honoring of implicit wildcards in Maven POM exclusions</a>, which may result in dependencies being excluded that weren&#8217;t before.</p>
</li>
<li>
<p>A <a href="#rel4.6:annotation_processor_configuration">change to the way you add Java annotation processors to a project</a>.</p>
</li>
<li>
<p>The <a href="#rel5.0:default_memory_settings">default memory settings</a> for the command-line client, the Gradle daemon, and all workers including compilers and test executors, have been greatly reduced.</p>
</li>
<li>
<p>The <a href="#rel5.0:default_tool_versions">default versions of several code quality plugins</a> have been updated.</p>
</li>
<li>
<p>Several <a href="#rel5.0:library_upgrades">library versions used by Gradle</a> have been upgraded.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="changes_5.0"><a class="anchor" href="#changes_5.0"></a><a class="link" href="#changes_5.0">Upgrading from 4.10 and earlier</a></h4>
<div class="paragraph">
<p>If you are not already on version 4.10, skip down to the section that applies to your current Gradle version and work your way up until you reach here. Then, apply these changes when moving from Gradle 4.10 to 5.0.</p>
</div>
<div class="sect4">
<h5 id="other_changes"><a class="anchor" href="#other_changes"></a><a class="link" href="#other_changes">Other changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>The <code>enableFeaturePreview('IMPROVED_POM_SUPPORT')</code> and <code>enableFeaturePreview('STABLE_PUBLISHING')</code> flags are no longer necessary. These features are now enabled by default.</p>
</li>
<li>
<p>Gradle now bundles <a href="#rel5.0:jaxb_and_java9">JAXB</a> for Java 9 and above. You can remove the <code>--add-modules java.xml.bind</code> option from <code>org.gradle.jvmargs</code>, if set.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_12"><a class="anchor" href="#potential_breaking_changes_12"></a><a class="link" href="#potential_breaking_changes_12">Potential breaking changes</a></h5>
<div class="paragraph">
<p>The changes in this section have the potential to break your build, but the vast majority have been deprecated for quite some time and few builds will be affected by a large number of them. We strongly recommend upgrading to Gradle 4.10 first to get a report on what deprecations affect your build.</p>
</div>
<div class="paragraph">
<p>The following breaking changes are not from deprecations, but the result of changes in behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rel5.0:pom_compile_runtime_separation">Separation of compile and runtime dependencies when consuming POMs</a></p>
</li>
<li>
<p>The evaluation of the <code>publishing {}</code> block is no longer deferred until needed but behaves like any other block.
Please use <code>afterEvaluate {}</code> if you need to defer evaluation.</p>
</li>
<li>
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Javadoc.html"><code>Javadoc</code></a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Groovydoc.html"><code>Groovydoc</code></a> tasks now delete the destination dir for the documentation before executing. This has been added to remove stale output files from the last task execution.</p>
</li>
<li>
<p>The <a href="#">Java Library Distribution Plugin</a> is now based on the <a href="#">Java Library Plugin</a> instead of the <a href="#">Java Plugin</a>.</p>
<div class="paragraph">
<p>While it applies the Java Plugin, it behaves slightly different (e.g. it adds the <code>api</code> configuration). Thus, make sure to check whether your build behaves as expected after upgrading.</p>
</div>
</li>
<li>
<p>The <code>html</code> property on <code>CheckstyleReport</code> and <code>FindBugsReport</code> now returns a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.reporting.CustomizableHtmlReport.html"><code>CustomizableHtmlReport</code></a> instance that is easier to configure from statically typed languages like Java and Kotlin.</p>
</li>
<li>
<p>The <a href="#rel5.0:configuration_avoidance">Configuration Avoidance API</a> has been updated to prevent the creation and configuration of tasks that are never used.</p>
</li>
<li>
<p>The <a href="#rel5.0:default_memory_settings">default memory settings</a> for the command-line client, the Gradle daemon, and all workers including compilers and test executors, have been greatly reduced.</p>
</li>
<li>
<p>The <a href="#rel5.0:default_tool_versions">default versions of several code quality plugins</a> have been updated.</p>
</li>
<li>
<p>Several <a href="#rel5.0:library_upgrades">library versions used by Gradle</a> have been upgraded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following breaking changes will appear as deprecation warnings with Gradle 4.10:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">General</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>&lt;&lt;</code> for task definitions no longer works. In other words, you can not use the syntax <code>task myTask &lt;&lt; { &#8230;&#8203; }</code>.</p>
<div class="paragraph">
<p>Use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doLast(org.gradle.api.Action)">Task.doLast()</a> method instead, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>task myTask {
    doLast {
        ...
    }
}</pre>
</div>
</div>
</li>
<li>
<p>You can no longer use any of the following characters in domain object names, such as project and task names: &lt;space&gt; <code>/ \ : &lt; &gt; " ? * |</code> . You should also not use <code>.</code> as a leading or trailing character.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Running Gradle &amp; build environment</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>As mentioned before, Gradle can no longer be run on Java 7. However, you can still use <a href="#sec:java_cross_compilation">forked compilation and testing</a> to build and test software for Java 6 and above.</p>
</li>
<li>
<p>The <code>-Dtest.single</code> command-line option has been removed use <a href="#test_filtering">test filtering</a> instead.</p>
</li>
<li>
<p>The <code>-Dtest.debug</code> command-line option has been removed  use the <a href="#sec:debugging_java_tests"><code>--debug-jvm</code> option</a> instead.</p>
</li>
<li>
<p>The <code>-u</code>/<code>--no-search-upward</code> command-line option has been removed make sure all your builds have a <em>settings.gradle</em> file.</p>
</li>
<li>
<p>The <code>--recompile-scripts</code> command-line option has been removed.</p>
</li>
<li>
<p>You can no longer have a Gradle build nested in a subdirectory of another Gradle build unless the nested build has a <em>settings.gradle</em> file.</p>
</li>
<li>
<p>The <code>DirectoryBuildCache.setTargetSizeInMB(long)</code> method has been removed use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.local.DirectoryBuildCache.html#org.gradle.caching.local.DirectoryBuildCache:removeUnusedEntriesAfterDays">DirectoryBuildCache.removeUnusedEntriesAfterDays</a> instead.</p>
</li>
<li>
<p>The <code>org.gradle.readLoggingConfigFile</code> system property no longer does anything update affected tests to work with your <code>java.util.logging</code> settings.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Working with files</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can no longer cast <code>FileCollection</code> objects to other types using the <code>as</code> keyword or the <code>asType()</code> method.</p>
</li>
<li>
<p>You can no longer pass <code>null</code> as the configuration action of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#from-java.lang.Object-org.gradle.api.Action-">CopySpec.from(Object, Action)</a>.</p>
</li>
<li>
<p>For better compatibility with the Kotlin DSL, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DuplicatesStrategy.html">CopySpec.duplicatesStrategy</a> is no longer nullable. The property setter no longer accepts <code>null</code> as a way
to reset the property back to its default value. Use <code>DuplicatesStrategy.INHERIT</code> instead.</p>
</li>
<li>
<p>The <code>FileCollection.stopExecutionIfEmpty()</code> method has been removed  use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/SkipWhenEmpty.html">@SkipWhenEmpty</a> annotation on <code>FileCollection</code> task properties instead.</p>
</li>
<li>
<p>The <code>FileCollection.add()</code> method has been removed use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files()</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree()</a> to create configurable file collections/file trees and add to them via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html#from-java.lang.Object...-">ConfigurableFileCollection.from()</a>.</p>
</li>
<li>
<p><code>SimpleFileCollection</code> has been removed  use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(Object&#8230;&#8203;)</a> instead.</p>
</li>
<li>
<p>Don&#8217;t have your own classes extend <code>AbstractFileCollection</code>  use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files()</a> method instead. This problem may exhibit as a missing <code>getBuildDependencies()</code> method.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java builds</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>CompileOptions.bootClasspath</code> property has been removed use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:bootstrapClasspath">CompileOptions.bootstrapClasspath</a> instead.</p>
</li>
<li>
<p>You can no longer use <code>-source-path</code> as a generic compiler argument use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:sourcepath">CompileOptions.sourcepath</a> instead.</p>
</li>
<li>
<p>You can no longer use <code>-processorpath</code> as a generic compiler argument use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:annotationProcessorPath">CompileOptions.annotationProcessorPath</a> instead.</p>
</li>
<li>
<p>Gradle will no longer automatically apply annotation processors that are on the compile classpath  use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:annotationProcessorPath">CompileOptions.annotationProcessorPath</a> instead.</p>
</li>
<li>
<p>The <code>testClassesDir</code> property has been removed from the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> task use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:testClassesDirs">testClassesDirs</a> instead.</p>
</li>
<li>
<p>The <code>classesDir</code> property has been removed from both the <em>JDepend</em> task and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSetOutput.html">SourceSetOutput</a>. Use the <em>JDepend.classesDirs</em> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSetOutput.html#org.gradle.api.tasks.SourceSetOutput:classesDirs">SourceSetOutput.classesDirs</a> properties instead.</p>
</li>
<li>
<p>The <code>JavaLibrary(PublishArtifact, DependencySet)</code> constructor has been removed this was used by the <a href="https://plugins.gradle.org/plugin/com.github.johnrengelman.shadow">Shadow Plugin</a>, so make sure you upgrade to at least version 2.x of that plugin.</p>
</li>
<li>
<p>The <code>JavaBasePlugin.configureForSourceSet()</code> method has been removed.</p>
</li>
<li>
<p>You can no longer create your own instances of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/JavaPluginConvention.html">JavaPluginConvention</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/ApplicationPluginConvention.html">ApplicationPluginConvention</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/WarPluginConvention.html">WarPluginConvention</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ear/EarPluginConvention.html">EarPluginConvention</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/BasePluginConvention.html">BasePluginConvention</a>, and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/ProjectReportsPluginConvention.html">ProjectReportsPluginConvention</a>.</p>
</li>
<li>
<p>The <code>Maven</code> Plugin used to publish the highly outdated Maven 2 metadata format. This has been changed and it will now publish Maven 3 metadata, just like the <code>Maven Publish</code> Plugin.</p>
<div class="paragraph">
<p>With the removal of Maven 2 support, the methods that configure unique snapshot behavior have also been removed. Maven 3 only supports unique snapshots, so we decided to remove them.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Tasks &amp; properties</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following legacy classes and methods related to <a href="#lazy_properties">lazy properties</a> have been removed use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property()</a> to create <code>Property</code> instances:</p>
<div class="ulist">
<ul>
<li>
<p><code>PropertyState</code></p>
</li>
<li>
<p><code>DirectoryVar</code></p>
</li>
<li>
<p><code>RegularFileVar</code></p>
</li>
<li>
<p><code>ProjectLayout.newDirectoryVar()</code></p>
</li>
<li>
<p><code>ProjectLayout.newFileVar()</code></p>
</li>
<li>
<p><code>Project.property(Class)</code></p>
</li>
<li>
<p><code>Script.property(Class)</code></p>
</li>
<li>
<p><code>ProviderFactory.property(Class)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Tasks configured and registered with the <a href="task_configuration_avoidance.html#sec:task_configuration_avoidance_migration_guidelines">task configuration avoidance</a> APIs have more restrictions on the other methods that can be called from a configuration action.</p>
</li>
<li>
<p>The internal <code>@Option</code> and <code>@OptionValues</code> annotations  package <code>org.gradle.api.internal.tasks.options</code>  have been removed. Use the public <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/Option.html">@Option</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/OptionValues.html">@OptionValues</a> annotations instead.</p>
</li>
<li>
<p>The <code>Task.deleteAllActions()</code> method has been removed with no replacement.</p>
</li>
<li>
<p>The <code>Task.dependsOnTaskDidWork()</code> method has been removed  use <a href="#sec:up_to_date_checks">declared inputs and outputs</a> instead.</p>
</li>
<li>
<p>The following properties and methods of <code>TaskInternal</code> have been removed use task dependencies, task rules, reusable utility methods, or the <a href="#worker_api">Worker API</a> in place of executing a task directly.</p>
<div class="ulist">
<ul>
<li>
<p><code>execute()</code></p>
</li>
<li>
<p><code>executer</code></p>
</li>
<li>
<p><code>getValidators()</code></p>
</li>
<li>
<p><code>addValidator()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html#file-java.lang.Object-">TaskInputs.file(Object)</a> method can no longer be called with an argument that resolves to anything other than a single regular file.</p>
</li>
<li>
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html#dir-java.lang.Object-">TaskInputs.dir(Object)</a> method can no longer be called with an argument that resolves to anything other than a single directory.</p>
</li>
<li>
<p>You can no longer register invalid inputs and outputs via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html">TaskInputs</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html">TaskOutputs</a>.</p>
</li>
<li>
<p>The <code>TaskDestroyables.file()</code> and <code>TaskDestroyables.files()</code> methods have been removed use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskDestroyables.html#register-java.lang.Object...-">TaskDestroyables.register()</a> instead.</p>
</li>
<li>
<p><code>SimpleWorkResult</code> has been removed use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/WorkResult.html#getDidWork--">WorkResult.didWork</a>.</p>
</li>
<li>
<p>Overriding built-in tasks <a href="#deprecations_4.8">deprecated in 4.8</a> now produces an error.</p>
<div class="paragraph">
<p>Attempting to replace a built-in task will produce an error similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Cannot add task 'wrapper' as a task with that name already exists.</pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Scala &amp; Play</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Play 2.2 is no longer supported  please upgrade the version of Play you are using.</p>
</li>
<li>
<p>The <code>ScalaDocOptions.styleSheet</code> property has been removed  the Scaladoc Ant task in Scala 2.11.8 and later no longer supports this property.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Kotlin DSL</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Artifact configuration accessors now have the type <code>NamedDomainObjectProvider&lt;Configuration&gt;</code> instead of <code>Configuration</code></p>
</li>
<li>
<p><code>PluginAware.apply&lt;T&gt;(to)</code> was renamed <code>PluginAware.applyTo&lt;T&gt;(target)</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both changes could cause script compilation errors. See the <a href="https://github.com/gradle/kotlin-dsl-samples/releases/tag/v1.0.2#breaking-changes">Gradle Kotlin DSL release notes</a> for more information and how to fix builds broken by the changes described above.</p>
</div>
</dd>
<dt class="hdlist1">Miscellaneous</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>ConfigurableReport.setDestination(Object)</code> method has been removed use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/reporting/ConfigurableReport.html#setDestination-java.io.File-">ConfigurableReport.setDestination(File)</a> instead.</p>
</li>
<li>
<p>The <code>Signature.setFile(File)</code> method has been removed Gradle does not support changing the output file for the generated signature.</p>
</li>
<li>
<p>The read-only <code>Signature.toSignArtifact</code> property has been removed it should never have been part of the public API.</p>
</li>
<li>
<p>The <code>@DeferredConfigurable</code> annotation has been removed.</p>
</li>
<li>
<p>The method <code>isDeferredConfigurable()</code> was removed from <code>ExtensionSchema</code>.</p>
</li>
<li>
<p><code>IdeaPlugin.performPostEvaluationActions()</code> and <code>EclipsePlugin.performPostEvaluationActions()</code> have been removed.</p>
</li>
<li>
<p><code>The `BroadcastingCollectionEventRegister.getAddAction()</code> method has been removed with no replacement.</p>
</li>
<li>
<p>The internal <code>org.gradle.util</code> package is no longer imported by default.</p>
<div class="paragraph">
<p>Ideally you shouldn&#8217;t use classes from this package, but, as a quick fix, you can add explicit imports to your build scripts for those classes.</p>
</div>
</li>
<li>
<p>The <code>gradlePluginPortal()</code> repository <a href="#rel5.0:gradle_plugin_portal_metadata">no longer looks for JARs without a POM by default</a>.</p>
</li>
<li>
<p>The Tooling API can no longer connect to builds using a Gradle version below Gradle 2.6. The same applies to builds run through TestKit.</p>
</li>
<li>
<p>Gradle 5.0 requires a minimum Tooling API client version of 3.0. Older client libraries can no longer run builds with Gradle 5.0.</p>
</li>
<li>
<p>The IdeaModule Tooling API model element contains methods to retrieve resources and test resources so those elements were removed from the result of <code>IdeaModule.getSourceDirs()</code> and <code>IdeaModule.getTestSourceDirs()</code>.</p>
</li>
<li>
<p>In previous Gradle versions, the <code>source</code> field in <code>SourceTask</code> was accessible from subclasses. This is not the case anymore as the <code>source</code> field is now declared as <code>private</code>.</p>
</li>
<li>
<p>In the Worker API, <a href="#rel5.0:worker_api">the working directory of a worker can no longer be set</a>.</p>
</li>
<li>
<p>A change in behavior related to <a href="#rel5.0:dependency_constraints">dependency and version constraints</a> may impact a small number of users.</p>
</li>
<li>
<p>There have been several changes to <a href="#rel5.0:changes_to_default_task">property factory methods on DefaultTask</a> that may impact the creation of custom tasks.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.10"><a class="anchor" href="#changes_4.10"></a><a class="link" href="#changes_4.10">Upgrading from 4.9 and earlier</a></h4>
<div class="paragraph">
<p>If you are not already on version 4.9, skip down to the section that applies to your current Gradle version and work your way up until you reach here. Then, apply these changes when upgrading to Gradle 4.10.</p>
</div>
<div class="sect4">
<h5 id="deprecated_classes_methods_and_properties"><a class="anchor" href="#deprecated_classes_methods_and_properties"></a><a class="link" href="#deprecated_classes_methods_and_properties">Deprecated classes, methods and properties</a></h5>
<div class="paragraph">
<p>Follow the API links to learn how to deal with these deprecations (if no extra information is provided here):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TaskContainer.add()</code> and <code>TaskContainer.addAll()</code> use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html#create-java.lang.String-java.lang.Class-org.gradle.api.Action-">TaskContainer.create()</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html#register-java.lang.String-java.lang.Class-org.gradle.api.Action-">TaskContainer.register()</a> instead</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_13"><a class="anchor" href="#potential_breaking_changes_13"></a><a class="link" href="#potential_breaking_changes_13">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>There have been several potentially breaking changes in Kotlin DSL see the <em>Breaking changes</em> section of <a href="https://github.com/gradle/kotlin-dsl/releases/tag/v1.0-RC3">that project&#8217;s release notes</a>.</p>
</li>
<li>
<p>You can no longer use any of the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:beforeEvaluate(org.gradle.api.Action)">Project.beforeEvaluate()</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:afterEvaluate(org.gradle.api.Action)">Project.afterEvaluate()</a> methods with lazy task configuration, for example inside a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html#register-java.lang.String-java.lang.Class-org.gradle.api.Action-">TaskContainer.register()</a> block.</p>
</li>
<li>
<p><a href="#rel4.10:aws_s3_permissions">Publishing to AWS S3 requires new permissions</a>.</p>
</li>
<li>
<p>Both <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/PluginUnderTestMetadata.html">PluginUnderTestMetadata</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/GeneratePluginDescriptors.html">GeneratePluginDescriptors</a>  classes used by the <a href="#">Java Gradle Plugin Development Plugin</a> have been updated to use the Provider API.</p>
<div class="paragraph">
<p>Use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html#set-T-">Property.set()</a> method to modify their values rather than using standard property assignment syntax, unless you are doing so in a Groovy build script. Standard property assignment still works in that one case.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.9"><a class="anchor" href="#changes_4.9"></a><a class="link" href="#changes_4.9">Upgrading from 4.8 and earlier</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="#rel4.9:lazy_task_creation">Consider trying the lazy API for task creation and configuration</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_14"><a class="anchor" href="#potential_breaking_changes_14"></a><a class="link" href="#potential_breaking_changes_14">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>You can no longer use GPath syntax with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskCollection.html#withType-java.lang.Class-">tasks.withType()</a>.</p>
<div class="paragraph">
<p>Use <a href="https://docs.groovy-lang.org/latest/html/documentation/#_spread_operator">Groovy&#8217;s spread operator</a> instead. For example, you would replace <code>tasks.withType(JavaCompile).name</code> with <code>tasks.withType(JavaCompile)*.name</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.8"><a class="anchor" href="#changes_4.8"></a><a class="link" href="#changes_4.8">Upgrading from 4.7 and earlier</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="#rel4.8:switch_to_publishing_plugins">Switch to the Maven Publish and Ivy Publish plugins</a></p>
</li>
<li>
<p><a href="#rel4.8:deferred_configuration">Use deferred configuration with the publishing plugins</a></p>
</li>
<li>
<p><a href="#rel4.8:configure_internal_tasks">Configure existing <code>wrapper</code> and <code>init</code> tasks</a> rather than defining your own</p>
</li>
<li>
<p>Consider migrating to the built-in <a href="#">dependency locking mechanism</a> if you are currently using a plugin or custom solution for this</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_15"><a class="anchor" href="#potential_breaking_changes_15"></a><a class="link" href="#potential_breaking_changes_15">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>Build will now fail if a specified init script is not found.</p>
</li>
<li>
<p><code>TaskContainer.remove()</code> now actually removes the given task some plugins may have accidentally relied on the old behavior.</p>
</li>
<li>
<p><a href="#rel4.8:pom_wildcard_exclusions">Gradle now honors implicit wildcards in Maven POM exclusions</a>.</p>
</li>
<li>
<p>The Kotlin DSL now respects JSR-305 package annotations.</p>
<div class="paragraph">
<p>This will lead to some types annotated according to JSR-305 being treated as nullable where they were treated as non-nullable before. This may lead to compilation errors in the build script. See <a href="https://github.com/gradle/kotlin-dsl/releases/tag/v0.17.4">the relevant Kotlin DSL release notes</a> for details.</p>
</div>
</li>
<li>
<p>Error messages will be directed to standard error rather than standard output now, unless a console is attached to both standard output and standard error. This may affect tools that scrape a build&#8217;s plain console output. Ignore this change if you&#8217;re upgrading from an earlier version of Gradle.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="deprecations_4.8"><a class="anchor" href="#deprecations_4.8"></a><a class="link" href="#deprecations_4.8">Deprecations</a></h5>
<div class="paragraph">
<p>Prior to this release, builds were allowed to replace built-in tasks. <a href="https://docs.gradle.org/4.8/release-notes.html#overwriting-gradle's-built-in-tasks">This feature has been deprecated</a>.</p>
</div>
<div class="paragraph">
<p>The full list of built-in tasks that should not be replaced is:
<code>wrapper</code>, <code>init</code>, <code>help</code>, <code>tasks</code>, <code>projects</code>, <code>buildEnvironment</code>, <code>components</code>, <code>dependencies</code>, <code>dependencyInsight</code>, <code>dependentComponents</code>, <code>model</code>, <code>properties</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.7"><a class="anchor" href="#changes_4.7"></a><a class="link" href="#changes_4.7">Upgrading from 4.6 and earlier</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_16"><a class="anchor" href="#potential_breaking_changes_16"></a><a class="link" href="#potential_breaking_changes_16">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>Gradle will now, by convention, look for Checkstyle configuration files in the root project&#8217;s <em>config/checkstyle</em> directory.</p>
<div class="paragraph">
<p>Checkstyle configuration files in subprojects  the old by-convention location will be ignored unless you explicitly configure their path via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CheckstyleExtension.html#org.gradle.api.plugins.quality.CheckstyleExtension:configDir">checkstyle.configDir</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CheckstyleExtension.html#org.gradle.api.plugins.quality.CheckstyleExtension:config">checkstyle.config</a>.</p>
</div>
</li>
<li>
<p>The structure of Gradle&#8217;s <a href="#rel4.7:plain_console_output">plain console output</a> has changed, which may break tools that scrape that output.</p>
</li>
<li>
<p>The APIs of many native tasks related to compilation, linking and installation <a href="#rel:4.6:native_task_api_changes">have changed in breaking ways</a>.</p>
</li>
<li>
<p>[Kotlin DSL] Delegated properties used to access Gradle&#8217;s build properties  defined in <em>gradle.properties</em> for example  must now be explicitly typed.</p>
</li>
<li>
<p>[Kotlin DSL] Declaring a <code>plugins {}</code> block inside a nested scope now throws an exception.</p>
</li>
<li>
<p>[Kotlin DSL] Only one <code>pluginManagement {}</code> block is allowed now.</p>
</li>
<li>
<p>The cache control DSL provided by the <code>org.gradle.api.artifacts.cache.*</code> interfaces are no longer available.</p>
</li>
<li>
<p><code>getEnabledDirectoryReportDestinations()</code>, <code>getEnabledFileReportDestinations()</code> and <code>getEnabledReportNames()</code> have all been removed from <code>org.gradle.api.reporting.ReportContainer</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/StartParameter.html#getProjectProperties--">StartParameter.projectProperties</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/StartParameter.html#getSystemPropertiesArgs--">StartParameter.systemPropertiesArgs</a> now return immutable maps.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.6"><a class="anchor" href="#changes_4.6"></a><a class="link" href="#changes_4.6">Upgrading from 4.5 and earlier</a></h4>
<div class="sect4">
<h5 id="deprecations_10"><a class="anchor" href="#deprecations_10"></a><a class="link" href="#deprecations_10">Deprecations</a></h5>
<div id="rel4.6:annotation_processor_configuration" class="ulist">
<ul>
<li>
<p>You should not put annotation processors on the compile classpath or declare them with the <code>-processorpath</code> compiler argument.</p>
<div class="paragraph">
<p>They should be added to the <code>annotationProcessor</code> configuration instead. If you don&#8217;t want any processing, but your compile classpath contains a processor unintentionally (e.g. as part of a library you depend on), use the <code>-proc:none</code> compiler argument to ignore it.</p>
</div>
</li>
<li>
<p>Use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a> in place of <a href="https://docs.gradle.org/4.10.3/javadoc/org/gradle/api/tasks/compile/CompilerArgumentProvider.html">CompilerArgumentProvider</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_17"><a class="anchor" href="#potential_breaking_changes_17"></a><a class="link" href="#potential_breaking_changes_17">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>The Java plugins now add a <code><em>sourceSet</em>AnnotationProcessor</code> configuration for each source set, which might break if any of them match existing configurations you have. We recommend you remove your conflicting configuration declarations.</p>
</li>
<li>
<p>The <code>StartParameter.taskOutputCacheEnabled</code> property has been replaced by <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/StartParameter.html#setBuildCacheEnabled-boolean-">StartParameter.setBuildCacheEnabled(boolean)</a>.</p>
</li>
<li>
<p>The Visual Studio integration now only <a href="#rel4.6:visual_studio_single_solution">configures a single solution for all components in a build</a>.</p>
</li>
<li>
<p>Gradle has replaced HttpClient 4.4.1 with version 4.5.5.</p>
</li>
<li>
<p>Gradle now bundles the <code>kotlin-stdlib-jdk8</code> artifact instead of <code>kotlin-stdlib-jre8</code>. This may affect your build. Please see the <a href="http://kotlinlang.org/docs/reference/whatsnew12.html#kotlin-standard-library-artifacts-and-split-packages">Kotlin documentation</a> for more details.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.5"><a class="anchor" href="#changes_4.5"></a><a class="link" href="#changes_4.5">Upgrading from 4.4 and earlier</a></h4>
<div class="ulist">
<ul>
<li>
<p>Make sure you have a <em>settings.gradle</em> file: it avoids a performance penalty and allows you to set the root project&#8217;s name.</p>
</li>
<li>
<p>Gradle now ignores the build cache configuration of included builds (<a href="#">composite builds</a>) and instead uses the root build&#8217;s configuration for all the builds.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_18"><a class="anchor" href="#potential_breaking_changes_18"></a><a class="link" href="#potential_breaking_changes_18">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>Two overloaded <code>ValidateTaskProperties.setOutputFile()</code> methods were removed. They are replaced with auto-generated setters when the task is accessed from a build script, but that won&#8217;t be the case from plugins and other code outside of the build script.</p>
</li>
<li>
<p>The Maven Publish Plugin now produces more complete maven-metadata.xml files, including maintaining a list of <code>&lt;snapshotVersion&gt;</code> elements. Some older versions of Maven may not be able to consume this metadata.</p>
</li>
<li>
<p><a href="#rel4.5:http_build_cache_no_follow_redirects"><code>HttpBuildCache</code> no longer follows redirects</a>.</p>
</li>
<li>
<p>The <code>Depend</code> task type has been removed.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(Object)</a> no longer normalizes case for file paths on case-insensitive file systems. It now ignores case in such circumstances and does not touch the file system.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty</a> no longer extends <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.4"><a class="anchor" href="#changes_4.4"></a><a class="link" href="#changes_4.4">Upgrading from 4.3 and earlier</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_19"><a class="anchor" href="#potential_breaking_changes_19"></a><a class="link" href="#potential_breaking_changes_19">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.AbstractTestTask.html">AbstractTestTask</a> is now extended by non-JVM test tasks as well as <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>. Plugins should beware configuring all tasks of type <code>AbstractTestTask</code> because of this.</p>
</li>
<li>
<p>The default output location for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseClasspath.html#org.gradle.plugins.ide.eclipse.model.EclipseClasspath:defaultOutputDir">EclipseClasspath.defaultOutputDir</a> has changed from <em><code>$projectDir</code>/bin</em> to <em><code>$projectDir</code>/bin/default</em>.</p>
</li>
<li>
<p>The deprecated <code>InstallExecutable.setDestinationDir(Provider)</code> was removed use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.InstallExecutable.html#org.gradle.nativeplatform.tasks.InstallExecutable:installDirectory">InstallExecutable.installDirectory</a> instead.</p>
</li>
<li>
<p>The deprecated <code>InstallExecutable.setExecutable(Provider)</code> was removed  use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.InstallExecutable.html#org.gradle.nativeplatform.tasks.InstallExecutable:executableFile">InstallExecutable.executableFile</a> instead.</p>
</li>
<li>
<p>Gradle will no longer prefer a version of Visual Studio found on the path over other locations. It is now a last resort.</p>
<div class="paragraph">
<p>You can bypass the toolchain discovery by specifying the installation directory of the version of Visual Studio you want via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.VisualCpp.html#org.gradle.nativeplatform.toolchain.VisualCpp:installDir">VisualCpp.setInstallDir(Object)</a>.</p>
</div>
</li>
<li>
<p><code>pluginManagement.repositories</code> is now of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html">RepositoryHandler</a> rather than <code>PluginRepositoriesSpec</code>, which has been removed.</p>
</li>
<li>
<p>5xx HTTP errors during dependency resolution will now trigger exceptions in the build.</p>
</li>
<li>
<p>The embedded Apache Ant has been upgraded from 1.9.6 to 1.9.9.</p>
</li>
<li>
<p><a href="#rel4.4:security_library_upgrades">Several third-party libraries used by Gradle have been upgraded</a> to fix security issues.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.3"><a class="anchor" href="#changes_4.3"></a><a class="link" href="#changes_4.3">Upgrading from 4.2 and earlier</a></h4>
<div class="ulist">
<ul>
<li>
<p>The <code>plugins {}</code> block can now be <a href="#sec:subprojects_plugins_dsl">used in subprojects</a> and for <a href="#sec:buildsrc_plugins_dsl">plugins in the <em>buildSrc</em> directory</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="other_deprecations"><a class="anchor" href="#other_deprecations"></a><a class="link" href="#other_deprecations">Other deprecations</a></h5>
<div class="ulist">
<ul>
<li>
<p>You should no longer run Gradle versions older than 2.6 via the Tooling API.</p>
</li>
<li>
<p>You should no longer run any version of Gradle via an older version of the Tooling API than 3.0.</p>
</li>
<li>
<p>You should no longer chain <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html#property-java.lang.String-java.lang.Object-">TaskInputs.property(String,Object)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html#properties-java.util.Map-">TaskInputs.properties(Map)</a> methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_20"><a class="anchor" href="#potential_breaking_changes_20"></a><a class="link" href="#potential_breaking_changes_20">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/DefaultTask.html#newOutputDirectory--">DefaultTask.newOutputDirectory()</a> now returns a <code>DirectoryProperty</code> instead of a <code>DirectoryVar</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/DefaultTask.html#newOutputFile--">DefaultTask.newOutputFile()</a> now returns a <code>RegularFileProperty</code> instead of a <code>RegularFileVar</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/DefaultTask.html#newInputFile--">DefaultTask.newInputFile()</a> now returns a <code>RegularFileProperty</code> instead of a <code>RegularFileVar</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#getBuildDirectory--">ProjectLayout.buildDirectory</a> now returns a <code>DirectoryProperty</code> instead of a <code>DirectoryVar</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.nativeplatform.tasks.AbstractNativeCompileTask.html#org.gradle.language.nativeplatform.tasks.AbstractNativeCompileTask:compilerArgs">AbstractNativeCompileTask.compilerArgs</a> is now of type <code>ListProperty&lt;String&gt;</code> instead of <code>List&lt;String&gt;</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.nativeplatform.tasks.AbstractNativeCompileTask.html#org.gradle.language.nativeplatform.tasks.AbstractNativeCompileTask:objectFileDir">AbstractNativeCompileTask.objectFileDir</a> is now of type <code>DirectoryProperty</code> instead of <code>File</code>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.AbstractLinkTask.html#org.gradle.nativeplatform.tasks.AbstractLinkTask:linkerArgs">AbstractLinkTask.linkerArgs</a> is now of type <code>ListProperty&lt;String&gt;</code> instead of <code>List&lt;String&gt;</code>.</p>
</li>
<li>
<p><code>TaskDestroyables.getFiles()</code> is no longer part of the public API.</p>
</li>
<li>
<p>Overlapping version ranges for a dependency now result in Gradle picking a version that satisfies all declared ranges.</p>
<div class="paragraph">
<p>For example, if a dependency on <code>some-module</code> is found with a version range of <code>[3,6]</code> and also transitively with a range of <code>[4,8]</code>, Gradle now selects version 6 instead of 8. The prior behavior was to select 8.</p>
</div>
</li>
<li>
<p>The order of elements in <code>Iterable</code> properties marked with either <code>@OutputFiles</code> or <code>@OutputDirectories</code> now matters. If the order changes, the property is no longer considered up to date.</p>
<div class="paragraph">
<p>Prefer using separate properties with <code>@OutputFile</code>/<code>@OutputDirectory</code> annotations or use <code>Map</code> properties with <code>@OutputFiles</code>/<code>@OutputDirectories</code> instead.</p>
</div>
</li>
<li>
<p>Gradle will no longer ignore dependency resolution errors from a repository when there is another repository it can check. Dependency resolution will fail instead. This results in more deterministic behavior with respect to resolution results.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.2"><a class="anchor" href="#changes_4.2"></a><a class="link" href="#changes_4.2">Upgrading from 4.1 and earlier</a></h4>
<div class="sect4">
<h5 id="potential_breaking_changes_21"><a class="anchor" href="#potential_breaking_changes_21"></a><a class="link" href="#potential_breaking_changes_21">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>The <code>withPathSensitivity()</code> methods on <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskFilePropertyBuilder.html">TaskFilePropertyBuilder</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputFilePropertyBuilder.html">TaskOutputFilePropertyBuilder</a> have been removed.</p>
</li>
<li>
<p>The bundled <code>bndlib</code> has been upgraded from 3.2.0 to 3.4.0.</p>
</li>
<li>
<p>The FindBugs Plugin no longer renders progress information from its analysis. If you rely on that output in any way, you can enable it with <em>FindBugs.showProgress</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_4.1"><a class="anchor" href="#changes_4.1"></a><a class="link" href="#changes_4.1">Upgrading from 4.0</a></h4>
<div class="ulist">
<ul>
<li>
<p>Consider using the new <a href="#worker_api">Worker API</a> to enable units of work within your build to run in parallel.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="deprecated_classes_methods_and_properties_2"><a class="anchor" href="#deprecated_classes_methods_and_properties_2"></a><a class="link" href="#deprecated_classes_methods_and_properties_2">Deprecated classes, methods and properties</a></h5>
<div class="paragraph">
<p>Follow the API links to learn how to deal with these deprecations (if no extra information is provided here):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/4.10.3/javadoc/org/gradle/api/Nullable.html">Nullable</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="potential_breaking_changes_22"><a class="anchor" href="#potential_breaking_changes_22"></a><a class="link" href="#potential_breaking_changes_22">Potential breaking changes</a></h5>
<div class="ulist">
<ul>
<li>
<p>Non-Java projects that have a <a href="#sub:project_dependencies">project dependency</a> on a Java project now consume the <code>runtimeElements</code> configuration by default instead of the <code>default</code> configuration.</p>
<div class="paragraph">
<p>To override this behavior, you can explicitly declare the configuration to use in the project dependency. For example: <code>project(path: ':myJavaProject', configuration: 'default')</code>.</p>
</div>
</li>
<li>
<p>Default Zinc compiler upgraded from 0.3.13 to 0.3.15.</p>
</li>
<li>
<p>[Kotlin DSL] Base package renamed from <code>org.gradle.script.lang.kotlin</code> to <code>org.gradle.kotlin.dsl</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_in_detail"><a class="anchor" href="#changes_in_detail"></a><a class="link" href="#changes_in_detail">Changes in detail</a></h4>
<div class="sect4">
<h5 id="rel5.0:default_memory_settings"><a class="anchor" href="#rel5.0:default_memory_settings"></a><a class="link" href="#rel5.0:default_memory_settings">[5.0] Default memory settings changed</a></h5>
<div class="paragraph">
<p>The command line client now starts with 64MB of heap instead of 1GB.
This may affect builds running directly inside the client VM using <code>--no-daemon</code> mode.
We discourage the use of <code>--no-daemon</code>, but if you must use it, you can increase the available memory using the <code>GRADLE_OPTS</code> environment variable.</p>
</div>
<div class="paragraph">
<p>The Gradle daemon now starts with 512MB of heap instead of 1GB.
Large projects may have to increase this setting using the <a href="#sec:configuring_jvm_memory"><code>org.gradle.jvmargs</code></a> property.</p>
</div>
<div class="paragraph">
<p>All workers, including compilers and test executors, now start with 512MB of heap. The previous default was 1/4th of physical memory.
Large projects may have to increase this setting on the relevant tasks, e.g. <a href="#sec:configuring_jvm_memory"><code>JavaCompile</code></a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html"><code>Test</code></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:default_tool_versions"><a class="anchor" href="#rel5.0:default_tool_versions"></a><a class="link" href="#rel5.0:default_tool_versions">[5.0] New default versions for code quality plugins</a></h5>
<div class="paragraph">
<p>The default tool versions of the following code quality plugins have been updated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="http://checkstyle.sourceforge.net">Checkstyle Plugin</a> now uses <a href="http://checkstyle.sourceforge.net/releasenotes.html#Release_8.12">8.12</a> instead of 6.19 by default.</p>
</li>
<li>
<p>The <a href="http://codenarc.sourceforge.net">CodeNarc Plugin</a> now uses <a href="https://github.com/CodeNarc/CodeNarc/blob/master/CHANGELOG.md#version-121-aug-2018">1.2.1</a> instead of 1.1 by default.</p>
</li>
<li>
<p>The <a href="https://www.jacoco.org/jacoco/">JaCoCo Plugin</a> now uses <a href="https://www.jacoco.org/jacoco/trunk/doc/changes.html">0.8.2</a> instead of 0.8.1 by default.</p>
</li>
<li>
<p>The <a href="https://pmd.github.io/">PMD Plugin</a> now uses <a href="https://pmd.github.io/pmd-6.8.0/pmd_release_notes.html#30-september-2018---680">6.8.0</a> instead of 5.6.1 by default.</p>
<div class="paragraph">
<p>In addition, the default ruleset was changed from the now deprecated <code>java-basic</code> to <code>category/java/errorprone.xml</code>.</p>
</div>
<div class="paragraph">
<p>We recommend configuring a ruleset explicitly, though.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:library_upgrades"><a class="anchor" href="#rel5.0:library_upgrades"></a><a class="link" href="#rel5.0:library_upgrades">[5.0] Library upgrades</a></h5>
<div class="paragraph">
<p>Several libraries that are used by Gradle have been upgraded:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy was upgraded from 2.4.15 to <a href="https://groovy-lang.org/releasenotes/groovy-2.5.html">2.5.4</a>.</p>
</li>
<li>
<p>Ant has been upgraded from 1.9.11 to <a href="https://archive.apache.org/dist/ant/RELEASE-NOTES-1.9.13.html">1.9.13</a>.</p>
</li>
<li>
<p>The AWS SDK used to access S3-backed Maven/Ivy repositories has been upgraded from 1.11.267 to <a href="https://github.com/aws/aws-sdk-java/blob/master/CHANGELOG.md#111407-2018-09-11">1.11.407</a>.</p>
</li>
<li>
<p>The BND library used by the OSGi Plugin has been upgraded from 3.4.0 to <a href="https://github.com/bndtools/bnd/wiki/Changes-in-4.0.0">4.0.0</a>.</p>
</li>
<li>
<p>The Google Cloud Storage JSON API Client Library used to access Google Cloud Storage backed Maven/Ivy repositories has been upgraded from v1-rev116-1.23.0 to v1-rev136-1.25.0.</p>
</li>
<li>
<p>Ivy has been upgraded from 2.2.0 to <a href="http://ant.apache.org/ivy/history/2.3.0/release-notes.html">2.3.0</a>.</p>
</li>
<li>
<p>The JUnit Platform libraries used by the <code>Test</code> task have been upgraded from 1.0.3 to 1.3.1.</p>
</li>
<li>
<p>The Maven Wagon libraries used to access Maven repositories have been upgraded from 2.4 to 3.0.0.</p>
</li>
<li>
<p>SLF4J has been upgraded from 1.7.16 to <a href="https://www.slf4j.org/news.html">1.7.25</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:dependency_constraints"><a class="anchor" href="#rel5.0:dependency_constraints"></a><a class="link" href="#rel5.0:dependency_constraints">[5.0] Improved support for dependency and version constraints</a></h5>
<div class="paragraph">
<p>Through the Gradle 4.x release stream, new <code>@Incubating</code> features were added to the dependency resolution engine.
These include sophisticated version constraints (<code>prefer</code>, <code>strictly</code>, <code>reject</code>), dependency constraints, and <code>platform</code> dependencies.</p>
</div>
<div class="paragraph">
<p>If you have been using the <code>IMPROVED_POM_SUPPORT</code> feature preview, playing with constraints or prefer, reject and other specific version indications, then make sure to take a good look at your dependency resolution results.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:bom_import"><a class="anchor" href="#rel5.0:bom_import"></a><a class="link" href="#rel5.0:bom_import">[5.0] BOM import</a></h5>
<div class="paragraph">
<p>Gradle now provides support for importing bill of materials (BOM) files, which are effectively POM files that use <code>&lt;dependencyManagement&gt;</code> sections to control the versions of direct and transitive dependencies. All you need to do is declare the POM as a <code>platform</code> dependency.</p>
</div>
<div class="paragraph">
<p>The following example picks the versions of the <code>gson</code> and <code>dom4j</code> dependencies from the declared Spring Boot BOM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dependencies {
    // import a BOM
    implementation platform('org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE')

    // define dependencies without versions
    implementation 'com.google.code.gson:gson'
    implementation 'dom4j:dom4j'
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:pom_compile_runtime_separation"><a class="anchor" href="#rel5.0:pom_compile_runtime_separation"></a><a class="link" href="#rel5.0:pom_compile_runtime_separation">[5.0] Separation of compile and runtime dependencies when consuming POMs</a></h5>
<div class="paragraph">
<p>Since Gradle 1.0, runtime-scoped dependencies have been included in the Java compilation classpath, which has some drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The compilation classpath is much larger than it needs to be, slowing down compilation.</p>
</li>
<li>
<p>The compilation classpath includes runtime-scoped files that do not impact compilation, resulting in unnecessary re-compilation when those files change.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this new behavior, the Java and Java Library plugins both honor the <a href="#sec:java_library_separation">separation of compile and runtime scopes</a>. This means that the compilation classpath only includes compile-scoped dependencies, while the runtime classpath adds the runtime-scoped dependencies as well. This is particularly useful if you develop and publish Java libraries with Gradle where the separation between <code>api</code> and <code>implementation</code> dependencies is reflected in the published scopes.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:changes_to_default_task"><a class="anchor" href="#rel5.0:changes_to_default_task"></a><a class="link" href="#rel5.0:changes_to_default_task">[5.0] Changes to property factory methods on <code>DefaultTask</code></a></h5>
<div class="sect5">
<h6 id="property_factory_methods_on_defaulttask_are_now_final"><a class="anchor" href="#property_factory_methods_on_defaulttask_are_now_final"></a><a class="link" href="#property_factory_methods_on_defaulttask_are_now_final">Property factory methods on <code>DefaultTask</code> are now final</a></h6>
<div class="paragraph">
<p>The property factory methods such as <code>newInputFile()</code> are intended to be called from the constructor of a type that extends <code>DefaultTask</code>. These methods are now final to avoid subclasses overriding these methods and using state that is not initialized.</p>
</div>
</div>
<div class="sect5">
<h6 id="inputs_and_outputs_are_not_automatically_registered"><a class="anchor" href="#inputs_and_outputs_are_not_automatically_registered"></a><a class="link" href="#inputs_and_outputs_are_not_automatically_registered">Inputs and outputs are not automatically registered</a></h6>
<div class="paragraph">
<p>The Property instances that are returned by these methods are no longer automatically registered as inputs or outputs of the task. The Property instances need to be declared as inputs or outputs in the usual ways, such as attaching annotations such as <code>@OutputFile</code> or using the runtime API to register the property.</p>
</div>
<div class="paragraph">
<p>For example, you could previously use the following syntax and have both outputFile instances registered as declared outputs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// note: no annotation here</span>
    <span class="directive">final</span> RegularFileProperty outputFile = newOutputFile()
}

task myOtherTask {
    <span class="keyword">def</span> outputFile = newOutputFile()
    doLast { ... }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class MyTask : DefaultTask() {
    // note: no annotation here
    val outputFile: RegularFileProperty = newOutputFile()
}

task(&quot;myOtherTask&quot;) {
    val outputFile = newOutputFile()
    doLast { ... }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now you have to explicitly register <code>outputFile</code>, like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span> <span class="comment">// property needs an annotation</span>
    <span class="directive">final</span> RegularFileProperty outputFile = project.objects.fileProperty()
}

task myOtherTask {
    <span class="keyword">def</span> outputFile = project.objects.fileProperty()
    outputs.file(outputFile) <span class="comment">// or to be registered using the runtime API</span>
    doLast { ... }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class MyTask : DefaultTask() {
    @OutputFile // property needs an annotation
    val outputFile: RegularFileProperty = project.objects.fileProperty()
}

task(&quot;myOtherTask&quot;) {
    val outputFile = project.objects.fileProperty()
    outputs.file(outputFile) // or to be registered using the runtime API
    doLast { ... }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:jaxb_and_java9"><a class="anchor" href="#rel5.0:jaxb_and_java9"></a><a class="link" href="#rel5.0:jaxb_and_java9">[5.0] Gradle now bundles JAXB for Java 9 and above</a></h5>
<div class="paragraph">
<p>In order to use S3 backed artifact repositories, you previously had to add <code>--add-modules java.xml.bind</code> to <code>org.gradle.jvmargs</code> when running on Java 9 and above.</p>
</div>
<div class="paragraph">
<p>Since Java 11 no longer contains the <code>java.xml.bind</code> module, Gradle now bundles JAXB 2.3.1 (<code>com.sun.xml.bind:jaxb-impl</code>) and uses it on Java 9 and above.</p>
</div>
<div class="paragraph">
<p>Please remove the <code>--add-modules java.xml.bind</code> option from <code>org.gradle.jvmargs</code>, if set.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:gradle_plugin_portal_metadata"><a class="anchor" href="#rel5.0:gradle_plugin_portal_metadata"></a><a class="link" href="#rel5.0:gradle_plugin_portal_metadata">[5.0] The <code>gradlePluginPortal()</code> repository no longer looks for JARs without a POM by default</a></h5>
<div class="paragraph">
<p>With this new behavior, if a plugin or a transitive dependency of a plugin found in the <code>gradlePluginPortal()</code> repository has no Maven POM it will fail to resolve.</p>
</div>
<div class="paragraph">
<p>Artifacts published to a Maven repository without a POM should be fixed. If you encounter such artifacts, please ask the plugin or library author to publish a new version with proper metadata.</p>
</div>
<div class="paragraph">
<p>If you are stuck with a bad plugin, you can work around by re-enabling JARs as metadata source for the <code>gradlePluginPortal()</code> repository:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        gradlePluginPortal().tap {
            metadataSources {
                mavenPom()
                artifact()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        gradlePluginPortal().apply {
            (this as MavenArtifactRepository).metadataSources {
                mavenPom()
                artifact()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:java_library_distribution_plugin"><a class="anchor" href="#rel5.0:java_library_distribution_plugin"></a><a class="link" href="#rel5.0:java_library_distribution_plugin">Java Library Distribution Plugin utilizes Java Library Plugin</a></h5>
<div class="paragraph">
<p>The <a href="#">Java Library Distribution Plugin</a> is now based on the
<a href="#">Java Library Plugin</a> instead of the <a href="#">Java Plugin</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, the default distribution created by the plugin will contain all artifacts of the <code>runtimeClasspath</code> configuration instead of the deprecated <code>runtime</code> configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:configuration_avoidance"><a class="anchor" href="#rel5.0:configuration_avoidance"></a><a class="link" href="#rel5.0:configuration_avoidance">Configuration Avoidance API disallows common configuration errors</a></h5>
<div class="paragraph">
<p>The <a href="task_configuration_avoidance.html">configuration avoidance API</a> introduced in Gradle 4.9 allows you to avoid creating and configuring tasks that are never used.</p>
</div>
<div class="paragraph">
<p>With the existing API, this example adds two tasks (<code>foo</code> and <code>bar</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) {
    tasks.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.create(&quot;foo&quot;) {
    tasks.create(&quot;bar&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When converting this to use the new API, something surprising happens: <code>bar</code> doesn&#8217;t exist.  The new API only executes configuration actions when necessary,
so the <code>register()</code> for task <code>bar</code> only executes when <code>foo</code> is configured.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) {
    tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) <span class="comment">// WRONG</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;foo&quot;) {
    tasks.register(&quot;bar&quot;) // WRONG
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To avoid this, Gradle now detects this and prevents modification to the underlying container (through <code>create()</code> or <code>register()</code>) when using the new API.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel5.0:worker_api"><a class="anchor" href="#rel5.0:worker_api"></a><a class="link" href="#rel5.0:worker_api">[5.0] Worker API: working directory of a worker can no longer be set</a></h5>
<div class="paragraph">
<p>Since JDK 11 no longer supports changing the working directory of a running process, setting the working directory of a worker via its fork options is now prohibited.</p>
</div>
<div class="paragraph">
<p>All workers now use the same working directory to enable reuse.</p>
</div>
<div class="paragraph">
<p>Please pass files and directories as arguments instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.10:aws_s3_permissions"><a class="anchor" href="#rel4.10:aws_s3_permissions"></a><a class="link" href="#rel4.10:aws_s3_permissions">[4.10] Publishing to AWS S3 requires new permissions</a></h5>
<div class="paragraph">
<p>The S3 repository transport protocol allows Gradle to publish artifacts to AWS S3 buckets. Starting with this release, every artifact uploaded to an S3 bucket will be equipped with the <code>bucket-owner-full-control</code> canned ACL. Make sure that the AWS account used to publish artifacts has the <code>s3:PutObjectAcl</code> and <code>s3:PutObjectVersionAcl</code> permissions, otherwise the upload will fail.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2012-10-17</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Statement</span><span class="delimiter">&quot;</span></span>:[
        <span class="error">/</span><span class="error">/</span> <span class="error">.</span><span class="error">.</span><span class="error">.</span>
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>:[
                <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:PutObject</span><span class="delimiter">&quot;</span></span>, <span class="error">/</span><span class="error">/</span> <span class="error">n</span><span class="error">e</span><span class="error">c</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">a</span><span class="error">r</span><span class="error">y</span> <span class="error">f</span><span class="error">o</span><span class="error">r</span> <span class="error">u</span><span class="error">p</span><span class="error">l</span><span class="error">o</span><span class="error">a</span><span class="error">d</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">o</span><span class="error">b</span><span class="error">j</span><span class="error">e</span><span class="error">c</span><span class="error">t</span><span class="error">s</span>
                <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:PutObjectAcl</span><span class="delimiter">&quot;</span></span>, <span class="error">/</span><span class="error">/</span> <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">i</span><span class="error">r</span><span class="error">e</span><span class="error">d</span> <span class="error">s</span><span class="error">t</span><span class="error">a</span><span class="error">r</span><span class="error">t</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">w</span><span class="error">i</span><span class="error">t</span><span class="error">h</span> <span class="error">t</span><span class="error">h</span><span class="error">i</span><span class="error">s</span> <span class="error">r</span><span class="error">e</span><span class="error">l</span><span class="error">e</span><span class="error">a</span><span class="error">s</span><span class="error">e</span>
                <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:PutObjectVersionAcl</span><span class="delimiter">&quot;</span></span> <span class="error">/</span><span class="error">/</span> <span class="error">i</span><span class="error">f</span> <span class="error">S</span><span class="integer">3</span> <span class="error">b</span><span class="error">u</span><span class="error">c</span><span class="error">k</span><span class="error">e</span><span class="error">t</span> <span class="error">v</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">i</span><span class="error">s</span> <span class="error">e</span><span class="error">n</span><span class="error">a</span><span class="error">b</span><span class="error">l</span><span class="error">e</span><span class="error">d</span>
            ],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::myCompanyBucket/*</span><span class="delimiter">&quot;</span></span>
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sub:s3_cross_account">AWS S3 Cross Account Access</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.9:lazy_task_creation"><a class="anchor" href="#rel4.9:lazy_task_creation"></a><a class="link" href="#rel4.9:lazy_task_creation">[4.9] Consider trying the lazy API for task creation and configuration</a></h5>
<div class="paragraph">
<p>Gradle 4.9 introduced a new way to create and configure tasks that works lazily. When you use this approach for tasks that are expensive to configure, or when you have many, many tasks, your build configuration time can drop significantly when those tasks don&#8217;t run.</p>
</div>
<div class="paragraph">
<p>You can learn more about lazily creating tasks in the <a href="task_configuration_avoidance.html#task_configuration_avoidance">Task Configuration Avoidance</a> chapter. You can also read about the background to this new feature in <a href="https://blog.gradle.org/preview-avoiding-task-configuration-time">this blog post</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.8:switch_to_publishing_plugins"><a class="anchor" href="#rel4.8:switch_to_publishing_plugins"></a><a class="link" href="#rel4.8:switch_to_publishing_plugins">[4.8] Switch to the Maven Publish and Ivy Publish Plugins</a></h5>
<div class="paragraph">
<p>Now that the publishing plugins are stable, we recommend that you migrate from the <a href="artifact_management.html#artifact_management">legacy publishing</a> mechanism for standard Java projects, i.e. those based on the <a href="#java_plugin">Java Plugin</a>. That includes projects that use any one of: <a href="#java_library_plugin">Java Library Plugin</a>, <a href="#application_plugin">Application Plugin</a> or <a href="#war_plugin">War Plugin</a>.</p>
</div>
<div class="paragraph">
<p>To use the new approach, simply replace any <code>upload&lt;Conf&gt;</code> configuration with a <code>publishing {}</code> block. See the <a href="#publishing_overview">publishing overview chapter</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.8:deferred_configuration"><a class="anchor" href="#rel4.8:deferred_configuration"></a><a class="link" href="#rel4.8:deferred_configuration">[4.8] Use deferred configuration for publishing plugins</a></h5>
<div class="paragraph">
<p>Prior to Gradle 4.8, the <code>publishing {}</code> block was implicitly treated as if all the logic inside it was executed after the project was evaluated.
This was confusing, because it was the only block that behaved that way.
As part of the stabilization effort in Gradle 4.8, we are deprecating this behavior and asking all users to migrate their build.</p>
</div>
<div class="paragraph">
<p>The new, stable behavior can be switched on by adding the following to your settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">enableFeaturePreview(<span class="string"><span class="delimiter">'</span><span class="content">STABLE_PUBLISHING</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">enableFeaturePreview(&quot;STABLE_PUBLISHING&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We recommend doing a test run with a local repository to see whether all artifacts still have the expected coordinates. In most cases everything should work as before and you are done. However, your publishing block may rely on the implicit deferred configuration, particularly if it relies on values that may change during the configuration phase of the build.</p>
</div>
<div class="paragraph">
<p>For example, under the new behavior, the following logic assumes that <code>jar.archiveBaseName</code> doesn&#8217;t change after <code>artifactId</code> is set:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava {
                from components.java
                artifactId = jar.archiveBaseName
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            named&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                artifactId = tasks.jar.get().archiveBaseName.get()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If that assumption is incorrect or might possibly be incorrect in the future, the <code>artifactId</code> must be set within an <code>afterEvaluate {}</code> block, like so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava {
                from components.java
                afterEvaluate {
                    artifactId = jar.archiveBaseName
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            named&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                afterEvaluate {
                    artifactId = tasks.jar.get().archiveBbaseName.get()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rel4.8:configure_internal_tasks"><a class="anchor" href="#rel4.8:configure_internal_tasks"></a><a class="link" href="#rel4.8:configure_internal_tasks">[4.8] Configure existing <code>wrapper</code> and <code>init</code> tasks</a></h5>
<div class="paragraph">
<p>You should no longer define your own <code>wrapper</code> and <code>init</code> tasks. Configure the existing tasks instead, for example by converting this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task wrapper(<span class="key">type</span>: Wrapper) {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">task&lt;Wrapper&gt;(&quot;wrapper&quot;) {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>to this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">wrapper {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.wrapper {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rel4.8:pom_wildcard_exclusions"><a class="anchor" href="#rel4.8:pom_wildcard_exclusions"></a><a class="link" href="#rel4.8:pom_wildcard_exclusions">[4.8] Gradle now honors implicit wildcards in Maven POM exclusions</a></h5>
<div class="paragraph">
<p>If an exclusion in a Maven POM was missing either a <code>groupId</code> or <code>artifactId</code>, Gradle used to ignore the exclusion. Now the missing elements are treated as implicit wildcards e.g. <code>&lt;groupId&gt;*&lt;/groupId&gt;</code>  which means that some of your dependencies may now be excluded where they weren&#8217;t before.</p>
</div>
<div class="paragraph">
<p>You will need to explicitly declare any missing dependencies that you need.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.7:plain_console_output"><a class="anchor" href="#rel4.7:plain_console_output"></a><a class="link" href="#rel4.7:plain_console_output">[4.7] Changes to the structure of Gradle&#8217;s plain console output</a></h5>
<div class="paragraph">
<p>The plain console mode now formats output consistently with the rich console, which means that the output format has changed. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The output produced by a given task is now grouped together, even when other tasks execute in parallel with it.</p>
</li>
<li>
<p>Task execution headers are printed with a "&gt; Task" prefix.</p>
</li>
<li>
<p>All output produced during build execution is written to the standard output file handle. This includes messages written to System.err unless you are redirecting standard error to a file or any other non-console destination.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This may break tools that scrape details from the plain console output.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel:4.6:native_task_api_changes"><a class="anchor" href="#rel:4.6:native_task_api_changes"></a><a class="link" href="#rel:4.6:native_task_api_changes">[4.6] Changes to the APIs of native tasks related to compilation, linking and installation</a></h5>
<div class="paragraph">
<p>Many tasks related to compiling, linking and installing native libraries and applications have been converted to the Provider API so that they support <a href="#lazy_configuration">lazy configuration</a>. This conversion has introduced some breaking changes to the APIs of the tasks so that they match the conventions of the Provider API.</p>
</div>
<div class="paragraph">
<p>The following tasks have been changed:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.AbstractLinkTask.html">AbstractLinkTask</a> and its subclasses</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>getDestinationDir()</code> was replaced by <code>getDestinationDirectory()</code>.</p>
</li>
<li>
<p><code>getBinaryFile()</code>, <code>getOutputFile()</code> was replaced by <code>getLinkedFile()</code>.</p>
</li>
<li>
<p><code>setOutputFile(File)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>setOutputFile(Provider)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getTargetPlatform()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setTargetPlatform(NativePlatform)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getToolChain()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setToolChain(NativeToolChain)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.CreateStaticLibrary.html">CreateStaticLibrary</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>getOutputFile()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setOutputFile(File)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>setOutputFile(Provider)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getTargetPlatform()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setTargetPlatform(NativePlatform)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getToolChain()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setToolChain(NativeToolChain)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getStaticLibArgs()</code> was changed to return a <code>ListProperty</code>.</p>
</li>
<li>
<p><code>setStaticLibArgs(List)</code> was removed. Use <code>ListProperty.set()</code> instead.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.InstallExecutable.html">InstallExecutable</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>getSourceFile()</code> was replaced by <code>getExecutableFile()</code>.</p>
</li>
<li>
<p><code>getPlatform()</code> was replaced by <code>getTargetPlatform()</code>.</p>
</li>
<li>
<p><code>setTargetPlatform(NativePlatform)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
<li>
<p><code>getToolChain()</code> was changed to return a <code>Property</code>.</p>
</li>
<li>
<p><code>setToolChain(NativeToolChain)</code> was removed. Use <code>Property.set()</code> instead.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following have also seen similar changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.assembler.tasks.Assemble.html">Assemble</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.rc.tasks.WindowsResourceCompile.html">WindowsResourceCompile</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/tasks/StripSymbols.html">StripSymbols</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/tasks/ExtractSymbols.html">ExtractSymbols</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/swift/tasks/SwiftCompile.html">SwiftCompile</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/tasks/LinkMachOBundle.html">LinkMachOBundle</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="rel4.6:visual_studio_single_solution"><a class="anchor" href="#rel4.6:visual_studio_single_solution"></a><a class="link" href="#rel4.6:visual_studio_single_solution">[4.6] Visual Studio integration only supports a single solution file for all components of a build</a></h5>
<div class="paragraph">
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.ide.visualstudio.VisualStudioExtension.html">VisualStudioExtension</a> no longer has a <code>solutions</code> property. Instead, you configure a single solution via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.ide.visualstudio.VisualStudioRootExtension.html">VisualStudioRootExtension</a> in the root project, like so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    visualStudio {
        solution {
            solutionFile.location = <span class="string"><span class="delimiter">&quot;</span><span class="content">vs/</span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content">.sln</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition, there are no longer individual tasks to generate the solution files for each component, but rather a single <code>visualStudio</code> task that generates a solution file that encompasses all components in the build.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.5:http_build_cache_no_follow_redirects"><a class="anchor" href="#rel4.5:http_build_cache_no_follow_redirects"></a><a class="link" href="#rel4.5:http_build_cache_no_follow_redirects">[4.5] <code>HttpBuildCache</code> no longer follows redirects</a></h5>
<div class="paragraph">
<p>When connecting to an HTTP build cache backend via <code>HttpBuildCache</code>, Gradle does not follow redirects any more, treating them as errors instead. Getting a redirect from the build cache backend is mostly a configuration error  using an "http" URL instead of "https" for example  and has negative effects on performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="rel4.4:security_library_upgrades"><a class="anchor" href="#rel4.4:security_library_upgrades"></a><a class="link" href="#rel4.4:security_library_upgrades">[4.4] Third-party dependency upgrades</a></h5>
<div class="paragraph">
<p>This version includes several upgrades of third-party dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jackson: 2.6.6 &#8594; 2.8.9</p>
</li>
<li>
<p>plexus-utils: 2.0.6 &#8594; 2.1</p>
</li>
<li>
<p>xercesImpl: 2.9.1 &#8594; 2.11.0</p>
</li>
<li>
<p>bsh: 2.0b4 &#8594; 2.0b6</p>
</li>
<li>
<p>bouncycastle: 1.57 &#8594; 1.58</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This fix the following security issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7525">CVE-2017-7525</a> (critical)</p>
</li>
<li>
<p>SONATYPE-2017-0359 (critical)</p>
</li>
<li>
<p>SONATYPE-2017-0355 (critical)</p>
</li>
<li>
<p>SONATYPE-2017-0398 (critical)</p>
</li>
<li>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4002">CVE-2013-4002</a> (critical)</p>
</li>
<li>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-2510">CVE-2016-2510</a> (severe)</p>
</li>
<li>
<p>SONATYPE-2016-0397 (severe)</p>
</li>
<li>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2625">CVE-2009-2625</a> (severe)</p>
</li>
<li>
<p>SONATYPE-2017-0348 (severe)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle does not expose public APIs for these 3rd-party dependencies, but those who customize Gradle will want to be aware.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating_from_maven"><a class="anchor" href="#migrating_from_maven"></a><a class="link" href="#migrating_from_maven">Migrating Builds From Apache Maven</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Suffering from slow Maven builds? <a href="https://gradle.com/training/build-cache-deep-dive/?bid=docs-migrating-maven">Register here</a> for our Build Cache training session to learn how Gradle Enterprise can speed up Maven builds by up to 90%.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://maven.apache.org">Apache Maven</a> is a build tool for Java and other JVM-based projects that&#8217;s in widespread use, and so people that want to use Gradle often have to migrate an existing Maven build.
This guide will help with such a migration by explaining the differences and similarities between the two tools' models and providing steps that you can follow to ease the process.</p>
</div>
<div class="paragraph">
<p>Converting a build can be scary, but you don&#8217;t have to do it alone.
You can search docs, forums, and StackOverflow from <a href="https://gradle.org/help">help.gradle.org</a> or reach out to the <a href="https://discuss.gradle.org/c/help-discuss">Gradle community on the forums</a> if you get stuck.</p>
</div>
<div class="sect3">
<h4 id="migmvn:making_a_case"><a class="anchor" href="#migmvn:making_a_case"></a><a class="link" href="#migmvn:making_a_case">Making a case for migration</a></h4>
<div class="paragraph">
<p>The primary differences between Gradle and Maven are flexibility, performance, user experience, and dependency management.
A visual overview of these aspects is available in the <a href="https://gradle.org/maven-vs-gradle">Maven vs Gradle feature comparison</a>.</p>
</div>
<div class="paragraph">
<p>Since Gradle 3.0, Gradle has invested heavily in making Gradle builds much faster, with features such as <a href="https://blog.gradle.org/introducing-gradle-build-cache">build caching</a>, <a href="https://blog.gradle.org/incremental-compiler-avoidance">compile avoidance</a>, and an improved incremental Java compiler.
Gradle is now 2-10x faster than Maven for the vast majority of projects, even without using a build cache.
In-depth performance comparison and business cases for switching from Maven to Gradle can be found <a href="https://gradle.org/gradle-vs-maven-performance/">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:general_guidelines"><a class="anchor" href="#migmvn:general_guidelines"></a><a class="link" href="#migmvn:general_guidelines">General guidelines</a></h4>
<div class="paragraph">
<p>Gradle and Maven have fundamentally different views on how to build a project.
Gradle provides a flexible and extensible build model that delegates the actual work to a <a href="#the_core_model_is_based_on_tasks"><em>graph of task dependencies</em></a>.
Maven uses a model of fixed, linear phases to which you can attach goals (the things that do the work).
This may make migrating between the two seem intimidating, but migrations can be surprisingly easy because Gradle follows many of the same conventions as Maven&#8201;&#8212;&#8201;such as the <a href="#sec:java_project_layout">standard project structure</a>&#8201;&#8212;&#8201;and its dependency management works in a similar way.</p>
</div>
<div class="paragraph">
<p>Here we lay out a series of steps for you to follow that will help facilitate the migration of any Maven build to Gradle:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Keep the old Maven build and new Gradle build side by side.
You know the Maven build works, so you should keep it until you are confident that the Gradle build produces all the same artifacts and otherwise does what you need.
This also means that users can try the Gradle build without getting a new copy of the source tree.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://scans.gradle.com#maven">Create a build scan for the Maven build</a>.</p>
<div class="paragraph">
<p>A build scan will make it easier to visualize what&#8217;s happening in your existing Maven build.
For Maven builds, you&#8217;ll be able to see the project structure, what plugins are being used, a timeline of the build steps, and more.
Keep this handy so you can compare it to the Gradle build scans you get while converting the project.</p>
</div>
</li>
<li>
<p>Develop a mechanism to verify that the two builds produce the same artifacts</p>
<div class="paragraph">
<p>This is a vitally important step to ensure that your deployments and tests don&#8217;t break.
Even small changes, such as the contents of a manifest file in a JAR, can cause problems.
If your Gradle build produces the same output as the Maven build, this will give you and others confidence in switching over and make it easier to implement the big changes that will provide the greatest benefits.</p>
</div>
<div class="paragraph">
<p>This doesn&#8217;t mean that you need to verify every artifact at every stage, although doing so can help you quickly identify the source of a problem.
You can just focus on the critical output such as final reports and the artifacts that are published or deployed.</p>
</div>
<div class="paragraph">
<p>You will need to factor in some inherent differences in the build output that Gradle produces compared to Maven.
Generated POMs will contain only the information needed for consumption and they will use <code>&lt;compile&gt;</code> and <code>&lt;runtime&gt;</code> scopes correctly for that scenario.
You might also see differences in the order of files in archives and of files on classpaths.
Most differences will be benign, but it&#8217;s worth identifying them and verifying that they are OK.</p>
</div>
</li>
<li>
<p><a href="#migmvn:automatic_conversion">Run an automatic conversion</a></p>
<div class="paragraph">
<p>This will create all the Gradle build files you need, even for <a href="#migmvn:multimodule_builds">multi-module builds</a>.
For simpler Maven projects, the Gradle build will be ready to run!</p>
</div>
</li>
<li>
<p><a href="https://guides.gradle.org/creating-build-scans">Create a build scan for the Gradle build</a>.</p>
<div class="paragraph">
<p>A build scan will make it easier to visualize what&#8217;s happening in the build.
For Gradle builds, you&#8217;ll be able to see the project structure, the dependencies (regular and inter-project ones), what plugins are being used and the console output of the build.</p>
</div>
<div class="paragraph">
<p>Your build may fail at this point, but that&#8217;s ok; the scan will still run. Compare the build scan for the Gradle build to the one for the Maven build and continue down this list to troubleshoot the failures.</p>
</div>
<div class="paragraph">
<p>We recommend that you regularly generate build scans during the migration to help you identify and troubleshoot problems.
If you want, you can also use a Gradle build scan to identify opportunities to <a href="https://guides.gradle.org/performance/">improve the performance of the build</a>, after all performance is a big reason for switching to Gradle in the first place.</p>
</div>
</li>
<li>
<p><a href="#migmvn:migrating_deps">Verify your dependencies and fix any problems</a></p>
</li>
<li>
<p><a href="#migmvn:integration_tests">Configure integration and functional tests</a></p>
<div class="paragraph">
<p>Many tests can simply be migrated by configuring an extra source set.
If you are using a third-party library, such as <a href="http://docs.fitnesse.org/FrontPage">FitNesse</a>, look to see whether  there is a suitable community plugin available on the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a>.</p>
</div>
</li>
<li>
<p>Replace Maven plugins with Gradle equivalents</p>
<div class="paragraph">
<p>In the case of <a href="#migmvn:common_plugins">popular plugins</a>, Gradle often has an equivalent plugin that you can use.
You might also find that you can <a href="#migmvn:unnecessary_plugins">replace a plugin with built-in Gradle functionality</a>.
As a last resort, you may need to reimplement a Maven plugin <a href="#migmvn:custom_plugins">via your own custom plugins and task types</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The rest of this chapter looks in more detail at specific aspects of migrating a build from Maven to Gradle.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:build_lifecycle"><a class="anchor" href="#migmvn:build_lifecycle"></a><a class="link" href="#migmvn:build_lifecycle">Understanding the build lifecycle</a></h4>
<div class="paragraph">
<p>Maven builds are based around the concept of <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html"><em>build lifecycles</em></a> that consist of a set of fixed phases.
This can prove an impediment for users migrating to Gradle because its build lifecycle is <a href="#build_lifecycle">something different</a>, although it&#8217;s important to understand how Gradle builds fit into the structure of initialization, configuration, and execution phases.
Fortunately, Gradle has a feature that can mimic Maven&#8217;s phases: <a href="#sec:lifecycle_tasks"><em>lifecycle tasks</em></a>.</p>
</div>
<div class="paragraph">
<p>These allow you to define your own "lifecycles" by creating no-action tasks that simply depend on the tasks you&#8217;re interested in.
And to make the transition to Gradle easier for Maven users, the <a href="#sec:base_tasks">Base Plugin</a>&#8201;&#8212;&#8201;applied by all the JVM language plugins like the <a href="#java_library_plugin">Java Library Plugin</a>&#8201;&#8212;&#8201;provides a set of lifecycle tasks that correspond to the main Maven phases.</p>
</div>
<div class="paragraph">
<p>Here is a list of some of the main Maven phases and the Gradle tasks that they map to:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>clean</code></dt>
<dd>
<p>Use the <code>clean</code> task provided by the Base Plugin.</p>
</dd>
<dt class="hdlist1"><code>compile</code></dt>
<dd>
<p>Use the <code>classes</code> task provided by the <a href="#sec:java_tasks">Java Plugin</a> and other JVM language plugins.
This compiles all classes for all source files of all languages and also performs <a href="#migmvn:filtering_resources">resource filtering</a> via the <code>processResources</code> task.</p>
</dd>
<dt class="hdlist1"><code>test</code></dt>
<dd>
<p>Use the <code>test</code> task provided by the Java Plugin.
It runs just the unit tests, or more specifically, the tests that make up the <a href="#source_sets"><code>test</code> source set</a>.</p>
</dd>
<dt class="hdlist1"><code>package</code></dt>
<dd>
<p>Use the <code>assemble</code> task provided by the Base Plugin.
This builds whatever is the appropriate package for the project, for example a JAR for Java libraries or a WAR for traditional Java webapps.</p>
</dd>
<dt class="hdlist1"><code>verify</code></dt>
<dd>
<p>Use the <code>check</code> task provided by the Base Plugin.
This runs all verification tasks that are attached to it, which typically includes the unit tests, any static analysis tasks&#8201;&#8212;&#8201;such as <a href="#checkstyle_plugin">Checkstyle</a>&#8201;&#8212;&#8201;and others.
If you want to include integration tests, you will have to <a href="#migmvn:integration_tests">configure these manually</a>, which is a simple process.</p>
</dd>
<dt class="hdlist1"><code>install</code></dt>
<dd>
<p>Use the <code>publishToMavenLocal</code> task provided by the <a href="#publishing_maven:tasks">Maven Publish Plugin</a>.</p>
<div class="paragraph">
<p>Note that Gradle builds don&#8217;t require you to "install" artifacts as you have access to more appropriate features like <a href="#sub:project_dependencies">inter-project dependencies</a> and <a href="#">composite builds</a>.
You should only use <code>publishToMavenLocal</code> for interoperating with Maven builds.</p>
</div>
<div class="paragraph">
<p>Gradle also allows you to resolve dependencies against the local Maven cache, as described in the <a href="#migmvn:declaring_repos">Declaring repositories</a> section.</p>
</div>
</dd>
<dt class="hdlist1"><code>deploy</code></dt>
<dd>
<p>Use the <code>publish</code> task provided by the <a href="#publishing_maven:tasks">Maven Publish Plugin</a>&#8201;&#8212;&#8201;making sure you switch from the older Maven Plugin (ID: <code>maven</code>) if your build is using that one.
This will publish your package to all configured publication repositories.
There are also other tasks that allow you to publish to a single repository even when multiple ones are defined.</p>
<div class="paragraph">
<p>Note that the Maven Publish Plugin does not publish <strong>source and Javadoc JARs</strong> <em>by default</em>, but this can easily be activated as explained in <a href="#sec:java_packaging">the guide for building java projects</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:automatic_conversion"><a class="anchor" href="#migmvn:automatic_conversion"></a><a class="link" href="#migmvn:automatic_conversion">Performing an automatic conversion</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s <a href="#build_init_plugin"><code>init</code> task</a> is typically used to create a new skeleton project, but you can also use it to convert an existing Maven build to Gradle automatically.
Once Gradle is <a href="#installation">installed on your system</a>, all you have to do is run the command</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>&gt; gradle init</pre>
</div>
</div>
<div class="paragraph">
<p>from the root project directory and let Gradle do its thing.
That basically consists of parsing the existing POMs and generating the corresponding Gradle build scripts.
Gradle will also create a settings script if you&#8217;re migrating a <a href="#multi_project_builds">multi-project build</a>.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find that the new Gradle build includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All the custom repositories that are specified in the POM</p>
</li>
<li>
<p>Your external and inter-project dependencies</p>
</li>
<li>
<p>The appropriate plugins to build the project (limited to one or more of the <a href="#">Maven Publish</a>, <a href="#">Java</a> and <a href="#">War</a> Plugins)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#sec:pom_maven_conversion">Build Init Plugin chapter</a> for a complete list of the automatic conversion features.</p>
</div>
<div class="paragraph">
<p>One thing to bear in mind is that assemblies are not automatically converted.
They aren&#8217;t necessarily problematic to convert, but you will need to do some manual work.
Options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <a href="#distribution_plugin">Distribution Plugin</a></p>
</li>
<li>
<p>Using the <a href="#java_library_distribution_plugin">Java Library Distribution Plugin</a></p>
</li>
<li>
<p>Using the <a href="#application_plugin">Application Plugin</a></p>
</li>
<li>
<p><a href="#sec:creating_archives_example">Creating custom archive tasks</a></p>
</li>
<li>
<p>Using a suitable community plugin from the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your Maven build does not have many plugins or much in the way of customisation, you can simply run</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>&gt; gradle build</pre>
</div>
</div>
<div class="paragraph">
<p>once the migration has completed.
This will run the tests and produce the required artifacts without any extra intervention on your part.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:migrating_deps"><a class="anchor" href="#migmvn:migrating_deps"></a><a class="link" href="#migmvn:migrating_deps">Migrating dependencies</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s dependency management system is more flexible than Maven&#8217;s, but it still supports the same concepts of repositories, declared dependencies, scopes (<a href="#sec:what-are-dependency-configurations">dependency configurations</a> in Gradle), and transitive dependencies.
In fact, Gradle works perfectly with Maven-compatible repositories, which makes it easy to migrate your dependencies.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
One notable difference between the two tools is in how they manage version conflicts. Maven uses a "closest" match algorithm, whereas Gradle picks the newest.
Don&#8217;t worry though, you have a lot of control over which versions are selected, as documented in <a href="#">Managing Transitive Dependencies</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Over the following sections, we will show you how to migrate the most common elements of a Maven build&#8217;s dependency management information.</p>
</div>
<div class="sect4">
<h5 id="migmvn:declaring_deps"><a class="anchor" href="#migmvn:declaring_deps"></a><a class="link" href="#migmvn:declaring_deps">Declaring dependencies</a></h5>
<div class="paragraph">
<p>Gradle uses the same dependency identifier components as Maven: group ID, artifact ID and version.
It also supports classifiers.
So all you need to do is substitute the identifier information for a dependency into Gradle&#8217;s syntax, which is described in the <a href="#">Declaring Dependencies</a> chapter.</p>
</div>
<div class="paragraph">
<p>For example, consider this Maven-style dependency on Log4J:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>log4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>log4j<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.2.12<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This dependency would look like the following in a Gradle build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Declaring a simple compile-time dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">log4j:log4j:1.2.12</span><span class="delimiter">'</span></span>  // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;log4j:log4j:1.2.12&quot;)  // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Attaches version 1.2.12 of Log4J to the <code>implementation</code> configuration (scope)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The string identifier takes the Maven values of <code>groupId</code>, <code>artifactId</code> and <code>version</code>, although Gradle refers to them as <code>group</code>, <code>module</code> and <code>version</code>.</p>
</div>
<div class="paragraph">
<p>The above example raises an obvious question: what is that <code>implementation</code> configuration?
It&#8217;s one of the standard dependency configurations provided by the <a href="#tab:configurations">Java Plugin</a> and is often used as a substitute for Maven&#8217;s default <code>compile</code> scope.</p>
</div>
<div class="paragraph">
<p>Several of the differences between Maven&#8217;s scopes and Gradle&#8217;s standard configurations come down to Gradle distinguishing between the dependencies required to build a module and the dependencies required to build a module that depends on it.
Maven makes no such distinction, so published POMs typically include dependencies that consumers of a library don&#8217;t actually need.</p>
</div>
<div class="paragraph">
<p>Here are the main Maven dependency scopes and how you should deal with their migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compile</code></dt>
<dd>
<p>Gradle has two configurations that can be used in place of the <code>compile</code> scope: <code>implementation</code> and <code>api</code>.
The former is available to any project that applies the Java Plugin, while <code>api</code> is only available to projects that specifically apply the <a href="#java_library_plugin">Java Library Plugin</a>.</p>
<div class="paragraph">
<p>In most cases you should simply use the <code>implementation</code> configuration, particularly if you&#8217;re building an application or webapp.
But if you&#8217;re building a library, you can learn about which dependencies should be declared using <code>api</code> in the section on <a href="#sec:building_java_libraries">Building Java libraries</a>.
Even more information on the differences between <code>api</code> and <code>implementation</code> is provided in the Java Library Plugin chapter linked above.</p>
</div>
</dd>
<dt class="hdlist1"><code>runtime</code></dt>
<dd>
<p>Use the <code>runtimeOnly</code> configuration.</p>
</dd>
<dt class="hdlist1"><code>test</code></dt>
<dd>
<p>Gradle distinguishes between those dependencies that are required to <em>compile</em> a project&#8217;s tests and those that are only needed to <em>run</em> them.</p>
<div class="paragraph">
<p>Dependencies required for test compilation should be declared against the <code>testImplementation</code> configuration.
Those that are only required for running the tests should use <code>testRuntimeOnly</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>provided</code></dt>
<dd>
<p>Use the <code>compileOnly</code> configuration.</p>
<div class="paragraph">
<p>Note that the <a href="#sec:war_dependency_management">War Plugin</a> adds <code>providedCompile</code> and <code>providedRuntime</code> dependency configurations.
These behave slightly differently from <code>compileOnly</code> and simply ensure that those dependencies aren&#8217;t packaged in the WAR file.
However, the dependencies are included on runtime and test runtime classpaths, so use these configurations if that&#8217;s the behavior you need.</p>
</div>
</dd>
<dt class="hdlist1"><code>import</code></dt>
<dd>
<p>The <code>import</code> scope is mostly used within <code>&lt;dependencyManagement&gt;</code> blocks and applies solely to POM-only publications.
Read the section on <a href="#migmvn:using_boms">Using bills of materials</a> to learn more about how to replicate this behavior.</p>
<div class="paragraph">
<p>You can also specify a regular dependency on a POM-only publication.
In this case, the dependencies declared in that POM are treated as normal transitive dependencies of the build.</p>
</div>
<div class="paragraph">
<p>For example, imagine you want to use the <code>groovy-all</code> POM for your tests.
It&#8217;s a POM-only publication that has its own dependencies listed inside a <code>&lt;dependencies&gt;</code> block.
The appropriate configuration in the Gradle build looks like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Consuming a POM-only dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.5.4</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.codehaus.groovy:groovy-all:2.5.4&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result of this will be that all <code>compile</code> and <code>runtime</code> scope dependencies in the <code>groovy-all</code> POM get added to the test runtime classpath, while only the <code>compile</code> scope dependencies get added to the test compilation classpath.
Dependencies with other scopes will be ignored.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="migmvn:declaring_repos"><a class="anchor" href="#migmvn:declaring_repos"></a><a class="link" href="#migmvn:declaring_repos">Declaring repositories</a></h5>
<div class="paragraph">
<p>Gradle allows you to retrieve declared dependencies from any Maven-compatible or Ivy-compatible repository.
Unlike Maven, it has no default repository and so you have to declare at least one.
In order to have the same behavior as your Maven build, just configure <a href="#sub:maven_central">Maven Central</a> in your Gradle build, like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Configuring the build to use Maven Central</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>repositories {}</code> block to configure custom repositories, as described in the <a href="#sec:maven_repo">Repository Types</a> chapter.</p>
</div>
<div class="paragraph">
<p>Lastly, Gradle allows you to resolve dependencies against the <a href="#sub:maven_local">local Maven cache/repository</a>.
This helps Gradle builds interoperate with Maven builds, but it shouldn&#8217;t be a technique that you use if you don&#8217;t need that interoperability.
If you want to share published artifacts via the filesystem, consider configuring a <a href="#sec:maven_repo">custom Maven repository</a> with a <code>file://</code> URL.</p>
</div>
<div class="paragraph">
<p>You might also be interested in learning about Gradle&#8217;s own <a href="#sec:dependency_cache">dependency cache</a>, which behaves more reliably than Maven&#8217;s and can be used safely by multiple concurrent Gradle processes.</p>
</div>
</div>
<div class="sect4">
<h5 id="migmvn:controlling_dep_versions"><a class="anchor" href="#migmvn:controlling_dep_versions"></a><a class="link" href="#migmvn:controlling_dep_versions">Controlling dependency versions</a></h5>
<div class="paragraph">
<p>The existence of transitive dependencies means that you can very easily end up with multiple versions of the same dependency in your dependency graph.
By default, Gradle will pick the newest version of a dependency in the graph, but that&#8217;s not always the right solution.
That&#8217;s why it provides several mechanisms for controlling which version of a given dependency is resolved.</p>
</div>
<div class="paragraph">
<p>On a per-project basis, you can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:adding-constraints-transitive-deps">Dependency constraints</a></p>
</li>
<li>
<p><a href="#migmvn:using_boms">Bills of materials</a> (Maven BOMs)</p>
</li>
<li>
<p><a href="#sec:enforcing_dependency_version">Overriding transitive versions</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are even more, specialized options listed in the <a href="#">controlling transitive dependencies</a> chapter.</p>
</div>
<div class="paragraph">
<p>If you want to ensure consistency of versions across all projects in a multi-project build, similar to how the <code>&lt;dependencyManagement&gt;</code> block in Maven works, you can use the <a href="#java_platform_plugin">Java Platform Plugin</a>.
This allows you declare a set of dependency constraints that can be applied to multiple projects.
You can even publish the platform as a Maven BOM or using Gradle&#8217;s metadata format.
See the plugin page for more information on how to do that, and in particular the section on <a href="#sec:java_platform_consumption">Consuming platforms</a> to see how you can apply a platform to other projects in the same build.</p>
</div>
</div>
<div class="sect4">
<h5 id="migmvn:excluding_deps"><a class="anchor" href="#migmvn:excluding_deps"></a><a class="link" href="#migmvn:excluding_deps">Excluding transitive dependencies</a></h5>
<div class="paragraph">
<p>Maven builds use exclusions to keep unwanted dependencies&#8201;&#8212;&#8201;or unwanted <em>versions</em> of dependencies&#8201;&#8212;&#8201;out of the dependency graph.
You can do the same thing with Gradle, but that&#8217;s not necessarily the <em>right</em> thing to do.
Gradle provides other options that may be more appropriate for a given situation, so you really need to understand <em>why</em> an exclusion is in place to migrate it properly.</p>
</div>
<div class="paragraph">
<p>If you want to exclude a dependency for reasons unrelated to versions, then check out the section on <a href="#sec:excluding-transitive-deps">Excluding transitive dependencies</a>.
It shows you how to attach an exclusion either to an entire configuration (often the most appropriate solution) or to a dependency.
You can even easily apply an exclusion to all configurations.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re more interested in controlling which version of a dependency is actually resolved, see the previous section.</p>
</div>
</div>
<div class="sect4">
<h5 id="migmvn:optional_deps"><a class="anchor" href="#migmvn:optional_deps"></a><a class="link" href="#migmvn:optional_deps">Handling optional dependencies</a></h5>
<div class="paragraph">
<p>You are likely to encounter two situations regarding optional dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some of your transitive dependencies are declared as optional</p>
</li>
<li>
<p>You want to declare some of your direct dependencies as optional in your project&#8217;s published POM</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the first scenario, Gradle behaves the same way as Maven and simply ignores any transitive dependencies that are declared as optional.
They are not resolved and have no impact on the versions selected if the same dependencies appear elsewhere in the dependency graph as non-optional.</p>
</div>
<div class="paragraph">
<p>As for publishing dependencies as optional, Gradle provides a richer model called <a href="#feature_variants">feature variants</a>, which will let you declare the "optional features" your library provides.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:using_boms"><a class="anchor" href="#migmvn:using_boms"></a><a class="link" href="#migmvn:using_boms">Using bills of materials (BOMs)</a></h4>
<div class="paragraph">
<p>Maven allows you to share dependency constraints by defining dependencies inside a <code>&lt;dependencyManagement&gt;</code> section of a POM file that has a packaging type of <code>pom</code>.
This special type of POM (a BOM) can then be imported into other POMs so that you have consistent library versions across your projects.</p>
</div>
<div class="paragraph">
<p>Gradle can use such BOMs for the same purpose, using a special dependency syntax based on <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:platform(java.lang.Object)">platform()</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:enforcedPlatform(java.lang.Object)">enforcedPlatform()</a> methods.
You simply declare the dependency in the normal way, but wrap the dependency identifier in the appropriate method, as shown in this example that "imports" the Spring Boot Dependencies BOM:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Importing a BOM in a Gradle build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation platform(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE</span><span class="delimiter">'</span></span>) // <b class="conum">(1)</b>

    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson</span><span class="delimiter">'</span></span> // <b class="conum">(2)</b>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">dom4j:dom4j</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(platform(&quot;org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE&quot;))  // <b class="conum">(1)</b>

    implementation(&quot;com.google.code.gson:gson&quot;)  // <b class="conum">(2)</b>
    implementation(&quot;dom4j:dom4j&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Applies the Spring Boot Dependencies BOM</p>
</li>
<li>
<p>Adds a dependency whose version is defined by that BOM</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can learn more about this feature and the difference between <code>platform()</code> and <code>enforcedPlatform()</code> in the section on <a href="#sub:bom_import">importing version recommendations from a Maven BOM</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can use this feature to apply the <code>&lt;dependencyManagement&gt;</code> information from any dependency&#8217;s POM to the Gradle build, even those that don&#8217;t have a packaging type of <code>pom</code>. Both <code>platform()</code> and <code>enforcedPlatform()</code> will ignore any dependencies declared in the <code>&lt;dependencies&gt;</code> block.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:multimodule_builds"><a class="anchor" href="#migmvn:multimodule_builds"></a><a class="link" href="#migmvn:multimodule_builds">Migrating multi-module builds (project aggregation)</a></h4>
<div class="paragraph">
<p>Maven&#8217;s multi-module builds map nicely to Gradle&#8217;s <a href="#">multi-project builds</a>.
Try the corresponding <a href="https://guides.gradle.org/creating-multi-project-builds/">tutorial</a> to see how a basic multi-project Gradle build is set up.</p>
</div>
<div class="paragraph">
<p>To migrate a multi-module Maven build, simply follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a settings script that matches the <code>&lt;modules&gt;</code> block of the root POM.</p>
<div class="paragraph">
<p>For example, this <code>&lt;modules&gt;</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;modules&gt;</span>
    <span class="tag">&lt;module&gt;</span>simple-weather<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>simple-webapp<span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/modules&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be migrated by adding the following line to the settings script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Declaring which projects are part of the build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">simple-multi-module</span><span class="delimiter">'</span></span>  // <b class="conum">(1)</b>

include <span class="string"><span class="delimiter">'</span><span class="content">simple-weather</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">simple-webapp</span><span class="delimiter">'</span></span>  // <b class="conum">(2)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;simple-multi-module&quot;  // <b class="conum">(1)</b>

include(&quot;simple-weather&quot;, &quot;simple-webapp&quot;)  // <b class="conum">(2)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Sets the name of the overall project</p>
</li>
<li>
<p>Configures two subprojects as part of this build</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle projects</code></strong></div>
<div class="content">
<pre>&gt; gradle projects

------------------------------------------------------------
Root project
------------------------------------------------------------

Root project 'simple-multi-module'
+--- Project ':simple-weather'
\--- Project ':simple-webapp'

To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks
For example, try running gradle :simple-weather:tasks</pre>
</div>
</div>
</li>
<li>
<p>Replace cross-module dependencies with <a href="#sub:project_dependencies">project dependencies</a>.</p>
</li>
<li>
<p>Replicate project inheritance with <a href="#sec:cross_project_configuration">cross-project configuration</a>.</p>
<div class="paragraph">
<p>This basically involves creating a root project build script that injects shared configuration into the appropriate subprojects.</p>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="migmvn:sub:sharing-versions"><a class="anchor" href="#migmvn:sub:sharing-versions"></a><a class="link" href="#migmvn:sub:sharing-versions">Sharing versions across projects</a></h5>
<div class="paragraph">
<p>If you want to replicate the Maven pattern of having dependency versions declared in the <code>dependencyManagement</code> section of the root POM file, the best approach is to leverage the <code>java-platform</code> plugin.
You will need to add a dedicated project for this and consume it in the regular projects of your build.
See <a href="#">the documentation</a> for more details on this pattern.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:profiles_and_properties"><a class="anchor" href="#migmvn:profiles_and_properties"></a><a class="link" href="#migmvn:profiles_and_properties">Migrating Maven profiles and properties</a></h4>
<div class="paragraph">
<p>Maven allows you parameterize builds using properties of various sorts.
Some are read-only properties of the project model, others are user-defined in the POM.
It even allows you to treat system properties as project properties.</p>
</div>
<div class="paragraph">
<p>Gradle has a similar system of project properties, although it differentiates between those and system properties.
You can, for example, define properties in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the build script</p>
</li>
<li>
<p>a <code>gradle.properties</code> file in the root project directory</p>
</li>
<li>
<p>a <code>gradle.properties</code> file in the <code>$HOME/.gradle</code> directory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those aren&#8217;t the only options, so if you are interested in finding out more about how and where you can define properties, check out the <a href="#build_environment">Build Environment</a> chapter.</p>
</div>
<div class="paragraph">
<p>One important piece of behavior you need to be aware of is what happens when the same property is defined in both the build script and one of the external properties files: the build script value takes precedence.
Always.
Fortunately, you can mimic the concept of profiles to provide overridable default values.</p>
</div>
<div class="paragraph">
<p>Which brings us on to Maven profiles.
These are a way to enable and disable different configurations based on environment, target platform, or any other similar factor.
Logically, they are nothing more than limited if' statements.
And since Gradle has much more powerful ways to declare conditions, it does not needto have formal support for profiles (except in the POMs of dependencies).
You can easily get the same behavior by combining conditions with secondary build scripts, as you&#8217;ll see.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you have different deployment settings depending on the environment: local development (the default), a test environment, and production.
To add profile-like behavior, you first create build scripts for each environment in the project root: <code>profile-default.gradle</code>, <code>profile-test.gradle</code>, and <code>profile-prod.gradle</code>.
You can then conditionally apply one of those profile scripts based on a <a href="#sec:project_properties">project property</a> of your own choice.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the basic technique using a project property called <code>buildProfile</code> and profile scripts that simply initialize an <a href="#sec:extra_properties">extra project property</a> called <code>message</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Mimicking the behavior of Maven profiles in Gradle</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (!hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">buildProfile</span><span class="delimiter">'</span></span>)) ext.buildProfile = <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>  // <b class="conum">(1)</b>

apply <span class="key">from</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">profile-</span><span class="inline"><span class="inline-delimiter">${</span>buildProfile<span class="inline-delimiter">}</span></span><span class="content">.gradle</span><span class="delimiter">&quot;</span></span>  // <b class="conum">(2)</b>

task greeting {
    doLast {
        println message  // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-default.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.message = <span class="string"><span class="delimiter">'</span><span class="content">foobar</span><span class="delimiter">'</span></span>  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-test.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.message = <span class="string"><span class="delimiter">'</span><span class="content">testing 1 2 3</span><span class="delimiter">'</span></span>  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-prod.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, world!</span><span class="delimiter">'</span></span>  // <b class="conum">(4)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val buildProfile: String? by project  // <b class="conum">(1)</b>

apply(from = &quot;profile-${buildProfile ?: &quot;default&quot;}.gradle.kts&quot;)  // <b class="conum">(2)</b>

tasks.register(&quot;greeting&quot;) {
    val message: String by project.extra
    doLast {
        println(message)  // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-default.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val message by extra(&quot;foobar&quot;)  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-test.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val message by extra(&quot;testing 1 2 3&quot;)  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">profile-prod.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val message by extra(&quot;Hello, world!&quot;)  // <b class="conum">(4)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Checks for the existence of (Groovy) or binds (Kotlin) the <code>buildProfile</code> project property</p>
</li>
<li>
<p>Applies the appropriate profile script, using the value of <code>buildProfile</code> in the script filename</p>
</li>
<li>
<p>Prints out the value of the <code>message</code> extra project property</p>
</li>
<li>
<p>Initializes the <code>message</code> extra project property, whose value can then be used in the main build script</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With this setup in place, you can activate one of the profiles by passing a value for the project property you&#8217;re using&#8201;&#8212;&#8201;<code>buildProfile</code> in this case:</p>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle greeting</code></strong></div>
<div class="content">
<pre>&gt; gradle greeting
foobar</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -PbuildProfile=test greeting</code></strong></div>
<div class="content">
<pre>&gt; gradle -PbuildProfile=test greeting
testing 1 2 3</pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re not limited to checking project properties.
You could also check environment variables, the JDK version, the OS the build is running on, or anything else you can imagine.</p>
</div>
<div class="paragraph">
<p>One thing to bear in mind is that high level condition statements make builds harder to understand and maintain, similar to the way they complicate object-oriented code.
The same applies to profiles.
Gradle offers you many better ways to avoid the extensive use of profiles that Maven often requires, for example by configuring multiple tasks that are variants of one another.
See the <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks created by the <a href="#publishing_maven:tasks">Maven Publish Plugin</a>.</p>
</div>
<div class="paragraph">
<p>For a lengthier discussion on working with Maven profiles in Gradle, look no further than <a href="https://blog.gradle.org/maven-pom-profiles">this blog post</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:filtering_resources"><a class="anchor" href="#migmvn:filtering_resources"></a><a class="link" href="#migmvn:filtering_resources">Filtering resources</a></h4>
<div class="paragraph">
<p>Maven has a phase called <code>process-resources</code> that has the goal <code>resources:resources</code> bound to it by default.
This gives the build author an opportunity to perform variable substitution on various files, such as web resources, packaged properties files, etc.</p>
</div>
<div class="paragraph">
<p>The Java plugin for Gradle provides a <code>processResources</code> task to do the same thing.
This is a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task that copies files from the configured resources directory&#8201;&#8212;&#8201;<code>src/main/resources</code> by default&#8201;&#8212;&#8201;to an output directory.
And as with any <code>Copy</code> task, you can configure it to perform <a href="#filtering_files">file filtering</a>, <a href="#sec:renaming_files">renaming</a>, and <a href="#sec:filtering_files">content filtering</a>.</p>
</div>
<div class="paragraph">
<p>As an example, here&#8217;s a configuration that treats the source files as <a href="https://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_simpletemplateengine">Groovy <code>SimpleTemplateEngine</code></a> templates, providing <code>version</code> and <code>buildNumber</code> properties to those templates:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Filtering the content of resources via the <code>processResources</code> task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">processResources {
    expand(<span class="key">version</span>: version, <span class="key">buildNumber</span>: currentBuildNumber)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    processResources {
        expand(&quot;version&quot; to version, &quot;buildNumber&quot; to currentBuildNumber)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the API docs for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> to see all the options available to you.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:integration_tests"><a class="anchor" href="#migmvn:integration_tests"></a><a class="link" href="#migmvn:integration_tests">Configuring integration tests</a></h4>
<div class="paragraph">
<p>Many Maven builds incorporate integration tests of some sort, which Maven supports through an extra set of phases: <code>pre-integration-test</code>, <code>integration-test</code>, <code>post-integration-test</code>, and <code>verify</code>.
It also uses the Failsafe plugin in place of Surefire so that failed integration tests don&#8217;t automatically fail the build (because you may need to clean up resources, such as a running application server).</p>
</div>
<div class="paragraph">
<p>This behavior is easy to replicate in Gradle with source sets, as explained in our chapter on <a href="#sec:configuring_java_integration_tests">Testing in Java &amp; JVM projects</a>.
You can then configure a clean-up task, such as one that shuts down a test server for example, to always run after the integration tests regardless of whether they succeed or fail using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:finalizedBy(java.lang.Object[])">Task.finalizedBy()</a>.</p>
</div>
<div class="paragraph">
<p>If you really don&#8217;t want your integration tests to fail the build, then you can use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:ignoreFailures">Test.ignoreFailures</a> setting described in the <a href="#sec:test_execution">Test execution</a> section of the Java testing chapter.</p>
</div>
<div class="paragraph">
<p>Source sets also give you a lot of flexibility on where you place the source files for your integration tests.
You can easily keep them in the same directory as the unit tests or, more preferably, in a separate source directory like <code>src/integTest/java</code>.
To support other types of tests, you just add more source sets and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> tasks!</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:common_plugins"><a class="anchor" href="#migmvn:common_plugins"></a><a class="link" href="#migmvn:common_plugins">Migrating common plugins</a></h4>
<div class="paragraph">
<p>Maven and Gradle share a common approach of extending the build through plugins.
Although the plugin systems are very different beneath the surface, they share many feature-based plugins, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shade/Shadow</p>
</li>
<li>
<p>Jetty</p>
</li>
<li>
<p>Checkstyle</p>
</li>
<li>
<p>JaCoCo</p>
</li>
<li>
<p>AntRun (see further down)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why does this matter? Because many plugins rely on standard Java conventions, so migration is just a matter of replicating the configuration of the Maven plugin in Gradle.
As an example, here&#8217;s a simple Maven Checkstyle plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>maven-checkstyle-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.17<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>validate<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;phase&gt;</span>validate<span class="tag">&lt;/phase&gt;</span>
      <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;configLocation&gt;</span>checkstyle.xml<span class="tag">&lt;/configLocation&gt;</span>
        <span class="tag">&lt;encoding&gt;</span>UTF-8<span class="tag">&lt;/encoding&gt;</span>
        <span class="tag">&lt;consoleOutput&gt;</span>true<span class="tag">&lt;/consoleOutput&gt;</span>
        <span class="tag">&lt;failsOnError&gt;</span>true<span class="tag">&lt;/failsOnError&gt;</span>
        <span class="tag">&lt;linkXRef&gt;</span>false<span class="tag">&lt;/linkXRef&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>check<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Everything outside of the configuration block can safely be ignored when migrating to Gradle.
In this case, the corresponding Gradle configuration looks like the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Configuring the Gradle Checkstyle Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">checkstyle {
    config = resources.text.fromFile(<span class="string"><span class="delimiter">'</span><span class="content">checkstyle.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>)
    showViolations = <span class="predefined-constant">true</span>
    ignoreFailures = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">checkstyle {
    config = resources.text.fromFile(&quot;checkstyle.xml&quot;, &quot;UTF-8&quot;)
    isShowViolations = true
    isIgnoreFailures = false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Checkstyle tasks are automatically added as dependencies of the <code>check</code> task, which also includes <code>test</code>.
If you want to ensure that Checkstyle runs before the tests, then just specify an ordering with the mustRunAfter() method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Controlling when the <code>checkstyle</code> task runs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test.mustRunAfter checkstyleMain, checkstyleTest</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    test {
        mustRunAfter(checkstyleMain, checkstyleTest)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the Gradle configuration is often much shorter than the Maven equivalent.
You also have a much more flexible execution model since you are no longer constrained by Maven&#8217;s fixed phases.</p>
</div>
<div class="paragraph">
<p>While migrating a project from Maven, don&#8217;t forget about source sets.
These often provide a more elegant solution for handling integration tests or generated sources than Maven can provide, so you should factor them into your migration plans.</p>
</div>
<div class="sect4">
<h5 id="ant_goals"><a class="anchor" href="#ant_goals"></a><a class="link" href="#ant_goals">Ant goals</a></h5>
<div class="paragraph">
<p>Many Maven builds rely on the AntRun plugin to customize the build without the overhead of implementing a custom Maven plugin.
Gradle has no equivalent plugin because Ant is a first-class citizen in Gradle builds, via the <code>ant</code> object.
For example, you can use Ant&#8217;s Echo task like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Invoking Ant tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task sayHello {
    doLast {
        ant.echo <span class="key">message</span>: <span class="string"><span class="delimiter">'</span><span class="content">Hello!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;sayHello&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;message&quot; to &quot;Hello!&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Even Ant properties and filesets are supported natively.
To learn more, see <a href="#ant">Using Ant from Gradle</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>It may be simpler and cleaner to just <a href="#custom_tasks">create custom task types</a> to replace the work that Ant is doing for you. You can then more readily benefit from <a href="#sec:up_to_date_checks">incremental build</a> and other useful Gradle features.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:unnecessary_plugins"><a class="anchor" href="#migmvn:unnecessary_plugins"></a><a class="link" href="#migmvn:unnecessary_plugins">Understanding which plugins you don&#8217;t need</a></h4>
<div class="paragraph">
<p>It&#8217;s worth remembering that Gradle builds are typically easier to extend and customize than Maven ones.
In this context, that means you may not need a Gradle plugin to replace a Maven one.
For example, the Maven Enforcer plugin allows you to control dependency versions and environmental factors, but these things can easily be configured in a normal Gradle build script.</p>
</div>
</div>
<div class="sect3">
<h4 id="migmvn:custom_plugins"><a class="anchor" href="#migmvn:custom_plugins"></a><a class="link" href="#migmvn:custom_plugins">Dealing with uncommon and custom plugins</a></h4>
<div class="paragraph">
<p>You may come across Maven plugins that have no counterpart in Gradle, particularly if you or someone in your organisation has written a custom plugin.
Such cases rely on you understanding how Gradle (and potentially Maven) works, because you will usually have to write your own plugin.</p>
</div>
<div class="paragraph">
<p>For the purposes of migration, there are two key types of Maven plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Those that use the Maven project object.</p>
</li>
<li>
<p>Those that don&#8217;t.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why is this important? Because if you use one of the latter, you can trivially reimplement it as a <a href="#custom_tasks">custom Gradle task type</a>.
Simply define task inputs and outputs that correspond to the mojo parameters and convert the execution logic into a task action.</p>
</div>
<div class="paragraph">
<p>If a plugin depends on the Maven project, then you will have to rewrite it.
Don&#8217;t start by considering how the Maven plugin works, but look at what problem it is trying to solve.
Then try to work out how to solve that problem in Gradle.
You&#8217;ll probably find that the two build models are different enough that "transcribing" Maven plugin code into a Gradle plugin just won&#8217;t be effective.
On the plus side, the plugin is likely to be much easier to write than the original Maven one because Gradle has a much richer build model and API.</p>
</div>
<div class="paragraph">
<p>If you do need to implement custom logic, either via build scripts or plugins, check out the <a href="https://gradle.org/guides/?q=Plugin%20Development">Guides related to plugin development</a>.
Also be sure to familiarize yourself with Gradle&#8217;s <a href="https://docs.gradle.org/6.4.1/dsl/">Groovy DSL Reference</a>, which provides comprehensive documentation on the API that you&#8217;ll be working with.
It details the standard configuration blocks (and the objects that back them), the core types in the system (<code>Project</code>, <code>Task</code>, etc.), and the standard set of task types.
The main entry point is the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> interface as that&#8217;s the top-level object that backs the build scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="further_reading"><a class="anchor" href="#further_reading"></a><a class="link" href="#further_reading">Further reading</a></h4>
<div class="paragraph">
<p>This chapter has covered the major topics that are specific to migrating Maven builds to Gradle. All that remain are a few other areas that may be useful during or after a migration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learn how to configure Gradle&#8217;s <a href="#build_environment">build environment</a>, including the JVM settings used to run it</p>
</li>
<li>
<p>Learn how to <a href="#organizing_gradle_projects">structure your builds effectively</a></p>
</li>
<li>
<p><a href="#logging">Configure Gradle&#8217;s logging</a> and use it from your builds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a final note, this guide has only touched on a few of Gradle&#8217;s features and we encourage you to learn about the rest from the other chapters of the user manual and from our tutorial-style <a href="https://guides.gradle.org/">Gradle Guides</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating_from_ant"><a class="anchor" href="#migrating_from_ant"></a><a class="link" href="#migrating_from_ant">Migrating Builds From Apache Ant</a></h3>
<div class="paragraph">
<p><a href="https://ant.apache.org/">Apache Ant</a> is a build tool with a long history in the Java world that is still widely used, albeit by a decreasing number of teams. While flexible, it lacks conventions and many of the powerful features that Gradle can provide. Migrating to Gradle is worthwhile so that your builds can become slimmer, simpler and faster, while still retaining the flexibility you enjoy with Ant. You&#8217;ll also benefit from robust support for multi-project builds and easy-to-use, flexible dependency management.</p>
</div>
<div class="paragraph">
<p>The biggest challenge in migrating from Ant to Gradle is that there is no such thing as a standard Ant build. That makes it difficult to provide specific instructions. Fortunately, Gradle has some great integration features with Ant that can make the process relatively smooth. And even migrating from <a href="https://ant.apache.org/ivy/">Ivy</a>-based dependency management isn&#8217;t particularly hard because Gradle has a similar model based on <a href="#sub:terminology_configuration">dependency configurations</a> that works with Ivy-compatible repositories.</p>
</div>
<div class="paragraph">
<p>We will start by outlining the things you should consider at the outset of migrating a build from Ant to Gradle and offer some general guidelines on how to proceed.</p>
</div>
<div class="sect3">
<h4 id="migant:general_guidelines"><a class="anchor" href="#migant:general_guidelines"></a><a class="link" href="#migant:general_guidelines">General guidelines</a></h4>
<div class="paragraph">
<p>When you undertake to migrate a build from Ant to Gradle, you should keep in mind the nature of both what you already have and where you would like to end up. Do you want a Gradle build that mirrors the structure of the existing Ant build? Or do you want to move to something that is more idiomatic to Gradle? What are the main benefits you are looking for?</p>
</div>
<div class="paragraph">
<p>To understand the implications, consider the two extreme endpoints that you could aim for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An imported build via <a href="#sec:import_ant_build"><code>ant.importBuild()</code></a></p>
<div class="paragraph">
<p>This approach is quick, simple and works for many Ant-based builds. You end up with a build that&#8217;s effectively identical to the original Ant build, except your Ant targets become Gradle tasks. Even the dependencies between targets are retained.</p>
</div>
<div class="paragraph">
<p>The downside is that you&#8217;re still using the Ant build, which you must continue to maintain. You also lose the advantages of Gradle&#8217;s conventions, many of its plugins, its dependency management, and so on. You can still enhance the build with <a href="#sec:up_to_date_checks">incremental build information</a>, but it&#8217;s more effort than would be the case for a normal Gradle build.</p>
</div>
</li>
<li>
<p>An idiomatic Gradle build</p>
<div class="paragraph">
<p>If you want to future proof your build, this is where you want to end up. Making use of Gradle&#8217;s conventions and plugins will result in a smaller, easier-to-maintain build, with a structure that is familiar to many Java developers. You will also find it easier to take advantage of Gradle&#8217;s power features to improve build performance.</p>
</div>
<div class="paragraph">
<p>The main downside is the extra work required to perform the migration, particularly if the existing build is complex and has many inter-project dependencies. But such builds often benefit the most from a switch to idomatic Gradle. In addition, Gradle provides many features that can ease the migration, such as the ability to <a href="#sec:using_ant_tasks">use core and custom Ant tasks</a> directly from a Gradle build.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You ideally want to end up somewhere close to the second option in the long term, but you don&#8217;t have to get there in one fell swoop.</p>
</div>
<div class="paragraph">
<p>What follows is a series of steps to help you decide the approach you want to take and how to go about it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Keep the old Ant build and new Gradle build side by side</p>
<div class="paragraph">
<p>You know the Ant build works, so you should keep it until you are confident that the Gradle build produces all the same artifacts and otherwise does what you need. This also means that users can try the Gradle build without getting a new copy of the source tree.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t try to change the directory and file structure of the build until after you&#8217;re ready to make the switch.</p>
</div>
</li>
<li>
<p>Develop a mechanism to verify that the two builds produce the same artifacts</p>
<div class="paragraph">
<p>This is a vitally important step to ensure that your deployments and tests don&#8217;t break. Even small changes, such as the contents of a manifest file in a JAR, can cause problems. If your Gradle build produces the same output as the Ant build, this will give you and others confidence in switching over and make it easier to implement the big changes that will provide the greatest benefits.</p>
</div>
</li>
<li>
<p>Decide whether you have a multi-project build or not</p>
<div class="paragraph">
<p>Multi-project builds are generally harder to migrate and require more work than single-project ones. We have provided some dedicated advice to help with the process in the <a href="#migant:multi_project_builds">Migrating multi-project builds</a> section.</p>
</div>
</li>
<li>
<p>Work out what plugins to use for each project</p>
<div class="paragraph">
<p>We expect that the vast majority of Ant builds are for <a href="#building_java_projects">JVM-based projects</a>, for which there are a wealth of plugins that provide a lot of the functionality you need. Not only are there the <a href="#plugin_reference">core plugins</a> that come packaged with Gradle, but you can also find many useful plugins on the <a href="https://plugins.gradle.org/">Plugin Portal</a>.</p>
</div>
<div class="paragraph">
<p>Even if the <a href="#java_plugin">Java Plugin</a> or one of its derivatives (such as the <a href="#java_library_plugin">Java Library Plugin</a>) aren&#8217;t a good match for your build, you should at least consider the <a href="#base_plugin">Base Plugin</a> for its lifecycle tasks.</p>
</div>
</li>
<li>
<p>Import the Ant build or create a Gradle build from scratch</p>
<div class="paragraph">
<p>This step very much depends on the requirements of your build. If a selection of Gradle plugins can do the vast majority of the work your Ant build does, then it probably makes sense to create a fresh Gradle build script that doesn&#8217;t depend on the Ant build and either implements the missing pieces itself or <a href="#sec:using_ant_tasks">utilizes existing Ant tasks</a>.</p>
</div>
<div class="paragraph">
<p>The alternative approach is to <a href="#sec:import_ant_build">import the Ant build</a> into the Gradle build script and gradually replace the Ant build functionality. This allows you to have a working Gradle build at each stage, but it requires a bit of work to get the Gradle tasks working properly with the Ant ones. You can learn more about this approach in <a href="#migant:imported_builds">Working with an imported build</a>.</p>
</div>
</li>
<li>
<p>Configure your build for the existing directory and file structure</p>
<div class="paragraph">
<p>Gradle makes use of conventions to eliminate much of the boilerplate associated with older builds and to make it easier for users to work with new builds once they are familiar with those conventions. But that doesn&#8217;t mean you have to follow them.</p>
</div>
<div class="paragraph">
<p>Gradle provides many configuration options that allow for a good degree of customization. Those options are typically made available through the plugins that provide the conventions. For example, the standard source directory structure for production Java code <code>src/main/java</code> is provided by the Java Plugin, which allows you to <a href="#sec:custom_java_source_set_paths">configure a different source path</a>. Many paths can be modified via properties on the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> object.</p>
</div>
</li>
<li>
<p>Migrate to standard Gradle conventions if you wish</p>
<div class="paragraph">
<p>Once you&#8217;re confident that the Gradle build is producing the same artifacts and other resources as the Ant build, you can consider migrating to the standard conventions, such as for source directory paths. Doing so will allow you to remove the extra configuration that was required to override those conventions. New team members will also find it easier to work with the build after the change.</p>
</div>
<div class="paragraph">
<p>It&#8217;s up to you to decide whether this step is worth the time, energy and potential disruption that it might incur, which in turn depends on your specific build and team.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The rest of the chapter covers some common scenarios you will likely deal with during the migration, such as dependency management and working with Ant tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="migant:imported_builds"><a class="anchor" href="#migant:imported_builds"></a><a class="link" href="#migant:imported_builds">Working with an imported build</a></h4>
<div class="paragraph">
<p>The first step of many migrations will involve <a href="#sec:import_ant_build">importing an Ant build</a> using <code>ant.importBuild()</code>. If you do that, how do you then move towards a standard Gradle build without replacing everything at once?</p>
</div>
<div class="paragraph">
<p>The important thing to remember is that the Ant targets become real Gradle tasks, meaning you can do things like modify their task dependencies, attach extra task actions, and so on. This allows you to substitute native Gradle tasks for the equivalent Ant ones, maintaining any links to other existing tasks.</p>
</div>
<div class="paragraph">
<p>As an example, imagine that you have a Java library project that you want to migrate from Ant to Gradle. The Gradle build script has the line that imports the Ant build and now want to use the standard Gradle mechanism for compiling the Java source files. However, you want to keep using the existing <code>package</code> task that creates the library&#8217;s JAR file.</p>
</div>
<div class="paragraph">
<p>In diagrammatic form, the scenario looks like the following, where each box represents a target/task:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ant-task-migration.png" alt="ant task migration">
</div>
</div>
<div class="paragraph">
<p>The idea is to substitute the standard Gradle <code>compileJava</code> task for the Ant <code>build</code> task. There are several steps involved in this substitution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Applying the <a href="#java_library_plugin">Java Library Plugin</a></p>
<div class="paragraph">
<p>This provides the <code>compileJava</code> task shown in the diagram.</p>
</div>
</li>
<li>
<p>Renaming the old <code>build</code> task</p>
<div class="paragraph">
<p>The name <code>build</code> conflicts with the standard <code>build</code> task provided by the <a href="#base_plugin">Base Plugin</a> (via the Java Library Plugin).</p>
</div>
</li>
<li>
<p>Configuring the compilation to use the existing directory structure</p>
<div class="paragraph">
<p>There&#8217;s a good chance the Ant build does not conform to the standard Gradle directory structure, so you need to tell Gradle where to find the source files and where to place the compiled classes so <code>package</code> can find them.</p>
</div>
</li>
<li>
<p>Updating task dependencies</p>
<div class="paragraph">
<p><code>compileJava</code> must depend on <code>prepare</code>, <code>package</code> must depend on <code>compileJava</code> rather than <code>ant_build</code>, and <code>assemble</code> must depend on <code>package</code> rather than the standard Gradle <code>jar</code> task.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Applying the plugin is as simple as inserting a  <code>plugins {}</code> block at the beginning of the Gradle build script, i.e. before <code>ant.importBuild()</code>. Here&#8217;s how to apply the Java Library Plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Applying the Java Library Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To rename the <code>build</code> task, use the variant of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html#importBuild-java.lang.Object-org.gradle.api.Transformer-">AntBuilder.importBuild()</a> that accepts a transformer, like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Renaming targets on import</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild(<span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>) { <span class="predefined-type">String</span> oldTargetName -&gt;
    <span class="keyword">return</span> oldTargetName == <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span> ? <span class="string"><span class="delimiter">'</span><span class="content">ant_build</span><span class="delimiter">'</span></span> : oldTargetName  // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;) { oldTargetName -&gt;
    if (oldTargetName == &quot;build&quot;) &quot;ant_build&quot; else oldTargetName  // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Renames the <code>build</code> target to <code>ant_build</code> and leaves all other targets unchanged</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configuring a different path for the sources is described in the <a href="#sec:custom_java_source_set_paths">Building Java &amp; JVM projects</a> chapter, while you can change the output directory for the compiled classes in a similar way.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say the original Ant build stores these paths in Ant properties, <code>src.dir</code> for the Java source files and <code>classes.dir</code> for the output. Here&#8217;s how you would configure Gradle to use those paths:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Configuring the source sets</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        java {
            srcDirs = [ ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">src.dir</span><span class="delimiter">'</span></span>] ]
            outputDir = file(ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">classes.dir</span><span class="delimiter">'</span></span>])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java.setSrcDirs(listOf(ant.properties[&quot;src.dir&quot;]))
        java.outputDir = file(ant.properties[&quot;classes.dir&quot;] ?: &quot;$buildDir/classes&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You should eventually aim to switch the standard directory structure for your type of project if possible and then you&#8217;ll be able to remove this customization.</p>
</div>
<div class="paragraph">
<p>The last step is also straightforward and involves using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn">Task.dependsOn</a> property and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn(java.lang.Object[])">Task.dependsOn()</a> method to detach and link tasks. The property is appropriate for <em>replacing</em> dependencies, while the method is the preferred way to add to the existing dependencies.</p>
</div>
<div class="paragraph">
<p>Here is the required task dependency configuration required by the example scenario, which should come after the Ant build import:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Configuring the task dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compileJava.dependsOn <span class="string"><span class="delimiter">'</span><span class="content">prepare</span><span class="delimiter">'</span></span>  // <b class="conum">(1)</b>
<span class="keyword">package</span>.dependsOn = [ <span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span> ]  // <b class="conum">(2)</b>
assemble.dependsOn = [ <span class="string"><span class="delimiter">'</span><span class="content">package</span><span class="delimiter">'</span></span> ]  // <b class="conum">(3)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    compileJava {
        dependsOn(&quot;prepare&quot;)  // <b class="conum">(1)</b>
    }
    named(&quot;package&quot;) {
        setDependsOn(listOf(compileJava))  // <b class="conum">(2)</b>
    }
    assemble {
        setDependsOn(listOf(&quot;package&quot;))  // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Makes compilation depend on the <code>prepare</code> task</p>
</li>
<li>
<p>Detaches <code>package</code> from the <code>ant_build</code> task and makes it depend on <code>compileJava</code></p>
</li>
<li>
<p>Detaches <code>assemble</code> from the standard Gradle <code>jar</code> task and makes it depend on <code>package</code> instead</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>That&#8217;s it! These four steps will successfully replace the old Ant compilation with the Gradle implementation. Even this small migration will be a big help because you&#8217;ll be able to take advantage of Gradle&#8217;s <a href="#sec:incremental_compile">incremental Java compilation</a> for faster builds.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is just a demonstration of how to go about performing a migration in stages. It may make more sense to include resource processing  like with properties files and packaging with the compilation in this stage, since all three aspects are well integrated in Gradle.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One important question you will have to ask yourself is how many tasks to migrate in each stage. The larger the chunks you can migrate in one go the better, but this must be offset against how many custom steps within the Ant build will be affected by the changes.</p>
</div>
<div class="paragraph">
<p>For example, if the Ant build follows a fairly standard approach for compilation, static resources, packaging and unit tests, then it is probably worth migrating all those together. But if the build performs some extra processing on the compiled classes, or does something unique when processing the static resources, it is probably worth splitting those tasks into separate stages.</p>
</div>
</div>
<div class="sect3">
<h4 id="migant:managing_dependencies"><a class="anchor" href="#migant:managing_dependencies"></a><a class="link" href="#migant:managing_dependencies">Managing dependencies</a></h4>
<div class="paragraph">
<p>Ant builds typically take one of two approaches to dealing with binary <a href="#sub:terminology_dependency">dependencies</a> (such as libraries):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Storing them with the project in a local "lib" directory</p>
</li>
<li>
<p>Using <a href="https://ant.apache.org/ivy/">Apache Ivy</a> to manage them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They each require a different technique for the migration to Gradle, but you will find the process straightforward in either case. We look at the details of each scenario in the following sections.</p>
</div>
<div class="sect4">
<h5 id="migant:filesystem_deps"><a class="anchor" href="#migant:filesystem_deps"></a><a class="link" href="#migant:filesystem_deps">Serving dependencies from a directory</a></h5>
<div class="paragraph">
<p>When you are attempting to migrate a build that stores its dependencies on the filesystem, either locally or on the network, you should consider whether you want to eventually move to managed dependencies using remote repositories. That&#8217;s because you can incorporate filesystem dependencies into a Gradle build in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a <a href="#sub:flat_dir_resolver">flat-directory repository</a> and use standard dependency declarations</p>
</li>
<li>
<p>Attach the files directly to the appropriate dependency configurations (<a href="#sub:file_dependencies">file dependencies</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s easier to migrate to managed dependencies served from Maven- or Ivy-compatible repositories if you take the first approach, but doing so requires all your files to conform to the naming convention "&lt;moduleName&gt;-&lt;version&gt;.&lt;extension&gt;".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you store your dependencies in the standard Maven repository layout <code>&lt;repoDir&gt;/&lt;group&gt;/&lt;module&gt;/&lt;version&gt;</code> then you can define a <a href="#sec:declaring_custom_repository">custom Maven repository</a> with a "file://" URL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To demonstrate the two techniques, consider a project that has the following library JARs in its <code>libs</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>libs
 our-custom.jar
 log4j-1.2.8.jar
 commons-io-2.1.jar</pre>
</div>
</div>
<div class="paragraph">
<p>The file <code>our-custom.jar</code> lacks a version number, so it has to be added as a file dependency.
But the other two JARs match the required naming convention and so can be declared as normal <a href="#sub:module_dependencies">module dependencies</a> that are retrieved from a flat-directory repository.</p>
</div>
<div class="paragraph">
<p>The following sample build script demonstrates how you can incorporate all of these libraries into a build:</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Declaring dependencies served from the filesystem</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    flatDir {
        name = <span class="string"><span class="delimiter">'</span><span class="content">libs dir</span><span class="delimiter">'</span></span>
        dir file(<span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)  // <b class="conum">(1)</b>
    }
}

dependencies {
    implementation files(<span class="string"><span class="delimiter">'</span><span class="content">libs/our-custom.jar</span><span class="delimiter">'</span></span>)  // <b class="conum">(2)</b>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">:log4j:1.2.8</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">:commons-io:2.1</span><span class="delimiter">'</span></span>  // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    flatDir {
        name = &quot;libs dir&quot;
        dir(file(&quot;libs&quot;))  // <b class="conum">(1)</b>
    }
}

dependencies {
    implementation(files(&quot;libs/our-custom.jar&quot;))  // <b class="conum">(2)</b>
    implementation(&quot;:log4j:1.2.8&quot;)     // <b class="conum">(3)</b>
    implementation(&quot;:commons-io:2.1&quot;)  // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specifies the path to the directory containing the JAR files</p>
</li>
<li>
<p>Declares a <em>file dependency</em> for the unversioned JAR</p>
</li>
<li>
<p>Declares dependencies using standard dependency coordinates  note that no group is specified, but each identifier has a leading <code>:</code>, implying an empty group</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above sample will add <code>our-custom.jar</code>, <code>log4j-1.2.8.jar</code> and <code>commons-io-2.1.jar</code> to the <code>implementation</code> configuration, which is used to compile the project&#8217;s code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also specify a group in these module dependencies, even though they don&#8217;t actually have a group. That&#8217;s because the flat-directory repository simply ignores the information.</p>
</div>
<div class="paragraph">
<p>If you then add a normal Maven- or Ivy-compatible repository at a later date, Gradle will preferentially download the module dependencies that are declared with a group from that repository rather than the flat-directory one.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="migant:ivy_deps"><a class="anchor" href="#migant:ivy_deps"></a><a class="link" href="#migant:ivy_deps">Migrating Ivy dependencies</a></h5>
<div class="paragraph">
<p>Apache Ivy is a standalone dependency management tool that is widely used with Ant. It works in a similar fashion to Gradle. In fact, they both allow you to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define your own <a href="#sub:terminology_configuration">configurations</a></p>
</li>
<li>
<p>Extend configurations from one another</p>
</li>
<li>
<p>Attach dependencies to configurations</p>
</li>
<li>
<p>Resolve dependencies from Ivy-compatible repositories</p>
</li>
<li>
<p>Publish artifacts to Ivy-compatible repositories</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most notable difference is that Gradle has standard configurations for specific types of projects.
For example, the <a href="#tab:configurations">Java Plugin</a> defines configurations like <code>implementation</code>, <code>testImplementation</code> and <code>runtimeOnly</code>.
You can still <a href="#sec:defining-custom-configurations">define your own dependency configurations</a>, though.</p>
</div>
<div class="paragraph">
<p>This similarity means that it&#8217;s usually quite straightforward to migrate from Ivy to Gradle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transcribe the dependency declarations from your module descriptors into the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:dependencies(groovy.lang.Closure)">dependencies {}</a> block of your Gradle build script, ideally using the standard configurations provided by any plugins you apply.</p>
</li>
<li>
<p>Transcribe any configuration declarations from your module descriptors into the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:configurations(groovy.lang.Closure)">configurations {}</a> block of the build script for any custom configurations that can&#8217;t be replaced by Gradle&#8217;s standard ones.</p>
</li>
<li>
<p>Transcribe the resolvers from your Ivy settings file into the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">repositories {}</a> block of the build script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the chapters on <a href="#sec:what-are-dependency-configurations">Managing Dependency Configurations</a>, <a href="#sec:dependency-types">Declaring Dependencies</a> and <a href="#declaring-repositories">Declaring Repositories</a> for more information.</p>
</div>
<div class="paragraph">
<p>Ivy provides several Ant tasks that handle Ivy&#8217;s process for fetching dependencies. The basic steps of that process consist of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Configure</em> applies the configuration defined in the Ivy settings file</p>
</li>
<li>
<p><em>Resolve</em>  locates the declared dependencies and downloads them to the cache if necessary</p>
</li>
<li>
<p><em>Retrieve</em>  copies the cached dependencies to another directory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle&#8217;s process is similar, but you don&#8217;t have to explicitly invoke the first two steps as it performs them automatically. The third step doesn&#8217;t happen at all  unless you create a task to do it  because Gradle typically uses the files in the dependency cache directly in classpaths and as the source for assembling application packages.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look in more detail at how Ivy&#8217;s steps map to Gradle:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Configuration</dt>
<dd>
<p>Most of Gradle&#8217;s dependency-related configuration is baked into the build script, as you&#8217;ve seen with elements like the <code>dependencies {}</code> block. Another particularly important configuration element is <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">resolutionStrategy</a>, which can be accessed from dependency configurations. This provides many of the features you might get from Ivy&#8217;s conflict managers and is a powerful way to control transitive dependencies and caching.</p>
<div class="paragraph">
<p>Some Ivy configuration options have no equivalent in Gradle. For example, there are no lock strategies because Gradle ensures that its dependency cache is concurrency safe, period. Nor are there "latest strategies" because it&#8217;s simpler to have a reliable, single strategy for conflict resolution. If the "wrong" version is picked, you can easily override it using forced versions or other resolution strategy options.</p>
</div>
<div class="paragraph">
<p>See the chapter on <a href="#">controlling transitive dependencies</a> for more information on this aspect of Gradle.</p>
</div>
</dd>
<dt class="hdlist1">Resolution</dt>
<dd>
<p>At the beginning of the build, Gradle will automatically resolve any dependencies that you have declared and download them to its cache.
It searches the repositories for those dependencies, with the search order defined by <a href="#sec:declaring_multiple_repositories">the order in which the repositories are declared</a>.</p>
<div class="paragraph">
<p>It&#8217;s worth noting that Gradle supports the same dynamic version syntax as Ivy, so you can still use versions like <code>1.0.+</code>. You can also use the special <code>latest.integration</code> and <code>latest.release</code> labels if you wish. If you decide to use such <a href="#sub:declaring_dependency_with_dynamic_version">dynamic</a> and <a href="#sub:declaring_dependency_with_changing_version">changing</a> dependencies, you can configure the caching behavior for them via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">resolutionStrategy</a>.</p>
</div>
<div class="paragraph">
<p>You might also want to consider <a href="#">dependency locking</a> if you&#8217;re using dynamic and/or changing dependencies. It&#8217;s a way to make the build more reliable and allows for <a href="https://reproducible-builds.org/">reproducible builds</a>.</p>
</div>
</dd>
<dt class="hdlist1">Retrieval</dt>
<dd>
<p>As mentioned, Gradle does not automatically copy files from the dependency cache. Its standard tasks typically use the files directly. If you want to copy the dependencies to a local directory, you can use a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task like this in your build script:</p>
<div class="exampleblock">
<div class="title">Example 16. Copying dependencies to a local directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task retrieveRuntimeDependencies(<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/libs</span><span class="delimiter">&quot;</span></span>
    from configurations.runtimeClasspath
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    register&lt;Copy&gt;(&quot;retrieveRuntimeDependencies&quot;) {
        into(&quot;$buildDir/libs&quot;)
        from(configurations.runtimeClasspath)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A configuration is also a file collection, hence why it can be used in the <code>from()</code> configuration. You can use a similar technique to attach a configuration to a compilation task or one that produces documentation. See the chapter on <a href="#working_with_files">Working with Files</a> for more examples and information on Gradle&#8217;s file API.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migant:ivy_publishing"><a class="anchor" href="#migant:ivy_publishing"></a><a class="link" href="#migant:ivy_publishing">Publishing artifacts</a></h4>
<div class="paragraph">
<p>Projects that use Ivy to manage dependencies often also use it for publishing JARs and other artifacts to repositories. If you&#8217;re migrating such a build, then you&#8217;ll be glad to know that Gradle has built-in support for publishing artifacts to Ivy-compatible repositories.</p>
</div>
<div class="paragraph">
<p>Before you attempt to migrate this particular aspect of your build, read the <a href="#publishing_overview">Publishing</a> chapter to learn about Gradle&#8217;s publishing model.
That chapter&#8217;s examples are based on Maven repositories, but the same model is used for Ivy repositories as well.</p>
</div>
<div class="paragraph">
<p>The basic migration process looks like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apply the <a href="#publishing_ivy">Ivy Publish Plugin</a> to your build</p>
</li>
<li>
<p><a href="#publishing_ivy:publications">Configure at least one publication</a>, representing what will be published (including additional artifacts if desired)</p>
</li>
<li>
<p><a href="#publishing_ivy:repositories">Configure one or more repositories to publish artifacts to</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once that&#8217;s all done, you&#8217;ll be able to generate an Ivy module descriptor for each publication and publish them to one or more repositories.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you have defined a publication named "myLibrary" and a repository named "myRepo". Ivy&#8217;s Ant tasks would then map to the Gradle tasks like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;deliver&gt;</code> &#8594; <code>generateDescriptorFileForMyLibraryPublication</code></p>
</li>
<li>
<p><code>&lt;publish&gt;</code> &#8594; <code>publishMyLibraryPublicationToMyRepoRepository</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is also a convenient <code>publish</code> task that publishes <em>all</em> publications to <em>all</em> repositories.
If you&#8217;d prefer to limit which publications go to which repositories, check out the <a href="#sec:publishing_maven:conditional_publishing">relevant section of the Publishing chapter</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">On dependency versions</div>
<div class="paragraph">
<p>Ivy will, by default, automatically replace dynamic versions of dependencies with the resolved "static" versions when it generates the module descriptor. Gradle does <em>not</em> mimic this behavior: declared dependency versions are left unchanged.</p>
</div>
<div class="paragraph">
<p>You can replicate the default Ivy behavior by using the <a href="https://plugins.gradle.org/plugin/nebula.ivy-resolved-dependencies">Nebula Ivy Resolved Plugin</a>. Alternatively, you can <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html#org.gradle.api.publish.ivy.IvyModuleDescriptorSpec:withXml(org.gradle.api.Action)">customize the descriptor file</a> so that it contains the versions you want.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="migant:custom_tasks"><a class="anchor" href="#migant:custom_tasks"></a><a class="link" href="#migant:custom_tasks">Dealing with custom Ant tasks</a></h4>
<div class="paragraph">
<p>One of the advantages of Ant is that it&#8217;s fairly easy to create a custom task and incorporate it into a build. If you have such tasks, then there are two main options for migrating them to a Gradle build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:using_custom_ant_tasks">Using the custom Ant task</a> from the Gradle build</p>
</li>
<li>
<p>Rewriting the task as a <a href="#custom_tasks">custom Gradle task type</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first option is usually quick and easy, but not always. And if you want to integrate the task into incremental build, you must use the <a href="#sec:task_input_output_runtime_api">incremental build runtime API</a>. You also often have to work with Ant paths and filesets, which are clunky.</p>
</div>
<div class="paragraph">
<p>The second option is preferable in the long term, if you have the time. Gradle task types tend to be simpler than Ant tasks because they don&#8217;t have to work with an XML-based interface. You also gain access to Gradle&#8217;s rich APIs. Lastly, this approach can make use of the <a href="#sec:task_input_output_annotations">type-safe incremental build API</a> based on typed properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="migant:working_with_files"><a class="anchor" href="#migant:working_with_files"></a><a class="link" href="#migant:working_with_files">Working with files</a></h4>
<div class="paragraph">
<p>Ant has many tasks for working with files, most of which have Gradle equivalents. As with other areas of Ant to Gradle migration, you can <a href="#sec:using_ant_tasks">use those Ant tasks</a> from within your Gradle build. However, we strongly recommend migrating to native Gradle constructs where possible so that the build benefits from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:up_to_date_checks">Incremental build</a></p>
</li>
<li>
<p>Easier integration with other parts of the build, such as dependency configurations</p>
</li>
<li>
<p>More idiomatic build scripts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That said, it can be convenient to use those Ant tasks that have no direct equivalents, such as <code>&lt;checksum&gt;</code> and <code>&lt;chown&gt;</code>. Even then, in the long run it may be better to convert these to native Gradle task types that make use of standard Java APIs or third-party libraries to achieve the same thing.</p>
</div>
<div class="paragraph">
<p>Here are the most common file-related elements used by Ant builds, along with the Gradle equivalents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;copy&gt;</code> prefer the Gradle <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task type</p>
</li>
<li>
<p><code>&lt;zip&gt;</code> (plus Java variants) prefer the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a> task type (plus <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.War.html">War</a>, and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a>)</p>
</li>
<li>
<p><code>&lt;unzip&gt;</code> prefer using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree()</a> method with a <code>Copy</code> task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see several examples of Gradle&#8217;s file API and learn more about it in the <a href="#working_with_files">Working with Files</a> chapter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">On paths and filesets</div>
<div class="paragraph">
<p>Ant makes use of the concepts of path-like structures and filesets to enable users to work with collections of files and directories. Gradle has a simpler, more powerful model based on <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a>s and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a>s that can be treated as objects from within the build. Both types allow filtering based on Ant&#8217;s glob syntax, e.g. <code>**/books_*</code>. Learn more about these types and other aspects of Gradle&#8217;s file API in the <a href="#working_with_files">Working with Files</a> chapter.</p>
</div>
<div class="paragraph">
<p>You can still construct Ant paths and filesets from within your build via the <code>ant</code> object if you need to interact with an Ant task that requires them. The chapter on <a href="#ant">Ant integration</a> has examples that use both <code>&lt;path&gt;</code> and <code>&lt;fileset&gt;</code>. There is even <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html#addToAntBuilder-java.lang.Object-java.lang.String-org.gradle.api.file.FileCollection.AntType-">a method on <code>FileCollection</code></a> that will convert a file collection to a fileset or similar Ant type.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="migant:properties"><a class="anchor" href="#migant:properties"></a><a class="link" href="#migant:properties">Migrating Ant properties</a></h4>
<div class="paragraph">
<p>Ant makes use of a properties map to store values that can be reused throughout the build. The big downsides to this approach are that property values are all strings and the properties themselves behave like global variables.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Interacting with Ant properties in Gradle</div>
<div class="paragraph">
<p>Sometimes you will want to make use of an Ant task directly from your Gradle build and that task requires one or more Ant properties to be set. If that&#8217;s the case, you can easily set those properties via the <code>ant</code> object, as described in the <a href="#sec:ant_properties">Using Ant from Gradle</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle does use something similar in the form of <a href="#sec:project_properties">project properties</a>, which are a reasonable way to parameterize a build. These can be set from the command line, in a <a href="#sec:gradle_configuration_properties"><code>gradle.properties</code> file</a>, or even via specially named system properties and environment variables.</p>
</div>
<div class="paragraph">
<p>If you have existing Ant properties files, you can copy their contents into the project&#8217;s <code>gradle.properties</code> file. Just be aware of two important points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties set in <code>gradle.properties</code> <strong>do not</strong> override <a href="#sec:extra_properties">extra project properties</a> defined in the build script with the same name</p>
</li>
<li>
<p>Imported Ant tasks will not automatically "see" the Gradle project properties you must copy them into the Ant properties map for that to happen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another important factor to understand is that a Gradle build script works with an object-oriented API and it&#8217;s often best to use the properties of tasks, source sets and other objects where possible. For example, this build script fragment creates tasks for packaging Javadoc documentation as a JAR and unpacking it, linking tasks via their properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Using task properties in place of project properties</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
    tmpDistDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/dist</span><span class="delimiter">&quot;</span></span>)
}

task javadocJarArchive(<span class="key">type</span>: Jar) {
    from javadoc  // <b class="conum">(1)</b>
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">javadoc</span><span class="delimiter">'</span></span>
}

task unpackJavadocs(<span class="key">type</span>: Copy) {
    from zipTree(javadocJarArchive.archiveFile)  // <b class="conum">(2)</b>
    into tmpDistDir  // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val tmpDistDir by extra { file(&quot;$buildDir/dist&quot;) }

tasks {
    register&lt;Jar&gt;(&quot;javadocJarArchive&quot;) {
        from(javadoc)  // <b class="conum">(1)</b>
        archiveClassifier.set(&quot;javadoc&quot;)
    }

    register&lt;Copy&gt;(&quot;unpackJavadocs&quot;) {
        from(zipTree(named&lt;Jar&gt;(&quot;javadocJarArchive&quot;).get().archiveFile))  // <b class="conum">(2)</b>
        into(tmpDistDir)  // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Packages all <code>javadoc</code>'s output files equivalent to <code>from javadoc.destinationDir</code></p>
</li>
<li>
<p>Uses the location of the Javadoc JAR held by the <code>javadocJar</code> task</p>
</li>
<li>
<p>Uses an extra project property called <code>tmpDistDir</code> to define the location of the 'dist' directory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you can see from the example with <code>tmpDistDir</code>, there is often still a need to define paths and the like through properties, which is why Gradle also provides <a href="#sec:extra_properties">extra properties</a> that can be attached to the project, tasks and some other types of objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="migant:multi_project_builds"><a class="anchor" href="#migant:multi_project_builds"></a><a class="link" href="#migant:multi_project_builds">Migrating multi-project builds</a></h4>
<div class="paragraph">
<p>Multi-project builds are a particular challenge to migrate because there is no standard approach in Ant for either structuring them or handling inter-project dependencies. Most of them likely use the <code>&lt;ant&gt;</code> task in some way, but that&#8217;s about all that one can say.</p>
</div>
<div class="paragraph">
<p>Fortunately, Gradle&#8217;s multi-project support can handle fairly diverse project structures and it provides much more robust and helpful support than Ant for constructing and maintaining multi-project builds. The <code>ant.importBuild()</code> method also handles <code>&lt;ant&gt;</code> and <code>&lt;antcall&gt;</code> tasks transparently, which allows for a phased migration.</p>
</div>
<div class="paragraph">
<p>We will suggest one process for migration here and hope that it either works for your case or at least gives you some ideas. It breaks down like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by learning <a href="#multi_project_builds">how Gradle configures multi-project builds</a>.</p>
</li>
<li>
<p>Create a Gradle build script in each project of the build, setting their contents to this line:</p>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>build.xml</code> with the path to the actual Ant build file that corresponds to the project. If there is no corresponding Ant build file, leave the Gradle build script empty. Your build may not be suitable in that case for this migration approach, but continue with these steps to see whether there is still a way to do a phased migration.</p>
</div>
</li>
<li>
<p>Create a settings file that <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])">includes all the projects</a> that now have a Gradle build script.</p>
</li>
<li>
<p>Implement inter-project dependencies.</p>
<div class="paragraph">
<p>Some projects in your multi-project build will depend on artifacts produced by one or more other projects in that build. Such projects need to ensure that those projects they depend on have produced their artifacts and that they know the paths to those artifacts.</p>
</div>
<div class="paragraph">
<p>Ensuring the production of the required artifacts typically means calling into other projects' builds via the <code>&lt;ant&gt;</code> task. This unfortunately bypasses the Gradle build, negating any changes you make to the Gradle build scripts. You will need to replace targets that use <code>&lt;ant&gt;</code> tasks with Gradle <a href="#sec:adding_dependencies_to_tasks">task dependencies</a>.</p>
</div>
<div class="paragraph">
<p>For example, imagine you have a web project that depends on a "util" library that&#8217;s part of the same build. The Ant build file for "web" might have a target like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web/build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buildRequiredProjects</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${root.dir}/util</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">build</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>  <b class="conum">(1)</b>
    <span class="tag">&lt;/target&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>root.dir</code> would have to be defined by the build</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This can be replaced by an inter-project task dependency in the corresponding Gradle build script, as demonstrated in the following example that assumes the "web" project&#8217;s "compile" task is the thing that requires "util" to be built beforehand:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

compile.dependsOn = [ <span class="string"><span class="delimiter">'</span><span class="content">:util:build</span><span class="delimiter">'</span></span> ]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">web/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks {
    named&lt;Task&gt;(&quot;compile&quot;) {
        setDependsOn(listOf(&quot;:util:build&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is not as robust or powerful as Gradle&#8217;s <a href="#sec:project_jar_dependencies">project dependencies</a>, but it solves the immediate problem without big changes to the build. Just be careful to remove or override any dependencies on tasks that delegate to other subprojects, like the <code>buildRequiredProjects</code> task.</p>
</div>
</li>
<li>
<p>Identify the projects that have no dependencies on other projects and migrate them to idiomatic Gradle builds scripts.</p>
<div class="paragraph">
<p>Just follow the advice in the rest of this guide to migrate individual project builds. As mentioned elsewhere, you should ideally use Gradle standard plugins where possible. This may mean that you need to add an extra copy task to each build that copies the generated artifacts to the location expected by the rest of the Ant builds.</p>
</div>
</li>
<li>
<p>Migrate projects as and when they depend solely on projects with fully migrated Gradle builds.</p>
<div class="paragraph">
<p>At this point, you should be able to switch to using proper project dependencies attached to the appropriate dependency configurations.</p>
</div>
</li>
<li>
<p>Clean up projects once no part of the Ant build depends on them.</p>
<div class="paragraph">
<p>We mentioned in step 5 that you might need to add copy tasks to satisfy the requirements of dependent Ant builds. Once those builds have been migrated, such build logic will no longer be needed and should be removed.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>At the end of the process you should have a Gradle build that you are confident works as it should, with much less build logic than before.</p>
</div>
</div>
<div class="sect3">
<h4 id="further_reading_2"><a class="anchor" href="#further_reading_2"></a><a class="link" href="#further_reading_2">Further reading</a></h4>
<div class="paragraph">
<p>This chapter has covered the major topics that are specific to migrating Ant builds to Gradle. All that remain are a few other areas that may be useful during or after a migration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learn how to configure Gradle&#8217;s <a href="#build_environment">build environment</a>, including the JVM settings used to run it</p>
</li>
<li>
<p>Learn how to <a href="#organizing_gradle_projects">structure your builds effectively</a></p>
</li>
<li>
<p><a href="#logging">Configure Gradle&#8217;s logging</a> and use it from your builds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a final note, this guide has only touched on a few of Gradle&#8217;s features and we encourage you to learn about the rest from the other chapters of the user manual and from our tutorial-style <a href="https://guides.gradle.org/">Gradle Guides</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:running_builds"><a class="anchor" href="#part:running_builds"></a><a class="link" href="#part:running_builds">Running Gradle Builds</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="build_environment"><a class="anchor" href="#build_environment"></a><a class="link" href="#build_environment">Build Environment</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Interested in configuring your Build Cache to speed up builds? <a href="https://gradle.com/training/build-cache-deep-dive/?bid=docs-build-environment">Register here</a> for our Build Cache training session to learn some of the tips and tricks top engineering teams are using to increase build speed.
</td>
</tr>
</table>
</div>
<div class="paragraph lead">
<p>Gradle provides multiple mechanisms for configuring behavior of Gradle itself and specific projects. The following is a reference for using these mechanisms.</p>
</div>
<div class="paragraph">
<p>When configuring Gradle behavior you can use these methods, listed in order of highest to lowest precedence (first one wins):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#command_line_interface">Command-line flags</a> such as <code>--build-cache</code>. These have precedence over properties and environment variables.</p>
</li>
<li>
<p><a href="#sec:gradle_system_properties">System properties</a> such as <code>systemProp.http.proxyHost=somehost.org</code> stored in a <code>gradle.properties</code> file.</p>
</li>
<li>
<p><a href="#sec:gradle_configuration_properties">Gradle properties</a> such as <code>org.gradle.caching=true</code> that are typically stored in a <code>gradle.properties</code> file in a project root directory or <code>GRADLE_USER_HOME</code> environment variable.</p>
</li>
<li>
<p><a href="#sec:gradle_environment_variables">Environment variables</a> such as <code>GRADLE_OPTS</code> sourced by the environment that executes Gradle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aside from configuring the build environment, you can configure a given project build using <a href="#sec:project_properties">Project properties</a> such as <code>-PreleaseType=final</code>.</p>
</div>
<div class="sect3">
<h4 id="sec:gradle_configuration_properties"><a class="anchor" href="#sec:gradle_configuration_properties"></a><a class="link" href="#sec:gradle_configuration_properties">Gradle properties</a></h4>
<div class="paragraph">
<p>Gradle provides several options that make it easy to configure the Java process that will be used to execute your build. While it&#8217;s possible to configure these in your local environment via <code>GRADLE_OPTS</code> or <code>JAVA_OPTS</code>, it is useful to store certain settings like JVM memory configuration and Java home location in version control so that an entire team can work with a consistent environment.</p>
</div>
<div class="paragraph">
<p>Setting up a consistent environment for your build is as simple as placing these settings into a <code>gradle.properties</code> file. The configuration is a combination of all your <code>gradle.properties</code> files, but if an option is configured in multiple locations, the <em>first one wins</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>system properties, e.g. when <code>-Dgradle.user.home</code> is set on the command line.</p>
</li>
<li>
<p><code>gradle.properties</code> in <code>GRADLE_USER_HOME</code> directory.</p>
</li>
<li>
<p><code>gradle.properties</code> in project root directory.</p>
</li>
<li>
<p><code>gradle.properties</code> in Gradle installation directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following properties can be used to configure the Gradle build environment:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.caching=(true,false)</code></dt>
<dd>
<p>When set to true, Gradle will reuse task outputs from any previous build, when possible, resulting is much faster builds. Learn more about <a href="#build_cache">using the build cache</a>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.caching.debug=(true,false)</code></dt>
<dd>
<p>When set to true, individual input property hashes and the build cache key for each task are logged on the console. Learn more about <a href="#sec:task_output_caching">task output caching</a>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.configureondemand=(true,false)</code></dt>
<dd>
<p>Enables incubating <a href="#sec:configuration_on_demand">configuration on demand</a>, where Gradle will attempt to configure only necessary projects.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>Customize console output coloring or verbosity. Default depends on how Gradle is invoked. See <a href="#sec:command_line_logging">command-line logging</a> for additional details.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.daemon=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code> the <a href="#gradle_daemon">Gradle Daemon</a> is used to run the build. Default is <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.daemon.idletimeout=(# of idle millis)</code></dt>
<dd>
<p>Gradle Daemon will terminate itself after specified number of idle milliseconds. Default is <code>10800000</code> (3 hours).</p>
</dd>
<dt class="hdlist1"><code>org.gradle.debug=(true,false)</code></dt>
<dd>
<p>When set to <code>true</code>, Gradle will run the build with remote debugging enabled, listening on port 5005. Note that this is the equivalent of adding <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005</code> to the JVM command line and will suspend the virtual machine until a debugger is attached. Default is <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.java.home=(path to JDK home)</code></dt>
<dd>
<p>Specifies the Java home for the Gradle build process. The value can be set to either a <code>jdk</code> or <code>jre</code> location, however, depending on what your build does, using a JDK is safer. A reasonable default is derived from your environment (<code>JAVA_HOME</code> or the path to <code>java</code>) if the setting is unspecified. This does not affect the version of Java used to launch the Gradle client VM (<a href="#sec:gradle_environment_variables">see Environment variables</a>).</p>
</dd>
<dt class="hdlist1"><code>org.gradle.jvmargs=(JVM arguments)</code></dt>
<dd>
<p>Specifies the JVM arguments used for the Gradle Daemon. The setting is particularly useful for <a href="#sec:configuring_jvm_memory">configuring JVM memory settings</a> for build performance. This does not affect the JVM settings for the Gradle client VM.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code></dt>
<dd>
<p>When set to quiet, warn, lifecycle, info, or debug, Gradle will use this log level. The values are not case sensitive. The <code>lifecycle</code> level is the default. See <a href="#sec:choosing_a_log_level">Choosing a log level</a>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.parallel=(true,false)</code></dt>
<dd>
<p>When configured, Gradle will fork up to <code>org.gradle.workers.max</code> JVMs to execute projects in parallel. To learn more about parallel task execution, see <a href="https://guides.gradle.org/performance/#parallel_execution">the Gradle performance guide</a>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.warning.mode=(all,fail,summary,none)</code></dt>
<dd>
<p>When set to <code>all</code>, <code>summary</code> or <code>none</code>, Gradle will use different warning type display. See <a href="#sec:command_line_logging">Command-line logging options</a> for details.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.workers.max=(max # of worker processes)</code></dt>
<dd>
<p>When configured, Gradle will use a maximum of the given number of workers. Default is number of CPU processors. See also <a href="#sec:command_line_performance">performance command-line options</a>.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.priority=(low,normal)</code></dt>
<dd>
<p>Specifies the scheduling priority for the Gradle daemon and all processes launched by it. Default is <code>normal</code>. See also <a href="#sec:command_line_performance">performance command-line options</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example demonstrates usage of various properties.</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Setting properties with a gradle.properties file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gradlePropertiesProp=gradlePropertiesValue
sysProp=shouldBeOverWrittenBySysProp
systemProp.system=systemValue</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task printProps {
    doLast {
        println commandLineProjectProp
        println gradlePropertiesProp
        println systemProjectProp
        println <span class="predefined-type">System</span>.properties[<span class="string"><span class="delimiter">'</span><span class="content">system</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Project properties can be accessed via delegation
val commandLineProjectProp: String by project
val gradlePropertiesProp: String by project
val systemProjectProp: String by project

tasks.register(&quot;printProps&quot;) {
    doLast {
        println(commandLineProjectProp)
        println(gradlePropertiesProp)
        println(systemProjectProp)
        println(System.getProperty(&quot;system&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q -PcommandLineProjectProp=commandLineProjectPropValue -Dorg.gradle.project.systemProjectProp=systemPropertyValue printProps
commandLineProjectPropValue
gradlePropertiesValue
systemPropertyValue
systemValue</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_system_properties"><a class="anchor" href="#sec:gradle_system_properties"></a><a class="link" href="#sec:gradle_system_properties">System properties</a></h4>
<div class="paragraph">
<p>Using the <code>-D</code> command-line option, you can pass a system property to the JVM which runs Gradle. The <code>-D</code> option of the <code>gradle</code> command has the same effect as the <code>-D</code> option of the <code>java</code> command.</p>
</div>
<div class="paragraph">
<p>You can also set system properties in <code>gradle.properties</code> files with the prefix <code>systemProp.</code></p>
</div>
<div class="listingblock">
<div class="title">Specifying system properties in <code>gradle.properties</code></div>
<div class="content">
<pre>systemProp.gradle.wrapperUser=myuser
systemProp.gradle.wrapperPassword=mypassword</pre>
</div>
</div>
<div class="paragraph">
<p>The following system properties are available. Note that command-line options take precedence over system properties.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>gradle.wrapperUser=(myuser)</code></dt>
<dd>
<p>Specify user name to download Gradle distributions from servers using HTTP Basic Authentication. Learn more in <a href="#sec:authenticated_download">Authenticated wrapper downloads</a>.</p>
</dd>
<dt class="hdlist1"><code>gradle.wrapperPassword=(mypassword)</code></dt>
<dd>
<p>Specify password for downloading a Gradle distribution using the Gradle wrapper.</p>
</dd>
<dt class="hdlist1"><code>gradle.user.home=(path to directory)</code></dt>
<dd>
<p>Specify the Gradle user home directory.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In a multi project build, <code>systemProp.</code> properties set in any project except the root will be ignored. That is, only the root project&#8217;s <code>gradle.properties</code> file will be checked for properties that begin with the <code>systemProp.</code> prefix.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:gradle_environment_variables"><a class="anchor" href="#sec:gradle_environment_variables"></a><a class="link" href="#sec:gradle_environment_variables">Environment variables</a></h4>
<div class="paragraph">
<p>The following environment variables are available for the <code>gradle</code> command. Note that command-line options and system properties take precedence over environment variables.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>GRADLE_OPTS</code></dt>
<dd>
<p>Specifies JVM arguments to use when starting the Gradle client VM. The client VM only handles command line input/output, so it is rare that one would need to change its VM options.
The actual build is run by the Gradle daemon, which is not affected by this environment variable.</p>
</dd>
<dt class="hdlist1"><code>GRADLE_USER_HOME</code></dt>
<dd>
<p>Specifies the Gradle user home directory (which defaults to <code>$USER_HOME/.gradle</code> if not set).</p>
</dd>
<dt class="hdlist1"><code>JAVA_HOME</code></dt>
<dd>
<p>Specifies the JDK installation directory to use for the client VM. This VM is also used for the daemon, unless a different one is specified in a Gradle properties file with <code>org.gradle.java.home</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_properties"><a class="anchor" href="#sec:project_properties"></a><a class="link" href="#sec:project_properties">Project properties</a></h4>
<div class="paragraph">
<p>You can add properties directly to your <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> object via the <code>-P</code> command line option.</p>
</div>
<div class="paragraph">
<p>Gradle can also set project properties when it sees specially-named system properties or environment variables. If the environment variable name looks like <code>ORG_GRADLE_PROJECT<em>_prop</em>=somevalue</code>, then Gradle will set a <code>prop</code> property on your project object, with the value of <code>somevalue</code>. Gradle also supports this for system properties, but with a different naming pattern, which looks like <code>org.gradle.project.<em>prop</em></code>. Both of the following will set the <code>foo</code> property on your Project object to <code>"bar"</code>.</p>
</div>
<div class="listingblock">
<div class="title">Setting a project property via a system property</div>
<div class="content">
<pre>org.gradle.project.foo=bar</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Setting a project property via an environment variable</div>
<div class="content">
<pre>ORG_GRADLE_PROJECT_foo=bar</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The properties file in the user&#8217;s home directory has precedence over property files in the project directories.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This feature is very useful when you don&#8217;t have admin rights to a continuous integration server and you need to set property values that should not be easily visible. Since you cannot use the <code>-P</code> option in that scenario, nor change the system-level configuration files, the correct strategy is to change the configuration of your continuous integration build job, adding an environment variable setting that matches an expected pattern. This won&#8217;t be visible to normal users on the system.</p>
</div>
<div class="paragraph">
<p>You can access a project property in your build script simply by using its name as you would use a variable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a project property is referenced but does not exist, an exception will be thrown and the build will fail.</p>
</div>
<div class="paragraph">
<p>You should check for existence of optional project properties before you access them using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:hasProperty(java.lang.String)">Project.hasProperty(java.lang.String)</a> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_jvm_memory"><a class="anchor" href="#sec:configuring_jvm_memory"></a><a class="link" href="#sec:configuring_jvm_memory">Configuring JVM memory</a></h4>
<div class="paragraph">
<p>You can adjust JVM options for Gradle in the following ways:</p>
</div>
<div class="paragraph">
<p>The <code>org.gradle.jvmargs</code> Gradle property controls the VM running the build. It defaults to <code>-Xmx512m "-XX:MaxMetaspaceSize=256m"</code></p>
</div>
<div class="listingblock">
<div class="title">Changing JVM settings for the build VM</div>
<div class="content">
<pre>org.gradle.jvmargs=-Xmx2g -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>JAVA_OPTS</code> environment variable controls the command line client, which is only used to display console output. It defaults to <code>-Xmx64m</code></p>
</div>
<div class="listingblock">
<div class="title">Changing JVM settings for the client VM</div>
<div class="content">
<pre>JAVA_OPTS="-Xmx64m -XX:MaxPermSize=64m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is one case where the client VM can also serve as the build VM:
If you deactivate the <a href="#gradle_daemon">Gradle Daemon</a> and the client VM has the same settings as required for the build VM, the client VM will run the build directly.
Otherwise the client VM will fork a new VM to run the actual build in order to honor the different settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain tasks, like the <code>test</code> task, also fork additional JVM processes. You can configure these through the tasks themselves.
They all use <code>-Xmx512m</code> by default.</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Set Java compile options for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a> tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

tasks.withType(JavaCompile) {
    options.compilerArgs += [<span class="string"><span class="delimiter">'</span><span class="content">-Xdoclint:none</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-Xlint:none</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-nowarn</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.compilerArgs = listOf(&quot;-Xdoclint:none&quot;, &quot;-Xlint:none&quot;, &quot;-nowarn&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See other examples in the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> API documentation and <a href="#sec:test_execution">test execution in the Java plugin reference</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://scans.gradle.com">Build scans</a> will tell you information about the JVM that executed the build when you use the <code>--scan</code> option.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://scans.gradle.com/s/sample/cpp-parallel/infrastructure"><img src="img/build-scan-infrastructure.png" alt="Build Environment in build scan"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_task_using_project_properties"><a class="anchor" href="#sec:configuring_task_using_project_properties"></a><a class="link" href="#sec:configuring_task_using_project_properties">Configuring a task using project properties</a></h4>
<div class="paragraph">
<p>It&#8217;s possible to change the behavior of a task based on project properties specified at invocation time.</p>
</div>
<div class="paragraph">
<p>Suppose you&#8217;d like to ensure release builds are only triggered by CI. A simple way to handle this is through an <code>isCI</code> project property.</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Prevent releasing outside of CI</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task performRelease {
    doLast {
        <span class="keyword">if</span> (project.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">isCI</span><span class="delimiter">&quot;</span></span>)) {
            println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Performing release actions</span><span class="delimiter">&quot;</span></span>)
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidUserDataException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot perform release outside of CI</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;performRelease&quot;) {
    doLast {
        if (project.hasProperty(&quot;isCI&quot;)) {
            println(&quot;Performing release actions&quot;)
        } else {
            throw InvalidUserDataException(&quot;Cannot perform release outside of CI&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle performRelease -PisCI=true --quiet
Performing release actions</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:accessing_the_web_via_a_proxy"><a class="anchor" href="#sec:accessing_the_web_via_a_proxy"></a><a class="link" href="#sec:accessing_the_web_via_a_proxy">Accessing the web through a HTTP proxy</a></h4>
<div class="paragraph">
<p>Configuring an HTTP or HTTPS proxy (for downloading dependencies, for example) is done via standard JVM system properties. These properties can be set directly in the build script; for example, setting the HTTP proxy host would be done with <code>System.setProperty('http.proxyHost', 'www.somehost.org')</code>. Alternatively, the properties can be <a href="#sec:gradle_configuration_properties">specified in gradle.properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Configuring an HTTP proxy using <code>gradle.properties</code></div>
<div class="content">
<pre>systemProp.http.proxyHost=www.somehost.org
systemProp.http.proxyPort=8080
systemProp.http.proxyUser=userid
systemProp.http.proxyPassword=password
systemProp.http.nonProxyHosts=*.nonproxyrepos.com|localhost</pre>
</div>
</div>
<div class="paragraph">
<p>There are separate settings for HTTPS.</p>
</div>
<div class="listingblock">
<div class="title">Configuring an HTTPS proxy using <code>gradle.properties</code></div>
<div class="content">
<pre>systemProp.https.proxyHost=www.somehost.org
systemProp.https.proxyPort=8080
systemProp.https.proxyUser=userid
systemProp.https.proxyPassword=password
systemProp.https.nonProxyHosts=*.nonproxyrepos.com|localhost</pre>
</div>
</div>
<div class="paragraph">
<p>You may need to set other properties to access other networks. Here are 2 references that may be helpful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob;f=src/main/org/apache/tools/ant/util/ProxySetup.java;hb=HEAD">ProxySetup.java in the Ant codebase</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javase/7/docs/technotes/guides/net/properties.html">JDK 7 Networking Properties</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ntlm_authentication"><a class="anchor" href="#ntlm_authentication"></a><a class="link" href="#ntlm_authentication">NTLM Authentication</a></h5>
<div class="paragraph">
<p>If your proxy requires NTLM authentication, you may need to provide the authentication domain as well as the username and password. There are 2 ways that you can provide the domain for authenticating to a NTLM proxy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>http.proxyUser</code> system property to a value like <code><em>domain</em>/<em>username</em></code>.</p>
</li>
<li>
<p>Provide the authentication domain via the <code>http.auth.ntlm.domain</code> system property.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_daemon"><a class="anchor" href="#gradle_daemon"></a><a class="link" href="#gradle_daemon">The Gradle Daemon</a></h3>
<div class="quoteblock">
<blockquote>
A daemon is a computer program that runs as a background process, rather than being under the direct control of an interactive user.
</blockquote>
<div class="attribution">
&#8212; Wikipedia
</div>
</div>
<div class="paragraph">
<p>Gradle runs on the Java Virtual Machine (JVM) and uses several supporting libraries that require a non-trivial initialization time. As a result, it can sometimes seem a little slow to start. The solution to this problem is the Gradle <em>Daemon</em>: a long-lived background process that executes your builds much more quickly than would otherwise be the case. We accomplish this by avoiding the expensive bootstrapping process as well as leveraging caching, by keeping data about your project in memory. Running Gradle builds with the Daemon is no different than without. Simply configure whether you want to use it or not  everything else is handled transparently by Gradle.</p>
</div>
<div class="sect3">
<h4 id="sec:why_the_daemon"><a class="anchor" href="#sec:why_the_daemon"></a><a class="link" href="#sec:why_the_daemon">Why the Gradle Daemon is important for performance</a></h4>
<div class="paragraph">
<p>The Daemon is a long-lived process, so not only are we able to avoid the cost of JVM startup for every build, but we are able to cache information about project structure, files, tasks, and more in memory.</p>
</div>
<div class="paragraph">
<p>The reasoning is simple: improve build speed by reusing computations from previous builds. However, the benefits are dramatic: we typically measure build times reduced by 15-75% on subsequent builds. We recommend profiling your build by using <code>--profile</code> to get a sense of how much impact the Gradle Daemon can have for you.</p>
</div>
<div class="paragraph">
<p>The Gradle Daemon is enabled by default starting with Gradle 3.0, so you don&#8217;t have to do anything to benefit from it.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:status"><a class="anchor" href="#sec:status"></a><a class="link" href="#sec:status">Running Daemon Status</a></h4>
<div class="paragraph">
<p>To get a list of running Gradle Daemons and their statuses use the <code>--status</code> command.</p>
</div>
<div class="paragraph">
<p>Sample output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    PID VERSION                 STATUS
  28411 3.0                     IDLE
  34247 3.0                     BUSY</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, a given Gradle version can only connect to daemons of the same version. This means the status output will only show Daemons for the version of Gradle being invoked and not for any other versions. Future versions of Gradle will lift this constraint and will show the running Daemons for all versions of Gradle.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:disabling_the_daemon"><a class="anchor" href="#sec:disabling_the_daemon"></a><a class="link" href="#sec:disabling_the_daemon">Disabling the Daemon</a></h4>
<div class="paragraph">
<p>The Gradle Daemon is enabled by default, and we recommend always enabling it. There are several ways to disable the Daemon, but the most common one is to add the line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.gradle.daemon=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>to the file <code>USER_HOME/.gradle/gradle.properties</code>, where <code>USER_HOME</code> is your home directory. Thats typically one of the following, depending on your platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>C:\Users\&lt;username&gt;</code> (Windows Vista &amp; 7+)</p>
</li>
<li>
<p><code>/Users/&lt;username&gt;</code> (macOS)</p>
</li>
<li>
<p><code>/home/&lt;username&gt;</code> (Linux)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If that file doesnt exist, just create it using a text editor. You can find details of other ways to disable (and enable) the Daemon in <a href="#daemon_faq">Daemon FAQ</a> further down. That section also contains more detailed information on how the Daemon works.</p>
</div>
<div class="paragraph">
<p>Note that having the Daemon enabled, all your builds will take advantage of the speed boost, regardless of the version of Gradle a particular build uses.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Continuous integration</div>
<div class="paragraph">
<p>Since Gradle 3.0, we enable Daemon by default and recommend using it for both developers' machines and Continuous Integration servers. However, if you suspect that Daemon makes your CI builds unstable, you can disable it to use a fresh runtime for each build since the runtime is <em>completely</em> isolated from any previous builds.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:stopping_an_existing_daemon"><a class="anchor" href="#sec:stopping_an_existing_daemon"></a><a class="link" href="#sec:stopping_an_existing_daemon">Stopping an existing Daemon</a></h4>
<div class="paragraph">
<p>As mentioned, the Daemon is a background process. You neednt worry about a build up of Gradle processes on your machine, though. Every Daemon monitors its memory usage compared to total system memory and will stop itself if idle when available system memory is low. If you want to explicitly stop running Daemon processes for any reason, just use the command <code>gradle --stop</code>.</p>
</div>
<div class="paragraph">
<p>This will terminate all Daemon processes that were started with the same version of Gradle used to execute the command. If you have the Java Development Kit (JDK) installed, you can easily verify that a Daemon has stopped by running the <code>jps</code> command. Youll see any running Daemons listed with the name <code>GradleDaemon</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="daemon_faq"><a class="anchor" href="#daemon_faq"></a><a class="link" href="#daemon_faq">FAQ</a></h4>
<div class="sect4">
<h5 id="sec:ways_to_disable_gradle_daemon"><a class="anchor" href="#sec:ways_to_disable_gradle_daemon"></a><a class="link" href="#sec:ways_to_disable_gradle_daemon">How do I disable the Gradle Daemon?</a></h5>
<div class="paragraph">
<p>There are two recommended ways to disable the Daemon persistently for an environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via environment variables: add the flag <code>-Dorg.gradle.daemon=false</code> to the <code>GRADLE_OPTS</code> environment variable</p>
</li>
<li>
<p>Via properties file: add <code>org.gradle.daemon=false</code> to the <code>GRADLE_USER_HOME/gradle.properties</code> file</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note, <code>GRADLE_USER_HOME</code> defaults to <code>USER_HOME/.gradle</code>, where <code>USER_HOME</code> is the home directory of the current user. This location can be configured via the <code>-g</code> and <code>--gradle-user-home</code> command line switches, as well as by the <code>GRADLE_USER_HOME</code> environment variable and <code>org.gradle.user.home</code> JVM system property.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both approaches have the same effect. Which one to use is up to personal preference. Most Gradle users choose the second option and add the entry to the user <code>gradle.properties</code> file.</p>
</div>
<div class="paragraph">
<p>On Windows, this command will disable the Daemon for the current user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>(if not exist "%USERPROFILE%/.gradle" mkdir "%USERPROFILE%/.gradle") &amp;&amp; (echo. &gt;&gt; "%USERPROFILE%/.gradle/gradle.properties" &amp;&amp; echo org.gradle.daemon=false &gt;&gt; "%USERPROFILE%/.gradle/gradle.properties")</code></pre>
</div>
</div>
<div class="paragraph">
<p>On UNIX-like operating systems, the following Bash shell command will disable the Daemon for the current user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mkdir -p ~/.gradle &amp;&amp; echo &quot;org.gradle.daemon=false&quot; &gt;&gt; ~/.gradle/gradle.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the Daemon is disabled for a build environment in this way, a Gradle Daemon will not be started unless explicitly requested using the <code>--daemon</code> option.</p>
</div>
<div class="paragraph">
<p>The <code>--daemon</code> and <code>--no-daemon</code> command line options enable and disable usage of the Daemon for individual build invocations when using the Gradle command line interface. These command line options have the <em>highest</em> precedence when considering the build environment. Typically, it is more convenient to enable the Daemon for an environment (e.g. a user account) so that all builds use the Daemon without requiring to remember to supply the <code>--daemon</code> option.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:why_is_there_more_than_one_daemon_process_on_my_machine"><a class="anchor" href="#sec:why_is_there_more_than_one_daemon_process_on_my_machine"></a><a class="link" href="#sec:why_is_there_more_than_one_daemon_process_on_my_machine">Why is there more than one Daemon process on my machine?</a></h5>
<div class="paragraph">
<p>There are several reasons why Gradle will create a new Daemon, instead of using one that is already running. The basic rule is that Gradle will start a new Daemon if there are no existing idle or compatible Daemons available. Gradle will kill any Daemon that has been idle for 3 hours or more, so you don&#8217;t have to worry about cleaning them up manually.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">idle</dt>
<dd>
<p>An idle Daemon is one that is not currently executing a build or doing other useful work.</p>
</dd>
<dt class="hdlist1">compatible</dt>
<dd>
<p>A compatible Daemon is one that can (or can be made to) meet the requirements of the requested build environment. The Java runtime used to execute the build is an example aspect of the build environment. Another example is the set of JVM system properties required by the build runtime.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Some aspects of the requested build environment may not be met by an Daemon. If the Daemon is running with a Java 8 runtime, but the requested environment calls for Java 10, then the Daemon is not compatible and another must be started. Moreover, certain properties of a Java runtime cannot be changed once the JVM has started. For example, it is not possible to change the memory allocation (e.g. <code>-Xmx1024m</code>), default text encoding, default locale, etc of a running JVM.</p>
</div>
<div class="paragraph">
<p>The requested build environment is typically constructed implicitly from aspects of the build clients (e.g. Gradle command line client, IDE etc.) environment and explicitly via command line switches and settings. See <a href="#build_environment">Build Environment</a> for details on how to specify and control the build environment.</p>
</div>
<div class="paragraph">
<p>The following JVM system properties are effectively immutable. If the requested build environment requires any of these properties, with a different value than a Daemons JVM has for this property, the Daemon is not compatible.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>file.encoding</p>
</li>
<li>
<p>user.language</p>
</li>
<li>
<p>user.country</p>
</li>
<li>
<p>user.variant</p>
</li>
<li>
<p>java.io.tmpdir</p>
</li>
<li>
<p>javax.net.ssl.keyStore</p>
</li>
<li>
<p>javax.net.ssl.keyStorePassword</p>
</li>
<li>
<p>javax.net.ssl.keyStoreType</p>
</li>
<li>
<p>javax.net.ssl.trustStore</p>
</li>
<li>
<p>javax.net.ssl.trustStorePassword</p>
</li>
<li>
<p>javax.net.ssl.trustStoreType</p>
</li>
<li>
<p>com.sun.management.jmxremote</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following JVM attributes, controlled by startup arguments, are also effectively immutable. The corresponding attributes of the requested build environment and the Daemons environment must match exactly in order for a Daemon to be compatible.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The maximum heap size (i.e. the -Xmx JVM argument)</p>
</li>
<li>
<p>The minimum heap size (i.e. the -Xms JVM argument)</p>
</li>
<li>
<p>The boot classpath (i.e. the -Xbootclasspath argument)</p>
</li>
<li>
<p>The assertion status (i.e. the -ea argument)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The required Gradle version is another aspect of the requested build environment. Daemon processes are coupled to a specific Gradle runtime. Working on multiple Gradle projects during a session that use different Gradle versions is a common reason for having more than one running Daemon process.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:how_much_memory_does_the_daemon_use_and_can_i_give_it_more"><a class="anchor" href="#sec:how_much_memory_does_the_daemon_use_and_can_i_give_it_more"></a><a class="link" href="#sec:how_much_memory_does_the_daemon_use_and_can_i_give_it_more">How much memory does the Daemon use and can I give it more?</a></h5>
<div class="paragraph">
<p>If the requested build environment does not specify a maximum heap size, the Daemon will use up to 512MB of heap. It will use the JVM&#8217;s default minimum heap size. 512MB is more than enough for most builds. Larger builds with hundreds of subprojects, lots of configuration, and source code may require, or perform better, with more memory.</p>
</div>
<div class="paragraph">
<p>To increase the amount of memory the Daemon can use, specify the appropriate flags as part of the requested build environment. Please see <a href="#build_environment">Build Environment</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:how_can_i_stop_a_daemon"><a class="anchor" href="#sec:how_can_i_stop_a_daemon"></a><a class="link" href="#sec:how_can_i_stop_a_daemon">How can I stop a Daemon?</a></h5>
<div class="paragraph">
<p>Daemon processes will automatically terminate themselves after 3 hours of inactivity or less. If you wish to stop a Daemon process before this, you can either kill the process via your operating system or run the <code>gradle --stop</code> command. The <code>--stop</code> switch causes Gradle to request that <em>all</em> running Daemon processes, <em>of the same Gradle version used to run the command</em>, terminate themselves.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:what_can_go_wrong_with_daemon"><a class="anchor" href="#sec:what_can_go_wrong_with_daemon"></a><a class="link" href="#sec:what_can_go_wrong_with_daemon">What can go wrong with Daemon?</a></h5>
<div class="paragraph">
<p>Considerable engineering effort has gone into making the Daemon robust, transparent and unobtrusive during day to day development. However, Daemon processes can occasionally be corrupted or exhausted. A Gradle build executes arbitrary code from multiple sources. While Gradle itself is designed for and heavily tested with the Daemon, user build scripts and third party plugins can destabilize the Daemon process through defects such as memory leaks or global state corruption.</p>
</div>
<div class="paragraph">
<p>It is also possible to destabilize the Daemon (and build environment in general) by running builds that do not release resources correctly. This is a particularly poignant problem when using Microsoft Windows as it is less forgiving of programs that fail to close files after reading or writing.</p>
</div>
<div class="paragraph">
<p>Gradle actively monitors heap usage and attempts to detect when a leak is starting to exhaust the available heap space in the daemon. When it detects a problem, the Gradle daemon will finish the currently running build and proactively restart the daemon on the next build. This monitoring is enabled by default, but can be disabled by setting the <code>org.gradle.daemon.performance.enable-monitoring</code> system property to false.</p>
</div>
<div class="paragraph">
<p>If it is suspected that the Daemon process has become unstable, it can simply be killed. Recall that the <code>--no-daemon</code> switch can be specified for a build to prevent use of the Daemon. This can be useful to diagnose whether or not the Daemon is actually the culprit of a problem.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:tools_and_ides"><a class="anchor" href="#sec:tools_and_ides"></a><a class="link" href="#sec:tools_and_ides">Tools &amp; IDEs</a></h4>
<div class="paragraph">
<p>The <a href="#embedding">Gradle Tooling API</a> that is used by IDEs and other tools to integrate with Gradle <em>always</em> uses the Gradle Daemon to execute builds. If you are executing Gradle builds from within your IDE you are using the Gradle Daemon and do not need to enable it for your environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:how_does_the_gradle_daemon_make_builds_faster"><a class="anchor" href="#sec:how_does_the_gradle_daemon_make_builds_faster"></a><a class="link" href="#sec:how_does_the_gradle_daemon_make_builds_faster">How does the Gradle Daemon make builds faster?</a></h4>
<div class="paragraph">
<p>The Gradle Daemon is a <em>long lived</em> build process. In between builds it waits idly for the next build. This has the obvious benefit of only requiring Gradle to be loaded into memory once for multiple builds, as opposed to once for each build. This in itself is a significant performance optimization, but that&#8217;s not where it stops.</p>
</div>
<div class="paragraph">
<p>A significant part of the story for modern JVM performance is runtime code optimization. For example, HotSpot (the JVM implementation provided by Oracle and used as the basis of OpenJDK) applies optimization to code while it is running. The optimization is progressive and not instantaneous. That is, the code is progressively optimized during execution which means that subsequent builds can be faster purely due to this optimization process. Experiments with HotSpot have shown that it takes somewhere between 5 and 10 builds for optimization to stabilize. The difference in perceived build time between the first build and the 10th for a Daemon can be quite dramatic.</p>
</div>
<div class="paragraph">
<p>The Daemon also allows more effective in memory caching across builds. For example, the classes needed by the build (e.g. plugins, build scripts) can be held in memory between builds. Similarly, Gradle can maintain in-memory caches of build data such as the hashes of task inputs and outputs, used for incremental building.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="init_scripts"><a class="anchor" href="#init_scripts"></a><a class="link" href="#init_scripts">Initialization Scripts</a></h3>
<div class="paragraph">
<p>Gradle provides a powerful mechanism to allow customizing the build based on the current environment. This mechanism also supports tools that wish to integrate with Gradle.</p>
</div>
<div class="paragraph">
<p>Note that this is completely different from the <code>init</code> task provided by the <code>build-init</code> plugin (see <a href="#build_init_plugin">Build Init Plugin</a>).</p>
</div>
<div class="sect3">
<h4 id="sec:basic_usage"><a class="anchor" href="#sec:basic_usage"></a><a class="link" href="#sec:basic_usage">Basic usage</a></h4>
<div class="paragraph">
<p>Initialization scripts (a.k.a. <em>init scripts</em>) are similar to other scripts in Gradle. These scripts, however, are run before the build starts. Here are several possible uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up enterprise-wide configuration, such as where to find custom plugins.</p>
</li>
<li>
<p>Set up properties based on the current environment, such as a developer&#8217;s machine vs. a continuous integration server.</p>
</li>
<li>
<p>Supply personal information about the user that is required by the build, such as repository or database authentication credentials.</p>
</li>
<li>
<p>Define machine specific details, such as where JDKs are installed.</p>
</li>
<li>
<p>Register build listeners. External tools that wish to listen to Gradle events might find this useful.</p>
</li>
<li>
<p>Register build loggers. You might wish to customize how Gradle logs the events that it generates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One main limitation of init scripts is that they cannot access classes in the <code>buildSrc</code> project (see <a href="#sec:build_sources">Using buildSrc to extract imperative logic</a> for details of this feature).</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_an_init_script"><a class="anchor" href="#sec:using_an_init_script"></a><a class="link" href="#sec:using_an_init_script">Using an init script</a></h4>
<div class="paragraph">
<p>There are several ways to use an init script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify a file on the command line. The command line option is <code>-I</code> or <code>--init-script</code> followed by the path to the script. The command line option can appear more than once, each time adding another init script. The build will fail if any of the files specified on the command line does not exist.</p>
</li>
<li>
<p>Put a file called <code>init.gradle</code> (or <code>init.gradle.kts</code> for Kotlin) in the <code><em>USER_HOME</em>/.gradle/</code> directory.</p>
</li>
<li>
<p>Put a file that ends with <code>.gradle</code> (or <code>.init.gradle.kts</code> for Kotlin) in the <code><em>USER_HOME</em>/.gradle/init.d/</code> directory.</p>
</li>
<li>
<p>Put a file that ends with <code>.gradle</code> (or <code>.init.gradle.kts</code> for Kotlin) in the <code><em>GRADLE_HOME</em>/init.d/</code> directory, in the Gradle distribution. This allows you to package up a custom Gradle distribution containing some custom build logic and plugins. You can combine this with the <a href="#gradle_wrapper">Gradle wrapper</a> as a way to make custom logic available to all builds in your enterprise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If more than one init script is found they will all be executed, in the order specified above. Scripts in a given directory are executed in alphabetical order. This allows, for example, a tool to specify an init script on the command line and the user to put one in their home directory for defining the environment and both scripts will run when Gradle is executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:writing_an_init_script"><a class="anchor" href="#sec:writing_an_init_script"></a><a class="link" href="#sec:writing_an_init_script">Writing an init script</a></h4>
<div class="paragraph">
<p>Similar to a Gradle build script, an init script is a Groovy or Kotlin script. Each init script has a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a> instance associated with it. Any property reference and method call in the init script will delegate to this <code>Gradle</code> instance.</p>
</div>
<div class="paragraph">
<p>Each init script also implements the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Script.html">Script</a> interface.</p>
</div>
<div class="sect4">
<h5 id="sec:configuring_projects_from_an_init_script"><a class="anchor" href="#sec:configuring_projects_from_an_init_script"></a><a class="link" href="#sec:configuring_projects_from_an_init_script">Configuring projects from an init script</a></h5>
<div class="paragraph">
<p>You can use an init script to configure the projects in the build. This works in a similar way to configuring projects in a multi-project build. The following sample shows how to perform extra configuration from an init script <em>before</em> the projects are evaluated. This sample uses this feature to configure an extra repository to be used only for certain environments.</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Using init script to perform extra configuration before projects are evaluated</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

task showRepos {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">All repos:</span><span class="delimiter">&quot;</span></span>
        println repositories.collect { <span class="local-variable">it</span>.name }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    repositories {
        mavenLocal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

tasks.register(&quot;showRepos&quot;) {
    doLast {
        println(&quot;All repos:&quot;)
        //TODO:kotlin-dsl remove filter once we're no longer on a kotlin eap
        println(repositories.map { it.name }.filter { it != &quot;maven&quot; })
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    repositories {
        mavenLocal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="output_when_applying_the_init_script"><a class="anchor" href="#output_when_applying_the_init_script"></a><a class="link" href="#output_when_applying_the_init_script">Output when applying the init script</a></h6>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q showRepos
All <span class="key">repos</span>:
[MavenLocal, MavenRepo]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q showRepos
All repos:
[MavenLocal, MavenRepo]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_classpath"><a class="anchor" href="#sec:custom_classpath"></a><a class="link" href="#sec:custom_classpath">External dependencies for the init script</a></h4>
<div class="paragraph">
<p>In <a href="#sec:build_script_external_dependencies">External dependencies for the build script</a> it was explained how to add external dependencies to a build script. Init scripts can also declare dependencies. You do this with the <code>initscript()</code> method, passing in a closure which declares the init script classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Declaring external dependencies for an init script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-math:2.0</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;org.apache.commons:commons-math:2.0&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The closure passed to the <code>initscript()</code> method configures a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/initialization/dsl/ScriptHandler.html">ScriptHandler</a> instance.
You declare the init script classpath by adding dependencies to the <code>classpath</code> configuration.
This is the same way you declare, for example, the Java compilation classpath.
You can use any of the dependency types described in <a href="#">Declaring Dependencies</a>, except project dependencies.</p>
</div>
<div class="paragraph">
<p>Having declared the init script classpath, you can use the classes in your init script as you would any other classes on the classpath. The following example adds to the previous example, and uses classes from the init script classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. An init script with external dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.math.fraction.Fraction</span>

initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-math:2.0</span><span class="delimiter">'</span></span>
    }
}

println Fraction.ONE_FIFTH.multiply(<span class="integer">2</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.commons.math.fraction.Fraction

initscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;org.apache.commons:commons-math:2.0&quot;)
    }
}

println(Fraction.ONE_FIFTH.multiply(2))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Output when applying the init script</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q doNothing
<span class="integer">2</span> / <span class="integer">5</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q doNothing
2 / 5</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:init_script_plugins"><a class="anchor" href="#sec:init_script_plugins"></a><a class="link" href="#sec:init_script_plugins">Init script plugins</a></h4>
<div class="paragraph">
<p>Similar to a Gradle build script or a Gradle settings file, plugins can be applied on init scripts.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Using plugins in init scripts</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: EnterpriseRepositoryPlugin

<span class="type">class</span> <span class="class">EnterpriseRepositoryPlugin</span> <span class="directive">implements</span> Plugin&lt;Gradle&gt; {

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> ENTERPRISE_REPOSITORY_URL = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.gradle.org/gradle/repo</span><span class="delimiter">&quot;</span></span>

    <span class="type">void</span> apply(Gradle gradle) {
        <span class="comment">// ONLY USE ENTERPRISE REPO FOR DEPENDENCIES</span>
        gradle.allprojects { project -&gt;
            project.repositories {

                <span class="comment">// Remove all repositories not pointing to the enterprise repository url</span>
                all { ArtifactRepository repo -&gt;
                    <span class="keyword">if</span> (!(repo <span class="keyword">instanceof</span> MavenArtifactRepository) ||
                          repo.url.toString() != ENTERPRISE_REPOSITORY_URL) {
                        project.logger.lifecycle <span class="string"><span class="delimiter">&quot;</span><span class="content">Repository </span><span class="inline"><span class="inline-delimiter">${</span>repo.url<span class="inline-delimiter">}</span></span><span class="content"> removed. Only </span><span class="inline"><span class="inline-delimiter">$</span>ENTERPRISE_REPOSITORY_URL</span><span class="content"> is allowed</span><span class="delimiter">&quot;</span></span>
                        remove repo
                    }
                }

                <span class="comment">// add the enterprise repository</span>
                maven {
                    name <span class="string"><span class="delimiter">&quot;</span><span class="content">STANDARD_ENTERPRISE_REPO</span><span class="delimiter">&quot;</span></span>
                    url ENTERPRISE_REPOSITORY_URL
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories{
    mavenCentral()
}

 task showRepositories {
     doLast {
         repositories.each {
             println <span class="string"><span class="delimiter">&quot;</span><span class="content">repository: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.name<span class="inline-delimiter">}</span></span><span class="content"> ('</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.url<span class="inline-delimiter">}</span></span><span class="content">')</span><span class="delimiter">&quot;</span></span>
         }
     }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply&lt;EnterpriseRepositoryPlugin&gt;()

class EnterpriseRepositoryPlugin : Plugin&lt;Gradle&gt; {
    companion object {
        const val ENTERPRISE_REPOSITORY_URL = &quot;https://repo.gradle.org/gradle/repo&quot;
    }

    override fun apply(gradle: Gradle) {
        // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
        gradle.allprojects {
            repositories {

                // Remove all repositories not pointing to the enterprise repository url
                all {
                    if (this !is MavenArtifactRepository || url.toString() != ENTERPRISE_REPOSITORY_URL) {
                        project.logger.lifecycle(&quot;Repository ${(this as? MavenArtifactRepository)?.url ?: name} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed&quot;)
                        remove(this)
                    }
                }

                // add the enterprise repository
                add(maven {
                    name = &quot;STANDARD_ENTERPRISE_REPO&quot;
                    url = uri(ENTERPRISE_REPOSITORY_URL)
                })
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories{
    mavenCentral()
}

tasks.register(&quot;showRepositories&quot;) {
    doLast {
        repositories.map { it as MavenArtifactRepository }.forEach {
            println(&quot;repository: ${it.name} ('${it.url}')&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Output when applying the init script</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle --init-script init.gradle -q showRepositories
<span class="key">repository</span>: STANDARD_ENTERPRISE_REPO (<span class="string"><span class="delimiter">'</span><span class="content">https://repo.gradle.org/gradle/repo</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle --init-script init.gradle.kts -q showRepositories
repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin in the init script ensures that only a specified repository is used when running the build.</p>
</div>
<div class="paragraph">
<p>When applying plugins within the init script, Gradle instantiates the plugin and calls the plugin instance&#8217;s <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply(T)</a> method. The <code>gradle</code> object is passed as a parameter, which can be used to configure all aspects of a build. Of course, the applied plugin can be resolved as an external dependency as described in <a href="#sec:custom_classpath">External dependencies for the init script</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intro_multi_project_builds"><a class="anchor" href="#intro_multi_project_builds"></a><a class="link" href="#intro_multi_project_builds">Executing Multi-Project Builds</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The Gradle Build Cache can help reduce build time of multi project builds by up to 90%. <a href="https://gradle.com/training/build-cache-deep-dive/?bid=docs-multi-project-builds">Register here</a> for our live Build Cache training session to learn how.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Only the smallest of projects has a single build file and source tree, unless it happens to be a massive, monolithic application. Its often much easier to digest and understand a project that has been split into smaller, inter-dependent modules. The word inter-dependent is important, though, and is why you typically want to link the modules together through a single build.</p>
</div>
<div class="paragraph">
<p>Gradle supports this scenario through <em>multi-project</em> builds.</p>
</div>
<div class="sect3">
<h4 id="sec:structure_of_a_multiproject_build"><a class="anchor" href="#sec:structure_of_a_multiproject_build"></a><a class="link" href="#sec:structure_of_a_multiproject_build">Structure of a multi-project build</a></h4>
<div class="paragraph">
<p>Such builds come in all shapes and sizes, but they do have some common characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>settings.gradle</code> file in the root or <code>master</code> directory of the project</p>
</li>
<li>
<p>A <code>build.gradle</code> file in the root or <code>master</code> directory</p>
</li>
<li>
<p>Child directories that have their own <code>*.gradle</code> build files (some multi-project builds may omit child project build scripts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>settings.gradle</code> file tells Gradle how the project and subprojects are structured. Fortunately, you dont have to read this file simply to learn what the project structure is as you can run the command <code>gradle projects</code>. Here&#8217;s the output from using that command on the Java <em>multiproject</em> build in the Gradle samples:</p>
</div>
<div class="sect4">
<h5 id="example_listing_the_projects_in_a_build"><a class="anchor" href="#example_listing_the_projects_in_a_build"></a><a class="link" href="#example_listing_the_projects_in_a_build">Example: Listing the projects in a build</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q projects</code></strong></div>
<div class="content">
<pre>&gt; gradle -q projects

------------------------------------------------------------
Root project
------------------------------------------------------------

Root project 'multiproject'
+--- Project ':api'
+--- Project ':services'
|    +--- Project ':services:shared'
|    \--- Project ':services:webservice'
\--- Project ':shared'

To see a list of the tasks of a project, run gradle &lt;project-path&gt;:tasks
For example, try running gradle :api:tasks</pre>
</div>
</div>
<div class="paragraph">
<p>This tells you that <em>multiproject</em> has three immediate child projects: <em>api</em>, <em>services</em> and <em>shared</em>. The <em>services</em> project then has its own children, <em>shared</em> and <em>webservice</em>. These map to the directory structure, so its easy to find them. For example, you can find <em>webservice</em> in <code>&lt;root&gt;/services/webservice</code>.</p>
</div>
<div class="paragraph">
<p>By default, Gradle uses the name of the directory in which it finds the <code>settings.gradle</code> as the name of the root project. This usually doesn&#8217;t cause problems since all developers check out the same directory name when working on a project. On Continuous Integration servers, like Jenkins, the directory name may be auto-generated and not match the name in your VCS. For that reason, it&#8217;s recommended that you always set the root project name to something predictable, even in single project builds. You can configure the root project name by setting <code>rootProject.name</code>.</p>
</div>
<div class="paragraph">
<p>Each project will usually have its own build file, but that&#8217;s not necessarily the case. In the above example, the <em>services</em> project is just a container or grouping of other subprojects. There is no build file in the corresponding directory. However, <em>multiproject</em> does have one for the root project.</p>
</div>
<div class="paragraph">
<p>The root <code>build.gradle</code> is often used to share common configuration between the child projects, for example by applying the same sets of plugins and dependencies to all the child projects. It can also be used to configure individual subprojects when it is preferable to have all the configuration in one place. This means you should always check the root build file when discovering how a particular subproject is being configured.</p>
</div>
<div class="paragraph">
<p>Another thing to bear in mind is that the build files might not be called <code>build.gradle</code>. Many projects will name the build files after the subproject names, such as <code>api.gradle</code> and <code>services.gradle</code> from the previous example. Such an approach helps a lot in IDEs because its tough to work out which <code>build.gradle</code> file out of twenty possibilities is the one you want to open. This little piece of magic is handled by the <code>settings.gradle</code> file, but as a build user you dont need to know the details of how its done. Just have a look through the child project directories to find the files with the <code>.gradle</code> suffix.</p>
</div>
<div class="paragraph">
<p>Once you know what subprojects are available, the key question for a build user is how to execute the tasks within the project.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:executing_a_multiproject_build"><a class="anchor" href="#sec:executing_a_multiproject_build"></a><a class="link" href="#sec:executing_a_multiproject_build">Executing a multi-project build</a></h4>
<div class="paragraph">
<p>From a user&#8217;s perspective, multi-project builds are still collections of tasks you can run. The difference is that you may want to control <em>which</em> project&#8217;s tasks get executed. You have two options here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change to the directory corresponding to the subproject youre interested in and just execute <code>gradle &lt;task&gt;</code> as normal.</p>
</li>
<li>
<p>Use a qualified task name from any directory, although this is usually done from the root. For example: <code>gradle :services:webservice:build</code> will build the <em>webservice</em> subproject and any subprojects it depends on.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first approach is similar to the single-project use case, but Gradle works slightly differently in the case of a multi-project build. The command <code>gradle test</code> will execute the <code>test</code> task in any subprojects, relative to the current working directory, that have that task. So if you run the command from the root project directory, youll run <code>test</code> in <em>api</em>, <em>shared</em>, <em>services:shared</em> and <em>services:webservice</em>. If you run the command from the services project directory, youll only execute the task in <em>services:shared</em> and <em>services:webservice</em>.</p>
</div>
<div class="paragraph">
<p>For more control over what gets executed, use qualified names (the second approach mentioned). These are paths just like directory paths, but use : instead of / or \. If the path begins with a :, then the path is resolved relative to the root project. In other words, the leading : represents the root project itself. All other colons are path separators.</p>
</div>
<div class="paragraph">
<p>This approach works for any task, so if you want to know what tasks are in a particular subproject, just use the <code>tasks</code> task, e.g. <code>gradle :services:webservice:tasks</code> .</p>
</div>
<div class="paragraph">
<p>Regardless of which technique you use to execute tasks, Gradle will take care of building any subprojects that the target depends on. You dont have to worry about the inter-project dependencies yourself. If youre interested in how this is configured, you can read about writing multi-project builds <a href="#multi_project_builds">later in the user manual</a>.</p>
</div>
<div class="paragraph">
<p>Theres one last thing to note. When youre using the Gradle wrapper, the first approach doesnt work well because you have to specify the path to the wrapper script if youre not in the project root. For example, if youre in the <em>webservice</em> subproject directory, you would have to run <code>../../gradlew build</code>.</p>
</div>
<div class="paragraph">
<p>Thats all you really need to know about multi-project builds as a build user. You can now identify whether a build is a multi-project one and you can discover its structure. And finally, you can execute tasks within specific subprojects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_cache"><a class="anchor" href="#build_cache"></a><a class="link" href="#build_cache">Build Cache</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Want to learn the tips and tricks top engineering teams use to keep builds fast and performant? <a href="https://gradle.com/training/build-cache-deep-dive/?bid=docs-build-cache">Register here</a> for our Build Cache Training.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The build cache feature described here is different from the <a href="https://developer.android.com/studio/build/build-cache.html">Android plugin build cache</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:build_cache_intro"><a class="anchor" href="#sec:build_cache_intro"></a><a class="link" href="#sec:build_cache_intro">Overview</a></h4>
<div class="paragraph">
<p>The Gradle <em>build cache</em> is a cache mechanism that aims to save time by reusing outputs produced by other builds.
The build cache works by storing (locally or remotely) build outputs and allowing builds to fetch these outputs from the cache when it is determined that inputs have not changed, avoiding the expensive work of regenerating them.</p>
</div>
<div class="paragraph">
<p>A first feature using the build cache is <em>task output caching</em>.
Essentially, task output caching leverages the same intelligence as <a href="#sec:up_to_date_checks">up-to-date checks</a> that Gradle uses to avoid work when a previous local build has already produced a set of task outputs.
But instead of being limited to the previous build in the same workspace, task output caching allows Gradle to reuse task outputs from any earlier build in any location on the local machine.
When using a shared build cache for task output caching this even works across developer machines and build agents.</p>
</div>
<div class="paragraph">
<p>Apart from tasks, <a href="#sec:abm_artifact_transforms">artifact transforms</a> can also leverage the build cache and re-use their outputs similarly to task output caching.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For a hands-on approach to learning how to use the build cache, try the <a href="https://guides.gradle.org/using-build-cache/">Using the Build Cache</a> guide. It covers the different scenarios that caching can improve and has detailed discussions of the different caveats you need to be aware of when enabling caching for a build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_enable"><a class="anchor" href="#sec:build_cache_enable"></a><a class="link" href="#sec:build_cache_enable">Enable the Build Cache</a></h4>
<div class="paragraph">
<p>By default, the build cache is not enabled. You can enable the build cache in a couple of ways:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Run with <code>--build-cache</code> on the command-line</dt>
<dd>
<p>Gradle will use the build cache for this build only.</p>
</dd>
<dt class="hdlist1">Put <code>org.gradle.caching=true</code> in your <code>gradle.properties</code></dt>
<dd>
<p>Gradle will try to reuse outputs from previous builds for all builds, unless explicitly disabled with <code>--no-build-cache</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When the build cache is enabled, it will store build outputs in the Gradle user home.
For configuring this directory or different kinds of build caches see <a href="#sec:build_cache_configure">Configure the Build Cache</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_output_caching"><a class="anchor" href="#sec:task_output_caching"></a><a class="link" href="#sec:task_output_caching">Task Output Caching</a></h4>
<div class="paragraph">
<p>Beyond incremental builds described in <a href="#sec:up_to_date_checks">up-to-date checks</a>, Gradle can save time by reusing outputs from previous executions of a task by matching inputs to the task.
Task outputs can be reused between builds on one computer or even between builds running on different computers via a build cache.</p>
</div>
<div class="paragraph">
<p>We have focused on the use case where users have an organization-wide remote build cache that is populated regularly by continuous integration builds.
Developers and other continuous integration agents should load cache entries from the remote build cache.
We expect that developers will not be allowed to populate the remote build cache, and all continuous integration builds populate the build cache after running the <code>clean</code> task.</p>
</div>
<div class="paragraph">
<p>For your build to play well with task output caching it must work well with the <a href="#sec:up_to_date_checks">incremental build</a> feature.
For example, when running your build twice in a row all tasks with outputs should be <code>UP-TO-DATE</code>.
You cannot expect faster builds or correct builds when enabling task output caching when this prerequisite is not met.</p>
</div>
<div class="paragraph">
<p>Task output caching is automatically enabled when you enable the build cache, see <a href="#sec:build_cache_enable">Enable the Build Cache</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_example"><a class="anchor" href="#sec:task_output_caching_example"></a><a class="link" href="#sec:task_output_caching_example">What does it look like</a></h5>
<div class="paragraph">
<p>Let us start with a project using the Java plugin which has a few Java source files. We run the build the first time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle --build-cache compileJava
:compileJava
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>We see the directory used by the local build cache in the output. Apart from that the build was the same as without the build cache.
Let&#8217;s clean and run the build again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle clean
:clean

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle --build-cache assemble
:compileJava FROM-CACHE
:processResources
:classes
:jar
:assemble

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Now we see that, instead of executing the <code>:compileJava</code> task, the outputs of the task have been loaded from the build cache.
The other tasks have not been loaded from the build cache since they are not cacheable. This is due to
<code>:classes</code> and <code>:assemble</code> being <a href="#sec:lifecycle_tasks">lifecycle tasks</a> and <code>:processResources</code>
and <code>:jar</code> being Copy-like tasks which are not cacheable since it is generally faster to execute them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_output_caching_details"><a class="anchor" href="#sec:task_output_caching_details"></a><a class="link" href="#sec:task_output_caching_details">Cacheable tasks</a></h4>
<div class="paragraph">
<p>Since a task describes all of its inputs and outputs, Gradle can compute a <em>build cache key</em> that uniquely defines the task&#8217;s outputs based on its inputs.
That build cache key is used to request previous outputs from a build cache or store new outputs in the build cache.
If the previous build outputs have been already stored in the cache by someone else, e.g. your continuous integration server or other developers, you can avoid executing most tasks locally.</p>
</div>
<div class="paragraph">
<p>The following inputs contribute to the build cache key for a task in the same way that they do for <a href="#sec:how_does_it_work">up-to-date checks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The task type and its classpath</p>
</li>
<li>
<p>The names of the output properties</p>
</li>
<li>
<p>The names and values of properties annotated as described in <a href="#sec:task_input_output_annotations">the section called "Custom task types"</a></p>
</li>
<li>
<p>The names and values of properties added by the DSL via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html">TaskInputs</a></p>
</li>
<li>
<p>The classpath of the Gradle distribution, buildSrc and plugins</p>
</li>
<li>
<p>The content of the build script when it affects execution of the task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Task types need to opt-in to task output caching using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> annotation.
Note that <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> is not inherited by subclasses.
Custom task types are <em>not</em> cacheable by default.</p>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_cacheable_tasks"><a class="anchor" href="#sec:task_output_caching_cacheable_tasks"></a><a class="link" href="#sec:task_output_caching_cacheable_tasks">Built-in cacheable tasks</a></h5>
<div class="paragraph">
<p>Currently, the following built-in Gradle tasks are cacheable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java toolchain:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Javadoc.html">Javadoc</a></p>
</li>
<li>
<p>Groovy toolchain:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Groovydoc.html">Groovydoc</a></p>
</li>
<li>
<p>Scala toolchain:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a>,
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/scala/tasks/PlatformScalaCompile.html">PlatformScalaCompile</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaDoc.html">ScalaDoc</a></p>
</li>
<li>
<p>Native toolchain:
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/cpp/tasks/CppCompile.html">CppCompile</a>,
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/c/tasks/CCompile.html">CCompile</a>,
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/swift/tasks/SwiftCompile.html">SwiftCompile</a></p>
</li>
<li>
<p>Testing:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a></p>
</li>
<li>
<p>Code quality tasks:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CodeNarc.html">CodeNarc</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Pmd.html">Pmd</a></p>
</li>
<li>
<p>JaCoCo:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoMerge.html">JacocoMerge</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html">JacocoReport</a></p>
</li>
<li>
<p>Other tasks:
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a>,
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/tasks/ValidatePlugins.html">ValidatePlugins</a>,
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.WriteProperties.html">WriteProperties</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All other built-in tasks are currently not cacheable.</p>
</div>
<div class="paragraph">
<p>Some tasks, like <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, usually do not make sense to make cacheable because Gradle is only copying files from one location to another.
It also doesn&#8217;t make sense to make tasks cacheable that do not produce outputs or have no task actions.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_cacheable_3rd_party"><a class="anchor" href="#sec:task_output_caching_cacheable_3rd_party"></a><a class="link" href="#sec:task_output_caching_cacheable_3rd_party">Third party plugins</a></h5>
<div class="paragraph">
<p>There are third party plugins that work well with the build cache.
The most prominent examples are the <a href="https://developer.android.com/studio/releases/gradle-plugin.html">Android plugin 3.1+</a> and the <a href="https://blog.gradle.org/kotlin-build-cache-use">Kotlin plugin 1.2.21+</a>.
For other third party plugins, check their documentation to find out whether they support the build cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_output_caching_inputs"><a class="anchor" href="#sec:task_output_caching_inputs"></a><a class="link" href="#sec:task_output_caching_inputs">Declaring task inputs and outputs</a></h5>
<div class="paragraph">
<p>It is very important that a cacheable task has a complete picture of its inputs and outputs, so that the results from one build can be safely re-used somewhere else.</p>
</div>
<div class="paragraph">
<p>Missing task inputs can cause incorrect cache hits, where different results are treated as identical because the same cache key is used by both executions.
Missing task outputs can cause build failures if Gradle does not completely capture all outputs for a given task.
Wrongly declared task inputs can lead to cache misses especially when containing volatile data or absolute paths.
(See <a href="#sec:task_inputs_outputs">the section called "Task inputs and outputs"</a> on what should be declared as inputs and outputs.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The task path is <em>not</em> an input to the build cache key.
This means that tasks with different task paths can re-use each other&#8217;s outputs as long as Gradle determines that executing them yields the same result.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to ensure that the inputs and outputs are properly declared use integration tests (for example using TestKit) to check that a task produces the same outputs for identical inputs and captures all output files for the task.
We suggest adding tests to ensure that the task inputs are relocatable, i.e. that the task can be loaded from the cache into a different build directory (see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/PathSensitive.html">@PathSensitive</a>).</p>
</div>
<div class="paragraph">
<p>In order to handle volatile inputs for your tasks consider <a href="#sec:configure_input_normalization">configuring input normalization</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable_caching_of_non_cacheable_tasks"><a class="anchor" href="#enable_caching_of_non_cacheable_tasks"></a><a class="link" href="#enable_caching_of_non_cacheable_tasks">Enable caching of non-cacheable tasks</a></h4>
<div class="paragraph">
<p>As we have seen, built-in tasks, or tasks provided by plugins, are cacheable if their class is annotated with the <code>Cacheable</code> annotation.
But what if you want to make cacheable a task whose class is not cacheable?
Let&#8217;s take a concrete example: your build script uses a generic <code>NpmTask</code> task to create a JavaScript bundle by delegating to NPM (and running <code>npm run bundle</code>).
This process is similar to a complex compilation task, but <code>NpmTask</code> is too generic to be cacheable by default: it just takes arguments and runs npm with those arguments.</p>
</div>
<div class="paragraph">
<p>The inputs and outputs of this task are simple to figure out.
The inputs are the directory containing the JavaScript files, and the NPM configuration files.
The output is the bundle file generated by this task.</p>
</div>
<div class="sect4">
<h5 id="using_annotations"><a class="anchor" href="#using_annotations"></a><a class="link" href="#using_annotations">Using annotations</a></h5>
<div class="paragraph">
<p>We create a subclass of the <code>NpmTask</code> and use <a href="#sec:task_input_output_annotations">annotations to declare the inputs and outputs</a>.</p>
</div>
<div class="paragraph">
<p>When possible, it is better to use delegation instead of creating a subclass.
That is the case for the built in <code>JavaExec</code>, <code>Exec</code>, <code>Copy</code> and <code>Sync</code> tasks, which have a method on <code>Project</code> to do the actual work.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re a modern JavaScript developer, you know that bundling can be quite long, and is worth caching.
To achieve that, we need to tell Gradle that it&#8217;s allowed to cache the output of that task, using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/CacheableTask.html">@CacheableTask</a> annotation.</p>
</div>
<div class="paragraph">
<p>This is sufficient to make the task cacheable on your own machine.
However, input files are identified by default by their absolute path.
So if the cache needs to be shared between several developers or machines using different paths, that won&#8217;t work as expected.
So we also need to set the <a href="https://guides.gradle.org/using-build-cache/#relocatability">path sensitivity</a>.
In this case, the relative path of the input files can be used to identify them.</p>
</div>
<div class="paragraph">
<p>Note that it is possible to override property annotations from the base class by overriding the getter of the base class and annotating that method.</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Custom cacheable BundleTask</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableTask</span>                                       // <b class="conum">(1)</b>
<span class="type">class</span> <span class="class">BundleTask</span> <span class="directive">extends</span> NpmTask {

    <span class="annotation">@Override</span> <span class="annotation">@Internal</span>                              // <b class="conum">(2)</b>
    ListProperty&lt;<span class="predefined-type">String</span>&gt; getArgs() {
        <span class="local-variable">super</span>.getArgs()
    }

    <span class="annotation">@InputDirectory</span>
    <span class="annotation">@SkipWhenEmpty</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)         // <b class="conum">(3)</b>
    <span class="directive">final</span> DirectoryProperty scripts = project.objects.directoryProperty()

    <span class="annotation">@InputFiles</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)         // <b class="conum">(4)</b>
    <span class="directive">final</span> ConfigurableFileCollection configFiles = project.files()

    <span class="annotation">@OutputFile</span>
    <span class="directive">final</span> RegularFileProperty bundle = project.objects.fileProperty()

    BundleTask() {
        args.addAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">run</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bundle</span><span class="delimiter">&quot;</span></span>)
        bundle.set(project.layout.buildDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle.js</span><span class="delimiter">&quot;</span></span>))
        scripts.set(project.layout.projectDirectory.dir(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>))
        configFiles.from(project.layout.projectDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>))
        configFiles.from(project.layout.projectDirectory.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">package-lock.json</span><span class="delimiter">&quot;</span></span>))
    }
}

task bundle(<span class="key">type</span>: BundleTask)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableTask                                       // <b class="conum">(1)</b>
open class BundleTask : NpmTask() {

    @get:Internal                                    // <b class="conum">(2)</b>
    override val args
        get() = super.args


    @get:InputDirectory
    @get:SkipWhenEmpty
    @get:PathSensitive(PathSensitivity.RELATIVE)     // <b class="conum">(3)</b>
    val scripts: DirectoryProperty = project.objects.directoryProperty()

    @get:InputFiles
    @get:PathSensitive(PathSensitivity.RELATIVE)     // <b class="conum">(4)</b>
    val configFiles: ConfigurableFileCollection = project.files()

    @get:OutputFile
    val bundle: RegularFileProperty = project.objects.fileProperty()

    init {
        args.addAll(&quot;run&quot;, &quot;bundle&quot;)
        bundle.set(project.layout.buildDirectory.file(&quot;bundle.js&quot;))
        scripts.set(project.layout.projectDirectory.dir(&quot;scripts&quot;))
        configFiles.from(project.layout.projectDirectory.file(&quot;package.json&quot;))
        configFiles.from(project.layout.projectDirectory.file(&quot;package-lock.json&quot;))
    }
}

tasks.register&lt;BundleTask&gt;(&quot;bundle&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) Add <code>@CacheableTask</code> to enable caching for the task.</p>
</li>
<li>
<p>(2) Override the getter of a property of the base class to change the input annotation to <code>@Internal</code>.</p>
</li>
<li>
<p>(3) (4) Declare the path sensitivity.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="using_the_runtime_api"><a class="anchor" href="#using_the_runtime_api"></a><a class="link" href="#using_the_runtime_api">Using the runtime API</a></h5>
<div class="paragraph">
<p>If for some reason you cannot create a new custom task class, it is also possible to make a task cacheable using the <a href="#sec:task_input_output_runtime_api">runtime API</a> to declare the inputs and outputs.</p>
</div>
<div class="paragraph">
<p>For enabling caching for the task you need to use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html#cacheIf-org.gradle.api.specs.Spec-">TaskOutputs.cacheIf()</a> method.</p>
</div>
<div class="paragraph">
<p>The declarations via the runtime API have the same effect as the annotations described above.
Note that you cannot override file inputs and outputs via the runtime API.
Input properties can be overridden by specifying the same property name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. Make the bundle task cacheable</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task bundle(<span class="key">type</span>: NpmTask) {
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">bundle</span><span class="delimiter">'</span></span>]

    outputs.cacheIf { <span class="predefined-constant">true</span> }

    inputs.dir(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    inputs.files(<span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">package-lock.json</span><span class="delimiter">&quot;</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">configFiles</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/bundle.js</span><span class="delimiter">&quot;</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;NpmTask&gt;(&quot;bundle&quot;) {
    args.set(listOf(&quot;run&quot;, &quot;bundle&quot;))

    outputs.cacheIf { true }

    inputs.dir(file(&quot;scripts&quot;))
        .withPropertyName(&quot;scripts&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    inputs.files(&quot;package.json&quot;, &quot;package-lock.json&quot;)
        .withPropertyName(&quot;configFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    outputs.file(&quot;$buildDir/bundle.js&quot;)
        .withPropertyName(&quot;bundle&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_configure"><a class="anchor" href="#sec:build_cache_configure"></a><a class="link" href="#sec:build_cache_configure">Configure the Build Cache</a></h4>
<div class="paragraph">
<p>You can configure the build cache by using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:buildCache(org.gradle.api.Action)">Settings.buildCache(org.gradle.api.Action)</a> block in <code>settings.gradle</code>.</p>
</div>
<div class="paragraph">
<p>Gradle supports a <code>local</code> and a <code>remote</code> build cache that can be configured separately.
When both build caches are enabled, Gradle tries to load build outputs from the local build cache first, and then tries the remote build cache if no build outputs are found.
If outputs are found in the remote cache, they are also stored in the local cache, so next time they will be found locally.
Gradle stores ("pushes") build outputs in any build cache that is enabled and has <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/caching/configuration/BuildCache.html#isPush--">BuildCache.isPush()</a> set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>By default, the local build cache has push enabled, and the remote build cache has push disabled.</p>
</div>
<div class="paragraph">
<p>The local build cache is pre-configured to be a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a> and enabled by default.
The remote build cache can be configured by specifying the type of build cache to connect to (<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.configuration.BuildCacheConfiguration.html#org.gradle.caching.configuration.BuildCacheConfiguration:remote(java.lang.Class)">BuildCacheConfiguration.remote(java.lang.Class)</a>).</p>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_local"><a class="anchor" href="#sec:build_cache_configure_local"></a><a class="link" href="#sec:build_cache_configure_local">Built-in local build cache</a></h5>
<div class="paragraph">
<p>The built-in local build cache, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a>, uses a directory to store build cache artifacts.
By default, this directory resides in the Gradle user home directory, but its location is configurable.</p>
</div>
<div class="paragraph">
<p>Gradle will periodically clean-up the local cache directory by removing entries that have not been used recently to conserve disk space.</p>
</div>
<div class="paragraph">
<p>For more details on the configuration options refer to the DSL documentation of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.local.DirectoryBuildCache.html">DirectoryBuildCache</a>.
Here is an example of the configuration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Configure the local cache</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    local {
        directory = <span class="keyword">new</span> <span class="predefined-type">File</span>(rootDir, <span class="string"><span class="delimiter">'</span><span class="content">build-cache</span><span class="delimiter">'</span></span>)
        removeUnusedEntriesAfterDays = <span class="integer">30</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    local {
        directory = File(rootDir, &quot;build-cache&quot;)
        removeUnusedEntriesAfterDays = 30
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_remote"><a class="anchor" href="#sec:build_cache_configure_remote"></a><a class="link" href="#sec:build_cache_configure_remote">Remote HTTP build cache</a></h5>
<div class="paragraph">
<p>Gradle has built-in support for connecting to a remote build cache backend via HTTP.
For more details on what the protocol looks like see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.http.HttpBuildCache.html">HttpBuildCache</a>.
Note that by using the following configuration the local build cache will be used for storing build outputs while the local and the remote build cache will be used for retrieving build outputs.</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Load from HttpBuildCache</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can configure the credentials the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.http.HttpBuildCache.html">HttpBuildCache</a> uses to access the build cache server as shown in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Configure remote HTTP cache</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        credentials {
            username = <span class="string"><span class="delimiter">'</span><span class="content">build-cache-user</span><span class="delimiter">'</span></span>
            password = <span class="string"><span class="delimiter">'</span><span class="content">some-complicated-password</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        credentials {
            username = &quot;build-cache-user&quot;
            password = &quot;some-complicated-password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You may encounter problems with an untrusted SSL certificate when you try to use a build cache backend with an HTTPS URL.
The ideal solution is for someone to add a valid SSL certificate to the build cache backend, but we recognize that you may not be able to do that.
In that case, set <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.caching.http.HttpBuildCache.html#org.gradle.caching.http.HttpBuildCache:allowUntrustedServer">HttpBuildCache.isAllowUntrustedServer()</a> to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>This is a convenient workaround, but you shouldnt use it as a long-term solution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 30. Allow untrusted cache server</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        allowUntrustedServer = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        isAllowUntrustedServer = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_configure_use_cases"><a class="anchor" href="#sec:build_cache_configure_use_cases"></a><a class="link" href="#sec:build_cache_configure_use_cases">Configuration use cases</a></h5>
<div class="paragraph">
<p>The recommended use case for the remote build cache is that your continuous integration server populates it from clean builds while developers only load from it.
The configuration would then look as follows.</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Recommended setup for CI push use case</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">boolean</span> isCiServer = <span class="predefined-type">System</span>.getenv().containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">CI</span><span class="delimiter">&quot;</span></span>)

buildCache {
    remote(HttpBuildCache) {
        url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        push = isCiServer
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val isCiServer = System.getenv().containsKey(&quot;CI&quot;)

buildCache {
    remote&lt;HttpBuildCache&gt; {
        url = uri(&quot;https://example.com:8123/cache/&quot;)
        isPush = isCiServer
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to configure the build cache from an <a href="#sec:using_an_init_script">init script</a>, which can be used from the command line, added to your Gradle user home or be a part of your custom Gradle distribution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Init script to configure the build cache</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle.settingsEvaluated { settings -&gt;
    settings.buildCache {
        <span class="comment">// vvv Your custom configuration goes here</span>
        remote(HttpBuildCache) {
            url = <span class="string"><span class="delimiter">'</span><span class="content">https://example.com:8123/cache/</span><span class="delimiter">'</span></span>
        }
        <span class="comment">// ^^^ Your custom configuration goes here</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle.settingsEvaluated {
    buildCache {
        // vvv Your custom configuration goes here
        remote&lt;HttpBuildCache&gt; {
            url = uri(&quot;https://example.com:8123/cache/&quot;)
        }
        // ^^^ Your custom configuration goes here
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_cache_composite"><a class="anchor" href="#sec:build_cache_composite"></a><a class="link" href="#sec:build_cache_composite">Build cache, composite builds and <code>buildSrc</code></a></h5>
<div class="paragraph">
<p>Gradle&#8217;s <a href="#composite_builds">composite build feature</a> allows including other complete Gradle builds into another.
Such included builds will inherit the build cache configuration from the top level build, regardless of whether the included builds define build cache configuration themselves or not.</p>
</div>
<div class="paragraph">
<p>The build cache configuration present for any included build is effectively ignored, in favour of the top level build&#8217;s configuration.
This also applies to any <code>buildSrc</code> projects of any included builds.</p>
</div>
<div class="paragraph">
<p>The <a href="#sec:build_sources"><code>buildSrc</code> directory</a> is treated as an <a href="#composite_build_intro">included build</a>, and as such it inherits the build cache configuration from the top-level build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_setup_http_backend"><a class="anchor" href="#sec:build_cache_setup_http_backend"></a><a class="link" href="#sec:build_cache_setup_http_backend">How to set up an HTTP build cache backend</a></h4>
<div class="paragraph">
<p>Gradle provides a Docker image for a <a href="https://hub.docker.com/r/gradle/build-cache-node/">build cache node</a>, which can connect with Gradle Enterprise for centralized management.
The cache node can also be used without a Gradle Enterprise installation with restricted functionality.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_cache_implement"><a class="anchor" href="#sec:build_cache_implement"></a><a class="link" href="#sec:build_cache_implement">Implement your own Build Cache</a></h4>
<div class="paragraph">
<p>Using a different build cache backend to store build outputs (which is not covered by the built-in support for connecting to an HTTP backend) requires implementing
your own logic for connecting to your custom build cache backend.
To this end, custom build cache types can be registered via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/caching/configuration/BuildCacheConfiguration.html#registerBuildCacheService-java.lang.Class-java.lang.Class-">BuildCacheConfiguration.registerBuildCacheService(java.lang.Class, java.lang.Class)</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://gradle.com/build-cache">Gradle Enterprise</a> includes a high-performance, easy to install and operate, shared build cache backend.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:authoring_builds"><a class="anchor" href="#part:authoring_builds"></a><a class="link" href="#part:authoring_builds">Authoring Gradle Builds</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tutorial_using_tasks"><a class="anchor" href="#tutorial_using_tasks"></a><a class="link" href="#tutorial_using_tasks">Build Script Basics</a></h3>
<div class="paragraph">
<p>This chapter introduces you to the basics of writing Gradle build scripts. For a quick hands-on introduction, try the <a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating New Gradle Builds</a> guide.</p>
</div>
<div class="sect3">
<h4 id="sec:projects_and_tasks"><a class="anchor" href="#sec:projects_and_tasks"></a><a class="link" href="#sec:projects_and_tasks">Projects and tasks</a></h4>
<div class="paragraph">
<p>Everything in Gradle sits on top of two basic concepts: <em>projects</em> and <em>tasks</em>.</p>
</div>
<div class="paragraph">
<p>Every Gradle build is made up of one or more <em>projects</em>. What a project represents depends on what it is that you are doing with Gradle. For example, a project might represent a library JAR or a web application. It might represent a distribution ZIP assembled from the JARs produced by other projects. A project does not necessarily represent a thing to be built. It might represent a thing to be done, such as deploying your application to staging or production environments. Don&#8217;t worry if this seems a little vague for now. Gradle&#8217;s build-by-convention support adds a more concrete definition for what a project is.</p>
</div>
<div class="paragraph">
<p>Each project is made up of one or more <em>tasks</em>. A task represents some atomic piece of work which a build performs. This might be compiling some classes, creating a JAR, generating Javadoc, or publishing some archives to a repository.</p>
</div>
<div class="paragraph">
<p>For now, we will look at defining some simple tasks in a build with one project. Later chapters will look at working with multiple projects and more about working with projects and tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:hello_world"><a class="anchor" href="#sec:hello_world"></a><a class="link" href="#sec:hello_world">Hello world</a></h4>
<div class="paragraph multi-language-text lang-groovy">
<p>You run a Gradle build using the <code>gradle</code> command. The <code>gradle</code> command looks for a file called <code>build.gradle</code> in the current directory.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> We call this <code>build.gradle</code> file a <em>build script</em>, although strictly speaking it is a build configuration script, as we will see later. The build script defines a project and its tasks.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>To try this out, create the following build script named <code>build.gradle</code>.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>You run a Gradle build using the <code>gradle</code> command. The <code>gradle</code> command looks for a file called <code>build.gradle.kts</code> in the current directory.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> We call this <code>build.gradle.kts</code> file a <em>build script</em>, although strictly speaking it is a build configuration script, as we will see later. The build script defines a project and its tasks.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>To try this out, create the following build script named <code>build.gradle.kts</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Your first build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello world!&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In a command-line shell, move to the containing directory and execute the build script with <code>gradle -q hello</code>:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">What does <code>-q</code> do?</div>
<div class="paragraph">
<p>Most of the examples in this user guide are run with the <code>-q</code> command-line option. This suppresses Gradle&#8217;s log messages, so that only the output of the tasks is shown. This keeps the example output in this user guide a little clearer. You don&#8217;t need to use this option if you don&#8217;t want to. See <a href="#logging">Logging</a> for more details about the command-line options which affect Gradle&#8217;s output.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 34. Execution of a build script</div>
<div class="content">
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hello world!</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s going on here? This build script defines a single task, called <code>hello</code>, and adds an action to it. When you run <code>gradle hello</code>, Gradle executes the <code>hello</code> task, which in turn executes the action you&#8217;ve provided. The action is simply a block containing some code to execute.</p>
</div>
<div class="paragraph">
<p>If you think this looks similar to Ant&#8217;s targets, you would be right. Gradle tasks are the equivalent to Ant targets, but as you will see, they are much more powerful. We have used a different terminology than Ant as we think the word <em>task</em> is more expressive than the word <em>target</em>. Unfortunately this introduces a terminology clash with Ant, as Ant calls its commands, such as <code>javac</code> or <code>copy</code>, tasks. So when we talk about tasks, we <em>always</em> mean Gradle tasks, which are the equivalent to Ant&#8217;s targets. If we talk about Ant tasks (Ant commands), we explicitly say <em>Ant task</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_scripts_are_code"><a class="anchor" href="#sec:build_scripts_are_code"></a><a class="link" href="#sec:build_scripts_are_code">Build scripts are code</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s build scripts give you the full power of Groovy and Kotlin. As an appetizer, have a look at this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Using Groovy or Kotlin in Gradle&#8217;s tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task upper {
    doLast {
        <span class="predefined-type">String</span> someString = <span class="string"><span class="delimiter">'</span><span class="content">mY_nAmE</span><span class="delimiter">'</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Original: </span><span class="inline"><span class="inline-delimiter">$</span>someString</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Upper case: </span><span class="inline"><span class="inline-delimiter">${</span>someString.toUpperCase()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;upper&quot;) {
    doLast {
        val someString = &quot;mY_nAmE&quot;
        println(&quot;Original: $someString&quot;)
        println(&quot;Upper case: ${someString.toUpperCase()}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q upper</code></strong></div>
<div class="content">
<pre>&gt; gradle -q upper
Original: mY_nAmE
Upper case: MY_NAME</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Using Groovy or Kotlin in Gradle&#8217;s tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task count {
    doLast {
        <span class="integer">4</span>.times { print <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="content"> </span><span class="delimiter">&quot;</span></span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;count&quot;) {
    doLast {
        repeat(4) { print(&quot;$it &quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q count</code></strong></div>
<div class="content">
<pre>&gt; gradle -q count
0 1 2 3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_dependencies"><a class="anchor" href="#sec:task_dependencies"></a><a class="link" href="#sec:task_dependencies">Task dependencies</a></h4>
<div class="paragraph">
<p>As you probably have guessed, you can declare tasks that depend on other tasks.</p>
</div>
<div class="exampleblock">
<div class="title">Example 37. Declaration of task that depends on other task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}
task intro {
    dependsOn hello
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm Gradle</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello world!&quot;)
    }
}
tasks.register(&quot;intro&quot;) {
    dependsOn(&quot;hello&quot;)
    doLast {
        println(&quot;I'm Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q intro</code></strong></div>
<div class="content">
<pre>&gt; gradle -q intro
Hello world!
I'm Gradle</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To add a dependency, the corresponding task does not need to exist.</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Lazy dependsOn - the other task does not exist (yet)</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    dependsOn <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;taskX&quot;) {
    dependsOn(&quot;taskY&quot;)
    doLast {
        println(&quot;taskX&quot;)
    }
}
tasks.register(&quot;taskY&quot;) {
    doLast {
        println(&quot;taskY&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskY
taskX</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dependency of <code>taskX</code> to <code>taskY</code> may be declared before <code>taskY</code> is defined. This freedom is very important for multi-project builds. Task dependencies are discussed in more detail in <a href="#sec:adding_dependencies_to_tasks">Adding dependencies to a task</a>.</p>
</div>
<div class="paragraph">
<p>Please notice that you can&#8217;t use <a href="#sec:shortcut_notations">shortcut notation</a> when referring to a task that is not yet defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:dynamic_tasks"><a class="anchor" href="#sec:dynamic_tasks"></a><a class="link" href="#sec:dynamic_tasks">Dynamic tasks</a></h4>
<div class="paragraph">
<p>The power of Groovy or Kotlin can be used for more than defining what a task does. For example, you can also use it to dynamically create tasks.</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. Dynamic creation of a task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="integer">4</span>.times { counter -&gt;
    task <span class="string"><span class="delimiter">&quot;</span><span class="content">task</span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span> {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm task number </span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repeat(4) { counter -&gt;
    tasks.register(&quot;task$counter&quot;) {
        doLast {
            println(&quot;I'm task number $counter&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q task1</code></strong></div>
<div class="content">
<pre>&gt; gradle -q task1
I'm task number 1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:manipulating_existing_tasks"><a class="anchor" href="#sec:manipulating_existing_tasks"></a><a class="link" href="#sec:manipulating_existing_tasks">Manipulating existing tasks</a></h4>
<div class="paragraph">
<p>Once tasks are created they can be accessed via an <em>API</em>. For instance, you could use this to dynamically add dependencies to a task, at runtime. Ant doesn&#8217;t allow anything like this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 40. Accessing a task via API - adding a dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="integer">4</span>.times { counter -&gt;
    task <span class="string"><span class="delimiter">&quot;</span><span class="content">task</span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span> {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm task number </span><span class="inline"><span class="inline-delimiter">$</span>counter</span><span class="delimiter">&quot;</span></span>
        }
    }
}
task0.dependsOn task2, task3</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repeat(4) { counter -&gt;
    tasks.register(&quot;task$counter&quot;) {
        doLast {
            println(&quot;I'm task number $counter&quot;)
        }
    }
}
tasks.named(&quot;task0&quot;) { dependsOn(&quot;task2&quot;, &quot;task3&quot;) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q task0</code></strong></div>
<div class="content">
<pre>&gt; gradle -q task0
I'm task number 2
I'm task number 3
I'm task number 0</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or you can add behavior to an existing task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Accessing a task via API - adding behaviour</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Earth</span><span class="delimiter">'</span></span>
    }
}
hello.doFirst {
    println <span class="string"><span class="delimiter">'</span><span class="content">Hello Venus</span><span class="delimiter">'</span></span>
}
hello.configure {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Mars</span><span class="delimiter">'</span></span>
    }
}
hello.configure {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello Jupiter</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val hello by tasks.registering {
    doLast {
        println(&quot;Hello Earth&quot;)
    }
}
hello {
    doFirst {
        println(&quot;Hello Venus&quot;)
    }
}
hello {
    doLast {
        println(&quot;Hello Mars&quot;)
    }
}
hello {
    doLast {
        println(&quot;Hello Jupiter&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hello Venus
Hello Earth
Hello Mars
Hello Jupiter</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The calls <code>doFirst</code> and <code>doLast</code> can be executed multiple times. They add an action to the beginning or the end of the task&#8217;s actions list. When the task executes, the actions in the action list are executed in order.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:shortcut_notations"><a class="anchor" href="#sec:shortcut_notations"></a><a class="link" href="#sec:shortcut_notations">Groovy DSL shortcut notations</a></h4>
<div class="paragraph">
<p>There is a convenient notation for accessing an <em>existing</em> task. Each task is available as a property of the build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. Accessing task as a property of the build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}
hello.doLast {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">Greetings from the </span><span class="inline"><span class="inline-delimiter">$</span>hello</span><span class="content">.name task.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hello world!
Greetings from the hello task.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This enables very readable code, especially when using the tasks provided by the plugins, like the <code>compile</code> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:extra_task_properties"><a class="anchor" href="#sec:extra_task_properties"></a><a class="link" href="#sec:extra_task_properties">Extra task properties</a></h4>
<div class="paragraph">
<p>You can add your own properties to a task. To add a property named <code>myProperty</code>, set <code>ext.myProperty</code> to an initial value. From that point on, the property can be read and set like a predefined task property.</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. Adding extra properties to a task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task myTask {
    ext.myProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">myValue</span><span class="delimiter">&quot;</span></span>
}

task printTaskProperties {
    doLast {
        println myTask.myProperty
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;myTask&quot;) {
    extra[&quot;myProperty&quot;] = &quot;myValue&quot;
}

tasks.register(&quot;printTaskProperties&quot;) {
    doLast {
        println(tasks[&quot;myTask&quot;].extra[&quot;myProperty&quot;])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q printTaskProperties</code></strong></div>
<div class="content">
<pre>&gt; gradle -q printTaskProperties
myValue</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Extra properties aren&#8217;t limited to tasks. You can read more about them in <a href="#sec:extra_properties">Extra properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_ant_tasks_tutorial"><a class="anchor" href="#sec:using_ant_tasks_tutorial"></a><a class="link" href="#sec:using_ant_tasks_tutorial">Using Ant Tasks</a></h4>
<div class="paragraph">
<p>Ant tasks are first-class citizens in Gradle. Gradle provides excellent integration for Ant tasks by simply relying on Groovy. Groovy is shipped with the fantastic <code>AntBuilder</code>. Using Ant tasks from Gradle is as convenient and more powerful than using Ant tasks from a <code>build.xml</code> file. And it is usable from Kotlin too. From the example below, you can learn how to execute Ant tasks and how to access Ant properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Using AntBuilder to execute ant.loadfile target</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task loadfile {
    doLast {
        <span class="keyword">def</span> files = file(<span class="string"><span class="delimiter">'</span><span class="content">./antLoadfileResources</span><span class="delimiter">'</span></span>).listFiles().sort()
        files.each { <span class="predefined-type">File</span> file -&gt;
            <span class="keyword">if</span> (file.isFile()) {
                ant.loadfile(<span class="key">srcFile</span>: file, <span class="key">property</span>: file.name)
                println <span class="string"><span class="delimiter">&quot;</span><span class="content"> *** </span><span class="inline"><span class="inline-delimiter">$</span>file</span><span class="content">.name ***</span><span class="delimiter">&quot;</span></span>
                println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>ant.properties[file.name]<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;loadfile&quot;) {
    doLast {
        val files = file(&quot;./antLoadfileResources&quot;).listFiles().sorted()
        files.forEach { file -&gt;
            if (file.isFile) {
                ant.withGroovyBuilder {
                    &quot;loadfile&quot;(&quot;srcFile&quot; to file, &quot;property&quot; to file.name)
                }
                println(&quot; *** ${file.name} ***&quot;)
                println(&quot;${ant.properties[file.name]}&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q loadfile</code></strong></div>
<div class="content">
<pre>&gt; gradle -q loadfile
 *** agile.manifesto.txt ***
Individuals and interactions over processes and tools
Working software over comprehensive documentation
Customer collaboration  over contract negotiation
Responding to change over following a plan
 *** gradle.manifesto.txt ***
Make the impossible possible, make the possible easy and make the easy elegant.
(inspired by Moshe Feldenkrais)</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is lots more you can do with Ant in your build scripts. You can find out more in <a href="#ant">Ant</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_methods"><a class="anchor" href="#sec:using_methods"></a><a class="link" href="#sec:using_methods">Using methods</a></h4>
<div class="paragraph">
<p>Gradle scales in how you can organize your build logic. The first level of organizing your build logic for the example above, is extracting a method.</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. Using methods to organize your build logic</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task checksum {
    doLast {
        fileList(<span class="string"><span class="delimiter">'</span><span class="content">./antLoadfileResources</span><span class="delimiter">'</span></span>).each { <span class="predefined-type">File</span> file -&gt;
            ant.checksum(<span class="key">file</span>: file, <span class="key">property</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cs_</span><span class="inline"><span class="inline-delimiter">$</span>file</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>)
            println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>file</span><span class="content">.name Checksum: </span><span class="inline"><span class="inline-delimiter">${</span>ant.properties[<span class="string"><span class="delimiter">&quot;</span><span class="content">cs_</span><span class="inline"><span class="inline-delimiter">$</span>file</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>]<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        }
    }
}

task loadfile {
    doLast {
        fileList(<span class="string"><span class="delimiter">'</span><span class="content">./antLoadfileResources</span><span class="delimiter">'</span></span>).each { <span class="predefined-type">File</span> file -&gt;
            ant.loadfile(<span class="key">srcFile</span>: file, <span class="key">property</span>: file.name)
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm fond of </span><span class="inline"><span class="inline-delimiter">$</span>file</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}

<span class="predefined-type">File</span><span class="type">[]</span> fileList(<span class="predefined-type">String</span> dir) {
    file(dir).listFiles({file -&gt; file.isFile() } <span class="keyword">as</span> <span class="predefined-type">FileFilter</span>).sort()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;checksum&quot;) {
    doLast {
        fileList(&quot;./antLoadfileResources&quot;).forEach { file -&gt;
            ant.withGroovyBuilder {
                &quot;checksum&quot;(&quot;file&quot; to file, &quot;property&quot; to &quot;cs_${file.name}&quot;)
            }
            println(&quot;$file.name Checksum: ${ant.properties[&quot;cs_${file.name}&quot;]}&quot;)
        }
    }
}

tasks.register(&quot;loadfile&quot;) {
    doLast {
        fileList(&quot;./antLoadfileResources&quot;).forEach { file -&gt;
            ant.withGroovyBuilder {
                &quot;loadfile&quot;(&quot;srcFile&quot; to file, &quot;property&quot; to file.name)
            }
            println(&quot;I'm fond of ${file.name}&quot;)
        }
    }
}

fun fileList(dir: String): List&lt;File&gt; =
    file(dir).listFiles { file: File -&gt; file.isFile }.sorted()</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q loadfile</code></strong></div>
<div class="content">
<pre>&gt; gradle -q loadfile
I'm fond of agile.manifesto.txt
I'm fond of gradle.manifesto.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Later you will see that such methods can be shared among subprojects in multi-project builds. If your build logic becomes more complex, Gradle offers you other very convenient ways to organize it. We have devoted a whole chapter to this. See <a href="#organizing_gradle_projects">Organizing Gradle Projects</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:default_tasks"><a class="anchor" href="#sec:default_tasks"></a><a class="link" href="#sec:default_tasks">Default tasks</a></h4>
<div class="paragraph">
<p>Gradle allows you to define one or more default tasks that are executed if no other tasks are specified.</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. Defining a default task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">defaultTasks <span class="string"><span class="delimiter">'</span><span class="content">clean</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>

task clean {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Default Cleaning!</span><span class="delimiter">'</span></span>
    }
}

task run {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Default Running!</span><span class="delimiter">'</span></span>
    }
}

task other {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm not a default task!</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">defaultTasks(&quot;clean&quot;, &quot;run&quot;)

task(&quot;clean&quot;) {
    doLast {
        println(&quot;Default Cleaning!&quot;)
    }
}

tasks.register(&quot;run&quot;) {
    doLast {
        println(&quot;Default Running!&quot;)
    }
}

tasks.register(&quot;other&quot;) {
    doLast {
        println(&quot;I'm not a default task!&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q</code></strong></div>
<div class="content">
<pre>&gt; gradle -q
Default Cleaning!
Default Running!</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to running <code>gradle clean run</code>. In a multi-project build every subproject can have its own specific default tasks. If a subproject does not specify default tasks, the default tasks of the parent project are used (if defined).</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-by-dag"><a class="anchor" href="#configure-by-dag"></a><a class="link" href="#configure-by-dag">Configure by DAG</a></h4>
<div class="paragraph">
<p>As we later describe in full detail (see <a href="#build_lifecycle">Build Lifecycle</a>), Gradle has a configuration phase and an execution phase.
After the configuration phase, Gradle knows all tasks that should be executed.
Gradle offers you a hook to make use of this information.
A use-case for this would be to check if the release task is among the tasks to be executed.
Depending on this, you can assign different values to some variables.</p>
</div>
<div class="paragraph">
<p>In the following example, execution of the <code>distribution</code> and <code>release</code> tasks results in different value of the <code>version</code> variable.</p>
</div>
<div class="exampleblock">
<div class="title">Example 47. Different outcomes of build depending on chosen tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task distribution {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">We build the zip with version=</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="delimiter">&quot;</span></span>
    }
}

task release {
    dependsOn <span class="string"><span class="delimiter">'</span><span class="content">distribution</span><span class="delimiter">'</span></span>
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">We release now</span><span class="delimiter">'</span></span>
    }
}

gradle.taskGraph.whenReady { taskGraph -&gt;
    <span class="keyword">if</span> (taskGraph.hasTask(<span class="string"><span class="delimiter">&quot;</span><span class="content">:release</span><span class="delimiter">&quot;</span></span>)) {
        version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
    } <span class="keyword">else</span> {
        version = <span class="string"><span class="delimiter">'</span><span class="content">1.0-SNAPSHOT</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;distribution&quot;) {
    doLast {
        println(&quot;We build the zip with version=$version&quot;)
    }
}

tasks.register(&quot;release&quot;) {
    dependsOn(&quot;distribution&quot;)
    doLast {
        println(&quot;We release now&quot;)
    }
}

gradle.taskGraph.whenReady {
    version =
        if (hasTask(&quot;:release&quot;)) &quot;1.0&quot;
        else &quot;1.0-SNAPSHOT&quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q distribution</code></div>
<div class="content">
<pre>&gt; gradle -q distribution
We build the zip with version=1.0-SNAPSHOT</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q release</code></div>
<div class="content">
<pre>&gt; gradle -q release
We build the zip with version=1.0
We release now</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The important thing is that <code>whenReady</code> affects the release task <em>before</em> the release task is executed.
This works even when the release task is not the <em>primary</em> task (i.e., the task passed to the <code>gradle</code> command).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This example works because the <code>version</code> value is only read at execution time.
When using a similar construct in a real build you must make sure that nowhere is the value read eagerly during configuration.
Otherwise your build may use different values for a property between configuration and execution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_script_external_dependencies"><a class="anchor" href="#sec:build_script_external_dependencies"></a><a class="link" href="#sec:build_script_external_dependencies">External dependencies for the build script</a></h4>
<div class="paragraph">
<p>If your build script needs to use external libraries, you can add them to the script&#8217;s classpath in the build script itself. You do this using the <code>buildscript()</code> method, passing in a block which declares the build script classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Declaring external dependencies for the build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-codec</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-codec</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        &quot;classpath&quot;(group = &quot;commons-codec&quot;, name = &quot;commons-codec&quot;, version = &quot;1.2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The block passed to the <code>buildscript()</code> method configures a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/initialization/dsl/ScriptHandler.html">ScriptHandler</a> instance.
You declare the build script classpath by adding dependencies to the <code>classpath</code> configuration.
This is the same way you declare, for example, the Java compilation classpath.
You can use any of the <a href="#sec:dependency-types">dependency types</a> except project dependencies.</p>
</div>
<div class="paragraph">
<p>Having declared the build script classpath, you can use the classes in your build script as you would any other classes on the classpath. The following example adds to the previous example, and uses classes from the build script classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. A build script with external dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.codec.binary.Base64</span>

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-codec</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-codec</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>
    }
}

task encode {
    doLast {
        <span class="keyword">def</span> <span class="type">byte</span><span class="type">[]</span> encodedString = <span class="keyword">new</span> Base64().encode(<span class="string"><span class="delimiter">'</span><span class="content">hello world\n</span><span class="delimiter">'</span></span>.getBytes())
        println <span class="keyword">new</span> <span class="predefined-type">String</span>(encodedString)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.commons.codec.binary.Base64

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        &quot;classpath&quot;(group = &quot;commons-codec&quot;, name = &quot;commons-codec&quot;, version = &quot;1.2&quot;)
    }
}

tasks.register(&quot;encode&quot;) {
    doLast {
        val encodedString = Base64().encode(&quot;hello world\n&quot;.toByteArray())
        println(String(encodedString))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q encode</code></strong></div>
<div class="content">
<pre>&gt; gradle -q encode
aGVsbG8gd29ybGQK</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For multi-project builds, the dependencies declared with a project&#8217;s <code>buildscript()</code> method are available to the build scripts of all its sub-projects.</p>
</div>
<div class="paragraph">
<p>Build script dependencies may be Gradle plugins. Please consult <a href="#plugins">Using Gradle Plugins</a> for more information on Gradle plugins.</p>
</div>
<div class="paragraph">
<p>Every project automatically has a <code>buildEnvironment</code> task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.diagnostics.BuildEnvironmentReportTask.html">BuildEnvironmentReportTask</a> that can be invoked to report on the resolution of the build script dependencies.</p>
</div>
</div>
<div class="sect3">
<h4 id="further_reading_3"><a class="anchor" href="#further_reading_3"></a><a class="link" href="#further_reading_3">Further Reading</a></h4>
<div class="paragraph">
<p>This chapter only scratched the surface with what&#8217;s possible. Here are some other topics that may be interesting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#authoring_maintainable_build_scripts">Authoring maintainable build scripts</a></p>
</li>
<li>
<p><a href="#organizing_gradle_projects">Organizing your Gradle projects</a></p>
</li>
<li>
<p><a href="#custom_tasks">Writing Custom tasks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more_about_tasks"><a class="anchor" href="#more_about_tasks"></a><a class="link" href="#more_about_tasks">Authoring Tasks</a></h3>
<div class="paragraph">
<p>In the <a href="#tutorial_using_tasks">introductory tutorial</a> you learned how to create simple tasks. You also learned how to add additional behavior to these tasks later on, and you learned how to create dependencies between tasks. This was all about simple tasks, but Gradle takes the concept of tasks further. Gradle supports <em>enhanced tasks</em>, which are tasks that have their own properties and methods. This is really different from what you are used to with Ant targets. Such enhanced tasks are either provided by you or built into Gradle.</p>
</div>
<div class="sect3">
<h4 id="sec:task_outcomes"><a class="anchor" href="#sec:task_outcomes"></a><a class="link" href="#sec:task_outcomes">Task outcomes</a></h4>
<div class="paragraph">
<p>When Gradle executes a task, it can label the task with different outcomes in the console UI and via the <a href="#embedding">Tooling API</a>. These labels are based on if a task has actions to execute, if it should execute those actions, if it did execute those actions and if those actions made any changes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(no label)</code> or <code>EXECUTED</code></dt>
<dd>
<p>Task executed its actions.</p>
<div class="ulist">
<ul>
<li>
<p>Task has actions and Gradle has determined they should be executed as part of a build.</p>
</li>
<li>
<p>Task has no actions and some dependencies, and any of the dependencies are executed. See also <a href="#sec:lifecycle_tasks">Lifecycle Tasks</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>UP-TO-DATE</code></dt>
<dd>
<p>Task&#8217;s outputs did not change.</p>
<div class="ulist">
<ul>
<li>
<p>Task has outputs and inputs and they have not changed. See <a href="#sec:up_to_date_checks">Incremental Builds</a>.</p>
</li>
<li>
<p>Task has actions, but the task tells Gradle it did not change its outputs.</p>
</li>
<li>
<p>Task has no actions and some dependencies, but all of the dependencies are up-to-date, skipped or from cache. See also <a href="#sec:lifecycle_tasks">Lifecycle Tasks</a>.</p>
</li>
<li>
<p>Task has no actions and no dependencies.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>FROM-CACHE</code></dt>
<dd>
<p>Task&#8217;s outputs could be found from a previous execution.</p>
<div class="ulist">
<ul>
<li>
<p>Task has outputs restored from the build cache. See <a href="#build_cache">Build Cache</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>SKIPPED</code></dt>
<dd>
<p>Task did not execute its actions.</p>
<div class="ulist">
<ul>
<li>
<p>Task has been explicitly excluded from the command-line. See <a href="#sec:excluding_tasks_from_the_command_line">Excluding tasks from execution</a>.</p>
</li>
<li>
<p>Task has an <code>onlyIf</code> predicate return false. See <a href="#sec:using_a_predicate">Using a predicate</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>NO-SOURCE</code></dt>
<dd>
<p>Task did not need to execute its actions.</p>
<div class="ulist">
<ul>
<li>
<p>Task has inputs and outputs, but <a href="#skip-when-empty">no sources</a>. For example, source files are <code>.java</code> files for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:defining_tasks"><a class="anchor" href="#sec:defining_tasks"></a><a class="link" href="#sec:defining_tasks">Defining tasks</a></h4>
<div class="paragraph">
<p>We have already seen how to define tasks using strings for task names in <a href="#tutorial_using_tasks">this chapter</a>. There are a few variations on this style, which you may need to use in certain situations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The task configuration APIs are described in more detail in the <a href="task_configuration_avoidance.html">task configuration avoidance chapter</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 50. Defining tasks using strings for task names</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
    }
}

task(<span class="string"><span class="delimiter">'</span><span class="content">copy</span><span class="delimiter">'</span></span>, <span class="key">type</span>: Copy) {
    from(file(<span class="string"><span class="delimiter">'</span><span class="content">srcDir</span><span class="delimiter">'</span></span>))
    into(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;hello&quot;)
    }
}

tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
    from(file(&quot;srcDir&quot;))
    into(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is an alternative syntax for defining tasks, which you may prefer to use:</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. Defining tasks using the <code>tasks</code> container</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.create(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
    }
}

tasks.create(<span class="string"><span class="delimiter">'</span><span class="content">copy</span><span class="delimiter">'</span></span>, Copy) {
    from(file(<span class="string"><span class="delimiter">'</span><span class="content">srcDir</span><span class="delimiter">'</span></span>))
    into(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        println(&quot;hello&quot;)
    }
}

tasks {
    register&lt;Copy&gt;(&quot;copy&quot;) {
        from(file(&quot;srcDir&quot;))
        into(buildDir)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we add tasks to the <code>tasks</code> collection. Have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> for more variations of the <code>register()</code> method.</p>
</div>
<div class="paragraph">
<p>And finally, there are language specific syntaxes for the Groovy and Kotlin DSL:</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. Defining tasks using a DSL specific syntax</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using Groovy dynamic keywords</span>

task(hello) {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
    }
}

task(copy, <span class="key">type</span>: Copy) {
    from(file(<span class="string"><span class="delimiter">'</span><span class="content">srcDir</span><span class="delimiter">'</span></span>))
    into(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using Kotlin delegated properties

val hello by tasks.registering {
    doLast {
        println(&quot;hello&quot;)
    }
}

val copy by tasks.registering(Copy::class) {
    from(file(&quot;srcDir&quot;))
    into(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Note that the Kotlin <a href="https://kotlinlang.org/docs/reference/delegated-properties.html">delegated properties</a> syntax is particularly useful if you need the created task for further reference.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:locating_tasks"><a class="anchor" href="#sec:locating_tasks"></a><a class="link" href="#sec:locating_tasks">Locating tasks</a></h4>
<div class="paragraph">
<p>You often need to locate the tasks that you have defined in the build file, for example, to configure them or use them for dependencies. There are a number of ways of doing this. Firstly, just like with defining tasks there are language specific syntaxes for the Groovy and Kotlin DSL:</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. Accessing tasks using a DSL specific syntax</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello
task copy(<span class="key">type</span>: Copy)

<span class="comment">// Access tasks using Groovy dynamic properties on Project</span>

println hello.name
println project.hello.name

println copy.destinationDir
println project.copy.destinationDir</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">task(&quot;hello&quot;)
task&lt;Copy&gt;(&quot;copy&quot;)

// Access tasks using Kotlin delegated properties

val hello by tasks.getting
println(hello.name)

val copy by tasks.getting(Copy::class)
println(copy.destinationDir)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Tasks are also available through the <code>tasks</code> collection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Accessing tasks via tasks collection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello
task copy(<span class="key">type</span>: Copy)

println tasks.hello.name
println tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>).get().name

println tasks.copy.destinationDir
println tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">copy</span><span class="delimiter">'</span></span>).get().destinationDir</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;)
tasks.register&lt;Copy&gt;(&quot;copy&quot;)

println(tasks[&quot;hello&quot;].name)
println(tasks.named(&quot;hello&quot;).get().name)

println(tasks.getByName&lt;Copy&gt;(&quot;copy&quot;).destinationDir)
println(tasks.named&lt;Copy&gt;(&quot;copy&quot;).get().destinationDir)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can access tasks from any project using the task&#8217;s path using the <code>tasks.getByPath()</code> method. You can call the <code>getByPath()</code> method with a task name, or a relative path, or an absolute path.</p>
</div>
<div class="exampleblock">
<div class="title">Example 55. Accessing tasks by path</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project(<span class="string"><span class="delimiter">'</span><span class="content">:projectA</span><span class="delimiter">'</span></span>) {
    task hello
}

task hello

println tasks.getByPath(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>).path
println tasks.getByPath(<span class="string"><span class="delimiter">'</span><span class="content">:hello</span><span class="delimiter">'</span></span>).path
println tasks.getByPath(<span class="string"><span class="delimiter">'</span><span class="content">projectA:hello</span><span class="delimiter">'</span></span>).path
println tasks.getByPath(<span class="string"><span class="delimiter">'</span><span class="content">:projectA:hello</span><span class="delimiter">'</span></span>).path</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">project(&quot;:projectA&quot;) {
    tasks.register(&quot;hello&quot;)
}

tasks.register(&quot;hello&quot;)

println(tasks.getByPath(&quot;hello&quot;).path)
println(tasks.getByPath(&quot;:hello&quot;).path)
println(tasks.getByPath(&quot;projectA:hello&quot;).path)
println(tasks.getByPath(&quot;:projectA:hello&quot;).path)</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
:hello
:hello
:projectA:hello
:projectA:hello</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Tasks of a specific type can also be accessed by using the <code>tasks.withType()</code> method. This enables to easily avoid duplication of code and reduce redundancy.</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. Accessing tasks by their type</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Tar).configureEach {
    enabled = <span class="predefined-constant">false</span>
}

task test {
    dependsOn tasks.withType(Copy)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Tar&gt;().configureEach {
    enabled = false
}

tasks.register(&quot;test&quot;) {
    dependsOn(tasks.withType&lt;Copy&gt;())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> for more options for locating tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_tasks"><a class="anchor" href="#sec:configuring_tasks"></a><a class="link" href="#sec:configuring_tasks">Configuring tasks</a></h4>
<div class="paragraph">
<p>As an example, let&#8217;s look at the <code>Copy</code> task provided by Gradle. To create a <code>Copy</code> task for your build, you can declare in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Creating a copy task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task myCopy(<span class="key">type</span>: Copy)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;myCopy&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This creates a copy task with no default behavior. The task can be configured using its API (see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a>). The following examples show several different ways to achieve the same configuration.</p>
</div>
<div class="paragraph">
<p>Just to be clear, realize that the name of this task is <code>myCopy</code>, but it is of <em>type</em> <code>Copy</code>. You can have multiple tasks of the same <em>type</em>, but with different names. You&#8217;ll find this gives you a lot of power to implement cross-cutting concerns across all tasks of a particular type.</p>
</div>
<div class="exampleblock">
<div class="title">Example 58. Configuring a task using the API</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Copy myCopy = tasks.getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCopy</span><span class="delimiter">&quot;</span></span>)
myCopy.from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
myCopy.into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
myCopy.include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myCopy = tasks.named&lt;Copy&gt;(&quot;myCopy&quot;)
myCopy {
    from(&quot;resources&quot;)
    into(&quot;target&quot;)
    include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is similar to the way we would configure objects in Java. You have to repeat the context (<code>myCopy</code>) in the configuration statement every time. This is a redundancy and not very nice to read.</p>
</div>
<div class="paragraph">
<p>There is another way of configuring a task. It also preserves the context and it is arguably the most readable. It is usually our favorite.</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. Configuring a task using a DSL specific syntax</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Configure task using Groovy dynamic task configuration block</span>
myCopy {
   from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
   into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
}
myCopy.include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Configure task using Kotlin delegated properties and a lambda
val myCopy by tasks.existing(Copy::class) {
    from(&quot;resources&quot;)
    into(&quot;target&quot;)
}
myCopy { include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This works for <em>any</em> task. Task access is just a shortcut for the <code>tasks.named()</code> (Kotlin) or <code>tasks.getByName()</code> (Groovy) method. It is important to note that blocks used here are for <em>configuring</em> the task and are not evaluated when the task executes.</p>
</div>
<div class="paragraph">
<p>Have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> for more options for configuring tasks.</p>
</div>
<div class="paragraph">
<p>You can also use a configuration block when you define a task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. Defining a task with a configuration block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copy(<span class="key">type</span>: Copy) {
   from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
   into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
   include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
   from(&quot;resources&quot;)
   into(&quot;target&quot;)
   include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Don&#8217;t forget about the build phases</div>
<div class="paragraph">
<p>A task has both configuration and actions. When using the <code>doLast</code>, you are simply using a shortcut to define an action. Code defined in the configuration section of your task will get executed during the configuration phase of the build regardless of what task was targeted. See <a href="#build_lifecycle">Build Lifecycle</a> for more details about the build lifecycle.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:passing_arguments_to_a_task_constructor"><a class="anchor" href="#sec:passing_arguments_to_a_task_constructor"></a><a class="link" href="#sec:passing_arguments_to_a_task_constructor">Passing arguments to a task constructor</a></h4>
<div class="paragraph">
<p>As opposed to configuring the mutable properties of a <code>Task</code> after creation, you can pass argument values to the <code>Task</code> class&#8217;s constructor.
In order to pass values to the <code>Task</code> constructor, you must annotate the relevant constructor with <code>@javax.inject.Inject</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 61. Task class with <code>@Inject</code> constructor</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">CustomTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">final</span> <span class="predefined-type">String</span> message
    <span class="directive">final</span> <span class="type">int</span> number

    <span class="annotation">@Inject</span>
    CustomTask(<span class="predefined-type">String</span> message, <span class="type">int</span> number) {
        <span class="local-variable">this</span>.message = message
        <span class="local-variable">this</span>.number = number
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class CustomTask @Inject constructor(
    private val message: String,
    private val number: Int
) : DefaultTask()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then create a task, passing the constructor arguments at the end of the parameter list.</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. Creating a task with constructor arguments using TaskContainer</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.create(<span class="string"><span class="delimiter">'</span><span class="content">myTask</span><span class="delimiter">'</span></span>, CustomTask, <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">42</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;CustomTask&gt;(&quot;myTask&quot;, &quot;hello&quot;, 42)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also create the task using a <code>constructorArgs</code> Map argument using the Project API:</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. Creating a task with constructor arguments using Map</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task myTask(<span class="key">type</span>: CustomTask, <span class="key">constructorArgs</span>: [<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">42</span>])</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">task(&quot;myTask&quot;, &quot;type&quot; to CustomTask::class.java, &quot;constructorArgs&quot; to listOf(&quot;hello&quot;, 42))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Prefer creating a task with constructor arguments using the TaskContainer</div>
<div class="paragraph">
<p>It&#8217;s recommended to use the <a href="task_configuration_avoidance.html">Task Configuration Avoidance</a> APIs to improve configuration time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In all circumstances, the values passed as constructor arguments must be non-null.
If you attempt to pass a <code>null</code> value, Gradle will throw a <code>NullPointerException</code> indicating which runtime value is <code>null</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:adding_dependencies_to_tasks"><a class="anchor" href="#sec:adding_dependencies_to_tasks"></a><a class="link" href="#sec:adding_dependencies_to_tasks">Adding dependencies to a task</a></h4>
<div class="paragraph">
<p>There are several ways you can define the dependencies of a task. In <a href="#sec:task_dependencies">Task dependencies</a> you were introduced to defining dependencies using task names. Task names can refer to tasks in the same project as the task, or to tasks in other projects. To refer to a task in another project, you prefix the name of the task with the path of the project it belongs to. The following is an example which adds a dependency from <code>projectA:taskX</code> to <code>projectB:taskY</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 64. Adding dependency on task from another project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project(<span class="string"><span class="delimiter">'</span><span class="content">projectA</span><span class="delimiter">'</span></span>) {
    task taskX {
        dependsOn <span class="string"><span class="delimiter">'</span><span class="content">:projectB:taskY</span><span class="delimiter">'</span></span>
        doLast {
            println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
        }
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">projectB</span><span class="delimiter">'</span></span>) {
    task taskY {
        doLast {
            println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">project(&quot;projectA&quot;) {
    tasks.register(&quot;taskX&quot;) {
        dependsOn(&quot;:projectB:taskY&quot;)
        doLast {
            println(&quot;taskX&quot;)
        }
    }
}

project(&quot;projectB&quot;) {
    tasks.register(&quot;taskY&quot;) {
        doLast {
            println(&quot;taskY&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskY
taskX</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Instead of using a task name, you can define a dependency using a <code>Task</code> object, as shown in this example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Adding dependency using task object</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}

task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}

taskX.dependsOn taskY</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}

val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}

taskX {
    dependsOn(taskY)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskY
taskX</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more advanced uses, you can define a task dependency using a lazy block. When evaluated, the block is passed the task whose dependencies are being calculated. The lazy block should return a single <code>Task</code> or collection of <code>Task</code> objects, which are then treated as dependencies of the task. The following example adds a dependency from <code>taskX</code> to all the tasks in the project whose name starts with <code>lib</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. Adding dependency using a lazy block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}

<span class="comment">// Using a Groovy Closure</span>
taskX.dependsOn {
    tasks.findAll { task -&gt; task.name.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span>) }
}

task lib1 {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">lib1</span><span class="delimiter">'</span></span>
    }
}

task lib2 {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">lib2</span><span class="delimiter">'</span></span>
    }
}

task notALib {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">notALib</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}

// Using a Gradle Provider
taskX {
    dependsOn(provider {
        tasks.filter { task -&gt; task.name.startsWith(&quot;lib&quot;) }
    })
}

tasks.register(&quot;lib1&quot;) {
    doLast {
        println(&quot;lib1&quot;)
    }
}

tasks.register(&quot;lib2&quot;) {
    doLast {
        println(&quot;lib2&quot;)
    }
}

tasks.register(&quot;notALib&quot;) {
    doLast {
        println(&quot;notALib&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
lib1
lib2
taskX</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information about task dependencies, see the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a> API.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ordering_tasks"><a class="anchor" href="#sec:ordering_tasks"></a><a class="link" href="#sec:ordering_tasks">Ordering tasks</a></h4>
<div class="paragraph">
<p>In some cases it is useful to control the <em>order</em> in which 2 tasks will execute, without introducing an explicit dependency between those tasks. The primary difference between a task <em>ordering</em> and a task <em>dependency</em> is that an ordering rule does not influence which tasks will be executed, only the order in which they will be executed.</p>
</div>
<div class="paragraph">
<p>Task ordering can be useful in a number of scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enforce sequential ordering of tasks: e.g. 'build' never runs before 'clean'.</p>
</li>
<li>
<p>Run build validations early in the build: e.g. validate I have the correct credentials before starting the work for a release build.</p>
</li>
<li>
<p>Get feedback faster by running quick verification tasks before long verification tasks: e.g. unit tests should run before integration tests.</p>
</li>
<li>
<p>A task that aggregates the results of all tasks of a particular type: e.g. test report task combines the outputs of all executed test tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two ordering rules available: <em>must run after</em> and <em>should run after</em>.</p>
</div>
<div class="paragraph">
<p>When you use the must run after ordering rule you specify that <code>taskB</code> must always run after <code>taskA</code>, whenever both <code>taskA</code> and <code>taskB</code> will be run. This is expressed as <code>taskB.mustRunAfter(taskA)</code>. The should run after ordering rule is similar but less strict as it will be ignored in two situations. Firstly if using that rule introduces an ordering cycle. Secondly when using parallel execution and all dependencies of a task have been satisfied apart from the should run after task, then this task will be run regardless of whether its should run after dependencies have been run or not. You should use should run after where the ordering is helpful but not strictly required.</p>
</div>
<div class="paragraph">
<p>With these rules present it is still possible to execute <code>taskA</code> without <code>taskB</code> and vice-versa.</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. Adding a 'must run after' task ordering</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}
taskY.mustRunAfter taskX</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}
val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}
taskY { mustRunAfter(taskX) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskY taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskY taskX
taskX
taskY</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 68. Adding a 'should run after' task ordering</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}
taskY.shouldRunAfter taskX</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}
val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}
taskY { shouldRunAfter(taskX) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskY taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskY taskX
taskX
taskY</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the examples above, it is still possible to execute <code>taskY</code> without causing <code>taskX</code> to run:</p>
</div>
<div class="exampleblock">
<div class="title">Example 69. Task ordering does not imply task execution</div>
<div class="content">
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskY</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskY
taskY</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To specify a must run after or should run after ordering between 2 tasks, you use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:mustRunAfter(java.lang.Object[])">Task.mustRunAfter(java.lang.Object...)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Task.html#shouldRunAfter-java.lang.Object...-">Task.shouldRunAfter(java.lang.Object...)</a> methods.
These methods accept a task instance, a task name or any other input accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn(java.lang.Object[])">Task.dependsOn(java.lang.Object...)</a>.</p>
</div>
<div class="paragraph">
<p>Note that <code>B.mustRunAfter(A)</code> or <code>B.shouldRunAfter(A)</code> does not imply any execution dependency between the tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is possible to execute tasks <code>A</code> and <code>B</code> independently. The ordering rule only has an effect when both tasks are scheduled for execution.</p>
</li>
<li>
<p>When run with <code>--continue</code>, it is possible for <code>B</code> to execute in the event that <code>A</code> fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As mentioned before, the should run after ordering rule will be ignored if it introduces an ordering cycle:</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. A 'should run after' task ordering is ignored if it introduces an ordering cycle</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}
task taskZ {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskZ</span><span class="delimiter">'</span></span>
    }
}
taskX.dependsOn taskY
taskY.dependsOn taskZ
taskZ.shouldRunAfter taskX</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}
val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}
val taskZ by tasks.registering {
    doLast {
        println(&quot;taskZ&quot;)
    }
}
taskX { dependsOn(taskY) }
taskY { dependsOn(taskZ) }
taskZ { shouldRunAfter(taskX) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskZ
taskY
taskX</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:adding_a_description_to_a_task"><a class="anchor" href="#sec:adding_a_description_to_a_task"></a><a class="link" href="#sec:adding_a_description_to_a_task">Adding a description to a task</a></h4>
<div class="paragraph">
<p>You can add a description to your task. This description is displayed when executing <code>gradle tasks</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 71. Adding a description to a task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copy(<span class="key">type</span>: Copy) {
   description <span class="string"><span class="delimiter">'</span><span class="content">Copies the resource directory to the target directory.</span><span class="delimiter">'</span></span>
   from <span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>
   into <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
   include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
   description = &quot;Copies the resource directory to the target directory.&quot;
   from(&quot;resources&quot;)
   into(&quot;target&quot;)
   include(&quot;**/*.txt&quot;, &quot;**/*.xml&quot;, &quot;**/*.properties&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:skipping_tasks"><a class="anchor" href="#sec:skipping_tasks"></a><a class="link" href="#sec:skipping_tasks">Skipping tasks</a></h4>
<div class="paragraph">
<p>Gradle offers multiple ways to skip the execution of a task.</p>
</div>
<div class="sect4">
<h5 id="sec:using_a_predicate"><a class="anchor" href="#sec:using_a_predicate"></a><a class="link" href="#sec:using_a_predicate">Using a predicate</a></h5>
<div class="paragraph">
<p>You can use the <code>onlyIf()</code> method to attach a predicate to a task. The task&#8217;s actions are only executed if the predicate evaluates to true. You implement the predicate as a closure. The closure is passed the task as a parameter, and should return true if the task should execute and false if the task should be skipped. The predicate is evaluated just before the task is due to be executed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 72. Skipping a task using a predicate</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">hello world</span><span class="delimiter">'</span></span>
    }
}

hello.onlyIf { !project.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">skipHello</span><span class="delimiter">'</span></span>) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val hello by tasks.registering {
    doLast {
        println(&quot;hello world&quot;)
    }
}

hello {
    onlyIf { !project.hasProperty(&quot;skipHello&quot;) }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle hello -PskipHello</code></strong></div>
<div class="content">
<pre>&gt; gradle hello -PskipHello
&gt; Task :hello SKIPPED

BUILD SUCCESSFUL in 0s</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_stopexecutionexception"><a class="anchor" href="#sec:using_stopexecutionexception"></a><a class="link" href="#sec:using_stopexecutionexception">Using StopExecutionException</a></h5>
<div class="paragraph">
<p>If the logic for skipping a task can&#8217;t be expressed with a predicate, you can use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/StopExecutionException.html">StopExecutionException</a>. If this exception is thrown by an action, the further execution of this action as well as the execution of any following action of this task is skipped. The build continues with executing the next task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. Skipping tasks with StopExecutionException</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task compile {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">We are doing the compile.</span><span class="delimiter">'</span></span>
    }
}

compile.doFirst {
    <span class="comment">// Here you would put arbitrary conditions in real life.</span>
    <span class="comment">// But this is used in an integration test so we want defined behavior.</span>
    <span class="keyword">if</span> (<span class="predefined-constant">true</span>) { <span class="keyword">throw</span> <span class="keyword">new</span> StopExecutionException() }
}
task myTask {
    dependsOn(<span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>)
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">I am not affected</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val compile by tasks.registering {
    doLast {
        println(&quot;We are doing the compile.&quot;)
    }
}

compile {
    doFirst {
        // Here you would put arbitrary conditions in real life.
        // But this is used in an integration test so we want defined behavior.
        if (true) {
            throw StopExecutionException()
        }
    }
}
tasks.register(&quot;myTask&quot;) {
    dependsOn(compile)
    doLast {
        println(&quot;I am not affected&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q myTask</code></strong></div>
<div class="content">
<pre>&gt; gradle -q myTask
I am not affected</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This feature is helpful if you work with tasks provided by Gradle. It allows you to add <em>conditional</em> execution of the built-in actions of such a task.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
</div>
<div class="sect4">
<h5 id="sec:enabling_and_disabling_tasks"><a class="anchor" href="#sec:enabling_and_disabling_tasks"></a><a class="link" href="#sec:enabling_and_disabling_tasks">Enabling and disabling tasks</a></h5>
<div class="paragraph">
<p>Every task has an <code>enabled</code> flag which defaults to <code>true</code>. Setting it to <code>false</code> prevents the execution of any of the task&#8217;s actions. A disabled task will be labelled SKIPPED.</p>
</div>
<div class="exampleblock">
<div class="title">Example 74. Enabling and disabling tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task disableMe {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">This should not be printed if the task is disabled.</span><span class="delimiter">'</span></span>
    }
}
disableMe.enabled = <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val disableMe by tasks.registering {
    doLast {
        println(&quot;This should not be printed if the task is disabled.&quot;)
    }
}
disableMe {
    enabled = false
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle disableMe</code></strong></div>
<div class="content">
<pre>&gt; gradle disableMe
&gt; Task :disableMe SKIPPED

BUILD SUCCESSFUL in 0s</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_timeouts"><a class="anchor" href="#sec:task_timeouts"></a><a class="link" href="#sec:task_timeouts">Task timeouts</a></h5>
<div class="paragraph">
<p>Every task has a <code>timeout</code> property which can be used to limit its execution time.
When a task reaches its timeout, its task execution thread is interrupted.
The task will be marked as failed. Finalizer tasks will still be run.
If <code>--continue</code> is used, other tasks can continue running after it.
Tasks that don&#8217;t respond to interrupts can&#8217;t be timed out.
All of Gradle&#8217;s built-in tasks respond to timeouts in a timely manner.</p>
</div>
<div class="exampleblock">
<div class="title">Example 75. Specifying task timeouts</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hangingTask() {
    doLast {
        <span class="predefined-type">Thread</span>.sleep(<span class="integer">100000</span>)
    }
    timeout = <span class="predefined-type">Duration</span>.ofMillis(<span class="integer">500</span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import java.time.Duration

tasks {
    register(&quot;hangingTask&quot;) {
        doLast {
            Thread.sleep(100000)
        }
        timeout.set(Duration.ofMillis(500))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:up_to_date_checks"><a class="anchor" href="#sec:up_to_date_checks"></a><a class="link" href="#sec:up_to_date_checks">Up-to-date checks (AKA Incremental Build)</a></h4>
<div class="paragraph">
<p>An important part of any build tool is the ability to avoid doing work that has already been done. Consider the process of compilation. Once your source files have been compiled, there should be no need to recompile them unless something has changed that affects the output, such as the modification of a source file or the removal of an output file. And compilation can take a significant amount of time, so skipping the step when its not needed saves a lot of time.</p>
</div>
<div class="paragraph">
<p>Gradle supports this behavior out of the box through a feature it calls incremental build. You have almost certainly already seen it in action: its active nearly every time the <code>UP-TO-DATE</code> text appears next to the name of a task when you run a build. Task outcomes are described in <a href="#sec:task_outcomes">Task outcomes</a>.</p>
</div>
<div class="paragraph">
<p>How does incremental build work? And what does it take to make use of it in your own tasks? Lets take a look.</p>
</div>
<div class="sect4">
<h5 id="sec:task_inputs_outputs"><a class="anchor" href="#sec:task_inputs_outputs"></a><a class="link" href="#sec:task_inputs_outputs">Task inputs and outputs</a></h5>
<div class="paragraph">
<p>In the most common case, a task takes some inputs and generates some outputs. If we use the compilation example from earlier, we can see that the source files are the inputs and, in the case of Java, the generated class files are the outputs. Other inputs might include things like whether debug information should be included.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/taskInputsOutputs.png" alt="taskInputsOutputs">
</div>
<div class="title">Figure 7. Example task inputs and outputs</div>
</div>
<div class="paragraph">
<p>An important characteristic of an input is that it affects one or more outputs, as you can see from the previous figure. Different bytecode is generated depending on the content of the source files and the minimum version of the Java runtime you want to run the code on. That makes them task inputs. But whether compilation has 500MB or 600MB of maximum memory available, determined by the <code>memoryMaximumSize</code> property, has no impact on what bytecode gets generated. In Gradle terminology, <code>memoryMaximumSize</code> is just an internal task property.</p>
</div>
<div class="paragraph">
<p>As part of incremental build, Gradle tests whether any of the task inputs or outputs has changed since the last build. If they havent, Gradle can consider the task up to date and therefore skip executing its actions. Also note that incremental build wont work unless a task has at least one task output, although tasks usually have at least one input as well.</p>
</div>
<div class="paragraph">
<p>What this means for build authors is simple: you need to tell Gradle which task properties are inputs and which are outputs. If a task property affects the output, be sure to register it as an input, otherwise the task will be considered up to date when its not. Conversely, dont register properties as inputs if they dont affect the output, otherwise the task will potentially execute when it doesnt need to. Also be careful of non-deterministic tasks that may generate different output for exactly the same inputs: these should not be configured for incremental build as the up-to-date checks wont work.</p>
</div>
<div class="paragraph">
<p>Lets now look at how you can register task properties as inputs and outputs.</p>
</div>
<div class="sect5">
<h6 id="sec:task_input_output_annotations"><a class="anchor" href="#sec:task_input_output_annotations"></a><a class="link" href="#sec:task_input_output_annotations">Custom task types</a></h6>
<div class="paragraph">
<p>If youre implementing a custom task as a class, then it takes just two steps to make it work with incremental build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create typed properties (via getter methods) for each of your task inputs and outputs</p>
</li>
<li>
<p>Add the appropriate annotation to each of those properties</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Annotations must be placed on getters or on Groovy properties. Annotations placed on setters, or on a Java field without a corresponding annotated getter, are ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle supports three main categories of inputs and outputs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple values</p>
<div class="paragraph">
<p>Things like strings and numbers. More generally, a simple value can have any type that implements <code>Serializable</code>.</p>
</div>
</li>
<li>
<p>Filesystem types</p>
<div class="paragraph">
<p>These consist of the standard <code>File</code> class but also derivatives of Gradles <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a> type and anything else that can be passed to either the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method  for single file/directory properties  or the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object...)</a> method.</p>
</div>
</li>
<li>
<p>Nested values</p>
<div class="paragraph">
<p>Custom types that dont conform to the other two categories but have their own properties that are inputs or outputs. In effect, the task inputs or outputs are nested inside these custom types.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, imagine you have a task that processes templates of varying types, such as FreeMarker, Velocity, Moustache, etc. It takes template source files and combines them with some model data to generate populated versions of the template files.</p>
</div>
<div class="paragraph">
<p>This task will have three inputs and one output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Template source files</p>
</li>
<li>
<p>Model data</p>
</li>
<li>
<p>Template engine</p>
</li>
<li>
<p>Where the output files are written</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When youre writing a custom task class, its easy to register properties as inputs or outputs via annotations. To demonstrate, here is a skeleton task implementation with some suitable inputs and outputs, along with their annotations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 76. Custom task class</div>
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example</span>;

<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api</span>.*;
<span class="keyword">import</span> <span class="include">org.gradle.api.file</span>.*;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ProcessTemplates</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> TemplateEngineType templateEngine;
    <span class="directive">private</span> FileCollection sourceFiles;
    <span class="directive">private</span> TemplateData templateData;
    <span class="directive">private</span> <span class="predefined-type">File</span> outputDir;

    <span class="annotation">@Input</span>
    <span class="directive">public</span> TemplateEngineType getTemplateEngine() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.templateEngine;
    }

    <span class="annotation">@InputFiles</span>
    <span class="directive">public</span> FileCollection getSourceFiles() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.sourceFiles;
    }

    <span class="annotation">@Nested</span>
    <span class="directive">public</span> TemplateData getTemplateData() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.templateData;
    }

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">public</span> <span class="predefined-type">File</span> getOutputDir() { <span class="keyword">return</span> <span class="local-variable">this</span>.outputDir; }

    <span class="comment">// + setter methods for the above - assume weve defined them</span>

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> processTemplates() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/TemplateData.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example</span>;

<span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TemplateData</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; variables;

    <span class="directive">public</span> TemplateData(<span class="predefined-type">String</span> name, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; variables) {
        <span class="local-variable">this</span>.name = name;
        <span class="local-variable">this</span>.variables = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;(variables);
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() { <span class="keyword">return</span> <span class="local-variable">this</span>.name; }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; getVariables() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.variables;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code></div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates


BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code> (run again)</div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates UP-TO-DATE

BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Theres plenty to talk about in this example, so lets work through each of the input and output properties in turn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>templateEngine</code></p>
<div class="paragraph">
<p>Represents which engine to use when processing the source templates, e.g. FreeMarker, Velocity, etc. You could implement this as a string, but in this case we have gone for a custom enum as it provides greater type information and safety. Since enums implement <code>Serializable</code> automatically, we can treat this as a simple value and use the <code>@Input</code> annotation, just as we would with a <code>String</code> property.</p>
</div>
</li>
<li>
<p><code>sourceFiles</code></p>
<div class="paragraph">
<p>The source templates that the task will be processing. Single files and collections of files need their own special annotations. In this case, were dealing with a collection of input files and so we use the <code>@InputFiles</code> annotation. Youll see more file-oriented annotations in a table later.</p>
</div>
</li>
<li>
<p><code>templateData</code></p>
<div class="paragraph">
<p>For this example, were using a custom class to represent the model data. However, it does not implement <code>Serializable</code>, so we cant use the <code>@Input</code> annotation. Thats not a problem as the properties within <code>TemplateData</code>  a string and a hash map with serializable type parameters  are serializable and can be annotated with <code>@Input</code>. We use <code>@Nested</code> on <code>templateData</code> to let Gradle know that this is a value with nested input properties.</p>
</div>
</li>
<li>
<p><code>outputDir</code></p>
<div class="paragraph">
<p>The directory where the generated files go. As with input files, there are several annotations for output files and directories. A property representing a single directory requires <code>@OutputDirectory</code>. Youll learn about the others soon.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These annotated properties mean that Gradle will skip the task if none of the source files, template engine, model data or generated files has changed since the previous time Gradle executed the task. This will often save a significant amount of time. You can learn how Gradle detects <a href="#sec:how_does_it_work">changes later</a>.</p>
</div>
<div class="paragraph">
<p>This example is particularly interesting because it works with collections of source files. What happens if only one source file changes? Does the task process all the source files again or just the modified one? That depends on the task implementation. If the latter, then the task itself is incremental, but thats a different feature to the one were discussing here. Gradle does help task implementers with this via its <a href="#incremental_tasks">incremental task inputs</a> feature.</p>
</div>
<div class="paragraph">
<p>Now that you have seen some of the input and output annotations in practice, lets take a look at all the annotations available to you and when you should use them. The table below lists the available annotations and the corresponding property type you can use with each one.</p>
</div>
<table id="table:incremental_build_annotations" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Incremental build property type annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Expected property type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Input.html">Input</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any <code>Serializable</code> type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A simple input value</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/InputFile.html">InputFile</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single input file (not directory)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/InputDirectory.html">InputDirectory</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single input directory (not file)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/InputFiles.html">InputFiles</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories that represent a Java classpath. This allows the task to ignore irrelevant changes to the property, such as different names for the same files. It is similar to annotating the property <code>@PathSensitive(RELATIVE)</code> but it will ignore the names of JAR files directly added to the classpath, and it will consider changes in the order of the files as a change in the classpath. Gradle will inspect the contents of jar files on the classpath and ignore changes that do not affect the semantics of the classpath (such as file dates and entry order). See also <a href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a>.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The <code>@Classpath</code> annotation was introduced in Gradle 3.2. To stay compatible with earlier Gradle versions, classpath properties should also be annotated with <code>@InputFiles</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/CompileClasspath.html">CompileClasspath</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of input files and directories that represent a Java compile classpath. This allows the task to ignore irrelevant changes that do not affect the API of the classes in classpath. See also <a href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a>.</p>
</div>
<div class="paragraph">
<p>The following kinds of changes to the classpath will be ignored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to the path of jar or top level directories.</p>
</li>
<li>
<p>Changes to timestamps and the order of entries in Jars.</p>
</li>
<li>
<p>Changes to resources and Jar manifests, including adding or removing resources.</p>
</li>
<li>
<p>Changes to private class elements, such as private fields, methods and inner classes.</p>
</li>
<li>
<p>Changes to code, such as method bodies, static initializers and field initializers (except for constants).</p>
</li>
<li>
<p>Changes to debug information, for example when a change to a comment affects the line numbers in class debug information.</p>
</li>
<li>
<p>Changes to directories, including directory entries in Jars.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@CompileClasspath</code> annotation was introduced in Gradle 3.4. To stay compatible with Gradle 3.3 and 3.2, compile classpath properties should also be annotated with <code>@Classpath</code>. For compatibility with Gradle versions before 3.2 the property should also be annotated with <code>@InputFiles</code>.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/OutputFile.html">OutputFile</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single output file (not directory)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/OutputDirectory.html">OutputDirectory</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A single output directory (not file)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/OutputFiles.html">OutputFiles</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, File&gt;</code>** or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable or map of output files.
Using a file tree turns <a href="#sec:task_output_caching">caching</a> off for the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/OutputDirectories.html">OutputDirectories</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Map&lt;String, File&gt;</code>** or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An iterable of output directories.
Using a file tree turns <a href="#sec:task_output_caching">caching</a> off for the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Destroys.html">Destroys</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies one or more files that are removed by this task.  Note that a task can define either inputs/outputs or destroyables, but not both.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/LocalState.html">LocalState</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code> or <code>Iterable&lt;File&gt;</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies one or more files that represent the <a href="#sec:storing_incremental_task_state">local state of the task</a>. These files are removed when the task is loaded from cache.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any custom type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A custom type that may not implement <code>Serializable</code> but does have at least one field or property marked with one of the annotations in this table. It could even be another <code>@Nested</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Console.html">Console</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property is neither an input nor an output. It simply affects the console output of the task in some way, such as increasing or decreasing the verbosity of the task.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Internal.html">Internal</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property is used internally but is neither an input nor an output.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ReplacedBy.html">ReplacedBy</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates that the property has been replaced by another and should be ignored as an input or output.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="skip-when-empty"></a><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/SkipWhenEmpty.html">SkipWhenEmpty</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code> or <code>@InputDirectory</code> to tell Gradle to skip the task if the corresponding files or directory are empty, along with all other input files declared with this annotation. Tasks that have been skipped due to all of their input files that were declared with this annotation being empty will result in a distinct no source outcome. For example, <code>NO-SOURCE</code> will be emitted in the console output.</p>
</div>
<div class="paragraph">
<p>Implies <code><a href="#incremental">@Incremental</a></code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="incremental"></a><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/Incremental.html">Incremental</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Provider&lt;FileSystemLocation&gt;</code> or <code>FileCollection</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with <code>@InputFiles</code> or <code>@InputDirectory</code> to instruct Gradle to track changes to the annotated file property, so the changes can be queried via <code>@<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges.getFileChanges()</a></code>. Required for <a href="#incremental_tasks">incremental tasks</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Optional.html">Optional</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used with any of the property type annotations listed in the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Optional.html">Optional</a> API documentation. This annotation disables validation checks on the corresponding property. See <a href="#sec:task_input_output_validation">the section on validation</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/PathSensitive.html">PathSensitive</a></code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code>*</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="inputs_path_sensitivity"></a>Used with any input file property to tell Gradle to only consider the given part of the file paths as important. For example, if a property is annotated with <code>@PathSensitive(PathSensitivity.NAME_ONLY)</code>, then moving the files around without changing their contents will not make the task out-of-date.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
*
</td>
<td class="hdlist2">
<p>In fact, <code>File</code> can be any type accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> and <code>Iterable&lt;File&gt;</code> can be any type accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a>.
This includes instances of <code>Callable</code>, such as closures, allowing for lazy evaluation of the property values.
Be aware that the types <code>FileCollection</code> and <code>FileTree</code> are <code>Iterable&lt;File&gt;</code>s.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
**
</td>
<td class="hdlist2">
<p>Similar to the above, <code>File</code> can be any type accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a>. The <code>Map</code> itself can be wrapped in <code>Callable</code>s, such as closures.</p>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Annotations are inherited from all parent types including implemented interfaces. Property type annotations override any other property type annotation declared in a parent type. This way an <code>@InputFile</code> property can be turned into an <code>@InputDirectory</code> property in a child task type.</p>
</div>
<div class="paragraph">
<p>Annotations on a property declared in a type override similar annotations declared by the superclass and in any implemented interfaces. Superclass annotations take precedence over annotations declared in implemented interfaces.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Console.html">Console</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Internal.html">Internal</a> annotations in the table are special cases as they dont declare either task inputs or task outputs. So why use them? It&#8217;s so that you can take advantage of the <a href="#java_gradle_plugin">Java Gradle Plugin Development plugin</a> to help you develop and publish your own plugins. This plugin checks whether any properties of your custom task classes lack an incremental build annotation. This protects you from forgetting to add an appropriate annotation during development.</p>
</div>
<div class="sect6">
<h7 id="sec:task_input_using_classpath_annotations"><a class="anchor" href="#sec:task_input_using_classpath_annotations"></a><a class="link" href="#sec:task_input_using_classpath_annotations">Using the classpath annotations</a></h7>
<div class="paragraph">
<p>Besides <code>@InputFiles</code>, for JVM-related tasks Gradle understands the concept of classpath inputs. Both runtime and compile classpaths are treated differently when Gradle is looking for changes.</p>
</div>
<div class="paragraph">
<p>As opposed to input properties annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/InputFiles.html">InputFiles</a></code>, for classpath properties the order of the entries in the file collection matter.
On the other hand, the names and paths of the directories and jar files on the classpath itself are ignored.
Timestamps and the order of class files and resources inside jar files on a classpath are ignored, too, thus recreating a jar file with different file dates will not make the task out of date.</p>
</div>
<div class="paragraph">
<p>Runtime classpaths are marked with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code>, and they offer further customization via <a href="#sec:configure_input_normalization">classpath normalization</a>.</p>
</div>
<div class="paragraph">
<p>Input properties annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/CompileClasspath.html">CompileClasspath</a></code> are considered Java compile classpaths.
Additionally to the aforementioned general classpath rules, compile classpaths ignore changes to everything but class files. Gradle uses the same class analysis described in <a href="#sec:java_compile_avoidance">Java compile avoidance</a> to further filter changes that don&#8217;t affect the class' ABIs.
This means that changes which only touch the implementation of classes do not make the task out of date.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:task_input_nested_inputs"><a class="anchor" href="#sec:task_input_nested_inputs"></a><a class="link" href="#sec:task_input_nested_inputs">Nested inputs</a></h7>
<div class="paragraph">
<p>When analyzing <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> task properties for declared input and output sub-properties Gradle uses the type of the actual value.
Hence it can discover all sub-properties declared by a runtime sub-type.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to a <code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a></code>, the value of the <code>Provider</code> is treated as a nested input.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to an iterable, each element is treated as a separate nested input.
Each nested input in the iterable is assigned a name, which by default is the dollar sign followed by the index in the iterable, e.g. <code>$2</code>.
If an element of the iterable implements <code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Named.html">Named</a></code>, then the name is used as property name.
The ordering of the elements in the iterable is crucial for for reliable up-to-date checks and caching if not all of the elements implement <code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Named.html">Named</a></code>.
Multiple elements which have the same name are not allowed.</p>
</div>
<div class="paragraph">
<p>When adding <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code> to a map, then for each value a nested input is added, using the key as name.</p>
</div>
<div class="paragraph">
<p>The type and classpath of nested inputs is tracked, too.
This ensures that changes to the implementation of a nested input causes the build to be out of date.
By this it is also possible to add user provided code as an input, e.g. by annotating an <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Action.html">Action</a></code> property with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.
Note that any inputs to such actions should be tracked, either by annotated properties on the action or by manually registering them with the task.</p>
</div>
<div class="paragraph">
<p>Using nested inputs allows richer modeling and extensibility for tasks, as e.g. shown by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:jvmArgumentProviders">Test.getJvmArgumentProviders()</a>.</p>
</div>
<div class="paragraph">
<p>This allows us to model the JaCoCo Java agent, thus declaring the necessary JVM arguments and providing the inputs and outputs to Gradle:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">JacocoAgent.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">JacocoAgent</span> <span class="directive">implements</span> CommandLineArgumentProvider {
    <span class="directive">private</span> <span class="directive">final</span> JacocoTaskExtension jacoco;

    <span class="directive">public</span> JacocoAgent(JacocoTaskExtension jacoco) {
        <span class="local-variable">this</span>.jacoco = jacoco;
    }

    <span class="annotation">@Nested</span>
    <span class="annotation">@Optional</span>
    <span class="directive">public</span> JacocoTaskExtension getJacoco() {
        <span class="keyword">return</span> jacoco.isEnabled() ? jacoco : <span class="predefined-constant">null</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;<span class="predefined-type">String</span>&gt; asArguments() {
        <span class="keyword">return</span> jacoco.isEnabled() ? ImmutableList.of(jacoco.getAsJvmArg()) : <span class="predefined-type">Collections</span>.&lt;<span class="predefined-type">String</span>&gt;emptyList();
    }
}

test.getJvmArgumentProviders().add(<span class="keyword">new</span> JacocoAgent(extension));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For this to work, <code><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.plugins.JacocoTaskExtension.html">JacocoTaskExtension</a></code> needs to have the correct input and output annotations.</p>
</div>
<div class="paragraph">
<p>The approach works for Test JVM arguments, since <code><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:jvmArgumentProviders">Test.getJvmArgumentProviders()</a></code> is an <code>Iterable</code> annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.</p>
</div>
<div class="paragraph">
<p>There are other task types where this kind of nested inputs are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.JavaExec.html#org.gradle.api.tasks.JavaExec:argumentProviders">JavaExec.getArgumentProviders()</a> - model e.g. custom tools</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.JavaExec.html#org.gradle.api.tasks.JavaExec:jvmArgumentProviders">JavaExec.getJvmArgumentProviders()</a> - used for Jacoco Java agent</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.CompileOptions.html#org.gradle.api.tasks.compile.CompileOptions:compilerArgumentProviders">CompileOptions.getCompilerArgumentProviders()</a> - model e.g annotation processors</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Exec.html#org.gradle.api.tasks.Exec:argumentProviders">Exec.getArgumentProviders()</a> - model e.g custom tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the same way, this kind of modelling is available to custom tasks.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:task_input_validation"><a class="anchor" href="#sec:task_input_validation"></a><a class="link" href="#sec:task_input_validation">Runtime validation</a></h7>
<div class="paragraph">
<p>When executing the build Gradle checks if task types are declared with the proper annotations.
It tries to identify problems where e.g. annotations are used on incompatible types, or on setters etc.
Any getter not annotated with an input/output annotation is also flagged.
These problems are then turned into deprecation warnings when the task is executed.</p>
</div>
<div class="listingblock">
<div class="title">Example output with a task having undeclared inputs and outputs</div>
<div class="content">
<pre>&gt; gradle processTemplatesRuntime
&gt; Task :processTemplatesRuntime
Property 'outputDir' is not annotated with an input or output annotation. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.
Property 'sourceFiles' is not annotated with an input or output annotation. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.
Property 'templateData' is not annotated with an input or output annotation. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.
Property 'templateEngine' is not annotated with an input or output annotation. This behaviour has been deprecated and is scheduled to be removed in Gradle 7.0.


BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:task_input_output_runtime_api"><a class="anchor" href="#sec:task_input_output_runtime_api"></a><a class="link" href="#sec:task_input_output_runtime_api">Runtime API</a></h6>
<div class="paragraph">
<p>Custom task classes are an easy way to bring your own build logic into the arena of incremental build, but you dont always have that option. That&#8217;s why Gradle also provides an alternative API that can be used with any tasks, which we look at next.</p>
</div>
<div class="paragraph">
<p>When you dont have access to the source for a custom task class, there is no way to add any of the annotations we covered in the previous section. Fortunately, Gradle provides a runtime API for scenarios just like that. It can also be used for ad-hoc tasks, as you&#8217;ll see next.</p>
</div>
<div class="sect6">
<h7 id="sec:runtime_api_for_adhoc"><a class="anchor" href="#sec:runtime_api_for_adhoc"></a><a class="link" href="#sec:runtime_api_for_adhoc">Using it for ad-hoc tasks</a></h7>
<div class="paragraph">
<p>This runtime API is provided through a couple of aptly named properties that are available on every Gradle task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:inputs">Task.getInputs()</a> of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputs.html">TaskInputs</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:outputs">Task.getOutputs()</a> of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html">TaskOutputs</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:destroyables">Task.getDestroyables()</a> of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskDestroyables.html">TaskDestroyables</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These objects have methods that allow you to specify files, directories and values which constitute the tasks inputs and outputs.
In fact, the runtime API has almost feature parity with the annotations.
All it lacks is an equivalent for <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.</p>
</div>
<div class="paragraph">
<p>Lets take the template processing example from before and see how it would look as an ad-hoc task that uses the runtime API:</p>
</div>
<div class="exampleblock">
<div class="title">Example 77. Ad-hoc task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task processTemplatesAdHoc {
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">engine</span><span class="delimiter">&quot;</span></span>, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/templates</span><span class="delimiter">&quot;</span></span>))
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceFiles</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">templateData.name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">docs</span><span class="delimiter">&quot;</span></span>)
    inputs.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">templateData.variables</span><span class="delimiter">&quot;</span></span>, [<span class="key">year</span>: <span class="integer">2013</span>])
    outputs.dir(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/genOutput2</span><span class="delimiter">&quot;</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputDir</span><span class="delimiter">&quot;</span></span>)

    doLast {
        <span class="comment">// Process the templates here</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;processTemplatesAdHoc&quot;) {
    inputs.property(&quot;engine&quot;, TemplateEngineType.FREEMARKER)
    inputs.files(fileTree(&quot;src/templates&quot;))
        .withPropertyName(&quot;sourceFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    inputs.property(&quot;templateData.name&quot;, &quot;docs&quot;)
    inputs.property(&quot;templateData.variables&quot;, mapOf(&quot;year&quot; to &quot;2013&quot;))
    outputs.dir(&quot;$buildDir/genOutput2&quot;)
        .withPropertyName(&quot;outputDir&quot;)

    doLast {
        // Process the templates here
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle processTemplatesAdHoc</code></strong></div>
<div class="content">
<pre>&gt; gradle processTemplatesAdHoc
&gt; Task :processTemplatesAdHoc

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As before, theres much to talk about. To begin with, you should really write a custom task class for this as its a non-trivial implementation that has several configuration options. In this case, there are no task properties to store the root source folder, the location of the output directory or any of the other settings. Thats deliberate to highlight the fact that the runtime API doesnt require the task to have any state. In terms of incremental build, the above ad-hoc task will behave the same as the custom task class.</p>
</div>
<div class="paragraph">
<p>All the input and output definitions are done through the methods on <code>inputs</code> and <code>outputs</code>, such as <code>property()</code>, <code>files()</code>, and <code>dir()</code>.
Gradle performs up-to-date checks on the argument values to determine whether the task needs to run again or not.
Each method corresponds to one of the incremental build annotations, for example <code>inputs.property()</code> maps to <code>@Input</code> and <code>outputs.dir()</code> maps to <code>@OutputDirectory</code>.</p>
</div>
<div class="paragraph">
<p>The files that a task removes can be specified through <code>destroyables.register()</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. Ad-hoc task declaring a destroyable</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task removeTempDir {
    destroyables.register(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>projectDir</span><span class="content">/tmpDir</span><span class="delimiter">&quot;</span></span>)
    doLast {
        delete(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>projectDir</span><span class="content">/tmpDir</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;removeTempDir&quot;) {
    destroyables.register(&quot;$projectDir/tmpDir&quot;)
    doLast {
        delete(&quot;$projectDir/tmpDir&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One notable difference between the runtime API and the annotations is the lack of a method that corresponds directly to <code>@Nested</code>. Thats why the example uses two <code>property()</code> declarations for the template data, one for each <code>TemplateData</code> property. You should utilize the same technique when using the runtime API with nested values.  Any given task can either declare destroyables or inputs/outputs, but cannot declare both.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:runtime_api_configuration"><a class="anchor" href="#sec:runtime_api_configuration"></a><a class="link" href="#sec:runtime_api_configuration">Fine-grained configuration</a></h7>
<div class="paragraph">
<p>The runtime API methods only allow you to declare your inputs and outputs in themselves. However, the file-oriented ones return a builder  of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskInputFilePropertyBuilder.html">TaskInputFilePropertyBuilder</a>  that lets you provide additional information about those inputs and outputs.</p>
</div>
<div class="paragraph">
<p>You can learn about all the options provided by the builder in its API documentation, but well show you a simple example here to give you an idea of what you can do.</p>
</div>
<div class="paragraph">
<p>Lets say we dont want to run the <code>processTemplates</code> task if there are no source files, regardless of whether its a clean build or not. After all, if there are no source files, theres nothing for the task to do. The builder allows us to configure this like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 79. Using skipWhenEmpty() via the runtime API</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task processTemplatesAdHocSkipWhenEmpty {
    <span class="comment">// ...</span>

    inputs.files(fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/templates</span><span class="delimiter">&quot;</span></span>) {
            include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.fm</span><span class="delimiter">&quot;</span></span>
        })
        .skipWhenEmpty()
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceFiles</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;processTemplatesAdHocSkipWhenEmpty&quot;) {
    // ...

    inputs.files(fileTree(&quot;src/templates&quot;) {
            include(&quot;**/*.fm&quot;)
        })
        .skipWhenEmpty()
        .withPropertyName(&quot;sourceFiles&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)

    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean processTemplatesAdHocSkipWhenEmpty</code></strong></div>
<div class="content">
<pre>&gt; gradle clean processTemplatesAdHocSkipWhenEmpty
&gt; Task :processTemplatesAdHocSkipWhenEmpty NO-SOURCE


BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>TaskInputs.files()</code> method returns a builder that has a <code>skipWhenEmpty()</code> method. Invoking this method is equivalent to annotating to the property with <a href="#skip-when-empty"><code>@SkipWhenEmpty</code></a>.</p>
</div>
<div class="paragraph">
<p>Now that you have seen both the annotations and the runtime API, you may be wondering which API you should be using. Our recommendation is to use the annotations wherever possible, and its sometimes worth creating a custom task class just so that you can make use of them. The runtime API is more for situations in which you cant use the annotations.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:runtime_api_for_custom_tasks"><a class="anchor" href="#sec:runtime_api_for_custom_tasks"></a><a class="link" href="#sec:runtime_api_for_custom_tasks">Using it for custom task types</a></h7>
<div class="paragraph">
<p>Another type of example involves registering additional inputs and outputs for instances of a custom task class.
For example, imagine that the <code>ProcessTemplates</code> task also needs to read <code>src/headers/headers.txt</code> (e.g. because it is included from one of the sources).
You&#8217;d want Gradle to know about this input file, so that it can re-execute the task whenever the contents of this file change.
With the runtime API you can do just that:</p>
</div>
<div class="exampleblock">
<div class="title">Example 80. Using runtime API with custom task type</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task processTemplatesWithExtraInputs(<span class="key">type</span>: ProcessTemplates) {
    <span class="comment">// ...</span>

    inputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/headers/headers.txt</span><span class="delimiter">&quot;</span></span>)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">headers</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.NONE)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplatesWithExtraInputs&quot;) {
    // ...

    inputs.file(&quot;src/headers/headers.txt&quot;)
        .withPropertyName(&quot;headers&quot;)
        .withPathSensitivity(PathSensitivity.NONE)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the runtime API like this is a little like using <code>doLast()</code> and <code>doFirst()</code> to attach extra actions to a task, except in this case were attaching information about inputs and outputs.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the task type is already using the incremental build annotations, registering inputs or outputs with the same property names will result in an error.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:task_input_output_side_effects"><a class="anchor" href="#sec:task_input_output_side_effects"></a><a class="link" href="#sec:task_input_output_side_effects">Important beneficial side effects</a></h6>
<div class="paragraph">
<p>Once you declare a tasks formal inputs and outputs, Gradle can then infer things about those properties. For example, if an input of one task is set to the output of another, that means the first task depends on the second, right? Gradle knows this and can act upon it.</p>
</div>
<div class="paragraph">
<p>Well look at this feature next and also some other features that come from Gradle knowing things about inputs and outputs.</p>
</div>
<div class="sect6">
<h7 id="sec:inferred_task_dependencies"><a class="anchor" href="#sec:inferred_task_dependencies"></a><a class="link" href="#sec:inferred_task_dependencies">Inferred task dependencies</a></h7>
<div class="paragraph">
<p>Consider an archive task that packages the output of the <code>processTemplates</code> task. A build author will see that the archive task obviously requires <code>processTemplates</code> to run first and so may add an explicit <code>dependsOn</code>. However, if you define the archive task like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 81. Inferred task dependency via task outputs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task packageFiles(<span class="key">type</span>: Zip) {
    from processTemplates.outputs
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageFiles&quot;) {
    from(processTemplates.get().outputs)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean packageFiles</code></strong></div>
<div class="content">
<pre>&gt; gradle clean packageFiles
&gt; Task :processTemplates
&gt; Task :packageFiles


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will automatically make <code>packageFiles</code> depend on <code>processTemplates</code>. It can do this because its aware that one of the inputs of packageFiles requires the output of the processTemplates task. We call this an inferred task dependency.</p>
</div>
<div class="paragraph">
<p>The above example can also be written as</p>
</div>
<div class="exampleblock">
<div class="title">Example 82. Inferred task dependency via a task argument</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task packageFiles2(<span class="key">type</span>: Zip) {
    from processTemplates
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageFiles2&quot;) {
    from(processTemplates)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean packageFiles2</code></strong></div>
<div class="content">
<pre>&gt; gradle clean packageFiles2
&gt; Task :processTemplates
&gt; Task :packageFiles2


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is because the <code>from()</code> method can accept a task object as an argument. Behind the scenes, <code>from()</code> uses the <code>project.files()</code> method to wrap the argument, which in turn exposes the tasks formal outputs as a file collection. In other words, its a special case!</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:task_input_output_validation"><a class="anchor" href="#sec:task_input_output_validation"></a><a class="link" href="#sec:task_input_output_validation">Input and output validation</a></h7>
<div class="paragraph">
<p>The incremental build annotations provide enough information for Gradle to perform some basic validation on the annotated properties. In particular, it does the following for each property before the task executes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@InputFile</code> - verifies that the property has a value and that the path corresponds to a file (not a directory) that exists.</p>
</li>
<li>
<p><code>@InputDirectory</code> - same as for <code>@InputFile</code>, except the path must correspond to a directory.</p>
</li>
<li>
<p><code>@OutputDirectory</code> - verifies that the path doesnt match a file and also creates the directory if it doesnt already exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Such validation improves the robustness of the build, allowing you to identify issues related to inputs and outputs quickly.</p>
</div>
<div class="paragraph">
<p>You will occasionally want to disable some of this validation, specifically when an input file may validly not exist. Thats why Gradle provides the <code>@Optional</code> annotation: you use it to tell Gradle that a particular input is optional and therefore the build should not fail if the corresponding file or directory doesnt exist.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:task_input_output_continuous_build"><a class="anchor" href="#sec:task_input_output_continuous_build"></a><a class="link" href="#sec:task_input_output_continuous_build">Continuous build</a></h7>
<div class="paragraph">
<p>Another benefit of defining task inputs and outputs is continuous build. Since Gradle knows what files a task depends on, it can automatically run a task again if any of its inputs change. By activating continuous build when you run Gradle  through the <code>--continuous</code> or <code>-t</code> options  you will put Gradle into a state in which it continually checks for changes and executes the requested tasks when it encounters such changes.</p>
</div>
<div class="paragraph">
<p>You can find out more about this feature in <a href="#sec:continuous_build">Continuous build</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:task_input_output_parallelism"><a class="anchor" href="#sec:task_input_output_parallelism"></a><a class="link" href="#sec:task_input_output_parallelism">Task parallelism</a></h7>
<div class="paragraph">
<p>One last benefit of defining task inputs and outputs is that Gradle can use this information to make decisions about how to run tasks when the "--parallel" option is used.  For instance, Gradle will inspect the outputs of tasks when selecting the  next task to run and will avoid concurrent execution of tasks that write to the same output directory.  Similarly, Gradle will use the information about what files a task destroys (e.g. specified by the <code>Destroys</code> annotation) and avoid running a task that removes a set of files while another task is running that consumes or creates those same files (and vice versa).  It can also determine that a task that creates a set of files has already run and that a task that consumes those files has yet to run and will avoid running a task that removes those files in between.  By providing task input and output information in this way, Gradle can infer creation/consumption/destruction relationships between tasks and can ensure that task execution does not violate those relationships.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:how_does_it_work"><a class="anchor" href="#sec:how_does_it_work"></a><a class="link" href="#sec:how_does_it_work">How does it work?</a></h5>
<div class="paragraph">
<p>Before a task is executed for the first time, Gradle takes a fingerprint of the inputs.
This fingerprint contains the paths of input files and a hash of the contents of each file.
Gradle then executes the task.
If the task completes successfully, Gradle takes a fingerprint of the outputs.
This fingerprint contains the set of output files and a hash of the contents of each file.
Gradle persists both fingerprints for the next time the task is executed.</p>
</div>
<div class="paragraph">
<p>Each time after that, before the task is executed, Gradle takes a new fingerprint of the inputs and outputs.
If the new fingerprints are the same as the previous fingerprints, Gradle assumes that the outputs are up to date and skips the task.
If they are not the same, Gradle executes the task.
Gradle persists both fingerprints for the next time the task is executed.</p>
</div>
<div class="paragraph">
<p>If the stats of a file (i.e. <code>lastModified</code> and <code>size</code>) did not change, Gradle will reuse the file&#8217;s fingerprint from the previous run.
That means that Gradle does not detect changes when the stats of a file did not change.</p>
</div>
<div class="paragraph">
<p>Gradle also considers the <em>code</em> of the task as part of the inputs to the task. When a task, its actions, or its dependencies change between executions, Gradle considers the task as out-of-date.</p>
</div>
<div class="paragraph">
<p>Gradle understands if a file property (e.g. one holding a Java classpath) is order-sensitive. When comparing the fingerprint of such a property, even a change in the order of the files will result in the task becoming out-of-date.</p>
</div>
<div class="paragraph">
<p>Note that if a task has an output directory specified, any files added to that directory since the last time it was executed are ignored and will NOT cause the task to be out of date. This is so unrelated tasks may share an output directory without interfering with each other. If this is not the behaviour you want for some reason, consider using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-">TaskOutputs.upToDateWhen(groovy.lang.Closure)</a></p>
</div>
<div class="paragraph">
<p>Note also that changing the availability of an unavailable file (e.g. modifying the target of a broken symlink to a valid file, or vice versa), will be detected and handled by up-to-date check.</p>
</div>
<div class="paragraph">
<p>The inputs for the task are also used to calculate the <a href="#build_cache">build cache</a> key used to load task outputs when enabled. For more details see <a href="#sec:task_output_caching">Task output caching</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For tracking the implementation of tasks, task actions and nested inputs, Gradle uses the class name and an identifier for the classpath which contains the implementation.
There are some situations when Gradle is not able to track the implementation precisely:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unknown classloader</dt>
<dd>
<p>When the classloader which loaded the implementation has not been created by Gradle, the classpath cannot be determined.</p>
</dd>
<dt class="hdlist1">Java lambda</dt>
<dd>
<p>Java lambda classes are created at runtime with a non-deterministic classname.
Therefore, the class name does not identify the implementation of the lambda and changes between different Gradle runs.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When the implementation of a task, task action or a nested input cannot be tracked precisely, Gradle disables any caching for the task.
That means that the task will never be up-to-date or loaded from the <a href="#sec:task_output_caching">build cache</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:advanced_inc_build"><a class="anchor" href="#sec:advanced_inc_build"></a><a class="link" href="#sec:advanced_inc_build">Advanced techniques</a></h5>
<div class="paragraph">
<p>Everything youve seen so far in this section will cover most of the use cases youll encounter, but there are some scenarios that need special treatment. Well present a few of those next with the appropriate solutions.</p>
</div>
<div class="sect5">
<h6 id="sec:add_cached_input_output_methods"><a class="anchor" href="#sec:add_cached_input_output_methods"></a><a class="link" href="#sec:add_cached_input_output_methods">Adding your own cached input/output methods</a></h6>
<div class="paragraph">
<p>Have you ever wondered how the <code>from()</code> method of the <code>Copy</code> task works? Its not annotated with <code>@InputFiles</code> and yet any files passed to it are treated as formal inputs of the task. Whats happening?</p>
</div>
<div class="paragraph">
<p>The implementation is quite simple and you can use the same technique for your own tasks to improve their APIs. Write your methods so that they add files directly to the appropriate annotated property. As an example, heres how to add a <code>sources()</code> method to the custom <code>ProcessTemplates</code> class we introduced earlier:</p>
</div>
<div class="exampleblock">
<div class="title">Example 83. Declaring a method to add task inputs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task processTemplates(<span class="key">type</span>: ProcessTemplates) {
    templateEngine = TemplateEngineType.FREEMARKER
    templateData = <span class="keyword">new</span> TemplateData(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, [<span class="key">year</span>: <span class="integer">2012</span>])
    outputDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/genOutput</span><span class="delimiter">&quot;</span></span>)

    sources fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/templates</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplates&quot;) {
    templateEngine = TemplateEngineType.FREEMARKER
    templateData = TemplateData(&quot;test&quot;, mapOf(&quot;year&quot; to &quot;2012&quot;))
    outputDir = file(&quot;$buildDir/genOutput&quot;)

    sources(fileTree(&quot;src/templates&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ProcessTemplates</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// ...</span>
    <span class="directive">private</span> FileCollection sourceFiles = getProject().getLayout().files();

    <span class="annotation">@SkipWhenEmpty</span>
    <span class="annotation">@InputFiles</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.NONE)
    <span class="directive">public</span> FileCollection getSourceFiles() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.sourceFiles;
    }

    <span class="directive">public</span> <span class="type">void</span> sources(FileCollection sourceFiles) {
        <span class="local-variable">this</span>.sourceFiles = <span class="local-variable">this</span>.sourceFiles.plus(sourceFiles);
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates</code></div>
<div class="content">
<pre>&gt; gradle processTemplates
&gt; Task :processTemplates


BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other words, as long as you add values and files to formal task inputs and outputs during the configuration phase, they will be treated as such regardless from where in the build you add them.</p>
</div>
<div class="paragraph">
<p>If we want to support tasks as arguments as well and treat their outputs as the inputs, we can use the <code>project.layout.files()</code> method like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 84. Declaring a method to add a task as an input</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyTemplates(<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span>
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">src/templates</span><span class="delimiter">&quot;</span></span>
}

task processTemplates2(<span class="key">type</span>: ProcessTemplates) {
    <span class="comment">// ...</span>
    sources copyTemplates
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val copyTemplates by tasks.registering(Copy::class) {
    into(&quot;$buildDir/tmp&quot;)
    from(&quot;src/templates&quot;)
}

tasks.register&lt;ProcessTemplates&gt;(&quot;processTemplates2&quot;) {
    // ...
    sources(copyTemplates.get())
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">ProcessTemplates.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">// ...</span>
    <span class="directive">public</span> <span class="type">void</span> sources(Task inputTask) {
        <span class="local-variable">this</span>.sourceFiles = <span class="local-variable">this</span>.sourceFiles.plus(getProject().getLayout().files(inputTask));
    }
    <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle processTemplates2</code></div>
<div class="content">
<pre>&gt; gradle processTemplates2
&gt; Task :copyTemplates
&gt; Task :processTemplates2


BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique can make your custom task easier to use and result in cleaner build files.
As an added benefit, our use of <code>getProject().getLayout().files()</code> means that our custom method can set up an inferred task dependency.</p>
</div>
<div class="paragraph">
<p>One last thing to note: if you are developing a task that takes collections of source files as inputs, like this example, consider using the built-in <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceTask.html">SourceTask</a>. It will save you having to implement some of the plumbing that we put into <code>ProcessTemplates</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:link_output_dir_to_input_files"><a class="anchor" href="#sec:link_output_dir_to_input_files"></a><a class="link" href="#sec:link_output_dir_to_input_files">Linking an <code>@OutputDirectory</code> to an <code>@InputFiles</code></a></h6>
<div class="paragraph">
<p>When you want to link the output of one task to the input of another, the types often match and a simple property assignment will provide that link. For example, a <code>File</code> output property can be assigned to a <code>File</code> input.</p>
</div>
<div class="paragraph">
<p>Unfortunately, this approach breaks down when you want the files in a tasks <code>@OutputDirectory</code> (of type <code>File</code>) to become the source for another tasks <code>@InputFiles</code> property (of type <code>FileCollection</code>). Since the two have different types, property assignment wont work.</p>
</div>
<div class="paragraph">
<p>As an example, imagine you want to use the output of a Java compilation task  via the <code>destinationDir</code> property  as the input of a custom task that instruments a set of files containing Java bytecode. This custom task, which well call <code>Instrument</code>, has a <code>classFiles</code> property annotated with <code>@InputFiles</code>. You might initially try to configure the task like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 85. Failed attempt at setting up an inferred task dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

task badInstrumentClasses(<span class="key">type</span>: <span class="predefined-type">Instrument</span>) {
    classFiles = fileTree(compileJava.destinationDir)
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/instrumented</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

tasks.register&lt;Instrument&gt;(&quot;badInstrumentClasses&quot;) {
    classFiles = fileTree(tasks.compileJava.get().destinationDir)
    destinationDir = file(&quot;$buildDir/instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean badInstrumentClasses</code></strong></div>
<div class="content">
<pre>&gt; gradle clean badInstrumentClasses
&gt; Task :clean UP-TO-DATE
&gt; Task :badInstrumentClasses NO-SOURCE


BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Theres nothing obviously wrong with this code, but you can see from the console output that the compilation task is missing. In this case you would need to add an explicit task dependency between <code>instrumentClasses</code> and <code>compileJava</code> via <code>dependsOn</code>. The use of <code>fileTree()</code> means that Gradle cant infer the task dependency itself.</p>
</div>
<div class="paragraph">
<p>One solution is to use the <code>TaskOutputs.files</code> property, as demonstrated by the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 86. Setting up an inferred task dependency between output dir and input files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task instrumentClasses(<span class="key">type</span>: <span class="predefined-type">Instrument</span>) {
    classFiles = compileJava.outputs.files
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/instrumented</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClasses&quot;) {
    classFiles = tasks.compileJava.get().outputs.files
    destinationDir = file(&quot;$buildDir/instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClasses</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClasses
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClasses


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can get Gradle to access the appropriate property itself by using one of <code>project.files()</code>, <code>project.layout.files()</code> or <code>project.objects.fileCollection()</code> in place of <code>project.fileTree()</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 87. Setting up an inferred task dependency with <code>layout.files()</code></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task instrumentClasses2(<span class="key">type</span>: <span class="predefined-type">Instrument</span>) {
    classFiles = layout.files(compileJava)
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/instrumented</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClasses2&quot;) {
    classFiles = layout.files(tasks.compileJava.get())
    destinationDir = file(&quot;$buildDir/instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClasses2</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClasses2
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClasses2


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Remember that <code>files()</code>, <code>layout.files()</code> and <code>objects.fileCollection()</code> can take tasks as arguments, whereas <code>fileTree()</code> cannot.</p>
</div>
<div class="paragraph">
<p>The downside of this approach is that all file outputs of the source task become the input files of the target  <code>instrumentClasses</code> in this case. Thats fine as long as the source task only has a single file-based output, like the <code>JavaCompile</code> task. But if you have to link just one output property among several, then you need to explicitly tell Gradle which task generates the input files using the <code>builtBy</code> method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 88. Setting up an inferred task dependency with builtBy()</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task instrumentClassesBuiltBy(<span class="key">type</span>: <span class="predefined-type">Instrument</span>) {
    classFiles = fileTree(compileJava.destinationDir) {
        builtBy compileJava
    }
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/instrumented</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;instrumentClassesBuiltBy&quot;) {
    classFiles = fileTree(tasks.compileJava.get().destinationDir) {
        builtBy(tasks.compileJava.get())
    }
    destinationDir = file(&quot;$buildDir/instrumented&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle clean instrumentClassesBuiltBy</code></strong></div>
<div class="content">
<pre>&gt; gradle clean instrumentClassesBuiltBy
&gt; Task :clean UP-TO-DATE
&gt; Task :compileJava
&gt; Task :instrumentClassesBuiltBy


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can of course just add an explicit task dependency via <code>dependsOn</code>, but the above approach provides more semantic meaning, explaining why <code>compileJava</code> has to run beforehand.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:custom_up_to_date_logic"><a class="anchor" href="#sec:custom_up_to_date_logic"></a><a class="link" href="#sec:custom_up_to_date_logic">Providing custom up-to-date logic</a></h6>
<div class="paragraph">
<p>Gradle automatically handles up-to-date checks for output files and directories, but what if the task output is something else entirely? Perhaps its an update to a web service or a database table. Gradle has no way of knowing how to check whether the task is up to date in such cases.</p>
</div>
<div class="paragraph">
<p>Thats where the <code>upToDateWhen()</code> method on <code>TaskOutputs</code> comes in. This takes a predicate function that is used to determine whether a task is up to date or not. One use case is to disable up-to-date checks completely for a task, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 89. Ignoring up-to-date checks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task alwaysInstrumentClasses(<span class="key">type</span>: <span class="predefined-type">Instrument</span>) {
    classFiles = layout.files(compileJava)
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/instrumented</span><span class="delimiter">&quot;</span></span>)
    outputs.upToDateWhen { <span class="predefined-constant">false</span> }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Instrument&gt;(&quot;alwaysInstrumentClasses&quot;) {
    classFiles = layout.files(tasks.compileJava.get())
    destinationDir = file(&quot;$buildDir/instrumented&quot;)
    outputs.upToDateWhen { false }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle clean alwaysInstrumentClasses</code></div>
<div class="content">
<pre>&gt; gradle clean alwaysInstrumentClasses
&gt; Task :compileJava
&gt; Task :alwaysInstrumentClasses


BUILD SUCCESSFUL in 0s
3 actionable tasks: 2 executed, 1 up-to-date</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle alwaysInstrumentClasses</code></div>
<div class="content">
<pre>&gt; gradle alwaysInstrumentClasses
&gt; Task :compileJava UP-TO-DATE
&gt; Task :alwaysInstrumentClasses


BUILD SUCCESSFUL in 0s
2 actionable tasks: 1 executed, 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>{ false }</code> closure ensures that <code>alwaysInstrumentClasses</code> will always be executed, irrespective of whether there is no change in the inputs or outputs.</p>
</div>
<div class="paragraph">
<p>You can of course put more complex logic into the closure. You could check whether a particular record in a database table exists or has changed for example. Just be aware that up-to-date checks should <em>save</em> you time. Dont add checks that cost as much or more time than the standard execution of the task. In fact, if a task ends up running frequently anyway, because its rarely up to date, then it may not be worth having an up-to-date check at all. Remember that your checks will always run if the task is in the execution task graph.</p>
</div>
<div class="paragraph">
<p>One common mistake is to use <code>upToDateWhen()</code> instead of <code>Task.onlyIf()</code>. If you want to skip a task on the basis of some condition unrelated to the task inputs and outputs, then you should use <code>onlyIf()</code>. For example, in cases where you want to skip a task when a particular property is set or not set.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:configure_input_normalization"><a class="anchor" href="#sec:configure_input_normalization"></a><a class="link" href="#sec:configure_input_normalization">Configure input normalization</a></h6>
<div class="paragraph">
<p>For up to date checks and the <a href="#build_cache">build cache</a> Gradle needs to determine if two task input properties have the same value.
In order to do so, Gradle first normalizes both inputs and then compares the result.
For example, for a compile classpath, Gradle extracts the ABI signature from the classes on the classpath and then compares signatures between the last Gradle run and the current Gradle run as described in <a href="#sec:java_compile_avoidance">Java compile avoidance</a>.</p>
</div>
<div class="paragraph">
<p>It is possible to customize Gradle&#8217;s built-in strategy for runtime classpath normalization.
All inputs annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Classpath.html">Classpath</a></code> are considered to be runtime classpaths.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to add a file <code>build-info.properties</code> to all your produced jar files which contains information about the build, e.g. the timestamp when the build started or some ID to identify the CI job that published the artifact.
This file is only for auditing purposes, and has no effect on the outcome of running tests.
Nonetheless, this file is part of the runtime classpath for the <code>test</code> task and changes on every build invocation.
Therefore, the <code>test</code> would be never up-to-date or pulled from the build cache.
In order to benefit from incremental builds again, you are able tell Gradle to ignore this file on the runtime classpath at the project level by using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:normalization(org.gradle.api.Action)">Project.normalization(org.gradle.api.Action)</a> (in the <em>consuming</em> project):</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. Runtime classpath normalization</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">normalization {
    runtimeClasspath {
        ignore <span class="string"><span class="delimiter">'</span><span class="content">build-info.properties</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">normalization {
    runtimeClasspath {
        ignore(&quot;build-info.properties&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If adding such a file to your jar files is something you do for all of the projects in your build, and you want to filter this file for all consumers, you may wrap the configurations described above in an <code>allprojects {}</code> or <code>subprojects {}</code> block in the root build script.</p>
</div>
<div class="paragraph">
<p>The effect of this configuration would be that changes to <code>build-info.properties</code> would be ignored for up-to-date checks and <a href="#build_cache">build cache</a> key calculations.
Note that this will not change the runtime behavior of the <code>test</code> task  i.e. any test is still able to load <code>build-info.properties</code> and the runtime classpath is still the same as before.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:stale_task_outputs"><a class="anchor" href="#sec:stale_task_outputs"></a><a class="link" href="#sec:stale_task_outputs">Stale task outputs</a></h5>
<div class="paragraph">
<p>When the Gradle version changes, Gradle detects that outputs from tasks that ran with older versions of Gradle need to be removed to ensure that the newest version of the tasks are starting from a known clean state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic clean-up of stale output directories has only been implemented for the output of source sets (Java/Groovy/Scala compilation).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:task_rules"><a class="anchor" href="#sec:task_rules"></a><a class="link" href="#sec:task_rules">Task rules</a></h4>
<div class="paragraph">
<p>Sometimes you want to have a task whose behavior depends on a large or infinite number value range of parameters. A very nice and expressive way to provide such tasks are task rules:</p>
</div>
<div class="exampleblock">
<div class="title">Example 91. Task rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.addRule(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pattern: ping&lt;ID&gt;</span><span class="delimiter">&quot;</span></span>) { <span class="predefined-type">String</span> taskName -&gt;
    <span class="keyword">if</span> (taskName.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">ping</span><span class="delimiter">&quot;</span></span>)) {
        task(taskName) {
            doLast {
                println <span class="string"><span class="delimiter">&quot;</span><span class="content">Pinging: </span><span class="delimiter">&quot;</span></span> + (taskName - <span class="string"><span class="delimiter">'</span><span class="content">ping</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.addRule(&quot;Pattern: ping&lt;ID&gt;&quot;) {
    val taskName = this
    if (startsWith(&quot;ping&quot;)) {
        task(taskName) {
            doLast {
                println(&quot;Pinging: &quot; + (taskName.replace(&quot;ping&quot;, &quot;&quot;)))
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q pingServer1</code></strong></div>
<div class="content">
<pre>&gt; gradle -q pingServer1
Pinging: Server1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The String parameter is used as a description for the rule, which is shown with <code>gradle tasks</code>.</p>
</div>
<div class="paragraph">
<p>Rules are not only used when calling tasks from the command line. You can also create dependsOn relations on rule based tasks:</p>
</div>
<div class="exampleblock">
<div class="title">Example 92. Dependency on rule based tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.addRule(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pattern: ping&lt;ID&gt;</span><span class="delimiter">&quot;</span></span>) { <span class="predefined-type">String</span> taskName -&gt;
    <span class="keyword">if</span> (taskName.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">ping</span><span class="delimiter">&quot;</span></span>)) {
        task(taskName) {
            doLast {
                println <span class="string"><span class="delimiter">&quot;</span><span class="content">Pinging: </span><span class="delimiter">&quot;</span></span> + (taskName - <span class="string"><span class="delimiter">'</span><span class="content">ping</span><span class="delimiter">'</span></span>)
            }
        }
    }
}

task groupPing {
    dependsOn pingServer1, pingServer2
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.addRule(&quot;Pattern: ping&lt;ID&gt;&quot;) {
    val taskName = this
    if (startsWith(&quot;ping&quot;)) {
        task(taskName) {
            doLast {
                println(&quot;Pinging: &quot; + (taskName.replace(&quot;ping&quot;, &quot;&quot;)))
            }
        }
    }
}

task(&quot;groupPing&quot;) {
    dependsOn(&quot;pingServer1&quot;, &quot;pingServer2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q groupPing</code></strong></div>
<div class="content">
<pre>&gt; gradle -q groupPing
Pinging: Server1
Pinging: Server2</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you run <code>gradle -q tasks</code> you won&#8217;t find a task named <code>pingServer1</code> or <code>pingServer2</code>, but this script is executing logic based on the request to run those tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:finalizer_tasks"><a class="anchor" href="#sec:finalizer_tasks"></a><a class="link" href="#sec:finalizer_tasks">Finalizer tasks</a></h4>
<div class="paragraph">
<p>Finalizer tasks are automatically added to the task graph when the finalized task is scheduled to run.</p>
</div>
<div class="exampleblock">
<div class="title">Example 93. Adding a task finalizer</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}

taskX.finalizedBy taskY</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
    }
}
val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}

taskX { finalizedBy(taskY) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskX
taskY</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finalizer tasks will be executed even if the finalized task fails.</p>
</div>
<div class="exampleblock">
<div class="title">Example 94. Task finalizer for a failing task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task taskX {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskX</span><span class="delimiter">'</span></span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>()
    }
}
task taskY {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">taskY</span><span class="delimiter">'</span></span>
    }
}

taskX.finalizedBy taskY</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val taskX by tasks.registering {
    doLast {
        println(&quot;taskX&quot;)
        throw RuntimeException()
    }
}
val taskY by tasks.registering {
    doLast {
        println(&quot;taskY&quot;)
    }
}

taskX { finalizedBy(taskY) }</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q taskX</code></strong></div>
<div class="content">
<pre>&gt; gradle -q taskX
taskX
taskY

FAILURE: Build failed with an exception.

* Where:
Build file '/home/user/gradle/samples/groovy/build.gradle' line: 4

* What went wrong:
Execution failed for task ':taskX'.
&gt; java.lang.RuntimeException (no error message)

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 0s</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>On the other hand, finalizer tasks are not executed if the finalized task didn&#8217;t do any work, for example if it is considered up to date or if a dependent task fails.</p>
</div>
<div class="paragraph">
<p>Finalizer tasks are useful in situations where the build creates a resource that has to be cleaned up regardless of the build failing or succeeding. An example of such a resource is a web container that is started before an integration test task and which should be always shut down, even if some of the tests fail.</p>
</div>
<div class="paragraph">
<p>To specify a finalizer task you use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:finalizedBy(java.lang.Object[])">Task.finalizedBy(java.lang.Object&#8230;&#8203;)</a> method. This method accepts a task instance, a task name, or any other input accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn(java.lang.Object[])">Task.dependsOn(java.lang.Object&#8230;&#8203;)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:lifecycle_tasks"><a class="anchor" href="#sec:lifecycle_tasks"></a><a class="link" href="#sec:lifecycle_tasks">Lifecycle tasks</a></h4>
<div class="paragraph">
<p>Lifecycle tasks are tasks that do not do work themselves. They typically do not have any task actions. Lifecycle tasks can represent several concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a work-flow step (e.g., run all checks with <code>check</code>)</p>
</li>
<li>
<p>a buildable thing (e.g., create a debug 32-bit executable for native components with <code>debug32MainExecutable</code>)</p>
</li>
<li>
<p>a convenience task to execute many of the same logical tasks (e.g., run all compilation tasks with <code>compileAll</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Base Plugin defines several <a href="#sec:base_tasks">standard lifecycle tasks</a>, such as <code>build</code>, <code>assemble</code>, and <code>check</code>. All the core language plugins, like the <a href="#java_plugin">Java Plugin</a>, apply the Base Plugin and hence have the same base set of lifecycle tasks.</p>
</div>
<div class="paragraph">
<p>Unless a lifecycle task has actions, its <a href="#sec:task_outcomes">outcome</a> is determined by its task dependencies. If any of those dependencies are executed, the lifecycle task will be considered <code>EXECUTED</code>. If all of the task dependencies are up to date, skipped or from cache, the lifecycle task will be considered <code>UP-TO-DATE</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:the_idea_behind_gradle_tasks"><a class="anchor" href="#sec:the_idea_behind_gradle_tasks"></a><a class="link" href="#sec:the_idea_behind_gradle_tasks">Summary</a></h4>
<div class="paragraph">
<p>If you are coming from Ant, an enhanced Gradle task like <em>Copy</em> seems like a cross between an Ant target and an Ant task. Although Ant&#8217;s tasks and targets are really different entities, Gradle combines these notions into a single entity. Simple Gradle tasks are like Ant&#8217;s targets, but enhanced Gradle tasks also include aspects of Ant tasks. All of Gradle&#8217;s tasks share a common API and you can create dependencies between them. These tasks are much easier to configure than an Ant task. They make full use of the type system, and are more expressive and easier to maintain.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing_build_scripts"><a class="anchor" href="#writing_build_scripts"></a><a class="link" href="#writing_build_scripts">Writing Build Scripts</a></h3>
<div class="paragraph">
<p>This chapter looks at some of the details of writing a build script.</p>
</div>
<div class="sect3">
<h4 id="sec:the_gradle_build_language"><a class="anchor" href="#sec:the_gradle_build_language"></a><a class="link" href="#sec:the_gradle_build_language">The Gradle build language</a></h4>
<div class="paragraph">
<p>Gradle provides a <em>domain specific language</em>, or DSL, for describing builds. This build language is available in Groovy and Kotlin.</p>
</div>
<div class="paragraph">
<p>A Groovy build script can contain any Groovy language element.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> A Kotlin build script can contain any Kotlin language element. Gradle assumes that each build script is encoded using UTF-8.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_api"><a class="anchor" href="#sec:project_api"></a><a class="link" href="#sec:project_api">The Project API</a></h4>
<div class="paragraph">
<p>Build scripts describe your build by configuring <em>projects</em>. A project is an abstract concept, but you typically map a Gradle project to a software component that needs to be built, like a library or an application. Each build script you have is associated with an object of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> and as the build script executes, it configures this <code>Project</code>.</p>
</div>
<div class="paragraph">
<p>In fact, almost all top-level properties and blocks in a build script are part of the <code>Project</code> API. To demonstrate, take a look at this example build script that prints the name of its project, which is accessed via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.name</a> property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 95. Accessing property of the Project object</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println name
println project.name</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(name)
println(project.name)</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q check</code></strong></div>
<div class="content">
<pre>&gt; gradle -q check
projectApi
projectApi</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both <code>println</code> statements print out the same property. The first uses the top-level reference to the <code>name</code> property of the <code>Project</code> object. The other statement uses the <code>project</code> property available to any build script, which returns the associated <code>Project</code> object. Only if you define a property or a method which has the same name as a member of the <code>Project</code> object, would you need to use the <code>project</code> property.</p>
</div>
<div class="sect4">
<h5 id="sec:standard_project_properties"><a class="anchor" href="#sec:standard_project_properties"></a><a class="link" href="#sec:standard_project_properties">Standard project properties</a></h5>
<div class="paragraph">
<p>The <code>Project</code> object provides some standard properties, which are available in your build script. The following table lists a few of the commonly used ones.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Project Properties</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>Project</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the project directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The absolute path of the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description for the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectDir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory containing the build script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>buildDir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>projectDir</em>/build</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unspecified</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unspecified</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html">AntBuilder</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>AntBuilder</code> instance</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Script with other targets</div>
<div class="paragraph">
<p>The <em>build scripts</em> described here target <code>Project</code> objects.
There are also <a href="#sec:settings_file">settings scripts</a> and <a href="#init_scripts">init scripts</a> that respectively target <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html">Settings</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a> objects.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:the_script_api"><a class="anchor" href="#sec:the_script_api"></a><a class="link" href="#sec:the_script_api">The script API</a></h4>
<div class="paragraph">
<p>When Gradle executes a Groovy build script (<code>.gradle</code>), it compiles the script into a class which implements <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Script.html">Script</a>. This means that all of the properties and methods declared by the <code>Script</code> interface are available in your script.</p>
</div>
<div class="paragraph">
<p>When Gradle executes a Kotlin build script (<code>.gradle.kts</code>), it compiles the script into a subclass of <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/-kotlin-build-script/index.html">KotlinBuildScript</a>. This means that all of the visible properties and functions declared by the <code>KotlinBuildScript</code> type are available in your script. Also see the  <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/-kotlin-settings-script/index.html">KotlinSettingsScript</a> and <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/-kotlin-init-script/index.html">KotlinInitScript</a> types respectively for settings scripts and init scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_variables"><a class="anchor" href="#sec:declaring_variables"></a><a class="link" href="#sec:declaring_variables">Declaring variables</a></h4>
<div class="paragraph">
<p>There are two kinds of variables that can be declared in a build script: local variables and extra properties.</p>
</div>
<div class="sect4">
<h5 id="sec:local_variables"><a class="anchor" href="#sec:local_variables"></a><a class="link" href="#sec:local_variables">Local variables</a></h5>
<div class="paragraph multi-language-text lang-groovy">
<p>Local variables are declared with the <code>def</code> keyword. They are only visible in the scope where they have been declared. Local variables are a feature of the underlying Groovy language.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Local variables are declared with the <code>val</code> keyword. They are only visible in the scope where they have been declared. Local variables are a feature of the underlying Kotlin language.</p>
</div>
<div class="exampleblock">
<div class="title">Example 96. Using local variables</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dest = <span class="string"><span class="delimiter">&quot;</span><span class="content">dest</span><span class="delimiter">&quot;</span></span>

task copy(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>
    into dest
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val dest = &quot;dest&quot;

tasks.register&lt;Copy&gt;(&quot;copy&quot;) {
    from(&quot;source&quot;)
    into(dest)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:extra_properties"><a class="anchor" href="#sec:extra_properties"></a><a class="link" href="#sec:extra_properties">Extra properties</a></h5>
<div class="paragraph">
<p>All enhanced objects in Gradle&#8217;s domain model can hold extra user-defined properties. This includes, but is not limited to, projects, tasks, and source sets.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Extra properties can be added, read and set via the owning object&#8217;s <code>ext</code> property. Alternatively, an <code>ext</code> block can be used to add multiple properties at once.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Extra properties can be added, read and set via the owning object&#8217;s <code>extra</code> property. Alternatively, they can be addressed via Kotlin delegated properties using <code>by extra</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 97. Using extra properties</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

ext {
    springVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.1.0.RELEASE</span><span class="delimiter">&quot;</span></span>
    emailNotification = <span class="string"><span class="delimiter">&quot;</span><span class="content">build@master.org</span><span class="delimiter">&quot;</span></span>
}

sourceSets.all { ext.purpose = <span class="predefined-constant">null</span> }

sourceSets {
    main {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>
    }
    test {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>
    }
    plugin {
        purpose = <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>
    }
}

task printProperties {
    doLast {
        println springVersion
        println emailNotification
        sourceSets.matching { <span class="local-variable">it</span>.purpose == <span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span> }.each { println <span class="local-variable">it</span>.name }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

val springVersion by extra(&quot;3.1.0.RELEASE&quot;)
val emailNotification by extra { &quot;build@master.org&quot; }

sourceSets.all { extra[&quot;purpose&quot;] = null }

sourceSets {
    main {
        extra[&quot;purpose&quot;] = &quot;production&quot;
    }
    test {
        extra[&quot;purpose&quot;] = &quot;test&quot;
    }
    create(&quot;plugin&quot;) {
        extra[&quot;purpose&quot;] = &quot;production&quot;
    }
}

tasks.register(&quot;printProperties&quot;) {
    doLast {
        println(springVersion)
        println(emailNotification)
        sourceSets.matching { it.extra[&quot;purpose&quot;] == &quot;production&quot; }.forEach { println(it.name) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q printProperties</code></strong></div>
<div class="content">
<pre>&gt; gradle -q printProperties
3.1.0.RELEASE
build@master.org
main
plugin</pre>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>In this example, an <code>ext</code> block adds two extra properties to the <code>project</code> object. Additionally, a property named <code>purpose</code> is added to each source set by setting <code>ext.purpose</code> to <code>null</code> (<code>null</code> is a permissible value). Once the properties have been added, they can be read and set like predefined properties.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>In this example, two extra properties are added to the <code>project</code> object using <code>by extra</code>. Additionally, a property named <code>purpose</code> is added to each source set by setting <code>extra["purpose"]</code> to <code>null</code> (<code>null</code> is a permissible value). Once the properties have been added, they can be read and set on <code>extra</code>.</p>
</div>
<div class="paragraph">
<p>By requiring special syntax for adding a property, Gradle can fail fast when an attempt is made to set a (predefined or extra) property but the property is misspelled or does not exist. Extra properties can be accessed from anywhere their owning object can be accessed, giving them a wider scope than local variables. Extra properties on a project are visible from its subprojects.</p>
</div>
<div class="paragraph">
<p>For further details on extra properties and their API, see the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html">ExtraPropertiesExtension</a> class in the API documentation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_arbitrary_objects"><a class="anchor" href="#sec:configuring_arbitrary_objects"></a><a class="link" href="#sec:configuring_arbitrary_objects">Configuring arbitrary objects</a></h4>
<div class="paragraph">
<p>You can configure arbitrary objects in the following very readable way.</p>
</div>
<div class="exampleblock">
<div class="title">Example 98. Configuring arbitrary objects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">java.text.FieldPosition</span>

task configure {
    doLast {
        <span class="keyword">def</span> pos = configure(<span class="keyword">new</span> <span class="predefined-type">FieldPosition</span>(<span class="integer">10</span>)) {
            beginIndex = <span class="integer">1</span>
            endIndex = <span class="integer">5</span>
        }
        println pos.beginIndex
        println pos.endIndex
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import java.text.FieldPosition

tasks.register(&quot;configure&quot;) {
    doLast {
        val pos = FieldPosition(10).apply {
            beginIndex = 1
            endIndex = 5
        }
        println(pos.beginIndex)
        println(pos.endIndex)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q configure</code></strong></div>
<div class="content">
<pre>&gt; gradle -q configure
1
5</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_arbitrary_objects_using_an_external_script"><a class="anchor" href="#sec:configuring_arbitrary_objects_using_an_external_script"></a><a class="link" href="#sec:configuring_arbitrary_objects_using_an_external_script">Configuring arbitrary objects using an external script</a></h4>
<div class="paragraph">
<p>You can also configure arbitrary objects using an external script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="title">Only supported from a Groovy script</div>
<div class="paragraph">
<p>Configuring arbitrary objects using an external script is not yet supported by the Kotlin DSL.
See <a href="https://github.com/gradle/kotlin-dsl/issues/659">gradle/kotlin-dsl#659</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 99. Configuring arbitrary objects using a script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task configure {
    doLast {
        <span class="keyword">def</span> pos = <span class="keyword">new</span> java.text.FieldPosition(<span class="integer">10</span>)
        <span class="comment">// Apply the script</span>
        apply <span class="key">from</span>: <span class="string"><span class="delimiter">'</span><span class="content">other.gradle</span><span class="delimiter">'</span></span>, <span class="key">to</span>: pos
        println pos.beginIndex
        println pos.endIndex
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">other.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Set properties.</span>
beginIndex = <span class="integer">1</span>
endIndex = <span class="integer">5</span></code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q configure</code></div>
<div class="content">
<pre>&gt; gradle -q configure
1
5</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy-dsl-basics"><a class="anchor" href="#groovy-dsl-basics"></a><a class="link" href="#groovy-dsl-basics">Some Groovy basics</a></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Looking for some Kotlin basics, the <a href="https://kotlinlang.org/docs/reference/">Kotlin reference documentation</a> and <a href="https://kotlinlang.org/docs/tutorials/koans.html">Kotlin Koans</a> should be useful to you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://docs.groovy-lang.org/latest/html/documentation/index.html">Groovy language</a> provides plenty of features for creating DSLs, and the Gradle build language takes advantage of these. Understanding how the build language works will help you when you write your build script, and in particular, when you start to write custom plugins and tasks.</p>
</div>
<div class="sect4">
<h5 id="sec:groovy_jdk"><a class="anchor" href="#sec:groovy_jdk"></a><a class="link" href="#sec:groovy_jdk">Groovy JDK</a></h5>
<div class="paragraph">
<p>Groovy adds lots of useful methods to the standard Java classes. For example, <code>Iterable</code> gets an <code>each</code> method, which iterates over the elements of the <code>Iterable</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 100. Groovy JDK methods</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Iterable gets an each() method</span>
configurations.runtimeClasspath.each { <span class="predefined-type">File</span> f -&gt; println f }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Have a look at <a href="https://groovy-lang.org/gdk.html" class="bare">https://groovy-lang.org/gdk.html</a> for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:property_accessors"><a class="anchor" href="#sec:property_accessors"></a><a class="link" href="#sec:property_accessors">Property accessors</a></h5>
<div class="paragraph">
<p>Groovy automatically converts a property reference into a call to the appropriate getter or setter method.</p>
</div>
<div class="exampleblock">
<div class="title">Example 101. Property accessors</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using a getter method</span>
println project.buildDir
println getProject().getBuildDir()

<span class="comment">// Using a setter method</span>
project.buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>
getProject().setBuildDir(<span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:optional_parentheses_on_method_calls"><a class="anchor" href="#sec:optional_parentheses_on_method_calls"></a><a class="link" href="#sec:optional_parentheses_on_method_calls">Optional parentheses on method calls</a></h5>
<div class="paragraph">
<p>Parentheses are optional for method calls.</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. Method call without parentheses</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test.systemProperty <span class="string"><span class="delimiter">'</span><span class="content">some.prop</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">value</span><span class="delimiter">'</span></span>
test.systemProperty(<span class="string"><span class="delimiter">'</span><span class="content">some.prop</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">value</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:list_and_map_literals"><a class="anchor" href="#sec:list_and_map_literals"></a><a class="link" href="#sec:list_and_map_literals">List and map literals</a></h5>
<div class="paragraph">
<p>Groovy provides some shortcuts for defining <code>List</code> and <code>Map</code> instances. Both kinds of literals are straightforward, but map literals have some interesting twists.</p>
</div>
<div class="paragraph">
<p>For instance, the <code>apply</code> method (where you typically apply plugins) actually takes a map parameter. However, when you have a line like <code>apply plugin:'java'</code>, you aren&#8217;t actually using a map literal, you&#8217;re actually using named parameters, which have almost exactly the same syntax as a map literal (without the wrapping brackets). That named parameter list gets converted to a map when the method is called, but it doesn&#8217;t start out as a map.</p>
</div>
<div class="exampleblock">
<div class="title">Example 103. List and map literals</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// List literal</span>
test.includes = [<span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org/gradle/internal/**</span><span class="delimiter">'</span></span>]

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;()
list.add(<span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span>)
list.add(<span class="string"><span class="delimiter">'</span><span class="content">org/gradle/internal/**</span><span class="delimiter">'</span></span>)
test.includes = list

<span class="comment">// Map literal.</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = [<span class="key">key1</span>:<span class="string"><span class="delimiter">'</span><span class="content">value1</span><span class="delimiter">'</span></span>, <span class="key">key2</span>: <span class="string"><span class="delimiter">'</span><span class="content">value2</span><span class="delimiter">'</span></span>]

<span class="comment">// Groovy will coerce named arguments</span>
<span class="comment">// into a single map argument</span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:closures_as_the_last_parameter_in_a_method"><a class="anchor" href="#sec:closures_as_the_last_parameter_in_a_method"></a><a class="link" href="#sec:closures_as_the_last_parameter_in_a_method">Closures as the last parameter in a method</a></h5>
<div class="paragraph">
<p>The Gradle DSL uses closures in many places. You can find out more about closures <a href="https://docs.groovy-lang.org/latest/html/documentation/index.html#_closures">here</a>. When the last parameter of a method is a closure, you can place the closure after the method call:</p>
</div>
<div class="exampleblock">
<div class="title">Example 104. Closure as method parameter</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">in a closure</span><span class="delimiter">&quot;</span></span>
}
repositories() { println <span class="string"><span class="delimiter">&quot;</span><span class="content">in a closure</span><span class="delimiter">&quot;</span></span> }
repositories({ println <span class="string"><span class="delimiter">&quot;</span><span class="content">in a closure</span><span class="delimiter">&quot;</span></span> })</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:closure_delegate"><a class="anchor" href="#sec:closure_delegate"></a><a class="link" href="#sec:closure_delegate">Closure delegate</a></h5>
<div class="paragraph">
<p>Each closure has a <code>delegate</code> object, which Groovy uses to look up variable and method references which are not local variables or parameters of the closure. Gradle uses this for <em>configuration closures</em>, where the <code>delegate</code> object is set to the object to be configured.</p>
</div>
<div class="exampleblock">
<div class="title">Example 105. Closure delegates</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="keyword">assert</span> delegate == project.dependencies
    testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>)
    delegate.testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-default-imports"><a class="anchor" href="#script-default-imports"></a><a class="link" href="#script-default-imports">Default imports</a></h4>
<div class="paragraph">
<p>To make build scripts more concise, Gradle automatically adds a set of import statements to the Gradle scripts. This means that instead of using <code>throw new org.gradle.api.tasks.StopExecutionException()</code> you can just type <code>throw new StopExecutionException()</code> instead.</p>
</div>
<div class="paragraph">
<p>Listed below are the imports added to each script:</p>
</div>
<div class="listingblock">
<div class="title">Gradle default imports</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.dsl.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.query.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.repositories.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.result.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.transform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.type.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.artifacts.verification.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.attributes.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.attributes.java.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.capabilities.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.credentials.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.distribution.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.distribution.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.execution.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.file.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.definition.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.initialization.dsl.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.invocation.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.java.archives.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.logging.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.logging.configuration.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.antlr.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.quality.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.plugins.scala.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.ivy.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.maven.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.publish.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reflect.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.components.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.dependencies.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.dependents.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.reporting.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.resources.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.services.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.specs.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.ant.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.application.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.bundling.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.compile.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.diagnostics.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.incremental.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.javadoc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.scala.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.junit.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.junitplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.testing.testng.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.util.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.wrapper.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.aws.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.authentication.http.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.build.event.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildinit.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.buildinit.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.configuration.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.http.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.caching.local.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.concurrent.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.external.javadoc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.visualstudio.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ide.xcode.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.ivy.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.application.scripts.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.application.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.platform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.tasks.api.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.test.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.jvm.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.assembler.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.artifact.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.compile.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.base.sources.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.c.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.coffeescript.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.cpp.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.java.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.java.artifact.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.java.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.java.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.javascript.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.jvm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.jvm.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.jvm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.nativeplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.nativeplatform.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivec.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.objectivecpp.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.rc.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.routes.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.scala.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.scala.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.scala.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.scala.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.swift.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.language.twirl.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.maven.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.model.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.platform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cpp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cpp.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.cunit.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.googletest.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.googletest.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.test.xctest.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.nativeplatform.toolchain.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.normalization.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.binary.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.component.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.platform.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.distribution.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.platform.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.plugins.ide.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.play.toolchain.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.devel.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.management.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugin.use.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ear.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ear.descriptor.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.api.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.eclipse.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.ide.idea.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.coffeescript.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.envjs.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.envjs.browser.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.envjs.http.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.envjs.http.simple.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.jshint.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.javascript.rhino.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.signatory.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.signatory.pgp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.type.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.plugins.signing.type.pgp.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.process.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.swiftpm.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.base.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.base.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.plugins.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.tasks.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testing.jacoco.tasks.rules.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.vcs.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.vcs.git.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.work.*</span>
<span class="keyword">import</span> <span class="include">org.gradle.workers.*</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="working_with_files"><a class="anchor" href="#working_with_files"></a><a class="link" href="#working_with_files">Working With Files</a></h3>
<div class="paragraph">
<p>Almost every Gradle build interacts with files in some way: think source files, file dependencies, reports and so on. That&#8217;s why Gradle comes with a comprehensive API that makes it simple to perform the file operations you need.</p>
</div>
<div class="paragraph">
<p>The API has two parts to it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifying which files and directories to process</p>
</li>
<li>
<p>Specifying what to do with them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#sec:locating_files">File paths in depth</a> section covers the first of these in detail, while subsequent sections, like <a href="#sec:copying_files">File copying in depth</a>, cover the second. To begin with, we&#8217;ll show you examples of the most common scenarios that users encounter.</p>
</div>
<div class="sect3">
<h4 id="sec:copying_single_file_example"><a class="anchor" href="#sec:copying_single_file_example"></a><a class="link" href="#sec:copying_single_file_example">Copying a single file</a></h4>
<div class="paragraph">
<p>You copy a file by creating an instance of Gradle&#8217;s builtin <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task and configuring it with the location of the file and where you want to put it. This example mimics copying a generated report into a directory that will be packed into an archive, such as a ZIP or TAR:</p>
</div>
<div class="exampleblock">
<div class="title">Example 106. How to copy a single file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReport(<span class="key">type</span>: Copy) {
    from file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports/my-report.pdf</span><span class="delimiter">&quot;</span></span>)
    into file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReport&quot;) {
    from(file(&quot;$buildDir/reports/my-report.pdf&quot;))
    into(file(&quot;$buildDir/toArchive&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method is used to create a file or directory path relative to the current project and is a common way to make build scripts work regardless of the project path. The file and directory paths are then used to specify what file to copy using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html#org.gradle.api.tasks.Copy:from(java.lang.Object[])">Copy.from(java.lang.Object&#8230;&#8203;)</a> and which directory to copy it to using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html#org.gradle.api.tasks.Copy:into(java.lang.Object)">Copy.into(java.lang.Object)</a>.</p>
</div>
<div class="paragraph">
<p>You can even use the path directly without the <code>file()</code> method, as explained early in the section <a href="#sec:copying_files">File copying in depth</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 107. Using implicit string paths</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReport2(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports/my-report.pdf</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReport2&quot;) {
    from(&quot;$buildDir/reports/my-report.pdf&quot;)
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although hard-coded paths make for simple examples, they also make the build brittle. It&#8217;s better to use a reliable, single source of truth, such as a task or shared project property. In the following modified example, we use a report task defined elsewhere that has the report&#8217;s location stored in its <code>outputFile</code> property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 108. Prefer task/project properties over hard-coded paths</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReport3(<span class="key">type</span>: Copy) {
    from myReportTask.outputFile
    into archiveReportsTask.dirToArchive
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReport3&quot;) {
    val outputFile: File by myReportTask.get().extra
    val dirToArchive: File by archiveReportsTask.get().extra
    from(outputFile)
    into(dirToArchive)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have also assumed that the reports will be archived by <code>archiveReportsTask</code>, which provides us with the directory that will be archived and hence where we want to put the copies of the reports.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:copying_multiple_files_example"><a class="anchor" href="#sec:copying_multiple_files_example"></a><a class="link" href="#sec:copying_multiple_files_example">Copying multiple files</a></h4>
<div class="paragraph">
<p>You can extend the previous examples to multiple files very easily by providing multiple arguments to <code>from()</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 109. Using multiple arguments with from()</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReportsForArchiving(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports/my-report.pdf</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">src/docs/manual.pdf</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsForArchiving&quot;) {
    from(&quot;$buildDir/reports/my-report.pdf&quot;, &quot;src/docs/manual.pdf&quot;)
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Two files are now copied into the archive directory. You can also use multiple <code>from()</code> statements to do the same thing, as shown in the first example of the section <a href="#sec:copying_files">File copying in depth</a>.</p>
</div>
<div class="paragraph">
<p>Now consider another example: what if you want to copy all the PDFs in a directory without having to specify each one? To do this, attach inclusion and/or exclusion patterns to the copy specification. Here we use a string pattern to include PDFs only:</p>
</div>
<div class="exampleblock">
<div class="title">Example 110. Using a flat filter</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyPdfReportsForArchiving(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports</span><span class="delimiter">&quot;</span></span>
    include <span class="string"><span class="delimiter">&quot;</span><span class="content">*.pdf</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyPdfReportsForArchiving&quot;) {
    from(&quot;$buildDir/reports&quot;)
    include(&quot;*.pdf&quot;)
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One thing to note, as demonstrated in the following diagram, is that only the PDFs that reside directly in the <code>reports</code> directory are copied:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/copy-with-flat-filter-example.png" alt="copy with flat filter example">
</div>
<div class="title">Figure 8. The effect of a flat filter on copying</div>
</div>
<div class="paragraph">
<p>You can include files in subdirectories by using an Ant-style glob pattern (<code>**/*</code>), as done in this updated example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 111. Using a deep filter</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyAllPdfReportsForArchiving(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports</span><span class="delimiter">&quot;</span></span>
    include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyAllPdfReportsForArchiving&quot;) {
    from(&quot;$buildDir/reports&quot;)
    include(&quot;**/*.pdf&quot;)
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This task has the following effect:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/copy-with-deep-filter-example.png" alt="copy with deep filter example">
</div>
<div class="title">Figure 9. The effect of a deep filter on copying</div>
</div>
<div class="paragraph">
<p>One thing to bear in mind is that a deep filter like this has the side effect of copying the directory structure below <code>reports</code> as well as the files. If you just want to copy the files without the directory structure, you need to use an explicit <code>fileTree(<em>dir</em>) { <em>includes</em> }.files</code> expression. We talk more about the difference between file trees and file collections in the <a href="#sec:file_trees">File trees</a> section.</p>
</div>
<div class="paragraph">
<p>This is just one of the variations in behavior you&#8217;re likely to come across when dealing with file operations in Gradle builds. Fortunately, Gradle provides elegant solutions to almost all those use cases. Read the <em>in-depth</em> sections later in the chapter for more detail on how the file operations work in Gradle and what options you have for configuring them.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:copying_directories_example"><a class="anchor" href="#sec:copying_directories_example"></a><a class="link" href="#sec:copying_directories_example">Copying directory hierarchies</a></h4>
<div class="paragraph">
<p>You may have a need to copy not just files, but the directory structure they reside in as well. This is the default behavior when you specify a directory as the <code>from()</code> argument, as demonstrated by the following example that copies everything in the <code>reports</code> directory, including all its subdirectories, to the destination:</p>
</div>
<div class="exampleblock">
<div class="title">Example 112. Copying an entire directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReportsDirForArchiving(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsDirForArchiving&quot;) {
    from(&quot;$buildDir/reports&quot;)
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The key aspect that users struggle with is controlling how much of the directory structure goes to the destination. In the above example, do you get a <code>toArchive/reports</code> directory or does everything in <code>reports</code> go straight into <code>toArchive</code>? The answer is the latter. If a directory is part of the <code>from()</code> path, then it <em>won&#8217;t</em> appear in the destination.</p>
</div>
<div class="paragraph">
<p>So how do you ensure that <code>reports</code> itself is copied across, but not any other directory in <code>$buildDir</code>? The answer is to add it as an include pattern:</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. Copying an entire directory, including itself</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyReportsDirForArchiving2(<span class="key">type</span>: Copy) {
    from(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="delimiter">&quot;</span></span>) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">reports/**</span><span class="delimiter">&quot;</span></span>
    }
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyReportsDirForArchiving2&quot;) {
    from(&quot;$buildDir&quot;) {
        include(&quot;reports/**&quot;)
    }
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll get the same behavior as before except with one extra level of directory in the destination, i.e. <code>toArchive/reports</code>.</p>
</div>
<div class="paragraph">
<p>One thing to note is how the <code>include()</code> directive applies only to the <code>from()</code>, whereas the directive in the previous section applied to the whole task.
These different levels of granularity in the copy specification allow you to easily handle most requirements that you will come across.
You can learn more about this in the section on <a href="#sub:using_child_copy_specifications">child specifications</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_archives_example"><a class="anchor" href="#sec:creating_archives_example"></a><a class="link" href="#sec:creating_archives_example">Creating archives (zip, tar, etc.)</a></h4>
<div class="paragraph">
<p>From the perspective of Gradle, packing files into an archive is effectively a copy in which the destination is the archive file rather than a directory on the file system. This means that creating archives looks a lot like copying, with all of the same features!</p>
</div>
<div class="paragraph">
<p>The simplest case involves archiving the entire contents of a directory, which this example demonstrates by creating a ZIP of the <code>toArchive</code> directory:</p>
</div>
<div class="exampleblock">
<div class="title">Example 114. Archiving a directory as a ZIP</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task packageDistribution(<span class="key">type</span>: Zip) {
    archiveFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-distribution.zip</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/dist</span><span class="delimiter">&quot;</span></span>)

    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    archiveFileName.set(&quot;my-distribution.zip&quot;)
    destinationDirectory.set(file(&quot;$buildDir/dist&quot;))

    from(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice how we specify the destination and name of the archive instead of an <code>into()</code>: both are required. You often won&#8217;t see them explicitly set, because most projects apply the <a href="#base_plugin">Base Plugin</a>. It provides some conventional values for those properties. The next example demonstrates this and you can learn more about the conventions in the <a href="#sec:archive_naming">archive naming</a> section.</p>
</div>
<div class="paragraph">
<p>Each type of archive has its own task type, the most common ones being <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>. They all share most of the configuration options of <code>Copy</code>, including filtering and renaming.</p>
</div>
<div class="paragraph">
<p>One of the most common scenarios involves copying files into specified subdirectories of the archive. For example, let&#8217;s say you want to package all PDFs into a <code>docs</code> directory in the root of the archive. This <code>docs</code> directory doesn&#8217;t exist in the source location, so you have to create it as part of the archive. You do this by adding an <code>into()</code> declaration for just the PDFs:</p>
</div>
<div class="exampleblock">
<div class="title">Example 115. Using the Base Plugin for its archive name convention</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>

task packageDistribution(<span class="key">type</span>: Zip) {
    from(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>) {
        exclude <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
    }

    from(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.pdf</span><span class="delimiter">&quot;</span></span>
        into <span class="string"><span class="delimiter">&quot;</span><span class="content">docs</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0.0&quot;

tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    from(&quot;$buildDir/toArchive&quot;) {
        exclude(&quot;**/*.pdf&quot;)
    }

    from(&quot;$buildDir/toArchive&quot;) {
        include(&quot;**/*.pdf&quot;)
        into(&quot;docs&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, you can have multiple <code>from()</code> declarations in a copy specification, each with its own configuration. See <a href="#sub:using_child_copy_specifications">Using child copy specifications</a> for more information on this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:unpacking_archives_example"><a class="anchor" href="#sec:unpacking_archives_example"></a><a class="link" href="#sec:unpacking_archives_example">Unpacking archives</a></h4>
<div class="paragraph">
<p>Archives are effectively self-contained file systems, so unpacking them is a case of copying the files from that file system onto the local file system or even into another archive. \
Gradle enables this by providing some wrapper functions that make archives available as hierarchical collections of files (<a href="#sec:file_trees">file trees</a>).</p>
</div>
<div class="paragraph">
<p>The two functions of interest are <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:tarTree(java.lang.Object)">Project.tarTree(java.lang.Object)</a>, which produce a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> from a corresponding archive file. That file tree can then be used in a <code>from()</code> specification, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 116. Unpacking a ZIP file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task unpackFiles(<span class="key">type</span>: Copy) {
    from zipTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/resources/thirdPartyResources.zip</span><span class="delimiter">&quot;</span></span>)
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/resources</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;unpackFiles&quot;) {
    from(zipTree(&quot;src/resources/thirdPartyResources.zip&quot;))
    into(&quot;$buildDir/resources&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As with a normal copy, you can control which files are unpacked via <a href="#sec:filtering_files">filters</a> and even <a href="#sec:renaming_files">rename files</a> as they are unpacked.</p>
</div>
<div class="paragraph">
<p>More advanced processing can be handled by the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.AbstractCopyTask.html#eachFile(org.gradle.api.Action)">eachFile()</a> method. For example, you might need to extract different subtrees of the archive into different paths within the destination directory. The following sample uses the method to extract the files within the archive&#8217;s <code>libs</code> directory into the root destination directory, rather than into a <code>libs</code> subdirectory:</p>
</div>
<div class="exampleblock">
<div class="title">Example 117. Unpacking a subset of a ZIP file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task unpackLibsDirectory(<span class="key">type</span>: Copy) {
    from(zipTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/resources/thirdPartyResources.zip</span><span class="delimiter">&quot;</span></span>)) {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">libs/**</span><span class="delimiter">&quot;</span></span>  // <b class="conum">(1)</b>
        eachFile { fcd -&gt;
            fcd.relativePath = <span class="keyword">new</span> RelativePath(<span class="predefined-constant">true</span>, fcd.relativePath.segments.drop(<span class="integer">1</span>))  // <b class="conum">(2)</b>
        }
        includeEmptyDirs = <span class="predefined-constant">false</span>  // <b class="conum">(3)</b>
    }
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/resources</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;unpackLibsDirectory&quot;) {
    from(zipTree(&quot;src/resources/thirdPartyResources.zip&quot;)) {
        include(&quot;libs/**&quot;)  // <b class="conum">(1)</b>
        eachFile {
            relativePath = RelativePath(true, *relativePath.segments.drop(1).toTypedArray())  // <b class="conum">(2)</b>
        }
        includeEmptyDirs = false  // <b class="conum">(3)</b>
    }
    into(&quot;$buildDir/resources&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Extracts only the subset of files that reside in the <code>libs</code> directory</p>
</li>
<li>
<p>Remaps the path of the extracting files into the destination directory by dropping the <code>libs</code> segment from the file path</p>
</li>
<li>
<p>Ignores the empty directories resulting from the remapping, see Caution note below</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can not change the destination path of empty directories with this technique.
You can learn more in <a href="https://github.com/gradle/gradle/issues/2940">this issue</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;re a Java developer and are wondering why there is no <code>jarTree()</code> method, that&#8217;s because <code>zipTree()</code> works perfectly well for JARs, WARs and EARs.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_uber_jar_example"><a class="anchor" href="#sec:creating_uber_jar_example"></a><a class="link" href="#sec:creating_uber_jar_example">Creating "uber" or "fat" JARs</a></h4>
<div class="paragraph">
<p>In the Java space, applications and their dependencies typically used to be packaged as separate JARs within a single distribution archive. That still happens, but there is another approach that is now common: placing the classes and resources of the dependencies directly into the application JAR, creating what is known as an uber or fat JAR.</p>
</div>
<div class="paragraph">
<p>Gradle makes this approach easy to accomplish. Consider the aim: to copy the contents of other JAR files into the application JAR. All you need for this is the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> method and the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a> task, as demonstrated by the <code>uberJar</code> task in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 118. Creating a Java uber or fat JAR</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">'</span></span>
}

task uberJar(<span class="key">type</span>: Jar) {
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">uber</span><span class="delimiter">'</span></span>

    from sourceSets.main.output

    dependsOn configurations.runtimeClasspath
    from {
        configurations.runtimeClasspath.findAll { <span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) }.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

version = &quot;1.0.0&quot;

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.6&quot;)
}

tasks.register&lt;Jar&gt;(&quot;uberJar&quot;) {
    archiveClassifier.set(&quot;uber&quot;)

    from(sourceSets.main.get().output)

    dependsOn(configurations.runtimeClasspath)
    from({
        configurations.runtimeClasspath.get().filter { it.name.endsWith(&quot;jar&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, we&#8217;re taking the runtime dependencies of the project  <code>configurations.runtimeClasspath.files</code>  and wrapping each of the JAR files with the <code>zipTree()</code> method. The result is a collection of ZIP file trees, the contents of which are copied into the uber JAR alongside the application classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:creating_directories_example"><a class="anchor" href="#sec:creating_directories_example"></a><a class="link" href="#sec:creating_directories_example">Creating directories</a></h4>
<div class="paragraph">
<p>Many tasks need to create directories to store the files they generate, which is why Gradle automatically manages this aspect of tasks when they explicitly define file and directory outputs. You can learn about this feature in the <a href="#sec:up_to_date_checks">incremental build</a> section of the user manual. All core Gradle tasks ensure that any output directories they need are created if necessary using this mechanism.</p>
</div>
<div class="paragraph">
<p>In cases where you need to create a directory manually, you can use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:mkdir(java.lang.Object)">Project.mkdir(java.lang.Object)</a> method from within your build scripts or custom task implementations. Here&#8217;s a simple example that creates a single <code>images</code> directory in the project folder:</p>
</div>
<div class="exampleblock">
<div class="title">Example 119. Manually creating a directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task ensureDirectory {
    doLast {
        mkdir <span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;ensureDirectory&quot;) {
    doLast {
        mkdir(&quot;images&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As described in the <a href="https://ant.apache.org/manual/Tasks/mkdir.html">Apache Ant manual</a>, the <code>mkdir</code> task will automatically create all necessary directories in the given path and will do nothing if the directory already exists.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:moving_files_example"><a class="anchor" href="#sec:moving_files_example"></a><a class="link" href="#sec:moving_files_example">Moving files and directories</a></h4>
<div class="paragraph">
<p>Gradle has no API for moving files and directories around, but you can use the <a href="#ant">Apache Ant integration</a> to easily do that, as shown in this example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 120. Moving a directory using the Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task moveReports {
    doLast {
        ant.move <span class="key">file</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>buildDir<span class="inline-delimiter">}</span></span><span class="content">/reports</span><span class="delimiter">&quot;</span></span>,
                 <span class="key">todir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>buildDir<span class="inline-delimiter">}</span></span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;moveReports&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;move&quot;(&quot;file&quot; to &quot;${buildDir}/reports&quot;, &quot;todir&quot; to &quot;${buildDir}/toArchive&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is not a common requirement and should be used sparingly as you lose information and can easily break a build. It&#8217;s generally preferable to copy directories and files instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:renaming_files_example"><a class="anchor" href="#sec:renaming_files_example"></a><a class="link" href="#sec:renaming_files_example">Renaming files on copy</a></h4>
<div class="paragraph">
<p>The files used and generated by your builds sometimes don&#8217;t have names that suit, in which case you want to rename those files as you copy them. Gradle allows you to do this as part of a copy specification using the <code>rename()</code> configuration.</p>
</div>
<div class="paragraph">
<p>The following example removes the "-staging-" marker from the names of any files that have it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 121. Renaming files as they are copied</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyFromStaging(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/webapp</span><span class="delimiter">&quot;</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>

    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyFromStaging&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(&quot;$buildDir/explodedWar&quot;)

    rename(&quot;(.+)-staging(.+)&quot;, &quot;$1$2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use regular expressions for this, as in the above example, or closures that use more complex logic to determine the target filename. For example, the following task truncates filenames:</p>
</div>
<div class="exampleblock">
<div class="title">Example 122. Truncating filenames as they are copied</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyWithTruncate(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports</span><span class="delimiter">&quot;</span></span>
    rename { <span class="predefined-type">String</span> filename -&gt;
        <span class="keyword">if</span> (filename.size() &gt; <span class="integer">10</span>) {
            <span class="keyword">return</span> filename[<span class="integer">0</span>..<span class="integer">7</span>] + <span class="string"><span class="delimiter">&quot;</span><span class="content">~</span><span class="delimiter">&quot;</span></span> + filename.size()
        }
        <span class="keyword">else</span> <span class="keyword">return</span> filename
    }
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyWithTruncate&quot;) {
    from(&quot;$buildDir/reports&quot;)
    rename { filename: String -&gt;
        if (filename.length &gt; 10) {
            filename.slice(0..7) + &quot;~&quot; + filename.length
        }
        else filename
    }
    into(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As with filtering, you can also apply renaming to a subset of files by configuring it as part of a child specification on a <code>from()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:deleting_files_example"><a class="anchor" href="#sec:deleting_files_example"></a><a class="link" href="#sec:deleting_files_example">Deleting files and directories</a></h4>
<div class="paragraph">
<p>You can easily delete files and directories using either the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a> task or the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:delete(org.gradle.api.Action)">Project.delete(org.gradle.api.Action)</a> method.
In both cases, you specify which files and directories to delete in a way supported by the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a> method.</p>
</div>
<div class="paragraph">
<p>For example, the following task deletes the entire contents of a build&#8217;s output directory:</p>
</div>
<div class="exampleblock">
<div class="title">Example 123. Deleting a directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task myClean(<span class="key">type</span>: Delete) {
    delete buildDir
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;myClean&quot;) {
    delete(buildDir)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want more control over which files are deleted, you can&#8217;t use inclusions and exclusions in the same way as for copying files.
Instead, you have to use the builtin filtering mechanisms of <code>FileCollection</code> and <code>FileTree</code>.
The following example does just that to clear out temporary files from a source directory:</p>
</div>
<div class="exampleblock">
<div class="title">Example 124. Deleting files matching a specific pattern</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task cleanTempFiles(<span class="key">type</span>: Delete) {
    delete fileTree(<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>).matching {
        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.tmp</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Delete&gt;(&quot;cleanTempFiles&quot;) {
    delete(fileTree(&quot;src&quot;).matching {
        include(&quot;**/*.tmp&quot;)
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll learn more about file collections and file trees in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:locating_files"><a class="anchor" href="#sec:locating_files"></a><a class="link" href="#sec:locating_files">File paths in depth</a></h4>
<div class="paragraph">
<p>In order to perform some action on a file, you need to know where it is, and that&#8217;s the information provided by file paths. Gradle builds on the standard Java <code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a></code> class, which represents the location of a single file, and provides new APIs for dealing with collections of paths. This section shows you how to use the Gradle APIs to specify file paths for use in tasks and file operations.</p>
</div>
<div class="paragraph">
<p>But first, an important note on using hard-coded file paths in your builds.</p>
</div>
<div class="sect4">
<h5 id="sec:hard_coded_file_paths"><a class="anchor" href="#sec:hard_coded_file_paths"></a><a class="link" href="#sec:hard_coded_file_paths">On hard-coded file paths</a></h5>
<div class="paragraph">
<p>Many examples in this chapter use hard-coded paths as string literals. This makes them easy to understand, but it&#8217;s not good practice for real builds. The problem is that paths often change and the more places you need to change them, the more likely you are to miss one and break the build.</p>
</div>
<div class="paragraph">
<p>Where possible, you should use tasks, task properties, and <a href="#sec:extra_properties">project properties</a>  in that order of preference  to configure file paths. For example, if you were to create a task that packages the compiled classes of a Java application, you should aim for something like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 125. How to minimize the number of hard-coded paths in your build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
    archivesDirPath = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/archives</span><span class="delimiter">&quot;</span></span>
}

task packageClasses(<span class="key">type</span>: Zip) {
    archiveAppendix = <span class="string"><span class="delimiter">&quot;</span><span class="content">classes</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = file(archivesDirPath)

    from compileJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val archivesDirPath by extra { &quot;$buildDir/archives&quot; }

tasks.register&lt;Zip&gt;(&quot;packageClasses&quot;) {
    archiveAppendix.set(&quot;classes&quot;)
    destinationDirectory.set(file(archivesDirPath))

    from(tasks.compileJava)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See how we&#8217;re using the <code>compileJava</code> task as the source of the files to package and we&#8217;ve created a project property <code>archivesDirPath</code> to store the location where we put archives, on the basis we&#8217;re likely to use it elsewhere in the build.</p>
</div>
<div class="paragraph">
<p>Using a task directly as an argument like this relies on it having <a href="#sec:task_inputs_outputs">defined outputs</a>, so it won&#8217;t always be possible.
In addition, this example could be improved further by relying on the Java plugin&#8217;s convention for <code>destinationDirectory</code> rather than overriding it, but it does demonstrate the use of project properties.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:single_file_paths"><a class="anchor" href="#sec:single_file_paths"></a><a class="link" href="#sec:single_file_paths">Single files and directories</a></h5>
<div class="paragraph">
<p>Gradle provides the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method for specifying the location of a single file or directory.
Relative paths are resolved relative to the project directory, while absolute paths remain unchanged.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Never use <code>new File(relative path)</code> because this creates a path relative to the current working directory (CWD). Gradle can make no guarantees about the location of the CWD, which means builds that rely on it may break at any time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are some examples of using the <code>file()</code> method with different types of argument:</p>
</div>
<div class="exampleblock">
<div class="title">Example 126. Locating files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Using a relative path</span>
<span class="predefined-type">File</span> configFile = file(<span class="string"><span class="delimiter">'</span><span class="content">src/config.xml</span><span class="delimiter">'</span></span>)

<span class="comment">// Using an absolute path</span>
configFile = file(configFile.absolutePath)

<span class="comment">// Using a File object with a relative path</span>
configFile = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/config.xml</span><span class="delimiter">'</span></span>))

<span class="comment">// Using a java.nio.file.Path object with a relative path</span>
configFile = file(Paths.get(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">config.xml</span><span class="delimiter">'</span></span>))

<span class="comment">// Using an absolute java.nio.file.Path object</span>
configFile = file(Paths.get(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">user.home</span><span class="delimiter">'</span></span>)).resolve(<span class="string"><span class="delimiter">'</span><span class="content">global-config.xml</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Using a relative path
var configFile = file(&quot;src/config.xml&quot;)

// Using an absolute path
configFile = file(configFile.absolutePath)

// Using a File object with a relative path
configFile = file(File(&quot;src/config.xml&quot;))

// Using a java.nio.file.Path object with a relative path
configFile = file(Paths.get(&quot;src&quot;, &quot;config.xml&quot;))

// Using an absolute java.nio.file.Path object
configFile = file(Paths.get(System.getProperty(&quot;user.home&quot;)).resolve(&quot;global-config.xml&quot;))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, you can pass strings, <code>File</code> instances and <code><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">Path</a></code> instances to the <code>file()</code> method, all of which result in an absolute <code>File</code> object. You can find other options for argument types in the reference guide, linked in the previous paragraph.</p>
</div>
<div class="paragraph">
<p>What happens in the case of multi-project builds? The <code>file()</code> method will always turn relative paths into paths that are relative to the current project directory, which may be a child project. If you want to use a path that&#8217;s relative to the <em>root project</em> directory, then you need to use the special <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:rootDir">Project.getRootDir()</a> property to construct an absolute path, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 127. Creating a path relative to a parent project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">File</span> configFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>rootDir</span><span class="content">/shared/config.xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val configFile = file(&quot;$rootDir/shared/config.xml&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say you&#8217;re working on a multi-project build in a <code>dev/projects/AcmeHealth</code> directory. You use the above example in the build of the library you&#8217;re fixing  at <code>AcmeHealth/subprojects/AcmePatientRecordLib/build.gradle</code>. The file path will resolve to the absolute version of <code>dev/projects/AcmeHealth/shared/config.xml</code>.</p>
</div>
<div class="paragraph">
<p>The <code>file()</code> method can be used to configure any task that has a property of type <code>File</code>. Many tasks, though, work on multiple files, so we look at how to specify sets of files next.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:file_collections"><a class="anchor" href="#sec:file_collections"></a><a class="link" href="#sec:file_collections">File collections</a></h5>
<div class="paragraph">
<p>A <em>file collection</em> is simply a set of file paths that&#8217;s represented by the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a> interface. <em>Any</em> file paths.
It&#8217;s important to understand that the file paths don&#8217;t have to be related in any way, so they don&#8217;t have to be in the same directory or even have a shared parent directory.
You will also find that many parts of the Gradle API use <code>FileCollection</code>, such as the copying API discussed later in this chapter and <a href="#sec:what-are-dependency-configurations">dependency configurations</a>.</p>
</div>
<div class="paragraph">
<p>The recommended way to specify a collection of files is to use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object...)</a> method, which returns a <code>FileCollection</code> instance.
This method is very flexible and allows you to pass multiple strings, <code>File</code> instances, collections of strings, collections of <code>File</code>s, and more.
You can even pass in tasks as arguments if they have <a href="#sec:task_inputs_outputs">defined outputs</a>.
Learn about all the supported argument types in the reference guide.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>files()</code> method accepts <code>File</code> instances, never use <code>new File(relative path)</code> with it because this creates a path relative to the current working directory (CWD). Gradle can make no guarantees about the location of the CWD, which means builds that rely on it may break at any time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As with the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method covered in the <a href="#sec:single_file_paths">previous section</a>, all relative paths are evaluated relative to the current project directory. The following example demonstrates some of the variety of argument types you can use  strings, <code>File</code> instances, a list and a <code><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html">Path</a></code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 128. Creating a file collection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">FileCollection collection = layout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file1.txt</span><span class="delimiter">'</span></span>,
                                  <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>),
                                  [<span class="string"><span class="delimiter">'</span><span class="content">src/file3.csv</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/file4.csv</span><span class="delimiter">'</span></span>],
                                  Paths.get(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">file5.txt</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val collection: FileCollection = layout.files(
    &quot;src/file1.txt&quot;,
    File(&quot;src/file2.txt&quot;),
    listOf(&quot;src/file3.csv&quot;, &quot;src/file4.csv&quot;),
    Paths.get(&quot;src&quot;, &quot;file5.txt&quot;)
)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>File collections have some important attributes in Gradle. They can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>created lazily</p>
</li>
<li>
<p>iterated over</p>
</li>
<li>
<p>filtered</p>
</li>
<li>
<p>combined</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Lazy creation</em> of a file collection is useful when you need to evaluate the files that make up a collection at the time a build runs. In the following example, we query the file system to find out what files exist in a particular directory and then make those into a file collection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 129. Implementing a file collection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task list {
    doLast {
        <span class="predefined-type">File</span> srcDir

        <span class="comment">// Create a file collection using a closure</span>
        collection = layout.files { srcDir.listFiles() }

        srcDir = file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Contents of </span><span class="inline"><span class="inline-delimiter">$</span>srcDir</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        collection.collect { relativePath(<span class="local-variable">it</span>) }.sort().each { println <span class="local-variable">it</span> }

        srcDir = file(<span class="string"><span class="delimiter">'</span><span class="content">src2</span><span class="delimiter">'</span></span>)
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Contents of </span><span class="inline"><span class="inline-delimiter">$</span>srcDir</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        collection.collect { relativePath(<span class="local-variable">it</span>) }.sort().each { println <span class="local-variable">it</span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;list&quot;) {
    doLast {
        var srcDir: File? = null

        val collection = layout.files({
            srcDir?.listFiles()
        })

        srcDir = file(&quot;src&quot;)
        println(&quot;Contents of ${srcDir.name}&quot;)
        collection.map { relativePath(it) }.sorted().forEach { println(it) }

        srcDir = file(&quot;src2&quot;)
        println(&quot;Contents of ${srcDir.name}&quot;)
        collection.map { relativePath(it) }.sorted().forEach { println(it) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q list</code></strong></div>
<div class="content">
<pre>&gt; gradle -q list
Contents of src
src/dir1
src/file1.txt
Contents of src2
src2/dir1
src2/dir2</pre>
</div>
</div>
<div class="paragraph">
<p>The key to lazy creation is passing a closure (in Groovy) or a <code>Provider</code> (in Kotlin) to the <code>files()</code> method. Your closure/provider simply needs to return a value of a type accepted by <code>files()</code>, such as <code>List&lt;File&gt;</code>, <code>String</code>, <code>FileCollection</code>, etc.</p>
</div>
<div class="paragraph">
<p><em>Iterating over a file collection</em> can be done through the <code>each()</code> method (in Groovy) of <code>forEach</code> method (in Kotlin) on the collection or using the collection in a <code>for</code> loop. In both approaches, the file collection is treated as a set of <code>File</code> instances, i.e. your iteration variable will be of type <code>File</code>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates such iteration as well as how you can convert file collections to other types using the <code>as</code> operator or supported properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 130. Using a file collection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="comment">// Iterate over the files in the collection</span>
        collection.each { <span class="predefined-type">File</span> file -&gt;
            println file.name
        }

        <span class="comment">// Convert the collection to various types</span>
        <span class="predefined-type">Set</span> set = collection.files
        <span class="predefined-type">Set</span> set2 = collection <span class="keyword">as</span> <span class="predefined-type">Set</span>
        <span class="predefined-type">List</span> list = collection <span class="keyword">as</span> <span class="predefined-type">List</span>
        <span class="predefined-type">String</span> path = collection.asPath
        <span class="predefined-type">File</span> file = collection.singleFile

        <span class="comment">// Add and subtract collections</span>
        <span class="keyword">def</span> union = collection + layout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>)
        <span class="keyword">def</span> difference = collection - layout.files(<span class="string"><span class="delimiter">'</span><span class="content">src/file2.txt</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        // Iterate over the files in the collection
        collection.forEach { file: File -&gt;
            println(file.name)
        }

        // Convert the collection to various types
        val set: Set&lt;File&gt; = collection.files
        val list: List&lt;File&gt; = collection.toList()
        val path: String = collection.asPath
        val file: File = collection.singleFile

        // Add and subtract collections
        val union = collection + layout.files(&quot;src/file2.txt&quot;)
        val difference = collection - layout.files(&quot;src/file2.txt&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also see at the end of the example <em>how to combine file collections</em> using the <code>+</code> and <code>-</code> operators to merge and subtract them. An important feature of the resulting file collections is that they are <em>live</em>. In other words, when you combine file collections in this way, the result always reflects what&#8217;s currently in the source file collections, even if they change during the build.</p>
</div>
<div class="paragraph">
<p>For example, imagine <code>collection</code> in the above example gains an extra file or two after <code>union</code> is created. As long as you use <code>union</code> after those files are added to <code>collection</code>, <code>union</code> will also contain those additional files. The same goes for the <code>different</code> file collection.</p>
</div>
<div class="paragraph">
<p>Live collections are also important when it comes to <em>filtering</em>. If you want to use a subset of a file collection, you can take advantage of the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html#filter-org.gradle.api.specs.Spec-">FileCollection.filter(org.gradle.api.specs.Spec)</a> method to determine which files to "keep". In the following example, we create a new collection that consists of only the files that end with .txt in the source collection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 131. Filtering a file collection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        FileCollection textFiles = collection.filter { <span class="predefined-type">File</span> f -&gt;
            f.name.endsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">.txt</span><span class="delimiter">&quot;</span></span>)
        }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        val textFiles: FileCollection = collection.filter { f: File -&gt;
            f.name.endsWith(&quot;.txt&quot;)
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q filterTextFiles</code></strong></div>
<div class="content">
<pre>&gt; gradle -q filterTextFiles
src/file1.txt
src/file2.txt
src/file5.txt</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>collection</code> changes at any time, either by adding or removing files from itself, then <code>textFiles</code> will immediately reflect the change because it is also a live collection. Note that the closure you pass to <code>filter()</code> takes a <code>File</code> as an argument and should return a boolean.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:file_trees"><a class="anchor" href="#sec:file_trees"></a><a class="link" href="#sec:file_trees">File trees</a></h5>
<div class="paragraph">
<p>A <em>file tree</em> is a file collection that retains the directory structure of the files it contains and has the type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a>. This means that all the paths in a file tree must have a shared parent directory. The following diagram highlights the distinction between file trees and file collections in the common case of copying files:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/file-collection-vs-file-tree.png" alt="file collection vs file tree">
</div>
<div class="title">Figure 10. The differences in how file trees and file collections behave when copying files</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although <code>FileTree</code> extends <code>FileCollection</code> (an is-a relationship), their behaviors do differ. In other words, you can use a file tree wherever a file collection is required, but remember: a file collection is a flat list/set of files, while a file tree is a file and directory hierarchy. To convert a file tree to a flat collection, use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html#getFiles--">FileTree.getFiles()</a> property.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The simplest way to create a file tree is to pass a file or directory path to the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(java.lang.Object)</a> method. This will create a tree of all the files and directories in that base directory (but not the base directory itself). The following example demonstrates how to use the basic method and, in addition, how to filter the files and directories using Ant-style patterns:</p>
</div>
<div class="exampleblock">
<div class="title">Example 132. Creating a file tree</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create a file tree with a base directory</span>
ConfigurableFileTree tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/main</span><span class="delimiter">'</span></span>)

<span class="comment">// Add include and exclude patterns to the tree</span>
tree.include <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>
tree.exclude <span class="string"><span class="delimiter">'</span><span class="content">**/Abstract*</span><span class="delimiter">'</span></span>

<span class="comment">// Create a tree using closure</span>
tree = fileTree(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>) {
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>
}

<span class="comment">// Create a tree using a map</span>
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">include</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>)
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: [<span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>])
tree = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>, <span class="key">include</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*.java</span><span class="delimiter">'</span></span>, <span class="key">exclude</span>: <span class="string"><span class="delimiter">'</span><span class="content">**/*test*/**</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create a file tree with a base directory
var tree: ConfigurableFileTree = fileTree(&quot;src/main&quot;)

// Add include and exclude patterns to the tree
tree.include(&quot;**/*.java&quot;)
tree.exclude(&quot;**/Abstract*&quot;)

// Create a tree using closure
tree = fileTree(&quot;src&quot;) {
    include(&quot;**/*.java&quot;)
}

// Create a tree using a map
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;include&quot; to &quot;**/*.java&quot;)
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;includes&quot; to listOf(&quot;**/*.java&quot;, &quot;**/*.xml&quot;))
tree = fileTree(&quot;dir&quot; to &quot;src&quot;, &quot;include&quot; to &quot;**/*.java&quot;, &quot;exclude&quot; to &quot;**/*test*/**&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see more examples of supported patterns in the API docs for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/util/PatternFilterable.html">PatternFilterable</a>. Also, see the API documentation for <code>fileTree()</code> to see what types you can pass as the base directory.</p>
</div>
<div class="paragraph">
<p>By default, <code>fileTree()</code> returns a <code>FileTree</code> instance that applies some default exclusion patterns for convenience  the same defaults as Ant in fact. For the complete default exclusion list, see <a href="http://ant.apache.org/manual/dirtasks.html#defaultexcludes">the Ant manual</a>.</p>
</div>
<div class="paragraph">
<p>If those default exclusions prove problematic, you can workaround the issue by using the <a href="https://ant.apache.org/manual/Tasks/defaultexcludes.html"><code>defaultexcludes</code> Ant task</a>, as demonstrated in this example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 133. Changing Ant default exclusions for a copy task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task forcedCopy (<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/inPlaceApp</span><span class="delimiter">&quot;</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>

    doFirst {
        ant.defaultexcludes <span class="key">remove</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">**/.git</span><span class="delimiter">&quot;</span></span>
        ant.defaultexcludes <span class="key">remove</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">**/.git/**</span><span class="delimiter">&quot;</span></span>
        ant.defaultexcludes <span class="key">remove</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*~</span><span class="delimiter">&quot;</span></span>
    }

    doLast {
        ant.defaultexcludes <span class="keyword">default</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;forcedCopy&quot;) {
    into(&quot;$buildDir/inPlaceApp&quot;)
    from(&quot;src/main/webapp&quot;)

    doFirst {
        ant.withGroovyBuilder {
            &quot;defaultexcludes&quot;(&quot;remove&quot; to &quot;**/.git&quot;)
            &quot;defaultexcludes&quot;(&quot;remove&quot; to &quot;**/.git/**&quot;)
            &quot;defaultexcludes&quot;(&quot;remove&quot; to &quot;**/*~&quot;)
        }
    }

    doLast {
        ant.withGroovyBuilder {
            &quot;defaultexcludes&quot;(&quot;default&quot; to true)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In general, it&#8217;s best to ensure that the default exclusions are reset whenever you change them as modifications are visible to the entire build. The above example is performing such a reset in its <code>doLast</code> action.</p>
</div>
<div class="paragraph">
<p>You can do many of the same things with file trees that you can with file collections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iterate over them (depth first)</p>
</li>
<li>
<p>filter them (using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html#matching-org.gradle.api.Action-">FileTree.matching(org.gradle.api.Action)</a> and Ant-style patterns)</p>
</li>
<li>
<p>merge them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also traverse file trees using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html#visit-org.gradle.api.Action-">FileTree.visit(org.gradle.api.Action)</a> method. All of these techniques are demonstrated in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 134. Using a file tree</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Iterate over the contents of a tree</span>
tree.each {<span class="predefined-type">File</span> file -&gt;
    println file
}

<span class="comment">// Filter a tree</span>
FileTree filtered = tree.matching {
    include <span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span>
}

<span class="comment">// Add trees together</span>
FileTree sum = tree + fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/test</span><span class="delimiter">'</span></span>)

<span class="comment">// Visit the elements of the tree</span>
tree.visit {element -&gt;
    println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>element</span><span class="content">.relativePath =&gt; </span><span class="inline"><span class="inline-delimiter">$</span>element</span><span class="content">.file</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Iterate over the contents of a tree
tree.forEach{ file: File -&gt;
    println(file)
}

// Filter a tree
val filtered: FileTree = tree.matching {
    include(&quot;org/gradle/api/**&quot;)
}

// Add trees together
val sum: FileTree = tree + fileTree(&quot;src/test&quot;)

// Visit the elements of the tree
tree.visit {
    println(&quot;${this.relativePath} =&gt; ${this.file}&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve discussed how to create your own file trees and file collections, but it&#8217;s also worth bearing in mind that many Gradle plugins provide their own instances of file trees, such as <a href="#sec:java_source_sets">Java&#8217;s source sets</a>. These can be used and manipulated in exactly the same way as the file trees you create yourself.</p>
</div>
<div class="paragraph">
<p>Another specific type of file tree that users commonly need is the archive, i.e. ZIP files, TAR files, etc. We look at those next.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:archive_contents"><a class="anchor" href="#sec:archive_contents"></a><a class="link" href="#sec:archive_contents">Using archives as file trees</a></h5>
<div class="paragraph">
<p>An archive is a directory and file hierarchy packed into a single file. In other words, it&#8217;s a special case of a file tree, and that&#8217;s exactly how Gradle treats archives. Instead of using the <code>fileTree()</code> method, which only works on normal file systems, you use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:zipTree(java.lang.Object)">Project.zipTree(java.lang.Object)</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:tarTree(java.lang.Object)">Project.tarTree(java.lang.Object)</a> methods to wrap archive files of the corresponding type (note that JAR, WAR and EAR files are ZIPs). Both methods return <code>FileTree</code> instances that you can then use in the same way as normal file trees. For example, you can extract some or all of the files of an archive by copying its contents to some directory on the file system. Or you can merge one archive into another.</p>
</div>
<div class="paragraph">
<p>Here are some simple examples of creating archive-based file trees:</p>
</div>
<div class="exampleblock">
<div class="title">Example 135. Using an archive as a file tree</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Create a ZIP file tree using path</span>
FileTree zip = zipTree(<span class="string"><span class="delimiter">'</span><span class="content">someFile.zip</span><span class="delimiter">'</span></span>)

<span class="comment">// Create a TAR file tree using path</span>
FileTree tar = tarTree(<span class="string"><span class="delimiter">'</span><span class="content">someFile.tar</span><span class="delimiter">'</span></span>)

<span class="comment">//tar tree attempts to guess the compression based on the file extension</span>
<span class="comment">//however if you must specify the compression explicitly you can:</span>
FileTree someTar = tarTree(resources.gzip(<span class="string"><span class="delimiter">'</span><span class="content">someTar.ext</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Create a ZIP file tree using path
val zip: FileTree = zipTree(&quot;someFile.zip&quot;)

// Create a TAR file tree using path
val tar: FileTree = tarTree(&quot;someFile.tar&quot;)

// tar tree attempts to guess the compression based on the file extension
// however if you must specify the compression explicitly you can:
val someTar: FileTree = tarTree(resources.gzip(&quot;someTar.ext&quot;))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see a practical example of extracting an archive file <a href="#sec:unpacking_archives_example">in among the common scenarios</a> we cover.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:specifying_multiple_files"><a class="anchor" href="#sec:specifying_multiple_files"></a><a class="link" href="#sec:specifying_multiple_files">Understanding implicit conversion to file collections</a></h5>
<div class="paragraph">
<p>Many objects in Gradle have properties which accept a set of input files.
For example, the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a> task has a <code>source</code> property that defines the source files to compile.
You can set the value of this property using any of the types supported by the <a href="#sec:file_collections">files()</a> method, as mentioned in the api docs.
This means you can, for example, set the property to a <code>File</code>, <code>String</code>, collection, <code>FileCollection</code> or even a closure or <code>Provider</code>.</p>
</div>
<div class="paragraph">
<p><strong>This is a feature of specific tasks</strong>!
That means implicit conversion will not happen for just any task that has a <code>FileCollection</code> or <code>FileTree</code> property.
If you want to know whether implicit conversion happens in a particular situation, you will need to read the relevant documentation, such as the corresponding task&#8217;s API docs.
Alternatively, you can remove all doubt by explicitly using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object...)</a> in your build.</p>
</div>
<div class="paragraph">
<p>Here are some examples of the different types of arguments that the <code>source</code> property can take:</p>
</div>
<div class="exampleblock">
<div class="title">Example 136. Specifying a set of files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task compile(<span class="key">type</span>: JavaCompile) {

    <span class="comment">// Use a File object to specify the source directory</span>
    source = file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>)

    <span class="comment">// Use a String path to specify the source directory</span>
    source = <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>

    <span class="comment">// Use a collection to specify multiple source directories</span>
    source = [<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">../shared/java</span><span class="delimiter">'</span></span>]

    <span class="comment">// Use a FileCollection (or FileTree in this case) to specify the source files</span>
    source = fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>).matching { include <span class="string"><span class="delimiter">'</span><span class="content">org/gradle/api/**</span><span class="delimiter">'</span></span> }

    <span class="comment">// Using a closure to specify the source files.</span>
    source = {
        <span class="comment">// Use the contents of each zip file in the src dir</span>
        file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>).listFiles().findAll {<span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">.zip</span><span class="delimiter">'</span></span>)}.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;JavaCompile&gt;(&quot;compile&quot;) {
    // Use a File object to specify the source directory
    source = fileTree(file(&quot;src/main/java&quot;))

    // Use a String path to specify the source directory
    source = fileTree(&quot;src/main/java&quot;)

    // Use a collection to specify multiple source directories
    source = fileTree(listOf(&quot;src/main/java&quot;, &quot;../shared/java&quot;))

    // Use a FileCollection (or FileTree in this case) to specify the source files
    source = fileTree(&quot;src/main/java&quot;).matching { include(&quot;org/gradle/api/**&quot;) }

    // Using a closure to specify the source files.
    setSource({
        // Use the contents of each zip file in the src dir
        file(&quot;src&quot;).listFiles().filter { it.name.endsWith(&quot;.zip&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One other thing to note is that properties like <code>source</code> have corresponding methods in core Gradle tasks. Those methods follow the convention of <em>appending</em> to collections of values rather than replacing them. Again, this method accepts any of the types supported by the <a href="#sec:file_collections">files()</a> method, as shown here:</p>
</div>
<div class="exampleblock">
<div class="title">Example 137. Appending a set of files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile {
    <span class="comment">// Add some source directories use String paths</span>
    source <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/main/groovy</span><span class="delimiter">'</span></span>

    <span class="comment">// Add a source directory using a File object</span>
    source file(<span class="string"><span class="delimiter">'</span><span class="content">../shared/java</span><span class="delimiter">'</span></span>)

    <span class="comment">// Add some source directories using a closure</span>
    source { file(<span class="string"><span class="delimiter">'</span><span class="content">src/test/</span><span class="delimiter">'</span></span>).listFiles() }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;JavaCompile&gt;(&quot;compile&quot;) {
    // Add some source directories use String paths
    source(&quot;src/main/java&quot;, &quot;src/main/groovy&quot;)

    // Add a source directory using a File object
    source(file(&quot;../shared/java&quot;))

    // Add some source directories using a closure
    setSource({ file(&quot;src/test/&quot;).listFiles() })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As this is a common convention, we recommend that you follow it in your own custom tasks. Specifically, if you plan to add a method to configure a collection-based property, make sure the method appends rather than replaces values.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:copying_files"><a class="anchor" href="#sec:copying_files"></a><a class="link" href="#sec:copying_files">File copying in depth</a></h4>
<div class="paragraph">
<p>The basic process of copying files in Gradle is a simple one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a></p>
</li>
<li>
<p>Specify which files (and potentially directories) to copy</p>
</li>
<li>
<p>Specify a destination for the copied files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But this apparent simplicity hides a rich API that allows fine-grained control of which files are copied, where they go, and what happens to them as they are copied  renaming of the files and token substitution of file content are both possibilities, for example.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with the last two items on the list, which form what is known as a <em>copy specification</em>. This is formally based on the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> interface, which the <code>Copy</code> task implements, and offers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#from-java.lang.Object...-">CopySpec.from(java.lang.Object&#8230;&#8203;)</a> method to define what to copy</p>
</li>
<li>
<p>An <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#into-java.lang.Object-">CopySpec.into(java.lang.Object)</a> method to define the destination</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>CopySpec</code> has several additional methods that allow you to control the copying process, but these two are the only required ones. <code>into()</code> is straightforward, requiring a directory path as its argument in any form supported by the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method. The <code>from()</code> configuration is far more flexible.</p>
</div>
<div class="paragraph">
<p>Not only does <code>from()</code> accept multiple arguments, it also allows several different types of argument. For example, some of the most common types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>String</code>  treated as a file path or, if it starts with "file://", a file URI</p>
</li>
<li>
<p>A <code>File</code>  used as a file path</p>
</li>
<li>
<p>A <code>FileCollection</code> or <code>FileTree</code>  all files in the collection are included in the copy</p>
</li>
<li>
<p>A task the files or directories that form a task&#8217;s <a href="#sec:task_inputs_outputs">defined outputs</a> are included</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In fact, <code>from()</code> accepts all the same arguments as <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a> so see that method for a more detailed list of acceptable types.</p>
</div>
<div class="paragraph">
<p>Something else to consider is what type of thing a file path refers to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A file  the file is copied as is</p>
</li>
<li>
<p>A directory  this is effectively treated as a file tree: everything in it, including subdirectories, is copied. However, the directory itself is not included in the copy.</p>
</li>
<li>
<p>A non-existent file  the path is ignored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example that uses multiple <code>from()</code> specifications, each with a different argument type. You will probably also notice that <code>into()</code> is configured lazily using a closure (in Groovy) or a Provider (in Kotlin)  a technique that also works with <code>from()</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 138. Specifying copy task source files and destination directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task anotherCopyTask (<span class="key">type</span>: Copy) {
    <span class="comment">// Copy everything under src/main/webapp</span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    <span class="comment">// Copy a single file</span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/staging/index.html</span><span class="delimiter">'</span></span>
    <span class="comment">// Copy the output of a task</span>
    from copyTask
    <span class="comment">// Copy the output of a task using Task outputs explicitly.</span>
    from copyTaskWithPatterns.outputs
    <span class="comment">// Copy the contents of a Zip file</span>
    from zipTree(<span class="string"><span class="delimiter">'</span><span class="content">src/main/assets.zip</span><span class="delimiter">'</span></span>)
    <span class="comment">// Determine the destination directory later</span>
    into { getDestDir() }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;anotherCopyTask&quot;) {
    // Copy everything under src/main/webapp
    from(&quot;src/main/webapp&quot;)
    // Copy a single file
    from(&quot;src/staging/index.html&quot;)
    // Copy the output of a task
    from(copyTask)
    // Copy the output of a task using Task outputs explicitly.
    from(tasks[&quot;copyTaskWithPatterns&quot;].outputs)
    // Copy the contents of a Zip file
    from(zipTree(&quot;src/main/assets.zip&quot;))
    // Determine the destination directory later
    into({ getDestDir() })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the lazy configuration of <code>into()</code> is different from a <a href="#sub:using_child_copy_specifications">child specification</a>, even though the syntax is similar. Keep an eye on the number of arguments to distinguish between them.</p>
</div>
<div class="sect4">
<h5 id="filtering_files"><a class="anchor" href="#filtering_files"></a><a class="link" href="#filtering_files">Filtering files</a></h5>
<div class="paragraph">
<p>You&#8217;ve already seen that you can filter file collections and file trees directly in a <code>Copy</code> task, but you can also apply filtering in any copy specification through the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#include-java.lang.String...-">CopySpec.include(java.lang.String&#8230;&#8203;)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#exclude-java.lang.String...-">CopySpec.exclude(java.lang.String&#8230;&#8203;)</a> methods.</p>
</div>
<div class="paragraph">
<p>Both of these methods are normally used with Ant-style include or exclude patterns, as described in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/util/PatternFilterable.html">PatternFilterable</a>. You can also perform more complex logic by using a closure that takes a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTreeElement.html">FileTreeElement</a> and returns <code>true</code> if the file should be included or <code>false</code> otherwise. The following example demonstrates both forms, ensuring that only .html and .jsp files are copied, except for those .html files with the word "DRAFT" in their content:</p>
</div>
<div class="exampleblock">
<div class="title">Example 139. Selecting the files to copy</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyTaskWithPatterns (<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.jsp</span><span class="delimiter">'</span></span>
    exclude { FileTreeElement details -&gt;
        details.file.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">.html</span><span class="delimiter">'</span></span>) &amp;&amp;
            details.file.text.contains(<span class="string"><span class="delimiter">'</span><span class="content">DRAFT</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;copyTaskWithPatterns&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(&quot;$buildDir/explodedWar&quot;)
    include(&quot;**/*.html&quot;)
    include(&quot;**/*.jsp&quot;)
    exclude { details: FileTreeElement -&gt;
        details.file.name.endsWith(&quot;.html&quot;) &amp;&amp;
            details.file.readText().contains(&quot;DRAFT&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A question you may ask yourself at this point is what happens when inclusion and exclusion patterns overlap? Which pattern wins? Here are the basic rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there are no explicit inclusions or exclusions, everything is included</p>
</li>
<li>
<p>If at least one inclusion is specified, only files and directories matching the patterns are included</p>
</li>
<li>
<p>Any exclusion pattern overrides any inclusions, so if a file or directory matches at least one exclusion pattern, it won&#8217;t be included, regardless of the inclusion patterns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bear these rules in mind when creating combined inclusion and exclusion specifications so that you end up with the exact behavior you want.</p>
</div>
<div class="paragraph">
<p>Note that the inclusions and exclusions in the above example will apply to <em>all</em> <code>from()</code> configurations. If you want to apply filtering to a subset of the copied files, you&#8217;ll need to use <a href="#sub:using_child_copy_specifications">child specifications</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:renaming_files"><a class="anchor" href="#sec:renaming_files"></a><a class="link" href="#sec:renaming_files">Renaming files</a></h5>
<div class="paragraph">
<p>The <a href="#sec:renaming_files_example">example of how to rename files on copy</a> gives you most of the information you need to perform this operation. It demonstrates the two options for renaming:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a regular expression</p>
</li>
<li>
<p>Using a closure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Regular expressions are a flexible approach to renaming, particularly as Gradle supports regex groups that allow you to remove and replaces parts of the source filename. The following example shows how you can remove the string "-staging-" from any filename that contains it using a simple regular expression:</p>
</div>
<div class="exampleblock">
<div class="title">Example 140. Renaming files as they are copied</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task rename (<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>
    <span class="comment">// Use a closure to convert all file names to upper case</span>
    rename { <span class="predefined-type">String</span> fileName -&gt;
        fileName.toUpperCase()
    }
    <span class="comment">// Use a regular expression to map the file name</span>
    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging-(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
    rename(<span class="regexp"><span class="delimiter">/</span><span class="content">(.+)-staging-(.+)</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;rename&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(&quot;$buildDir/explodedWar&quot;)
    // Use a closure to convert all file names to upper case
    rename { fileName: String -&gt;
        fileName.toUpperCase()
    }
    // Use a regular expression to map the file name
    rename(&quot;(.+)-staging-(.+)&quot;, &quot;$1$2&quot;)
    rename(&quot;(.+)-staging-(.+)&quot;.toRegex().pattern, &quot;$1$2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use any regular expression supported by the Java <code><a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Pattern</a></code> class and the substitution string (the second argument of <code>rename()</code> works on the same principles as the <code><a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)">Matcher.appendReplacement()</a></code> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Regular expressions in Groovy build scripts</div>
<div class="paragraph">
<p>There are two common issues people come across when using regular expressions in this context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you use a slashy string (those delimited by '/') for the first argument, you <em>must</em> include the parentheses for <code>rename()</code> as shown in the above example.</p>
</li>
<li>
<p>It&#8217;s safest to use single quotes for the second argument, otherwise you need to escape the '$' in group substitutions, i.e. <code>"\$1\$2"</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first is a minor inconvenience, but slashy strings have the advantage that you don&#8217;t have to escape backslash ('\') characters in the regular expression. The second issue stems from Groovy&#8217;s support for embedded expressions using <code>${ }</code> syntax in double-quoted and slashy strings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The closure syntax for <code>rename()</code> is straightforward and can be used for any requirements that simple regular expressions can&#8217;t handle. You&#8217;re given the name of a file and you return a new name for that file, or <code>null</code> if you don&#8217;t want to change the name. Do be aware that the closure will be executed for every file that&#8217;s copied, so try to avoid expensive operations where possible.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:filtering_files"><a class="anchor" href="#sec:filtering_files"></a><a class="link" href="#sec:filtering_files">Filtering file content (token substitution, templating, etc.)</a></h5>
<div class="paragraph">
<p>Not to be confused with filtering which files are copied, <em>file content filtering</em> allows you to transform the content of files while they are being copied. This can involve basic templating that uses token substitution, removal of lines of text, or even more complex filtering using a full-blown template engine.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates several forms of filtering, including token substitution using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#expand-java.util.Map-">CopySpec.expand(java.util.Map)</a> method and another using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#filter-java.lang.Class-">CopySpec.filter(java.lang.Class)</a> with an <a href="https://ant.apache.org/manual/Types/filterchain.html">Ant filter</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 141. Filtering files as they are copied</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.tools.ant.filters.FixCrLfFilter</span>
<span class="keyword">import</span> <span class="include">org.apache.tools.ant.filters.ReplaceTokens</span>

task filter(<span class="key">type</span>: Copy) {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>
    <span class="comment">// Substitute property tokens in files</span>
    expand(<span class="key">copyright</span>: <span class="string"><span class="delimiter">'</span><span class="content">2009</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.3.1</span><span class="delimiter">'</span></span>)
    expand(project.properties)
    <span class="comment">// Use some of the filters provided by Ant</span>
    filter(FixCrLfFilter)
    filter(ReplaceTokens, <span class="key">tokens</span>: [<span class="key">copyright</span>: <span class="string"><span class="delimiter">'</span><span class="content">2009</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.3.1</span><span class="delimiter">'</span></span>])
    <span class="comment">// Use a closure to filter each line</span>
    filter { <span class="predefined-type">String</span> line -&gt;
        <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="inline"><span class="inline-delimiter">$</span>line</span><span class="content">]</span><span class="delimiter">&quot;</span></span>
    }
    <span class="comment">// Use a closure to remove lines</span>
    filter { <span class="predefined-type">String</span> line -&gt;
        line.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) ? <span class="predefined-constant">null</span> : line
    }
    filteringCharset = <span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.tools.ant.filters.FixCrLfFilter
import org.apache.tools.ant.filters.ReplaceTokens
tasks.register&lt;Copy&gt;(&quot;filter&quot;) {
    from(&quot;src/main/webapp&quot;)
    into(&quot;$buildDir/explodedWar&quot;)
    // Substitute property tokens in files
    expand(&quot;copyright&quot; to &quot;2009&quot;, &quot;version&quot; to &quot;2.3.1&quot;)
    expand(project.properties)
    // Use some of the filters provided by Ant
    filter(FixCrLfFilter::class)
    filter(ReplaceTokens::class, &quot;tokens&quot; to mapOf(&quot;copyright&quot; to &quot;2009&quot;, &quot;version&quot; to &quot;2.3.1&quot;))
    // Use a closure to filter each line
    filter { line: String -&gt;
        &quot;[$line]&quot;
    }
    // Use a closure to remove lines
    filter { line: String -&gt;
        if (line.startsWith('-')) null else line
    }
    filteringCharset = &quot;UTF-8&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>filter()</code> method has two variants, which behave differently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one takes a <code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/FilterReader.html">FilterReader</a></code> and is designed to work with Ant filters, such as <code>ReplaceTokens</code></p>
</li>
<li>
<p>one takes a closure or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Transformer.html">Transformer</a> that defines the transformation for each line of the source file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that both variants assume the source files are text based. When you use the <code>ReplaceTokens</code> class with <code>filter()</code>, the result is a template engine that replaces tokens of the form <code>@tokenName@</code> (the Ant-style token) with values that you define.</p>
</div>
<div class="paragraph">
<p>The <code>expand()</code> method treats the source files as <a href="https://docs.groovy-lang.org/latest/html/api/groovy/text/SimpleTemplateEngine.html">Groovy templates</a>, which evaluate and expand expressions of the form <code>${expression}</code>. You can pass in property names and values that are then expanded in the source files. <code>expand()</code> allows for more than basic token substitution as the embedded expressions are full-blown Groovy expressions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;s good practice to specify the character set when reading and writing the file, otherwise the transformations won&#8217;t work properly for non-ASCII text. You configure the character set with the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#getFilteringCharset--">CopySpec.getFilteringCharset()</a> property. If it&#8217;s not specified, the JVM default character set is used, which is likely to be different from the one you want.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_the_copyspec_class"><a class="anchor" href="#sec:using_the_copyspec_class"></a><a class="link" href="#sec:using_the_copyspec_class">Using the <code>CopySpec</code> class</a></h5>
<div class="paragraph">
<p>A copy specification (or copy spec for short) determines what gets copied to where, and what happens to files during the copy. You&#8217;ve alread seen many examples in the form of configuration for <code>Copy</code> and archiving tasks. But copy specs have two attributes that are worth covering in more detail:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They can be independent of tasks</p>
</li>
<li>
<p>They are hierarchical</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first of these attributes allows you to <em>share copy specs within a build</em>. The second provides fine-grained control within the overall copy specification.</p>
</div>
<div class="sect5">
<h6 id="sub:sharing_copy_specs"><a class="anchor" href="#sub:sharing_copy_specs"></a><a class="link" href="#sub:sharing_copy_specs">Sharing copy specs</a></h6>
<div class="paragraph">
<p>Consider a build that has several tasks that copy a project&#8217;s static website resources or add them to an archive. One task might copy the resources to a folder for a local HTTP server and another might package them into a distribution. You could manually specify the file locations and appropriate inclusions each time they are needed, but human error is more likely to creep in, resulting in inconsistencies between tasks.</p>
</div>
<div class="paragraph">
<p>One solution Gradle provides is the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copySpec(org.gradle.api.Action)">Project.copySpec(org.gradle.api.Action)</a> method. This allows you to create a copy spec outside of a task, which can then be attached to an appropriate task using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#with-org.gradle.api.file.CopySpec...-">CopySpec.with(org.gradle.api.file.CopySpec&#8230;&#8203;)</a> method. The following example demonstrates how this is done:</p>
</div>
<div class="exampleblock">
<div class="title">Example 142. Sharing copy specifications</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">CopySpec webAssetsSpec = copySpec {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
    rename <span class="string"><span class="delimiter">'</span><span class="content">(.+)-staging(.+)</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$1$2</span><span class="delimiter">'</span></span>
}

task copyAssets (<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/inPlaceApp</span><span class="delimiter">&quot;</span></span>
    with webAssetsSpec
}

task distApp(<span class="key">type</span>: Zip) {
    archiveFileName = <span class="string"><span class="delimiter">'</span><span class="content">my-app-dist.zip</span><span class="delimiter">'</span></span>
    destinationDirectory = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/dists</span><span class="delimiter">&quot;</span></span>)

    from appClasses
    with webAssetsSpec
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val webAssetsSpec: CopySpec = copySpec {
    from(&quot;src/main/webapp&quot;)
    include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
    rename(&quot;(.+)-staging(.+)&quot;, &quot;$1$2&quot;)
}

tasks.register&lt;Copy&gt;(&quot;copyAssets&quot;) {
    into(&quot;$buildDir/inPlaceApp&quot;)
    with(webAssetsSpec)
}

tasks.register&lt;Zip&gt;(&quot;distApp&quot;) {
    archiveFileName.set(&quot;my-app-dist.zip&quot;)
    destinationDirectory.set(file(&quot;$buildDir/dists&quot;))

    from(appClasses)
    with(webAssetsSpec)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>copyAssets</code> and <code>distApp</code> tasks will process the static resources under <code>src/main/webapp</code>, as specified by <code>webAssetsSpec</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The configuration defined by <code>webAssetsSpec</code> will <em>not</em> apply to the app classes included by the <code>distApp</code> task. That&#8217;s because <code>from appClasses</code> is its own child specification independent of <code>with webAssetsSpec</code>.</p>
</div>
<div class="paragraph">
<p>This can be confusing to understand, so it&#8217;s probably best to treat <code>with()</code> as an extra <code>from()</code> specification in the task. Hence it doesn&#8217;t make sense to define a standalone copy spec without at least one <code>from()</code> defined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you encounter a scenario in which you want to apply the same copy configuration to <em>different</em> sets of files, then you can share the configuration block directly without using <code>copySpec()</code>. Here&#8217;s an example that has two independent tasks that happen to want to process image files only:</p>
</div>
<div class="exampleblock">
<div class="title">Example 143. Sharing copy patterns only</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> webAssetPatterns = {
    include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
}

task copyAppAssets(<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/inPlaceApp</span><span class="delimiter">&quot;</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>, webAssetPatterns
}

task archiveDistAssets(<span class="key">type</span>: Zip) {
    archiveFileName = <span class="string"><span class="delimiter">'</span><span class="content">distribution-assets.zip</span><span class="delimiter">'</span></span>
    destinationDirectory = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/dists</span><span class="delimiter">&quot;</span></span>)

    from <span class="string"><span class="delimiter">'</span><span class="content">distResources</span><span class="delimiter">'</span></span>, webAssetPatterns
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val webAssetPatterns = Action&lt;CopySpec&gt; {
    include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
}

tasks.register&lt;Copy&gt;(&quot;copyAppAssets&quot;) {
    into(&quot;$buildDir/inPlaceApp&quot;)
    from(&quot;src/main/webapp&quot;, webAssetPatterns)
}

tasks.register&lt;Zip&gt;(&quot;archiveDistAssets&quot;) {
    archiveFileName.set(&quot;distribution-assets.zip&quot;)
    destinationDirectory.set(file(&quot;$buildDir/dists&quot;))

    from(&quot;distResources&quot;, webAssetPatterns)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, we assign the copy configuration to its own variable and apply it to whatever <code>from()</code> specification we want. This doesn&#8217;t just work for inclusions, but also exclusions, file renaming, and file content filtering.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:using_child_copy_specifications"><a class="anchor" href="#sub:using_child_copy_specifications"></a><a class="link" href="#sub:using_child_copy_specifications">Using child specifications</a></h6>
<div class="paragraph">
<p>If you only use a single copy spec, the file filtering and renaming will apply to <em>all</em> the files that are copied. Sometimes this is what you want, but not always. Consider the following example that copies files into a directory structure that can be used by a Java Servlet container to deliver a website:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/exploded-war-child-copy-spec-example.png" alt="exploded war child copy spec example">
</div>
<div class="title">Figure 11. Creating an exploded WAR for a Servlet container</div>
</div>
<div class="paragraph">
<p>This is not a straightforward copy as the <code>WEB-INF</code> directory and its subdirectories don&#8217;t exist within the project, so they must be created during the copy. In addition, we only want HTML and image files going directly into the root folder  <code>build/explodedWar</code>  and only JavaScript files going into the <code>js</code> directory. So we need separate filter patterns for those two sets of files.</p>
</div>
<div class="paragraph">
<p>The solution is to use <em>child specifications</em>, which can be applied to both <code>from()</code> and <code>into()</code> declarations. The following task definition does the necessary work:</p>
</div>
<div class="exampleblock">
<div class="title">Example 144. Nested copy specs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task nestedSpecs(<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>
    exclude <span class="string"><span class="delimiter">'</span><span class="content">**/*staging*</span><span class="delimiter">'</span></span>
    from(<span class="string"><span class="delimiter">'</span><span class="content">src/dist</span><span class="delimiter">'</span></span>) {
        include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.png</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.jpg</span><span class="delimiter">'</span></span>
    }
    from(sourceSets.main.output) {
        into <span class="string"><span class="delimiter">'</span><span class="content">WEB-INF/classes</span><span class="delimiter">'</span></span>
    }
    into(<span class="string"><span class="delimiter">'</span><span class="content">WEB-INF/lib</span><span class="delimiter">'</span></span>) {
        from configurations.runtimeClasspath
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Copy&gt;(&quot;nestedSpecs&quot;) {
    into(&quot;$buildDir/explodedWar&quot;)
    exclude(&quot;**/*staging*&quot;)
    from(&quot;src/dist&quot;) {
        include(&quot;**/*.html&quot;, &quot;**/*.png&quot;, &quot;**/*.jpg&quot;)
    }
    from(sourceSets.main.get().output) {
        into(&quot;WEB-INF/classes&quot;)
    }
    into(&quot;WEB-INF/lib&quot;) {
        from(configurations.runtimeClasspath)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice how the <code>src/dist</code> configuration has a nested inclusion specification: that&#8217;s the child copy spec. You can of course add content filtering and renaming here as required. A child copy spec is still a copy spec.</p>
</div>
<div class="paragraph">
<p>The above example also demonstrates how you can copy files into a subdirectory of the destination either by using a child <code>into()</code> on a <code>from()</code> or a child <code>from()</code> on an <code>into()</code>. Both approaches are acceptable, but you may want to create and follow a convention to ensure consistency across your build files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Don&#8217;t get your <code>into()</code> specifications mixed up! For a normal copy one to the filesystem rather than an archive  there should always be <em>one</em> "root" <code>into()</code> that simply specifies the overall destination directory of the copy. Any other <code>into()</code> should have a child spec attached and its path will be relative to the root <code>into()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One final thing to be aware of is that a child copy spec inherits its destination path, include patterns, exclude patterns, copy actions, name mappings and filters from its parent. So be careful where you place your configuration.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:project_copy_method"><a class="anchor" href="#sec:project_copy_method"></a><a class="link" href="#sec:project_copy_method">Copying files in your own tasks</a></h5>
<div class="paragraph">
<p>There might be occasions when you want to copy files or directories as <em>part</em> of a task. For example, a custom archiving task based on an unsupported archive format might want to copy files to a temporary directory before they are then archived. You still want to take advantage of Gradle&#8217;s copy API, but without introducing an extra <code>Copy</code> task.</p>
</div>
<div class="paragraph">
<p>The solution is to use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">Project.copy(org.gradle.api.Action)</a> method. It works the same way as the <code>Copy</code> task by configuring it with a copy spec. Here&#8217;s a trivial example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 145. Copying files using the copy() method without up-to-date check</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyMethod {
    doLast {
        copy {
            from <span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>
            into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedWar</span><span class="delimiter">&quot;</span></span>
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.html</span><span class="delimiter">'</span></span>
            include <span class="string"><span class="delimiter">'</span><span class="content">**/*.jsp</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;copyMethod&quot;) {
    doLast {
        copy {
            from(&quot;src/main/webapp&quot;)
            into(&quot;$buildDir/explodedWar&quot;)
            include(&quot;**/*.html&quot;)
            include(&quot;**/*.jsp&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates the basic syntax and also highlights two major limitations of using the <code>copy()</code> method:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>copy()</code> method is not <a href="#sec:up_to_date_checks">incremental</a>. The example&#8217;s <code>copyMethod</code> task will <em>always</em> execute because it has no information about what files make up the task&#8217;s inputs. You have to manually define the task inputs and outputs.</p>
</li>
<li>
<p>Using a task as a copy source, i.e. as an argument to <code>from()</code>, won&#8217;t set up an automatic task dependency between your task and that copy source. As such, if you are using the <code>copy()</code> method as part of a task action, you must explicitly declare all inputs and outputs in order to get the correct behavior.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows you how to workaround these limitations by using the <a href="#sec:task_input_output_runtime_api">dynamic API for task inputs and outputs</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 146. Copying files using the copy() method with up-to-date check</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task copyMethodWithExplicitDependencies {
    <span class="comment">// up-to-date check for inputs, plus add copyTask as dependency</span>
    inputs.files(copyTask)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">inputs</span><span class="delimiter">&quot;</span></span>)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    outputs.dir(<span class="string"><span class="delimiter">'</span><span class="content">some-dir</span><span class="delimiter">'</span></span>) <span class="comment">// up-to-date check for outputs</span>
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputDir</span><span class="delimiter">&quot;</span></span>)
    doLast{
        copy {
            <span class="comment">// Copy the output of copyTask</span>
            from copyTask
            into <span class="string"><span class="delimiter">'</span><span class="content">some-dir</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;copyMethodWithExplicitDependencies&quot;) {
    // up-to-date check for inputs, plus add copyTask as dependency
    inputs.files(copyTask)
        .withPropertyName(&quot;inputs&quot;)
        .withPathSensitivity(PathSensitivity.RELATIVE)
    outputs.dir(&quot;some-dir&quot;) // up-to-date check for outputs
        .withPropertyName(&quot;outputDir&quot;)
    doLast {
        copy {
            // Copy the output of copyTask
            from(copyTask)
            into(&quot;some-dir&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These limitations make it preferable to use the <code>Copy</code> task wherever possible, because of its builtin support for incremental building and task dependency inference. That is why the <code>copy()</code> method is intended for use by <a href="#custom_tasks">custom tasks</a> that need to copy files as part of their function. Custom tasks that use the <code>copy()</code> method should declare the necessary inputs and outputs relevant to the copy action.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:sync_task"><a class="anchor" href="#sec:sync_task"></a><a class="link" href="#sec:sync_task">Mirroring directories and file collections with the <code>Sync</code> task</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Sync.html">Sync</a> task, which extends the <code>Copy</code> task, copies the source files into the destination directory and then removes any files from the destination directory which it did not copy. In other words, it synchronizes the contents of a directory with its source. This can be useful for doing things such as installing your application, creating an exploded copy of your archives, or maintaining a copy of the project&#8217;s dependencies.</p>
</div>
<div class="paragraph">
<p>Here is an example which maintains a copy of the project&#8217;s runtime dependencies in the <code>build/libs</code> directory.</p>
</div>
<div class="exampleblock">
<div class="title">Example 147. Using the Sync task to copy dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task libs(<span class="key">type</span>: Sync) {
    from configurations.runtime
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/libs</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Sync&gt;(&quot;libs&quot;) {
    from(configurations[&quot;runtime&quot;])
    into(&quot;$buildDir/libs&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also perform the same function in your own tasks with the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:sync(org.gradle.api.Action)">Project.sync(org.gradle.api.Action)</a> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:archives"><a class="anchor" href="#sec:archives"></a><a class="link" href="#sec:archives">Archive creation in depth</a></h4>
<div class="paragraph">
<p>Archives are essentially self-contained file systems and Gradle treats them as such. This is why working with archives is very similar to working with files and directories, including such things as file permissions.</p>
</div>
<div class="paragraph">
<p>Out of the box, Gradle supports creation of both ZIP and TAR archives, and by extension Java&#8217;s JAR, WAR and EAR formats Java&#8217;s archive formats are all ZIPs. Each of these formats has a corresponding task type to create them: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.War.html">War</a>, and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a>. These all work the same way and are based on copy specifications, just like the <code>Copy</code> task.</p>
</div>
<div class="paragraph">
<p>Creating an archive file is essentially a file copy in which the destination is implicit, i.e. the archive file itself. Here&#8217;s a basic example that specifies the path and name of the target archive file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 148. Archiving a directory as a ZIP</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task packageDistribution(<span class="key">type</span>: Zip) {
    archiveFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-distribution.zip</span><span class="delimiter">&quot;</span></span>
    destinationDirectory = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/dist</span><span class="delimiter">&quot;</span></span>)

    from <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/toArchive</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;packageDistribution&quot;) {
    archiveFileName.set(&quot;my-distribution.zip&quot;)
    destinationDirectory.set(file(&quot;$buildDir/dist&quot;))

    from(&quot;$buildDir/toArchive&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the next section you&#8217;ll learn about convention-based archive names, which can save you from always configuring the destination directory and archive name.</p>
</div>
<div class="paragraph">
<p>The full power of copy specifications are available to you when creating archives, which means you can do content filtering, file renaming or anything else that is covered in the previous section. A particularly common requirement is copying files into subdirectories of the archive that don&#8217;t exist in the source folders, something that can be achieved with <code>into()</code> <a href="#sub:using_child_copy_specifications">child specifications</a>.</p>
</div>
<div class="paragraph">
<p>Gradle does of course allow you create as many archive tasks as you want, but it&#8217;s worth bearing in mind that many convention-based plugins provide their own. For example, the Java plugin adds a <code>jar</code> task for packaging a project&#8217;s compiled classes and resources in a JAR. Many of these plugins provide sensible conventions for the names of archives as well as the copy specifications used. We recommend you use these tasks wherever you can, rather than overriding them with your own.</p>
</div>
<div class="sect4">
<h5 id="sec:archive_naming"><a class="anchor" href="#sec:archive_naming"></a><a class="link" href="#sec:archive_naming">Archive naming</a></h5>
<div class="paragraph">
<p>Gradle has several conventions around the naming of archives and where they are created based on the plugins your project uses. The main convention is provided by the <a href="#base_plugin">Base Plugin</a>, which defaults to creating archives in the <code>$buildDir/distributions</code> directory and typically uses archive names of the form <em>[projectName]-[version].[type]</em>.</p>
</div>
<div class="paragraph">
<p>The following example comes from a project named <code>zipProject</code>, hence the <code>myZip</code> task creates an archive named <code>zipProject-1.0.zip</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 149. Creation of ZIP archive</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="float">1.0</span>

task myZip(<span class="key">type</span>: Zip) {
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>

    doLast {
        println archiveFileName.get()
        println relativePath(destinationDirectory)
        println relativePath(archiveFile)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0&quot;

tasks.register&lt;Zip&gt;(&quot;myZip&quot;) {
    from(&quot;somedir&quot;)

    doLast {
        println(archiveFileName.get())
        println(relativePath(destinationDirectory))
        println(relativePath(archiveFile))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q myZip</code></strong></div>
<div class="content">
<pre>&gt; gradle -q myZip
zipProject-1.0.zip
build/distributions
build/distributions/zipProject-1.0.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the name of the archive does <em>not</em> derive from the name of the task that creates it.</p>
</div>
<div class="paragraph">
<p>If you want to change the name and location of a generated archive file, you can provide values for the <code>archiveFileName</code> and <code>destinationDirectory</code> properties of the corresponding task.
These override any conventions that would otherwise apply.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can make use of the default archive name pattern provided by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html#org.gradle.api.tasks.bundling.AbstractArchiveTask:archiveFileName">AbstractArchiveTask.getArchiveFileName()</a>: <em>[archiveBaseName]-[archiveAppendix]-[archiveVersion]-[archiveClassifier].[archiveExtension]</em>.
You can set each of these properties on the task separately if you wish.
Note that the Base Plugin uses the convention of project name for <em>archiveBaseName</em>, project version for <em>archiveVersion</em> and the archive type for <em>archiveExtension</em>.
It does not provide values for the other properties.</p>
</div>
<div class="paragraph">
<p>This example  from the same project as the one above  configures just the <code>archiveBaseName</code> property, overriding the default value of the project name:</p>
</div>
<div class="exampleblock">
<div class="title">Example 150. Configuration of archive task - custom archive name</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task myCustomZip(<span class="key">type</span>: Zip) {
    archiveBaseName = <span class="string"><span class="delimiter">'</span><span class="content">customName</span><span class="delimiter">'</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>

    doLast {
        println archiveFileName.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;myCustomZip&quot;) {
    archiveBaseName.set(&quot;customName&quot;)
    from(&quot;somedir&quot;)

    doLast {
        println(archiveFileName.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q myCustomZip</code></strong></div>
<div class="content">
<pre>&gt; gradle -q myCustomZip
customName-1.0.zip</pre>
</div>
</div>
<div class="paragraph">
<p>You can also override the default <code>archiveBaseName</code> value for <em>all</em> the archive tasks in your build by using the <em>project</em> property <code>archivesBaseName</code>, as demonstrated by the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 151. Configuration of archive task - appendix &amp; classifier</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

version = <span class="float">1.0</span>
archivesBaseName = <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle</span><span class="delimiter">&quot;</span></span>

task myZip(<span class="key">type</span>: Zip) {
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>
}

task myOtherZip(<span class="key">type</span>: Zip) {
    archiveAppendix = <span class="string"><span class="delimiter">'</span><span class="content">wrapper</span><span class="delimiter">'</span></span>
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">somedir</span><span class="delimiter">'</span></span>
}

task echoNames {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Project name: </span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        println myZip.archiveFileName.get()
        println myOtherZip.archiveFileName.get()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}

version = &quot;1.0&quot;
base.archivesBaseName = &quot;gradle&quot;

val myZip by tasks.registering(Zip::class) {
    from(&quot;somedir&quot;)
}

val myOtherZip by tasks.registering(Zip::class) {
    archiveAppendix.set(&quot;wrapper&quot;)
    archiveClassifier.set(&quot;src&quot;)
    from(&quot;somedir&quot;)
}

tasks.register(&quot;echoNames&quot;) {
    doLast {
        println(&quot;Project name: ${project.name}&quot;)
        println(myZip.get().archiveFileName.get())
        println(myOtherZip.get().archiveFileName.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q echoNames</code></strong></div>
<div class="content">
<pre>&gt; gradle -q echoNames
Project name: zipProject
gradle-1.0.zip
gradle-wrapper-1.0-src.zip</pre>
</div>
</div>
<div class="paragraph">
<p>You can find all the possible archive task properties in the API documentation for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a>, but we have also summarized the main ones here:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>archiveFileName</code>  <code>Property&lt;String&gt;</code>, default: <code><em>archiveBaseName</em>-<em>archiveAppendix</em>-<em>archiveVersion</em>-<em>archiveClassifier</em>.<em>archiveExtension</em></code></dt>
<dd>
<p>The complete file name of the generated archive. If any of the properties in the default value are empty, their '-' separator is dropped.</p>
</dd>
<dt class="hdlist1"><code>archiveFile</code>  <code>Provider&lt;RegularFile&gt;</code>, <em>read-only</em>, default: <code><em>destinationDirectory</em>/<em>archiveFileName</em></code></dt>
<dd>
<p>The absolute file path of the generated archive.</p>
</dd>
<dt class="hdlist1"><code>destinationDirectory</code>  <code>DirectoryProperty</code>, default: depends on archive type</dt>
<dd>
<p>The target directory in which to put the generated archive. By default, JARs and WARs go into <code>$buildDir/libs</code>. ZIPs and TARs go into <code>$buildDir/distributions</code>.</p>
</dd>
<dt class="hdlist1"><code>archiveBaseName</code>  <code>Property&lt;String&gt;</code>, default: <code><em>project.name</em></code></dt>
<dd>
<p>The base name portion of the archive file name, typically a project name or some other descriptive name for what it contains.</p>
</dd>
<dt class="hdlist1"><code>archiveAppendix</code>  <code>Property&lt;String&gt;</code>, default: <code>null</code></dt>
<dd>
<p>The appendix portion of the archive file name that comes immediately after the base name. It is typically used to distinguish between different forms of content, such as code and docs, or a minimal distribution versus a full or complete one.</p>
</dd>
<dt class="hdlist1"><code>archiveVersion</code>  <code>Property&lt;String&gt;</code>, default: <code><em>project.version</em></code></dt>
<dd>
<p>The version portion of the archive file name, typically in the form of a normal project or product version.</p>
</dd>
<dt class="hdlist1"><code>archiveClassifier</code>  <code>Property&lt;String&gt;</code>, default: <code>null</code></dt>
<dd>
<p>The classifier portion of the archive file name. Often used to distinguish between archives that target different platforms.</p>
</dd>
<dt class="hdlist1"><code>archiveExtension</code>  <code>Property&lt;String&gt;</code>, default: depends on archive type and compression type</dt>
<dd>
<p>The filename extension for the archive. By default, this is set based on the archive task type and the compression type (if you&#8217;re creating a TAR). Will be one of: <code>zip</code>, <code>jar</code>, <code>war</code>, <code>tar</code>, <code>tgz</code> or <code>tbz2</code>. You can of course set this to a custom extension if you wish.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:sharing_content_between_multiple_archives"><a class="anchor" href="#sec:sharing_content_between_multiple_archives"></a><a class="link" href="#sec:sharing_content_between_multiple_archives">Sharing content between multiple archives</a></h5>
<div class="paragraph">
<p><a href="#sub:sharing_copy_specs">As described earlier</a>, you can use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copySpec(org.gradle.api.Action)">Project.copySpec(org.gradle.api.Action)</a> method to share content between archives.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:reproducible_archives"><a class="anchor" href="#sec:reproducible_archives"></a><a class="link" href="#sec:reproducible_archives">Reproducible builds</a></h5>
<div class="paragraph">
<p>Sometimes it&#8217;s desirable to recreate archives exactly the same, byte for byte, on different machines. You want to be sure that building an artifact from source code produces the same result no matter when and where it is built. This is necessary for projects like <a href="https://reproducible-builds.org/">reproducible-builds.org</a>.</p>
</div>
<div class="paragraph">
<p>Reproducing the same byte-for-byte archive poses some challenges since the order of the files in an archive is influenced by the underlying file system. Each time a ZIP, TAR, JAR, WAR or EAR is built from source, the order of the files inside the archive may change. Files that only have a different timestamp also causes differences in archives from build to build. All <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a> (e.g. Jar, Zip) tasks shipped with Gradle include support for producing reproducible archives.</p>
</div>
<div class="paragraph">
<p>For example, to make a <code>Zip</code> task reproducible you need to set <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html#org.gradle.api.tasks.bundling.Zip:reproducibleFileOrder">Zip.isReproducibleFileOrder()</a> to <code>true</code> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html#org.gradle.api.tasks.bundling.Zip:preserveFileTimestamps">Zip.isPreserveFileTimestamps()</a> to <code>false</code>. In order to make all archive tasks in your build reproducible, consider adding the following configuration to your build file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 152. Activating reproducible archives</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(AbstractArchiveTask) {
    preserveFileTimestamps = <span class="predefined-constant">false</span>
    reproducibleFileOrder = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;AbstractArchiveTask&gt;().configureEach {
    isPreserveFileTimestamps = false
    isReproducibleFileOrder = true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Often you will want to publish an archive, so that it is usable from another project. This process is described in <a href="artifact_management.html#artifact_management">Legacy Publishing</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plugins"><a class="anchor" href="#plugins"></a><a class="link" href="#plugins">Using Gradle Plugins</a></h3>
<div class="paragraph">
<p>Gradle at its core intentionally provides very little for real world automation. All of the useful features, like the ability to compile Java code, are added by <em>plugins</em>. Plugins add new tasks (e.g. <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>), domain objects (e.g. <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSet.html">SourceSet</a>), conventions (e.g. Java source is located at <code>src/main/java</code>) as well as extending core objects and objects from other plugins.</p>
</div>
<div class="paragraph">
<p>In this chapter we discuss how to use plugins and the terminology and concepts surrounding plugins.</p>
</div>
<div class="sect3">
<h4 id="sec:what_plugins_do"><a class="anchor" href="#sec:what_plugins_do"></a><a class="link" href="#sec:what_plugins_do">What plugins do</a></h4>
<div class="paragraph">
<p>Applying a plugin to a project allows the plugin to extend the project&#8217;s capabilities. It can do things such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extend the Gradle model (e.g. add new DSL elements that can be configured)</p>
</li>
<li>
<p>Configure the project according to conventions (e.g. add new tasks or configure sensible defaults)</p>
</li>
<li>
<p>Apply specific configuration (e.g. add organizational repositories or enforce standards)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By applying plugins, rather than adding logic to the project build script, we can reap a number of benefits. Applying plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Promotes reuse and reduces the overhead of maintaining similar logic across multiple projects</p>
</li>
<li>
<p>Allows a higher degree of modularization, enhancing comprehensibility and organization</p>
</li>
<li>
<p>Encapsulates imperative logic and allows build scripts to be as declarative as possible</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:types_of_plugins"><a class="anchor" href="#sec:types_of_plugins"></a><a class="link" href="#sec:types_of_plugins">Types of plugins</a></h4>
<div class="paragraph">
<p>There are two general types of plugins in Gradle, <em>binary</em> plugins and <em>script</em> plugins.
Binary plugins are written either programmatically by implementing <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> interface or declaratively using one of Gradle&#8217;s DSL languages.
Binary plugins can reside within a build script, within the project hierarchy or externally in a plugin jar.
Script plugins are additional build scripts that further configure the build and usually implement a declarative approach to manipulating the build.
They are typically used within a build although they can be externalized and accessed from a remote location.</p>
</div>
<div class="paragraph">
<p>A plugin often starts out as a script plugin (because they are easy to write) and then, as the code becomes more valuable, it&#8217;s migrated to a binary plugin that can be easily tested and shared between multiple projects or organizations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_plugins"><a class="anchor" href="#sec:using_plugins"></a><a class="link" href="#sec:using_plugins">Using plugins</a></h4>
<div class="paragraph">
<p>To use the build logic encapsulated in a plugin, Gradle needs to perform two steps. First, it needs to <em>resolve</em> the plugin, and then it needs to <em>apply</em> the plugin to the target, usually a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a>.</p>
</div>
<div class="paragraph">
<p><em>Resolving</em> a plugin means finding the correct version of the jar which contains a given plugin and adding it the script classpath. Once a plugin is resolved, its API can be used in a build script. Script plugins are self-resolving in that they are resolved from the specific file path or URL provided when applying them. Core binary plugins provided as part of the Gradle distribution are automatically resolved.</p>
</div>
<div class="paragraph">
<p><em>Applying</em> a plugin means actually executing the plugin&#8217;s <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply(T)</a> on the Project you want to enhance with the plugin. Applying plugins is <em>idempotent</em>. That is, you can safely apply any plugin multiple times without side effects.</p>
</div>
<div class="paragraph">
<p>The most common use case for using a plugin is to both resolve the plugin and apply it to the current project. Since this is such a common use case, it&#8217;s recommended that build authors use the <a href="#sec:plugins_block">plugins DSL</a> to both resolve and apply plugins in one step.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:binary_plugins"><a class="anchor" href="#sec:binary_plugins"></a><a class="link" href="#sec:binary_plugins">Binary plugins</a></h4>
<div class="paragraph">
<p>You apply plugins by their <em>plugin id</em>, which is a globally unique identifier, or name, for plugins. Core Gradle plugins are special in that they provide short names, such as <code>'java'</code> for the core <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>. All other binary plugins must use the fully qualified form of the plugin id (e.g. <code>com.github.foo.bar</code>), although some legacy plugins may still utilize a short, unqualified form. Where you put the plugin id depends on whether you are using the <a href="#sec:plugins_block">plugins DSL</a> or the <a href="#sec:old_plugin_application">buildscript block.</a></p>
</div>
<div class="sect4">
<h5 id="sec:binary_plugin_locations"><a class="anchor" href="#sec:binary_plugin_locations"></a><a class="link" href="#sec:binary_plugin_locations">Locations of binary plugins</a></h5>
<div class="paragraph">
<p>A plugin is simply any class that implements the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> interface. Gradle provides the core plugins (e.g. <code>JavaPlugin</code>) as part of its distribution which means they are automatically resolved. However, non-core binary plugins need to be resolved before they can be applied. This can be achieved in a number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Including the plugin from the plugin portal or a <a href="#sec:custom_plugin_repositories">custom repository</a> using the plugins DSL (see <a href="#sec:plugins_block">Applying plugins using the plugins DSL</a>).</p>
</li>
<li>
<p>Including the plugin from an external jar defined as a buildscript dependency (see <a href="#sec:applying_plugins_buildscript">Applying plugins using the buildscript block</a>).</p>
</li>
<li>
<p>Defining the plugin as a source file under the buildSrc directory in the project (see <a href="#sec:build_sources">Using buildSrc to extract functional logic</a>).</p>
</li>
<li>
<p>Defining the plugin as an inline class declaration inside a build script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more on defining your own plugins, see <a href="#custom_plugins">Custom Plugins</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugins_block"><a class="anchor" href="#sec:plugins_block"></a><a class="link" href="#sec:plugins_block">Applying plugins with the plugins DSL</a></h5>
<div class="paragraph">
<p>The plugins DSL provides a succinct and convenient way to declare plugin dependencies. It works with the <a href="http://plugins.gradle.org">Gradle plugin portal</a> to provide easy access to both core and community plugins. The plugins DSL block configures an instance of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html">PluginDependenciesSpec</a>.</p>
</div>
<div class="paragraph">
<p>To apply a core plugin, the short name can be used:</p>
</div>
<div class="exampleblock">
<div class="title">Example 153. Applying a core plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To apply a community plugin from the portal, the fully qualified plugin id must be used:</p>
</div>
<div class="exampleblock">
<div class="title">Example 154. Applying a community plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">0.4.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.jfrog.bintray&quot;) version &quot;0.4.1&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/use/PluginDependenciesSpec.html">PluginDependenciesSpec</a> for more information on using the Plugin DSL.</p>
</div>
<div class="sect5">
<h6 id="plugins_dsl_limitations"><a class="anchor" href="#plugins_dsl_limitations"></a><a class="link" href="#plugins_dsl_limitations">Limitations of the plugins DSL</a></h6>
<div class="paragraph">
<p>This way of adding plugins to a project is much more than a more convenient syntax. The plugins DSL is processed in a way which allows Gradle to determine the plugins in use very early and very quickly. This allows Gradle to do smart things such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Optimize the loading and reuse of plugin classes.</p>
</li>
<li>
<p>Allow different plugins to use different versions of dependencies.</p>
</li>
<li>
<p>Provide editors detailed information about the potential properties and values in the buildscript for editing assistance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requires that plugins be specified in a way that Gradle can easily and quickly extract, before executing the rest of the build script. It also requires that the definition of plugins to use be somewhat static.</p>
</div>
<div class="paragraph">
<p>There are some key differences between the <code>plugins {}</code> block mechanism and the traditional <code>apply()</code> method mechanism. There are also some constraints, some of which are temporary limitations while the mechanism is still being developed and some are inherent to the new approach.</p>
</div>
<div class="sect6">
<h7 id="sec:constrained_syntax"><a class="anchor" href="#sec:constrained_syntax"></a><a class="link" href="#sec:constrained_syntax">Constrained Syntax</a></h7>
<div class="paragraph">
<p>The <code>plugins {}</code> block does not support arbitrary code. It is constrained, in order to be idempotent (produce the same result every time) and side effect free (safe for Gradle to execute at any time).</p>
</div>
<div class="paragraph">
<p>The form is:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="error"></span>plugin id<span class="error"></span>                                            // <b class="conum">(1)</b>
    id <span class="error"></span>plugin id<span class="error"></span> version <span class="error"></span>plugin version<span class="error"></span> [apply <span class="error"></span><span class="predefined-constant">false</span><span class="error"></span>]   // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>for core Gradle plugins or plugins already available to the build script</p>
</li>
<li>
<p>for binary Gradle plugins that need to be resolved</p>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `plugin id`                                             // <b class="conum">(1)</b>
    id(plugin id)                                           // <b class="conum">(2)</b>
    id(plugin id) version plugin version [apply false]  // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>for core Gradle plugins</p>
</li>
<li>
<p>for core Gradle plugins or plugins already available to the build script</p>
</li>
<li>
<p>for binary Gradle plugins that need to be resolved</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Where <code>plugin id</code> and <code>plugin version</code> must be constant, literal, strings and the <code>apply</code> statement with a <code>boolean</code> can be used to disable the default behavior of applying the plugin immediately (e.g. you want to apply it only in <code>subprojects</code>). No other statements are allowed; their presence will cause a compilation error.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Where <code>plugin id</code>, in case <code>#1</code> is a static Kotlin extension property, named after the core plugin ID ; and in cases <code>#2</code> and <code>#3</code> is a string.
<code>plugin version</code> is also a string.
The <code>apply</code> statement with a <code>boolean</code> can be used to disable the default behavior of applying the plugin immediately (e.g. you want to apply it only in <code>subprojects</code>).</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:plugin_version_management">plugin version management</a> if you want to use a variable to define a plugin version.</p>
</div>
<div class="paragraph">
<p>The <code>plugins {}</code> block must also be a top level statement in the buildscript. It cannot be nested inside another construct (e.g. an if-statement or for-loop).</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:build_scripts_only"><a class="anchor" href="#sec:build_scripts_only"></a><a class="link" href="#sec:build_scripts_only">Can only be used in build scripts and settings file</a></h7>
<div class="paragraph">
<p>The <code>plugins {}</code> block can currently only be used in a project&#8217;s build script and the settings.gradle file. It cannot be used in script plugins or init scripts.</p>
</div>
<div class="paragraph">
<p><em>Future versions of Gradle will remove this restriction.</em></p>
</div>
<div class="paragraph">
<p>If the restrictions of the <code>plugins {}</code> block are prohibitive, the recommended approach is to apply plugins using the <a href="#sec:applying_plugins_buildscript">buildscript {} block</a>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:subprojects_plugins_dsl"><a class="anchor" href="#sec:subprojects_plugins_dsl"></a><a class="link" href="#sec:subprojects_plugins_dsl">Applying plugins to subprojects</a></h6>
<div class="paragraph">
<p>If you have a <a href="#multi_project_builds">multi-project build</a>, you probably want to apply plugins to some or all of the subprojects in your build, but not to the <code>root</code> or <code>master</code> project. The default behavior of the <code>plugins {}</code> block is to immediately <code>resolve</code> <em>and</em>  <code>apply</code> the plugins. But, you can use the <code>apply false</code> syntax to tell Gradle not to apply the plugin to the current project and then use <code>apply plugin: plugin id</code> in the <code>subprojects</code> block or use the <code>plugins {}</code> block in sub projects build scripts:</p>
</div>
<div class="exampleblock">
<div class="title">Example 155. Applying plugins only on certain subprojects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">helloA</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">helloB</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">goodbyeC</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span> apply <span class="predefined-constant">false</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span> apply <span class="predefined-constant">false</span>
}

subprojects {
    <span class="keyword">if</span> (name.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>)) {
        apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">goodbyeC/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;helloA&quot;)
include(&quot;helloB&quot;)
include(&quot;goodbyeC&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.hello&quot;) version &quot;1.0.0&quot; apply false
    id(&quot;com.example.goodbye&quot;) version &quot;1.0.0&quot; apply false
}

subprojects {
    if (name.startsWith(&quot;hello&quot;)) {
        apply(plugin = &quot;com.example.hello&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">goodbyeC/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.example.goodbye&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you then run <code>gradle hello</code> you&#8217;ll see that only the helloA and helloB subprojects had the hello plugin applied.</p>
</div>
<div class="exampleblock">
<div class="title">Example 156. Output of <code>gradle hello</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; gradle hello
:helloA:hello
:helloB:hello
Hello!
Hello!

BUILD SUCCEEDED</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:buildsrc_plugins_dsl"><a class="anchor" href="#sec:buildsrc_plugins_dsl"></a><a class="link" href="#sec:buildsrc_plugins_dsl">Applying plugins from the <em>buildSrc</em> directory</a></h6>
<div class="paragraph">
<p>You can apply plugins that reside in a project&#8217;s <em>buildSrc</em> directory as long as they have a defined ID. The following example shows how to tie a plugin implementation class  <code>my.MyPlugin</code>  defined in <em>buildSrc</em> to the ID "my-plugin":</p>
</div>
<div class="exampleblock">
<div class="title">Example 157. Defining a buildSrc plugin with an ID</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        myPlugins {
            id = <span class="string"><span class="delimiter">'</span><span class="content">my-plugin</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">my.MyPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}

gradlePlugin {
    plugins {
        create(&quot;myPlugins&quot;) {
            id = &quot;my-plugin&quot;
            implementationClass = &quot;my.MyPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin can then be applied by ID as normal:</p>
</div>
<div class="exampleblock">
<div class="title">Example 158. Applying a plugin from buildSrc</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">my-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;my-plugin&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:plugin_management"><a class="anchor" href="#sec:plugin_management"></a><a class="link" href="#sec:plugin_management">Plugin Management</a></h6>
<div class="paragraph">
<p>The <code>pluginManagement {}</code> block may only appear in either the <code>settings.gradle</code> file, where it must be the first block in the file, or in an <a href="#init_scripts">Initialization Script</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 159. Configuring pluginManagement per-project and globally</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    plugins {
    }
    resolutionStrategy {
    }
    repositories {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">settingsEvaluated { settings -&gt;
    settings.pluginManagement {
        plugins {
        }
        resolutionStrategy {
        }
        repositories {
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    plugins {
    }
    resolutionStrategy {
    }
    repositories {
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">settingsEvaluated {
    pluginManagement {
        plugins {
        }
        resolutionStrategy {
        }
        repositories {
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="sec:custom_plugin_repositories"><a class="anchor" href="#sec:custom_plugin_repositories"></a><a class="link" href="#sec:custom_plugin_repositories">Custom Plugin Repositories</a></h7>
<div class="paragraph">
<p>By default, the <code>plugins {}</code> DSL resolves plugins from the public <a href="https://plugins.gradle.org">Gradle Plugin Portal.</a> Many build authors would also like to resolve plugins from private Maven or Ivy repositories because the plugins contain proprietary implementation details, or just to have more control over what plugins are available to their builds.</p>
</div>
<div class="paragraph">
<p>To specify custom plugin repositories, use the <code>repositories {}</code> block inside <code>pluginManagement {}</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 160. Example: Using plugins from custom plugin repositories.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">../maven-repo</span><span class="delimiter">'</span></span>
        }
        gradlePluginPortal()
        ivy {
            url <span class="string"><span class="delimiter">'</span><span class="content">../ivy-repo</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        maven(url = &quot;../maven-repo&quot;)
        gradlePluginPortal()
        ivy(url = &quot;../ivy-repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Gradle to first look in the Maven repository at <code>../maven-repo</code> when resolving plugins and then to check the Gradle Plugin Portal if the plugins are not found in the Maven repository. If you don&#8217;t want the Gradle Plugin Portal to be searched, omit the <code>gradlePluginPortal()</code> line. Finally, the Ivy repository at <code>../ivy-repo</code> will be checked.</p>
</div>
</div>
<div class="sect6">
<h7 id="sec:plugin_version_management"><a class="anchor" href="#sec:plugin_version_management"></a><a class="link" href="#sec:plugin_version_management">Plugin Version Management</a></h7>
<div class="paragraph">
<p>A <code>plugins {}</code> block inside <code>pluginManagement {}</code> allows all plugin versions for the build to be defined in a single location. Plugins can then be applied by id to any build script via the <code>plugins {}</code> block.</p>
</div>
<div class="paragraph">
<p>One benefit of setting plugin versions this way is that the <code>pluginManagement.plugins {}</code> does not have the same <a href="#sec:constrained_syntax">constrained syntax</a> as the build script <code>plugins {}</code> block. This allows plugin versions to be taken from <code>gradle.properties</code>, or loaded via another mechanism.</p>
</div>
<div class="exampleblock">
<div class="title">Example 161. Example: Managing plugin versions via <code>pluginManagement</code>.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
  plugins {
        id <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>helloPluginVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">helloPluginVersion=1.0.0</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
  val helloPluginVersion: String by settings
  plugins {
    id(&quot;com.example.hello&quot;) version &quot;${helloPluginVersion}&quot;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin"></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">helloPluginVersion=1.0.0</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin version is loaded from <code>gradle.properties</code> and configured in the settings script, allowing the plugin to be added to any project without specifying the version.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:plugin_resolution_rules"><a class="anchor" href="#sec:plugin_resolution_rules"></a><a class="link" href="#sec:plugin_resolution_rules">Plugin Resolution Rules</a></h6>
<div class="paragraph">
<p>Plugin resolution rules allow you to modify plugin requests made in <code>plugins {}</code> blocks, e.g. changing the requested version or explicitly specifying the implementation artifact coordinates.</p>
</div>
<div class="paragraph">
<p>To add resolution rules, use the <code>resolutionStrategy {}</code> inside the <code>pluginManagement {}</code> block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 162. Plugin resolution strategy.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    resolutionStrategy {
        eachPlugin {
            <span class="keyword">if</span> (requested.id.namespace == <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>) {
                useModule(<span class="string"><span class="delimiter">'</span><span class="content">com.example:sample-plugins:1.0.0</span><span class="delimiter">'</span></span>)
            }
        }
    }
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">../maven-repo</span><span class="delimiter">'</span></span>
        }
        gradlePluginPortal()
        ivy {
            url <span class="string"><span class="delimiter">'</span><span class="content">../ivy-repo</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    resolutionStrategy {
        eachPlugin {
            if (requested.id.namespace == &quot;com.example&quot;) {
                useModule(&quot;com.example:sample-plugins:1.0.0&quot;)
            }
        }
    }
    repositories {
        maven {
            url = uri(&quot;../maven-repo&quot;)
        }
        gradlePluginPortal()
        ivy {
            url = uri(&quot;../ivy-repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Gradle to use the specified plugin implementation artifact instead of using its built-in default mapping from plugin ID to Maven/Ivy coordinates.</p>
</div>
<div class="paragraph">
<p>Custom Maven and Ivy plugin repositories must contain <a href="#sec:plugin_markers">plugin marker artifacts</a> in addition to the artifacts which actually implement the plugin. For more information on publishing plugins to custom repositories read <a href="#java_gradle_plugin">Gradle Plugin Development Plugin</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/management/PluginManagementSpec.html">PluginManagementSpec</a> for complete documentation for using the <code>pluginManagement {}</code> block.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugin_markers"><a class="anchor" href="#sec:plugin_markers"></a><a class="link" href="#sec:plugin_markers">Plugin Marker Artifacts</a></h5>
<div class="paragraph">
<p>Since the <code>plugins {}</code> DSL block only allows for declaring plugins by their globally unique plugin <code>id</code> and <code>version</code> properties, Gradle needs a way to look up the coordinates of the plugin implementation artifact. To do so, Gradle will look for a Plugin Marker Artifact with the coordinates <code>plugin.id:plugin.id.gradle.plugin:plugin.version</code>. This marker needs to have a dependency on the actual plugin implementation. Publishing these markers is automated by the <a href="#java_gradle_plugin">java-gradle-plugin</a>.</p>
</div>
<div class="paragraph">
<p>For example, the following complete sample from the <code>sample-plugins</code> project shows how to publish a <code>com.example.hello</code> plugin and a <code>com.example.goodbye</code> plugin to both an Ivy and Maven repository using the combination of the <a href="#java_gradle_plugin">java-gradle-plugin</a>, the <a href="#publishing_maven">maven-publish</a> plugin, and the <a href="#publishing_ivy">ivy-publish</a> plugin.</p>
</div>
<div class="exampleblock">
<div class="title">Example 163. Complete Plugin Publishing Sample</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}

group <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

gradlePlugin {
    plugins {
        hello {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.hello.HelloPlugin</span><span class="delimiter">'</span></span>
        }
        goodbye {
            id = <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">com.example.goodbye.GoodbyePlugin</span><span class="delimiter">'</span></span>
        }
    }
}

publishing {
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">../../consuming/maven-repo</span><span class="delimiter">'</span></span>
        }
        ivy {
            url <span class="string"><span class="delimiter">'</span><span class="content">../../consuming/ivy-repo</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
    `maven-publish`
    `ivy-publish`
}

group = &quot;com.example&quot;
version = &quot;1.0.0&quot;

gradlePlugin {
    plugins {
        create(&quot;hello&quot;) {
            id = &quot;com.example.hello&quot;
            implementationClass = &quot;com.example.hello.HelloPlugin&quot;
        }
        create(&quot;goodbye&quot;) {
            id = &quot;com.example.goodbye&quot;
            implementationClass = &quot;com.example.goodbye.GoodbyePlugin&quot;
        }
    }
}

publishing {
    repositories {
        maven {
            url = uri(&quot;../../consuming/maven-repo&quot;)
        }
        ivy {
            url = uri(&quot;../../consuming/ivy-repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Running <code>gradle publish</code> in the sample directory causes the following repo layouts to exist:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/pluginMarkers.png" alt="pluginMarkers">
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:old_plugin_application"><a class="anchor" href="#sec:old_plugin_application"></a><a class="link" href="#sec:old_plugin_application">Legacy Plugin Application</a></h5>
<div class="paragraph">
<p>With the introduction of the <a href="#sec:plugins_block">plugins DSL</a>, users should have little reason to use the legacy method of applying plugins. It is documented here in case a build author cannot use the plugins DSL due to restrictions in how it currently works.</p>
</div>
<div class="sect5">
<h6 id="sec:applying_binary_plugins"><a class="anchor" href="#sec:applying_binary_plugins"></a><a class="link" href="#sec:applying_binary_plugins">Applying Binary Plugins</a></h6>
<div class="exampleblock">
<div class="title">Example 164. Applying a binary plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Plugins can be applied using a <em>plugin id</em>. In the above case, we are using the short name <code>java</code> to apply the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>.</p>
</div>
<div class="paragraph">
<p>Rather than using a plugin id, plugins can also be applied by simply specifying the class of the plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 165. Applying a binary plugin by type</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: JavaPlugin</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply&lt;JavaPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>JavaPlugin</code> symbol in the above sample refers to the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/JavaPlugin.html">JavaPlugin</a>. This class does not strictly need to be imported as the <code>org.gradle.api.plugins</code> package is automatically imported in all build scripts (see <a href="#script-default-imports">Default imports</a>).</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Furthermore, it is not necessary to append <code>.class</code> to identify a class literal in Groovy as it is in Java.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Furthermore, one need to append the <code>::class</code> suffix to identify a class literal in Kotlin instead of <code>.class</code> in Java.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:applying_plugins_buildscript"><a class="anchor" href="#sec:applying_plugins_buildscript"></a><a class="link" href="#sec:applying_plugins_buildscript">Applying plugins with the buildscript block</a></h6>
<div class="paragraph">
<p>Binary plugins that have been published as external jar files can be added to a project by adding the plugin to the build script classpath and then applying the plugin. External jars can be added to the build script classpath using the <code>buildscript {}</code> block as described in <a href="#sec:build_script_external_dependencies">External dependencies for the build script</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 166. Applying a plugin with the buildscript block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray.gradle:gradle-bintray-plugin:0.4.1</span><span class="delimiter">'</span></span>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.jfrog.bintray</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath(&quot;com.jfrog.bintray.gradle:gradle-bintray-plugin:0.4.1&quot;)
    }
}

apply(plugin = &quot;com.jfrog.bintray&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:script_plugins"><a class="anchor" href="#sec:script_plugins"></a><a class="link" href="#sec:script_plugins">Script plugins</a></h4>
<div class="exampleblock">
<div class="title">Example 167. Applying a script plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">from</span>: <span class="string"><span class="delimiter">'</span><span class="content">other.gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(from = &quot;other.gradle.kts&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Script plugins are automatically resolved and can be applied from a script on the local filesystem or at a remote location. Filesystem locations are relative to the project directory, while remote script locations are specified with an HTTP URL. Multiple script plugins (of either form) can be applied to a given target.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:finding_community_plugins"><a class="anchor" href="#sec:finding_community_plugins"></a><a class="link" href="#sec:finding_community_plugins">Finding community plugins</a></h4>
<div class="paragraph">
<p>Gradle has a vibrant community of plugin developers who contribute plugins for a wide variety of capabilities. The Gradle <a href="https://plugins.gradle.org">plugin portal</a> provides an interface for searching and exploring community plugins.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:more_on_plugins"><a class="anchor" href="#sec:more_on_plugins"></a><a class="link" href="#sec:more_on_plugins">More on plugins</a></h4>
<div class="paragraph">
<p>This chapter aims to serve as an introduction to plugins and Gradle and the role they play. For more information on the inner workings of plugins, see <a href="#custom_plugins">Custom Plugins</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_lifecycle"><a class="anchor" href="#build_lifecycle"></a><a class="link" href="#build_lifecycle">Build Lifecycle</a></h3>
<div class="paragraph">
<p>We said earlier that the core of Gradle is a language for dependency based programming. In Gradle terms this means that you can define tasks and dependencies between tasks. Gradle guarantees that these tasks are executed in the order of their dependencies, and that each task is executed only once. These tasks form a <a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">Directed Acyclic Graph</a>. There are build tools that build up such a dependency graph as they execute their tasks. Gradle builds the complete dependency graph <em>before</em> any task is executed. This lies at the heart of Gradle and makes many things possible which would not be possible otherwise.</p>
</div>
<div class="paragraph">
<p>Your build scripts configure this dependency graph. Therefore they are strictly speaking <em>build configuration scripts</em>.</p>
</div>
<div class="sect3">
<h4 id="sec:build_phases"><a class="anchor" href="#sec:build_phases"></a><a class="link" href="#sec:build_phases">Build phases</a></h4>
<div class="paragraph">
<p>A Gradle build has three distinct phases.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Initialization</dt>
<dd>
<p>Gradle supports single and multi-project builds. During the initialization phase, Gradle determines which projects are going to take part in the build, and creates a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> instance for each of these projects.</p>
</dd>
<dt class="hdlist1">Configuration</dt>
<dd>
<p>During this phase the project objects are configured. The build scripts of <em>all</em> projects which are part of the build are executed.</p>
</dd>
<dt class="hdlist1">Execution</dt>
<dd>
<p>Gradle determines the subset of the tasks, created and configured during the configuration phase, to be executed. The subset is determined by the task name arguments passed to the <code>gradle</code> command and the current directory. Gradle then executes each of the selected tasks.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:settings_file"><a class="anchor" href="#sec:settings_file"></a><a class="link" href="#sec:settings_file">Settings file</a></h4>
<div class="paragraph">
<p>Beside the build script files, Gradle defines a settings file. The settings file is determined by Gradle via a naming convention. The default name for this file is <code>settings.gradle</code>. Later in this chapter we explain how Gradle looks for a settings file.</p>
</div>
<div class="paragraph">
<p>The settings file is executed during the initialization phase. A multi-project build must have a <code>settings.gradle</code> file in the root project of the multi-project hierarchy. It is required because the settings file defines which projects are taking part in the multi-project build (see <a href="#multi_project_builds">Authoring Multi-Project Builds</a>). For a single-project build, a settings file is optional. Besides defining the included projects, you might need it to add libraries to your build script classpath (see <a href="#organizing_gradle_projects">Organizing Gradle Projects</a>). Let&#8217;s first do some introspection with a single project build:</p>
</div>
<div class="exampleblock">
<div class="title">Example 168. Single project build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the initialization phase.</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the configuration phase.</span><span class="delimiter">'</span></span>

task configured {
    println <span class="string"><span class="delimiter">'</span><span class="content">This is also executed during the configuration phase.</span><span class="delimiter">'</span></span>
}

task test {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the execution phase.</span><span class="delimiter">'</span></span>
    }
}

task testBoth {
        doFirst {
          println <span class="string"><span class="delimiter">'</span><span class="content">This is executed first during the execution phase.</span><span class="delimiter">'</span></span>
        }
        doLast {
          println <span class="string"><span class="delimiter">'</span><span class="content">This is executed last during the execution phase.</span><span class="delimiter">'</span></span>
        }
        println <span class="string"><span class="delimiter">'</span><span class="content">This is executed during the configuration phase as well.</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(&quot;This is executed during the initialization phase.&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(&quot;This is executed during the configuration phase.&quot;)

tasks.register(&quot;configured&quot;) {
    println(&quot;This is also executed during the configuration phase.&quot;)
}

tasks.register(&quot;test&quot;) {
    doLast {
        println(&quot;This is executed during the execution phase.&quot;)
    }
}

tasks.register(&quot;testBoth&quot;) {
    doFirst {
        println(&quot;This is executed first during the execution phase.&quot;)
    }
    doLast {
        println(&quot;This is executed last during the execution phase.&quot;)
    }
    println(&quot;This is executed during the configuration phase as well.&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="output_of_gradle_test_testboth"><a class="anchor" href="#output_of_gradle_test_testboth"></a><a class="link" href="#output_of_gradle_test_testboth">Output of <strong><code>gradle test testBoth</code></strong></a></h5>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle test testBoth
This is executed during the initialization phase.

&gt; Configure project :
This is executed during the configuration phase.
This is also executed during the configuration phase.
This is executed during the configuration phase <span class="keyword">as</span> well.

&gt; Task :test
This is executed during the execution phase.

&gt; Task :testBoth
This is executed first during the execution phase.
This is executed last during the execution phase.

BUILD SUCCESSFUL <span class="keyword">in</span> <span class="integer">0</span>s
<span class="integer">2</span> actionable <span class="key">tasks</span>: <span class="integer">2</span> executed</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle test testBoth
This is executed during the initialization phase.

&gt; Configure project :
This is executed during the configuration phase.
This is executed during the configuration phase as well.

&gt; Task :test
This is executed during the execution phase.

&gt; Task :testBoth
This is executed first during the execution phase.
This is executed last during the execution phase.

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a build script, the property access and method calls are delegated to a project object. Similarly property access and method calls within the settings file is delegated to a settings object. Look at the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html">Settings</a> class in the API documentation for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:lifecycle_multi_project_builds"><a class="anchor" href="#sec:lifecycle_multi_project_builds"></a><a class="link" href="#sec:lifecycle_multi_project_builds">Multi-project builds</a></h4>
<div class="paragraph">
<p>A multi-project build is a build where you build more than one project during a single execution of Gradle. You have to declare the projects taking part in the multi-project build in the settings file. There is much more to say about multi-project builds in the chapter dedicated to this topic (see <a href="#multi_project_builds">Authoring Multi-Project Builds</a>).</p>
</div>
<div class="sect4">
<h5 id="sub:project_locations"><a class="anchor" href="#sub:project_locations"></a><a class="link" href="#sub:project_locations">Project locations</a></h5>
<div class="paragraph">
<p>Multi-project builds are always represented by a tree with a single root. Each element in the tree represents a project. A project has a path which denotes the position of the project in the multi-project build tree. In most cases the project path is consistent with the physical location of the project in the file system. However, this behavior is configurable. The project tree is created in the <code>settings.gradle</code> file. By default it is assumed that the location of the settings file is also the location of the root project. But you can redefine the location of the root project in the settings file.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:building_the_tree"><a class="anchor" href="#sub:building_the_tree"></a><a class="link" href="#sub:building_the_tree">Building the tree</a></h5>
<div class="paragraph">
<p>In the settings file you can use a set of methods to build the project tree. Hierarchical and flat physical layouts get special support.</p>
</div>
<div class="sect5">
<h6 id="sec:hierarchical_layouts"><a class="anchor" href="#sec:hierarchical_layouts"></a><a class="link" href="#sec:hierarchical_layouts">Hierarchical layouts</a></h6>
<div class="exampleblock">
<div class="title">Example 169. Hierarchical layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">project1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project2:child</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project3:child1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;project1&quot;, &quot;project2:child&quot;, &quot;project3:child1&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>include</code> method takes project paths as arguments. The project path is assumed to be equal to the relative physical file system path. For example, a path 'services:api' is mapped by default to a folder 'services/api' (relative from the project root). You only need to specify the leaves of the tree. This means that the inclusion of the path 'services:hotels:api' will result in creating 3 projects: 'services', 'services:hotels' and 'services:hotels:api'.
More examples of how to work with the project path can be found in the DSL documentation of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])">Settings.include(java.lang.String[])</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:flat_layouts"><a class="anchor" href="#sec:flat_layouts"></a><a class="link" href="#sec:flat_layouts">Flat layouts</a></h6>
<div class="exampleblock">
<div class="title">Example 170. Flat layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">includeFlat <span class="string"><span class="delimiter">'</span><span class="content">project3</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">project4</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">includeFlat(&quot;project3&quot;, &quot;project4&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>includeFlat</code> method takes directory names as an argument. These directories need to exist as siblings of the root project directory. The location of these directories are considered as child projects of the root project in the multi-project tree.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:modifying_element_of_the_project_tree"><a class="anchor" href="#sub:modifying_element_of_the_project_tree"></a><a class="link" href="#sub:modifying_element_of_the_project_tree">Modifying elements of the project tree</a></h5>
<div class="paragraph">
<p>The multi-project tree created in the settings file is made up of so called <em>project descriptors</em>. You can modify these descriptors in the settings file at any time. To access a descriptor you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 171. Lookup of elements of the project tree</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println rootProject.name
println project(<span class="string"><span class="delimiter">'</span><span class="content">:projectA</span><span class="delimiter">'</span></span>).name</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(rootProject.name)
println(project(&quot;:projectA&quot;).name)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using this descriptor you can change the name, project directory and build file of a project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 172. Modification of elements of the project tree</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>
project(<span class="string"><span class="delimiter">'</span><span class="content">:projectA</span><span class="delimiter">'</span></span>).projectDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(settingsDir, <span class="string"><span class="delimiter">'</span><span class="content">../my-project-a</span><span class="delimiter">'</span></span>)
project(<span class="string"><span class="delimiter">'</span><span class="content">:projectA</span><span class="delimiter">'</span></span>).buildFileName = <span class="string"><span class="delimiter">'</span><span class="content">projectA.gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;main&quot;
project(&quot;:projectA&quot;).projectDir = File(settingsDir, &quot;../my-project-a&quot;)
project(&quot;:projectA&quot;).buildFileName = &quot;projectA.gradle&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Look at the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/initialization/ProjectDescriptor.html">ProjectDescriptor</a> class in the API documentation for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:initialization"><a class="anchor" href="#sec:initialization"></a><a class="link" href="#sec:initialization">Initialization</a></h4>
<div class="paragraph">
<p>How does Gradle know whether to do a single or multi-project build? If you trigger a multi-project build from a directory with a settings file, things are easy. But Gradle also allows you to execute the build from within any subproject taking part in the build.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> If you execute Gradle from within a project with no <code>settings.gradle</code> file, Gradle looks for a <code>settings.gradle</code> file in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It looks in a directory called <code>master</code> which has the same nesting level as the current dir.</p>
</li>
<li>
<p>If not found yet, it searches parent directories.</p>
</li>
<li>
<p>If not found yet, the build is executed as a single project build.</p>
</li>
<li>
<p>If a <code>settings.gradle</code> file is found, Gradle checks if the current project is part of the multi-project hierarchy defined in the found <code>settings.gradle</code> file. If not, the build is executed as a single project build. Otherwise a multi-project build is executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What is the purpose of this behavior? Gradle needs to determine whether the project you are in is a subproject of a multi-project build or not. Of course, if it is a subproject, only the subproject and its dependent projects are built, but Gradle needs to create the build configuration for the whole multi-project build (see <a href="#multi_project_builds">Authoring Multi-Project Builds</a>). If the current project contains a <code>settings.gradle</code> file, the build is always executed as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a single project build, if the <code>settings.gradle</code> file does not define a multi-project hierarchy</p>
</li>
<li>
<p>a multi-project build, if the <code>settings.gradle</code> file does define a multi-project hierarchy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The automatic search for a <code>settings.gradle</code> file only works for multi-project builds with a physical hierarchical or flat layout. For a flat layout you must additionally follow the naming convention described above (<code>master</code>). Gradle supports arbitrary physical layouts for a multi-project build, but for such arbitrary layouts you need to execute the build from the directory where the settings file is located. For information on how to run partial builds from the root, see <a href="#sec:running_partial_build_from_the_root">Running tasks by their absolute path</a>.</p>
</div>
<div class="paragraph">
<p>Gradle creates a Project object for every project taking part in the build. For a multi-project build these are the projects specified in the Settings object (plus the root project). Each project object has by default a name equal to the name of its top level directory, and every project except the root project has a parent project. Any project may have child projects.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuration_and_execution_of_a_single_project_build"><a class="anchor" href="#sec:configuration_and_execution_of_a_single_project_build"></a><a class="link" href="#sec:configuration_and_execution_of_a_single_project_build">Configuration and execution of a single project build</a></h4>
<div class="paragraph">
<p>For a single project build, the workflow of the <em>after initialization</em> phases are pretty simple. The build script is executed against the project object that was created during the initialization phase. Then Gradle looks for tasks with names equal to those passed as command line arguments. If these task names exist, they are executed as a separate build in the order you have passed them. The configuration and execution for multi-project builds is discussed in <a href="#multi_project_builds">Authoring Multi-Project Builds</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="build_lifecycle_events"><a class="anchor" href="#build_lifecycle_events"></a><a class="link" href="#build_lifecycle_events">Responding to the lifecycle in the build script</a></h4>
<div class="paragraph">
<p>Your build script can receive notifications as the build progresses through its lifecycle. These notifications generally take two forms: You can either implement a particular listener interface, or you can provide a closure to execute when the notification is fired. The examples below use closures. For details on how to use the listener interfaces, refer to the API documentation.</p>
</div>
<div class="sect4">
<h5 id="sec:project_evaluation"><a class="anchor" href="#sec:project_evaluation"></a><a class="link" href="#sec:project_evaluation">Project evaluation</a></h5>
<div class="paragraph">
<p>You can receive a notification immediately before and after a project is evaluated. This can be used to do things like performing additional configuration once all the definitions in a build script have been applied, or for some custom logging or profiling.</p>
</div>
<div class="paragraph">
<p>Below is an example which adds a <code>test</code> task to each project which has a <code>hasTests</code> property value of true.</p>
</div>
<div class="exampleblock">
<div class="title">Example 173. Adding of test task to each project which has certain property set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    afterEvaluate { project -&gt;
        <span class="keyword">if</span> (project.hasTests) {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">Adding test task to </span><span class="inline"><span class="inline-delimiter">$</span>project</span><span class="delimiter">&quot;</span></span>
            project.task(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>) {
                doLast {
                    println <span class="string"><span class="delimiter">&quot;</span><span class="content">Running tests for </span><span class="inline"><span class="inline-delimiter">$</span>project</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">projectA.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">hasTests = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    afterEvaluate {
        if (extra[&quot;hasTests&quot;] as Boolean) {
            println(&quot;Adding test task to $project&quot;)
            tasks.register(&quot;test&quot;) {
                doLast {
                    println(&quot;Running tests for $project&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">projectA.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;hasTests&quot;] = true</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q test</code></div>
<div class="content">
<pre>&gt; gradle -q test
Adding test task to project ':projectA'
Running tests for project ':projectA'</pre>
</div>
</div>
<div class="paragraph">
<p>This example uses method <code>Project.afterEvaluate()</code> to add a closure which is executed after the project is evaluated.</p>
</div>
<div class="paragraph">
<p>It is also possible to receive notifications when any project is evaluated. This example performs some custom logging of project evaluation. Notice that the <code>afterProject</code> notification is received regardless of whether the project evaluates successfully or fails with an exception.</p>
</div>
<div class="exampleblock">
<div class="title">Example 174. Notifications</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle.afterProject { project -&gt;
    <span class="keyword">if</span> (project.state.failure) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Evaluation of </span><span class="inline"><span class="inline-delimiter">$</span>project</span><span class="content"> FAILED</span><span class="delimiter">&quot;</span></span>
    } <span class="keyword">else</span> {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Evaluation of </span><span class="inline"><span class="inline-delimiter">$</span>project</span><span class="content"> succeeded</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle.afterProject {
    if (state.failure != null) {
        println(&quot;Evaluation of $project FAILED&quot;)
    } else {
        println(&quot;Evaluation of $project succeeded&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="output_of_gradle_q_test"><a class="anchor" href="#output_of_gradle_q_test"></a><a class="link" href="#output_of_gradle_q_test">Output of <strong><code>gradle -q test</code></strong></a></h6>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle -q test
Evaluation of root project <span class="string"><span class="delimiter">'</span><span class="content">buildProjectEvaluateEvents</span><span class="delimiter">'</span></span> succeeded
Evaluation of project <span class="string"><span class="delimiter">'</span><span class="content">:projectA</span><span class="delimiter">'</span></span> succeeded
Evaluation of project <span class="string"><span class="delimiter">'</span><span class="content">:projectB</span><span class="delimiter">'</span></span> FAILED

<span class="key">FAILURE</span>: Build failed with an exception.

* <span class="key">Where</span>:
Build file <span class="string"><span class="delimiter">'</span><span class="content">/home/user/gradle/samples/groovy/projectB.gradle</span><span class="delimiter">'</span></span> <span class="key">line</span>: <span class="integer">1</span>

* What went <span class="key">wrong</span>:
A problem occurred evaluating project <span class="string"><span class="delimiter">'</span><span class="content">:projectB</span><span class="delimiter">'</span></span>.
&gt; broken

* <span class="key">Try</span>:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at <span class="key">https</span>:<span class="comment">//help.gradle.org</span>

BUILD FAILED <span class="keyword">in</span> <span class="integer">0</span>s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle -q test
Evaluation of root project 'buildProjectEvaluateEvents' succeeded
Evaluation of project ':projectA' succeeded
Evaluation of project ':projectB' FAILED

FAILURE: Build failed with an exception.

* Where:
Build file '/home/user/gradle/samples/kotlin/projectB.gradle.kts' line: 1

* What went wrong:
broken

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 0s</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/ProjectEvaluationListener.html">ProjectEvaluationListener</a> to the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a> to receive these events.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_creation"><a class="anchor" href="#sec:task_creation"></a><a class="link" href="#sec:task_creation">Task creation</a></h5>
<div class="paragraph">
<p>You can receive a notification immediately after a task is added to a project. This can be used to set some default values or add behaviour before the task is made available in the build file.</p>
</div>
<div class="paragraph">
<p>The following example sets the <code>srcDir</code> property of each task as it is created.</p>
</div>
<div class="exampleblock">
<div class="title">Example 175. Setting of certain property to all tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.whenTaskAdded { task -&gt;
    task.ext.srcDir = <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>
}

task a

println <span class="string"><span class="delimiter">&quot;</span><span class="content">source dir is </span><span class="inline"><span class="inline-delimiter">$</span>a</span><span class="content">.srcDir</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.whenTaskAdded {
    extra[&quot;srcDir&quot;] = &quot;src/main/java&quot;
}

val a by tasks.registering

println(&quot;source dir is ${a.get().extra[&quot;srcDir&quot;]}&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q a</code></strong></div>
<div class="content">
<pre>&gt; gradle -q a
source dir is src/main/java</pre>
</div>
</div>
<div class="paragraph">
<p>You can also add an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Action.html">Action</a> to a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> to receive these events.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_execution_graph_ready"><a class="anchor" href="#sec:task_execution_graph_ready"></a><a class="link" href="#sec:task_execution_graph_ready">Task execution graph ready</a></h5>
<div class="paragraph">
<p>You can receive a notification immediately after the task execution graph has been populated (See <a href="#configure-by-dag">Configure by DAG</a>).</p>
</div>
<div class="paragraph">
<p>You can also add a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionGraphListener.html">TaskExecutionGraphListener</a> to the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionGraph.html">TaskExecutionGraph</a> to receive these events.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:task_execution"><a class="anchor" href="#sec:task_execution"></a><a class="link" href="#sec:task_execution">Task execution</a></h5>
<div class="paragraph">
<p>You can receive a notification immediately before and after any task is executed.</p>
</div>
<div class="paragraph">
<p>The following example logs the start and end of each task execution. Notice that the <code>afterTask</code> notification is received regardless of whether the task completes successfully or fails with an exception.</p>
</div>
<div class="exampleblock">
<div class="title">Example 176. Logging of start and end of each task execution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task ok

task broken(<span class="key">dependsOn</span>: ok) {
    doLast {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">'</span><span class="content">broken</span><span class="delimiter">'</span></span>)
    }
}

gradle.taskGraph.beforeTask { Task task -&gt;
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">executing </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content"> ...</span><span class="delimiter">&quot;</span></span>
}

gradle.taskGraph.afterTask { Task task, TaskState state -&gt;
    <span class="keyword">if</span> (state.failure) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>
    }
    <span class="keyword">else</span> {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;ok&quot;)

tasks.register(&quot;broken&quot;) {
    dependsOn(&quot;ok&quot;)
    doLast {
        throw RuntimeException(&quot;broken&quot;)
    }
}

gradle.taskGraph.beforeTask {
    println(&quot;executing $this ...&quot;)
}

gradle.taskGraph.afterTask {
    if (state.failure != null) {
        println(&quot;FAILED&quot;)
    } else {
        println(&quot;done&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="output_of_gradle_q_broken"><a class="anchor" href="#output_of_gradle_q_broken"></a><a class="link" href="#output_of_gradle_q_broken">Output of <strong><code>gradle -q broken</code></strong></a></h6>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&gt; gradle -q broken
executing task <span class="string"><span class="delimiter">'</span><span class="content">:ok</span><span class="delimiter">'</span></span> ...
done
executing task <span class="string"><span class="delimiter">'</span><span class="content">:broken</span><span class="delimiter">'</span></span> ...
FAILED

<span class="key">FAILURE</span>: Build failed with an exception.

* <span class="key">Where</span>:
Build file <span class="string"><span class="delimiter">'</span><span class="content">/home/user/gradle/samples/groovy/build.gradle</span><span class="delimiter">'</span></span> <span class="key">line</span>: <span class="integer">5</span>

* What went <span class="key">wrong</span>:
Execution failed <span class="keyword">for</span> task <span class="string"><span class="delimiter">'</span><span class="content">:broken</span><span class="delimiter">'</span></span>.
&gt; broken

* <span class="key">Try</span>:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at <span class="key">https</span>:<span class="comment">//help.gradle.org</span>

BUILD FAILED <span class="keyword">in</span> <span class="integer">0</span>s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">&gt; gradle -q broken
executing task ':ok' ...
done
executing task ':broken' ...
FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':broken'.
&gt; broken

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 0s</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionListener.html">TaskExecutionListener</a> to the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionGraph.html">TaskExecutionGraph</a> to receive these events.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a><a class="link" href="#logging">Logging</a></h3>
<div class="paragraph">
<p>The log is the main 'UI' of a build tool. If it is too verbose, real warnings and problems are easily hidden by this. On the other hand you need relevant information for figuring out if things have gone wrong. Gradle defines 6 log levels, as shown in <a href="#logLevels">Log levels</a>. There are two Gradle-specific log levels, in addition to the ones you might normally see. Those levels are <em>QUIET</em> and <em>LIFECYCLE</em>. The latter is the default, and is used to report build progress.</p>
</div>
<div class="sect3">
<h4 id="logLevels"><a class="anchor" href="#logLevels"></a><a class="link" href="#logLevels">Log levels</a></h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
ERROR
</td>
<td class="hdlist2">
<p>Error messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
QUIET
</td>
<td class="hdlist2">
<p>Important information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
WARNING
</td>
<td class="hdlist2">
<p>Warning messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
LIFECYCLE
</td>
<td class="hdlist2">
<p>Progress information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
INFO
</td>
<td class="hdlist2">
<p>Information messages</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DEBUG
</td>
<td class="hdlist2">
<p>Debug messages</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The rich components of the console (build status and work in progress area) are displayed regardless of the log level used. Before Gradle 4.0 those rich components were only displayed at log level <code>LIFECYCLE</code> or below.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:choosing_a_log_level"><a class="anchor" href="#sec:choosing_a_log_level"></a><a class="link" href="#sec:choosing_a_log_level">Choosing a log level</a></h4>
<div class="paragraph">
<p>You can use the command line switches shown in <a href="#logLevelCommandLineOptions">Log level command-line options</a> to choose different log levels. You can also configure the log level using <code>gradle.properties</code>, see <a href="#sec:gradle_configuration_properties">Gradle properties</a>. In <a href="#stacktraces">Stacktrace command-line options</a> you find the command line switches which affect stacktrace logging.</p>
</div>
<table id="logLevelCommandLineOptions" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. Log level command-line options</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Outputs Log Levels</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no logging options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code> or <code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUIET and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code> or <code>--warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code> or <code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO and higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code> or <code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG and higher (that is, all log messages)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>DEBUG</code> log level can <a href="#sec:debug_security">expose security sensitive information to the console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="stacktraces"><a class="anchor" href="#stacktraces"></a><a class="link" href="#stacktraces">Stacktrace command-line options</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-s</code> or <code>--stacktrace</code></dt>
<dd>
<p>Truncated stacktraces are printed. We recommend this over full stacktraces. Groovy full stacktraces are extremely verbose (Due to the underlying dynamic invocation mechanisms. Yet they usually do not contain relevant information for what has gone wrong in <em>your</em> code.) This option renders stacktraces for deprecation warnings.</p>
</dd>
<dt class="hdlist1"><code>-S</code> or <code>--full-stacktrace</code></dt>
<dd>
<p>The full stacktraces are printed out. This option renders stacktraces for deprecation warnings.</p>
</dd>
<dt class="hdlist1">&lt;No stacktrace options&gt;</dt>
<dd>
<p>No stacktraces are printed to the console in case of a build error (e.g. a compile error). Only in case of internal exceptions will stacktraces be printed. If the <code>DEBUG</code> log level is chosen, truncated stacktraces are always printed.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:debug_security"><a class="anchor" href="#sec:debug_security"></a><a class="link" href="#sec:debug_security">Logging Sensitive Information</a></h4>
<div class="paragraph">
<p>Running Gradle with the <code>DEBUG</code> log level can expose security sensitive information to the console and build log.</p>
</div>
<div class="paragraph">
<p>This information can include but is not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
</li>
<li>
<p>Private repository credentials</p>
</li>
<li>
<p>Build cache &amp; Gradle Enterprise Credentials</p>
</li>
<li>
<p><a href="https://plugins.gradle.org/">Plugin Portal</a> publishing credentials</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DEBUG log level should <strong>not</strong> be used when running on public Continuous Integration services.
Build logs for public Continuous Integration services are world-viewable and can expose this sensitive information.
Depending upon your organization&#8217;s threat model, logging sensitive credentials in private CI may also be a vulnerability.
Please discuss this with your organization&#8217;s security team.</p>
</div>
<div class="paragraph">
<p>Some CI providers attempt to scrub sensitive credentials from logs; however, this will be imperfect and usually only scrubs exact-matches of pre-configured secrets.</p>
</div>
<div class="paragraph">
<p>If you believe a Gradle Plugin may be exposing sensitive information, please contact <a href="mailto:security@gradle.com">security@gradle.com</a> for disclosure assistance.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:sending_your_own_log_messages"><a class="anchor" href="#sec:sending_your_own_log_messages"></a><a class="link" href="#sec:sending_your_own_log_messages">Writing your own log messages</a></h4>
<div class="paragraph">
<p>A simple option for logging in your build file is to write messages to standard output. Gradle redirects anything written to standard output to its logging system at the <code>QUIET</code> log level.</p>
</div>
<div class="exampleblock">
<div class="title">Example 177. Using stdout to write log messages</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span class="string"><span class="delimiter">'</span><span class="content">A message which is logged at QUIET level</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(&quot;A message which is logged at QUIET level&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle also provides a <code>logger</code> property to a build script, which is an instance of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/logging/Logger.html">Logger</a>. This interface extends the SLF4J <code>Logger</code> interface and adds a few Gradle specific methods to it. Below is an example of how this is used in the build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 178. Writing your own log messages</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger.quiet(<span class="string"><span class="delimiter">'</span><span class="content">An info log message which is always logged.</span><span class="delimiter">'</span></span>)
logger.error(<span class="string"><span class="delimiter">'</span><span class="content">An error log message.</span><span class="delimiter">'</span></span>)
logger.warn(<span class="string"><span class="delimiter">'</span><span class="content">A warning log message.</span><span class="delimiter">'</span></span>)
logger.lifecycle(<span class="string"><span class="delimiter">'</span><span class="content">A lifecycle info log message.</span><span class="delimiter">'</span></span>)
logger.info(<span class="string"><span class="delimiter">'</span><span class="content">An info log message.</span><span class="delimiter">'</span></span>)
logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">A debug log message.</span><span class="delimiter">'</span></span>)
logger.trace(<span class="string"><span class="delimiter">'</span><span class="content">A trace log message.</span><span class="delimiter">'</span></span>) <span class="comment">// Gradle never logs TRACE level logs</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logger.quiet(&quot;An info log message which is always logged.&quot;)
logger.error(&quot;An error log message.&quot;)
logger.warn(&quot;A warning log message.&quot;)
logger.lifecycle(&quot;A lifecycle info log message.&quot;)
logger.info(&quot;An info log message.&quot;)
logger.debug(&quot;A debug log message.&quot;)
logger.trace(&quot;A trace log message.&quot;) // Gradle never logs TRACE level logs</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the <a href="https://www.slf4j.org/manual.html#typical_usage">typical SLF4J pattern</a> to replace a placeholder with an actual value as part of the log message.</p>
</div>
<div class="exampleblock">
<div class="title">Example 179. Writing a log message with placeholder</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger.info(<span class="string"><span class="delimiter">'</span><span class="content">A {} log message</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">info</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logger.info(&quot;A {} log message&quot;, &quot;info&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also hook into Gradle&#8217;s logging system from within other classes used in the build (classes from the <code>buildSrc</code> directory for example). Simply use an SLF4J logger. You can use this logger the same way as you use the provided logger in the build script.</p>
</div>
<div class="exampleblock">
<div class="title">Example 180. Using SLF4J to write log messages</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>

<span class="keyword">def</span> slf4jLogger = LoggerFactory.getLogger(<span class="string"><span class="delimiter">'</span><span class="content">some-logger</span><span class="delimiter">'</span></span>)
slf4jLogger.info(<span class="string"><span class="delimiter">'</span><span class="content">An info log message logged using SLF4j</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.slf4j.LoggerFactory

val slf4jLogger = LoggerFactory.getLogger(&quot;some-logger&quot;)
slf4jLogger.info(&quot;An info log message logged using SLF4j&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:external_tools"><a class="anchor" href="#sec:external_tools"></a><a class="link" href="#sec:external_tools">Logging from external tools and libraries</a></h4>
<div class="paragraph">
<p>Internally, Gradle uses Ant and Ivy. Both have their own logging system. Gradle redirects their logging output into the Gradle logging system. There is a 1:1 mapping from the Ant/Ivy log levels to the Gradle log levels, except the Ant/Ivy <code>TRACE</code> log level, which is mapped to Gradle <code>DEBUG</code> log level. This means the default Gradle log level will not show any Ant/Ivy output unless it is an error or a warning.</p>
</div>
<div class="paragraph">
<p>There are many tools out there which still use standard output for logging. By default, Gradle redirects standard output to the <code>QUIET</code> log level and standard error to the <code>ERROR</code> level. This behavior is configurable. The project object provides a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/logging/LoggingManager.html">LoggingManager</a>, which allows you to change the log levels that standard out or error are redirected to when your build script is evaluated.</p>
</div>
<div class="exampleblock">
<div class="title">Example 181. Configuring standard output capture</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logging.captureStandardOutput LogLevel.INFO
println <span class="string"><span class="delimiter">'</span><span class="content">A message which is logged at INFO level</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">logging.captureStandardOutput(LogLevel.INFO)
println(&quot;A message which is logged at INFO level&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To change the log level for standard out or error during task execution, tasks also provide a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/logging/LoggingManager.html">LoggingManager</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 182. Configuring standard output capture for a task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task logInfo {
    logging.captureStandardOutput LogLevel.INFO
    doFirst {
        println <span class="string"><span class="delimiter">'</span><span class="content">A task message which is logged at INFO level</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;logInfo&quot;) {
    logging.captureStandardOutput(LogLevel.INFO)
    doFirst {
        println(&quot;A task message which is logged at INFO level&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle also provides integration with the Java Util Logging, Jakarta Commons Logging and Log4j logging toolkits. Any log messages which your build classes write using these logging toolkits will be redirected to Gradle&#8217;s logging system.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:changing_what_gradle_logs"><a class="anchor" href="#sec:changing_what_gradle_logs"></a><a class="link" href="#sec:changing_what_gradle_logs">Changing what Gradle logs</a></h4>
<div class="paragraph">
<p>You can replace much of Gradle&#8217;s logging UI with your own. You might do this, for example, if you want to customize the UI in some way - to log more or less information, or to change the formatting. You replace the logging using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:useLogger(java.lang.Object)">Gradle.useLogger(java.lang.Object)</a> method. This is accessible from a build script, or an init script, or via the embedding API. Note that this completely disables Gradle&#8217;s default output. Below is an example init script which changes how task execution and build completion is logged.</p>
</div>
<div class="exampleblock">
<div class="title">Example 183. Customizing what Gradle logs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">customLogger.init.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">useLogger(<span class="keyword">new</span> CustomEventLogger())

<span class="type">class</span> <span class="class">CustomEventLogger</span> <span class="directive">extends</span> BuildAdapter <span class="directive">implements</span> TaskExecutionListener {

    <span class="type">void</span> beforeExecute(Task task) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.name]</span><span class="delimiter">&quot;</span></span>
    }

    <span class="type">void</span> afterExecute(Task task, TaskState state) {
        println()
    }

    <span class="type">void</span> buildFinished(BuildResult result) {
        println <span class="string"><span class="delimiter">'</span><span class="content">build completed</span><span class="delimiter">'</span></span>
        <span class="keyword">if</span> (result.failure != <span class="predefined-constant">null</span>) {
            result.failure.printStackTrace()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">customLogger.init.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">useLogger(CustomEventLogger())

class CustomEventLogger() : BuildAdapter(), TaskExecutionListener {

    override fun beforeExecute(task: Task) {
        println(&quot;[${task.name}]&quot;)
    }

    override fun afterExecute(task: Task, state: TaskState) {
        println()
    }

    override fun buildFinished(result: BuildResult) {
        println(&quot;build completed&quot;)
        if (result.failure != null) {
            result.failure.printStackTrace()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="content">
<pre>$ gradle -I customLogger.init.gradle build

&gt; Task :compile
[compile]
compiling source


&gt; Task :testCompile
[testCompile]
compiling test source


&gt; Task :test
[test]
running unit tests


&gt; Task :build
[build]

build completed
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="content">
<pre>$ gradle -I customLogger.init.gradle.kts build

&gt; Task :compile
[compile]
compiling source


&gt; Task :testCompile
[testCompile]
compiling test source


&gt; Task :test
[test]
running unit tests


&gt; Task :build
[build]

build completed
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Your logger can implement any of the listener interfaces listed below. When you register a logger, only the logging for the interfaces that it implements is replaced. Logging for the other interfaces is left untouched. You can find out more about the listener interfaces in <a href="#build_lifecycle_events">Build lifecycle events</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/BuildListener.html">BuildListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/ProjectEvaluationListener.html">ProjectEvaluationListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionGraphListener.html">TaskExecutionGraphListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskExecutionListener.html">TaskExecutionListener</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/execution/TaskActionListener.html">TaskActionListener</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multi_project_builds"><a class="anchor" href="#multi_project_builds"></a><a class="link" href="#multi_project_builds">Authoring Multi-Project Builds</a></h3>
<div class="paragraph">
<p>The powerful support for multi-project builds is one of Gradle&#8217;s unique selling points. This topic is also the most intellectually challenging.</p>
</div>
<div class="paragraph">
<p>A multi-project build in gradle consists of one root project, and one or more subprojects that may also have subprojects.</p>
</div>
<div class="sect3">
<h4 id="sec:cross_project_configuration"><a class="anchor" href="#sec:cross_project_configuration"></a><a class="link" href="#sec:cross_project_configuration">Cross project configuration</a></h4>
<div class="paragraph">
<p>While each subproject could configure itself in complete isolation of the other subprojects, it is common that subprojects share common traits. It is then usually preferable to share configurations among projects, so the same configuration affects several subprojects.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a very simple multi-project build. Gradle is a general purpose build tool at its core, so the projects don&#8217;t have to be Java projects. Our first examples are about marine life.</p>
</div>
<div class="sect4">
<h5 id="sec:configuration_and_execution"><a class="anchor" href="#sec:configuration_and_execution"></a><a class="link" href="#sec:configuration_and_execution">Configuration and execution</a></h5>
<div class="paragraph">
<p><a href="#sec:build_phases">Build phases</a> describes the phases of every Gradle build. Let&#8217;s zoom into the configuration and execution phases of a multi-project build. Configuration here means executing the <code>build.gradle</code> (or <code>build.gradle.kts</code>) file of a project, which implies e.g. downloading all plugins that were declared using &#8216;<code>apply plugin</code>&#8217; or a <code>plugins</code> block. By default, the configuration of all projects happens before any task is executed. This means that when a single task, from a single project is requested, <em>all</em> projects of multi-project build are configured first. The reason every project needs to be configured is to support the flexibility of accessing and changing any part of the Gradle project model.</p>
</div>
<div class="sect5">
<h6 id="sec:configuration_on_demand"><a class="anchor" href="#sec:configuration_on_demand"></a><a class="link" href="#sec:configuration_on_demand">Configuration on demand</a></h6>
<div class="paragraph">
<p>The <em>Configuration injection</em> feature and access to the complete project model are possible because every project is configured before the execution phase. Yet, this approach may not be the most efficient in a very large multi-project build. There are Gradle builds with a hierarchy of hundreds of subprojects. The configuration time of huge multi-project builds may become noticeable. Scalability is an important requirement for Gradle. Hence, starting from version 1.4 a new incubating 'configuration on demand' mode is introduced.</p>
</div>
<div class="paragraph">
<p>Configuration on demand mode attempts to configure only projects that are relevant for requested tasks, i.e. it only executes the <code>build.gradle[.kts]</code> file of projects that are participating in the build. This way, the configuration time of a large multi-project build can be reduced. In the long term, this mode will become the default mode, possibly the only mode for Gradle build execution. The configuration on demand feature is incubating so not every build is guaranteed to work correctly. The feature should work very well for multi-project builds that have <a href="#sec:decoupled_projects">decoupled projects</a>. In configuration on demand mode, projects are configured as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The root project is always configured. This way the typical common configuration is supported (allprojects or subprojects script blocks).</p>
</li>
<li>
<p>The project in the directory where the build is executed is also configured, but only when Gradle is executed without any tasks. This way the default tasks behave correctly when projects are configured on demand.</p>
</li>
<li>
<p>The standard project dependencies are supported and makes relevant projects configured. If project A has a compile dependency on project B then building A causes configuration of both projects.</p>
</li>
<li>
<p>The task dependencies declared via task path are supported and cause relevant projects to be configured. Example: <code>someTask.dependsOn(":someOtherProject:someOtherTask")</code></p>
</li>
<li>
<p>A task requested via task path from the command line (or Tooling API) causes the relevant project to be configured. For example, building 'projectA:projectB:someTask' causes configuration of projectB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eager to try out this new feature? To configure on demand with every build run see <a href="#sec:gradle_configuration_properties">Gradle properties</a>. To configure on demand just for a given build, see <a href="#sec:command_line_performance">command-line performance-oriented options</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:defining_common_behavior"><a class="anchor" href="#sec:defining_common_behavior"></a><a class="link" href="#sec:defining_common_behavior">Defining common behavior</a></h5>
<div class="paragraph">
<p>Let&#8217;s look at some examples with the following project tree. This is a multi-project build with a root project named <code>water</code> and a subproject named <code>bluewhale</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 184. Multi-project tree - water &amp; bluewhale projects</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> bluewhale/
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 bluewhale/
 build.gradle.kts
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">water</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">bluewhale</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;water&quot;
include(&quot;bluewhale&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And where is the build script for the <code>bluewhale</code> project? In Gradle build scripts are optional. Obviously for a single project build, a project without a build script doesn&#8217;t make much sense. For multiproject builds the situation is different. Let&#8217;s look at the build script for the <code>water</code> project and execute it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 185. Build script of water (parent) project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Closure cl = { task -&gt; println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span> }
task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>).doLast(cl)
project(<span class="string"><span class="delimiter">'</span><span class="content">:bluewhale</span><span class="delimiter">'</span></span>) {
    task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>).doLast(cl)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val cl = Action&lt;Task&gt; { println(&quot;I'm ${this.project.name}&quot;) }
tasks.register(&quot;hello&quot;) { doLast(cl) }
project(&quot;:bluewhale&quot;) {
    tasks.register(&quot;hello&quot;) { doLast(cl) }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle allows you to access any project of the multi-project build from any build script. The Project API provides a method called <code>project()</code>, which takes a path as an argument and returns the Project object for this path. The capability to configure a project build from any build script we call <em>cross project configuration</em>. Gradle implements this via <em>configuration injection</em>.</p>
</div>
<div class="paragraph">
<p>We are not that happy with the build script of the <code>water</code> project. It is inconvenient to add the task explicitly for every project. We can do better. Let&#8217;s first add another project called <code>krill</code> to our multi-project build.</p>
</div>
<div class="exampleblock">
<div class="title">Example 186. Multi-project tree - water, bluewhale  &amp; krill projects</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> bluewhale/
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> krill/
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 bluewhale/
 build.gradle.kts
 krill/
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">water</span><span class="delimiter">'</span></span>

include <span class="string"><span class="delimiter">'</span><span class="content">bluewhale</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">krill</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;water&quot;

include(&quot;bluewhale&quot;, &quot;krill&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now we rewrite the <code>water</code> build script and boil it down to a single line.</p>
</div>
<div class="exampleblock">
<div class="title">Example 187. Water project build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
I'm krill</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Is this cool or is this cool? And how does this work? The Project API provides a property <code>allprojects</code> which returns a list with the current project and all its subprojects underneath it. If you call <code>allprojects</code> with a closure, the statements of the closure are delegated to the projects associated with <code>allprojects</code>. You could also do an iteration via <code>allprojects.each</code> (in Groovy) or <code>allprojects.forEach</code> (in Kotlin), but that would be more verbose.</p>
</div>
<div class="paragraph">
<p>Other build systems use inheritance as the primary means for defining common behavior. We also offer inheritance for projects as you will see later. But Gradle uses configuration injection as the usual way of defining common behavior. We think it provides a very powerful and flexible way of configuring multiproject builds.</p>
</div>
<div class="paragraph">
<p>Another possibility for sharing configuration is to use a common external script.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:subproject_configuration"><a class="anchor" href="#sec:subproject_configuration"></a><a class="link" href="#sec:subproject_configuration">Subproject configuration</a></h4>
<div class="paragraph">
<p>The Project API also provides a property for accessing the subprojects only.</p>
</div>
<div class="sect4">
<h5 id="sec:defining_common_behavior_subprojects"><a class="anchor" href="#sec:defining_common_behavior_subprojects"></a><a class="link" href="#sec:defining_common_behavior_subprojects">Defining common behavior</a></h5>
<div class="exampleblock">
<div class="title">Example 188. Defining common behavior of all projects and subprojects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}
subprojects {
    hello {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I depend on water</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}
subprojects {
    tasks.named(&quot;hello&quot;) {
        doLast {
            println(&quot;- I depend on water&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
- I depend on water
I'm krill
- I depend on water</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You may notice that there are two code snippets referencing the <code>hello</code> task. The first one, which uses the <code>task</code> keyword (in Groovy) or the <code>task()</code> function (in Kotlin), constructs the task and provides it&#8217;s base configuration. The second piece doesn&#8217;t use the <code>task</code> keyword or function, as it is further configuring the existing <code>hello</code> task. You may only construct a task once in a project, but you may add any number of code blocks providing additional configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:adding_specific_behavior"><a class="anchor" href="#sub:adding_specific_behavior"></a><a class="link" href="#sub:adding_specific_behavior">Adding specific behavior</a></h5>
<div class="paragraph">
<p>You can add specific behavior on top of the common behavior. Usually we put the project specific behavior in the build script of the project where we want to apply this specific behavior. But as we have already seen, we don&#8217;t have to do it this way. We could add project specific behavior for the <code>bluewhale</code> project like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 189. Defining specific behaviour for particular project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}
subprojects {
    hello {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I depend on water</span><span class="delimiter">&quot;</span></span>
        }
    }
}
project(<span class="string"><span class="delimiter">'</span><span class="content">:bluewhale</span><span class="delimiter">'</span></span>).hello {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I'm the largest animal that has ever lived on this planet.</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}
subprojects {
    tasks.named(&quot;hello&quot;) {
        doLast {
            println(&quot;- I depend on water&quot;)
        }
    }
}
project(&quot;:bluewhale&quot;).tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- I'm the largest animal that has ever lived on this planet.&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
- I depend on water
- I'm the largest animal that has ever lived on this planet.
I'm krill
- I depend on water</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As we have said, we usually prefer to put project specific behavior into the build script of this project. Let&#8217;s refactor and also add some project specific behavior to the <code>krill</code> project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 190. Defining specific behaviour for project krill</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> bluewhale
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> krill
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 bluewhale
  build.gradle.kts
 build.gradle.kts
 krill
  build.gradle.kts
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">water</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">bluewhale</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">krill</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bluewhale/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">hello.doLast {
  println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I'm the largest animal that has ever lived on this planet.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">hello.doLast {
  println <span class="string"><span class="delimiter">&quot;</span><span class="content">- The weight of my species in summer is twice as heavy as all human beings.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}
subprojects {
    hello {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I depend on water</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;water&quot;
include(&quot;bluewhale&quot;, &quot;krill&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bluewhale/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- I'm the largest animal that has ever lived on this planet.&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- The weight of my species in summer is twice as heavy as all human beings.&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}
subprojects {
    tasks.named(&quot;hello&quot;) {
        doLast {
            println(&quot;- I depend on water&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q hello</code></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
- I depend on water
- I'm the largest animal that has ever lived on this planet.
I'm krill
- I depend on water
- The weight of my species in summer is twice as heavy as all human beings.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:project_filtering"><a class="anchor" href="#sub:project_filtering"></a><a class="link" href="#sub:project_filtering">Project filtering</a></h5>
<div class="paragraph">
<p>To show more of the power of configuration injection, let&#8217;s add another project called <code>tropicalFish</code> and add more behavior to the build via the build script of the <code>water</code> project.</p>
</div>
<div class="sect5">
<h6 id="ssub:filtering_by_name"><a class="anchor" href="#ssub:filtering_by_name"></a><a class="link" href="#ssub:filtering_by_name">Filtering by name</a></h6>
<div class="exampleblock">
<div class="title">Example 191. Adding custom behaviour to some projects (filtered by project name)</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> bluewhale/
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> krill/
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> tropicalFish/</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 bluewhale/
  build.gradle.kts
 build.gradle.kts
 krill/
  build.gradle.kts
 settings.gradle.kts
 tropicalFish/</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">water</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">bluewhale</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">krill</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tropicalFish</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}
subprojects {
    hello {
        doLast {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I depend on water</span><span class="delimiter">&quot;</span></span>
        }
    }
}
configure(subprojects.findAll {<span class="local-variable">it</span>.name != <span class="string"><span class="delimiter">'</span><span class="content">tropicalFish</span><span class="delimiter">'</span></span>}) {
    hello {
        doLast {
            println <span class="string"><span class="delimiter">'</span><span class="content">- I love to spend time in the arctic waters.</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;water&quot;
include(&quot;bluewhale&quot;, &quot;krill&quot;, &quot;tropicalFish&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}
subprojects {
    tasks.named(&quot;hello&quot;) {
        doLast {
            println(&quot;- I depend on water&quot;)
        }
    }
}
configure(subprojects.filter { it.name != &quot;tropicalFish&quot; }) {
    tasks.named(&quot;hello&quot;) {
        doLast {
            println(&quot;- I love to spend time in the arctic waters.&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q hello</code></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
- I depend on water
- I love to spend time in the arctic waters.
- I'm the largest animal that has ever lived on this planet.
I'm krill
- I depend on water
- I love to spend time in the arctic waters.
- The weight of my species in summer is twice as heavy as all human beings.
I'm tropicalFish
- I depend on water</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>configure()</code> method takes a list as an argument and applies the configuration to the projects in this list.</p>
</div>
</div>
<div class="sect5">
<h6 id="ssub:filtering_by_properties"><a class="anchor" href="#ssub:filtering_by_properties"></a><a class="link" href="#ssub:filtering_by_properties">Filtering by properties</a></h6>
<div class="paragraph">
<p>Using the project name for filtering is one option. Using <a href="#sec:extra_properties">extra project properties</a> is another.</p>
</div>
<div class="exampleblock">
<div class="title">Example 192. Adding custom behaviour to some projects (filtered by project properties)</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> bluewhale
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> krill
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> tropicalFish
    <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 bluewhale
  build.gradle.kts
 build.gradle.kts
 krill
  build.gradle.kts
 settings.gradle.kts
 tropicalFish
     build.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">water</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">bluewhale</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">krill</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tropicalFish</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bluewhale/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.arctic = <span class="predefined-constant">true</span>
hello.doLast {
  println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I'm the largest animal that has ever lived on this planet.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.arctic = <span class="predefined-constant">true</span>
hello.doLast {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">- The weight of my species in summer is twice as heavy as all human beings.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    task hello {
        doLast { task -&gt;
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm </span><span class="inline"><span class="inline-delimiter">$</span>task</span><span class="content">.project.name</span><span class="delimiter">&quot;</span></span>
        }
    }
}
subprojects {
    hello {
        doLast {println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I depend on water</span><span class="delimiter">&quot;</span></span>}
    }

    afterEvaluate { Project project -&gt;
        <span class="keyword">if</span> (project.arctic) {
            hello.configure {
                doLast {
                    println <span class="string"><span class="delimiter">'</span><span class="content">- I love to spend time in the arctic waters.</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">tropicalFish/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.arctic = <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;water&quot;
include(&quot;bluewhale&quot;, &quot;krill&quot;, &quot;tropicalFish&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bluewhale/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;arctic&quot;] = true
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- I'm the largest animal that has ever lived on this planet.&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;arctic&quot;] = true
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- The weight of my species in summer is twice as heavy as all human beings.&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    tasks.register(&quot;hello&quot;) {
        doLast {
            println(&quot;I'm ${this.project.name}&quot;)
        }
    }
}
subprojects {
    val hello by tasks.existing

    hello {
        doLast { println(&quot;- I depend on water&quot;) }
    }

    afterEvaluate {
        if (extra[&quot;arctic&quot;] as Boolean) {
            hello {
                doLast {
                    println(&quot;- I love to spend time in the arctic waters.&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">tropicalFish/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;arctic&quot;] = false</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q hello</code></div>
<div class="content">
<pre>&gt; gradle -q hello
I'm water
I'm bluewhale
- I depend on water
- I'm the largest animal that has ever lived on this planet.
- I love to spend time in the arctic waters.
I'm krill
- I depend on water
- The weight of my species in summer is twice as heavy as all human beings.
- I love to spend time in the arctic waters.
I'm tropicalFish
- I depend on water</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the build file of the <code>water</code> project we use an <code>afterEvaluate</code> notification. This means that the closure we are passing gets evaluated <em>after</em> the build scripts of the subproject are evaluated. As the property <code>arctic</code> is set in those build scripts, we have to do it this way. You will find more on this topic in <a href="#sec:dependencies_which_dependencies">Dependencies  Which Dependencies?</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:execution_rules_for_multi_project_builds"><a class="anchor" href="#sec:execution_rules_for_multi_project_builds"></a><a class="link" href="#sec:execution_rules_for_multi_project_builds">Execution rules for multi-project builds</a></h4>
<div class="paragraph">
<p>When we executed the <code>hello</code> task from the root project dir, things behaved in an intuitive way. All the <code>hello</code> tasks of the different projects were executed. Let&#8217;s switch to the <code>bluewhale</code> dir and see what happens if we execute Gradle from there.</p>
</div>
<div class="listingblock">
<div class="title">Running build from subproject</div>
<div class="content">
<pre>&gt; gradle -q hello
I'm bluewhale
- I depend on water
- I'm the largest animal that has ever lived on this planet.
- I love to spend time in the arctic waters.</pre>
</div>
</div>
<div class="paragraph">
<p>The basic rule behind Gradle&#8217;s behavior is simple. Gradle looks down the hierarchy, starting with the <em>current dir</em>, for tasks with the name <code>hello</code> and executes them. One thing is very important to note. Gradle <em>always</em> evaluates <em>every</em> project of the multi-project build and creates all existing task objects. Then, according to the task name arguments and the current dir, Gradle filters the tasks which should be executed. Because of Gradle&#8217;s cross project configuration <em>every</em> project has to be evaluated before <em>any</em> task gets executed. We will have a closer look at this in the next section. Let&#8217;s now have our last marine example. Let&#8217;s add a task to <code>bluewhale</code> and <code>krill</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 193. Evaluation and execution of projects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">bluewhale/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.arctic = <span class="predefined-constant">true</span>
hello {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">- I'm the largest animal that has ever lived on this planet.</span><span class="delimiter">&quot;</span></span>
    }
}

task distanceToIceberg {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">20 nautical miles</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.arctic = <span class="predefined-constant">true</span>
hello {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">- The weight of my species in summer is twice as heavy as all human beings.</span><span class="delimiter">&quot;</span></span>
    }
}

task distanceToIceberg {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">5 nautical miles</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">bluewhale/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;arctic&quot;] = true
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- I'm the largest animal that has ever lived on this planet.&quot;)
    }
}

tasks.register(&quot;distanceToIceberg&quot;) {
    doLast {
        println(&quot;20 nautical miles&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">krill/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;arctic&quot;] = true
tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;- The weight of my species in summer is twice as heavy as all human beings.&quot;)
    }
}

tasks.register(&quot;distanceToIceberg&quot;) {
    doLast {
        println(&quot;5 nautical miles&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q distanceToIceberg</code></div>
<div class="content">
<pre>&gt; gradle -q distanceToIceberg
20 nautical miles
5 nautical miles</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the output without the <code>-q</code> option:</p>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle distanceToIceberg</code></strong></div>
<div class="content">
<pre>&gt; gradle distanceToIceberg

&gt; Task :bluewhale:distanceToIceberg
20 nautical miles

&gt; Task :krill:distanceToIceberg
5 nautical miles

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The build is executed from the <code>water</code> project. Neither <code>water</code> nor <code>tropicalFish</code> have a task with the name <code>distanceToIceberg</code>. Gradle does not care. The simple rule mentioned already above is: Execute all tasks down the hierarchy which have this name. Only complain if there is <em>no</em> such task!</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:running_partial_build_from_the_root"><a class="anchor" href="#sec:running_partial_build_from_the_root"></a><a class="link" href="#sec:running_partial_build_from_the_root">Running tasks by their absolute path</a></h4>
<div class="paragraph">
<p>As we have seen, you can run a multi-project build by entering any subproject dir and execute the build from there. All matching task names of the project hierarchy starting with the current dir are executed. But Gradle also offers to execute tasks by their absolute path (see also <a href="#sec:project_and_task_paths">Project and task paths</a>):</p>
</div>
<div class="listingblock">
<div class="title">Running tasks by their absolute path</div>
<div class="content">
<pre>&gt; gradle -q :hello :krill:hello hello
I'm water
I'm krill
- I depend on water
- The weight of my species in summer is twice as heavy as all human beings.
- I love to spend time in the arctic waters.
I'm tropicalFish
- I depend on water</pre>
</div>
</div>
<div class="paragraph">
<p>The build is executed from the <code>tropicalFish</code> project. We execute the <code>hello</code> tasks of the <code>water</code>, the <code>krill</code> and the <code>tropicalFish</code> project. The first two tasks are specified by their absolute path, the last task is executed using the name matching mechanism described above.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_and_task_paths"><a class="anchor" href="#sec:project_and_task_paths"></a><a class="link" href="#sec:project_and_task_paths">Project and task paths</a></h4>
<div class="paragraph">
<p>A project path has the following pattern: It starts with an optional colon, which denotes the root project. The root project is the only project in a path that is not specified by its name. The rest of a project path is a colon-separated sequence of project names, where the next project is a subproject of the previous project.</p>
</div>
<div class="paragraph">
<p>The path of a task is simply its project path plus the task name, like <code>:bluewhale:hello</code>. Within a project you can address a task of the same project just by its name. This is interpreted as a relative path.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependencies_which_dependencies"><a class="anchor" href="#sec:dependencies_which_dependencies"></a><a class="link" href="#sec:dependencies_which_dependencies">Dependencies - Which dependencies?</a></h4>
<div class="paragraph">
<p>The examples from the last section were special, as the projects had no <em>Execution Dependencies</em>. They had only <em>Configuration Dependencies</em>. The following sections illustrate the differences between these two types of dependencies.</p>
</div>
<div class="sect4">
<h5 id="sub:execution_time_dependencies"><a class="anchor" href="#sub:execution_time_dependencies"></a><a class="link" href="#sub:execution_time_dependencies">Execution dependencies</a></h5>
<div class="sect5">
<h6 id="ssub:dependencies_and_execution_order"><a class="anchor" href="#ssub:dependencies_and_execution_order"></a><a class="link" href="#ssub:dependencies_and_execution_order">Dependencies and execution order</a></h6>
<div class="exampleblock">
<div class="title">Example 194. Dependencies and execution order</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> consumer
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> producer
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 consumer
  build.gradle.kts
 producer
  build.gradle.kts
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.producerMessage = <span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">consumer</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task action {
    doLast {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Consuming message: </span><span class="inline"><span class="inline-delimiter">${</span>rootProject.producerMessage<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task action {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Producing message:</span><span class="delimiter">&quot;</span></span>
        rootProject.producerMessage = <span class="string"><span class="delimiter">'</span><span class="content">Watch the order of execution.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;producerMessage&quot;] = null</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;consumer&quot;, &quot;producer&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;action&quot;) {
    doLast {
        println(&quot;Consuming message: ${rootProject.extra[&quot;producerMessage&quot;]}&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;action&quot;) {
    doLast {
        println(&quot;Producing message:&quot;)
        rootProject.extra[&quot;producerMessage&quot;] = &quot;Watch the order of execution.&quot;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q action</code></div>
<div class="content">
<pre>&gt; gradle -q action
Consuming message: null
Producing message:</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This didn&#8217;t quite do what we want. If nothing else is defined, Gradle executes the task in alphanumeric order. Therefore, Gradle will execute <code>:consumer:action</code> before <code>:producer:action</code>. Let&#8217;s try to solve this with a hack and rename the producer project to <code>aProducer</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 195. Dependencies and execution order</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> aProducer
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> consumer
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 aProducer
  build.gradle.kts
 build.gradle.kts
 consumer
  build.gradle.kts
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.producerMessage = <span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">consumer</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">aProducer</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task action {
    doLast {
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Consuming message: </span><span class="inline"><span class="inline-delimiter">${</span>rootProject.producerMessage<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">aProducer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task action {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Producing message:</span><span class="delimiter">&quot;</span></span>
        rootProject.producerMessage = <span class="string"><span class="delimiter">'</span><span class="content">Watch the order of execution.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;producerMessage&quot;] = null</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;consumer&quot;, &quot;aProducer&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;action&quot;) {
    doLast {
        println(&quot;Consuming message: ${rootProject.extra[&quot;producerMessage&quot;]}&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">aProducer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;action&quot;) {
    doLast {
        println(&quot;Producing message:&quot;)
        rootProject.extra[&quot;producerMessage&quot;] = &quot;Watch the order of execution.&quot;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q action</code></div>
<div class="content">
<pre>&gt; gradle -q action
Producing message:
Consuming message: Watch the order of execution.</pre>
</div>
</div>
<div class="paragraph">
<p>We can show where this hack doesn&#8217;t work if we now switch to the <code>consumer</code> dir and execute the build.</p>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q action</code> from the <code>consumer</code> dir</div>
<div class="content">
<pre>&gt; gradle -q action
Consuming message: null</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The problem is that the two <code>action</code> tasks are unrelated. If you execute the build from the <code>messages</code> project Gradle executes them both because they have the same name and they are down the hierarchy. In the last example only one <code>action</code> task was down the hierarchy and therefore it was the only task that was executed. We need something better than this hack.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:real_life_examples"><a class="anchor" href="#sub:real_life_examples"></a><a class="link" href="#sub:real_life_examples">Real life examples</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s multi-project features are driven by real life use cases. One good example consists of two web application projects and a parent project that creates a distribution including the two web applications.<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup> For the example we use only one build script and do <em>cross project configuration</em>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 196. Dependencies - real life example - crossproject configuration</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> date
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> src
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> main
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> sample
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> DateServlet.java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> webapp
<span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> web.xml
<span class="error"></span><span class="error"></span><span class="error"></span> hello
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> src
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> main
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> sample
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> HelloServlet.java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> webapp
<span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> web.xml
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 date
  src
      main
          java
           org
               gradle
                   sample
                       DateServlet.java
          webapp
              web.xml
 hello
  src
      main
          java
           org
               gradle
                   sample
                       HelloServlet.java
          webapp
              web.xml
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">webDist</span><span class="delimiter">'</span></span>
include <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
    version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
}

subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">war</span><span class="delimiter">'</span></span>
    repositories {
        mavenCentral()
    }
    dependencies {
        implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.servlet:servlet-api:2.5</span><span class="delimiter">&quot;</span></span>
    }
}

task explodedDist(<span class="key">type</span>: Copy) {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/explodedDist</span><span class="delimiter">&quot;</span></span>
    subprojects {
        from tasks.withType(War)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;webDist&quot;
include(&quot;date&quot;, &quot;hello&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">allprojects {
    apply(plugin = &quot;java&quot;)
    group = &quot;org.gradle.sample&quot;
    version = &quot;1.0&quot;
}

subprojects {
    apply(plugin = &quot;war&quot;)
    repositories {
        mavenCentral()
    }
    dependencies {
        &quot;providedCompile&quot;(&quot;javax.servlet:servlet-api:2.5&quot;)
    }
}

tasks.register&lt;Copy&gt;(&quot;explodedDist&quot;) {
    into(&quot;$buildDir/explodedDist&quot;)
    subprojects {
        from(tasks.withType&lt;War&gt;())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have an interesting set of dependencies. Obviously the <code>date</code> and <code>hello</code> projects have a <em>configuration</em> dependency on <code>webDist</code>, as all the build logic for the webapp projects is injected by <code>webDist</code>. The <em>execution</em> dependency is in the other direction, as <code>webDist</code> depends on the build artifacts of <code>date</code> and <code>hello</code>. There is even a third dependency. <code>webDist</code> has a <em>configuration</em> dependency on <code>date</code> and <code>hello</code> because it needs to know the <code>archivePath</code>. But it asks for this information at <em>execution time</em>. Therefore we have no circular dependency.</p>
</div>
<div class="paragraph">
<p>Such dependency patterns are daily bread in the problem space of multi-project builds. If a build system does not support these patterns, you either can&#8217;t solve your problem or you need to do ugly hacks which are hard to maintain and massively impair your productivity as a build master.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:project_jar_dependencies"><a class="anchor" href="#sec:project_jar_dependencies"></a><a class="link" href="#sec:project_jar_dependencies">Project lib dependencies</a></h4>
<div class="paragraph">
<p>What if one project needs the jar produced by another project in its compile path, and not just the jar but also the transitive dependencies of this jar? Obviously this is a very common use case for Java multi-project builds. As mentioned in <a href="#sub:project_dependencies">Project dependencies</a>, Gradle offers project lib dependencies for this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 197. Project lib dependencies</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> api
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> src
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> main
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> sample
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> api
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> Person.java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> apiImpl
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>                     <span class="error"></span><span class="error"></span><span class="error"></span> PersonImpl.java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> test
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>                     <span class="error"></span><span class="error"></span><span class="error"></span> PersonTest.java
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> services
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> personService
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> src
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> main
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> sample
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> services
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span>                     <span class="error"></span><span class="error"></span><span class="error"></span> PersonService.java
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> test
<span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> org
<span class="error"></span><span class="error"></span><span class="error"></span>                     <span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span>                         <span class="error"></span><span class="error"></span><span class="error"></span> sample
<span class="error"></span><span class="error"></span><span class="error"></span>                             <span class="error"></span><span class="error"></span><span class="error"></span> services
<span class="error"></span><span class="error"></span><span class="error"></span>                                 <span class="error"></span><span class="error"></span><span class="error"></span> PersonServiceTest.java
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> shared
    <span class="error"></span><span class="error"></span><span class="error"></span> src
        <span class="error"></span><span class="error"></span><span class="error"></span> main
            <span class="error"></span><span class="error"></span><span class="error"></span> java
                <span class="error"></span><span class="error"></span><span class="error"></span> org
                    <span class="error"></span><span class="error"></span><span class="error"></span> gradle
                        <span class="error"></span><span class="error"></span><span class="error"></span> sample
                            <span class="error"></span><span class="error"></span><span class="error"></span> shared
                                <span class="error"></span><span class="error"></span><span class="error"></span> Helper.java</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Project layout</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 api
  src
      main
       java
           org
               gradle
                   sample
                       api
                        Person.java
                       apiImpl
                           PersonImpl.java
      test
          java
              org
                  gradle
                      PersonTest.java
 build.gradle.kts
 services
  personService
      src
          main
           java
               org
                   gradle
                       sample
                           services
                               PersonService.java
          test
              java
                  org
                      gradle
                          sample
                              services
                                  PersonServiceTest.java
 settings.gradle.kts
 shared
     src
         main
             java
                 org
                     gradle
                         sample
                             shared
                                 Helper.java</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have the projects <code>shared</code>, <code>api</code> and <code>personService</code>. The <code>personService</code> project has a lib dependency on the other two projects. The <code>api</code> project has a lib dependency on the <code>shared</code> project.
<code>services</code> is also a project, but we use it just as a container. It has no build script and gets nothing injected by another build script. We use the <code>:</code> separator to define a project path. Consult the DSL documentation of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])">Settings.include(java.lang.String[])</a> for more information about defining project paths.</p>
</div>
<div id="javadependencies_2" class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">shared</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">services:personService</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/*
 * Copyright 2018 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
    version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
    repositories {
        mavenCentral()
    }
    dependencies {
        testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.12</span><span class="delimiter">&quot;</span></span>
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>) {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:services:personService</span><span class="delimiter">'</span></span>) {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>), project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;api&quot;, &quot;shared&quot;, &quot;services:personService&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    apply(plugin = &quot;java&quot;)
    group = &quot;org.gradle.sample&quot;
    version = &quot;1.0&quot;
    repositories {
        mavenCentral()
    }
    dependencies {
        &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)
    }
}

project(&quot;:api&quot;) {
    dependencies {
        &quot;implementation&quot;(project(&quot;:shared&quot;))
    }
}

project(&quot;:services:personService&quot;) {
    dependencies {
        &quot;implementation&quot;(project(&quot;:shared&quot;))
        &quot;implementation&quot;(project(&quot;:api&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All the build logic is in the build script of the root project.<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup> A <em>lib</em> dependency is a special form of an execution dependency. It causes the other project to be built first and adds the jar with the classes of the other project to the classpath. It also adds the dependencies of the other project to the classpath. So you can enter the <code>api</code> directory and trigger a <code>gradle compile</code>. First the <code>shared</code> project is built and then the <code>api</code> project is built. Project dependencies enable partial multi-project builds.</p>
</div>
<div class="paragraph">
<p>If you come from Maven land you might be perfectly happy with this. If you come from Ivy land, you might expect some more fine grained control. Gradle offers this to you:</p>
</div>
<div class="exampleblock">
<div class="title">Example 198. Fine grained control over dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
    version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>) {
    configurations {
        spi
    }
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
    }
    task spiJar(<span class="key">type</span>: Jar) {
        archiveBaseName = <span class="string"><span class="delimiter">'</span><span class="content">api-spi</span><span class="delimiter">'</span></span>
        from sourceSets.main.output
        include(<span class="string"><span class="delimiter">'</span><span class="content">org/gradle/sample/api/**</span><span class="delimiter">'</span></span>)
    }
    artifacts {
        spi spiJar
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:services:personService</span><span class="delimiter">'</span></span>) {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
        implementation project(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>, <span class="key">configuration</span>: <span class="string"><span class="delimiter">'</span><span class="content">spi</span><span class="delimiter">'</span></span>)
        testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.12</span><span class="delimiter">&quot;</span></span>, project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    apply(plugin = &quot;java&quot;)
    group = &quot;org.gradle.sample&quot;
    version = &quot;1.0&quot;
}

project(&quot;:api&quot;) {
    configurations {
        create(&quot;spi&quot;)
    }
    dependencies {
        &quot;implementation&quot;(project(&quot;:shared&quot;))
    }
    tasks.register&lt;Jar&gt;(&quot;spiJar&quot;) {
        archiveBaseName.set(&quot;api-spi&quot;)
        from(project.the&lt;SourceSetContainer&gt;()[&quot;main&quot;].output)
        include(&quot;org/gradle/sample/api/**&quot;)
    }
    artifacts {
        add(&quot;spi&quot;, tasks[&quot;spiJar&quot;])
    }
}

project(&quot;:services:personService&quot;) {
    dependencies {
        &quot;implementation&quot;(project(&quot;:shared&quot;))
        &quot;implementation&quot;(project(path = &quot;:api&quot;, configuration = &quot;spi&quot;))
        &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)
        &quot;testImplementation&quot;(project(&quot;:api&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Java plugin adds per default a jar to your project libraries which contains all the classes. In this example we create an <em>additional</em> library containing only the interfaces of the <code>api</code> project. We assign this library to a new <em>dependency configuration</em>. For the person service we declare that the project should be compiled only against the <code>api</code> interfaces but tested with all classes from <code>api</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:depending_on_output_of_another_project"><a class="anchor" href="#sec:depending_on_output_of_another_project"></a><a class="link" href="#sec:depending_on_output_of_another_project">Depending on the task output produced by another project</a></h4>
<div class="paragraph">
<p><a href="#sec:project_jar_dependencies">Project dependencies</a> model dependencies between modules. Effectively, you are saying that you depend on the main output of another project. In a Java-based project that&#8217;s usually a JAR file.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want to depend on an output produced by another task. In turn you&#8217;ll want to make sure that the task is executed beforehand to produce that very output. Declaring a task dependency from one project to another is a poor way to model this kind of relationship and introduces unnecessary coupling. The recommended way to model such a dependency is to produce the output, mark it as an "outgoing" artifact or add it to the output of the <code>main</code> source set which you can depend on in the consuming project.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you are working in a multi-project build with the two subprojects <code>producer</code> and <code>consumer</code>. The subproject <code>producer</code> defines a task named <code>buildInfo</code> that generates a properties file containing build information e.g. the project version. The attribute <code>builtBy</code> takes care of establishing an inferred task dependency. For more information on <code>builtBy</code>, see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSetOutput.html">SourceSetOutput</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 199. Task generating a property file containing build information</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task buildInfo(<span class="key">type</span>: BuildInfo) {
    version = project.version
    outputFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/generated-resources/build-info.properties</span><span class="delimiter">&quot;</span></span>)
}

sourceSets {
    main {
        output.dir(buildInfo.outputFile.parentFile, <span class="key">builtBy</span>: buildInfo)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val buildInfo by tasks.registering(BuildInfo::class) {
    version = project.version.toString()
    outputFile = file(&quot;$buildDir/generated-resources/build-info.properties&quot;)
}

sourceSets {
    main {
        output.dir(buildInfo.get().outputFile.parentFile, &quot;builtBy&quot; to buildInfo)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The consuming project is supposed to be able to read the properties file at runtime. Declaring a project dependency on the producing project takes care of creating the properties beforehand and making it available to the runtime classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 200. Declaring a project dependency on the project producing the properties file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtimeOnly project(<span class="string"><span class="delimiter">'</span><span class="content">:producer</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    runtimeOnly(project(&quot;:producer&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the consumer now declares a dependency on the outputs of the <code>producer</code> project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:parallel_execution"><a class="anchor" href="#sec:parallel_execution"></a><a class="link" href="#sec:parallel_execution">Parallel project execution</a></h4>
<div class="paragraph">
<p>With more and more CPU cores available on developer desktops and CI servers, it is important that Gradle is able to fully utilise these processing resources. More specifically, parallel execution attempts to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduce total build time for a multi-project build where execution is IO bound or otherwise does not consume all available CPU resources.</p>
</li>
<li>
<p>Provide faster feedback for execution of small projects without awaiting completion of other projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although Gradle already offers parallel test execution via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/Test.html#setMaxParallelForks-int-">Test.setMaxParallelForks(int)</a> the feature described in this section is parallel execution at a project level.</p>
</div>
<div class="paragraph">
<p>Parallel project execution allows the separate projects in a decoupled multi-project build to be executed in parallel (see also <a href="#sec:decoupled_projects">Decoupled projects</a>). While parallel execution does not strictly require decoupling at configuration time, the long-term goal is to provide a powerful set of features that will be available for fully decoupled projects. Such features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:configuration_on_demand">Configuration on-demand</a>.</p>
</li>
<li>
<p>Configuration of projects in parallel.</p>
</li>
<li>
<p>Re-use of configuration for unchanged projects.</p>
</li>
<li>
<p>Project-level up-to-date checks.</p>
</li>
<li>
<p>Using pre-built artifacts in the place of building dependent projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How does parallel execution work? First, you need to tell Gradle to use parallel mode. You can use the <a href="#sec:command_line_performance"><code>--parallel</code> command line argument</a> or configure your build environment (<a href="#sec:gradle_configuration_properties">Gradle properties</a>). Unless you provide a specific number of parallel threads, Gradle attempts to choose the right number based on available CPU cores. Every parallel worker exclusively owns a given project while executing a task. Task dependencies are fully supported and parallel workers will start executing upstream tasks first. Bear in mind that the alphabetical ordering of decoupled tasks, as can be seen during sequential execution, is not guaranteed in parallel mode. In other words, in parallel mode tasks will run as soon as their dependencies complete <em>and a task worker is available to run them</em>, which may be earlier than they would start during a sequential build. You should make sure that task dependencies and task inputs/outputs are declared correctly to avoid ordering issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:decoupled_projects"><a class="anchor" href="#sec:decoupled_projects"></a><a class="link" href="#sec:decoupled_projects">Decoupled Projects</a></h4>
<div class="paragraph">
<p>Gradle allows any project to access any other project during both the configuration and execution phases. While this provides a great deal of power and flexibility to the build author, it also limits the flexibility that Gradle has when building those projects. For instance, this effectively prevents Gradle from correctly building multiple projects in parallel, configuring only a subset of projects, or from substituting a pre-built artifact in place of a project dependency.</p>
</div>
<div class="paragraph">
<p>Two projects are said to be <em>decoupled</em> if they do not directly access each other&#8217;s project model. Decoupled projects may only interact in terms of declared dependencies: <a href="#sub:project_dependencies">project dependencies</a> and/or <a href="#sec:task_dependencies">task dependencies</a>. Any other form of project interaction (i.e. by modifying another project object or by reading a value from another project object) causes the projects to be coupled. The consequence of coupling during the configuration phase is that if gradle is invoked with the 'configuration on demand' option, the result of the build can be flawed in several ways. The consequence of coupling during execution phase is that if gradle is invoked with the parallel option, one project task runs too late to influence a task of a project building in parallel. Gradle does not attempt to detect coupling and warn the user, as there are too many possibilities to introduce coupling.</p>
</div>
<div class="paragraph">
<p>A very common way for projects to be coupled is by using <a href="#sec:cross_project_configuration">configuration injection</a>. It may not be immediately apparent, but using key Gradle features like the <code>allprojects</code> and <code>subprojects</code> keywords automatically cause your projects to be coupled. This is because these keywords are used in a <code>build.gradle</code> file, which defines a project. Often this is a root project that does nothing more than define common configuration, but as far as Gradle is concerned this root project is still a fully-fledged project, and by using <code>allprojects</code> that project is effectively coupled to all other projects. Coupling of the root project to subprojects does not impact 'configuration on demand', but using the <code>allprojects</code> and <code>subprojects</code> in any subproject&#8217;s <code>build.gradle</code> file will have an impact.</p>
</div>
<div class="paragraph">
<p>This means that using any form of shared build script logic or configuration injection (<code>allprojects</code>, <code>subprojects</code>, etc.) will cause your projects to be coupled. As we extend the concept of project decoupling and provide features that take advantage of decoupled projects, we will also introduce new features to help you to solve common use cases (like configuration injection) without causing your projects to be coupled.</p>
</div>
<div class="paragraph">
<p>In order to make good use of cross project configuration without running into issues for parallel and 'configuration on demand' options, follow these recommendations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid a subproject&#8217;s build script referencing other subprojects; preferring cross configuration from the root project.</p>
</li>
<li>
<p>Avoid changing the configuration of other projects at execution time.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:multiproject_build_and_test"><a class="anchor" href="#sec:multiproject_build_and_test"></a><a class="link" href="#sec:multiproject_build_and_test">Multi-Project Building and Testing</a></h4>
<div class="paragraph">
<p>The <code>build</code> task of the Java plugin is typically used to compile, test, and perform code style checks (if the CodeQuality plugin is used) of a single project. In multi-project builds you may often want to do all of these tasks across a range of projects. The <code>buildNeeded</code> and <code>buildDependents</code> tasks can help with this.</p>
</div>
<div class="paragraph">
<p>In <a href="#javadependencies_2">this example</a>, the <code>:services:personservice</code> project depends on both the <code>:api</code> and <code>:shared</code> projects. The <code>:api</code> project also depends on the <code>:shared</code> project.</p>
</div>
<div class="paragraph">
<p>Assume you are working on a single project, the <code>:api</code> project. You have been making changes, but have not built the entire project since performing a clean. You want to build any necessary supporting jars, but only perform code quality and unit tests on the project you have changed. The <code>build</code> task does this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 201. Build and Test Single Project</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Output of <strong><code>gradle :api:build</code></strong></div>
<div class="content">
<pre>&gt; gradle :api:build
&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build

BUILD SUCCESSFUL in 0s
9 actionable tasks: 9 executed</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have just gotten the latest version of source from your version control system which included changes in other projects that <code>:api</code> depends on, you might want to not only build all the projects you depend on, but test them as well. The <code>buildNeeded</code> task also tests all the projects from the project lib dependencies of the testRuntime configuration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 202. Build and Test Depended On Projects</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Output of <strong><code>gradle :api:buildNeeded</code></strong></div>
<div class="content">
<pre>&gt; gradle :api:buildNeeded
&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build
&gt; Task :shared:assemble
&gt; Task :shared:compileTestJava
&gt; Task :shared:processTestResources
&gt; Task :shared:testClasses
&gt; Task :shared:test
&gt; Task :shared:check
&gt; Task :shared:build
&gt; Task :shared:buildNeeded
&gt; Task :api:buildNeeded

BUILD SUCCESSFUL in 0s
12 actionable tasks: 12 executed</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You also might want to refactor some part of the <code>:api</code> project that is used in other projects. If you make these types of changes, it is not sufficient to test just the <code>:api</code> project, you also need to test all projects that depend on the <code>:api</code> project. The <code>buildDependents</code> task also tests all the projects that have a project lib dependency (in the testRuntime configuration) on the specified project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 203. Build and Test Dependent Projects</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">Output of <strong><code>gradle :api:buildDependents</code></strong></div>
<div class="content">
<pre>&gt; gradle :api:buildDependents
&gt; Task :shared:compileJava
&gt; Task :shared:processResources
&gt; Task :shared:classes
&gt; Task :shared:jar
&gt; Task :api:compileJava
&gt; Task :api:processResources
&gt; Task :api:classes
&gt; Task :api:jar
&gt; Task :api:assemble
&gt; Task :api:compileTestJava
&gt; Task :api:processTestResources
&gt; Task :api:testClasses
&gt; Task :api:test
&gt; Task :api:check
&gt; Task :api:build
&gt; Task :services:personService:compileJava
&gt; Task :services:personService:processResources
&gt; Task :services:personService:classes
&gt; Task :services:personService:jar
&gt; Task :services:personService:assemble
&gt; Task :services:personService:compileTestJava
&gt; Task :services:personService:processTestResources
&gt; Task :services:personService:testClasses
&gt; Task :services:personService:test
&gt; Task :services:personService:check
&gt; Task :services:personService:build
&gt; Task :services:personService:buildDependents
&gt; Task :api:buildDependents

BUILD SUCCESSFUL in 0s
17 actionable tasks: 17 executed</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, you may want to build and test everything in all projects. Any task you run in the root project folder will cause that same named task to be run on all the children. So you can just run <code>gradle build</code> to build and test all projects.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:multi_project_and_buildsrc"><a class="anchor" href="#sec:multi_project_and_buildsrc"></a><a class="link" href="#sec:multi_project_and_buildsrc">Multi Project and buildSrc</a></h4>
<div class="paragraph">
<p><a href="#sec:build_sources">Using buildSrc to organize build logic</a> tells us that we can place build logic to be compiled and tested in the special <code>buildSrc</code> directory. In a multi project build, there can only be one <code>buildSrc</code> directory which must be located in the root directory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="organizing_gradle_projects"><a class="anchor" href="#organizing_gradle_projects"></a><a class="link" href="#organizing_gradle_projects">Organizing Gradle Projects</a></h3>
<div class="paragraph">
<p>Source code and build logic of every software project should be organized in a meaningful way.
This page lays out the best practices that lead to readable, maintainable projects.
The following sections also touch on common problems and how to avoid them.</p>
</div>
<div class="sect3">
<h4 id="sec:separate_language_source_files"><a class="anchor" href="#sec:separate_language_source_files"></a><a class="link" href="#sec:separate_language_source_files">Separate language-specific source files</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s language plugins establish conventions for discovering and compiling source code.
For example, a project applying the <a href="#java_plugin">Java plugin</a> will automatically compile the code in the directory <code>src/main/java</code>.
Other language plugins follow the same pattern.
The last portion of the directory path usually indicates the expected language of the source files.</p>
</div>
<div class="paragraph">
<p>Some compilers are capable of cross-compiling multiple languages in the same source directory.
The Groovy compiler can handle the scenario of mixing Java and Groovy source files located in <code>src/main/groovy</code>.
Gradle recommends that you place sources in directories according to their language, because builds are more performant and both the user and build can make stronger assumptions.</p>
</div>
<div class="paragraph">
<p>The following source tree contains Java and Kotlin source files. Java source files live in <code>src/main/java</code>, whereas Kotlin source files live in <code>src/main/kotlin</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> src
    <span class="error"></span><span class="error"></span><span class="error"></span> main
        <span class="error"></span><span class="error"></span><span class="error"></span> java
        <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> HelloWorld.java
        <span class="error"></span><span class="error"></span><span class="error"></span> kotlin
            <span class="error"></span><span class="error"></span><span class="error"></span> Utils.kt</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 settings.gradle.kts
 src
     main
         java
          HelloWorld.java
         kotlin
             Utils.kt</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:separate_test_type_source_files"><a class="anchor" href="#sec:separate_test_type_source_files"></a><a class="link" href="#sec:separate_test_type_source_files">Separate source files per test type</a></h4>
<div class="paragraph">
<p>It&#8217;s very common that a project defines and executes different types of tests e.g. unit tests, integration tests, functional tests or smoke tests.
Optimally, the test source code for each test type should be stored in dedicated source directories.
Separated test source code has a positive impact on maintainability and separation of concerns as you can run test types independent from each other.</p>
</div>
<div class="paragraph">
<p>The following source tree demonstrates how to separate unit from integration tests in a Java-based project.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> gradle
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> integration-test.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> src
    <span class="error"></span><span class="error"></span><span class="error"></span> integTest
    <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> java
    <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> DefaultFileReaderIntegrationTest.java
    <span class="error"></span><span class="error"></span><span class="error"></span> main
    <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> java
    <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> DefaultFileReader.java
    <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> <span class="predefined-type">FileReader</span>.java
    <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> StringUtils.java
    <span class="error"></span><span class="error"></span><span class="error"></span> test
        <span class="error"></span><span class="error"></span><span class="error"></span> java
            <span class="error"></span><span class="error"></span><span class="error"></span> StringUtilsTest.java</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 gradle
  integration-test.gradle.kts
 settings.gradle.kts
 src
     integTest
      java
          DefaultFileReaderIntegrationTest.java
     main
      java
          DefaultFileReader.java
          FileReader.java
          StringUtils.java
     test
         java
             StringUtilsTest.java</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle models source code directories with the help of the <a href="#sec:java_source_sets">source set concept</a>.
By pointing an instance of a source set to one or many source code directories, Gradle will automatically create a corresponding compilation task out-of-the-box.</p>
</div>
<div class="exampleblock">
<div class="title">Example 204. Integration test source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle/integration-test.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    integTest {
        java.srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/integTest/java</span><span class="delimiter">'</span></span>)
        resources.srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/integTest/resources</span><span class="delimiter">'</span></span>)
        compileClasspath += sourceSets.main.output + configurations.testRuntimeClasspath
        runtimeClasspath += output + compileClasspath
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle/integration-test.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val sourceSets = the&lt;SourceSetContainer&gt;()

sourceSets {
    create(&quot;integTest&quot;) {
        java.srcDir(file(&quot;src/integTest/java&quot;))
        resources.srcDir(file(&quot;src/integTest/resources&quot;))
        compileClasspath += sourceSets[&quot;main&quot;].output + configurations[&quot;testRuntimeClasspath&quot;]
        runtimeClasspath += output + compileClasspath
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Source sets are only responsible for compiling source code, but do not deal with executing the byte code.
For the purpose of test execution, a corresponding task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> needs to be established.</p>
</div>
<div class="exampleblock">
<div class="title">Example 205. Integration test task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle/integration-test.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task integTest(<span class="key">type</span>: Test) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Runs the integration tests.</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>
    testClassesDirs = sourceSets.integTest.output.classesDirs
    classpath = sourceSets.integTest.runtimeClasspath
    mustRunAfter test
}

check.dependsOn integTest</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">gradle/integration-test.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Test&gt;(&quot;integTest&quot;) {
    description = &quot;Runs the integration tests.&quot;
    group = &quot;verification&quot;
    testClassesDirs = sourceSets[&quot;integTest&quot;].output.classesDirs
    classpath = sourceSets[&quot;integTest&quot;].runtimeClasspath
    mustRunAfter(tasks[&quot;test&quot;])
}

tasks.named(&quot;check&quot;) {
    dependsOn(&quot;integTest&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:use_standard_conventions"><a class="anchor" href="#sec:use_standard_conventions"></a><a class="link" href="#sec:use_standard_conventions">Use standard conventions as much as possible</a></h4>
<div class="paragraph">
<p>All Gradle core plugins follow the software engineering paradigm <a href="https://en.wikipedia.org/wiki/Convention_over_configuration">convention over configuration</a>.
The plugin logic provides users with sensible defaults and standards, the conventions, in a certain context.
Lets take the <a href="#java_plugin">Java plugin</a> as an example.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It defines the directory <code>src/main/java</code> as the default source directory for compilation.</p>
</li>
<li>
<p>The output directory for compiled source code and other artifacts (like the JAR file) is <code>build</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By sticking to the default conventions, new developers to the project immediately know how to find their way around.
While those conventions can be reconfigured, it makes it harder to build script users and authors to manage the build logic and its outcome.
Try to stick to the default conventions as much as possible except if you need to adapt to the layout of a legacy project.
Refer to the reference page of the relevant plugin to learn about its default conventions.</p>
</div>
</div>
<div class="sect3">
<h4 id="always_define_a_settings_file"><a class="anchor" href="#always_define_a_settings_file"></a><a class="link" href="#always_define_a_settings_file">Always define a settings file</a></h4>
<div class="paragraph">
<p>Gradle tries to locate a <code>settings.gradle</code> (Groovy DSL) or a <code>settings.gradle.kts</code> (Kotlin DSL) file with every invocation of the build.
For that purpose, the runtime walks the hierarchy of the directory tree up to the root directory.
The algorithm stops searching as soon as it finds the settings file.</p>
</div>
<div class="paragraph">
<p>Always add a <code>settings.gradle</code> to the root directory of your build to avoid the initial performance impact.
This recommendation applies to single project builds as well as multi-project builds.
The file can either be empty or define the desired name of the project.</p>
</div>
<div class="paragraph">
<p>A typical Gradle project with a settings file look as such:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_sources"><a class="anchor" href="#sec:build_sources"></a><a class="link" href="#sec:build_sources">Use <code>buildSrc</code> to abstract imperative logic</a></h4>
<div class="paragraph">
<p>Complex build logic is usually a good candidate for being encapsulated either as custom task or binary plugin.
Custom task and plugin implementations should not live in the build script.
It is very convenient to use <code>buildSrc</code> for that purpose as long as the code does not need to be shared among multiple, independent projects.</p>
</div>
<div class="paragraph">
<p>The directory <code>buildSrc</code> is treated as an <a href="#composite_build_intro">included build</a>. Upon discovery of the directory, Gradle automatically compiles and tests this code and puts it in the classpath of your build script.
For multi-project builds there can be only one <code>buildSrc</code> directory, which has to sit in the root project directory.
<code>buildSrc</code> should be preferred over <a href="#sec:script_plugins">script plugins</a> as it is easier to maintain, refactor and test the code.</p>
</div>
<div class="paragraph">
<p><code>buildSrc</code> uses the same <a href="#javalayout">source code conventions</a> applicable to Java and Groovy projects.
It also provides direct access to the Gradle API. Additional dependencies can be declared in a dedicated <code>build.gradle</code> under <code>buildSrc</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 206. Custom buildSrc build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A typical project including <code>buildSrc</code> has the following layout.
Any code under <code>buildSrc</code> should use a package similar to application code.
Optionally, the <code>buildSrc</code> directory can host a build script if additional configuration is needed (e.g. to apply plugins or to declare dependencies).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> buildSrc
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> src
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> main
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> com
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> enterprise
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> Deploy.java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> DeploymentPlugin.java
<span class="error"></span><span class="error"></span><span class="error"></span>     <span class="error"></span><span class="error"></span><span class="error"></span> test
<span class="error"></span><span class="error"></span><span class="error"></span>         <span class="error"></span><span class="error"></span><span class="error"></span> java
<span class="error"></span><span class="error"></span><span class="error"></span>             <span class="error"></span><span class="error"></span><span class="error"></span> com
<span class="error"></span><span class="error"></span><span class="error"></span>                 <span class="error"></span><span class="error"></span><span class="error"></span> enterprise
<span class="error"></span><span class="error"></span><span class="error"></span>                     <span class="error"></span><span class="error"></span><span class="error"></span> DeploymentPluginTest.java
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 buildSrc
  build.gradle.kts
  src
      main
       java
           com
               enterprise
                   Deploy.java
                   DeploymentPlugin.java
      test
          java
              com
                  enterprise
                      DeploymentPluginTest.java
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A change in <code>buildSrc</code> causes the whole project to become out-of-date.
Thus, when making small incremental changes, the <a href="#sec:command_line_execution_options"><code>--no-rebuild</code> command-line option</a> is often helpful to get faster feedback.
Remember to run a full build regularly or at least when you&#8217;re done, though.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="declare_properties_in_gradle_properties_file"><a class="anchor" href="#declare_properties_in_gradle_properties_file"></a><a class="link" href="#declare_properties_in_gradle_properties_file">Declare properties in <code>gradle.properties</code> file</a></h4>
<div class="paragraph">
<p>In Gradle, properties can be defined in the build script, in a <code>gradle.properties</code> file or as parameters on the command line.</p>
</div>
<div class="paragraph">
<p>It&#8217;s common to declare properties on the command line for ad-hoc scenarios.
For example you may want to pass in a specific property value to control runtime behavior just for this one invocation of the build.
Properties in a build script can easily become a maintenance headache and convolute the build script logic.
The <code>gradle.properties</code> helps with keeping properties separate from the build script and should be explored as viable option.
It&#8217;s a good location for placing <a href="#sec:gradle_configuration_properties">properties that control the build environment</a>.</p>
</div>
<div class="paragraph">
<p>A typical project setup places the <code>gradle.properties</code> file in the root directory of the build.
Alternatively, the file can also live in the <code>GRADLE_USER_HOME</code> directory if you want to it apply to all builds on your machine.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
<span class="error"></span><span class="error"></span><span class="error"></span> build.gradle
<span class="error"></span><span class="error"></span><span class="error"></span> gradle.properties
<span class="error"></span><span class="error"></span><span class="error"></span> settings.gradle</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">.
 build.gradle.kts
 gradle.properties
 settings.gradle.kts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="avoid_overlapping_task_outputs"><a class="anchor" href="#avoid_overlapping_task_outputs"></a><a class="link" href="#avoid_overlapping_task_outputs">Avoid overlapping task outputs</a></h4>
<div class="paragraph">
<p>Tasks should define inputs and outputs to get the performance benefits of <a href="#sec:up_to_date_checks">incremental build functionality</a>.
When declaring the outputs of a task, make sure that the directory for writing outputs is unique among all the tasks in your project.</p>
</div>
<div class="paragraph">
<p>Intermingling or overwriting output files produced by different tasks compromises up-to-date checking causing slower builds.
In turn, these filesystem changes may prevent Gradle&#8217;s <a href="#build_cache">build cache</a> from properly identifying and caching what would otherwise be cacheable tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_gradle_distribution"><a class="anchor" href="#sec:custom_gradle_distribution"></a><a class="link" href="#sec:custom_gradle_distribution">Standardizing builds with a custom Gradle distribution</a></h4>
<div class="paragraph">
<p>Often enterprises want to standardize the build platform for all projects in the organization by defining common conventions or rules.
You can achieve that with the help of initialization scripts.
<a href="#init_scripts">Initialization scripts</a> make it extremely easy to apply build logic across all projects on a single machine.
For example, to declare a in-house repository and its credentials.</p>
</div>
<div class="paragraph">
<p>There are some drawbacks to the approach.
First of all, you will have to communicate the setup process across all developers in the company.
Furthermore, updating the initialization script logic uniformly can prove challenging.</p>
</div>
<div class="paragraph">
<p>Custom Gradle distributions are a practical solution to this very problem.
A custom Gradle distribution is comprised of the standard Gradle distribution plus one or many custom initialization scripts.
The initialization scripts come bundled with the distribution and are applied every time the build is run.
Developers only need to point their checked-in <a href="#gradle_wrapper">Wrapper</a> files to the URL of the custom Gradle distribution.</p>
</div>
<div class="paragraph">
<p>Custom Gradle distributions may also contain a <code>gradle.properties</code> file in the root of the distribution, which provide an organization-wide <a href="#sec:gradle_configuration_properties">set of properties that control the build environment</a>.</p>
</div>
<div class="paragraph">
<p>The following steps are typical for creating a custom Gradle distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement logic for downloading and repackaging a Gradle distribution.</p>
</li>
<li>
<p>Define one or many initialization scripts with the desired logic.</p>
</li>
<li>
<p>Bundle the initialization scripts with the Gradle distribution.</p>
</li>
<li>
<p>Upload the Gradle distribution archive to a HTTP server.</p>
</li>
<li>
<p>Change the Wrapper files of all projects to point to the URL of the custom Gradle distribution.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find a sample (<code>userguide/organizingGradleProjects/customGradleDistribution</code>) that covers steps one to three in the <code>samples</code> directory of the standard <code>-all</code> Gradle distribution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 207. Building a custom Gradle distribution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}

<span class="comment">// This is defined in buildSrc</span>
<span class="keyword">import</span> <span class="include">org.gradle.distribution.DownloadGradle</span>

version = <span class="string"><span class="delimiter">'</span><span class="content">0.1</span><span class="delimiter">'</span></span>

task downloadGradle(<span class="key">type</span>: DownloadGradle) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Downloads the Gradle distribution with a given version.</span><span class="delimiter">'</span></span>
    gradleVersion = <span class="string"><span class="delimiter">'</span><span class="content">4.6</span><span class="delimiter">'</span></span>
}

task createCustomGradleDistribution(<span class="key">type</span>: Zip) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Builds custom Gradle distribution and bundles initialization scripts.</span><span class="delimiter">'</span></span>

    dependsOn downloadGradle

    <span class="keyword">def</span> projectVersion = project.version
    archiveFileName = downloadGradle.gradleVersion.map { gradleVersion -&gt;
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mycompany-gradle-</span><span class="inline"><span class="inline-delimiter">${</span>gradleVersion<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>projectVersion<span class="inline-delimiter">}</span></span><span class="content">-bin.zip</span><span class="delimiter">&quot;</span></span>
    }

    from zipTree(downloadGradle.destinationFile)

    from(<span class="string"><span class="delimiter">'</span><span class="content">src/init.d</span><span class="delimiter">'</span></span>) {
        into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>downloadGradle.distributionNameBase.get()<span class="inline-delimiter">}</span></span><span class="content">/init.d</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authoring_maintainable_build_scripts"><a class="anchor" href="#authoring_maintainable_build_scripts"></a><a class="link" href="#authoring_maintainable_build_scripts">Best practices for authoring maintainable builds</a></h3>
<div class="paragraph">
<p>Gradle has a rich API with several approaches to creating build logic.
The associated flexibility can easily lead to unnecessarily complex builds with custom code commonly added directly to build scripts.
In this chapter, we present several best practices that will help you develop expressive and maintainable builds that are easy to use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The third-party <a href="https://github.com/nebula-plugins/gradle-lint-plugin">Gradle lint plugin</a> helps with enforcing a desired code style in build scripts if that&#8217;s something that would interest you.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:avoid_imperative_logic_in_scripts"><a class="anchor" href="#sec:avoid_imperative_logic_in_scripts"></a><a class="link" href="#sec:avoid_imperative_logic_in_scripts">Avoid using imperative logic in scripts</a></h4>
<div class="paragraph">
<p>The Gradle runtime does not enforce a specific style for build logic.
For that very reason, it&#8217;s easy to end up with a build script that mixes declarative DSL elements with imperative, procedural code.
Let&#8217;s talk about some concrete examples.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Declarative code:</em> Built-in, language-agnostic DSL elements (e.g. <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:dependencies(groovy.lang.Closure)">Project.dependencies{}</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">Project.repositories{}</a>) or DSLs exposed by plugins</p>
</li>
<li>
<p><em>Imperative code:</em> Conditional logic or very complex task action implementations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The end goal of every build script should be to only contain declarative language elements which makes the code easier to understand and maintain.
Imperative logic should live in binary plugins and which in turn is applied to the build script.
As a side product, you automatically enable your team to <a href="https://guides.gradle.org/designing-gradle-plugins/#reusable_logic_should_be_written_as_binary_plugin">reuse the plugin logic in other projects</a> if you publish the artifact to a binary repository.</p>
</div>
<div class="paragraph">
<p>The following sample build shows a negative example of using conditional logic directly in the build script.
While this code snippet is small, it is easy to imagine a full-blown build script using numerous procedural statements and the impact it would have on readability and maintainability.
By moving the code into a class <a href="https://guides.gradle.org/testing-gradle-plugins/">testability</a> also becomes a valid option.</p>
</div>
<div class="exampleblock">
<div class="title">Example 208. A build script using conditional logic to create a task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (project.findProperty(<span class="string"><span class="delimiter">'</span><span class="content">releaseEngineer</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>) {
    task release {
        doLast {
            logger.quiet <span class="string"><span class="delimiter">'</span><span class="content">Releasing to production...</span><span class="delimiter">'</span></span>

            <span class="comment">// release the artifact to production</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">if (project.findProperty(&quot;releaseEngineer&quot;) != null) {
    tasks.register(&quot;release&quot;) {
        doLast {
            logger.quiet(&quot;Releasing to production...&quot;)

            // release the artifact to production
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s compare the build script with the same logic implemented as a binary plugin.
The code might look more involved at first but clearly looks more like typical application code.
This particular plugin class lives in the <a href="#sec:build_sources"><code>buildSrc</code> directory</a> which makes it available to the build script automatically.</p>
</div>
<div class="exampleblock">
<div class="title">Example 209. A binary plugin implementing imperative logic</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">ReleasePlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.enterprise</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.Action</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Task</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskProvider</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ReleasePlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> RELEASE_ENG_ROLE_PROP = <span class="string"><span class="delimiter">&quot;</span><span class="content">releaseEngineer</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> RELEASE_TASK_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">release</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        <span class="keyword">if</span> (project.findProperty(RELEASE_ENG_ROLE_PROP) != <span class="predefined-constant">null</span>) {
            Task task = project.getTasks().create(RELEASE_TASK_NAME);

            task.doLast(<span class="keyword">new</span> <span class="predefined-type">Action</span>&lt;Task&gt;() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> execute(Task task) {
                    task.getLogger().quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Releasing to production...</span><span class="delimiter">&quot;</span></span>);

                    <span class="comment">// release the artifact to production</span>
                }
            });
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that the build logic has been translated into a plugin, you can apply it in the build script.
The build script has been shrunk from 8 lines of code to a one liner.</p>
</div>
<div class="exampleblock">
<div class="title">Example 210. A build script applying a plugin that encapsulates imperative logic</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.enterprise.release</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.enterprise.release&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:avoiding_gradle_internal_apis"><a class="anchor" href="#sec:avoiding_gradle_internal_apis"></a><a class="link" href="#sec:avoiding_gradle_internal_apis">Avoid using internal Gradle APIs</a></h4>
<div class="paragraph">
<p>Use of Gradle internal APIs in plugins and build scripts has the potential to break builds when either Gradle or plugins change.</p>
</div>
<div class="paragraph">
<p>The following packages are listed in the <a href="https://github.com/gradle/gradle/blob/180b9d3fa84b91768364c603380e82947437eda1/buildSrc/subprojects/configuration/src/main/kotlin/org/gradle/gradlebuild/public-api.kt">Gradle public API definition</a>, with the exception of any subpackage with <code>internal</code> in the name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org/gradle/*
org/gradle/api/**
org/gradle/authentication/**
org/gradle/buildinit/**
org/gradle/caching/**
org/gradle/concurrent/**
org/gradle/deployment/**
org/gradle/external/javadoc/**
org/gradle/ide/**
org/gradle/includedbuild/**
org/gradle/ivy/**
org/gradle/jvm/**
org/gradle/language/**
org/gradle/maven/**
org/gradle/nativeplatform/**
org/gradle/normalization/**
org/gradle/platform/**
org/gradle/play/**
org/gradle/plugin/devel/**
org/gradle/plugin/repository/*
org/gradle/plugin/use/*
org/gradle/plugin/management/*
org/gradle/plugins/**
org/gradle/process/**
org/gradle/testfixtures/**
org/gradle/testing/jacoco/**
org/gradle/tooling/**
org/gradle/swiftpm/**
org/gradle/model/**
org/gradle/testkit/**
org/gradle/testing/**
org/gradle/vcs/**
org/gradle/workers/**</pre>
</div>
</div>
<div class="sect4">
<h5 id="alternatives_for_oft_used_internal_apis"><a class="anchor" href="#alternatives_for_oft_used_internal_apis"></a><a class="link" href="#alternatives_for_oft_used_internal_apis">Alternatives for oft-used internal APIs</a></h5>
<div class="paragraph">
<p>To provide a nested DSL for your custom task, don&#8217;t use <code>org.gradle.internal.reflect.Instantiator</code>; use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> instead.
It may also be helpful to read <a href="#lazy_configuration">the chapter on lazy configuration</a>.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t use <code>org.gradle.api.internal.ConventionMapping</code>.
Use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> and/or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a>.
You can find an example for capturing user input to configure runtime behavior in the <a href="https://guides.gradle.org/implementing-gradle-plugins/#capturing_user_input_to_configure_plugin_runtime_behavior">implementing plugins guide</a>.</p>
</div>
<div class="paragraph">
<p>Instead of <code>org.gradle.internal.os.OperatingSystem</code>, use another method to detect operating system, such as <a href="https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/SystemUtils.html">Apache commons-lang SystemUtils</a> or <code>System.getProperty("os.name")</code>.</p>
</div>
<div class="paragraph">
<p>Use other collections or I/O frameworks instead of <code>org.gradle.util.CollectionUtils</code>, <code>org.gradle.util.GFileUtils</code>, and other classes under <code>org.gradle.util.*</code>.</p>
</div>
<div class="paragraph">
<p>Gradle plugin authors may find the Designing Gradle Plugins subsection on <a href="https://guides.gradle.org/designing-gradle-plugins/#restricting_the_plugin_implementation_to_gradle_s_public_api">restricting the plugin implementation to Gradle&#8217;s public API</a> helpful.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_tasks"><a class="anchor" href="#sec:declaring_tasks"></a><a class="link" href="#sec:declaring_tasks">Follow conventions when declaring tasks</a></h4>
<div class="paragraph">
<p>The task API gives a build author a lot of flexibility to declare tasks in a build script.
For optimal readability and maintainability follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The task type should be the only key-value pair within the parentheses after the task name.</p>
</li>
<li>
<p>Other configuration should be done within the task&#8217;s configuration block.</p>
</li>
<li>
<p><a href="#sec:hello_world">Task actions</a> added when declaring a task should only be declared with the methods <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doFirst(org.gradle.api.Action)">Task.doFirst{}</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doLast(org.gradle.api.Action)">Task.doLast{}</a>.</p>
</li>
<li>
<p>When declaring an ad-hoc task  one that doesn&#8217;t have an explicit type you should use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:doLast(org.gradle.api.Action)">Task.doLast{}</a> if you&#8217;re only declaring a single action.</p>
</li>
<li>
<p>A task should <a href="#sec:improving_task_discoverability">define a group and description</a>.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 211. Definition of tasks following best practices</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.enterprise.DocsGenerate</span>

task generateHtmlDocs(<span class="key">type</span>: DocsGenerate) {
    group = JavaBasePlugin.DOCUMENTATION_GROUP
    description = <span class="string"><span class="delimiter">'</span><span class="content">Generates the HTML documentation for this project.</span><span class="delimiter">'</span></span>
    title = <span class="string"><span class="delimiter">'</span><span class="content">Project docs</span><span class="delimiter">'</span></span>
    outputDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/docs</span><span class="delimiter">&quot;</span></span>)
}

task allDocs {
    group = JavaBasePlugin.DOCUMENTATION_GROUP
    description = <span class="string"><span class="delimiter">'</span><span class="content">Generates all documentation for this project.</span><span class="delimiter">'</span></span>
    dependsOn generateHtmlDocs

    doLast {
        logger.quiet(<span class="string"><span class="delimiter">'</span><span class="content">Generating all documentation...</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import com.enterprise.DocsGenerate

tasks.register&lt;DocsGenerate&gt;(&quot;generateHtmlDocs&quot;) {
    group = JavaBasePlugin.DOCUMENTATION_GROUP
    description = &quot;Generates the HTML documentation for this project.&quot;
    title = &quot;Project docs&quot;
    outputDir = file(&quot;$buildDir/docs&quot;)
}

tasks.register(&quot;allDocs&quot;) {
    group = JavaBasePlugin.DOCUMENTATION_GROUP
    description = &quot;Generates all documentation for this project.&quot;
    dependsOn(&quot;generateHtmlDocs&quot;)

    doLast {
        logger.quiet(&quot;Generating all documentation...&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:improving_task_discoverability"><a class="anchor" href="#sec:improving_task_discoverability"></a><a class="link" href="#sec:improving_task_discoverability">Improve task discoverability</a></h4>
<div class="paragraph">
<p>Even new users to a build should to be able to find crucial information quickly and effortlessly.
In Gradle you can declare a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">group</a> and a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:description">description</a> for any task of the build.
The <a href="#sec:listing_tasks">tasks report</a> uses the assigned values to organize and render the task for easy discoverability.
Assigning a group and description is most helpful for any task that you expect build users to invoke.</p>
</div>
<div class="paragraph">
<p>The example task <code>generateDocs</code> generates documentation for a project in the form of HTML pages.
The task should be organized underneath the bucket <code>Documentation</code>.
The description should express its intent.</p>
</div>
<div class="exampleblock">
<div class="title">Example 212. A task declaring the group and description</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task generateDocs {
    group = <span class="string"><span class="delimiter">'</span><span class="content">Documentation</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Generates the HTML documentation for this project.</span><span class="delimiter">'</span></span>

    doLast {
        <span class="comment">// action implementation</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;generateDocs&quot;) {
    group = &quot;Documentation&quot;
    description = &quot;Generates the HTML documentation for this project.&quot;

    doLast {
        // action implementation
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The output of the tasks report reflects the assigned values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; gradle tasks

&gt; Task :tasks

Documentation tasks
-------------------
generateDocs - Generates the HTML documentation for this project.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:minimize_logic_executed_configuration_phase"><a class="anchor" href="#sec:minimize_logic_executed_configuration_phase"></a><a class="link" href="#sec:minimize_logic_executed_configuration_phase">Minimize logic executed during the configuration phase</a></h4>
<div class="paragraph">
<p>It&#8217;s important for every build script developer to understand the different phases of the <a href="#build_lifecycle">build lifecycle</a> and their implications on performance and evaluation order of build logic.
During the configuration phase the project and its domain objects should be <em>configured</em>, whereas the execution phase only executes the actions of the task(s) requested on the command line plus their dependencies.
Be aware that any code that is not part of a task action will be executed with <em>every single run</em> of the build.
A <a href="https://scans.gradle.com/get-started">build scan</a> can help you with identifying the time spent during each of the lifecycle phases.
It&#8217;s an invaluable tool for diagnosing common performance issues.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following incantation of the anti-pattern described above.
In the build script you can see that the dependencies assigned to the configuration <code>printArtifactNames</code> are resolved outside of the task action.</p>
</div>
<div class="exampleblock">
<div class="title">Example 213. Executing logic during configuration should be avoided</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">log4j:log4j:1.2.17</span><span class="delimiter">'</span></span>
}

task printArtifactNames {
    <span class="comment">// always executed</span>
    <span class="keyword">def</span> libraryNames = configurations.compileClasspath.collect { <span class="local-variable">it</span>.name }

    doLast {
        logger.quiet libraryNames
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;log4j:log4j:1.2.17&quot;)
}

tasks.register(&quot;printArtifactNames&quot;) {
    // always executed
    val libraryNames = configurations.compileClasspath.get().map { it.name }

    doLast {
        logger.quiet(libraryNames.toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The code for resolving the dependencies should be moved into the task action to avoid the performance impact of resolving the dependencies before they are actually needed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 214. Executing logic during execution phase is preferred</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">log4j:log4j:1.2.17</span><span class="delimiter">'</span></span>
}

task printArtifactNames {
    doLast {
        <span class="keyword">def</span> libraryNames = configurations.compileClasspath.collect { <span class="local-variable">it</span>.name }
        logger.quiet libraryNames
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;log4j:log4j:1.2.17&quot;)
}

tasks.register(&quot;printArtifactNames&quot;) {
    doLast {
        val libraryNames = configurations.compileClasspath.get().map { it.name }
        logger.quiet(libraryNames.toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:avoiding_use_of_gradlebuild"><a class="anchor" href="#sec:avoiding_use_of_gradlebuild"></a><a class="link" href="#sec:avoiding_use_of_gradlebuild">Avoid using the <code>GradleBuild</code> task type</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.GradleBuild.html">GradleBuild</a> task type allows a build script to define a task that invokes another Gradle build.
The use of this type is generally discouraged.
There are some corner cases where the invoked build doesn&#8217;t expose the same runtime behavior as from the command line or through the Tooling API leading to unexpected results.</p>
</div>
<div class="paragraph">
<p>Usually, there&#8217;s a better way to model the requirement.
The appropriate approach depends on the problem at hand. Here&#8217;re some options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model the build as <a href="#multi_project_builds">multi-project build</a> if the intention is to execute tasks from different modules as unified build.</p>
</li>
<li>
<p>Use <a href="#composite_builds">composite builds</a> for projects that are physically separated but should occasionally be built as a single unit.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:avoiding_inter_project_configuration"><a class="anchor" href="#sec:avoiding_inter_project_configuration"></a><a class="link" href="#sec:avoiding_inter_project_configuration">Avoid inter-project configuration</a></h4>
<div class="paragraph">
<p>Gradle does not restrict build script authors from reaching into the domain model from one project into another one in a <a href="#multi_project_builds">multi-project build</a>.
Strongly-coupled projects hurts <a href="#sec:parallel_execution">build execution performance</a> as well as readability and maintainability of code.</p>
</div>
<div class="paragraph">
<p>The following practices should be avoided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explicitly depending on a task from another project via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:dependsOn(java.lang.Object[])">Task.dependsOn(java.lang.Object...)</a>.</p>
</li>
<li>
<p>Setting property values or calling methods on domain objects from another project.</p>
</li>
<li>
<p>Executing another portion of the build with <a href="#sec:avoiding_use_of_gradlebuild">GradleBuild</a>.</p>
</li>
<li>
<p>Declaring unnecessary <a href="#sub:project_dependencies">project dependencies</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:avoiding_passwords_in_plain_text"><a class="anchor" href="#sec:avoiding_passwords_in_plain_text"></a><a class="link" href="#sec:avoiding_passwords_in_plain_text">Avoid storing passwords in plain text</a></h4>
<div class="paragraph">
<p>Most builds need to consume one or many passwords.
The reasons for this need may vary.
Some builds need a password for publishing artifacts to a secured binary repository, other builds need a password for downloading binary files.
Passwords should always kept safe to prevent fraud.
Under no circumstance should you add the password to the build script in plain text or declare it in a <code>gradle.properties</code> file.
Those files usually live in a version control repository and can be viewed by anyone that has access to it.</p>
</div>
<div class="paragraph">
<p>Passwords should be stored in encrypted fashion. At the moment Gradle does not provide a built-in mechanism for encrypting, storing and accessing passwords.
A good solution for solving this problem is the <a href="https://github.com/etiennestuder/gradle-credentials-plugin">Gradle Credentials plugin</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lazy_configuration"><a class="anchor" href="#lazy_configuration"></a><a class="link" href="#lazy_configuration">Lazy Configuration</a></h3>
<div class="paragraph">
<p>As a build grows in complexity, knowing when and where a particular value is configured can become difficult to reason about. Gradle provides several ways to manage this complexity using <em>lazy configuration</em>.</p>
</div>
<div class="sect3">
<h4 id="lazy_properties"><a class="anchor" href="#lazy_properties"></a><a class="link" href="#lazy_properties">Lazy properties</a></h4>
<div class="paragraph">
<p>Gradle provides lazy properties, which delay the calculation of a propertys value until its actually required. These provide three main benefits to build script and plugin authors:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build authors can wire together Gradle models without worrying when a particular propertys value will be known. For example, you may want to set the input source files of a task based on the source directories property of an extension but the extension property value isn&#8217;t known until the build script or some other plugin configures them.</p>
</li>
<li>
<p>Build authors can wire an output property of a task into an input property of some other task and Gradle automatically determines the task dependencies based on this connection. Property instances carry information about which task, if any, produces their value. Build authors do not need to worry about keeping task dependencies in sync with configuration changes.</p>
</li>
<li>
<p>Build authors can avoid resource intensive work during the configuration phase, which can have a large impact on build performance. For example, when a configuration value comes from parsing a file but is only used when functional tests are run, using a property instance to capture this means that the file is parsed only when the functional tests are run, but not when, for example, <code>clean</code> is run.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gradle represents lazy properties with two interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> represents a value that can only be queried and cannot be changed.</p>
<div class="ulist">
<ul>
<li>
<p>Properties with these types are read-only.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#get--">Provider.get()</a> returns the current value of the property.</p>
</li>
<li>
<p>A <code>Provider</code> can be created from another <code>Provider</code> using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p>Many other types extend <code>Provider</code> and can be used where-ever a <code>Provider</code> is required.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> represents a value that can be queried and also changed.</p>
<div class="ulist">
<ul>
<li>
<p>Properties with these types are configurable.</p>
</li>
<li>
<p><code>Property</code> extends the <code>Provider</code> interface.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html#set-T-">Property.set(T)</a> specifies a value for the property, overwriting whatever value may have been present.</p>
</li>
<li>
<p>The method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-">Property.set(Provider)</a> specifies a <code>Provider</code> for the value for the property, overwriting whatever value may have been present. This allows you to wire together <code>Provider</code> and <code>Property</code> instances before the values are configured.</p>
</li>
<li>
<p>A <code>Property</code> can be created by the factory method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lazy properties are intended to be passed around and only queried when required. Usually, this will happen during the execution phase. For more information about the Gradle build phases, please see <a href="#sec:build_phases">Build Lifecycle</a>.</p>
</div>
<div class="paragraph">
<p>The following demonstrates a task with a configurable <code>greeting</code> property and a read-only <code>message</code> property that is derived from this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 215. Using a read-only and configurable property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A task that displays a greeting</span>
<span class="type">class</span> <span class="class">Greeting</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// A configurable greeting</span>
    <span class="annotation">@Input</span>
    <span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; greeting = project.objects.property(<span class="predefined-type">String</span>)

    <span class="comment">// Read-only property calculated from the greeting</span>
    <span class="annotation">@Internal</span>
    <span class="directive">final</span> <span class="predefined-type">Provider</span>&lt;<span class="predefined-type">String</span>&gt; message = greeting.map { <span class="local-variable">it</span> + <span class="string"><span class="delimiter">'</span><span class="content"> from Gradle</span><span class="delimiter">'</span></span> }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> printMessage() {
        logger.quiet(message.get())
    }
}

task greeting(<span class="key">type</span>: Greeting) {
    <span class="comment">// Configure the greeting</span>
    greeting.set(<span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>)

    <span class="comment">// Note that an assignment statement can be used instead of calling Property.set()</span>
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// A task that displays a greeting
open class Greeting : DefaultTask() {
    // Configurable by the user
    @Input
    val greeting: Property&lt;String&gt; = project.objects.property()

    // Read-only property calculated from the greeting
    @Internal
    val message: Provider&lt;String&gt; = greeting.map { it + &quot; from Gradle&quot; }

    @TaskAction
    fun printMessage() {
        logger.quiet(message.get())
    }
}

tasks.register&lt;Greeting&gt;(&quot;greeting&quot;) {
    // Configure the greeting
    greeting.set(&quot;Hi&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle greeting</code></strong></div>
<div class="content">
<pre>$ gradle greeting

&gt; Task :greeting
Hi from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Greeting</code> task has a property of type <code>Property&lt;String&gt;</code> to represent the configurable greeting and a property of type <code>Provider&lt;String&gt;</code> to represent the calculated, read-only, message. The message <code>Provider</code> is created from the greeting <code>Property</code> using the <code>map()</code> method, and so its value is kept up-to-date as the value of the greeting property changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Gradle Groovy DSL generates setter methods for each <code>Property</code>-typed property in a task implementation. These setter methods allow you to configure the property using the assignment (<code>=</code>) operator as a convenience.</p>
</div>
<div class="paragraph">
<p>Kotlin DSL conveniences will be added in a future release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="creating_property_provider"><a class="anchor" href="#creating_property_provider"></a><a class="link" href="#creating_property_provider">Creating a Property or Provider instance</a></h4>
<div class="paragraph">
<p>Neither <code>Provider</code> nor its subtypes such as <code>Property</code> are intended to be implemented by a build script or plugin author.  Gradle provides factory methods to create instances of these types instead. See the <a href="#lazy_configuration_reference">Quick Reference</a> for all of the types and factories available. In the previous example, we have seen 2 factory methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a> create a new <code>Property</code> instance. An instance of the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> can be referenced from <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#getObjects--">Project.getObjects()</a> or by injecting <code>ObjectFactory</code> through a constructor or method.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a> creates a new <code>Provider</code> from an existing <code>Provider</code> or <code>Property</code> instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>Provider</code> can also be created by the factory method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-java.util.concurrent.Callable-">ProviderFactory.provider(Callable)</a>. You should prefer using <code>map()</code> instead, as this has some useful benefits, which we will see later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are no specific methods create a provider using a <code>groovy.lang.Closure</code>. When writing a plugin or build script with Groovy, you can use the <code>map(Transformer)</code> method with a closure and Groovy will take care of converting the closure to a <code>Transformer</code>. You can see this in action in the previous example.</p>
</div>
<div class="paragraph">
<p>Similarly, when writing a plugin or build script with Kotlin, the Kotlin compiler will take care of converting a Kotlin function into a <code>Transformer</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="connecting_properties_together"><a class="anchor" href="#connecting_properties_together"></a><a class="link" href="#connecting_properties_together">Connecting properties together</a></h4>
<div class="paragraph">
<p>An important feature of lazy properties is that they can be connected together so that changes to one property are automatically reflected in other properties. Here&#8217;s an example where the property of a task is connected to a property of a project extension:</p>
</div>
<div class="exampleblock">
<div class="title">Example 216. Connecting properties together</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A project extension</span>
<span class="type">class</span> <span class="class">MessageExtension</span> {
    <span class="comment">// A configurable greeting</span>
    <span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; greeting

    <span class="annotation">@javax</span>.inject.Inject
    MessageExtension(<span class="predefined-type">ObjectFactory</span> objects) {
        greeting = objects.property(<span class="predefined-type">String</span>)
    }
}

<span class="comment">// A task that displays a greeting</span>
<span class="type">class</span> <span class="class">Greeting</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// A configurable greeting</span>
    <span class="annotation">@Input</span>
    <span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; greeting = project.objects.property(<span class="predefined-type">String</span>)

    <span class="comment">// Read-only property calculated from the greeting</span>
    <span class="annotation">@Internal</span>
    <span class="directive">final</span> <span class="predefined-type">Provider</span>&lt;<span class="predefined-type">String</span>&gt; message = greeting.map { <span class="local-variable">it</span> + <span class="string"><span class="delimiter">'</span><span class="content"> from Gradle</span><span class="delimiter">'</span></span> }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> printMessage() {
        logger.quiet(message.get())
    }
}

<span class="comment">// Create the project extension</span>
project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>, MessageExtension)

<span class="comment">// Create the greeting task</span>
task greeting(<span class="key">type</span>: Greeting) {
    <span class="comment">// Attach the greeting from the project extension</span>
    <span class="comment">// Note that the values of the project extension have not been configured yet</span>
    greeting.set(project.messages.greeting)

    <span class="comment">// Note that an assignment statement can be used instead of calling Property.set()</span>
    greeting = project.messages.greeting
}

messages {
    <span class="comment">// Configure the greeting on the extension</span>
    <span class="comment">// Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes</span>
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// A project extension
open class MessageExtension(objects: ObjectFactory) {
    // A configurable greeting
    val greeting: Property&lt;String&gt; = objects.property()
}

// A task that displays a greeting
open class Greeting : DefaultTask() {
    // Configurable by the user
    @Input
    val greeting: Property&lt;String&gt; = project.objects.property()

    // Read-only property calculated from the greeting
    @Internal
    val message: Provider&lt;String&gt; = greeting.map { it + &quot; from Gradle&quot; }

    @TaskAction
    fun printMessage() {
        logger.quiet(message.get())
    }
}

// Create the project extension
val messages = project.extensions.create(&quot;messages&quot;, MessageExtension::class)

// Create the greeting task
tasks.register&lt;Greeting&gt;(&quot;greeting&quot;) {
    // Attach the greeting from the project extension
    // Note that the values of the project extension have not been configured yet
    greeting.set(messages.greeting)
}

configure&lt;MessageExtension&gt; {
    // Configure the greeting on the extension
    // Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes
    greeting.set(&quot;Hi&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle greeting</code></strong></div>
<div class="content">
<pre>$ gradle greeting

&gt; Task :greeting
Hi from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>This example calls the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-">Property.set(Provider)</a> method to attach a <code>Provider</code> to a <code>Property</code> to supply the value of the property. In this case, the <code>Provider</code> happens to be a <code>Property</code> as well, but you can connect any <code>Provider</code> implementation, for example one created using <code>Provider.map()</code></p>
</div>
</div>
<div class="sect3">
<h4 id="working_with_files_in_lazy_properties"><a class="anchor" href="#working_with_files_in_lazy_properties"></a><a class="link" href="#working_with_files_in_lazy_properties">Working with files</a></h4>
<div class="paragraph">
<p>In <a href="#working_with_files">Working with Files</a>, we introduced four collection types for <code>File</code>-like objects:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. Collection of files recap</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Read-only Type</th>
<th class="tableblock halign-left valign-top">Configurable Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html">ConfigurableFileCollection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All of these types are also considered lazy types.</p>
</div>
<div class="paragraph">
<p>In this section, we are going to introduce more strongly typed models types to represent elements of the file system: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/Directory.html">Directory</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/RegularFile.html">RegularFile</a>. These types shouldn&#8217;t be confused with the standard Java <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> type as they are used to tell Gradle, and other people, that you expect more specific values such as a directory or a non-directory, regular file.</p>
</div>
<div class="paragraph">
<p>Gradle provides two specialized <code>Property</code> subtypes for dealing with values of these types: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/RegularFileProperty.html">RegularFileProperty</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html">DirectoryProperty</a>. <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> has methods to create these: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--">ObjectFactory.fileProperty()</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--">ObjectFactory.directoryProperty()</a>.</p>
</div>
<div class="paragraph">
<p>A <code>DirectoryProperty</code> can also be used to create a lazily evaluated <code>Provider</code> for a <code>Directory</code> and <code>RegularFile</code> via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-java.lang.String-">DirectoryProperty.dir(String)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#file-java.lang.String-">DirectoryProperty.file(String)</a> respectively. These methods create providers whose values are calculated relative to the location for the <code>DirectoryProperty</code> they were created from. The values returned from these providers will reflect changes to the <code>DirectoryProperty</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 217. Using file and directory property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// A task that generates a source file and writes the result to an output directory</span>
<span class="type">class</span> <span class="class">GenerateSource</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// The configuration file to use to generate the source file</span>
    <span class="annotation">@InputFile</span>
    <span class="directive">final</span> RegularFileProperty configFile = project.objects.fileProperty()

    <span class="comment">// The directory to write source files to</span>
    <span class="annotation">@OutputDirectory</span>
    <span class="directive">final</span> DirectoryProperty outputDir = project.objects.directoryProperty()

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">compile</span>() {
        <span class="keyword">def</span> inFile = configFile.get().asFile
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">configuration file = </span><span class="inline"><span class="inline-delimiter">$</span>inFile</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> dir = outputDir.get().asFile
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">output dir = </span><span class="inline"><span class="inline-delimiter">$</span>dir</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> className = inFile.text.trim()
        <span class="keyword">def</span> srcFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(dir, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>className<span class="inline-delimiter">}</span></span><span class="content">.java</span><span class="delimiter">&quot;</span></span>)
        srcFile.text = <span class="string"><span class="delimiter">&quot;</span><span class="content">public class </span><span class="inline"><span class="inline-delimiter">${</span>className<span class="inline-delimiter">}</span></span><span class="content"> { ... }</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="comment">// Create the source generation task</span>
task generate(<span class="key">type</span>: GenerateSource) {
    <span class="comment">// Configure the locations, relative to the project and build directories</span>
    configFile = project.layout.projectDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/config.txt</span><span class="delimiter">'</span></span>)
    outputDir = project.layout.buildDirectory.dir(<span class="string"><span class="delimiter">'</span><span class="content">generated-source</span><span class="delimiter">'</span></span>)

    <span class="comment">// Note that a `File` instance can be used as a convenience to set a location</span>
    configFile = file(<span class="string"><span class="delimiter">'</span><span class="content">src/config.txt</span><span class="delimiter">'</span></span>)
}

<span class="comment">// Change the build directory</span>
<span class="comment">// Don't need to reconfigure the task properties. These are automatically updated as the build directory changes</span>
buildDir = <span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// A task that generates a source file and writes the result to an output directory
open class GenerateSource @javax.inject.Inject constructor(objects: ObjectFactory): DefaultTask() {
    @InputFile
    val configFile: RegularFileProperty = objects.fileProperty()

    @OutputDirectory
    val outputDir: DirectoryProperty = objects.directoryProperty()

    @TaskAction
    fun compile() {
        val inFile = configFile.get().asFile
        logger.quiet(&quot;configuration file = $inFile&quot;)
        val dir = outputDir.get().asFile
        logger.quiet(&quot;output dir = $dir&quot;)
        val className = inFile.readText().trim()
        val srcFile = File(dir, &quot;${className}.java&quot;)
        srcFile.writeText(&quot;public class ${className} { }&quot;)
    }
}

// Create the source generation task
tasks.register&lt;GenerateSource&gt;(&quot;generate&quot;) {
    // Configure the locations, relative to the project and build directories
    configFile.set(project.layout.projectDirectory.file(&quot;src/config.txt&quot;))
    outputDir.set(project.layout.buildDirectory.dir(&quot;generated-source&quot;))
}

// Change the build directory
// Don't need to reconfigure the task properties. These are automatically updated as the build directory changes
buildDir = file(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="title">Output of <strong><code>gradle print</code></strong></div>
<div class="content">
<pre>$ gradle print

&gt; Task :generate
configuration file = /home/user/gradle/samples/groovy/src/config.txt
output dir = /home/user/gradle/samples/groovy/output/generated-source

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="title">Output of <strong><code>gradle print</code></strong></div>
<div class="content">
<pre>$ gradle print

&gt; Task :generate
configuration file = /home/user/gradle/samples/kotlin/src/config.txt
output dir = /home/user/gradle/samples/kotlin/output/generated-source

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates providers that represent locations in the project and build directories through <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#getLayout--">Project.getLayout()</a> with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#getBuildDirectory--">ProjectLayout.getBuildDirectory()</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--">ProjectLayout.getProjectDirectory()</a>.</p>
</div>
<div class="paragraph">
<p>To close the loop, note that a <code>DirectoryProperty</code>, or a simple <code>Directory</code>, can be turned into a <code>FileTree</code> that allows the files and directories contained in the directory to be queried with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--">DirectoryProperty.getAsFileTree()</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/Directory.html#getAsFileTree--">Directory.getAsFileTree()</a>. Moreover, from a <code>DirectoryProperty</code>, or a <code>Directory</code>, you can also create <code>FileCollection</code> instances containing a set of the files contained in the directory with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#files-java.lang.Object...-">DirectoryProperty.files(Object...)</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/Directory.html#files-java.lang.Object...-">Directory.files(Object...)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="working_with_task_dependencies_in_lazy_properties"><a class="anchor" href="#working_with_task_dependencies_in_lazy_properties"></a><a class="link" href="#working_with_task_dependencies_in_lazy_properties">Working with task inputs and outputs</a></h4>
<div class="paragraph">
<p>Many builds have several tasks connected together, where one task consumes the outputs of another task as an input. To make this work, we would need to configure each task to know where to look for its inputs and place its outputs, make sure that the producing and consuming tasks are configured with the same location, and attach task dependencies between the tasks. This can be cumbersome and brittle if any of these values are configurable by a user or configured by multiple plugins, as task properties need to be configured in the correct order and locations and task dependencies kept in sync as values change.</p>
</div>
<div class="paragraph">
<p>The <code>Property</code> API makes this easier by keeping track of not just the value for a property, which we have seen already, but also the task that produces the value, so that you don&#8217;t have to specify it as well. As an example consider the following plugin with a producer and consumer task which are wired together:</p>
</div>
<div class="exampleblock">
<div class="title">Example 218. Implicit task input file dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">final</span> RegularFileProperty outputFile = project.objects.fileProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@InputFile</span>
    <span class="directive">final</span> RegularFileProperty inputFile = project.objects.fileProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        <span class="keyword">def</span> input = inputFile.get().asFile
        <span class="keyword">def</span> message = input.text
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Read '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' from </span><span class="inline"><span class="inline-delimiter">${</span>input<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="keyword">def</span> producer = tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">producer</span><span class="delimiter">&quot;</span></span>, Producer)
<span class="keyword">def</span> consumer = tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">consumer</span><span class="delimiter">&quot;</span></span>, Consumer)

<span class="comment">// Connect the producer task output to the consumer task input</span>
<span class="comment">// Don't need to add a task dependency to the consumer task. This is automatically added</span>
consumer.configure {
    inputFile = producer.flatMap { <span class="local-variable">it</span>.outputFile }
}

<span class="comment">// Set values for the producer lazily</span>
<span class="comment">// Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes</span>
producer.configure {
    outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">file.txt</span><span class="delimiter">'</span></span>)
}

<span class="comment">// Change the build directory.</span>
<span class="comment">// Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes</span>
buildDir = <span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class Producer : DefaultTask() {
    @OutputFile
    val outputFile: RegularFileProperty = project.objects.fileProperty()

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

open class Consumer : DefaultTask() {
    @InputFile
    val inputFile: RegularFileProperty = project.objects.fileProperty()

    @TaskAction
    fun consume() {
        val input = inputFile.get().asFile
        val message = input.readText()
        logger.quiet(&quot;Read '${message}' from ${input}&quot;)
    }
}

val producer by tasks.registering(Producer::class)
val consumer by tasks.registering(Consumer::class)

consumer.configure {
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    inputFile.set(producer.flatMap { it.outputFile })
}

producer.configure {
    // Set values for the producer lazily
    // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
    outputFile.set(layout.buildDirectory.file(&quot;file.txt&quot;))
}

// Change the build directory.
// Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes
buildDir = file(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/groovy/output/file.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/groovy/output/file.txt

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/file.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/file.txt

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the task outputs and inputs are connected before any location is defined. The setters can be called at any time before the task is executed and the change will automatically affect all related input and output properties.</p>
</div>
<div class="paragraph">
<p>Another important thing to note in this example is the absence of any explicit task dependency. Task outputs represented using <code>Providers</code> keep track of which task produces their value, and using them as task inputs will implicitly add the correct task dependencies.</p>
</div>
<div class="paragraph">
<p>Implicit task dependencies also works for input properties that are not files.</p>
</div>
<div class="exampleblock">
<div class="title">Example 219. Implicit task input dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">final</span> RegularFileProperty outputFile = project.objects.fileProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">final</span> Property&lt;<span class="predefined-type">String</span>&gt; message = project.objects.property(<span class="predefined-type">String</span>)

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        logger.quiet(message.get())
    }
}

task producer(<span class="key">type</span>: Producer)
task consumer(<span class="key">type</span>: Consumer)

<span class="comment">// Connect the producer task output to the consumer task input</span>
<span class="comment">// Don't need to add a task dependency to the consumer task. This is automatically added</span>
consumer.message = producer.outputFile.map { <span class="local-variable">it</span>.asFile.text }

<span class="comment">// Set values for the producer lazily</span>
producer.outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">file.txt</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class Producer : DefaultTask() {
    @OutputFile
    val outputFile: RegularFileProperty = project.objects.fileProperty()

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

open class Consumer : DefaultTask() {
    @Input
    val message: Property&lt;String&gt; = project.objects.property(String::class)

    @TaskAction
    fun consume() {
        logger.quiet(message.get())
    }
}

val producer by tasks.registering(Producer::class) {
    // Set values for the producer lazily
    // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
    outputFile.set(layout.buildDirectory.file(&quot;file.txt&quot;))
}
val consumer by tasks.registering(Consumer::class) {
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    message.set(producer.map { it.outputFile.get().asFile.readText() })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/groovy/build/file.txt

&gt; Task :consumer
Hello, World!

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producer
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/build/file.txt

&gt; Task :consumer
Hello, World!

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="working_with_collections"><a class="anchor" href="#working_with_collections"></a><a class="link" href="#working_with_collections">Working with collections</a></h4>
<div class="paragraph">
<p>Gradle provides two lazy property types to help configure <code>Collection</code> properties. These work exactly like any other <code>Provider</code> and, just like file providers, they have additional modeling around them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>List</code> values the interface is called <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty</a>. You can create a new <code>ListProperty</code> using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-">ObjectFactory.listProperty(Class)</a> and specifying the element type.</p>
</li>
<li>
<p>For <code>Set</code> values the interface is called <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/SetProperty.html">SetProperty</a>. You can create a new <code>SetProperty</code> using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-">ObjectFactory.setProperty(Class)</a> and specifying the element type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This type of property allows you to overwrite the entire collection value with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-java.lang.Iterable-">HasMultipleValues.set(Iterable)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-org.gradle.api.provider.Provider-">HasMultipleValues.set(Provider)</a> or add new elements through the various <code>add</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-T-">HasMultipleValues.add(T)</a>: Add a single element to the collection</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-org.gradle.api.provider.Provider-">HasMultipleValues.add(Provider)</a>: Add a lazily calculated element to the collection</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasMultipleValues.html#addAll-org.gradle.api.provider.Provider-">HasMultipleValues.addAll(Provider)</a>: Add a lazily calculated collection of elements to the list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just like every <code>Provider</code>, the collection is calculated when <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#get--">Provider.get()</a> is called. The following example shows the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty</a> in action:</p>
</div>
<div class="exampleblock">
<div class="title">Example 220. List property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Producer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputFile</span>
    <span class="directive">final</span> RegularFileProperty outputFile = project.objects.fileProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> produce() {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> output = outputFile.get().asFile
        output.text = message
        logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wrote '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' to </span><span class="inline"><span class="inline-delimiter">${</span>output<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="type">class</span> <span class="class">Consumer</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@InputFiles</span>
    <span class="directive">final</span> ListProperty&lt;RegularFile&gt; inputFiles = project.objects.listProperty(RegularFile)

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> consume() {
        inputFiles.get().each { inputFile -&gt;
            <span class="keyword">def</span> input = inputFile.asFile
            <span class="keyword">def</span> message = input.text
            logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Read '</span><span class="inline"><span class="inline-delimiter">${</span>message<span class="inline-delimiter">}</span></span><span class="content">' from </span><span class="inline"><span class="inline-delimiter">${</span>input<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}

task producerOne(<span class="key">type</span>: Producer)
task producerTwo(<span class="key">type</span>: Producer)
task consumer(<span class="key">type</span>: Consumer)

<span class="comment">// Connect the producer task outputs to the consumer task input</span>
<span class="comment">// Don't need to add task dependencies to the consumer task. These are automatically added</span>
consumer.inputFiles.add(producerOne.outputFile)
consumer.inputFiles.add(producerTwo.outputFile)

<span class="comment">// Set values for the producer tasks lazily</span>
<span class="comment">// Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes</span>
producerOne.outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">one.txt</span><span class="delimiter">'</span></span>)
producerTwo.outputFile = layout.buildDirectory.file(<span class="string"><span class="delimiter">'</span><span class="content">two.txt</span><span class="delimiter">'</span></span>)

<span class="comment">// Change the build directory.</span>
<span class="comment">// Don't need to update the task properties. These are automatically updated as the build directory changes</span>
buildDir = <span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class Producer : DefaultTask() {
    @OutputFile
    val outputFile: RegularFileProperty = project.objects.fileProperty()

    @TaskAction
    fun produce() {
        val message = &quot;Hello, World!&quot;
        val output = outputFile.get().asFile
        output.writeText( message)
        logger.quiet(&quot;Wrote '${message}' to ${output}&quot;)
    }
}

open class Consumer : DefaultTask() {
    @InputFiles
    val inputFiles: ListProperty&lt;RegularFile&gt; = project.objects.listProperty(RegularFile::class)

    @TaskAction
    fun consume() {
        inputFiles.get().forEach { inputFile -&gt;
            val input = inputFile.asFile
            val message = input.readText()
            logger.quiet(&quot;Read '${message}' from ${input}&quot;)
        }
    }
}

val producerOne by tasks.registering(Producer::class)
val producerTwo by tasks.registering(Producer::class)
val consumer by tasks.registering(Consumer::class) {
    // Connect the producer task outputs to the consumer task input
    // Don't need to add task dependencies to the consumer task. These are automatically added
    inputFiles.add(producerOne.get().outputFile)
    inputFiles.add(producerTwo.get().outputFile)
}

// Set values for the producer tasks lazily
// Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes
producerOne { outputFile.set(layout.buildDirectory.file(&quot;one.txt&quot;)) }
producerTwo { outputFile.set(layout.buildDirectory.file(&quot;two.txt&quot;)) }

// Change the build directory.
// Don't need to update the task properties. These are automatically updated as the build directory changes
buildDir = file(&quot;output&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock multi-language-text lang-groovy">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producerOne
Wrote 'Hello, World!' to /home/user/gradle/samples/groovy/output/one.txt

&gt; Task :producerTwo
Wrote 'Hello, World!' to /home/user/gradle/samples/groovy/output/two.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/groovy/output/one.txt
Read 'Hello, World!' from /home/user/gradle/samples/groovy/output/two.txt

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
<div class="listingblock multi-language-text lang-kotlin">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle consumer

&gt; Task :producerOne
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/one.txt

&gt; Task :producerTwo
Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/two.txt

&gt; Task :consumer
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/one.txt
Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/two.txt

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="working_with_maps"><a class="anchor" href="#working_with_maps"></a><a class="link" href="#working_with_maps">Working with maps</a></h4>
<div class="paragraph">
<p>Gradle provides a lazy <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/MapProperty.html">MapProperty</a> type to allow <code>Map</code> values to be configured.
You can create a <code>MapProperty</code> instance using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#mapProperty-java.lang.Class-java.lang.Class-">ObjectFactory.mapProperty(Class, Class)</a>.</p>
</div>
<div class="paragraph">
<p>Similar to other property types, a <code>MapProperty</code> has a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/MapProperty.html#set-java.util.Map-">set()</a> method that you can use to specify the value for the property. There are some additional methods to allow entries with lazy values to be added to the map.</p>
</div>
<div class="exampleblock">
<div class="title">Example 221. Map property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Generator</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="directive">final</span> MapProperty&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; properties = project.objects.mapProperty(<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>)

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> generate() {
        properties.get().each { key, value -&gt;
            logger.quiet(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>key<span class="inline-delimiter">}</span></span><span class="content"> = </span><span class="inline"><span class="inline-delimiter">${</span>value<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}

<span class="comment">// Some values to be configured later</span>
<span class="keyword">def</span> b = <span class="integer">0</span>
<span class="keyword">def</span> c = <span class="integer">0</span>

task generate(<span class="key">type</span>: Generator) {
    properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
    <span class="comment">// Values have not been configured yet</span>
    properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>, providers.provider { b })
    properties.putAll(providers.provider { [<span class="key">c</span>: c, <span class="key">d</span>: c + <span class="integer">1</span>] })
}

<span class="comment">// Configure the values. There is no need to reconfigure the task</span>
b = <span class="integer">2</span>
c = <span class="integer">3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class Generator: DefaultTask() {
    @Input
    val properties: MapProperty&lt;String, Int&gt; = project.objects.mapProperty(String::class, Int::class)

    @TaskAction
    fun generate() {
        properties.get().forEach { entry -&gt;
            logger.quiet(&quot;${entry.key} = ${entry.value}&quot;)
        }
    }
}

// Some values to be configured later
var b = 0
var c = 0

tasks.register&lt;Generator&gt;(&quot;generate&quot;) {
    properties.put(&quot;a&quot;, 1)
    // Values have not been configured yet
    properties.put(&quot;b&quot;, providers.provider { b })
    properties.putAll(providers.provider { mapOf(&quot;c&quot; to c, &quot;d&quot; to c + 1) })
}

// Configure the values. There is no need to reconfigure the task
b = 2
c = 3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle consumer</code></strong></div>
<div class="content">
<pre>$ gradle generate

&gt; Task :generate
a = 1
b = 2
c = 3
d = 4

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="applying_conventions"><a class="anchor" href="#applying_conventions"></a><a class="link" href="#applying_conventions">Applying a convention to a property</a></h4>
<div class="paragraph">
<p>Often you want to apply some <em>convention</em>, or default value, to a property to be used if no value has been configured for the property. You can use the <code>convention()</code> method for this. This method accepts either a value or a <code>Provider</code> and this will be used as the value until some other value is configured.</p>
</div>
<div class="exampleblock">
<div class="title">Example 222. Property conventions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task show {
    doLast {
        <span class="keyword">def</span> property = objects.property(<span class="predefined-type">String</span>)

        <span class="comment">// Set a convention</span>
        property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">convention 1</span><span class="delimiter">&quot;</span></span>)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())

        <span class="comment">// Can replace the convention</span>
        property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">convention 2</span><span class="delimiter">&quot;</span></span>)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())

        property.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">// Once a value is set, the convention is ignored</span>
        property.convention(<span class="string"><span class="delimiter">&quot;</span><span class="content">ignored convention</span><span class="delimiter">&quot;</span></span>)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">value = </span><span class="delimiter">&quot;</span></span> + property.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;show&quot;) {
    doLast {
        val property = objects.property(String::class)

        property.convention(&quot;convention 1&quot;)
        println(&quot;value = &quot; + property.get())

        // Can replace the convention
        property.convention(&quot;convention 2&quot;)
        println(&quot;value = &quot; + property.get())

        property.set(&quot;value&quot;)
        // Once a value is set, the convention is ignored

        property.convention(&quot;ignored convention&quot;)
        println(&quot;value = &quot; + property.get())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle show</code></strong></div>
<div class="content">
<pre>$ gradle show

&gt; Task :show
value = convention 1
value = convention 2
value = value

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unmodifiable_property"><a class="anchor" href="#unmodifiable_property"></a><a class="link" href="#unmodifiable_property">Making a property unmodifiable</a></h4>
<div class="paragraph">
<p>Most properties of a task or project are intended to be configured by plugins or build scripts and then the resulting value used to do something useful. For example, a property that specifies the output directory for a compilation task may start off with a value specified by a plugin, then a build script might change the value to some custom location, then this value is used by the task when it runs.
However, once the task starts to run, we want to prevent any further change to the property. This way we avoid errors that result from different consumers, such as the task action or Gradle&#8217;s up-to-date checks or build caching or other tasks, using different values for the property.</p>
</div>
<div class="paragraph">
<p>Lazy properties provide several methods that you can use to disallow changes to their value once the value has been configured.
The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html#finalizeValue--">finalizeValue()</a> method calculates the <em>final</em> value for the property and prevents further changes to the property.
When the value of the property comes from a <code>Provider</code>, the provider is queried for its current value and the result becomes the final value for the property.
This final value replaces the provider and the property no longer tracks the value of the provider.
Calling this method also makes a property instance unmodifiable and any further attempts to change the value of the property will fail.
Gradle automatically makes the properties of a task final when the task starts execution.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/HasConfigurableValue.html#finalizeValueOnRead--">finalizeValueOnRead()</a> method is similar, except that the property&#8217;s final value is not calculated until the value
of the property is queried. In other words, this method calculates the final value lazily as required, whereas <code>finalizeValue()</code> calculates the final value eagerly.
This method can be used when the value may be expensive to calculate or may not have been configured yet, but you also want to ensure that all consumers of the property see the same value when they query the value.</p>
</div>
</div>
<div class="sect3">
<h4 id="lazy_configuration_faqs"><a class="anchor" href="#lazy_configuration_faqs"></a><a class="link" href="#lazy_configuration_faqs">Guidelines</a></h4>
<div class="paragraph">
<p>This section will introduce guidelines to be successful with the Provider API. To see those guidelines in action, have a look at <a href="https://github.com/gradle/gradle-site-plugin">gradle-site-plugin</a>, a Gradle plugin demonstrating established techniques and practices for plugin development.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> types have all of the overloads you need to query or configure a value. For this reason, you should follow the following guidelines:</p>
<div class="ulist">
<ul>
<li>
<p>For configurable properties, expose the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> directly through a single getter.</p>
</li>
<li>
<p>For non-configurable properties, expose an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> directly through a single getter.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Avoid simplifying calls like <code>obj.getProperty().get()</code> and <code>obj.getProperty().set(T)</code> in your code by introducing additional getters and setters.</p>
</li>
<li>
<p>When migrating your plugin to use providers, follow these guidelines:</p>
<div class="ulist">
<ul>
<li>
<p>If it&#8217;s a new property, expose it as a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> using a single getter.</p>
</li>
<li>
<p>If it&#8217;s incubating, change it to use a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> using a single getter.</p>
</li>
<li>
<p>If it&#8217;s a stable property, add a new <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a> and deprecate the old one. You should wire the old getter/setters into the new property as appropriate.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="lazy_configuration_roadmap"><a class="anchor" href="#lazy_configuration_roadmap"></a><a class="link" href="#lazy_configuration_roadmap">Future development</a></h4>
<div class="paragraph">
<p>Going forward, new properties will use the Provider API. The Groovy Gradle DSL adds convenience methods to make the use of Providers mostly transparent in build scripts. Existing tasks will have their existing "raw" properties replaced by Providers as needed and in a backwards compatible way. New tasks will be designed with the Provider API.</p>
</div>
</div>
<div class="sect3">
<h4 id="lazy_configuration_reference"><a class="anchor" href="#lazy_configuration_reference"></a><a class="link" href="#lazy_configuration_reference">Provider Files API Reference</a></h4>
<div class="paragraph">
<p>Use these types for <em>read-only</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a>&lt;<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/RegularFile.html">RegularFile</a>&gt;</dt>
<dd>
<p>File on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#file-java.lang.String-">DirectoryProperty.file(String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider</a>&lt;<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/Directory.html">Directory</a>&gt;</dt>
<dd>
<p>Directory on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-java.lang.String-">DirectoryProperty.dir(String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p>Unstructured collection of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(Object[])</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(Object...)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#files-java.lang.Object...-">DirectoryProperty.files(Object...)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a></dt>
<dd>
<p>Hierarchy of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(Object)</a> will produce a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a>, or you can use <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#zipTree-java.lang.Object-">Project.zipTree(Object)</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#tarTree-java.lang.Object-">Project.tarTree(Object)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--">DirectoryProperty.getAsFileTree()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="property_files_api_reference"><a class="anchor" href="#property_files_api_reference"></a><a class="link" href="#property_files_api_reference">Property Files API Reference</a></h4>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/RegularFileProperty.html">RegularFileProperty</a></dt>
<dd>
<p>File on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--">ObjectFactory.fileProperty()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html">DirectoryProperty</a></dt>
<dd>
<p>Directory on disk</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--">ObjectFactory.directoryProperty()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html">ConfigurableFileCollection</a></dt>
<dd>
<p>Unstructured collection of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--">ObjectFactory.fileCollection()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileTree.html">ConfigurableFileTree</a></dt>
<dd>
<p>Hierarchy of files</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--">ObjectFactory.fileTree()</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p>Hierarchy of source directories</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#sourceDirectorySet-java.lang.String-java.lang.String-">ObjectFactory.sourceDirectorySet(String, String)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="lazy_collections_api_reference"><a class="anchor" href="#lazy_collections_api_reference"></a><a class="link" href="#lazy_collections_api_reference">Lazy Collections API Reference</a></h4>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ListProperty.html">ListProperty&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is <code>List&lt;T&gt;</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-">ObjectFactory.listProperty(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/SetProperty.html">SetProperty&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is <code>Set&lt;T&gt;</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-">ObjectFactory.setProperty(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="lazy_objects_api_reference"><a class="anchor" href="#lazy_objects_api_reference"></a><a class="link" href="#lazy_objects_api_reference">Lazy Objects API Reference</a></h4>
<div class="paragraph">
<p>Use these types for <em>read only</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html">Provider&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is an instance of <code>T</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-">Provider.map(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-">Provider.flatMap(Transformer)</a>.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-java.util.concurrent.Callable-">ProviderFactory.provider(Callable)</a>. Always prefer one of the other factory methods over this method.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use these types for <em>mutable</em> values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/Property.html">Property&lt;T&gt;</a></dt>
<dd>
<p>a property whose value is an instance of <code>T</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">Factories</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-">ObjectFactory.property(Class)</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test_kit"><a class="anchor" href="#test_kit"></a><a class="link" href="#test_kit">Testing Build Logic with TestKit</a></h3>
<div class="paragraph">
<p>The Gradle TestKit (a.k.a. just TestKit) is a library that aids in testing Gradle plugins and build logic generally. At this time, it is focused on <em>functional</em> testing. That is, testing build logic by exercising it as part of a programmatically executed build. Over time, the TestKit will likely expand to facilitate other kinds of tests.</p>
</div>
<div class="sect3">
<h4 id="sec:testkit_usage"><a class="anchor" href="#sec:testkit_usage"></a><a class="link" href="#sec:testkit_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the TestKit, include the following in your plugin&#8217;s build:</p>
</div>
<div class="exampleblock">
<div class="title">Example 223. Declaring the TestKit dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation gradleTestKit()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(gradleTestKit())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>gradleTestKit()</code> encompasses the classes of the TestKit, as well as the <a href="#embedding">Gradle Tooling API client</a>. It does not include a version of <a href="http://junit.org">JUnit</a>, <a href="http://testng.org">TestNG</a>, or any other test execution framework. Such a dependency must be explicitly declared.</p>
</div>
<div class="exampleblock">
<div class="title">Example 224. Declaring the JUnit dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:functional_testing_with_the_gradle_runner"><a class="anchor" href="#sec:functional_testing_with_the_gradle_runner"></a><a class="link" href="#sec:functional_testing_with_the_gradle_runner">Functional testing with the Gradle runner</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html">GradleRunner</a> facilitates programmatically executing Gradle builds, and inspecting the result.</p>
</div>
<div class="paragraph">
<p>A contrived build can be created (e.g. programmatically, or from a template) that exercises the logic under test. The build can then be executed, potentially in a variety of ways (e.g. different combinations of tasks and arguments). The correctness of the logic can then be verified by asserting the following, potentially in combination:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The build&#8217;s output;</p>
</li>
<li>
<p>The build&#8217;s logging (i.e. console output);</p>
</li>
<li>
<p>The set of tasks executed by the build and their results (e.g. FAILED, UP-TO-DATE etc.).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After creating and configuring a runner instance, the build can be executed via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#build--">GradleRunner.build()</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#buildAndFail--">GradleRunner.buildAndFail()</a> methods depending on the anticipated outcome.</p>
</div>
<div class="paragraph">
<p>The following demonstrates the usage of the Gradle runner in a Java JUnit test:</p>
</div>
<div class="sect4">
<h5 id="example_using_gradlerunner_with_java_and_junit"><a class="anchor" href="#example_using_gradlerunner_with_java_and_junit"></a><a class="link" href="#example_using_gradlerunner_with_java_and_junit">Example: Using GradleRunner with Java and JUnit</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.BuildResult</span>;
<span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>;
<span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.rules.TemporaryFolder</span>;

<span class="keyword">import</span> <span class="include">java.io.BufferedWriter</span>;
<span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.io.FileWriter</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Collections</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertEquals</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertTrue</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> {
    <span class="annotation">@Rule</span> <span class="directive">public</span> <span class="directive">final</span> TemporaryFolder testProjectDir = <span class="keyword">new</span> TemporaryFolder();
    <span class="directive">private</span> <span class="predefined-type">File</span> settingsFile;
    <span class="directive">private</span> <span class="predefined-type">File</span> buildFile;

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setup() <span class="directive">throws</span> <span class="exception">IOException</span> {
        settingsFile = testProjectDir.newFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">settings.gradle</span><span class="delimiter">&quot;</span></span>);
        buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">build.gradle</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testHelloWorldTask() <span class="directive">throws</span> <span class="exception">IOException</span> {
        writeFile(settingsFile, <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> buildFileContent = <span class="string"><span class="delimiter">&quot;</span><span class="content">task helloWorld {</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">    doLast {</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">        println 'Hello world!'</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="delimiter">&quot;</span></span> +
                                  <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>;
        writeFile(buildFile, buildFileContent);

        BuildResult result = GradleRunner.create()
            .withProjectDir(testProjectDir.getRoot())
            .withArguments(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorld</span><span class="delimiter">&quot;</span></span>)
            .build();

        assertTrue(result.getOutput().contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span>));
        assertEquals(SUCCESS, result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).getOutcome());
    }

    <span class="directive">private</span> <span class="type">void</span> writeFile(<span class="predefined-type">File</span> destination, <span class="predefined-type">String</span> content) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">BufferedWriter</span> output = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> {
            output = <span class="keyword">new</span> <span class="predefined-type">BufferedWriter</span>(<span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(destination));
            output.write(content);
        } <span class="keyword">finally</span> {
            <span class="keyword">if</span> (output != <span class="predefined-constant">null</span>) {
                output.close();
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following demonstrates the usage of the Gradle runner in a Kotlin JUnit test:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_using_gradlerunner_with_kotlin_and_junit"><a class="anchor" href="#example_using_gradlerunner_with_kotlin_and_junit"></a><a class="link" href="#example_using_gradlerunner_with_kotlin_and_junit">Example: Using GradleRunner with Kotlin and JUnit</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.testkit.runner.BuildResult
import org.gradle.testkit.runner.GradleRunner
import org.gradle.testkit.runner.TaskOutcome
import org.junit.Assert.assertEquals
import org.junit.Assert.assertTrue
import org.junit.Before
import org.junit.Rule
import org.junit.Test
import org.junit.rules.TemporaryFolder
import kotlin.jvm.JvmField
import java.io.File

class BuildLogicFunctionalTest {

    @Rule @JvmField
    val testProjectDir: TemporaryFolder = TemporaryFolder()
    private lateinit var settingsFile: File
    private lateinit var buildFile: File

    @Before
    fun setup() {
        settingsFile = testProjectDir.newFile(&quot;settings.gradle.kts&quot;)
        buildFile = testProjectDir.newFile(&quot;build.gradle.kts&quot;)
    }

    @Test
    fun `test helloWorld task`() {

        settingsFile.writeText(&quot;&quot;&quot;
            rootProject.name = &quot;hello-world&quot;
        &quot;&quot;&quot;.trimIndent())
        buildFile.writeText(&quot;&quot;&quot;
            tasks.register(&quot;helloWorld&quot;) {
                doLast {
                    println(&quot;Hello world!&quot;)
                }
            }
        &quot;&quot;&quot;.trimIndent())

        val result = GradleRunner.create()
            .withProjectDir(testProjectDir.root)
            .withArguments(&quot;helloWorld&quot;)
            .build()

        assertTrue(result.output.contains(&quot;Hello world!&quot;))
        assertEquals(TaskOutcome.SUCCESS, result.task(&quot;:helloWorld&quot;)?.outcome)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any test execution framework can be used.</p>
</div>
<div class="paragraph">
<p>As Gradle build scripts can also be written in the Groovy programming language, it is often a productive choice to write Gradle functional tests in Groovy. Furthermore, it is recommended to use the (Groovy based) <a href="https://code.google.com/p/spock/">Spock test execution framework</a> as it offers many compelling features over the use of JUnit.</p>
</div>
<div class="paragraph">
<p>The following demonstrates the usage of the Gradle runner in a Groovy Spock test:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_using_gradlerunner_with_groovy_and_spock"><a class="anchor" href="#example_using_gradlerunner_with_groovy_and_spock"></a><a class="link" href="#example_using_gradlerunner_with_groovy_and_spock">Example: Using GradleRunner with Groovy and Spock</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.*</span>
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>
<span class="keyword">import</span> <span class="include">org.junit.rules.TemporaryFolder</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@Rule</span> TemporaryFolder testProjectDir = <span class="keyword">new</span> TemporaryFolder()
    <span class="predefined-type">File</span> settingsFile
    <span class="predefined-type">File</span> buildFile

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        settingsFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            task helloWorld {
                doLast {
                    println 'Hello world!'
                }
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withProjectDir(testProjectDir.root)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a common practice to implement any custom build logic (like plugins and task types) that is more complex in nature as external classes in a standalone project. The main driver behind this approach is bundle the compiled code into a JAR file, publish it to a binary repository and reuse it across various projects.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-classpath-injection"><a class="anchor" href="#sub:test-kit-classpath-injection"></a><a class="link" href="#sub:test-kit-classpath-injection">Getting the plugin-under-test into the test build</a></h4>
<div class="paragraph">
<p>The GradleRunner uses the <a href="#embedding">Tooling API</a> to execute builds. An implication of this is that the builds are executed in a separate process (i.e. not the same process executing the tests). Therefore, the test build does not share the same classpath or classloaders as the test process and the code under test is not implicitly available to the test build.</p>
</div>
<div class="paragraph">
<p>Starting with version 2.13, Gradle provides a conventional mechanism to inject the code under test into the test build.</p>
</div>
<div class="sect4">
<h5 id="sub:test-kit-automatic-classpath-injection"><a class="anchor" href="#sub:test-kit-automatic-classpath-injection"></a><a class="link" href="#sub:test-kit-automatic-classpath-injection">Automatic injection with the Java Gradle Plugin Development plugin</a></h5>
<div class="paragraph">
<p>The <a href="#java_gradle_plugin">Java Gradle Plugin development plugin</a> can be used to assist in the development of Gradle plugins. Starting with Gradle version 2.13, the plugin provides a direct integration with TestKit. When applied to a project, the plugin automatically adds the <code>gradleTestKit()</code> dependency to the test compile configuration. Furthermore, it automatically generates the classpath for the code under test and injects it via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath--">GradleRunner.withPluginClasspath()</a> for any <code>GradleRunner</code> instance created by the user. It&#8217;s important to note that the mechanism currently <em>only</em> works if the plugin under test is applied using the <a href="#sec:plugins_block">plugins DSL</a>. If the <a href="#sub:gradle-runner-gradle-version">target Gradle version</a> is prior to 2.8, automatic plugin classpath injection is not performed.</p>
</div>
<div class="paragraph">
<p>The plugin uses the following conventions for applying the TestKit dependency and injecting the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source set containing code under test: <code>sourceSets.main</code></p>
</li>
<li>
<p>Source set used for injecting the plugin classpath: <code>sourceSets.test</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any of these conventions can be reconfigured with the help of the class <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugin/devel/GradlePluginDevelopmentExtension.html">GradlePluginDevelopmentExtension</a>.</p>
</div>
<div class="paragraph">
<p>The following Groovy-based sample demonstrates how to automatically inject the plugin classpath by using the standard conventions applied by the Java Gradle Plugin Development plugin.</p>
</div>
<div class="exampleblock">
<div class="title">Example 225. Using the Java Gradle Development plugin for generating the plugin metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

dependencies {
    testImplementation(<span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.3-groovy-2.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">groovy-all</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
    `java-gradle-plugin`
}

dependencies {
    testImplementation(&quot;org.spockframework:spock-core:1.3-groovy-2.4&quot;) {
        exclude(module = &quot;groovy-all&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_automatically_injecting_the_code_under_test_classes_into_test_builds"><a class="anchor" href="#example_automatically_injecting_the_code_under_test_classes_into_test_builds"></a><a class="link" href="#example_automatically_injecting_the_code_under_test_classes_into_test_builds">Example: Automatically injecting the code under test classes into test builds</a></h5>
<div class="listingblock">
<div class="title">src/test/groovy/org/gradle/sample/BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    settingsFile &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">rootProject.name = 'hello-world'</span><span class="delimiter">&quot;</span></span>
    buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        plugins {
            id 'org.gradle.sample.helloworld'
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>

    <span class="key">when</span>:
    <span class="keyword">def</span> result = GradleRunner.create()
        .withProjectDir(testProjectDir.root)
        .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
        .withPluginClasspath()
        .build()

    <span class="key">then</span>:
    result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following build script demonstrates how to reconfigure the conventions provided by the Java Gradle Plugin Development plugin for a project that uses a custom <code>Test</code> source set.</p>
</div>
<div class="exampleblock">
<div class="title">Example 226. Reconfiguring the classpath generation conventions of the Java Gradle Development plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

sourceSets {
    functionalTest {
        groovy {
            srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/functionalTest/groovy</span><span class="delimiter">'</span></span>)
        }
        resources {
            srcDir file(<span class="string"><span class="delimiter">'</span><span class="content">src/functionalTest/resources</span><span class="delimiter">'</span></span>)
        }
        compileClasspath += sourceSets.main.output + configurations.testRuntimeClasspath
        runtimeClasspath += output + compileClasspath
    }
}

task functionalTest(<span class="key">type</span>: Test) {
    testClassesDirs = sourceSets.functionalTest.output.classesDirs
    classpath = sourceSets.functionalTest.runtimeClasspath
}

check.dependsOn functionalTest

gradlePlugin {
    testSourceSets sourceSets.functionalTest
}

dependencies {
    functionalTestImplementation(<span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.3-groovy-2.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">groovy-all</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
    `java-gradle-plugin`
}

sourceSets {
    create(&quot;functionalTest&quot;) {
        withConvention(GroovySourceSet::class) {
            groovy {
                srcDir(file(&quot;src/functionalTest/groovy&quot;))
            }
        }
        resources {
            srcDir(file(&quot;src/functionalTest/resources&quot;))
        }
        compileClasspath += sourceSets.main.get().output + configurations.testRuntimeClasspath
        runtimeClasspath += output + compileClasspath
    }
}

tasks.register&lt;Test&gt;(&quot;functionalTest&quot;) {
    testClassesDirs = sourceSets[&quot;functionalTest&quot;].output.classesDirs
    classpath = sourceSets[&quot;functionalTest&quot;].runtimeClasspath
}

tasks.check { dependsOn(tasks[&quot;functionalTest&quot;]) }

gradlePlugin {
    testSourceSets(sourceSets[&quot;functionalTest&quot;])
}

dependencies {
    &quot;functionalTestImplementation&quot;(&quot;org.spockframework:spock-core:1.3-groovy-2.4&quot;) {
        exclude(module = &quot;groovy-all&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:working_with_gradle_versions_prior_to_213"><a class="anchor" href="#sec:working_with_gradle_versions_prior_to_213"></a><a class="link" href="#sec:working_with_gradle_versions_prior_to_213">Working with Gradle versions prior to 2.13</a></h5>
<div class="paragraph">
<p>For earlier versions of Gradle (before 2.13), it is possible to manually make the code under test available via some extra configuration. The following example demonstrates having the build generate a file containing the implementation classpath of the code under test, and making it available at test runtime.</p>
</div>
<div class="exampleblock">
<div class="title">Example 227. Making the code under test classpath available to the tests</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Write the plugin's classpath to a file to share with the tests</span>
task createClasspathManifest {
    <span class="keyword">def</span> outputDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="delimiter">&quot;</span></span>)

    inputs.files(sourceSets.main.runtimeClasspath)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeClasspath</span><span class="delimiter">&quot;</span></span>)
        .withNormalizer(ClasspathNormalizer)
    outputs.dir(outputDir)
        .withPropertyName(<span class="string"><span class="delimiter">&quot;</span><span class="content">outputDir</span><span class="delimiter">&quot;</span></span>)

    doLast {
        outputDir.mkdirs()
        file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>outputDir</span><span class="content">/plugin-classpath.txt</span><span class="delimiter">&quot;</span></span>).text = sourceSets.main.runtimeClasspath.join(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="comment">// Add the classpath file to the test runtime classpath</span>
dependencies {
    testRuntimeOnly files(createClasspathManifest)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Write the plugin's classpath to a file to share with the tests
tasks.register(&quot;createClasspathManifest&quot;) {
    val outputDir = file(&quot;$buildDir/$name&quot;)

    inputs.files(sourceSets.main.get().runtimeClasspath)
        .withPropertyName(&quot;runtimeClasspath&quot;)
        .withNormalizer(ClasspathNormalizer::class)
    outputs.dir(outputDir)
        .withPropertyName(&quot;outputDir&quot;)

    doLast {
        outputDir.mkdirs()
        file(&quot;$outputDir/plugin-classpath.txt&quot;).writeText(sourceSets.main.get().runtimeClasspath.joinToString(&quot;\n&quot;))
    }
}

// Add the classpath file to the test runtime classpath
dependencies {
    testRuntimeOnly(files(tasks[&quot;createClasspathManifest&quot;]))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The tests can then read this value, and inject the classpath into the test build by using the method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath-java.lang.Iterable-">GradleRunner.withPluginClasspath(java.lang.Iterable)</a>. This classpath is then available to use to locate plugins in a test build via the plugins DSL (see <a href="#plugins">Plugins</a>). Applying plugins with the plugins DSL requires the definition of a plugin identifier. The following is an example (in Groovy) of doing this from within a Spock Framework <code>setup()</code> method, which is analogous to a JUnit <code>@Before</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_injecting_the_code_under_test_classes_into_test_builds"><a class="anchor" href="#example_injecting_the_code_under_test_classes_into_test_builds"></a><a class="link" href="#example_injecting_the_code_under_test_classes_into_test_builds">Example: Injecting the code under test classes into test builds</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/test/groovy/org/gradle/sample/BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="predefined-type">List</span>&lt;<span class="predefined-type">File</span>&gt; pluginClasspath

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)

        <span class="keyword">def</span> pluginClasspathResource = getClass().classLoader.findResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">plugin-classpath.txt</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">if</span> (pluginClasspathResource == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Did not find plugin classpath resource, run `testClasses` build task.</span><span class="delimiter">&quot;</span></span>)
        }

        pluginClasspath = pluginClasspathResource.readLines().collect { <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="local-variable">it</span>) }
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            plugins {
                id 'org.gradle.sample.helloworld'
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withProjectDir(testProjectDir.root)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .withPluginClasspath(pluginClasspath)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach works well when executing the functional tests as part of the Gradle build. When executing the functional tests from an IDE, there are extra considerations. Namely, the classpath manifest file points to the class files etc. generated by Gradle and not the IDE. This means that after making a change to the source of the code under test, the source must be recompiled by Gradle. Similarly, if the effective classpath of the code under test changes, the manifest must be regenerated. In either case, executing the <code>testClasses</code> task of the build will ensure that things are up to date.</p>
</div>
<div class="paragraph">
<p>Some IDEs provide a convenience option to delegate the "test classpath generation and execution" to the build. In IntelliJ you can find this option under Preferences&#8230;&#8203; &gt; Build, Execution, Deployment &gt; Build Tools &gt; Gradle &gt; Runner &gt; Delegate IDE build/run actions to gradle. Please consult the documentation of your IDE for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:working_with_gradle_versions_prior_to_28"><a class="anchor" href="#sec:working_with_gradle_versions_prior_to_28"></a><a class="link" href="#sec:working_with_gradle_versions_prior_to_28">Working with Gradle versions prior to 2.8</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath-java.lang.Iterable-">GradleRunner.withPluginClasspath(java.lang.Iterable)</a> method will not work when executing the build with a Gradle version earlier than 2.8 (see <a href="#sub:gradle-runner-gradle-version">The version used to test</a>), as this feature is not supported on such Gradle versions.</p>
</div>
<div class="paragraph">
<p>Instead, the code must be injected via the build script itself. The following sample demonstrates how this can be done.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_injecting_the_code_under_test_classes_into_test_builds_for_gradle_versions_prior_to_2_8"><a class="anchor" href="#example_injecting_the_code_under_test_classes_into_test_builds_for_gradle_versions_prior_to_2_8"></a><a class="link" href="#example_injecting_the_code_under_test_classes_into_test_builds_for_gradle_versions_prior_to_2_8">Example: Injecting the code under test classes into test builds for Gradle versions prior to 2.8</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/test/groovy/org/gradle/sample/BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="predefined-type">List</span>&lt;<span class="predefined-type">File</span>&gt; pluginClasspath

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)

        <span class="keyword">def</span> pluginClasspathResource = getClass().classLoader.findResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">plugin-classpath.txt</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">if</span> (pluginClasspathResource == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Did not find plugin classpath resource, run `testClasses` build task.</span><span class="delimiter">&quot;</span></span>)
        }

        pluginClasspath = pluginClasspathResource.readLines().collect { <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="local-variable">it</span>) }
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world task prints hello world with pre Gradle 2.8</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        <span class="keyword">def</span> classpathString = pluginClasspath
            .collect { <span class="local-variable">it</span>.absolutePath.replace(<span class="string"><span class="delimiter">'</span><span class="char">\\</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="char">\\</span><span class="char">\\</span><span class="delimiter">'</span></span>) } <span class="comment">// escape backslashes in Windows paths</span>
            .collect { <span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="content">'</span><span class="delimiter">&quot;</span></span> }
            .join(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)

        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            buildscript {
                dependencies {
                    classpath files(</span><span class="inline"><span class="inline-delimiter">$</span>classpathString</span><span class="content">)
                }
            }
            apply plugin: &quot;org.gradle.sample.helloworld&quot;
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withProjectDir(testProjectDir.root)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .withGradleVersion(<span class="string"><span class="delimiter">&quot;</span><span class="content">2.7</span><span class="delimiter">&quot;</span></span>)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling_the_build_environment"><a class="anchor" href="#sec:controlling_the_build_environment"></a><a class="link" href="#sec:controlling_the_build_environment">Controlling the build environment</a></h4>
<div class="paragraph">
<p>The runner executes the test builds in an isolated environment by specifying a dedicated "working directory" in a directory inside the JVM&#8217;s temp directory (i.e. the location specified by the <code>java.io.tmpdir</code> system property, typically <code>/tmp</code>). Any configuration in the default Gradle user home directory (e.g. <code>~/.gradle/gradle.properties</code>) is not used for test execution. The TestKit does not expose a mechanism for fine grained control of all aspects of the environment (e.g., JDK). Future versions of the TestKit will provide improved configuration options.</p>
</div>
<div class="paragraph">
<p>The TestKit uses dedicated daemon processes that are automatically shut down after test execution.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:gradle-runner-gradle-version"><a class="anchor" href="#sub:gradle-runner-gradle-version"></a><a class="link" href="#sub:gradle-runner-gradle-version">The Gradle version used to test</a></h4>
<div class="paragraph">
<p>The Gradle runner requires a Gradle distribution in order to execute the build. The TestKit does not depend on all of Gradle&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>By default, the runner will attempt to find a Gradle distribution based on where the <code>GradleRunner</code> class was loaded from. That is, it is expected that the class was loaded from a Gradle distribution, as is the case when using the <code>gradleTestKit()</code> dependency declaration.</p>
</div>
<div class="paragraph">
<p>When using the runner as part of tests <em>being executed by Gradle</em> (e.g. executing the <code>test</code> task of a plugin project), the same distribution used to execute the tests will be used by the runner. When using the runner as part of tests <em>being executed by an IDE</em>, the same distribution of Gradle that was used when importing the project will be used. This means that the plugin will effectively be tested with the same version of Gradle that it is being built with.</p>
</div>
<div class="paragraph">
<p>Alternatively, a different and specific version of Gradle to use can be specified by the any of the following <code>GradleRunner</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleVersion-java.lang.String-">GradleRunner.withGradleVersion(java.lang.String)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleInstallation-java.io.File-">GradleRunner.withGradleInstallation(java.io.File)</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withGradleDistribution-java.net.URI-">GradleRunner.withGradleDistribution(java.net.URI)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can potentially be used to test build logic across Gradle versions. The following demonstrates a cross-version compatibility test written as Groovy Spock test:</p>
</div>
<div class="sect4">
<h5 id="example_specifying_a_gradle_version_for_test_execution"><a class="anchor" href="#example_specifying_a_gradle_version_for_test_execution"></a><a class="link" href="#example_specifying_a_gradle_version_for_test_execution">Example: Specifying a Gradle version for test execution</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.testkit.runner.GradleRunner</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.gradle.testkit.runner.TaskOutcome.*</span>
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>
<span class="keyword">import</span> <span class="include">org.junit.rules.TemporaryFolder</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">spock.lang.Unroll</span>

<span class="type">class</span> <span class="class">BuildLogicFunctionalTest</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@Rule</span> <span class="directive">final</span> TemporaryFolder testProjectDir = <span class="keyword">new</span> TemporaryFolder()
    <span class="predefined-type">File</span> settingsFile
    <span class="predefined-type">File</span> buildFile

    <span class="keyword">def</span> <span class="function">setup</span>() {
        settingsFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>)
        buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
    }

    <span class="annotation">@Unroll</span>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">can execute hello world task with Gradle version #gradleVersion</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
            task helloWorld {
                doLast {
                    logger.quiet 'Hello world!'
                }
            }
        </span><span class="delimiter">&quot;&quot;&quot;</span></span>

        <span class="key">when</span>:
        <span class="keyword">def</span> result = GradleRunner.create()
            .withGradleVersion(gradleVersion)
            .withProjectDir(testProjectDir.root)
            .withArguments(<span class="string"><span class="delimiter">'</span><span class="content">helloWorld</span><span class="delimiter">'</span></span>)
            .build()

        <span class="key">then</span>:
        result.output.contains(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>)
        result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:helloWorld</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS

        <span class="key">where</span>:
        gradleVersion &lt;&lt; [<span class="string"><span class="delimiter">'</span><span class="content">2.6</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">2.7</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:test-kit-compatibility"><a class="anchor" href="#sub:test-kit-compatibility"></a><a class="link" href="#sub:test-kit-compatibility">Feature support when testing with different Gradle versions</a></h5>
<div class="paragraph">
<p>It is possible to use the GradleRunner to execute builds with Gradle 1.0 and later. However, some runner features are not supported on earlier versions. In such cases, the runner will throw an exception when attempting to use the feature.</p>
</div>
<div class="paragraph">
<p>The following table lists the features that are sensitive to the Gradle version being used.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. Gradle version compatibility</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Minimum Version</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting executed tasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting the executed tasks, using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/BuildResult.html#getTasks--">BuildResult.getTasks()</a> and similar methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-classpath-injection">Plugin classpath injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injecting the code under test via<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath-java.lang.Iterable-">GradleRunner.withPluginClasspath(java.lang.Iterable)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-debug">Inspecting build output in debug mode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspecting the build&#8217;s text output when run in debug mode, using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/BuildResult.html#getOutput--">BuildResult.getOutput()</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sub:test-kit-automatic-classpath-injection">Automatic plugin classpath injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injecting the code under test automatically via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withPluginClasspath--">GradleRunner.withPluginClasspath()</a> by applying the Java Gradle Plugin Development plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setting environment variables to be used by the build.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Gradle Tooling API only supports setting environment variables in later versions.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-debug"><a class="anchor" href="#sub:test-kit-debug"></a><a class="link" href="#sub:test-kit-debug">Debugging build logic</a></h4>
<div class="paragraph">
<p>The runner uses the <a href="#embedding">Tooling API</a> to execute builds. An implication of this is that the builds are executed in a separate process (i.e. not the same process executing the tests). Therefore, executing your <em>tests</em> in debug mode does not allow you to debug your build logic as you may expect. Any breakpoints set in your IDE will be not be tripped by the code being exercised by the test build.</p>
</div>
<div class="paragraph">
<p>The TestKit provides two different ways to enable the debug mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting <code>org.gradle.testkit.debug</code> system property to <code>true</code> for the JVM <em>using</em> the <code>GradleRunner</code> (i.e. not the build being executed with the runner);</p>
</li>
<li>
<p>Calling the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withDebug-boolean-">GradleRunner.withDebug(boolean)</a> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The system property approach can be used when it is desirable to enable debugging support without making an adhoc change to the runner configuration. Most IDEs offer the capability to set JVM system properties for test execution, and such a feature can be used to set this system property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub:test-kit-build-cache"><a class="anchor" href="#sub:test-kit-build-cache"></a><a class="link" href="#sub:test-kit-build-cache">Testing with the Build Cache</a></h4>
<div class="paragraph">
<p>To enable the <a href="#build_cache">Build Cache</a> in your tests, you can pass the <code>--build-cache</code> argument to <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html">GradleRunner</a> or use one of the other methods described in <a href="#sec:build_cache_enable">Enable the build cache</a>. You can then check for the task outcome <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/TaskOutcome.html#FROM_CACHE">TaskOutcome.FROM_CACHE</a> when your plugin&#8217;s custom task is cached. This outcome is only valid for Gradle 3.5 and newer.</p>
</div>
<div class="sect4">
<h5 id="example_testing_cacheable_tasks"><a class="anchor" href="#example_testing_cacheable_tasks"></a><a class="link" href="#example_testing_cacheable_tasks">Example: Testing cacheable tasks</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">cacheableTask is loaded from cache</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    buildFile &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        plugins {
            id 'org.gradle.sample.helloworld'
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>

    <span class="key">when</span>:
    <span class="keyword">def</span> result = runner()
        .withArguments( <span class="string"><span class="delimiter">'</span><span class="content">--build-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">cacheableTask</span><span class="delimiter">'</span></span>)
        .build()

    <span class="key">then</span>:
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:cacheableTask</span><span class="delimiter">&quot;</span></span>).outcome == SUCCESS

    <span class="key">when</span>:
    <span class="keyword">new</span> <span class="predefined-type">File</span>(testProjectDir.root, <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>).deleteDir()
    result = runner()
        .withArguments( <span class="string"><span class="delimiter">'</span><span class="content">--build-cache</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">cacheableTask</span><span class="delimiter">'</span></span>)
        .build()

    <span class="key">then</span>:
    result.task(<span class="string"><span class="delimiter">&quot;</span><span class="content">:cacheableTask</span><span class="delimiter">&quot;</span></span>).outcome == FROM_CACHE
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that TestKit re-uses a Gradle user home between tests (see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testkit/runner/GradleRunner.html#withTestKitDir-java.io.File-">GradleRunner.withTestKitDir(java.io.File)</a>) which contains the default location for the local build cache.
For testing with the build cache, the build cache directory should be cleaned between tests.
The easiest way to accomplish this is to configure the local build cache to use a temporary directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_clean_build_cache_between_tests"><a class="anchor" href="#example_clean_build_cache_between_tests"></a><a class="link" href="#example_clean_build_cache_between_tests">Example: Clean build cache between tests</a></h5>
<div class="listingblock">
<div class="title">BuildLogicFunctionalTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Rule</span> <span class="directive">final</span> TemporaryFolder testProjectDir = <span class="keyword">new</span> TemporaryFolder()
<span class="predefined-type">File</span> buildFile
<span class="predefined-type">File</span> localBuildCacheDirectory

<span class="keyword">def</span> <span class="function">setup</span>() {
    localBuildCacheDirectory = testProjectDir.newFolder(<span class="string"><span class="delimiter">'</span><span class="content">local-cache</span><span class="delimiter">'</span></span>)
    testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">settings.gradle</span><span class="delimiter">'</span></span>) &lt;&lt; <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
        buildCache {
            local {
                directory '</span><span class="inline"><span class="inline-delimiter">${</span>localBuildCacheDirectory.toURI()<span class="inline-delimiter">}</span></span><span class="content">'
            }
        }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    buildFile = testProjectDir.newFile(<span class="string"><span class="delimiter">'</span><span class="content">build.gradle</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ant"><a class="anchor" href="#ant"></a><a class="link" href="#ant">Using Ant from Gradle</a></h3>
<div class="paragraph">
<p>Gradle provides excellent integration with Ant. You can use individual Ant tasks or entire Ant builds in your Gradle builds. In fact, you will find that it&#8217;s far easier and more powerful using Ant tasks in a Gradle build script, than it is to use Ant&#8217;s XML format. You could even use Gradle simply as a powerful Ant task scripting tool.</p>
</div>
<div class="paragraph">
<p>Ant can be divided into two layers. The first layer is the Ant language. It provides the syntax for the <code>build.xml</code> file, the handling of the targets, special constructs like macrodefs, and so on. In other words, everything except the Ant tasks and types. Gradle understands this language, and allows you to import your Ant <code>build.xml</code> directly into a Gradle project. You can then use the targets of your Ant build as if they were Gradle tasks.</p>
</div>
<div class="paragraph">
<p>The second layer of Ant is its wealth of Ant tasks and types, like <code>javac</code>, <code>copy</code> or <code>jar</code>. For this layer Gradle provides integration simply by relying on Groovy, and the fantastic <code>AntBuilder</code>.</p>
</div>
<div class="paragraph">
<p>Finally, since build scripts are Groovy scripts, you can always execute an Ant build as an external process. Your build script may contain statements like: <code>"ant clean compile".execute()</code>.<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p>
</div>
<div class="paragraph">
<p>You can use Gradle&#8217;s Ant integration as a path for migrating your build from Ant to Gradle. For example, you could start by importing your existing Ant build. Then you could move your dependency declarations from the Ant script to your build file. Finally, you could move your tasks across to your build file, or replace them with some of Gradle&#8217;s plugins. This process can be done in parts over time, and you can have a working Gradle build during the entire process.</p>
</div>
<div class="sect3">
<h4 id="sec:using_ant_tasks"><a class="anchor" href="#sec:using_ant_tasks"></a><a class="link" href="#sec:using_ant_tasks">Using Ant tasks and types in your build</a></h4>
<div class="paragraph">
<p>In your build script, a property called <code>ant</code> is provided by Gradle. This is a reference to an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html">AntBuilder</a> instance. This <code>AntBuilder</code> is used to access Ant tasks, types and properties from your build script. There is a very simple mapping from Ant&#8217;s <code>build.xml</code> format to Groovy, which is explained below.</p>
</div>
<div class="paragraph">
<p>You execute an Ant task by calling a method on the <code>AntBuilder</code> instance. You use the task name as the method name. For example, you execute the Ant <code>echo</code> task by calling the <code>ant.echo()</code> method. The attributes of the Ant task are passed as Map parameters to the method. Below is an example of the <code>echo</code> task. Notice that we can also mix Groovy code and the Ant task markup. This can be extremely powerful.</p>
</div>
<div class="exampleblock">
<div class="title">Example 228. Using an Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        <span class="predefined-type">String</span> greeting = <span class="string"><span class="delimiter">'</span><span class="content">hello from Ant</span><span class="delimiter">'</span></span>
        ant.echo(<span class="key">message</span>: greeting)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        val greeting = &quot;hello from Ant&quot;
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;message&quot; to greeting)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
[ant:echo] hello from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You pass nested text to an Ant task by passing it as a parameter of the task method call. In this example, we pass the message for the <code>echo</code> task as nested text:</p>
</div>
<div class="exampleblock">
<div class="title">Example 229. Passing nested text to an Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task hello {
    doLast {
        ant.echo(<span class="string"><span class="delimiter">'</span><span class="content">hello from Ant</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;hello&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;message&quot; to &quot;hello from Ant&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
[ant:echo] hello from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You pass nested elements to an Ant task inside a closure. Nested elements are defined in the same way as tasks, by calling a method with the same name as the element we want to define.</p>
</div>
<div class="exampleblock">
<div class="title">Example 230. Passing nested elements to an Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task zip {
    doLast {
        ant.zip(<span class="key">destfile</span>: <span class="string"><span class="delimiter">'</span><span class="content">archive.zip</span><span class="delimiter">'</span></span>) {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>) {
                include(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">**.xml</span><span class="delimiter">'</span></span>)
                exclude(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">**.java</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;zip&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;zip&quot;(&quot;destfile&quot; to &quot;archive.zip&quot;) {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;) {
                    &quot;include&quot;(&quot;name&quot; to &quot;**.xml&quot;)
                    &quot;exclude&quot;(&quot;name&quot; to &quot;**.java&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can access Ant types in the same way that you access tasks, using the name of the type as the method name. The method call returns the Ant data type, which you can then use directly in your build script. In the following example, we create an Ant <code>path</code> object, then iterate over the contents of it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 231. Using an Ant type</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task list {
    doLast {
        <span class="keyword">def</span> path = ant.path {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span>)
        }
        path.list().each {
            println <span class="local-variable">it</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.apache.tools.ant.types.Path

tasks.register(&quot;list&quot;) {
    doLast {
        val path = ant.withGroovyBuilder {
            &quot;path&quot; {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;libs&quot;, &quot;includes&quot; to &quot;*.jar&quot;)
            }
        } as Path
        path.list().forEach {
            println(it)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>More information about <code>AntBuilder</code> can be found in 'Groovy in Action' 8.4 or at the <a href="https://groovy-lang.org/scripting-ant.html">Groovy Wiki</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:using_custom_ant_tasks"><a class="anchor" href="#sec:using_custom_ant_tasks"></a><a class="link" href="#sec:using_custom_ant_tasks">Using custom Ant tasks in your build</a></h5>
<div class="paragraph">
<p>To make custom tasks available in your build, you can use the <code>taskdef</code> (usually easier) or <code>typedef</code> Ant task, just as you would in a <code>build.xml</code> file. You can then refer to the custom Ant task as you would a built-in Ant task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 232. Using a custom Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task check {
    doLast {
        ant.taskdef(<span class="key">resource</span>: <span class="string"><span class="delimiter">'</span><span class="content">checkstyletask.properties</span><span class="delimiter">'</span></span>) {
            classpath {
                fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>, <span class="key">includes</span>: <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span>)
            }
        }
        ant.checkstyle(<span class="key">config</span>: <span class="string"><span class="delimiter">'</span><span class="content">checkstyle.xml</span><span class="delimiter">'</span></span>) {
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;check&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;resource&quot; to &quot;checkstyletask.properties&quot;) {
                &quot;classpath&quot; {
                    &quot;fileset&quot;(&quot;dir&quot; to &quot;libs&quot;, &quot;includes&quot; to &quot;*.jar&quot;)
                }
            }
            &quot;checkstyle&quot;(&quot;config&quot; to &quot;checkstyle.xml&quot;) {
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use Gradle&#8217;s dependency management to assemble the classpath to use for the custom tasks. To do this, you need to define a custom configuration for the classpath, then add some dependencies to the configuration. This is described in more detail in <a href="declaring_dependencies.html">Declaring Dependencies</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 233. Declaring the classpath for a custom Ant task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    pmd
}

dependencies {
    pmd <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">4.2.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val pmd = configurations.create(&quot;pmd&quot;)

dependencies {
    pmd(group = &quot;pmd&quot;, name = &quot;pmd&quot;, version = &quot;4.2.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the classpath configuration, use the <code>asPath</code> property of the custom configuration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 234. Using a custom Ant task and dependency management together</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task check {
    doLast {
        ant.taskdef(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>,
                    <span class="key">classname</span>: <span class="string"><span class="delimiter">'</span><span class="content">net.sourceforge.pmd.ant.PMDTask</span><span class="delimiter">'</span></span>,
                    <span class="key">classpath</span>: configurations.pmd.asPath)
        ant.pmd(<span class="key">shortFilenames</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
                <span class="key">failonruleviolation</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
                <span class="key">rulesetfiles</span>: file(<span class="string"><span class="delimiter">'</span><span class="content">pmd-rules.xml</span><span class="delimiter">'</span></span>).toURI().toString()) {
            formatter(<span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>, <span class="key">toConsole</span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>)
            fileset(<span class="key">dir</span>: <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;check&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;name&quot; to &quot;pmd&quot;,
                      &quot;classname&quot; to &quot;net.sourceforge.pmd.ant.PMDTask&quot;,
                      &quot;classpath&quot; to pmd.asPath)
            &quot;pmd&quot;(&quot;shortFilenames&quot; to true,
                  &quot;failonruleviolation&quot; to true,
                  &quot;rulesetfiles&quot; to file(&quot;pmd-rules.xml&quot;).toURI().toString()) {
                &quot;formatter&quot;(&quot;type&quot; to &quot;text&quot;, &quot;toConsole&quot; to &quot;true&quot;)
                &quot;fileset&quot;(&quot;dir&quot; to &quot;src&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:import_ant_build"><a class="anchor" href="#sec:import_ant_build"></a><a class="link" href="#sec:import_ant_build">Importing an Ant build</a></h4>
<div class="paragraph">
<p>You can use the <code>ant.importBuild()</code> method to import an Ant build into your Gradle project. When you import an Ant build, each Ant target is treated as a Gradle task. This means you can manipulate and execute the Ant targets in exactly the same way as Gradle tasks.</p>
</div>
<div class="exampleblock">
<div class="title">Example 235. Importing an Ant build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You can add a task which depends on an Ant target:</p>
</div>
<div class="exampleblock">
<div class="title">Example 236. Task that depends on Ant target</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

task intro(<span class="key">dependsOn</span>: hello) {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.register(&quot;intro&quot;) {
    dependsOn(&quot;hello&quot;)
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle intro</code></div>
<div class="content">
<pre>&gt; gradle intro

&gt; Task :hello
[ant:echo] Hello, from Ant

&gt; Task :intro
Hello, from Gradle

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can add behaviour to an Ant target:</p>
</div>
<div class="exampleblock">
<div class="title">Example 237. Adding behaviour to an Ant target</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

hello {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.named(&quot;hello&quot;) {
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
[ant:echo] Hello, from Ant
Hello, from Gradle

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible for an Ant target to depend on a Gradle task:</p>
</div>
<div class="exampleblock">
<div class="title">Example 238. Ant target that depends on Gradle task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild <span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>

task intro {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Hello, from Gradle</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;)

tasks.register(&quot;intro&quot;) {
    doLast {
        println(&quot;Hello, from Gradle&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">intro</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :intro
Hello, from Gradle

&gt; Task :hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes it may be necessary to rename the task generated for an Ant target to avoid a naming collision with existing Gradle tasks. To do this, use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html#importBuild-java.lang.Object-org.gradle.api.Transformer-">AntBuilder.importBuild(java.lang.Object, org.gradle.api.Transformer)</a> method.</p>
</div>
<div class="exampleblock">
<div class="title">Example 239. Renaming imported Ant targets</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.importBuild(<span class="string"><span class="delimiter">'</span><span class="content">build.xml</span><span class="delimiter">'</span></span>) { antTargetName -&gt;
    <span class="string"><span class="delimiter">'</span><span class="content">a-</span><span class="delimiter">'</span></span> + antTargetName
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.importBuild(&quot;build.xml&quot;) { antTargetName -&gt;
    &quot;a-&quot; + antTargetName
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo&gt;</span>Hello, from Ant<span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle a-hello</code></div>
<div class="content">
<pre>&gt; gradle a-hello

&gt; Task :a-hello
[ant:echo] Hello, from Ant

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Note that while the second argument to this method should be a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Transformer.html">Transformer</a>, when programming in Groovy we can simply use a closure instead of an anonymous inner class (or similar) due to <a href="http://mrhaki.blogspot.ie/2013/11/groovy-goodness-implicit-closure.html">Groovy&#8217;s support for automatically coercing closures to single-abstract-method types</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ant_properties"><a class="anchor" href="#sec:ant_properties"></a><a class="link" href="#sec:ant_properties">Ant properties and references</a></h4>
<div class="paragraph">
<p>There are several ways to set an Ant property, so that the property can be used by Ant tasks. You can set the property directly on the <code>AntBuilder</code> instance. The Ant properties are also available as a Map which you can change. You can also use the Ant <code>property</code> task. Below are some examples of how to do this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 240. Setting an Ant property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.buildDir = buildDir
ant.properties.buildDir = buildDir
ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">buildDir</span><span class="delimiter">'</span></span>] = buildDir
ant.property(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">buildDir</span><span class="delimiter">'</span></span>, <span class="key">location</span>: buildDir)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.setProperty(&quot;buildDir&quot;, buildDir)
ant.properties.set(&quot;buildDir&quot;, buildDir)
ant.properties[&quot;buildDir&quot;] = buildDir
ant.withGroovyBuilder {
    &quot;property&quot;(&quot;name&quot; to &quot;buildDir&quot;, &quot;location&quot; to &quot;buildDir&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Many Ant tasks set properties when they execute. There are several ways to get the value of these properties. You can get the property directly from the <code>AntBuilder</code> instance. The Ant properties are also available as a Map. Below are some examples.</p>
</div>
<div class="exampleblock">
<div class="title">Example 241. Getting an Ant property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antProp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a property defined in an Ant build</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println ant.antProp
println ant.properties.antProp
println ant.properties[<span class="string"><span class="delimiter">'</span><span class="content">antProp</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(ant.getProperty(&quot;antProp&quot;))
println(ant.properties.get(&quot;antProp&quot;))
println(ant.properties[&quot;antProp&quot;])</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several ways to set an Ant reference:</p>
</div>
<div class="exampleblock">
<div class="title">Example 242. Setting an Ant reference</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.path(<span class="key">id</span>: <span class="string"><span class="delimiter">'</span><span class="content">classpath</span><span class="delimiter">'</span></span>, <span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)
ant.references.classpath = ant.path(<span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)
ant.references[<span class="string"><span class="delimiter">'</span><span class="content">classpath</span><span class="delimiter">'</span></span>] = ant.path(<span class="key">location</span>: <span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.withGroovyBuilder { &quot;path&quot;(&quot;id&quot; to &quot;classpath&quot;, &quot;location&quot; to &quot;libs&quot;) }
ant.references.set(&quot;classpath&quot;, ant.withGroovyBuilder { &quot;path&quot;(&quot;location&quot; to &quot;libs&quot;) })
ant.references[&quot;classpath&quot;] = ant.withGroovyBuilder { &quot;path&quot;(&quot;location&quot; to &quot;libs&quot;) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;path</span> <span class="attribute-name">refid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several ways to get an Ant reference:</p>
</div>
<div class="exampleblock">
<div class="title">Example 243. Getting an Ant reference</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antPath</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">libs</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println ant.references.antPath
println ant.references[<span class="string"><span class="delimiter">'</span><span class="content">antPath</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">println(ant.references.get(&quot;antPath&quot;))
println(ant.references[&quot;antPath&quot;])</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:ant_logging"><a class="anchor" href="#sec:ant_logging"></a><a class="link" href="#sec:ant_logging">Ant logging</a></h4>
<div class="paragraph">
<p>Gradle maps Ant message priorities to Gradle log levels so that messages logged from Ant appear in the Gradle output. By default, these are mapped as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Ant message priority mapping</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ant Message Priority</th>
<th class="tableblock halign-left valign-top">Gradle Log Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>VERBOSE</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DEBUG</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>DEBUG</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DEBUG</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>INFO</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>INFO</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>WARN</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>WARN</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>ERROR</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ERROR</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="sec:fine_tuning_ant_logging"><a class="anchor" href="#sec:fine_tuning_ant_logging"></a><a class="link" href="#sec:fine_tuning_ant_logging">Fine tuning Ant logging</a></h5>
<div class="paragraph">
<p>The default mapping of Ant message priority to Gradle log level can sometimes be problematic. For example, there is no message priority that maps directly to the <code>LIFECYCLE</code> log level, which is the default for Gradle. Many Ant tasks log messages at the <em>INFO</em> priority, which means to expose those messages from Gradle, a build would have to be run with the log level set to <code>INFO</code>, potentially logging much more output than is desired.</p>
</div>
<div class="paragraph">
<p>Conversely, if an Ant task logs messages at too high of a level, to suppress those messages would require the build to be run at a higher log level, such as <code>QUIET</code>. However, this could result in other, desirable output being suppressed.</p>
</div>
<div class="paragraph">
<p>To help with this, Gradle allows the user to fine tune the Ant logging and control the mapping of message priority to Gradle log level. This is done by setting the priority that should map to the default Gradle <code>LIFECYCLE</code> log level using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html#setLifecycleLogLevel-java.lang.String-">AntBuilder.setLifecycleLogLevel(java.lang.String)</a> method. When this value is set, any Ant message logged at the configured priority or above will be logged at least at <code>LIFECYCLE</code>. Any Ant message logged below this priority will be logged at most at <code>INFO</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following changes the mapping such that Ant <em>INFO</em> priority messages are exposed at the <code>LIFECYCLE</code> log level.</p>
</div>
<div class="exampleblock">
<div class="title">Example 244. Fine tuning Ant logging</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.lifecycleLogLevel = <span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span>

task hello {
    doLast {
        ant.echo(<span class="key">level</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span>, <span class="key">message</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello from info priority!</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">ant.lifecycleLogLevel = AntBuilder.AntMessagePriority.INFO

tasks.register(&quot;hello&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;echo&quot;(&quot;level&quot; to &quot;info&quot;, &quot;message&quot; to &quot;hello from info priority!&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle hello</code></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
[ant:echo] hello from info priority!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, if the <code>lifecycleLogLevel</code> was set to <em>ERROR</em>, Ant messages logged at the <em>WARN</em> priority would no longer be logged at the <code>WARN</code> log level. They would now be logged at the <code>INFO</code> level and would be suppressed by default.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:ant_api"><a class="anchor" href="#sec:ant_api"></a><a class="link" href="#sec:ant_api">API</a></h4>
<div class="paragraph">
<p>The Ant integration is provided by <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/AntBuilder.html">AntBuilder</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:dependency_management"><a class="anchor" href="#part:dependency_management"></a><a class="link" href="#part:dependency_management">Dependency Management</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="learning_the_basics"><a class="anchor" href="#learning_the_basics"></a><a class="link" href="#learning_the_basics">Learning the Basics</a></h3>
<div class="sect3">
<h4 id="dependency_management_in_gradle"><a class="anchor" href="#dependency_management_in_gradle"></a><a class="link" href="#dependency_management_in_gradle">Dependency management in Gradle</a></h4>
<div class="sect4">
<h5 id="what_is_dependency_management"><a class="anchor" href="#what_is_dependency_management"></a><a class="link" href="#what_is_dependency_management">What is dependency management?</a></h5>
<div class="paragraph">
<p>Software projects rarely work in isolation. In most cases, a project relies on reusable functionality in the form of libraries or is broken up into individual components to compose a modularized system. Dependency management is a technique for declaring, resolving and using dependencies required by the project in an automated fashion.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For a general overview on the terms used throughout the user guide, refer to <a href="#">Dependency Management Terminology</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:dependency-mgmt-in-gradle"><a class="anchor" href="#sec:dependency-mgmt-in-gradle"></a><a class="link" href="#sec:dependency-mgmt-in-gradle">Dependency management in Gradle</a></h5>
<div class="paragraph">
<p>Gradle has built-in support for dependency management and lives up to the task of fulfilling typical scenarios encountered in modern software projects.
Well explore the main concepts with the help of an example project.
The illustration below should give you an rough overview on all the moving parts.</p>
</div>
<div class="imageblock inset">
<div class="content">
<img src="img/dependency-management-resolution.png" alt="dependency management resolution">
</div>
<div class="title">Figure 12. Dependency management big picture</div>
</div>
<div class="paragraph">
<p>The example project builds Java source code.
Some of the Java source files import classes from <a href="https://github.com/google/guava">Google Guava</a>, a open-source library providing a wealth of utility functionality.
In addition to Guava, the project needs the <a href="http://junit.org/junit5/">JUnit</a> libraries for compiling and executing test code.</p>
</div>
<div class="paragraph">
<p>Guava and JUnit represent the <em>dependencies</em> of this project.
A build script developer can <a href="#declaring-dependencies">declare dependencies</a> for different scopes e.g. just for compilation of source code or for executing tests.
In Gradle, the <a href="#sec:what-are-dependency-configurations">scope of a dependency</a> is called a <em>configuration</em>.
For a full overview, see the reference material on <a href="#sec:dependency-types">dependency types</a>.</p>
</div>
<div class="paragraph">
<p>Often times dependencies come in the form of <a href="#sub:terminology_module">modules</a>.
Youll need to tell Gradle where to find those modules so they can be consumed by the build.
The location for storing modules is called a <em>repository</em>.
By <a href="#declaring-repositories">declaring repositories</a> for a build, Gradle will know how to find and retrieve modules.
Repositories can come in different forms: as local directory or a remote repository.
The reference on <a href="#sec:repository-types">repository types</a> provides a broad coverage on this topic.</p>
</div>
<div class="paragraph">
<p>At runtime, Gradle will locate the declared dependencies if needed for operating a specific task.
The dependencies might need to be downloaded from a remote repository, retrieved from a local directory or requires another project to be built in a multi-project setting.
This process is called <em>dependency resolution</em>.
You can find a detailed discussion in <a href="#sec:how-gradle-downloads-deps">How Gradle downloads dependencies</a>.</p>
</div>
<div class="paragraph">
<p>Once resolved, the resolution mechanism <a href="#sec:dependency_cache">stores the underlying files of a dependency in a local cache</a>, also referred to as the <em>dependency cache</em>.
Future builds reuse the files stored in the cache to avoid unnecessary network calls.</p>
</div>
<div class="paragraph">
<p>Modules can provide additional metadata.
Metadata is the data that describes the module in more detail e.g. the coordinates for finding it in a repository, information about the project, or its authors.
As part of the metadata, a module can define that other modules are needed for it to work properly.
For example, the JUnit 5 platform module also requires the platform commons module.
Gradle automatically resolves those additional modules, so called <em>transitive dependencies</em>.
If needed, you can <a href="#">customize the behavior the handling of transitive dependencies</a> to your project&#8217;s requirements.</p>
</div>
<div class="paragraph">
<p>Projects with tens or hundreds of declared dependencies can easily suffer from dependency hell.
Gradle provides sufficient tooling to visualize, navigate and analyze the dependency graph of a project either with the help of a <a href="https://scans.gradle.com/get-started">build scan</a> or built-in tasks.
Learn more in <a href="#viewing-debugging-dependencies">Viewing and debugging dependencies</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-dependencies.png" alt="gradle core test build scan dependencies">
</div>
<div class="title">Figure 13. Build scan dependencies report</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-repositories"><a class="anchor" href="#declaring-repositories"></a><a class="link" href="#declaring-repositories">Declaring repositories</a></h4>
<div class="paragraph">
<p>Gradle can resolve dependencies from one or many repositories based on Maven, Ivy or flat directory formats.
Check out the <a href="#sec:repository-types">full reference on all types of repositories</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="sec:declaring_public_repository"><a class="anchor" href="#sec:declaring_public_repository"></a><a class="link" href="#sec:declaring_public_repository">Declaring a publicly-available repository</a></h5>
<div class="paragraph">
<p>Organizations building software may want to leverage public binary repositories to download and consume open source dependencies.
Popular public repositories include <a href="#sub:maven_central">Maven Central</a>, <a href="#sub:maven_jcenter">Bintray JCenter</a> and the <a href="#sub:maven_google">Google Android</a> repository.
Gradle provides built-in shorthand notations for these widely-used repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-shortcut-repositories.png" alt="dependency management shortcut repositories">
</div>
<div class="title">Figure 14. Declaring a repository with the help of shorthand notations</div>
</div>
<div class="paragraph">
<p>Under the covers Gradle resolves dependencies from the respective URL of the public repository defined by the shorthand notation.
All shorthand notations are available via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html">RepositoryHandler</a> API.
Alternatively, you can <a href="#sec:declaring_custom_repository">spell out the URL of the repository</a> for more fine-grained control.</p>
</div>
<div class="sect5">
<h6 id="sub:maven_central"><a class="anchor" href="#sub:maven_central"></a><a class="link" href="#sub:maven_central">Maven Central repository</a></h6>
<div class="paragraph">
<p>Maven Central is a popular repository hosting open source libraries for consumption by Java projects.</p>
</div>
<div class="paragraph">
<p>To declare the <a href="https://repo.maven.apache.org/maven2/">Maven Central repository</a> for your build add this to your script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 245. Adding central Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:maven_jcenter"><a class="anchor" href="#sub:maven_jcenter"></a><a class="link" href="#sub:maven_jcenter">JCenter Maven repository</a></h6>
<div class="paragraph">
<p><a href="http://bintray.com">Bintray</a>'s JCenter is an up-to-date collection of all popular Maven OSS artifacts, including artifacts published directly to Bintray.</p>
</div>
<div class="paragraph">
<p>To declare the <a href="https://jcenter.bintray.com">JCenter Maven repository</a> add this to your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 246. Adding Bintray&#8217;s JCenter Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:maven_google"><a class="anchor" href="#sub:maven_google"></a><a class="link" href="#sub:maven_google">Google Maven repository</a></h6>
<div class="paragraph">
<p>The Google repository hosts Android-specific artifacts including the Android SDK. For usage examples, see the <a href="https://developer.android.com/studio/build/dependencies.html#google-maven">relevant Android documentation</a>.</p>
</div>
<div class="paragraph">
<p>To declare the <a href="https://maven.google.com/">Google Maven repository</a> add this to your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 247. Adding Google Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    google()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    google()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring_custom_repository"><a class="anchor" href="#sec:declaring_custom_repository"></a><a class="link" href="#sec:declaring_custom_repository">Declaring a custom repository by URL</a></h5>
<div class="paragraph">
<p>Most enterprise projects set up a binary repository available only within an intranet.
In-house repositories enable teams to publish internal binaries, setup user management and security measure and ensure uptime and availability.
Specifying a custom URL is also helpful if you want to declare a less popular, but publicly-available repository.</p>
</div>
<div class="paragraph">
<p>Repositories with custom URLs can be specified as Maven or Ivy repositories by calling the corresponding methods available on the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.RepositoryHandler.html">RepositoryHandler</a> API.
Gradle supports other protocols than <code>http</code> or <code>https</code> as part of the custom URL e.g. <code>file</code>, <code>sftp</code> or <code>s3</code>.
For a full coverage see the <a href="#sec:repository-types">section on supported repository types</a>.</p>
</div>
<div class="paragraph">
<p>You can also <a href="#sub:defining_custom_pattern_layout_for_an_ivy_repository">define your own repository layout</a> by using <code>ivy { }</code> repositories as they are very flexible in terms of how modules are organised in a repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring_multiple_repositories"><a class="anchor" href="#sec:declaring_multiple_repositories"></a><a class="link" href="#sec:declaring_multiple_repositories">Declaring multiple repositories</a></h5>
<div class="paragraph">
<p>You can define more than one repository for resolving dependencies.
Declaring multiple repositories is helpful if some dependencies are only available in one repository but not the other.
You can mix any type of repository described in the <a href="#sec:repository-types">reference section</a>.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to declare various named and custom URL repositories for a project:</p>
</div>
<div class="exampleblock">
<div class="title">Example 248. Declaring multiple repositories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    jcenter()
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://maven.springframework.org/release</span><span class="delimiter">&quot;</span></span>
    }
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://maven.restlet.com</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    jcenter()
    maven {
        url = uri(&quot;https://maven.springframework.org/release&quot;)
    }
    maven {
        url = uri(&quot;https://maven.restlet.com&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The order of declaration determines how Gradle will check for dependencies at runtime.
If Gradle finds a module descriptor in a particular repository, it will attempt to download all of the artifacts for that module from <em>the same repository</em>.
You can learn more about the inner workings of <a href="#sec:how-gradle-downloads-deps">dependency downloads</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="strict_limitation_to_declared_repositories"><a class="anchor" href="#strict_limitation_to_declared_repositories"></a><a class="link" href="#strict_limitation_to_declared_repositories">Strict limitation to declared repositories</a></h6>
<div class="paragraph">
<p>Maven POM metadata can reference additional repositories.
These will be <em>ignored</em> by Gradle, which will only use the repositories declared in the build itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is a reproducibility safe-guard but also a security protection.
Without it, an updated version of a dependency could pull artifacts from anywhere into your build.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:repository-types"><a class="anchor" href="#sec:repository-types"></a><a class="link" href="#sec:repository-types">Supported repository types</a></h5>
<div class="paragraph">
<p>Gradle supports a wide range of sources for dependencies, both in terms of format and in terms of connectivity.
You may resolve dependencies from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Different formats</p>
<div class="ulist">
<ul>
<li>
<p>a <a href="#sec:maven_repo">Maven compatible</a> artifact repository (e.g: Maven Central, JCenter, &#8230;&#8203;)</p>
</li>
<li>
<p>an <a href="#sec:ivy_repositories">Ivy compatible</a> artifact repository (including custom layouts)</p>
</li>
<li>
<p><a href="#sub:flat_dir_resolver">local (flat) directories</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>with different connectivity</p>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:authentication_schemes">authenticated repositories</a></p>
</li>
<li>
<p>a wide variety of <a href="#sec:supported_transport_protocols">remote protocols</a> such as HTTPS, SFTP, AWS S3 and Google Cloud Storage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="sub:flat_dir_resolver"><a class="anchor" href="#sub:flat_dir_resolver"></a><a class="link" href="#sub:flat_dir_resolver">Flat directory repository</a></h6>
<div class="paragraph">
<p>Some projects might prefer to store dependencies on a shared drive or as part of the project source code instead of a binary repository product. If you want to use a (flat) filesystem directory as a repository, simply type:</p>
</div>
<div class="exampleblock">
<div class="title">Example 249. Flat repository resolver</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    flatDir {
        dirs <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span>
    }
    flatDir {
        dirs <span class="string"><span class="delimiter">'</span><span class="content">lib1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lib2</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    flatDir {
        dirs(&quot;lib&quot;)
    }
    flatDir {
        dirs(&quot;lib1&quot;, &quot;lib2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This adds repositories which look into one or more directories for finding dependencies.</p>
</div>
<div class="paragraph">
<p>This type of repository does not support any meta-data formats like Ivy XML or Maven POM files.
Instead, Gradle will dynamically generate a module descriptor (without any dependency information) based on the presence of artifacts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>As Gradle prefers to use modules whose descriptor has been created from real meta-data rather than being generated, flat directory repositories cannot be used to override artifacts with real meta-data from other repositories declared in the build.</p>
</div>
<div class="paragraph">
<p>For example, if Gradle finds only <code>jmxri-1.2.1.jar</code> in a flat directory repository, but <code>jmxri-1.2.1.pom</code> in another repository that supports meta-data, it will use the second repository to provide the module.</p>
</div>
<div class="paragraph">
<p>For the use case of overriding remote artifacts with local ones consider using an Ivy or Maven repository instead whose URL points to a local directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you only work with flat directory repositories you don&#8217;t need to set all attributes of a dependency.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:local-repos"><a class="anchor" href="#sub:local-repos"></a><a class="link" href="#sub:local-repos">Local repositories</a></h6>
<div class="paragraph">
<p>The following sections describe repositories format, Maven or Ivy.
These can be declared as local repositories, using a local filesystem path to access them.</p>
</div>
<div class="paragraph">
<p>The difference with the flat directory repository is that they do respect a format and contain metadata.</p>
</div>
<div class="paragraph">
<p>When such a repository is configured, Gradle totally bypasses its <a href="#sec:dependency_cache">dependency cache</a> for it as there can be no guarantee that content may not change between executions.
Because of that limitation, they can have a performance impact.</p>
</div>
<div class="paragraph">
<p>They also make build reproducibility much harder to achieve and their use should be limited to tinkering or prototyping.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:maven_repo"><a class="anchor" href="#sec:maven_repo"></a><a class="link" href="#sec:maven_repo">Maven repositories</a></h5>
<div class="paragraph">
<p>Many organizations host dependencies in an in-house Maven repository only accessible within the company&#8217;s network.
Gradle can declare Maven repositories by URL.</p>
</div>
<div class="paragraph">
<p>For adding a custom Maven repository you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 250. Adding custom Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:custom-maven-repo"><a class="anchor" href="#sub:custom-maven-repo"></a><a class="link" href="#sub:custom-maven-repo">Setting up composite Maven repositories</a></h6>
<div class="paragraph">
<p>Sometimes a repository will have the POMs published to one location, and the JARs and other artifacts published at another location.
To define such a repository, you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 251. Adding additional Maven repositories for JAR files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        <span class="comment">// Look for POMs and artifacts, such as JARs, here</span>
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo2.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        <span class="comment">// Look for artifacts here if not found at the above location</span>
        artifactUrls <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/jars</span><span class="delimiter">&quot;</span></span>
        artifactUrls <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/jars2</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        // Look for POMs and artifacts, such as JARs, here
        url = uri(&quot;http://repo2.mycompany.com/maven2&quot;)
        // Look for artifacts here if not found at the above location
        artifactUrls(&quot;http://repo.mycompany.com/jars&quot;)
        artifactUrls(&quot;http://repo.mycompany.com/jars2&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will look at the base <code>url</code> location for the POM and the JAR.
If the JAR can&#8217;t be found there, the extra <code>artifactUrls</code> are used to look for JARs.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:accessing_secured_maven_repositories"><a class="anchor" href="#sub:accessing_secured_maven_repositories"></a><a class="link" href="#sub:accessing_secured_maven_repositories">Accessing authenticated Maven repositories</a></h6>
<div class="paragraph">
<p>You can specify credentials for Maven repositories secured by different type of authentication.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:supported_transport_protocols">Supported repository transport protocols</a> for authentication options.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:maven_local"><a class="anchor" href="#sub:maven_local"></a><a class="link" href="#sub:maven_local">Local Maven repository</a></h6>
<div class="paragraph">
<p>Gradle can consume dependencies available in the <a href="https://maven.apache.org/guides/introduction/introduction-to-repositories.html">local Maven repository</a>.
Declaring this repository is beneficial for teams that publish to the local Maven repository with one project and consume the artifacts by Gradle in another project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Gradle stores resolved dependencies in <a href="#sec:dependency_cache">its own cache</a>.
A build does not need to declare the local Maven repository even if you resolve dependencies from a Maven-based, remote repository.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Before adding Maven local as a repository, you should <a href="#sec:case-for-maven-local">make sure this is really required</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To declare the local Maven cache as a repository add this to your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 252. Adding the local Maven cache as a repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenLocal()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenLocal()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle uses the same logic as Maven to identify the location of your local Maven cache.
If a local repository location is defined in a <code>settings.xml</code>, this location will be used.
The <code>settings.xml</code> in <code><em>USER_HOME</em>/.m2</code> takes precedence over the <code>settings.xml</code> in <code><em>M2_HOME</em>/conf</code>.
If no <code>settings.xml</code> is available, Gradle uses the default location <code><em>USER_HOME</em>/.m2/repository</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:case-for-maven-local"><a class="anchor" href="#sec:case-for-maven-local"></a><a class="link" href="#sec:case-for-maven-local">The case for mavenLocal()</a></h5>
<div class="paragraph">
<p>As a general advice, you should avoid adding <code>mavenLocal()</code> as a repository.
There are different issues with using <code>mavenLocal()</code> that you should be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven uses it as a cache, not a repository, meaning it can contain partial modules.</p>
<div class="ulist">
<ul>
<li>
<p>For example, if Maven never downloaded the source or javadoc files for a given module, Gradle will not find them either since it <a href="#sec:how-gradle-downloads-deps">searches for files in a single repository</a> once a module has been found.</p>
</li>
</ul>
</div>
</li>
<li>
<p>As a <a href="#sub:local-repos">local repository</a>, Gradle does not trust its content, because:</p>
<div class="ulist">
<ul>
<li>
<p>Origin of artifacts cannot be tracked, which is a correctness and security problem</p>
</li>
<li>
<p>Artifacts can be easily overwritten, which is a security, correctness and reproducibility problem</p>
</li>
</ul>
</div>
</li>
<li>
<p>To mitigate the fact that metadata and/or artifacts can be changed, Gradle does not perform <a href="#sec:dependency_cache">any caching</a> for <a href="#sub:local-repos">local repositories</a></p>
<div class="ulist">
<ul>
<li>
<p>As a consequence, your builds are slower</p>
</li>
<li>
<p>Given that order of repositories is important, adding <code>mavenLocal()</code> <em>first</em> means that all your builds are going to be slower</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are a few cases where you might have to use <code>mavenLocal()</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For interoperability with Maven</p>
<div class="ulist">
<ul>
<li>
<p>For example, project A is built with Maven, project B is built with Gradle, and you need to share the artifacts during development</p>
</li>
<li>
<p>It is <em>always</em> preferable to use an internal full featured repository instead</p>
</li>
<li>
<p>In case this is not possible, you should limit this to <em>local builds only</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>For interoperability with Gradle itself</p>
<div class="ulist">
<ul>
<li>
<p>In a multi-repository world, you want to check that changes to project A work with project B</p>
</li>
<li>
<p>It is preferable to use <a href="#composite_builds">composite builds</a> for this use case</p>
</li>
<li>
<p>If for some reason neither composite builds nor full featured repository are possible, then <code>mavenLocal()</code> is a last resort option</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After all these warnings, if you end up using <code>mavenLocal()</code>, consider combining it with <a href="#sec:repository-content-filtering">a repository filter</a>.
This will make sure it only provides what is expected and nothing else.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:ivy_repositories"><a class="anchor" href="#sec:ivy_repositories"></a><a class="link" href="#sec:ivy_repositories">Ivy repositories</a></h5>
<div class="paragraph">
<p>Organizations might decide to host dependencies in an in-house Ivy repository. Gradle can declare Ivy repositories by URL.</p>
</div>
<div class="sect5">
<h6 id="sub:defining_an_ivy_repository_with_a_standard_layout"><a class="anchor" href="#sub:defining_an_ivy_repository_with_a_standard_layout"></a><a class="link" href="#sub:defining_an_ivy_repository_with_a_standard_layout">Defining an Ivy repository with a standard layout</a></h6>
<div class="paragraph">
<p>To declare an Ivy repository using the standard layout no additional customization is needed. You just declare the URL.</p>
</div>
<div class="exampleblock">
<div class="title">Example 253. Ivy repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:defining_a_named_layout_for_an_ivy_repository"><a class="anchor" href="#sub:defining_a_named_layout_for_an_ivy_repository"></a><a class="link" href="#sub:defining_a_named_layout_for_an_ivy_repository">Defining a named layout for an Ivy repository</a></h6>
<div class="paragraph">
<p>You can specify that your repository conforms to the Ivy or Maven default layout by using a named layout.</p>
</div>
<div class="exampleblock">
<div class="title">Example 254. Ivy repository with named layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        layout <span class="string"><span class="delimiter">&quot;</span><span class="content">maven</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        layout(&quot;maven&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Valid named layout values are <code>'gradle'</code> (the default), <code>'maven'</code> and <code>'ivy'</code>. See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html#org.gradle.api.artifacts.repositories.IvyArtifactRepository:layout(java.lang.String)">IvyArtifactRepository.layout(java.lang.String)</a> in the API documentation for details of these named layouts.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:defining_custom_pattern_layout_for_an_ivy_repository"><a class="anchor" href="#sub:defining_custom_pattern_layout_for_an_ivy_repository"></a><a class="link" href="#sub:defining_custom_pattern_layout_for_an_ivy_repository">Defining custom pattern layout for an Ivy repository</a></h6>
<div class="paragraph">
<p>To define an Ivy repository with a non-standard layout, you can define a <em>pattern</em> layout for the repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 255. Ivy repository with pattern layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">[module]/[revision]/[type]/[artifact].[ext]</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;[module]/[revision]/[type]/[artifact].[ext]&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To define an Ivy repository which fetches Ivy files and artifacts from different locations, you can define separate patterns to use to locate the Ivy files and artifacts:</p>
</div>
<div class="paragraph">
<p>Each <code>artifact</code> or <code>ivy</code> specified for a repository adds an <em>additional</em> pattern to use. The patterns are used in the order that they are defined.</p>
</div>
<div class="exampleblock">
<div class="title">Example 256. Ivy repository with multiple custom patterns</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">3rd-party-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">company-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            ivy <span class="string"><span class="delimiter">&quot;</span><span class="content">ivy-files/[organisation]/[module]/[revision]/ivy.xml</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;3rd-party-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            artifact(&quot;company-artifacts/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            ivy(&quot;ivy-files/[organisation]/[module]/[revision]/ivy.xml&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Optionally, a repository with pattern layout can have its <code>'organisation'</code> part laid out in Maven style, with forward slashes replacing dots as separators. For example, the organisation <code>my.company</code> would then be represented as <code>my/company</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 257. Ivy repository with Maven compatible layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">&quot;</span><span class="content">[organisation]/[module]/[revision]/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span>
            m2compatible = <span class="predefined-constant">true</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        patternLayout {
            artifact(&quot;[organisation]/[module]/[revision]/[artifact]-[revision].[ext]&quot;)
            setM2compatible(true)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:accessing_secured_ivy_repositories"><a class="anchor" href="#sub:accessing_secured_ivy_repositories"></a><a class="link" href="#sub:accessing_secured_ivy_repositories">Accessing authenticated Ivy repositories</a></h6>
<div class="paragraph">
<p>You can specify credentials for Ivy repositories secured by basic authentication.</p>
</div>
<div class="exampleblock">
<div class="title">Example 258. Ivy repository with authentication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sec:supported_transport_protocols">Supported repository transport protocols</a> for authentication options.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:repository-content-filtering"><a class="anchor" href="#sec:repository-content-filtering"></a><a class="link" href="#sec:repository-content-filtering">Repository content filtering</a></h5>
<div class="paragraph">
<p>Gradle exposes an API to declare what a repository may or may not contain.
There are different use cases for it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>performance, when you know a dependency will never be found in a specific repository</p>
</li>
<li>
<p>security, by avoiding leaking what dependencies are used in a private project</p>
</li>
<li>
<p>reliability, when some repositories contain corrupted metadata or artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s even more important when considering that the declared order of repositories matter.</p>
</div>
<div class="sect5">
<h6 id="sec:declaring-repository-filter"><a class="anchor" href="#sec:declaring-repository-filter"></a><a class="link" href="#sec:declaring-repository-filter">Declaring a repository filter</a></h6>
<div class="exampleblock">
<div class="title">Example 259. Declaring repository contents</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        content {
            <span class="comment">// this repository *only* contains artifacts with group &quot;my.company&quot;</span>
            includeGroup <span class="string"><span class="delimiter">&quot;</span><span class="content">my.company</span><span class="delimiter">&quot;</span></span>
        }
    }
    jcenter {
        content {
            <span class="comment">// this repository contains everything BUT artifacts with group starting with &quot;my.company&quot;</span>
            excludeGroupByRegex <span class="string"><span class="delimiter">&quot;</span><span class="content">my</span><span class="char">\\</span><span class="content">.company.*</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        content {
            // this repository *only* contains artifacts with group &quot;my.company&quot;
            includeGroup(&quot;my.company&quot;)
        }
    }
    jcenter {
        content {
            // this repository contains everything BUT artifacts with group starting with &quot;my.company&quot;
            excludeGroupByRegex(&quot;my\\.company.*&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, repositories include everything and exclude nothing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you declare an include, then it excludes everything <em>but</em> what is included.</p>
</li>
<li>
<p>If you declare an exclude, then it includes everything <em>but</em> what is excluded.</p>
</li>
<li>
<p>If you declare both includes and excludes, then it includes only what is explicitly included and not excluded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to filter either by explicit <em>group</em>, <em>module</em> or <em>version</em>, either strictly or using regular expressions.
See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/repositories/RepositoryContentDescriptor.html">RepositoryContentDescriptor</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="declaring_content_exclusively_found_in_one_repository"><a class="anchor" href="#declaring_content_exclusively_found_in_one_repository"></a><a class="link" href="#declaring_content_exclusively_found_in_one_repository">Declaring content exclusively found in one repository</a></h6>
<div class="paragraph">
<p>Filters declared using the <a href="#sec:declaring-repository-filter">repository-level content filter</a> are not exclusive.
This means that declaring that a repository <em>includes</em> an artifact doesn&#8217;t mean that the other repositories can&#8217;t have it either: you must declare what every repository contains in extension.</p>
</div>
<div class="paragraph">
<p>Alternatively, Gradle provides an API which lets you declare that a repository <em>exclusively includes</em> an artifact.
If you do so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an artifact declared in a repository <em>can&#8217;t</em> be found in any other</p>
</li>
<li>
<p>exclusive repository content must be declared in extension (just like for <a href="#sec:declaring-repository-filter">repository-level content</a>)</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 260. Declaring exclusive repository contents</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    <span class="comment">// This repository will _not_ be searched for artifacts in my.company</span>
    <span class="comment">// despite being declared first</span>
    jcenter()
    exclusiveContent {
        forRepository {
            maven {
                url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
            }
        }
        filter {
            <span class="comment">// this repository *only* contains artifacts with group &quot;my.company&quot;</span>
            includeGroup <span class="string"><span class="delimiter">&quot;</span><span class="content">my.company</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    // This repository will _not_ be searched for artifacts in my.company
    // despite being declared first
    jcenter()
    exclusiveContent {
        forRepository {
            maven {
                url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
            }
        }
        filter {
            // this repository *only* contains artifacts with group &quot;my.company&quot;
            includeGroup(&quot;my.company&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is possible to filter either by explicit <em>group</em>, <em>module</em> or <em>version</em>, either strictly or using regular expressions.
See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/repositories/InclusiveRepositoryContentDescriptor.html">InclusiveRepositoryContentDescriptor</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="maven_repository_filtering"><a class="anchor" href="#maven_repository_filtering"></a><a class="link" href="#maven_repository_filtering">Maven repository filtering</a></h6>
<div class="paragraph">
<p>For <a href="#sec:maven_repo">Maven repositories</a>, it&#8217;s often the case that a repository would either contain releases or snapshots.
Gradle lets you declare what kind of artifacts are found in a repository using this DSL:</p>
</div>
<div class="exampleblock">
<div class="title">Example 261. Splitting snapshots and releases</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/releases</span><span class="delimiter">&quot;</span></span>
        mavenContent {
            releasesOnly()
        }
    }
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.mycompany.com/snapshots</span><span class="delimiter">&quot;</span></span>
        mavenContent {
            snapshotsOnly()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/releases&quot;)
        mavenContent {
            releasesOnly()
        }
    }
    maven {
        url = uri(&quot;https://repo.mycompany.com/snapshots&quot;)
        mavenContent {
            snapshotsOnly()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:supported_metadata_sources"><a class="anchor" href="#sec:supported_metadata_sources"></a><a class="link" href="#sec:supported_metadata_sources">Supported metadata sources</a></h5>
<div class="paragraph">
<p>When searching for a module in a repository, Gradle, by default, checks for <a href="#sec:supported-metadata-formats">supported metadata file formats</a> in that repository.
In a Maven repository, Gradle looks for a <code>.pom</code> file, in an ivy repository it looks for an <code>ivy.xml</code> file and in a flat directory repository it looks directly for <code>.jar</code> files as it does not expect any metadata.
Starting with 5.0, Gradle also looks for <code>.module</code> (Gradle module metadata) files.</p>
</div>
<div class="paragraph">
<p>However, if you define a customized repository you might want to configure this behavior.
For example, you can define a Maven repository without <code>.pom</code> files but only jars.
To do so, you can configure <em>metadata sources</em> for any repository.</p>
</div>
<div class="exampleblock">
<div class="title">Example 262. Maven repository that supports artifacts without metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        metadataSources {
            mavenPom()
            artifact()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        metadataSources {
            mavenPom()
            artifact()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can specify multiple sources to tell Gradle to keep looking if a file was not found.
In that case, the order of checking for sources is predefined.</p>
</div>
<div class="paragraph">
<p>The following metadata sources are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. Repository transport protocols</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metadata source</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Order</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Ivy / flat dir</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradleMetadata()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for Gradle <code>.module</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1st</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mavenPom()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for Maven <code>.pom</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ivyDescriptor()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look for <code>ivy.xml</code> files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2nd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifact()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Look directly for artifact</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The defaults for Ivy and Maven repositories change with Gradle 6.0. Before 6.0, <code>artifact()</code> was included in the defaults.
Leading to some inefficiency when modules are missing completely.
To restore this behavior, for example, for Maven central you can use <code>mavenCentral { metadataSources { mavenPom(); artifact() } }</code>.
In a similar way, you can opt into the new behavior in older Gradle versions using <code>mavenCentral { metadataSources { mavenPom() } }</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since Gradle 5.3, when parsing a metadata file, be it Ivy or Maven, Gradle will look for a marker indicating that a matching Gradle Module Metadata files exists.
If it is found, it will be used instead of the Ivy or Maven file.</p>
</div>
<div class="paragraph">
<p>Starting with Gradle 5.6, you can disable this behavior by adding <code>ignoreGradleMetadataRedirection()</code> to the metadataSources declaration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 263. Maven repository that does not use gradle metadata redirection</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        metadataSources {
            mavenPom()
            artifact()
            ignoreGradleMetadataRedirection()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        metadataSources {
            mavenPom()
            artifact()
            ignoreGradleMetadataRedirection()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:plugin-vs-build-repos"><a class="anchor" href="#sec:plugin-vs-build-repos"></a><a class="link" href="#sec:plugin-vs-build-repos">Plugin repositories vs. build repositories</a></h5>
<div class="paragraph">
<p>Gradle will use repositories at two different phases during your build.</p>
</div>
<div class="paragraph">
<p>The first phase is when <a href="#sec:build_phases">configuring your build</a> and loading the plugins it applied.
To do that Gradle will use a special set of repositories.</p>
</div>
<div class="paragraph">
<p>The second phase is during dependency resolution.
At this point Gradle will use the repositories declared in your project, as shown in the previous sections.</p>
</div>
<div class="sect5">
<h6 id="sub:plugin-repos"><a class="anchor" href="#sub:plugin-repos"></a><a class="link" href="#sub:plugin-repos">Plugin repositories</a></h6>
<div class="paragraph">
<p>By default Gradle will use the <a href="http://plugins.gradle.org">Gradle plugin portal</a> to look for plugins.</p>
</div>
<div class="paragraph">
<p>However, for different reasons, there are plugins available in other, public or not, repositories.
When a build requires one of these plugins, additional repositories need to be specified so that Gradle knows where to search.</p>
</div>
<div class="paragraph">
<p>As the way to declare the repositories and what they are expected to contain depends on the way the plugin is applied, it is best to refer to <a href="#sec:custom_plugin_repositories">Custom Plugin Repositories</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:supported_transport_protocols"><a class="anchor" href="#sec:supported_transport_protocols"></a><a class="link" href="#sec:supported_transport_protocols">Supported repository transport protocols</a></h5>
<div class="paragraph">
<p>Maven and Ivy repositories support the use of various transport protocols. At the moment the following protocols are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. Repository transport protocols</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Credential types</th>
<th class="tableblock halign-left valign-top">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sftp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username/password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:authentication_schemes">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access key/secret key/session token or Environment variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:s3-repositories">Documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/application-default-credentials">default application credentials</a> sourced from well known files, Environment variables etc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:gcs-repositories">Documentation</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Username and password should never be checked in plain text into version control as part of your build file. You can store the credentials in a local <code>gradle.properties</code> file and use one of the open source Gradle plugins for encrypting and consuming credentials e.g. the <a href="https://plugins.gradle.org/plugin/nu.studer.credentials">credentials plugin</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The transport protocol is part of the URL definition for a repository.
The following build script demonstrates how to create HTTP-based Maven and Ivy repositories:</p>
</div>
<div class="exampleblock">
<div class="title">Example 264. Declaring a Maven and Ivy repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
    }

    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to declare SFTP repositories:</p>
</div>
<div class="exampleblock">
<div class="title">Example 265. Using the SFTP protocol for a repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">sftp://repo.mycompany.com:22/maven2</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">sftp://repo.mycompany.com:22/repo</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;sftp://repo.mycompany.com:22/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }

    ivy {
        url = uri(&quot;sftp://repo.mycompany.com:22/repo&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on HTTP related authentication, see the section <a href="#sec:authentication_schemes">HTTP(S) authentication schemes configuration</a>.</p>
</div>
<div class="paragraph">
<p>When using an AWS S3 backed repository you need to authenticate using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.credentials.AwsCredentials.html">AwsCredentials</a>, providing access-key and a private-key. The following example shows how to declare a S3 backed repository and providing AWS credentials:</p>
</div>
<div class="exampleblock">
<div class="title">Example 266. Declaring a S3 backed Maven and Ivy repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
        credentials(AwsCredentials) {
            accessKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>
            secretKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someSecret</span><span class="delimiter">&quot;</span></span>
            <span class="comment">// optional</span>
            sessionToken <span class="string"><span class="delimiter">&quot;</span><span class="content">someSTSToken</span><span class="delimiter">&quot;</span></span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
        credentials(AwsCredentials) {
            accessKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span>
            secretKey <span class="string"><span class="delimiter">&quot;</span><span class="content">someSecret</span><span class="delimiter">&quot;</span></span>
            <span class="comment">// optional</span>
            sessionToken <span class="string"><span class="delimiter">&quot;</span><span class="content">someSTSToken</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;s3://myCompanyBucket/maven2&quot;)
        credentials(AwsCredentials::class) {
            accessKey = &quot;someKey&quot;
            secretKey = &quot;someSecret&quot;
            // optional
            sessionToken = &quot;someSTSToken&quot;
        }
    }

    ivy {
        url = uri(&quot;s3://myCompanyBucket/ivyrepo&quot;)
        credentials(AwsCredentials::class) {
            accessKey = &quot;someKey&quot;
            secretKey = &quot;someSecret&quot;
            // optional
            sessionToken = &quot;someSTSToken&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also delegate all credentials to the AWS sdk by using the AwsImAuthentication. The following example shows how:</p>
</div>
<div class="exampleblock">
<div class="title">Example 267. Declaring a S3 backed Maven and Ivy repository using IAM</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
        authentication {
           awsIm(AwsImAuthentication) <span class="comment">// load from EC2 role or env var</span>
        }
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">s3://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
        authentication {
           awsIm(AwsImAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;s3://myCompanyBucket/maven2&quot;)
        authentication {
            create&lt;AwsImAuthentication&gt;(&quot;awsIm&quot;) // load from EC2 role or env var
        }
    }

    ivy {
        url = uri(&quot;s3://myCompanyBucket/ivyrepo&quot;)
        authentication {
            create&lt;AwsImAuthentication&gt;(&quot;awsIm&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on AWS S3 related authentication, see the section <a href="#sec:s3-repositories">AWS S3 repositories configuration</a>.</p>
</div>
<div class="paragraph">
<p>When using a Google Cloud Storage backed repository default application credentials will be used with no further configuration required:</p>
</div>
<div class="exampleblock">
<div class="title">Example 268. Declaring a Google Cloud Storage backed Maven and Ivy repository using default application credentials</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">gcs://myCompanyBucket/maven2</span><span class="delimiter">&quot;</span></span>
    }

    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">gcs://myCompanyBucket/ivyrepo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;gcs://myCompanyBucket/maven2&quot;)
    }

    ivy {
        url = uri(&quot;gcs://myCompanyBucket/ivyrepo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For details on Google GCS related authentication, see the section <a href="#sec:gcs-repositories">Google Cloud Storage repositories configuration</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:authentication_schemes"><a class="anchor" href="#sec:authentication_schemes"></a><a class="link" href="#sec:authentication_schemes">HTTP(S) authentication schemes configuration</a></h5>
<div class="paragraph">
<p>When configuring a repository using HTTP or HTTPS transport protocols, multiple authentication schemes are available. By default, Gradle will attempt to use all schemes that are supported by the Apache HttpClient library, <a href="http://hc.apache.org/httpcomponents-client-ga/tutorial/html/authentication.html#d5e625">documented here</a>. In some cases, it may be preferable to explicitly specify which authentication schemes should be used when exchanging credentials with a remote server. When explicitly declared, only those schemes are used when authenticating to a remote repository.</p>
</div>
<div class="paragraph">
<p>You can specify credentials for Maven repositories secured by basic authentication using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/credentials/PasswordCredentials.html">PasswordCredentials</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 269. Accessing password-protected Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example show how to configure a repository to use only <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/DigestAuthentication.html">DigestAuthentication</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 270. Configure repository to use only digest authentication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">'</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            digest(DigestAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
        authentication {
            create&lt;DigestAuthentication&gt;(&quot;digest&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Currently supported authentication schemes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/BasicAuthentication.html">BasicAuthentication</a></dt>
<dd>
<p>Basic access authentication over HTTP. When using this scheme, credentials are sent preemptively.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/DigestAuthentication.html">DigestAuthentication</a></dt>
<dd>
<p>Digest access authentication over HTTP.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/HttpHeaderAuthentication.html">HttpHeaderAuthentication</a></dt>
<dd>
<p>Authentication based on any custom HTTP header, e.g. private tokens, OAuth tokens, etc.</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="sub:preemptive_authentication"><a class="anchor" href="#sub:preemptive_authentication"></a><a class="link" href="#sub:preemptive_authentication">Using preemptive authentication</a></h6>
<div class="paragraph">
<p>Gradle&#8217;s default behavior is to only submit credentials when a server responds with an authentication challenge in the form of an HTTP 401 response.
In some cases, the server will respond with a different code (ex. for repositories hosted on GitHub a 404 is returned) causing dependency resolution to fail.
To get around this behavior, credentials may be sent to the server preemptively.
To enable preemptive authentication simply configure your repository to explicitly use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/BasicAuthentication.html">BasicAuthentication</a> scheme:</p>
</div>
<div class="exampleblock">
<div class="title">Example 271. Configure repository to use preemptive authentication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.mycompany.com/maven2</span><span class="delimiter">'</span></span>
        credentials {
            username <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            password <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            basic(BasicAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;https://repo.mycompany.com/maven2&quot;)
        credentials {
            username = &quot;user&quot;
            password = &quot;password&quot;
        }
        authentication {
            create&lt;BasicAuthentication&gt;(&quot;basic&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:http-header-auth"><a class="anchor" href="#sub:http-header-auth"></a><a class="link" href="#sub:http-header-auth">Using HTTP header authentication</a></h6>
<div class="paragraph">
<p>You can specify any HTTP header for secured Maven repositories requiring token, OAuth2 or other HTTP header based authentication using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/credentials/HttpHeaderCredentials.html">HttpHeaderCredentials</a> with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/authentication/http/HttpHeaderAuthentication.html">HttpHeaderAuthentication</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 272. Accessing header-protected Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/maven2</span><span class="delimiter">&quot;</span></span>
        credentials(HttpHeaderCredentials) {
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Private-Token</span><span class="delimiter">&quot;</span></span>
            value = <span class="string"><span class="delimiter">&quot;</span><span class="content">TOKEN</span><span class="delimiter">&quot;</span></span>
        }
        authentication {
            header(HttpHeaderAuthentication)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven {
        url = uri(&quot;http://repo.mycompany.com/maven2&quot;)
        credentials(HttpHeaderCredentials::class) {
            name = &quot;Private-Token&quot;
            value = &quot;TOKEN&quot;
        }
        authentication {
            create&lt;HttpHeaderAuthentication&gt;(&quot;header&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:s3-repositories"><a class="anchor" href="#sec:s3-repositories"></a><a class="link" href="#sec:s3-repositories">AWS S3 repositories configuration</a></h5>
<div class="sect5">
<h6 id="sub:s3_configuration_properties"><a class="anchor" href="#sub:s3_configuration_properties"></a><a class="link" href="#sub:s3_configuration_properties">S3 configuration properties</a></h6>
<div class="paragraph">
<p>The following system properties can be used to configure the interactions with s3 repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.s3.endpoint</code></dt>
<dd>
<p>Used to override the AWS S3 endpoint when using a non AWS, S3 API compatible, storage service.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.s3.maxErrorRetry</code></dt>
<dd>
<p>Specifies the maximum number of times to retry a request in the event that the S3 server responds with a HTTP 5xx status code. When not specified a default value of 3 is used.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="sub:s3_url_formats"><a class="anchor" href="#sub:s3_url_formats"></a><a class="link" href="#sub:s3_url_formats">S3 URL formats</a></h6>
<div class="paragraph">
<p>S3 URL&#8217;s are 'virtual-hosted-style' and must be in the following format</p>
</div>
<div class="listingblock">
<div class="content">
<pre>s3://&lt;bucketName&gt;[.&lt;regionSpecificEndpoint&gt;]/&lt;s3Key&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>e.g. <code>s3://myBucket.s3.eu-central-1.amazonaws.com/maven/release</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myBucket</code> is the AWS S3 bucket name.</p>
</li>
<li>
<p><code>s3.eu-central-1.amazonaws.com</code> is the <em>optional</em> <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">region specific endpoint</a>.</p>
</li>
<li>
<p><code>/maven/release</code> is the AWS S3 key (unique identifier for an object within a bucket)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sub:s3_proxy_settings"><a class="anchor" href="#sub:s3_proxy_settings"></a><a class="link" href="#sub:s3_proxy_settings">S3 proxy settings</a></h6>
<div class="paragraph">
<p>A proxy for S3 can be configured using the following system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>https.proxyHost</code></p>
</li>
<li>
<p><code>https.proxyPort</code></p>
</li>
<li>
<p><code>https.proxyUser</code></p>
</li>
<li>
<p><code>https.proxyPassword</code></p>
</li>
<li>
<p><code>https.nonProxyHosts</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>org.gradle.s3.endpoint</code> property has been specified with a HTTP (not HTTPS) URI the following system proxy settings can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http.proxyHost</code></p>
</li>
<li>
<p><code>http.proxyPort</code></p>
</li>
<li>
<p><code>http.proxyUser</code></p>
</li>
<li>
<p><code>http.proxyPassword</code></p>
</li>
<li>
<p><code>http.nonProxyHosts</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sub:s3_v4_signatures"><a class="anchor" href="#sub:s3_v4_signatures"></a><a class="link" href="#sub:s3_v4_signatures">AWS S3 V4 Signatures (AWS4-HMAC-SHA256)</a></h6>
<div class="paragraph">
<p>Some of the AWS S3 regions (eu-central-1 - Frankfurt) require that all HTTP requests are signed in accordance with AWS&#8217;s <a href="http://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">signature version 4</a>. It is recommended to specify S3 URL&#8217;s containing the region specific endpoint when using buckets that require V4 signatures. e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>s3://somebucket.s3.eu-central-1.amazonaws.com/maven/release</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When a region-specific endpoint is not specified for buckets requiring V4 Signatures, Gradle will use the default AWS region (us-east-1) and the
following warning will appear on the console:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Attempting to re-send the request to &#8230;&#8203;. with AWS V4 authentication. To avoid this warning in the future, use region-specific endpoint to access buckets located in regions that require V4 signing.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Failing to specify the region-specific endpoint for buckets requiring V4 signatures means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 round-trips to AWS, as opposed to one, for every file upload and download.</p>
</li>
<li>
<p>Depending on location - increased network latencies and slower builds.</p>
</li>
<li>
<p>Increased likelihood of transmission failures.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="sub:s3_cross_account"><a class="anchor" href="#sub:s3_cross_account"></a><a class="link" href="#sub:s3_cross_account">AWS S3 Cross Account Access</a></h7>
<div class="paragraph">
<p>Some organizations may have multiple AWS accounts, e.g. one for each team. The AWS account of the bucket owner is often different from the artifact publisher and consumers. The bucket owner needs to be able to grant the consumers access otherwise the artifacts will only be usable by the publisher&#8217;s account. This is done by adding the <code>bucket-owner-full-control</code> <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">Canned ACL</a> to the uploaded objects. Gradle will do this in every upload. Make sure the publisher has the required IAM permission, <code>PutObjectAcl</code> (and <code>PutObjectVersionAcl</code> if bucket versioning is enabled), either directly or via an assumed IAM Role (depending on your case). You can read more at <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html">AWS S3 Access Permissions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:gcs-repositories"><a class="anchor" href="#sec:gcs-repositories"></a><a class="link" href="#sec:gcs-repositories">Google Cloud Storage repositories configuration</a></h5>
<div class="sect5">
<h6 id="sub:gcs_configuration_properties"><a class="anchor" href="#sub:gcs_configuration_properties"></a><a class="link" href="#sub:gcs_configuration_properties">GCS configuration properties</a></h6>
<div class="paragraph">
<p>The following system properties can be used to configure the interactions with <a href="https://cloud.google.com/storage/">Google Cloud Storage</a> repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.gradle.gcs.endpoint</code></dt>
<dd>
<p>Used to override the Google Cloud Storage endpoint when using a non-Google Cloud Platform, Google Cloud Storage API compatible, storage service.</p>
</dd>
<dt class="hdlist1"><code>org.gradle.gcs.servicePath</code></dt>
<dd>
<p>Used to override the Google Cloud Storage root service path which the Google Cloud Storage client builds requests from, defaults to <code>/</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="sub:gcs_url_formats"><a class="anchor" href="#sub:gcs_url_formats"></a><a class="link" href="#sub:gcs_url_formats">GCS URL formats</a></h6>
<div class="paragraph">
<p>Google Cloud Storage URL&#8217;s are 'virtual-hosted-style' and must be in the following format <code>gcs://&lt;bucketName&gt;/&lt;objectKey&gt;</code></p>
</div>
<div class="paragraph">
<p>e.g. <code>gcs://myBucket/maven/release</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myBucket</code> is the Google Cloud Storage bucket name.</p>
</li>
<li>
<p><code>/maven/release</code> is the Google Cloud Storage key (unique identifier for an object within a bucket)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-dependencies"><a class="anchor" href="#declaring-dependencies"></a><a class="link" href="#declaring-dependencies">Declaring dependencies</a></h4>
<div class="paragraph">
<p>Before looking at dependency declarations themselves, the concept of <em>dependency configuration</em> needs to be defined.</p>
</div>
<div class="sect4">
<h5 id="sec:what-are-dependency-configurations"><a class="anchor" href="#sec:what-are-dependency-configurations"></a><a class="link" href="#sec:what-are-dependency-configurations">What are dependency configurations</a></h5>
<div class="paragraph">
<p>Every dependency declared for a Gradle project applies to a specific scope.
For example some dependencies should be used for compiling source code whereas others only need to be available at runtime.
Gradle represents the scope of a dependency with the help of a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.Configuration.html">Configuration</a>.
Every configuration can be identified by a unique name.</p>
</div>
<div class="paragraph">
<p>Many Gradle plugins add pre-defined configurations to your project.
The Java plugin, for example, adds configurations to represent the various classpaths it needs for source code compilation, executing tests and the like.
See <a href="#sec:java_plugin_and_dependency_management">the Java plugin chapter</a> for an example.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-configurations.png" alt="dependency management configurations">
</div>
<div class="title">Figure 15. Configurations use declared dependencies for specific purposes</div>
</div>
<div class="paragraph">
<p>For more examples on the usage of configurations to navigate, inspect and post-process metadata and artifacts of assigned dependencies, have a look at the <a href="#sec:programmatic_api">resolution result APIs</a>.</p>
</div>
<div class="sect5">
<h6 id="sub:config-inheritance-composition"><a class="anchor" href="#sub:config-inheritance-composition"></a><a class="link" href="#sub:config-inheritance-composition">Configuration inheritance and composition</a></h6>
<div class="paragraph">
<p>A configuration can extend other configurations to form an inheritance hierarchy.
Child configurations inherit the whole set of dependencies declared for any of its superconfigurations.</p>
</div>
<div class="paragraph">
<p>Configuration inheritance is heavily used by Gradle core plugins like the <a href="#sec:java_plugin_and_dependency_management">Java plugin</a>.
For example the <code>testImplementation</code> configuration extends the <code>implementation</code> configuration.
 The configuration hierarchy has a practical purpose: compiling tests requires the dependencies of the source code under test on top of the dependencies needed write the test class.
 A Java project that uses JUnit to write and execute test code also needs Guava if its classes are imported in the production source code.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-configuration-inheritance.png" alt="dependency management configuration inheritance">
</div>
<div class="title">Figure 16. Configuration inheritance provided by the Java plugin</div>
</div>
<div class="paragraph">
<p>Under the covers the <code>testImplementation</code> and <code>implementation</code> configurations form an inheritance hierarchy by calling the method <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.Configuration.html#org.gradle.api.artifacts.Configuration:extendsFrom(org.gradle.api.artifacts.Configuration[])">Configuration.extendsFrom(org.gradle.api.artifacts.Configuration[])</a>.
A configuration can extend any other configuration irrespective of its definition in the build script or a plugin.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you wanted to write a suite of smoke tests.
Each smoke test makes a HTTP call to verify a web service endpoint.
As the underlying test framework the project already uses JUnit.
You can define a new configuration named <code>smokeTest</code> that extends from the <code>testImplementation</code> configuration to reuse the existing test framework dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 273. Extending a configuration from another configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    smokeTest.extendsFrom testImplementation
}

dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
    smokeTest <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val smokeTest by configurations.creating {
    extendsFrom(configurations.testImplementation.get())
}

dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
    smokeTest(&quot;org.apache.httpcomponents:httpclient:4.5.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:resolvable-consumable-configs"><a class="anchor" href="#sec:resolvable-consumable-configs"></a><a class="link" href="#sec:resolvable-consumable-configs">Resolvable and consumable configurations</a></h5>
<div class="paragraph">
<p>Configurations are a fundamental part of dependency resolution in Gradle.
In the context of dependency resolution, it is useful to distinguish between a <em>consumer</em> and a <em>producer</em>. Along these lines, configurations have at least 3 different roles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>to declare dependencies</p>
</li>
<li>
<p>as a <em>consumer</em>, to resolve a set of dependencies to files</p>
</li>
<li>
<p>as a <em>producer</em>, to expose artifacts and their dependencies for consumption by other projects
(such <em>consumable</em> configurations usually represent the <a href="#">variants</a> the producer offers to its consumers)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to express that an application <code>app</code> <em>depends on</em> library <code>lib</code>, <em>at least</em> one configuration is required:</p>
</div>
<div class="exampleblock">
<div class="title">Example 274. Configurations are used to declare dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// declare a &quot;configuration&quot; named &quot;someConfiguration&quot;</span>
    someConfiguration
}
dependencies {
    <span class="comment">// add a project dependency to the &quot;someConfiguration&quot; configuration</span>
    someConfiguration project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// declare a &quot;configuration&quot; named &quot;someConfiguration&quot;
val someConfiguration by configurations.creating

dependencies {
    // add a project dependency to the &quot;someConfiguration&quot; configuration
    someConfiguration(project(&quot;:lib&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Configurations can inherit dependencies from other configurations by extending from them.
Now, notice that the code above doesn&#8217;t tell us anything about the intended <em>consumer</em> of this configuration.
In particular, it doesn&#8217;t tell us how the configuration is meant to be <em>used</em>.
Let&#8217;s say that <code>lib</code> is a Java library: it might expose different things, such as its API, implementation, or test fixtures.
It might be necessary to change how we resolve the dependencies of <code>app</code> depending upon the task we&#8217;re performing (compiling against the API of <code>lib</code>, executing the application, compiling tests, etc.).
To address this problem, you&#8217;ll often find companion configurations, which are meant to unambiguously declare the usage:</p>
</div>
<div class="exampleblock">
<div class="title">Example 275. Configurations representing concrete dependency graphs</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// declare a configuration that is going to resolve the compile classpath of the application</span>
    compileClasspath.extendsFrom(someConfiguration)

    <span class="comment">// declare a configuration that is going to resolve the runtime classpath of the application</span>
    runtimeClasspath.extendsFrom(someConfiguration)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    // declare a configuration that is going to resolve the compile classpath of the application
    compileClasspath.extendsFrom(someConfiguration)

    // declare a configuration that is going to resolve the runtime classpath of the application
    runtimeClasspath.extendsFrom(someConfiguration)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point, we have 3 different configurations with different roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>someConfiguration</code> declares the dependencies of my application. It&#8217;s just a bucket that can hold a list of dependencies.</p>
</li>
<li>
<p><code>compileClasspath</code> and <code>runtimeClasspath</code> are configurations <em>meant to be resolved</em>: when resolved they should contain the compile classpath, and the runtime classpath of the application respectively.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This distinction is represented by the <code>canBeResolved</code> flag in the <code>Configuration</code> type.
A configuration that <em>can be resolved</em> is a configuration for which we can compute a dependency graph, because it contains all the necessary information for resolution to happen.
That is to say we&#8217;re going to compute a dependency graph, resolve the components in the graph, and eventually get artifacts.
A configuration which has <code>canBeResolved</code> set to <code>false</code> is not meant to be resolved.
Such a configuration is there <em>only to declare dependencies</em>.
The reason is that depending on the usage (compile classpath, runtime classpath), it <em>can</em> resolve to different graphs.
It is an error to try to resolve a configuration which has <code>canBeResolved</code> set to <code>false</code>.
To some extent, this is similar to an <em>abstract class</em> (<code>canBeResolved</code>=false) which is not supposed to be instantiated, and a concrete class extending the abstract class (<code>canBeResolved</code>=true).
A resolvable configuration will extend at least one non-resolvable configuration (and may extend more than one).</p>
</div>
<div class="paragraph">
<p>On the other end, at the library project side (the <em>producer</em>), we also use configurations to represent what can be consumed.
For example, the library may expose an API or a runtime, and we would attach artifacts to either one, the other, or both.
Typically, to compile against <code>lib</code>, we need the API of <code>lib</code>, but we don&#8217;t need its runtime dependencies.
So the <code>lib</code> project will expose an <code>apiElements</code> configuration, which is aimed at consumers looking for its API.
Such a configuration is consumable, but is not meant to be resolved.
This is expressed via the <em>canBeConsumed</em> flag of a <code>Configuration</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 276. Setting up configurations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    <span class="comment">// A configuration meant for consumers that need the API of this component</span>
    exposedApi {
        <span class="comment">// This configuration is an &quot;outgoing&quot; configuration, it's not meant to be resolved</span>
        canBeResolved = <span class="predefined-constant">false</span>
        <span class="comment">// As an outgoing configuration, explain that consumers may want to consume it</span>
        canBeConsumed = <span class="predefined-constant">true</span>
    }
    <span class="comment">// A configuration meant for consumers that need the implementation of this component</span>
    exposedRuntime {
        canBeResolved = <span class="predefined-constant">false</span>
        canBeConsumed = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    // A configuration meant for consumers that need the API of this component
    create(&quot;exposedApi&quot;) {
        // This configuration is an &quot;outgoing&quot; configuration, it's not meant to be resolved
        isCanBeResolved = false
        // As an outgoing configuration, explain that consumers may want to consume it
        isCanBeConsumed = true
    }
    // A configuration meant for consumers that need the implementation of this component
    create(&quot;exposedRuntime&quot;) {
        isCanBeResolved = false
        isCanBeConsumed = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In short, a configuration&#8217;s role is determined by the <code>canBeResolved</code> and <code>canBeConsumed</code> flag combinations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Configuration roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can be resolved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can be consumed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bucket of dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve for certain usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exposed to consumers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy, don&#8217;t use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For backwards compatibility, both flags have a default value of <code>true</code>, but as a plugin author, you should always determine the right values for those flags, or you might accidentally introduce resolution errors.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:choosing-configuration"><a class="anchor" href="#sec:choosing-configuration"></a><a class="link" href="#sec:choosing-configuration">Choosing the right configuration for dependencies</a></h5>
<div class="paragraph">
<p>The choice of the configuration where you declare a dependency is important.
However there is no fixed rule into which configuration a dependency must go.
It mostly depends on the way the configurations are organised, which is most often a property of the applied plugin(s).</p>
</div>
<div class="paragraph">
<p>For example, in the <code>java</code> plugin, the created configuration are <a href="#tab:configurations">documented</a> and should serve as the basis for determining where to declare a dependency, based on its role for your code.</p>
</div>
<div class="paragraph">
<p>As a recommendation, plugins should clearly document the way their configurations are linked together and should strive as much as possible to isolate their <a href="#sec:resolvable-consumable-configs">roles</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:defining-custom-configurations"><a class="anchor" href="#sec:defining-custom-configurations"></a><a class="link" href="#sec:defining-custom-configurations">Defining custom configurations</a></h5>
<div class="paragraph">
<p>You can define configurations yourself, so-called <em>custom configurations</em>.
A custom configuration is useful for separating the scope of dependencies needed for a dedicated purpose.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you wanted to declare a dependency on the <a href="https://tomcat.apache.org/tomcat-9.0-doc/jasper-howto.html">Jasper Ant task</a> for the purpose of pre-compiling JSP files that should <em>not</em> end up in the classpath for compiling your source code.
It&#8217;s fairly simple to achieve that goal by introducing a custom configuration and using it in a task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 277. Declaring and using a custom configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    jasper
}

repositories {
    mavenCentral()
}

dependencies {
    jasper <span class="string"><span class="delimiter">'</span><span class="content">org.apache.tomcat.embed:tomcat-embed-jasper:9.0.2</span><span class="delimiter">'</span></span>
}

task preCompileJsps {
    doLast {
        ant.taskdef(<span class="key">classname</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.apache.jasper.JspC</span><span class="delimiter">'</span></span>,
                    <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">jasper</span><span class="delimiter">'</span></span>,
                    <span class="key">classpath</span>: configurations.jasper.asPath)
        ant.jasper(<span class="key">validateXml</span>: <span class="predefined-constant">false</span>,
                   <span class="key">uriroot</span>: file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/webapp</span><span class="delimiter">'</span></span>),
                   <span class="key">outputDir</span>: file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/compiled-jsps</span><span class="delimiter">&quot;</span></span>))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val jasper by configurations.creating

repositories {
    mavenCentral()
}

dependencies {
    jasper(&quot;org.apache.tomcat.embed:tomcat-embed-jasper:9.0.2&quot;)
}

tasks.register(&quot;preCompileJsps&quot;) {
    doLast {
        ant.withGroovyBuilder {
            &quot;taskdef&quot;(&quot;classname&quot; to &quot;org.apache.jasper.JspC&quot;,
                      &quot;name&quot; to &quot;jasper&quot;,
                      &quot;classpath&quot; to jasper.asPath)
            &quot;jasper&quot;(&quot;validateXml&quot; to false,
                     &quot;uriroot&quot; to file(&quot;src/main/webapp&quot;),
                     &quot;outputDir&quot; to file(&quot;$buildDir/compiled-jsps&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A project&#8217;s configurations are managed by a <code>configurations</code> object.
Configurations have a name and can extend each other.
To learn more about this API have a look at <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ConfigurationContainer.html">ConfigurationContainer</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:dependency-types"><a class="anchor" href="#sec:dependency-types"></a><a class="link" href="#sec:dependency-types">Different kinds of dependencies</a></h5>
<div class="sect5">
<h6 id="sub:module_dependencies"><a class="anchor" href="#sub:module_dependencies"></a><a class="link" href="#sub:module_dependencies">Module dependencies</a></h6>
<div class="paragraph">
<p>Module dependencies are the most common dependencies. They refer to a module in a repository.</p>
</div>
<div class="exampleblock">
<div class="title">Example 278. Module dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtimeOnly <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-core</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>
    runtimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-core:2.5</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-aop:2.5</span><span class="delimiter">'</span></span>
    runtimeOnly(
        [<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-core</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>],
        [<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.springframework</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">spring-aop</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.5</span><span class="delimiter">'</span></span>]
    )
    runtimeOnly(<span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate:3.0.5</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">true</span>
    }
    runtimeOnly <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">hibernate</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>, <span class="key">transitive</span>: <span class="predefined-constant">true</span>
    runtimeOnly(<span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">hibernate</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">3.0.5</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    runtimeOnly(group = &quot;org.springframework&quot;, name = &quot;spring-core&quot;, version = &quot;2.5&quot;)
    runtimeOnly(&quot;org.springframework:spring-aop:2.5&quot;)
    runtimeOnly(&quot;org.hibernate:hibernate:3.0.5&quot;) {
        isTransitive = true
    }
    runtimeOnly(group = &quot;org.hibernate&quot;, name = &quot;hibernate&quot;, version = &quot;3.0.5&quot;) {
        isTransitive = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">DependencyHandler</a> class in the API documentation for more examples and a complete reference.</p>
</div>
<div class="paragraph">
<p>Gradle provides different notations for module dependencies. There is a string notation and a map notation. A module dependency has an API which allows further configuration. Have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ExternalModuleDependency.html">ExternalModuleDependency</a> to learn all about the API. This API provides properties and configuration methods. Via the string notation you can define a subset of the properties. With the map notation you can define all properties. To have access to the complete API, either with the map or with the string notation, you can assign a single dependency to a configuration together with a closure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you declare a module dependency, Gradle looks for a module metadata file (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code>) in the repositories.
If such a module metadata file exists, it is parsed and the artifacts of this module (e.g. <code>hibernate-3.0.5.jar</code>) as well as its dependencies (e.g. <code>cglib</code>) are downloaded.
If no such module metadata file exists, as of Gradle 6.0, you need to configure <a href="#sec:supported_metadata_sources">metadata sources definitions</a> to look for an artifact file called <code>hibernate-3.0.5.jar</code> directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Maven, a module can have one and only one artifact.</p>
</div>
<div class="paragraph">
<p>In Gradle and Ivy, a module can have multiple artifacts.
Each artifact can have a different set of dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sub:file_dependencies"><a class="anchor" href="#sub:file_dependencies"></a><a class="link" href="#sub:file_dependencies">File dependencies</a></h6>
<div class="paragraph">
<p>Projects sometimes do not rely on a binary repository product e.g. JFrog Artifactory or Sonatype Nexus for hosting and resolving external dependencies.
It&#8217;s common practice to host those dependencies on a shared drive or check them into version control alongside the project source code.
Those dependencies are referred to as <em>file dependencies</em>, the reason being that they represent a file without any <a href="#sub:terminology_module_metadata">metadata</a> (like information about transitive dependencies, the origin or its author) attached to them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-file-dependencies.png" alt="dependency management file dependencies">
</div>
<div class="title">Figure 17. Resolving file dependencies from the local file system and a shared drive</div>
</div>
<div class="paragraph">
<p>The following example resolves file dependencies from the directories <code>ant</code>, <code>libs</code> and <code>tools</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 279. Declaring multiple file dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    antContrib
    externalLibs
    deploymentTools
}

dependencies {
    antContrib files(<span class="string"><span class="delimiter">'</span><span class="content">ant/antcontrib.jar</span><span class="delimiter">'</span></span>)
    externalLibs files(<span class="string"><span class="delimiter">'</span><span class="content">libs/commons-lang.jar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">libs/log4j.jar</span><span class="delimiter">'</span></span>)
    deploymentTools(fileTree(<span class="string"><span class="delimiter">'</span><span class="content">tools</span><span class="delimiter">'</span></span>) { include <span class="string"><span class="delimiter">'</span><span class="content">*.exe</span><span class="delimiter">'</span></span> })
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;antContrib&quot;)
    create(&quot;externalLibs&quot;)
    create(&quot;deploymentTools&quot;)
}

dependencies {
    &quot;antContrib&quot;(files(&quot;ant/antcontrib.jar&quot;))
    &quot;externalLibs&quot;(files(&quot;libs/commons-lang.jar&quot;, &quot;libs/log4j.jar&quot;))
    &quot;deploymentTools&quot;(fileTree(&quot;tools&quot;) { include(&quot;*.exe&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see in the code example, every dependency has to define its exact location in the file system.
The most prominent methods for creating a file reference are
<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files(java.lang.Object[])">Project.files(java.lang.Object&#8230;&#8203;)</a>,
<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-">ProjectLayout.files(java.lang.Object&#8230;&#8203;)</a>
and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree(java.lang.Object)">Project.fileTree(java.lang.Object)</a>
Alternatively, you can also define the source directory of one or many file dependencies in the form of a <a href="#sub:flat_dir_resolver">flat directory repository</a>.</p>
</div>
<div class="paragraph">
<p>File dependencies allow you to directly add a set of files to a configuration, without first adding them to a repository. This can be useful if you cannot, or do not want to, place certain files in a repository. Or if you do not want to use any repositories at all for storing your dependencies.</p>
</div>
<div class="paragraph">
<p>To add some files as a dependency for a configuration, you simply pass a <a href="#sec:file_collections">file collection</a> as a dependency:</p>
</div>
<div class="exampleblock">
<div class="title">Example 280. File dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtimeOnly files(<span class="string"><span class="delimiter">'</span><span class="content">libs/a.jar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">libs/b.jar</span><span class="delimiter">'</span></span>)
    runtimeOnly fileTree(<span class="string"><span class="delimiter">'</span><span class="content">libs</span><span class="delimiter">'</span></span>) { include <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span> }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    runtimeOnly(files(&quot;libs/a.jar&quot;, &quot;libs/b.jar&quot;))
    runtimeOnly(fileTree(&quot;libs&quot;) { include(&quot;*.jar&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>File dependencies are not included in the published dependency descriptor for your project.
However, file dependencies are included in transitive project dependencies within the same build.
This means they cannot be used outside the current build, but they can be used within the same build.</p>
</div>
<div class="paragraph">
<p>You can declare which tasks produce the files for a file dependency.
You might do this when, for example, the files are generated by the build.</p>
</div>
<div class="exampleblock">
<div class="title">Example 281. Generated file dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation files(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/classes</span><span class="delimiter">&quot;</span></span>) {
        builtBy <span class="string"><span class="delimiter">'</span><span class="content">compile</span><span class="delimiter">'</span></span>
    }
}

task compile {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">compiling classes</span><span class="delimiter">'</span></span>
    }
}

task list(<span class="key">dependsOn</span>: configurations.compileClasspath) {
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath = </span><span class="inline"><span class="inline-delimiter">${</span>configurations.compileClasspath.collect { <span class="predefined-type">File</span> file -&gt; file.name }<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(files(&quot;$buildDir/classes&quot;) {
        builtBy(&quot;compile&quot;)
    })
}

tasks.register(&quot;compile&quot;) {
    doLast {
        println(&quot;compiling classes&quot;)
    }
}

tasks.register(&quot;list&quot;) {
    dependsOn(configurations[&quot;compileClasspath&quot;])
    doLast {
        println(&quot;classpath = ${configurations[&quot;compileClasspath&quot;].map { file: File -&gt; file.name }}&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q list
compiling classes
classpath = [classes]</pre>
</div>
</div>
<div class="sect6">
<h7 id="sec:versioning_file_dependencies"><a class="anchor" href="#sec:versioning_file_dependencies"></a><a class="link" href="#sec:versioning_file_dependencies">Versioning of file dependencies</a></h7>
<div class="paragraph">
<p>It is recommended to clearly express the intention and a concrete version for file dependencies.
File dependencies are not considered by Gradle&#8217;s <a href="#sec:how-gradle-downloads-deps">version conflict resolution</a>.
Therefore, it is extremely important to assign a version to the file name to indicate the distinct set of changes shipped with it.
For example <code>commons-beanutils-1.3.jar</code> lets you track the changes of the library by the release notes.</p>
</div>
<div class="paragraph">
<p>As a result, the dependencies of the project are easier to maintain and organize.
It is much easier to uncover potential API incompatibilities by the assigned version.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:project_dependencies"><a class="anchor" href="#sub:project_dependencies"></a><a class="link" href="#sub:project_dependencies">Project dependencies</a></h6>
<div class="paragraph">
<p>Software projects often break up software components into modules to improve maintainability and prevent strong coupling.
Modules can define dependencies between each other to reuse code within the same project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-project-dependencies.png" alt="dependency management project dependencies">
</div>
<div class="title">Figure 18. Dependencies between projects</div>
</div>
<div class="paragraph">
<p>Gradle can model dependencies between modules.
Those dependencies are called <em>project dependencies</em> because each module is represented by a Gradle project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 282. Project dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:shared</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(project(&quot;:shared&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At runtime, the build automatically ensures that project dependencies are built in the correct order and added to the classpath for compilation.
The chapter <a href="#multi_project_builds">Authoring Multi-Project Builds</a> discusses how to set up and configure multi-project builds in more detail.</p>
</div>
<div class="paragraph">
<p>For more information see the API documentation for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ProjectDependency.html">ProjectDependency</a>.</p>
</div>
<div class="paragraph">
<p>The following example declares the dependencies on the <code>utils</code> and <code>api</code> project from the <code>web-service</code> project. The method <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:project(java.lang.String)">Project.project(java.lang.String)</a> creates a reference to a specific subproject by path.</p>
</div>
<div class="exampleblock">
<div class="title">Example 283. Declaring project dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project(<span class="string"><span class="delimiter">'</span><span class="content">:web-service</span><span class="delimiter">'</span></span>) {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:utils</span><span class="delimiter">'</span></span>)
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:api</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">project(&quot;:web-service&quot;) {
    dependencies {
        &quot;implementation&quot;(project(&quot;:utils&quot;))
        &quot;implementation&quot;(project(&quot;:api&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="local_forks_of_module_dependencies"><a class="anchor" href="#local_forks_of_module_dependencies"></a><a class="link" href="#local_forks_of_module_dependencies">Local forks of module dependencies</a></h6>
<div class="paragraph">
<p>A module dependency can be substituted by a dependency to a local fork of the sources of that module, if the module itself is built with Gradle.
This can be done by utilising <a href="#defining_composite_builds">composite builds</a>.
This allows you, for example, to fix an issue in a library you use in an application by using, and building, a locally patched version instead of the published binary version.
The details of this are described in the section on <a href="#defining_composite_builds">composite builds</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:gradle_distribution_dependencies"><a class="anchor" href="#sub:gradle_distribution_dependencies"></a><a class="link" href="#sub:gradle_distribution_dependencies">Gradle distribution-specific dependencies</a></h6>
<div class="sect6">
<h7 id="sub:api_dependencies"><a class="anchor" href="#sub:api_dependencies"></a><a class="link" href="#sub:api_dependencies">Gradle API dependency</a></h7>
<div class="paragraph">
<p>You can declare a dependency on the API of the current version of Gradle by using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:gradleApi()">DependencyHandler.gradleApi()</a> method. This is useful when you are developing custom Gradle tasks or plugins.</p>
</div>
<div class="exampleblock">
<div class="title">Example 284. Gradle API dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation gradleApi()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(gradleApi())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="sub:testkit_dependencies"><a class="anchor" href="#sub:testkit_dependencies"></a><a class="link" href="#sub:testkit_dependencies">Gradle TestKit dependency</a></h7>
<div class="paragraph">
<p>You can declare a dependency on the TestKit API of the current version of Gradle by using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:gradleTestKit()">DependencyHandler.gradleTestKit()</a> method. This is useful for writing and executing functional tests for Gradle plugins and build scripts.</p>
</div>
<div class="exampleblock">
<div class="title">Example 285. Gradle TestKit dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation gradleTestKit()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(gradleTestKit())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#test_kit">The TestKit chapter</a> explains the use of TestKit by example.</p>
</div>
</div>
<div class="sect6">
<h7 id="sub:groovy_dependencies"><a class="anchor" href="#sub:groovy_dependencies"></a><a class="link" href="#sub:groovy_dependencies">Local Groovy dependency</a></h7>
<div class="paragraph">
<p>You can declare a dependency on the Groovy that is distributed with Gradle by using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:localGroovy()">DependencyHandler.localGroovy()</a> method. This is useful when you are developing custom Gradle tasks or plugins in Groovy.</p>
</div>
<div class="exampleblock">
<div class="title">Example 286. Gradle&#8217;s Groovy dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation localGroovy()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(localGroovy())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:documenting-dependencies"><a class="anchor" href="#sec:documenting-dependencies"></a><a class="link" href="#sec:documenting-dependencies">Documenting dependencies</a></h5>
<div class="paragraph">
<p>When you declare a dependency or a <a href="#sec:adding-constraints-transitive-deps">dependency constraint</a>, you can provide a custom reason for the declaration.
This makes the dependency declarations in your build script and the <a href="#sec:identifying_reason_dependency_selection">dependency insight report</a> easier to interpret.</p>
</div>
<div class="exampleblock">
<div class="title">Example 287. Giving a reason for choosing a certain module version in a dependency declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    jcenter()
}

dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.ow2.asm:asm:7.1</span><span class="delimiter">'</span></span>) {
        because <span class="string"><span class="delimiter">'</span><span class="content">we require a JDK 9 compatible bytecode generator</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    jcenter()
}

dependencies {
    implementation(&quot;org.ow2.asm:asm:7.1&quot;) {
        because(&quot;we require a JDK 9 compatible bytecode generator&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="example_using_the_dependency_insight_report_with_custom_reasons"><a class="anchor" href="#example_using_the_dependency_insight_report_with_custom_reasons"></a><a class="link" href="#example_using_the_dependency_insight_report_with_custom_reasons">Example: Using the dependency insight report with custom reasons</a></h6>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q dependencyInsight --dependency asm</code></strong></div>
<div class="content">
<pre>&gt; gradle -q dependencyInsight --dependency asm
org.ow2.asm:asm:7.1
   variant "compile" [
      org.gradle.status              = release (not requested)
      org.gradle.usage               = java-api
      org.gradle.libraryelements     = jar (compatible with: classes)
      org.gradle.category            = library

      Requested attributes not found in the selected variant:
         org.gradle.dependency.bundling = external
         org.gradle.jvm.version = 11
   ]
   Selection reasons:
      - Was requested : we require a JDK 9 compatible bytecode generator

org.ow2.asm:asm:7.1
\--- compileClasspath

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:resolve_specific_artifacts_from_dependency"><a class="anchor" href="#sec:resolve_specific_artifacts_from_dependency"></a><a class="link" href="#sec:resolve_specific_artifacts_from_dependency">Resolving specific artifacts from a module dependency</a></h5>
<div class="paragraph">
<p>Whenever Gradle tries to resolve a module from a Maven or Ivy repository, it looks for a metadata file and the default artifact file, a JAR. The build fails if none of these artifact files can be resolved. Under certain conditions, you might want to tweak the way Gradle resolves artifacts for a dependency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dependency only provides a non-standard artifact without any metadata e.g. a ZIP file.</p>
</li>
<li>
<p>The module metadata declares more than one artifact e.g. as part of an Ivy dependency descriptor.</p>
</li>
<li>
<p>You only want to download a specific artifact without any of the transitive dependencies declared in the metadata.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle is a polyglot build tool and not limited to just resolving Java libraries. Let&#8217;s assume you wanted to build a web application using JavaScript as the client technology. Most projects check in external JavaScript libraries into version control. An external JavaScript library is no different than a reusable Java library so why not download it from a repository instead?</p>
</div>
<div class="paragraph">
<p><a href="https://developers.google.com/speed/libraries/">Google Hosted Libraries</a> is a distribution platform for popular, open-source JavaScript libraries. With the help of the artifact-only notation you can download a JavaScript library file e.g. JQuery. The <code>@</code> character separates the dependency&#8217;s coordinates from the artifact&#8217;s file extension.</p>
</div>
<div class="exampleblock">
<div class="title">Example 288. Resolving a JavaScript artifact for a declared dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://ajax.googleapis.com/ajax/libs</span><span class="delimiter">'</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">'</span><span class="content">[organization]/[revision]/[module].[ext]</span><span class="delimiter">'</span></span>
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    js
}

dependencies {
    js <span class="string"><span class="delimiter">'</span><span class="content">jquery:jquery:3.2.1@js</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;https://ajax.googleapis.com/ajax/libs&quot;)
        patternLayout {
            artifact(&quot;[organization]/[revision]/[module].[ext]&quot;)
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    create(&quot;js&quot;)
}

dependencies {
    &quot;js&quot;(&quot;jquery:jquery:3.2.1@js&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Some modules ship different "flavors" of the same artifact or they publish multiple artifacts that belong to a specific module version but have a different purpose. It&#8217;s common for a Java library to publish the artifact with the compiled class files, another one with just the source code in it and a third one containing the Javadocs.</p>
</div>
<div class="paragraph">
<p>In JavaScript, a library may exist as uncompressed or minified artifact. In Gradle, a specific artifact identifier is called <em>classifier</em>, a term generally used in Maven and Ivy dependency management.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we wanted to download the minified artifact of the JQuery library instead of the uncompressed file. You can provide the classifier <code>min</code> as part of the dependency declaration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 289. Resolving a JavaScript artifact with classifier for a declared dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://ajax.googleapis.com/ajax/libs</span><span class="delimiter">'</span></span>
        patternLayout {
            artifact <span class="string"><span class="delimiter">'</span><span class="content">[organization]/[revision]/[module](.[classifier]).[ext]</span><span class="delimiter">'</span></span>
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    js
}

dependencies {
    js <span class="string"><span class="delimiter">'</span><span class="content">jquery:jquery:3.2.1:min@js</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        url = uri(&quot;https://ajax.googleapis.com/ajax/libs&quot;)
        patternLayout {
            artifact(&quot;[organization]/[revision]/[module](.[classifier]).[ext]&quot;)
        }
        metadataSources {
            artifact()
        }
    }
}

configurations {
    create(&quot;js&quot;)
}

dependencies {
    &quot;js&quot;(&quot;jquery:jquery:3.2.1:min@js&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:supported-metadata-formats"><a class="anchor" href="#sec:supported-metadata-formats"></a><a class="link" href="#sec:supported-metadata-formats">Supported Metadata formats</a></h5>
<div class="paragraph">
<p>External module dependencies require module metadata (so that, typically, Gradle can figure out the transitive dependencies of a module).
To do so, Gradle supports different metadata formats.</p>
</div>
<div class="paragraph">
<p>You can also tweak which format will be looked up in the <a href="#sec:supported_metadata_sources">repository definition</a>.</p>
</div>
<div class="sect5">
<h6 id="sub:supported-md-gradle"><a class="anchor" href="#sub:supported-md-gradle"></a><a class="link" href="#sub:supported-md-gradle">Gradle Module Metadata files</a></h6>
<div class="paragraph">
<p>Gradle Module Metadata has been specifically designed to support all features of Gradle&#8217;s dependency management model and is hence the preferred format.
You can find its <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">specification here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:supported-md-pom"><a class="anchor" href="#sub:supported-md-pom"></a><a class="link" href="#sub:supported-md-pom">POM files</a></h6>
<div class="paragraph">
<p>Gradle natively supports <a href="https://maven.apache.org/pom.html">Maven POM files</a>.
It&#8217;s worth noting that by default Gradle will first look for a POM file, but if this file contains a special marker, Gradle will use <a href="#sub:supported-md-gradle">Gradle Module Metadata</a> instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:supported-md-ivy"><a class="anchor" href="#sub:supported-md-ivy"></a><a class="link" href="#sub:supported-md-ivy">Ivy files</a></h6>
<div class="paragraph">
<p>Similarly, Gradle supports <a href="http://ant.apache.org/ivy/">Apache Ivy metadata files</a>.
Again, Gradle will first look for an <code>ivy.xml</code> file, but if this file contains a special marker, Gradle will use <a href="#sub:supported-md-gradle">Gradle Module Metadata</a> instead.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:understanding-diff-libraries-and-apps"><a class="anchor" href="#sec:understanding-diff-libraries-and-apps"></a><a class="link" href="#sec:understanding-diff-libraries-and-apps">Understanding the difference between libraries and applications</a></h4>
<div class="sect4">
<h5 id="sub:producers-vs-consumers"><a class="anchor" href="#sub:producers-vs-consumers"></a><a class="link" href="#sub:producers-vs-consumers">Producers vs consumers</a></h5>
<div class="paragraph">
<p>A key concept in dependency management with Gradle is making the difference between consumers and producers.</p>
</div>
<div class="paragraph">
<p>When you <em>build</em> a library, you are effectively on the <em>producer</em> side: you are producing <em>artifacts</em> which are going to be <em>consumed</em> by someone else, the <em>consumer</em>.</p>
</div>
<div class="paragraph">
<p>A lot of problems with traditional build systems is that they don&#8217;t make the difference between a producer and a consumer.</p>
</div>
<div class="paragraph">
<p>A <em>consumer</em> needs to be understood in the large sense:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a project that depends on another project is a <em>consumer</em></p>
</li>
<li>
<p>a <em>task</em> that depends on an artifact is a finer grained consumer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In dependency management, a lot of the decisions we make depend on the type of project we are building, that is to say, <a href="#sub:being-respectful-consumers">what kind of <em>consumer</em> we are</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:producer-variants"><a class="anchor" href="#sub:producer-variants"></a><a class="link" href="#sub:producer-variants">Producer variants</a></h5>
<div class="paragraph">
<p>A producer may want to generate different artifacts for different kinds of consumers: for the same source code, different <em>binaries</em> are produced.
Or, a project may produce artifacts which are for consumption by other projects (same repository) but not for external use.</p>
</div>
<div class="paragraph">
<p>A typical example in the Java world is the Guava library which is published in different versions: one for Java projects, and one for Android projects.</p>
</div>
<div class="paragraph">
<p>However, it&#8217;s the consumer responsibility to tell what version to use, and it&#8217;s the dependency management engine responsibility to ensure <em>consistency of the graph</em> (for example making sure that you don&#8217;t end up with both Java and Android versions of Guava on your classpath).
This is where the <a href="#">variant model</a> of Gradle comes into play.</p>
</div>
<div class="paragraph">
<p>In Gradle, <em>producer variants</em> are exposed via <a href="#sec:resolvable-consumable-configs">consumable configurations</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:strong-encapsulation"><a class="anchor" href="#sub:strong-encapsulation"></a><a class="link" href="#sub:strong-encapsulation">Strong encapsulation</a></h5>
<div class="paragraph">
<p>In order for a producer to compile a library, it needs all its <em>implementation dependencies</em> on the compile classpath.
There are dependencies which are only required <em>as an implementation detail</em> of the library and there are libraries which are effectively part of the API.</p>
</div>
<div class="paragraph">
<p>However, a library <em>depending</em> on this produced library only needs to "see" the public API of your library and therefore the dependencies of this API.
It&#8217;s a subset of the compile classpath of the producer: this is strong encapsulation of dependencies.</p>
</div>
<div class="paragraph">
<p>The consequence is that a dependency which is assigned to the <code>implementation</code> configuration of a library <em>does not end up on the compile classpath of the consumer</em>.
On the other hand, a dependency which is assigned to the <code>api</code> configuration of a library <em>would end up on the compile classpath of the consumer</em>.
At <em>runtime</em>, however, all dependencies are required.
Gradle makes the difference between different kinds of consumer even within a single project: the Java compile task, for example, is a different consumer than the Java exec task.</p>
</div>
<div class="paragraph">
<p>More details on the segregation of API and runtime dependencies in the Java world <a href="#">can be found here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:being-respectful-consumers"><a class="anchor" href="#sub:being-respectful-consumers"></a><a class="link" href="#sub:being-respectful-consumers">Being respectful of consumers</a></h5>
<div class="paragraph">
<p>Whenever, as a developer, you decide to include a dependency, you must understand that there are <em>consequences for your consumers</em>.
For example, if you add a dependency to your project, it becomes a <em>transitive dependency</em> of your consumers, and therefore may participate in conflict resolution if the consumer needs a different version.</p>
</div>
<div class="paragraph">
<p>A lot of the problems Gradle handles are about fixing the mismatch between the expectations of a consumer and a producer.</p>
</div>
<div class="paragraph">
<p>However, some projects are easier than others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you are at the end of the consumption chain, that is to say you build an <em>application</em>, then there are effectively <em>no consumer</em> of your project (apart from final customers): adding <a href="#sec:excluding-transitive-deps">exclusions</a> will have no other consequence than fixing your problem.</p>
</li>
<li>
<p>however if you are a library, adding <a href="#sec:excluding-transitive-deps">exclusions</a> may prevent consumers from working properly, because they would exercise a path of the code that you don&#8217;t</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Always keep in mind that the solution you choose to fix a problem can "leak" to your consumers.
This documentation aims at guiding you to find the right solution to the right problem, and more importantly, make decisions which help the resolution engine to take the right decisions in case of conflicts.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewing-debugging-dependencies"><a class="anchor" href="#viewing-debugging-dependencies"></a><a class="link" href="#viewing-debugging-dependencies">Viewing and debugging dependencies</a></h4>
<div class="paragraph">
<p>Gradle provides sufficient tooling to navigate large dependency graphs and mitigate situations that can lead to <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency hell</a>.
Users can choose to render the full graph of dependencies as well as identify the selection reason and origin for a dependency.
The origin of a dependency can be a declared dependency in the build script or a transitive dependency in graph plus their corresponding configuration.
Gradle offers both capabilities through visual representation via build scans and as command line tooling.</p>
</div>
<div class="sect4">
<h5 id="sec:debugging-build-scans"><a class="anchor" href="#sec:debugging-build-scans"></a><a class="link" href="#sec:debugging-build-scans">Build scans</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not know what <a href="https://scans.gradle.com/">build scan</a>s are, be sure to check them out!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A build scan can visualize dependencies as a navigable, searchable tree.
Additional context information can be rendered by clicking on a specific dependency in the graph.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-dependencies-report-build-scan.png" alt="dependency management dependencies report build scan">
</div>
<div class="title">Figure 19. Dependency tree in a build scan</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_dependencies"><a class="anchor" href="#sec:listing_dependencies"></a><a class="link" href="#sec:listing_dependencies">Listing dependencies in a project</a></h5>
<div class="paragraph">
<p>Gradle can visualize the whole dependency tree for every <a href="#sec:what-are-dependency-configurations">configuration</a> available in the project.</p>
</div>
<div class="paragraph">
<p>Rendering the dependency tree is particularly useful if you&#8217;d like to identify which dependencies have been resolved at runtime.
It also provides you with information about any dependency conflict resolution that occurred in the process and clearly indicates the selected version.
The dependency report always contains declared and transitive dependencies.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you&#8217;d want to create tasks for your project that use the <a href="https://www.eclipse.org/jgit/">JGit library</a> to execute SCM operations e.g. to model a release process.
You can declare dependencies for any external tooling with the help of a <a href="#sec:what-are-dependency-configurations">custom configuration</a> so that it doesn&#8217;t pollute other contexts like the compilation classpath for your production source code.</p>
</div>
<div class="paragraph">
<p>Every Gradle project provides the task <code>dependencies</code> to render the so-called <em>dependency report</em> from the command line.
By default the dependency report renders dependencies for all configurations.
To focus on the information about one configuration, provide the optional parameter <code>--configuration</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 290. Declaring the JGit dependency with a custom configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    jcenter()
}

configurations {
    scm
}

dependencies {
    scm <span class="string"><span class="delimiter">'</span><span class="content">org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    jcenter()
}

configurations {
    create(&quot;scm&quot;)
}

dependencies {
    &quot;scm&quot;(&quot;org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="example_rendering_the_dependency_report_for_a_custom_configuration"><a class="anchor" href="#example_rendering_the_dependency_report_for_a_custom_configuration"></a><a class="link" href="#example_rendering_the_dependency_report_for_a_custom_configuration">Example: Rendering the dependency report for a custom configuration</a></h6>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q dependencies --configuration scm</code></strong></div>
<div class="content">
<pre>&gt; gradle -q dependencies --configuration scm

------------------------------------------------------------
Root project
------------------------------------------------------------

scm
\--- org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r
     +--- com.jcraft:jsch:0.1.54
     +--- com.googlecode.javaewah:JavaEWAH:1.1.6
     +--- org.apache.httpcomponents:httpclient:4.3.6
     |    +--- org.apache.httpcomponents:httpcore:4.3.3
     |    +--- commons-logging:commons-logging:1.1.3
     |    \--- commons-codec:commons-codec:1.6
     \--- org.slf4j:slf4j-api:1.7.2

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
<div class="paragraph">
<p>The dependencies report provides detailed information about the dependencies available in the graph.
Any dependency that could not be resolved is marked with <code>FAILED</code> in red color.
Dependencies with the same coordinates that can occur multiple times in the graph are omitted and indicated by an asterisk.
Dependencies that had to undergo conflict resolution render the requested and selected version separated by a right arrow character.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:identifying_reason_dependency_selection"><a class="anchor" href="#sec:identifying_reason_dependency_selection"></a><a class="link" href="#sec:identifying_reason_dependency_selection">Identifying which dependency version was selected and why</a></h5>
<div class="paragraph">
<p>Large software projects inevitably deal with an increased number of dependencies either through direct or transitive dependencies.
The <a href="#sec:listing_dependencies">dependencies report</a> provides you with the raw list of dependencies but does not explain <em>why</em> they have been selected or <em>which</em> dependency is responsible for pulling them into the graph.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at a concrete example.
A project may request two different versions of the same dependency either as direct or transitive dependency.
Gradle applies <a href="#sec:version-conflict">version conflict resolution</a> to ensure that only one version of the dependency exists in the dependency graph.
In this example the conflicting dependency is represented by <code>commons-codec:commons-codec</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 291. Declaring the JGit dependency and a conflicting dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    jcenter()
}

configurations {
    scm
}

dependencies {
    scm <span class="string"><span class="delimiter">'</span><span class="content">org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r</span><span class="delimiter">'</span></span>
    scm <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.7</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    jcenter()
}

configurations {
    create(&quot;scm&quot;)
}

dependencies {
    &quot;scm&quot;(&quot;org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r&quot;)
    &quot;scm&quot;(&quot;commons-codec:commons-codec:1.7&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dependency tree in a <a href="https://scans.gradle.com/">build scan</a> renders the selection reason (conflict resolution) as well as the origin of a dependency if you click on a dependency and select the "Required By" tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-dependency-insight-report-build-scan.png" alt="dependency management dependency insight report build scan">
</div>
<div class="title">Figure 20. Dependency insight capabilities in a build scan</div>
</div>
<div class="paragraph">
<p>Every Gradle project provides the task <code>dependencyInsight</code> to render the so-called  <em>dependency insight report</em> from the command line.
Given a dependency in the dependency graph you can identify the selection reason and track down the origin of the dependency selection. You can think of the dependency insight report as the inverse representation of the dependency report for a given dependency. When executing the task you have to provide the mandatory parameter <code>--dependency</code> to specify the coordinates of the dependency under inspection. The parameters <code>--configuration</code> and <code>--singlepath</code> are optional but help with filtering the output.</p>
</div>
<div class="sect5">
<h6 id="example_using_the_dependency_insight_report_for_a_given_dependency"><a class="anchor" href="#example_using_the_dependency_insight_report_for_a_given_dependency"></a><a class="link" href="#example_using_the_dependency_insight_report_for_a_given_dependency">Example: Using the dependency insight report for a given dependency</a></h6>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q dependencyInsight --dependency commons-codec --configuration scm</code></strong></div>
<div class="content">
<pre>&gt; gradle -q dependencyInsight --dependency commons-codec --configuration scm
commons-codec:commons-codec:1.7
   variant "default" [
      org.gradle.status = release (not requested)
   ]
   Selection reasons:
      - By conflict resolution : between versions 1.7 and 1.6

commons-codec:commons-codec:1.7
\--- scm

commons-codec:commons-codec:1.6 -&gt; 1.7
\--- org.apache.httpcomponents:httpclient:4.3.6
     \--- org.eclipse.jgit:org.eclipse.jgit:4.9.2.201712150930-r
          \--- scm

A web-based, searchable dependency report is available by adding the --scan option.</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:resolving-version-conflict"><a class="anchor" href="#sec:resolving-version-conflict"></a><a class="link" href="#sec:resolving-version-conflict">Resolving version conflicts</a></h5>
<div class="paragraph">
<p>If the selected version does not match your expectation, Gradle offers a series of tools to help you <a href="#">control transitive dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:resolving-variant-aware-errors"><a class="anchor" href="#sec:resolving-variant-aware-errors"></a><a class="link" href="#sec:resolving-variant-aware-errors">Resolving variant selection errors</a></h5>
<div class="paragraph">
<p>Sometimes a selection error will happen at the <a href="#">variant selection level</a>.
Have a look at the <a href="#sec:variant-select-errors">dedicated section</a> to understand these errors and how to resolve them.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:resolving-unsafe-configuration-resolution-errors"><a class="anchor" href="#sub:resolving-unsafe-configuration-resolution-errors"></a><a class="link" href="#sub:resolving-unsafe-configuration-resolution-errors">Resolving unsafe configuration resolution errors</a></h5>
<div class="paragraph">
<p>Configurations need to be resolved safely when crossing project boundaries because resolving a configuration can have side effects on Gradle&#8217;s project model.
Gradle can manage this safe access, but the configuration needs to be accessed in a way that enables Gradle to do so.
There are a number of ways a configuration might be resolved unsafely and Gradle will produce a deprecation warning for each unsafe access.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A task from one project directly resolves a configuration in another project.</p>
</li>
<li>
<p>A task specifies a configuration from another project as an input file collection.</p>
</li>
<li>
<p>A build script for a project resolves a configuration in another project during evaluation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your build has an unsafe access deprecation warning, it needs to be fixed.
It&#8217;s a symptom of these bad practices and can cause strange and indeterminate errors.</p>
</div>
<div class="paragraph">
<p>In most cases, this issue can be resolved by creating a cross-project dependency on the other project.  See the documentation for <a href="#cross_project_publications">sharing outputs between projects</a> for more information.
If you find a use case that can&#8217;t be resolved using these techniques, please let us know by filing a <a href="https://github.com/gradle/gradle/issues">GitHub Issue</a> adhering to our issue guidelines.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="understanding_dependency_resolution"><a class="anchor" href="#understanding_dependency_resolution"></a><a class="link" href="#understanding_dependency_resolution">Understanding dependency resolution</a></h4>
<div class="paragraph">
<p>This chapter covers the way dependency resolution works <em>inside</em> Gradle.
After covering how you can declare <a href="#">repositories</a> and <a href="#">dependencies</a>, it makes sense to explain how these declarations come together during dependency resolution.</p>
</div>
<div class="paragraph">
<p>Dependency resolution is a process that consists of two phases, which are repeated until the dependency graph is complete:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a new dependency is added to the graph, perform conflict resolution to determine which version should be added to the graph.</p>
</li>
<li>
<p>When a specific dependency, that is a module with a version, is identified as part of the graph, retrieve its metadata so that its dependencies can be added in turn.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section will describe what Gradle identifies as conflict and how it can resolve them automatically.
After that, the retrieval of metadata will be covered, explaining how Gradle can <a href="#sec:how-gradle-downloads-deps">follow dependency links</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:conflict-resolution"><a class="anchor" href="#sec:conflict-resolution"></a><a class="link" href="#sec:conflict-resolution">How Gradle handles conflicts?</a></h5>
<div class="paragraph">
<p>When doing dependency resolution, Gradle handles two types of conflicts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Version conflicts</dt>
<dd>
<p>That is when two or more dependencies require a given dependency but with different versions.</p>
</dd>
<dt class="hdlist1">Implementation conflicts</dt>
<dd>
<p>That is when the dependency graph contains module that provide the same implementation, or capability in Gradle terminology.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following sections will explain in detail how Gradle attempts to resolve these conflicts.</p>
</div>
<div class="paragraph">
<p>The dependency resolution process is highly customizable to meet enterprise requirements.
For more information, see the chapter on <a href="#">Controlling transitive dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:version-conflict"><a class="anchor" href="#sec:version-conflict"></a><a class="link" href="#sec:version-conflict">Version conflict resolution</a></h5>
<div class="paragraph">
<p>A version conflict occurs when two components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Depend on the same module, let&#8217;s say <code>com.google.guava:guava</code></p>
</li>
<li>
<p>But on different versions, let&#8217;s say <code>20.0</code> and <code>25.1-android</code></p>
<div class="ulist">
<ul>
<li>
<p>Our project itself depends on <code>com.google.guava:guava:20.0</code></p>
</li>
<li>
<p>Our project also depends on <code>com.google.inject:guice:4.2.2</code> which itself depends on <code>com.google.guava:guava:25.1-android</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="sub:resolution-strategy"><a class="anchor" href="#sub:resolution-strategy"></a><a class="link" href="#sub:resolution-strategy">Resolution strategy</a></h6>
<div class="paragraph">
<p>Given the conflict above, there exist multiple ways to handle it, either by selecting a version or failing the resolution.
Different tools that handle dependency management have different ways of handling these type of conflicts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://maven.apache.org/">Apache Maven</a> uses a nearest first strategy.</p>
</div>
<div class="paragraph">
<p>Maven will take the <em>shortest</em> path to a dependency and use that version.
In case there are multiple paths of the same length, the first one wins.</p>
</div>
<div class="paragraph">
<p>This means that in the example above, the version of <code>guava</code> will be <code>20.0</code> because the direct dependency is <em>closer</em> than the <code>guice</code> dependency.</p>
</div>
<div class="paragraph">
<p>The main drawback of this method is that it is ordering dependent.
Keeping order in a very large graph can be a challenge.
For example, what if the new version of a dependency ends up having its own dependency declarations in a different order than the previous version?</p>
</div>
<div class="paragraph">
<p>With Maven, this could have unwanted impact on resolved versions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://ant.apache.org/ivy/">Apache Ivy</a> is a very flexible dependency management tooling.
It offers the possibility to customize dependency resolution, including conflict resolution.</p>
</div>
<div class="paragraph">
<p>This flexibility comes with the price of making it hard to reason about.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle will consider <em>all</em> requested versions, wherever they appear in the dependency graph.
Out of these versions, it will select the <em>highest</em> one.</p>
</div>
<div class="paragraph">
<p>As you have seen, Gradle supports a concept of <a href="#">rich version declaration</a>, so what is the highest version depends on the way versions were declared:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no ranges are involved, then the highest version that is not rejected will be selected.</p>
<div class="ulist">
<ul>
<li>
<p>If a version declared as <code>strictly</code> is lower than that version, selection will fail.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If ranges are involved:</p>
<div class="ulist">
<ul>
<li>
<p>If there is a non range version that falls within the specified ranges or is higher than their upper bound, it will be selected.</p>
</li>
<li>
<p>If there are only ranges, the highest <em>existing</em> version of the range with the highest upper bound will be selected.</p>
</li>
<li>
<p>If a version declared as <code>strictly</code> is lower than that version, selection will fail.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in the case where ranges come into play, Gradle requires metadata to determine which versions do exist for the considered range.
This causes an intermediate lookup for metadata, as described in <a href="#sec:how-gradle-downloads-deps">How Gradle retrieves dependency metadata?</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:implementation-conflict"><a class="anchor" href="#sec:implementation-conflict"></a><a class="link" href="#sec:implementation-conflict">Implementation conflict resolution</a></h5>
<div class="paragraph">
<p>Gradle uses variants and capabilities to identify what a module <em>provides</em>.</p>
</div>
<div class="paragraph">
<p>This is a unique feature that deserves its <a href="#">own chapter</a> to understand what it means and enables.</p>
</div>
<div class="paragraph">
<p>A conflict occurs the moment two modules either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attempt to select incompatible variants,</p>
</li>
<li>
<p>Declare the same capability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Learn more about handling these type of conflicts in <a href="#sub:selecting-between-candidates">Selecting between candidates</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:how-gradle-downloads-deps"><a class="anchor" href="#sec:how-gradle-downloads-deps"></a><a class="link" href="#sec:how-gradle-downloads-deps">How Gradle retrieves dependency metadata?</a></h5>
<div class="paragraph">
<p>Gradle requires metadata about the modules included in your dependency graph.
That information is required for two main points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine the existing versions of a module when the declared version is dynamic.</p>
</li>
<li>
<p>Determine the dependencies of the module for a given version.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="discovering_versions"><a class="anchor" href="#discovering_versions"></a><a class="link" href="#discovering_versions">Discovering versions</a></h6>
<div class="paragraph">
<p>Faced with a dynamic version, Gradle needs to identify the concrete matching versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each repository is inspected, Gradle does not stop on the first one returning some metadata.
When multiple are defined, they are inspected <em>in the order they were added</em>.</p>
</li>
<li>
<p>For Maven repositories, Gradle will use the <code>maven-metadata.xml</code> which provides information about the available versions.</p>
</li>
<li>
<p>For Ivy repositories, Gradle will resort to directory listing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This process results in a list of candidate versions that are then matched to the dynamic version expressed.
At this point, <a href="#sub:resolution-strategy">version conflict resolution</a> is resumed.</p>
</div>
<div class="paragraph">
<p>Note that Gradle caches the version information, more information can be found in the section <a href="#sec:controlling-dynamic-version-caching">Controlling dynamic version caching</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="obtaining_module_metadata"><a class="anchor" href="#obtaining_module_metadata"></a><a class="link" href="#obtaining_module_metadata">Obtaining module metadata</a></h6>
<div class="paragraph">
<p>Given a required dependency, with a version, Gradle attempts to resolve the dependency by searching for the module the dependency points at.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each repository is inspected in order.</p>
<div class="ulist">
<ul>
<li>
<p>Depending on the type of repository, Gradle looks for metadata files describing the module (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code> file) or directly for artifact files.</p>
</li>
<li>
<p>Modules that have a module metadata file (<code>.module</code>, <code>.pom</code> or <code>ivy.xml</code> file) are preferred over modules that have an artifact file only.</p>
</li>
<li>
<p>Once a repository returns a <em>metadata</em> result, following repositories are ignored.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Metadata for the dependency is retrieved and parsed, if found</p>
<div class="ulist">
<ul>
<li>
<p>If the module metadata is a POM file that has a parent POM declared, Gradle will recursively attempt to resolve each of the parent modules for the POM.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All of the artifacts for the module are then requested from the <em>same repository</em> that was chosen in the process above.</p>
</li>
<li>
<p>All of that data, including the repository source and potential misses are then stored in the <a href="#sec:dependency_cache">The Dependency Cache</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The penultimate point above is what can make the integration with <a href="#sec:case-for-maven-local">Maven Local</a> problematic.
As it is a cache for Maven, it will sometimes miss some artifacts of a given module.
If Gradle is sourcing such a module from Maven Local, it will consider the missing artifacts to be missing altogether.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="repository_blacklisting"><a class="anchor" href="#repository_blacklisting"></a><a class="link" href="#repository_blacklisting">Repository blacklisting</a></h6>
<div class="paragraph">
<p>When Gradle fails to retrieve information from a repository, it will blacklist it for the duration of the build and fail all dependency resolution.</p>
</div>
<div class="paragraph">
<p>That last point is important for reproducibility.
If the build was allowed to continue, ignoring the faulty repository, subsequent builds could have a different result once the repository is back online.</p>
</div>
<div class="sect6">
<h7 id="sub:http-retries"><a class="anchor" href="#sub:http-retries"></a><a class="link" href="#sub:http-retries">HTTP Retries</a></h7>
<div class="paragraph">
<p>Gradle will make several attempts to connect to a given repository before blacklisting it.
If connection fails, Gradle will retry on certain errors which have a chance of being transient, increasing the amount of time waiting between each retry.</p>
</div>
<div class="paragraph">
<p>Blacklisting happens when the repository cannot be contacted, either because of a permanent error or because the maximum retries was reached.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:dependency_cache"><a class="anchor" href="#sec:dependency_cache"></a><a class="link" href="#sec:dependency_cache">The Dependency Cache</a></h5>
<div class="paragraph">
<p>Gradle contains a highly sophisticated dependency caching mechanism, which seeks to minimise the number of remote requests made in dependency resolution, while striving to guarantee that the results of dependency resolution are correct and reproducible.</p>
</div>
<div class="paragraph">
<p>The Gradle dependency cache consists of two storage types located under <code>GRADLE_USER_HOME/caches</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A file-based store of downloaded artifacts, including binaries like jars as well as raw downloaded meta-data like POM files and Ivy files.
The storage path for a downloaded artifact includes the SHA1 checksum, meaning that 2 artifacts with the same name but different content can easily be cached.</p>
</li>
<li>
<p>A binary store of resolved module metadata, including the results of resolving dynamic versions, module descriptors, and artifacts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Gradle cache does not allow the local cache to hide problems and create other mysterious and difficult to debug behavior.
Gradle enables reliable and reproducible enterprise builds with a focus on bandwidth and storage efficiency.</p>
</div>
<div class="sect5">
<h6 id="sub:cache_metadata"><a class="anchor" href="#sub:cache_metadata"></a><a class="link" href="#sub:cache_metadata">Separate metadata cache</a></h6>
<div class="paragraph">
<p>Gradle keeps a record of various aspects of dependency resolution in binary format in the metadata cache.
The information stored in the metadata cache includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The result of resolving a dynamic version (e.g. <code>1.+</code>) to a concrete version (e.g. <code>1.2</code>).</p>
</li>
<li>
<p>The resolved module metadata for a particular module, including module artifacts and module dependencies.</p>
</li>
<li>
<p>The resolved artifact metadata for a particular artifact, including a pointer to the downloaded artifact file.</p>
</li>
<li>
<p>The <em>absence</em> of a particular module or artifact in a particular repository, eliminating repeated attempts to access a resource that does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every entry in the metadata cache includes a record of the repository that provided the information as well as a timestamp that can be used for cache expiry.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:cache_repository_independence"><a class="anchor" href="#sub:cache_repository_independence"></a><a class="link" href="#sub:cache_repository_independence">Repository caches are independent</a></h6>
<div class="paragraph">
<p>As described above, for each repository there is a separate metadata cache.
A repository is identified by its URL, type and layout.
If a module or artifact has not been previously resolved from <em>this repository</em>, Gradle will attempt to resolve the module against the repository.
This will always involve a remote lookup on the repository, however in many cases <a href="#sub:cache_artifact_reuse">no download will be required</a>.</p>
</div>
<div class="paragraph">
<p>Dependency resolution will fail if the required artifacts are not available in any repository specified by the build, even if the local cache has a copy of this artifact which was retrieved from a different repository.
Repository independence allows builds to be isolated from each other in an advanced way that no build tool has done before.
This is a key feature to create builds that are reliable and reproducible in any environment.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:cache_artifact_reuse"><a class="anchor" href="#sub:cache_artifact_reuse"></a><a class="link" href="#sub:cache_artifact_reuse">Artifact reuse</a></h6>
<div class="paragraph">
<p>Before downloading an artifact, Gradle tries to determine the checksum of the required artifact by downloading the sha file associated with that artifact.
If the checksum can be retrieved, an artifact is not downloaded if an artifact already exists with the same id and checksum.
If the checksum cannot be retrieved from the remote server, the artifact will be downloaded (and ignored if it matches an existing artifact).</p>
</div>
<div class="paragraph">
<p>As well as considering artifacts downloaded from a different repository, Gradle will also attempt to reuse artifacts found in the local Maven Repository.
If a candidate artifact has been downloaded by Maven, Gradle will use this artifact if it can be verified to match the checksum declared by the remote server.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:cache_checksum_storage"><a class="anchor" href="#sub:cache_checksum_storage"></a><a class="link" href="#sub:cache_checksum_storage">Checksum based storage</a></h6>
<div class="paragraph">
<p>It is possible for different repositories to provide a different binary artifact in response to the same artifact identifier.
This is often the case with Maven SNAPSHOT artifacts, but can also be true for any artifact which is republished without changing its identifier.
By caching artifacts based on their SHA1 checksum, Gradle is able to maintain multiple versions of the same artifact.
This means that when resolving against one repository Gradle will never overwrite the cached artifact file from a different repository.
This is done without requiring a separate artifact file store per repository.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:cache_locking"><a class="anchor" href="#sub:cache_locking"></a><a class="link" href="#sub:cache_locking">Cache Locking</a></h6>
<div class="paragraph">
<p>The Gradle dependency cache uses file-based locking to ensure that it can safely be used by multiple Gradle processes concurrently.
The lock is held whenever the binary metadata store is being read or written, but is released for slow operations such as downloading remote artifacts.</p>
</div>
<div class="paragraph">
<p>This concurrent access is only supported if the different Gradle processes can communicate together. This is usually <em>not the case</em> for containerized builds.</p>
</div>
<div class="sect6">
<h7 id="sub:cache_cleanup"><a class="anchor" href="#sub:cache_cleanup"></a><a class="link" href="#sub:cache_cleanup">Cache Cleanup</a></h7>
<div class="paragraph">
<p>Gradle keeps track of which artifacts in the dependency cache are accessed.
Using this information, the cache is periodically (at most every 24 hours) scanned for artifacts that have not been used for more than 30 days.
Obsolete artifacts are then deleted to ensure the cache does not grow indefinitely.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:ephemeral-ci-cache"><a class="anchor" href="#sub:ephemeral-ci-cache"></a><a class="link" href="#sub:ephemeral-ci-cache">Dealing with ephemeral builds</a></h5>
<div class="paragraph">
<p>It&#8217;s a common practice to run builds in ephemeral containers.
A container is typically spawned to only execute a single build before it is destroyed.
This can become a practical problem when a build depends on a lot of dependencies which each container has to re-download.
To help with this scenario, Gradle provides a couple of options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sub:cache_copy">copying the dependency cache</a> into each container</p>
</li>
<li>
<p><a href="#sub:shared-readonly-cache">sharing a read-only dependency cache</a> between multiple containers</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="sub:cache_copy"><a class="anchor" href="#sub:cache_copy"></a><a class="link" href="#sub:cache_copy">Copying and reusing the cache</a></h6>
<div class="paragraph">
<p>The dependency cache, both the file and metadata parts, are fully encoded using relative paths.
This means that it is perfectly possible to copy a cache around and see Gradle benefit from it.</p>
</div>
<div class="paragraph">
<p>The path that can be copied is <code>$GRADLE_HOME/caches/modules-&lt;version&gt;</code>.
The only constraint is placing it using the same structure at the destination, where the value of <code>GRADLE_HOME</code> can be different.</p>
</div>
<div class="paragraph">
<p>Do not copy the <code>*.lock</code> or <code>gc.properties</code> files if they exist.</p>
</div>
<div class="paragraph">
<p>Note that creating the cache and consuming it should be done using compatible Gradle version, as shown in the table below.
Otherwise, the build might still require some interactions with remote repositories to complete missing information, which might be available in a different version.
If multiple incompatible Gradle versions are in play, all should be used when seeding the cache.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. Dependency cache compatibility</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module cache version</th>
<th class="tableblock halign-left valign-top">File cache version</th>
<th class="tableblock halign-left valign-top">Metadata cache version</th>
<th class="tableblock halign-left valign-top">Gradle version(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.95</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 6.1 to Gradle 6.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modules-2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>files-2.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-2.96</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle 6.4 and above</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="sub:shared-readonly-cache"><a class="anchor" href="#sub:shared-readonly-cache"></a><a class="link" href="#sub:shared-readonly-cache">Sharing the dependency cache with other Gradle instances</a></h6>
<div class="paragraph">
<p>Instead of <a href="#sub:cache_copy">copying the dependency cache into each container</a>, it&#8217;s possible to mount a shared, read-only directory that will act as a dependency cache for all containers.
This cache, unlike the classical dependency cache, is accessed without locking, making it possible for multiple builds to read from the cache concurrently. It&#8217;s important that the read-only cache
is not written to when other builds may be reading from it.</p>
</div>
<div class="paragraph">
<p>When using the shared read-only cache, Gradle looks for dependencies (artifacts or metadata) in both the writable cache in the local Gradle user home directory and the shared read-only cache.
If a dependency is present in the read-only cache, it will not be downloaded.
If a dependency is missing from the read-only cache, it will be downloaded and added to the writable cache.
In practice, this means that the writable cache will only contain dependencies that are unavailable in the read-only cache.</p>
</div>
<div class="paragraph">
<p>The read-only cache should be sourced from a Gradle dependency cache that already contains some of the required dependencies.
The cache can be incomplete; however, an empty shared cache will only add overhead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The shared read-only dependency cache is an incubating feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first step in using a shared dependency cache is to create one by copying of an existing <em>local</em> cache.
For this you need to follow the <a href="#sub:cache_copy">instructions above</a>.</p>
</div>
<div class="paragraph">
<p>Then set the <code>GRADLE_RO_DEP_CACHE</code> environment variable to point to the directory containing the cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$GRADLE_RO_DEP_CACHE
   |-- modules-2 : the read-only dependency cache, should be mounted with read-only privileges

$GRADLE_HOME
   |-- caches
         |-- modules-2 : the container specific dependency cache, should be writable
         |-- ...
   |-- ...</pre>
</div>
</div>
<div class="paragraph">
<p>In a CI environment, it&#8217;s a good idea to have one build which "seeds" a Gradle dependency cache, which is then <em>copied</em> to a different directory.
This directory can then be used as the read-only cache for other builds.
You shouldn&#8217;t use an existing Gradle installation cache as the read-only cache, because this directory may contain locks and may be modified by the seeding build.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:programmatic_api"><a class="anchor" href="#sec:programmatic_api"></a><a class="link" href="#sec:programmatic_api">Accessing the resolution result programmatically</a></h5>
<div class="paragraph">
<p>While most users only need access to a "flat list" of files, there are cases where it can be interesting to reason on a <em>graph</em> and get more information about the resolution result:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for tooling integration, where a model of the dependency graph is required</p>
</li>
<li>
<p>for tasks generating a visual representation (image, <code>.dot</code> file, &#8230;&#8203;) of a dependency graph</p>
</li>
<li>
<p>for tasks providing diagnostics (similar to the <code>dependencyInsight</code> task)</p>
</li>
<li>
<p>for tasks which need to perform dependency resolution at execution time (e.g, download files on demand)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For those use cases, Gradle provides lazy, thread-safe APIs, accessible by calling the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/Configuration.html#getIncoming--">Configuration.getIncoming()</a> method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#getResolutionResult--">ResolutionResult API</a> gives access to a resolved dependency graph, whether the resolution was successful or not.</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#getArtifacts--">artifacts API</a> provides a simple access to the resolved artifacts, untransformed, but with lazy download of artifacts (they would only be downloaded on demand).</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ResolvableDependencies.html#artifactView-org.gradle.api.Action-">artifact view API</a> provides an advanced, filtered view of artifacts, possibly <a href="#sec:abm_artifact_transforms">transformed</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="verifying-dependencies"><a class="anchor" href="#verifying-dependencies"></a><a class="link" href="#verifying-dependencies">Verifying dependencies</a></h4>
<div class="paragraph">
<p>Working with external dependencies and plugins published on third-party repositories puts your build at risk.
In particular, you need to be aware of what binaries are brought in transitively and if they are legit.
To mitigate the security risks and avoid integrating compromised dependencies in your project, Gradle supports <em>dependency verification</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dependency verification is, by nature, an inconvenient feature to use.
It means that whenever you&#8217;re going to update a dependency, builds are likely to fail.
It means that merging branches are going to be harder because each branch can have different dependencies.
It means that you will be tempted to switch it off.</p>
</div>
<div class="paragraph">
<p>So why should you bother?</p>
</div>
<div class="paragraph">
<p>Dependency verification is about <strong>trust</strong> in what you get and what you ship.</p>
</div>
<div class="paragraph">
<p>Without dependency verification it&#8217;s easy for an attacker to compromise your supply chain.
There are many real world examples of tools compromised by adding a malicious dependency.
Dependency verification is meant to protect yourself from those attacks, by forcing you to ensure that the artifacts you include in your build are the ones that you expect.
It is not meant, however, to prevent you from including <em>vulnerable</em> dependencies.</p>
</div>
<div class="paragraph">
<p>Finding the right balance between security and convenience is hard but Gradle will try to let you choose the "right level" for you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependency verification consists of two different and complementary operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>checksum verification</em>, which allows asserting the integrity of a dependency</p>
</li>
<li>
<p><em>signature verification</em>, which allows asserting the provenance of a dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle supports both checksum and signature verification out of the box but performs no dependency verification by default.
This section will guide you into configuring dependency verification properly for your needs.</p>
</div>
<div class="paragraph">
<p>This feature can be used for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>detecting compromised dependencies</p>
</li>
<li>
<p>detecting compromised plugins</p>
</li>
<li>
<p>detecting tampered dependencies in the local dependency caches</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dependency verification is an incubating feature: details are subject to change.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sub:enabling-verification"><a class="anchor" href="#sub:enabling-verification"></a><a class="link" href="#sub:enabling-verification">Enabling dependency verification</a></h5>
<div class="sect5">
<h6 id="sub:verification-metadata"><a class="anchor" href="#sub:verification-metadata"></a><a class="link" href="#sub:verification-metadata">The verification metadata file</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently the only source of dependency verification metadata is this XML configuration file.
Future versions of Gradle may include other sources (for example via external services).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependency verification is automatically enabled once the configuration file for dependency verification is discovered.
This configuration file is located at <code>$PROJECT_ROOT/gradle/verification-metadata.xml</code>.
This file minimally consists of the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so, Gradle will verify all artifacts using <a href="#sec:checksum-verification">checksums</a>, but will not verify <a href="#sec:signature-verification">signatures</a>.
Gradle will verify any artifact downloaded using its dependency management engine, which includes, but is not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>artifact files (e.g jar files, zips, &#8230;&#8203;) used during a build</p>
</li>
<li>
<p>metadata artifacts (POM files, Ivy descriptors, Gradle Module Metadata)</p>
</li>
<li>
<p>plugins (both project and settings plugins)</p>
</li>
<li>
<p>artifacts resolved using the advanced dependency resolution APIs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle will <em>not</em> verify changing dependencies (in particular <code>SNAPSHOT</code> dependencies) nor locally produced artifacts (typically jars produced during the build itself) as by nature their checksums and signatures would always change.</p>
</div>
<div class="paragraph">
<p>With such a minimal configuration file, a project using <em>any</em> external dependency or plugin would immediately start failing because it doesn&#8217;t contain any checksum to verify.</p>
</div>
<div class="paragraph">
<p>A dependency verification configuration is <em>global</em>: a single file is used to configure verification of the whole build.
In particular, the same file is used for both the (sub)projects and <code>buildSrc</code>.</p>
</div>
<div class="paragraph">
<p>An easy way to get started is therefore to generate the minimal configuration for an existing build.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:verification-console-output"><a class="anchor" href="#sec:verification-console-output"></a><a class="link" href="#sec:verification-console-output">Configuring the console output</a></h6>
<div class="paragraph">
<p>By default, if dependency verification fails, Gradle will generate a small summary about the verification failure as well as an HTML report containing the full information about the failures.
If your environment prevents you from reading this HTML report file (for example if you run a build on CI and that it&#8217;s not easy to fetch the remote artifacts), Gradle provides a way to opt-in a verbose console report.
For this, you need to add this Gradle property to your <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.dependency.verification.console=verbose</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:bootstrapping-verification"><a class="anchor" href="#sec:bootstrapping-verification"></a><a class="link" href="#sec:bootstrapping-verification">Bootstrapping dependency verification</a></h6>
<div class="paragraph">
<p>It&#8217;s worth mentioning that while Gradle can generate a dependency verification file for you, you should always check whatever Gradle generated for you because your build may <em>already</em> contain compromised dependencies without you knowing about it.
Please refer to the appropriate <a href="#sec:checksum-verification">checksum verification</a> or <a href="#sec:signature-verification">signature verification</a> section for more information.</p>
</div>
<div class="paragraph">
<p>If you plan on using <a href="#sec:signature-verification">signature verification</a>, please also read the <a href="#sec:bootstrapping-signature-verification">corresponding section</a> of the docs.</p>
</div>
<div class="paragraph">
<p>Bootstrapping can either be used to create a file from the beginning, or also to <em>update</em> an existing file with new information.
Therefore, it&#8217;s recommended to always use the same parameters once you started bootstrapping.</p>
</div>
<div class="paragraph">
<p>The dependency verification file can be generated with the following CLI instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --write-verification-metadata sha256 help</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>write-verification-metadata</code> flag requires the list of <a href="#sec:checksum-verification">checksums</a> that you want to generate or <code>pgp</code> for <a href="#sec:signature-verification">signatures</a>.</p>
</div>
<div class="paragraph">
<p>Executing this command line will cause Gradle to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resolve all <a href="#sec:resolvable-consumable-configs">resolvable configurations</a>, which includes:</p>
<div class="ulist">
<ul>
<li>
<p>configurations from the root project</p>
</li>
<li>
<p>configurations from all subprojects</p>
</li>
<li>
<p>configurations from <code>buildSrc</code></p>
</li>
<li>
<p>included builds configurations</p>
</li>
<li>
<p>configurations used by plugins</p>
</li>
</ul>
</div>
</li>
<li>
<p>download all artifacts discovered during resolution</p>
</li>
<li>
<p>compute the requested checksums and possibly verify signatures depending on what you asked</p>
</li>
<li>
<p>At the end of the build, generate the configuration file which will contain the inferred <em>verification metadata</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, the <code>verification-metadata.xml</code> file will be used in subsequent builds to verify dependencies.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are dependencies that Gradle <em>cannot</em> discover this way.
In particular, you will notice that the CLI above uses the <code>help</code> task.
If you don&#8217;t specify any task, Gradle will automatically run the default task and generate a configuration file at the end of the build too.</p>
</div>
<div class="paragraph">
<p>The difference is that Gradle <em>may</em> discover more dependencies and artifacts depending on the tasks you execute.
As a matter of fact, Gradle cannot automatically discover <em>detached configurations</em>, which are basically dependency graphs resolved as an internal implementation detail of the execution of a task: they are not, in particular, declared as an input of the task because they effectively depend on the configuration of the task at execution time.</p>
</div>
<div class="paragraph">
<p>A good way to start is just to use the simplest task, <code>help</code>, which will discover as much as possible, and if subsequent builds fail with a verification error, you can re-execute generation with the appropriate tasks to "discover" more dependencies.</p>
</div>
<div class="paragraph">
<p>Gradle won&#8217;t verify either checksums or signatures of plugins which use their own HTTP clients.
Only plugins which use the infrastructure provided by Gradle for performing requests will see their requests verified.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If an included build is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configuration file of the <em>current</em> build is used for verification</p>
</li>
<li>
<p>so if the included build itself uses verification, its configuration is ignored in favor of the current one</p>
</li>
<li>
<p>which means that including a build works similarly to upgrading a dependency: it may require you to update your current verification metadata</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sec:verification-dry-mode"><a class="anchor" href="#sec:verification-dry-mode"></a><a class="link" href="#sec:verification-dry-mode">Using dry mode</a></h6>
<div class="paragraph">
<p>By default, bootstrapping is incremental, which means that if you run it multiple times, information is <em>added</em> to the file and in particular you can rely on your VCS to check the diffs.
There are situations where you would just want to <em>see</em> what the generated verification metadata file would look like without actually changing the existing one or overwriting it.</p>
</div>
<div class="paragraph">
<p>For this purpose, you can just add <code>--dry-run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle --write-verification-metadata sha256 help --dry-run</pre>
</div>
</div>
<div class="paragraph">
<p>Then instead of generating the <code>verification-metadata.xml</code> file, a <em>new file</em> will be generated, called <code>verification-metadata.dryrun.xml</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because <code>--dry-run</code> doesn&#8217;t execute tasks, this would be much faster, but it will miss any resolution happening at task execution time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sec:disabling-metadata-verification"><a class="anchor" href="#sec:disabling-metadata-verification"></a><a class="link" href="#sec:disabling-metadata-verification">Disabling metadata verification</a></h6>
<div class="paragraph">
<p>By default, Gradle will not only verify artifacts (jars, &#8230;&#8203;) but also the metadata associated with those artifacts (typically POM files).
Verifying this ensures the maximum level of security: metadata files typically tell what transitive dependencies will be included, so a compromised metadata file may cause the introduction of undesired dependencies in the graph.
However, because all artifacts are verified, such artifacts would in general easily be discovered by you, because they would cause a checksum verification failure (checksums would be <em>missing</em> from verification metadata).
Because metadata verification can significantly increase the size of your configuration file, you may therefore want to disable verification of metadata.
If you understand the risks of doing so, set the <code>&lt;verify-metadata&gt;</code> flag to <code>false</code> in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>false<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
    <span class="comment">&lt;!-- the rest of this file doesn't need to declare anything about metadata files --&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:checksum-verification"><a class="anchor" href="#sec:checksum-verification"></a><a class="link" href="#sec:checksum-verification">Verifying dependency checksums</a></h5>
<div class="paragraph">
<p>Checksum verification allows you to ensure the integrity of an artifact.
This is the simplest thing that Gradle can do for you to make sure that the artifacts you use are un-tampered.</p>
</div>
<div class="paragraph">
<p>Gradle supports MD5, SHA1, SHA-256 and SHA-512 checksums.
However, only SHA-256 and SHA-512 checksums are considered secure nowadays.</p>
</div>
<div class="sect5">
<h6 id="adding_the_checksum_for_an_artifact"><a class="anchor" href="#adding_the_checksum_for_an_artifact"></a><a class="link" href="#adding_the_checksum_for_an_artifact">Adding the checksum for an artifact</a></h6>
<div class="paragraph">
<p>External components are identified by GAV coordinates, then each of the artifacts by their file names.
To declare the checksums of an artifact, you need to add the corresponding section in the verification metadata file.
For example, to declare the checksum for <a href="https://pdfbox.apache.org">Apache PDFBox</a>.
The GAV coordinates are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>group <code>org.apache.pdfbox</code></p>
</li>
<li>
<p>name <code>pdfbox</code></p>
</li>
<li>
<p>version <code>2.0.17</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using this dependency will trigger the download of 2 different files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pdfbox-2.0.17.jar</code> which is the main artifact</p>
</li>
<li>
<p><code>pdfbox-2.0.17.pom</code> which is the metadata file associated with this artifact</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As as consequence, you need to declare the checksums for both of them (unless you <a href="#sec:disabling-metadata-verification">disabled metadata verification</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>false<span class="tag">&lt;/verify-signatures&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;components&gt;</span>
      <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha512</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7e11e54a21c395d461e59552e88b0de0ebaf1bf9d9bcacadf17b240d9bbc29bf6beb8e36896c186fe405d287f5d517b02c89381aa0fcc5e0aa5814e44f0ab331</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PDFBox Official site (https://pdfbox.apache.org/download.cgi)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha512</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">82de436b38faf6121d8d2e71dda06e79296fc0f7bc7aba0766728c8d306fd1b0684b5379c18808ca724bf91707277eba81eb4fe19518e99e8f2a56459b79742f</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Generated by Gradle</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
      <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="where_to_get_checksums_from"><a class="anchor" href="#where_to_get_checksums_from"></a><a class="link" href="#where_to_get_checksums_from">Where to get checksums from?</a></h6>
<div class="paragraph">
<p>In general, checksums are published alongside artifacts on public repositories.
However, if a dependency is compromised in a repository, it&#8217;s likely its checksum will be too, so it&#8217;s a good practice to get the checksum from a different place, usually the website of the library itself.</p>
</div>
<div class="paragraph">
<p>In fact, it&#8217;s a good security practice to publish the checksums of artifacts on a <em>different server</em> than the server where the artifacts themselves are hosted: it&#8217;s harder to compromise a library both on the repository <em>and</em> the official website.</p>
</div>
<div class="paragraph">
<p>In the example above, the checksum was published on the website for the JAR, but not the POM file.
This is why it&#8217;s usually easier to <a href="#sec:bootstrapping-verification">let Gradle generate the checksums</a> and verify by reviewing the generated file carefully.</p>
</div>
<div class="paragraph">
<p>In this example, not only could we check that the checksum was correct, but we could also find it on the official website, which is why we changed the label of <code>origin</code> from <code>Generated by Gradle</code> to <code>PDFBox Official site</code>.
Changing the <code>origin</code> gives users a sense of how trustworthy your build it.</p>
</div>
<div class="paragraph">
<p>Interestingly, using <code>pdfbox</code> will require <em>much more</em> than those 2 artifacts, because it will also bring in transitive dependencies.
If the dependency verification file only included the checksums for the main artifacts you used, the build would fail with an error like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.
    - On artifact commons-logging-1.2.pom (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.</pre>
</div>
</div>
<div class="paragraph">
<p>What this indicates is that your build requires <code>commons-logging</code> when executing <code>compileJava</code>, however the verification file doesn&#8217;t contain enough information for Gradle to verify the integrity of the dependencies, meaning you need to add the required information to the verification metadata file.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:troubleshooting-verification">troubleshooting dependency verification</a> for more insights on what to do in this situation.</p>
</div>
</div>
<div class="sect5">
<h6 id="what_checksums_are_verified"><a class="anchor" href="#what_checksums_are_verified"></a><a class="link" href="#what_checksums_are_verified">What checksums are verified?</a></h6>
<div class="paragraph">
<p>If a dependency verification metadata file declares more than one checksum for a dependency, Gradle will verify <em>all of them</em> and fail if <em>any of them fails</em>.
For example, the following configuration would check both the <code>md5</code> and <code>sha256</code> checksums:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdfbox-2.0.17.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;md5</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c713a8e252d0add65e9282b151adf6b4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official site</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;sha1</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b5c8dff799bd967c70ccae75e6972327ae640d35</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official site</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are multiple reasons why you&#8217;d like to do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>an official site doesn&#8217;t publish <em>secure</em> checksums (SHA-256, SHA-512) but publishes multiple insecure ones (MD5, SHA1). While it&#8217;s easy to fake a MD5 checksum and hard but possible to fake a SHA1 checksum, it&#8217;s harder to fake both of them for the same artifact.</p>
</li>
<li>
<p>you might want to add generated checksums to the list above</p>
</li>
<li>
<p>when <em>updating</em> dependency verification file with more secure checksums, you don&#8217;t want to accidentally erase checksums</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:signature-verification"><a class="anchor" href="#sec:signature-verification"></a><a class="link" href="#sec:signature-verification">Verifying dependency signatures</a></h5>
<div class="paragraph">
<p>In addition to <a href="#sec:checksum-verification">checksums</a>, Gradle supports verification of signatures.
Signatures are used to assess the <em>provenance</em> of a dependency (it tells who signed the artifacts, which usually corresponds to who produced it).</p>
</div>
<div class="paragraph">
<p>As enabling signature verification usually means a higher level of security, you might want to replace checksum verification with signature verification.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Signatures <em>can</em> also be used to assess the integrity of a dependency similarly to checksums.
Signatures are signatures of the <em>hash</em> of artifacts, not artifacts themselves.
This means that if the signature is done on an <em>unsafe hash</em> (even SHA1), then you&#8217;re not correctly assessing the <em>integrity</em> of a file.
For this reason, if you care about both, you need to add both signatures <em>and</em> checksums to your verification metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle only supports verification of signatures published on remote repositories as ASCII-armored PGP files</p>
</li>
<li>
<p>Not all artifacts are published with signatures</p>
</li>
<li>
<p>A good signature doesn&#8217;t mean that the signatory was legit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, signature verification will often be used alongside checksum verification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">About expired keys</div>
<div class="paragraph">
<p>It&#8217;s very common to find artifacts which are signed with an expired key.
This is not a problem for <em>verification</em>: key expiry is mostly used to avoid signing with a stolen key.
If an artifact was signed before expiry, it&#8217;s still valid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="enabling_signature_verification"><a class="anchor" href="#enabling_signature_verification"></a><a class="link" href="#enabling_signature_verification">Enabling signature verification</a></h6>
<div class="paragraph">
<p>Because verifying signatures is more expensive (both I/O and CPU wise) and harder to check manually, it&#8217;s not enabled by default.</p>
</div>
<div class="paragraph">
<p>Enabling it requires you to change the configuration option in the <code>verification-metadata.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:understanding-signature-verification"><a class="anchor" href="#sec:understanding-signature-verification"></a><a class="link" href="#sec:understanding-signature-verification">Understanding signature verification</a></h5>
<div class="paragraph">
<p>Once signature verification is enabled, for each artifact, Gradle will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>try to download the corresponding <code>.asc</code> file</p>
</li>
<li>
<p>if it&#8217;s present</p>
<div class="ulist">
<ul>
<li>
<p>automatically download the keys required to perform verification of the signature</p>
</li>
<li>
<p>verify the artifact using the downloaded public keys</p>
</li>
<li>
<p>if signature verification passes, perform additional requested checksum verification</p>
</li>
</ul>
</div>
</li>
<li>
<p>if it&#8217;s absent, fallback to checksum verification</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That is to say that Gradle verification mechanism is much stronger if signature verification is enabled than just with checksum verification.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if an artifact is signed with multiple keys, all of them must pass validation or the build will fail</p>
</li>
<li>
<p>if an artifact passes verification, any additional checksum configured for the artifact <em>will also be checked</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it&#8217;s not because an artifact passes signature verification that you can trust it: you need to <em>trust the keys</em>.</p>
</div>
<div class="paragraph">
<p>In practice, it means you need to list the keys that you trust for each artifact, which is done by adding a <code>pgp</code> entry instead of a <code>sha1</code> for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;pgp</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8756c4f765c9ac3cb6b85d62379ce192d401ab61</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Gradle supports both full fingerprint ids or long (64-bit) key ids in <code>pgp</code>, <code>trusted-key</code> and <code>ignore-key</code> elements.
For maximum security, you should use full fingerprints as it&#8217;s possible to have collisions for long key ids.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This effectively means that you trust <code>com.github.javaparser:javaparser-core:3.6.11</code> if it&#8217;s signed with the key <code>8756c4f765c9ac3cb6b85d62379ce192d401ab61</code>.</p>
</div>
<div class="paragraph">
<p>Without this, the build would fail with this error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '8756c4f765c9ac3cb6b85d62379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) and passed verification but the key isn't in your trusted keys list.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The key IDs that Gradle shows in error messages are the key IDs found in the signature file it tries to verify.
It doesn&#8217;t mean that it&#8217;s necessarily the keys that you should trust.
In particular, if the signature is correct but done by a malicious entity, Gradle wouldn&#8217;t tell you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="sec:trusting-keys-globally"><a class="anchor" href="#sec:trusting-keys-globally"></a><a class="link" href="#sec:trusting-keys-globally">Trusting keys globally</a></h6>
<div class="paragraph">
<p>Signature verification has the advantage that it can make the configuration of dependency verification easier by not having to explicitly list all artifacts like for checksum verification only.
In fact, it&#8217;s common that the same key can be used to sign several artifacts.
If this is the case, you can move the trusted key from the artifact level to the global configuration block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;trusted-keys&gt;</span>
         <span class="tag">&lt;trusted-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-keys&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;components</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above means that for any artifact belonging to the group <code>com.github.javaparser</code>, we trust it if it&#8217;s signed with the <code>379ce192d401ab61</code>.</p>
</div>
<div class="paragraph">
<p>The <code>trusted-key</code> element works similarly to the <a href="#sec:trusting-artifacts">trusted-artifact</a> element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code>, the group of the artifact to trust</p>
</li>
<li>
<p><code>name</code>, the name of the artifact to trust</p>
</li>
<li>
<p><code>version</code>, the version of the artifact to trust</p>
</li>
<li>
<p><code>file</code>, the name of the artifact <em>file</em> to trust</p>
</li>
<li>
<p><code>regex</code>, a boolean saying if the <code>group</code>, <code>name</code>, <code>version</code> and <code>file</code> attributes need to be interpreted as regular expressions (defaults to <code>false</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>You should be careful when trusting a key globally: try to limit it to the appropriate groups or artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a valid key may have been used to sign artifact <code>A</code> which you trust</p>
</li>
<li>
<p>later on, the key is stolen and used to sign artifact <code>B</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It means you can trust the key <code>A</code> for the first artifact, probably only up to the released version before the key was stolen, but not for <code>B</code>.</p>
</div>
<div class="paragraph">
<p>Remember that anybody can put an arbitrary name when generating a PGP key, so never trust the key solely based on the key name.
Verify if the key is listed at the official site.
For example, Apache projects typically provide a KEYS.txt file that you can trust.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sec:ignoring-keys"><a class="anchor" href="#sec:ignoring-keys"></a><a class="link" href="#sec:ignoring-keys">Specifying key servers and ignoring keys</a></h6>
<div class="paragraph">
<p>Gradle will automatically download the public keys required to verify a signature.
For this it uses a list of well known and trusted key servers (the list may change between Gradle versions, please refer to the implementation to figure out what servers are used by default).</p>
</div>
<div class="paragraph">
<p>You can explicitly set the list of key servers that you want to use by adding them to the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;key-servers&gt;</span>
         <span class="tag">&lt;key-server</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hkp://my-key-server.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;key-server</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://my-other-key-server.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/key-servers&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite this, it&#8217;s possible that a key is not available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because it wasn&#8217;t published to a public key server</p>
</li>
<li>
<p>because it was lost</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, you can ignore a key in the configuration block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;verify-metadata&gt;</span>true<span class="tag">&lt;/verify-metadata&gt;</span>
      <span class="tag">&lt;verify-signatures&gt;</span>true<span class="tag">&lt;/verify-signatures&gt;</span>
      <span class="tag">&lt;ignored-keys&gt;</span>
         <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abcdef1234567890</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Key is not available in any key server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/ignored-keys&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As soon as a key is ignored, it will not be used for verification, even if the signature file mentions it.
However, if the signature cannot be verified with at least one other key, Gradle will mandate that you provide a checksum.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:local-keyring"><a class="anchor" href="#sec:local-keyring"></a><a class="link" href="#sec:local-keyring">Exporting keys for faster verification</a></h6>
<div class="paragraph">
<p>Gradle automatically downloads the required keys but this operation can be quite slow and requires everyone to download the keys.
To avoid this, Gradle offers the ability to use a local keyring file containing the required public keys.</p>
</div>
<div class="paragraph">
<p>If the <code>gradle/verification-keyring.gpg</code> file is present, Gradle will search for keys there in priority.</p>
</div>
<div class="paragraph">
<p>You can generate this file using GPG, for example issuing the following commands (syntax may depend on the tool you use):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gpg --no-default-keyring --keyring gradle/verification-keyring.gpg --recv-keys 379ce192d401ab61

gpg: keybox 'gradle/verification-keyring.gpg' created
gpg: key 379CE192D401AB61: public key &quot;Bintray (by JFrog) &lt;****&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1

$ gpg --no-default-keyring --keyring gradle/verification-keyring.gpg --recv-keys 6a0975f8b1127b83

gpg: key 0729A0AFF8999A87: public key &quot;Kotlin Release &lt;****&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, alternatively, you can <em>ask Gradle to export all keys it used for verification of this build to the keyring</em> during bootstrapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --write-verification-metadata pgp,sha256 --export-keys</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s a good idea to commit this file to VCS (as long as you trust your VCS).
If you use git, make sure to make it treat this file as binary, by adding this to your <code>.gitattributes</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*.gpg           binary</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sec:bootstrapping-signature-verification"><a class="anchor" href="#sec:bootstrapping-signature-verification"></a><a class="link" href="#sec:bootstrapping-signature-verification">Bootstrapping and signature verification</a></h6>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Signature verification bootstrapping takes an <em>optimistic point of view</em> that signature verification is <em>enough</em>.
Therefore, if you also care about <em>integrity</em>, you <strong>must</strong> first bootstrap using checksum verification, <em>then</em> with signature verification.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly to bootstrapping for checksums, Gradle provides a convenience for bootstrapping a configuration file with signature verification enabled.
For this, just add the <code>pgp</code> option to the list of verifications to generate.
However, because there might be verification failures, missing keys or missing signature files, you <strong>must</strong> provide a fallback checksum verification algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --write-verification-metadata pgp,sha256</pre>
</div>
</div>
<div class="paragraph">
<p>this means that Gradle will verify the signatures and fallback to SHA-256 checksums when there&#8217;s a problem.</p>
</div>
<div class="paragraph">
<p>When bootstrapping, Gradle performs <em>optimistic verification</em> and therefore assumes a sane build environment.
It will therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>automatically add the trusted keys as soon as verification passes</p>
</li>
<li>
<p>automatically add ignored keys for keys which couldn&#8217;t be downloaded from public key servers</p>
</li>
<li>
<p>automatically generate checksums for artifacts without signatures or ignored keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If, for some reason, verification fails during the generation, Gradle will automatically generate an ignored key entry but warn you that you must absolutely check what happens.</p>
</div>
<div class="paragraph">
<p>This situation is common as explained for <a href="#sec:trusting-several-checksums">this section</a>: a typical case is when the POM file for a dependency differs from one repository to the other (often in a non-meaningful way).</p>
</div>
<div class="paragraph">
<p>In addition, Gradle will try to group keys automatically and generate the <code>trusted-keys</code> block which reduced the configuration file size as much as possible.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:troubleshooting-verification"><a class="anchor" href="#sec:troubleshooting-verification"></a><a class="link" href="#sec:troubleshooting-verification">Troubleshooting dependency verification</a></h5>
<div class="sect5">
<h6 id="sec:dealing-verification-failure"><a class="anchor" href="#sec:dealing-verification-failure"></a><a class="link" href="#sec:dealing-verification-failure">Dealing with a verification failure</a></h6>
<div class="paragraph">
<p>Dependency verification can fail in different ways, this section explains how you should deal with the various cases.</p>
</div>
<div class="sect6">
<h7 id="missing_verification_metadata"><a class="anchor" href="#missing_verification_metadata"></a><a class="link" href="#missing_verification_metadata">Missing verification metadata</a></h7>
<div class="paragraph">
<p>The simplest failure you can have is the indication that verification metadata is missing from the dependency verification file.
This is the case for example if you use <a href="#sec:checksum-verification">checksum verification</a>, that you update a dependency and that new versions of the dependency (and potentially its transitive dependencies) are brought in.</p>
</div>
<div class="paragraph">
<p>Gradle will tell you what metadata is missing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': checksum is missing from verification metadata.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the missing module group is <code>commons-logging</code>, it&#8217;s artifact name is <code>commons-logging</code> and its version is <code>1.2</code>. The corresponding artifact is <code>commons-logging-1.2.jar</code> so you need to add the following entry to the verification file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-logging-1.2.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">daddea1ea0be0f56978ab3006b8ac92834afeefbd9b7e4e6316fca57df0fa636</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">origin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">official distribution</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/artifact&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can ask Gradle to generate the missing information by using the <a href="#sec:bootstrapping-verification">bootstrapping mechanism</a>: existing information in the metadata file will be preserved, Gradle will only add the missing verification metadata.</p>
</div>
</div>
<div class="sect6">
<h7 id="incorrect_checksums"><a class="anchor" href="#incorrect_checksums"></a><a class="link" href="#incorrect_checksums">Incorrect checksums</a></h7>
<div class="paragraph">
<p>A more problematic issue is when the actual checksum verification fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution failed for task ':compileJava'.
&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact commons-logging-1.2.jar (commons-logging:commons-logging:1.2) in repository 'MavenRepo': expected a 'sha256' checksum of '91f7a33096ea69bac2cbaf6d01feb934cac002c48d8c8cfa9c240b40f1ec21df' but was 'daddea1ea0be0f56978ab3006b8ac92834afeefbd9b7e4e6316fca57df0fa636'</pre>
</div>
</div>
<div class="paragraph">
<p>This time, Gradle tells you what dependency is at fault, what was the expected checksum (the one you declared in the verification metadata file) and the one which was actually computed during verification.</p>
</div>
<div class="paragraph">
<p>Such a failure indicates that a <strong>dependency may have been compromised</strong>.
At this stage, you <strong>must</strong> perform manual verification and check what happens.
Several things can happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a dependency was tampered in the local dependency cache of Gradle. This is usually harmless: erase the file from the cache and Gradle would redownload the dependency.</p>
</li>
<li>
<p>a dependency is available in multiple sources with slightly different binaries (additional whitespace, &#8230;&#8203;)</p>
<div class="ulist">
<ul>
<li>
<p>please inform the maintainers of the library that they have such an issue</p>
</li>
<li>
<p>you can use <a href="#sec:trusting-several-checksums"><code>also-trust</code></a> to accept the additional checksums</p>
</li>
</ul>
</div>
</li>
<li>
<p>the dependency was compromised</p>
<div class="ulist">
<ul>
<li>
<p>immediately inform the maintainers of the library</p>
</li>
<li>
<p>notify the repository maintainers of the compromised library</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that a variation of a compromised library is often <em>name squatting</em>, when a hacker would use GAV coordinates which <em>look legit</em> but are actually different by one character, or <em>repository shadowing</em>, when a dependency with the official GAV coordinates is published in a malicious repository which comes first in your build.</p>
</div>
</div>
<div class="sect6">
<h7 id="untrusted_signatures"><a class="anchor" href="#untrusted_signatures"></a><a class="link" href="#untrusted_signatures">Untrusted signatures</a></h7>
<div class="paragraph">
<p>If you have signature verification enabled, Gradle will perform verification of the signatures but will not trust them automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) and passed verification but the key isn't in your trusted keys list.</pre>
</div>
</div>
<div class="paragraph">
<p>In this case it means you need to check yourself if the key that was used for verification (and therefore the signature) can be trusted, in which case refer to <a href="#sec:understanding-signature-verification">this section of the documentation</a> to figure out how to declare trusted keys.</p>
</div>
</div>
<div class="sect6">
<h7 id="failed_signature_verification"><a class="anchor" href="#failed_signature_verification"></a><a class="link" href="#failed_signature_verification">Failed signature verification</a></h7>
<div class="paragraph">
<p>If Gradle fails to verify a signature, you will need to take action and verify artifacts manually because this <strong>may indicate a compromised dependency</strong>.</p>
</div>
<div class="paragraph">
<p>If such a thing happens, Gradle will fail with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact javaparser-core-3.6.11.jar (com.github.javaparser:javaparser-core:3.6.11) in repository 'MavenRepo': Artifact was signed with key '379ce192d401ab61' (Bintray (by JFrog) &lt;****&gt;) but signature didn't match</pre>
</div>
</div>
<div class="paragraph">
<p>There are several options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>signature was wrong in the first place, which happens frequently with <a href="#sec:trusting-several-checksums">dependencies published on different repositories</a>.</p>
</li>
<li>
<p>the signature is correct but the artifact has been compromised (either in the local dependency cache or remotely)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The right approach here is to go to the official site of the dependency and see if they publish signatures for their artifacts.
If they do, verify that the signature that Gradle downloaded matches the one published.</p>
</div>
<div class="paragraph">
<p>If you have <a href="#sec:manual-checking-dependency">checked that the dependency is <em>not</em> compromised</a> and that it&#8217;s "only" the signature which is wrong, you should declare an <em>artifact level key exclusion</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;components&gt;</span>
       <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ignored-keys&gt;</span>
                <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">internal repo has corrupted POM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;/ignored-keys&gt;</span>
          <span class="tag">&lt;/artifact&gt;</span>
       <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you only do so, Gradle will still fail because all keys for this artifact will be ignored and you didn&#8217;t provide a checksum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;components&gt;</span>
       <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.javaparser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.6.11</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javaparser-core-3.6.11.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ignored-keys&gt;</span>
                <span class="tag">&lt;ignored-key</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">379ce192d401ab61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">internal repo has corrupted POM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;/ignored-keys&gt;</span>
             <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a2023504cfd611332177f96358b6f6db26e43d96e8ef4cff59b0f5a2bee3c1e1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/artifact&gt;</span>
       <span class="tag">&lt;/component&gt;</span>
   <span class="tag">&lt;/components&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="sec:manual-checking-dependency"><a class="anchor" href="#sec:manual-checking-dependency"></a><a class="link" href="#sec:manual-checking-dependency">Manual verification of a dependency</a></h7>
<div class="paragraph">
<p>You will likely face a dependency verification failure (either checksum verification or signature verification) and will need to figure out if the dependency has been compromised or not.</p>
</div>
<div class="paragraph">
<p>In this section we give <em>an example</em> how you can manually check if a dependency was compromised.</p>
</div>
<div class="paragraph">
<p>For this we will take this example failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
- On artifact j2objc-annotations-1.1.jar (com.google.j2objc:j2objc-annotations:1.1) in repository 'MyCompany Mirror': Artifact was signed with key '29579f18fa8fd93b' but signature didn't match</pre>
</div>
</div>
<div class="paragraph">
<p>This error message gives us the GAV coordinates of the problematic dependency, as well as an indication of where the dependency was fetched from.
Here, the dependency comes from <code>MyCompany Mirror</code>, which is a repository declared in our build.</p>
</div>
<div class="paragraph">
<p>The first thing to do is therefore to download the artifact and its signature manually from the mirror:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar --output j2objc-annotations-1.1.jar
$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar.asc --output j2objc-annotations-1.1.jar.asc</pre>
</div>
</div>
<div class="paragraph">
<p>Then we can use the key information provided in the error message to import the key locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --recv-keys 29579f18fa8fd93b</pre>
</div>
</div>
<div class="paragraph">
<p>And perform verification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --verify j2objc-annotations-1.1.jar.asc
gpg: assuming signed data in 'j2objc-annotations-1.1.jar'
gpg: Signature made Thu 19 Jan 2017 12:06:51 AM CET
gpg:                using RSA key 29579F18FA8FD93B
gpg: BAD signature from "Tom Ball &lt;****&gt;" [unknown]</pre>
</div>
</div>
<div class="paragraph">
<p>What this tells us is that the problem is <em>not</em> on the local machine: the repository <em>already contains a bad signature</em>.</p>
</div>
<div class="paragraph">
<p>The next step is to do the same by downloading what is actually on Maven Central:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar  --output central-j2objc-annotations-1.1.jar
$ curl https://my-company-mirror.com/repo/com/google/j2objc/j2objc-annotations/1/1/j2objc-annotations-1.1.jar.asc  --output central-j2objc-annotations-1.1.jar.asc</pre>
</div>
</div>
<div class="paragraph">
<p>And we can now check the signature again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gpg --verify central-j2objc-annotations-1.1.jar.asc

gpg: assuming signed data in 'central-j2objc-annotations-1.1.jar'
gpg: Signature made Thu 19 Jan 2017 12:06:51 AM CET
gpg:                using RSA key 29579F18FA8FD93B
gpg: Good signature from "Tom Ball &lt;****&gt;" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: B801 E2F8 EF03 5068 EC11  39CC 2957 9F18 FA8F D93B</pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that the dependency is <em>valid</em> on Maven Central.
At this stage, we already know that the problem lives in the mirror, it <em>may</em> have been compromised, but we need to verify.</p>
</div>
<div class="paragraph">
<p>A good idea is to compare the 2 artifacts, which you can do with a tool like <a href="https://try.diffoscope.org/">diffoscope</a>.</p>
</div>
<div class="paragraph">
<p>We then figure out that the intent wasn&#8217;t malicious but that somehow a build has been overwritten with a newer version (the version in Central is newer than the one in our repository).</p>
</div>
<div class="paragraph">
<p>In this case, you can decide to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ignore the signature for this artifact and trust the different possible checksums (both for the old artifact and the new version)</p>
</li>
<li>
<p>or cleanup your mirror so that it contains the same version as in Maven Central</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that if you choose to delete the version from your repository, you will <em>also</em> need to remove it from the local Gradle cache.</p>
</div>
<div class="paragraph">
<p>This is facilitated by the fact the error message tells you were the file is located:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Dependency verification failed for configuration ':compileClasspath':
    - On artifact j2objc-annotations-1.1.jar (com.google.j2objc:j2objc-annotations:1.1) in repository 'MyCompany Mirror': Artifact was signed with key '29579f18fa8fd93b' but signature didn't match

  This can indicate that a dependency has been compromised. Please carefully verify the signatures and checksums.

  For your information here are the path to the files which failed verification:
    - GRADLE_USER_HOME/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1/976d8d30bebc251db406f2bdb3eb01962b5685b3/j2objc-annotations-1.1.jar (signature: GRADLE_USER_HOME/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1/82e922e14f57d522de465fd144ec26eb7da44501/j2objc-annotations-1.1.jar.asc)

  GRADLE_USER_HOME = /home/jiraya/.gradle</pre>
</div>
</div>
<div class="paragraph">
<p>You can safely delete the artifact file as Gradle would automatically re-download it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rm -rf ~/.gradle/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.1</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:disabling-verification"><a class="anchor" href="#sec:disabling-verification"></a><a class="link" href="#sec:disabling-verification">Disabling verification or making it lenient</a></h6>
<div class="paragraph">
<p>Dependency verification can be expensive, or sometimes verification could get in the way of day to day development (because of frequent dependency upgrades, for example).</p>
</div>
<div class="paragraph">
<p>Alternatively, you might want to enable verification on CI servers but not on local machines.</p>
</div>
<div class="paragraph">
<p>Gradle actually provides 3 different verification modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>strict</code>, which is the default.
Verification fails <em>as early as possible</em>, in order to avoid the use of compromised dependencies during the build.</p>
</li>
<li>
<p><code>lenient</code>, which will run the build even if there are verification failures.
The verification errors will be displayed during the build without causing a build failure.</p>
</li>
<li>
<p><code>off</code> when verification is totally ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All those modes can be activated on the CLI using the <code>--dependency-verification</code> flag, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew --dependency-verification lenient build</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can set the <code>org.gradle.dependency.verification</code> system property, either on the CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew -Dorg.gradle.dependency.verification=lenient build</pre>
</div>
</div>
<div class="paragraph">
<p>or in a <code>gradle.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.gradle.dependency.verification=lenient</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:trusting-artifacts"><a class="anchor" href="#sec:trusting-artifacts"></a><a class="link" href="#sec:trusting-artifacts">Trusting some particular artifacts</a></h6>
<div class="paragraph">
<p>You might want to trust some artifacts more than others.
For example, it&#8217;s legitimate to think that artifacts produced in your company and found in your internal repository only are safe, but you want to check every external component.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is a typical <em>company policy</em>.
In practice, <strong>nothing</strong> prevents your internal repository from being compromised, so it&#8217;s a good idea to check your internal artifacts too!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this purpose, Gradle offers a way to automatically trust some artifacts.
You can trust all artifacts in a group by adding this to your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;trusted-artifacts&gt;</span>
         <span class="tag">&lt;trust</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-artifacts&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that all components which group is <code>com.mycompany</code> will automatically be trusted.
Trusted means that Gradle will not perform any verification whatsoever.</p>
</div>
<div class="paragraph">
<p>The <code>trust</code> element accepts those attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code>, the group of the artifact to trust</p>
</li>
<li>
<p><code>name</code>, the name of the artifact to trust</p>
</li>
<li>
<p><code>version</code>, the version of the artifact to trust</p>
</li>
<li>
<p><code>file</code>, the name of the artifact <em>file</em> to trust</p>
</li>
<li>
<p><code>regex</code>, a boolean saying if the <code>group</code>, <code>name</code>, <code>version</code> and <code>file</code> attributes need to be interpreted as regular expressions (defaults to <code>false</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example above it means that the trusted artifacts would be artifacts in <code>com.mycompany</code> but not <code>com.mycompany.other</code>.
To trust all artifacts in <code>com.mycompany</code> and all subgroups, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;verification-metadata&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;trusted-artifacts&gt;</span>
         <span class="tag">&lt;trust</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^com[.]mycompany($|([.].*))</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/trusted-artifacts&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/verification-metadata&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:trusting-several-checksums"><a class="anchor" href="#sec:trusting-several-checksums"></a><a class="link" href="#sec:trusting-several-checksums">Trusting multiple checksums for an artifact</a></h6>
<div class="paragraph">
<p>It&#8217;s quite common to have <em>different checksums for the same artifact</em> in the wild.
How is that possible?
Despite progress, it&#8217;s often the case that developers publish, for example, to Maven Central and JCenter separately, using different builds.
In general, this is not a problem but sometimes it means that the metadata files would be different (different timestamps, additional whitespaces, &#8230;&#8203;).
Add to this that your build may use several repositories or repository mirrors and it makes it quite likely that a single build can "see" different metadata files for the same component!
In general, it&#8217;s not malicious (but you <strong>must</strong> verify that the artifact is actually correct), so Gradle lets you declare the additional artifact checksums.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">      <span class="tag">&lt;component</span> <span class="attribute-name">group</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">13</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;artifact</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apache-13.pom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sha256</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2fafa38abefe1b40283016f506ba9e844bfcf18713497284264166a5dbf4b95e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
               <span class="tag">&lt;also-trust</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ff513db0361fd41237bef4784968bc15aae478d4ec0a9496f811072ccaf3841d</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/sha256&gt;</span>
         <span class="tag">&lt;/artifact&gt;</span>
      <span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can have as many <code>also-trust</code> entries as needed, but in general you shouldn&#8217;t have more than 2.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:skipping-javadocs"><a class="anchor" href="#sec:skipping-javadocs"></a><a class="link" href="#sec:skipping-javadocs">Skipping Javadocs and sources</a></h6>
<div class="paragraph">
<p>By default Gradle will verify <em>all</em> downloaded artifacts, which includes Javadocs and sources.
In general this is not a problem but you might face an issue with IDEs which automatically try to download them during import: if you didn&#8217;t set the checksums for those too, importing would fail.</p>
</div>
<div class="paragraph">
<p>To avoid this, you can configure Gradle to trust automatically all javadocs/sources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;trusted-artifacts&gt;</span>
   <span class="tag">&lt;trust</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*-javadoc[.]jar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;trust</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*-sources[.]jar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/trusted-artifacts&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:verification-metadata-hygiene"><a class="anchor" href="#sec:verification-metadata-hygiene"></a><a class="link" href="#sec:verification-metadata-hygiene">Cleaning up the verification file</a></h6>
<div class="paragraph">
<p>If you do nothing, the dependency verification metadata will grow over time as you add new dependencies or change versions: Gradle will not automatically remove <em>unused</em> entries from this file.
The reason is that there&#8217;s no way for Gradle to know upfront if a dependency will effectively be used during the build or not.</p>
</div>
<div class="paragraph">
<p>As a consequence, adding dependencies or changing dependency version can easily lead to more entries in the file, while leaving unnecessary entries out there.</p>
</div>
<div class="paragraph">
<p>One option to cleanup the file is to move the existing <code>verification-metadata.xml</code> file to a different location and call Gradle with the <a href="#sec:verification-dry-mode"><code>--dry-run</code> mode</a>: while not perfect (it will not notice dependencies only resolved at configuration time), it generates <em>a new file</em> that you can compare with the existing one.</p>
</div>
<div class="paragraph">
<p>We need to move the existing file because both the bootstrapping mode and the dry-run mode are incremental: they copy information from the existing metadata verification file (in particular, trusted keys).</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:refreshing-missing-keys"><a class="anchor" href="#sec:refreshing-missing-keys"></a><a class="link" href="#sec:refreshing-missing-keys">Refreshing missing keys</a></h6>
<div class="paragraph">
<p>Gradle caches missing keys for 24 hours, meaning it will not attempt to re-download the missing keys for 24 hours after failing.</p>
</div>
<div class="paragraph">
<p>If you want to retry immediately, you can run with the <code>--refresh-keys</code> CLI flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew build --refresh-keys</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:disabling-specific-verification"><a class="anchor" href="#sub:disabling-specific-verification"></a><a class="link" href="#sub:disabling-specific-verification">Disabling dependency verification for some configurations only</a></h5>
<div class="paragraph">
<p>In order to provide the strongest security level possible, dependency verification is enabled globally.
This will ensure, for example, that you trust all the plugins you use.
However, the plugins themselves may need to resolve additional dependencies that it doesn&#8217;t make sense to ask the user to accept.
For this purpose, Gradle provides an API which allows <em>disabling dependency verification on some specific configurations</em>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling dependency verification, if you care about security, is not a good idea.
This API mostly exist for cases where it doesn&#8217;t make sense to check dependencies.
However, in order to be on the safe side, Gradle will systematically print a warning whenever verification has been disabled for a specific configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, a plugin may want to check if there are <em>newer</em> versions of a library available and list those versions.
It doesn&#8217;t make sense, in this context, to ask the user to put the checksums of the POM files of the newer releases because by definition, they don&#8217;t know about them.
So the plugin might need to run its code <em>independently of the dependency verification configuration</em>.</p>
</div>
<div class="paragraph">
<p>To do this, you need to call the <code>ResolutionStrategy#disableDependencyVerification</code> method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 292. Disabling dependency verification</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myPluginClasspath {
        resolutionStrategy {
            disableDependencyVerification()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;myPluginClasspath&quot; {
        resolutionStrategy {
            disableDependencyVerification()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to disable verification on detached configurations like in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 293. Disabling dependency verification</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">checkDetachedDependencies</span><span class="delimiter">&quot;</span></span>) {
    doLast {
        <span class="keyword">def</span> detachedConf = configurations.detachedConfiguration(dependencies.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons:commons-lang3:3.3.1</span><span class="delimiter">&quot;</span></span>))
        detachedConf.resolutionStrategy.disableDependencyVerification()
        println(detachedConf.files)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;checkDetachedDependencies&quot;) {
    doLast {
        val detachedConf = configurations.detachedConfiguration(dependencies.create(&quot;org.apache.commons:commons-lang3:3.3.1&quot;))
        detachedConf.resolutionStrategy.disableDependencyVerification()
        println(detachedConf.files)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="declaring_versions"><a class="anchor" href="#declaring_versions"></a><a class="link" href="#declaring_versions">Declaring Versions</a></h3>
<div class="sect3">
<h4 id="single-version-declarations"><a class="anchor" href="#single-version-declarations"></a><a class="link" href="#single-version-declarations">Declaring Versions and Ranges</a></h4>
<div class="paragraph">
<p>The simplest version declaration is a <em>simple string</em> representing the version to use.
Gradle supports different ways of declaring a version string:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An exact version: e.g. <code>1.3</code>, <code>1.3.0-beta3</code>, <code>1.0-20150201.131010-1</code></p>
</li>
<li>
<p>A Maven-style version range: e.g. <code>[1.0,)</code>, <code>[1.1, 2.0)</code>, <code>(1.2, 1.5]</code></p>
<div class="ulist">
<ul>
<li>
<p>The <code>[</code> and <code>]</code> symbols indicate an inclusive bound; <code>(</code> and <code>)</code> indicate an exclusive bound.</p>
</li>
<li>
<p>When the upper or lower bound is missing, the range has no upper or lower bound.</p>
</li>
<li>
<p>The symbol <code>]</code> can be used instead of <code>(</code> for an exclusive lower bound, and <code>[</code> instead of <code>)</code> for exclusive upper bound. e.g <code>]1.0, 2.0[</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>A <em>prefix</em> version range: e.g. <code>1.+</code>, <code>1.3.+</code></p>
<div class="ulist">
<ul>
<li>
<p>Only versions exactly matching the portion before the <code>+</code> are included.</p>
</li>
<li>
<p>The range <code>+</code> on it&#8217;s own will include any version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <code>latest-status</code> version: e.g. <code>latest.integration</code>, <code>latest.release</code></p>
<div class="ulist">
<ul>
<li>
<p>Will match the highest versioned module with the specified status. See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadata.html#getStatus--">ComponentMetadata.getStatus()</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A Maven <code>SNAPSHOT</code> version identifier: e.g. <code>1.0-SNAPSHOT</code>, <code>1.4.9-beta1-SNAPSHOT</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="version_ordering"><a class="anchor" href="#version_ordering"></a><a class="link" href="#version_ordering">Version ordering</a></h5>
<div class="paragraph">
<p>Versions have an implicit ordering. Version ordering is used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine if a particular version is included in a range.</p>
</li>
<li>
<p>Determine which version is 'newest' when performing conflict resolution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Versions are ordered based on the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each version is split into it&#8217;s constituent "parts":</p>
<div class="ulist">
<ul>
<li>
<p>The characters <code>[. - _ +]</code> are used to separate the different "parts" of a version.</p>
</li>
<li>
<p>Any part that contains both digits and letters is split into separate parts for each: <code>1a1 == 1.a.1</code></p>
</li>
<li>
<p>Only the parts of a version are compared. The actual separator characters are not significant: <code>1.a.1 == 1-a+1 == 1.a-1 == 1a1</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The equivalent parts of 2 versions are compared using the following rules:</p>
<div class="ulist">
<ul>
<li>
<p>If both parts are numeric, the highest numeric value is <strong>higher</strong>: <code>1.1</code> &lt; <code>1.2</code></p>
</li>
<li>
<p>If one part is numeric, it is considered <strong>higher</strong> than the non-numeric part: <code>1.a</code> &lt; <code>1.1</code></p>
</li>
<li>
<p>If both are not numeric, the parts are compared <strong>alphabetically, case-sensitive</strong>: <code>1.A</code> &lt; <code>1.B</code> &lt; <code>1.a</code> &lt; <code>1.b</code></p>
</li>
<li>
<p>A version with an extra numeric part is considered <strong>higher</strong> than a version without: <code>1.1</code> &lt; <code>1.1.0</code></p>
</li>
<li>
<p>A version with an extra non-numeric part is considered <strong>lower</strong> than a version without: <code>1.1.a</code> &lt; <code>1.1</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Certain string values have special meaning for the purposes of ordering:</p>
<div class="ulist">
<ul>
<li>
<p>The string <code>dev</code> is consider <strong>lower</strong> than any other string part: <code>1.0-dev</code> &lt; <code>1.0-alpha</code> &lt; <code>1.0-rc</code>.</p>
</li>
<li>
<p>The strings <code>rc</code>, <code>release</code> and <code>final</code> are considered <strong>higher</strong> than any other string part (sorted in that order): <code>1.0-zeta</code> &lt; <code>1.0-rc</code> &lt; <code>1.0-release</code> &lt; <code>1.0-final</code> &lt; <code>1.0</code>.</p>
</li>
<li>
<p>The string <code>SNAPSHOT</code> has <strong>no special meaning</strong>, and is sorted alphabetically like any other string part: <code>1.0-alpha</code> &lt; <code>1.0-SNAPSHOT</code> &lt; <code>1.0-zeta</code> &lt; <code>1.0-rc</code> &lt; <code>1.0</code>.</p>
</li>
<li>
<p>Numeric snapshot versions have <strong>no special meaning</strong>, and are sorted like any other numeric part: <code>1.0</code> &lt; <code>1.0-20150201.121010-123</code> &lt; <code>1.1</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="simple_version_declaration_semantics"><a class="anchor" href="#simple_version_declaration_semantics"></a><a class="link" href="#simple_version_declaration_semantics">Simple version declaration semantics</a></h5>
<div class="paragraph">
<p>When you declare a version using the short-hand notation, for example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 294. A simple declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:1.7.15</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.slf4j:slf4j-api:1.7.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then the version is considered a <a href="#sec:required-version">required version</a> which means that it should <em>minimally</em> be <code>1.7.15</code> but can be upgraded by the engine (optimistic upgrade).</p>
</div>
<div class="paragraph">
<p>There is, however, a shorthand notation for <a href="#sec:strict-version">strict versions</a>, using the <code>!!</code> notation:</p>
</div>
<div class="exampleblock">
<div class="title">Example 295. Shorthand notation for strict dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// short-hand notation with !!</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:1.7.15!!</span><span class="delimiter">'</span></span>)
    <span class="comment">// is equivalent to</span>
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">&quot;</span></span>) {
        version {
           strictly <span class="string"><span class="delimiter">'</span><span class="content">1.7.15</span><span class="delimiter">'</span></span>
        }
    }

    <span class="comment">// or...</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api:[1.7, 1.8[!!1.7.25</span><span class="delimiter">'</span></span>)
    <span class="comment">// is equivalent to</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">'</span></span>) {
        version {
           strictly <span class="string"><span class="delimiter">'</span><span class="content">[1.7, 1.8[</span><span class="delimiter">'</span></span>
           prefer <span class="string"><span class="delimiter">'</span><span class="content">1.7.25</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // short-hand notation with !!
    implementation(&quot;org.slf4j:slf4j-api:1.7.15!!&quot;)
    // is equivalent to
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
           strictly(&quot;1.7.15&quot;)
        }
    }

    // or...
    implementation(&quot;org.slf4j:slf4j-api:[1.7, 1.8[!!1.7.25&quot;)
    // is equivalent to
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
           strictly([1.7, 1.8[&quot;)
           prefer(&quot;1.7.25&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A strict version <em>cannot be upgraded</em> and overrides whatever transitive dependencies originating from this dependency provide.
It is recommended to use ranges for strict versions.</p>
</div>
<div class="paragraph">
<p>The notation <code>[1.7, 1.8[!!1.7.25</code> above is equivalent to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>strictly <code>[1.7, 1.8[</code></p>
</li>
<li>
<p>prefer <code>1.7.25</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>which means that the engine <strong>must</strong> select a version between 1.7 (included) and 1.8 (excluded), and that if no other component in the graph needs a different version, it should <em>prefer</em> <code>1.7.25</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring_without_version"><a class="anchor" href="#sec:declaring_without_version"></a><a class="link" href="#sec:declaring_without_version">Declaring a dependency without version</a></h5>
<div class="paragraph">
<p>A recommended practice for larger projects is to declare dependencies without versions and use <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> for version declaration.
The advantage is that dependency constraints allow you to manage versions of all dependencies, including transitive ones, in one place.</p>
</div>
<div class="exampleblock">
<div class="title">Example 296. Declaring a dependency without version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web</span><span class="delimiter">'</span></span>
}

dependencies {
    constraints {
        implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.0.2.RELEASE</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.springframework:spring-web&quot;)
}

dependencies {
    constraints {
        implementation(&quot;org.springframework:spring-web:5.0.2.RELEASE&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rich-version-constraints"><a class="anchor" href="#rich-version-constraints"></a><a class="link" href="#rich-version-constraints">Declaring Rich Versions</a></h4>
<div class="paragraph">
<p>Gradle supports a rich model for declaring versions, which allows to combine different level of version information.
The terms and their meaning are explained below, from the strongest to the weakest:</p>
</div>
<div id="sec:strict-version" class="dlist">
<dl>
<dt class="hdlist1"><code>strictly</code></dt>
<dd>
<p>Any version not matched by this version notation will be excluded.
This is the strongest version declaration.
On a declared dependency, a <code>strictly</code> can downgrade a version.
When on a transitive dependency, it will cause dependency resolution to fail if no version acceptable by this clause can be selected.
See <a href="#sec:enforcing_dependency_version">overriding dependency version</a> for details.
This term supports dynamic versions.</p>
<div class="paragraph">
<p>When defined, overrides previous <code>require</code> declaration and clears previous <code>reject</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="sec:required-version" class="dlist">
<dl>
<dt class="hdlist1"><code>require</code></dt>
<dd>
<p>Implies that the selected version cannot be lower than what <code>require</code> accepts but could be higher through conflict resolution, even if higher has an exclusive higher bound.
This is what a direct version on a dependency translates to.
This term supports dynamic versions.</p>
<div class="paragraph">
<p>When defined, overrides previous <code>strictly</code> declaration and clears previous <code>reject</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="sec:preferred-version" class="dlist">
<dl>
<dt class="hdlist1"><code>prefer</code></dt>
<dd>
<p>This is a very soft version declaration.
It applies only if there is no stronger non dynamic opinion on a version for the module.
This term does not support dynamic versions.</p>
<div class="paragraph">
<p>Definition can complement <code>strictly</code> or <code>require</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is also an additional term outside of the level hierarchy:</p>
</div>
<div id="sec:rejected-version" class="dlist">
<dl>
<dt class="hdlist1"><code>reject</code></dt>
<dd>
<p>Declares that specific version(s) are not accepted for the module.
This will cause dependency resolution to fail if the only versions selectable are also rejected.
This term supports dynamic versions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following table illustrates a number of use cases and how to combine the different terms for rich version declaration:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 11. Rich version use cases</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Which version(s) of this dependency are acceptable?</th>
<th class="tableblock halign-left valign-top"><code>strictly</code></th>
<th class="tableblock halign-left valign-top"><code>require</code></th>
<th class="tableblock halign-left valign-top"><code>prefer</code></th>
<th class="tableblock halign-left valign-top"><code>rejects</code></th>
<th class="tableblock halign-left valign-top">Selection result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with version <code>1.5</code>, believe all future versions should work.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version starting from <code>1.5</code>, equivalent of <code>org:foo:1.5</code>. An upgrade to <code>2.4</code> is accepted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with <code>1.5</code>, soft constraint upgrades according to semantic versioning.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code>, <code>1.5</code> if nobody else cares. An upgrade to <code>2.4</code> is accepted.<br>
</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested with <code>1.5</code>, but follows semantic versioning.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code> excluded, <code>1.5</code> if nobody else cares.<br>
Overwrites versions from transitive dependencies.<br>
</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as above, with <code>1.4</code> known broken.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.0, 2.0[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any version between <code>1.0</code> and <code>2.0</code> excluded except for <code>1.4</code>, <code>1.5</code> if nobody else cares.<br>
Overwrites versions from transitive dependencies.<br>
</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No opinion, works with <code>1.5</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5</code> if no other opinion, any otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No opinion, prefer latest release.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>latest.release</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The latest release at build time.<br>
</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On the edge, latest release, no downgrade.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>latest.release</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The latest release at build time.<br>
</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No other version than 1.5.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5, or failure if another <code>strict</code> or higher <code>require</code> constraint disagrees.<br>
Overwrites versions from transitive dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5</code> or a patch version of it exclusively.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1.5,1.6[</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest <code>1.5.x</code> patch release, or failure if another <code>strict</code> or higher <code>require</code> constraint disagrees.<br>
Overwrites versions from transitive dependencies.<br>
</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lines annotated with a lock () indicate that leveraging <a href="#">dependency locking</a> makes sense in this context.
Another concept that relates with rich version declaration is the ability to publish <a href="#publishing_maven:resolved_dependencies">resolved versions</a> instead of declared ones.</p>
</div>
<div class="paragraph">
<p>Using <code>strictly</code>, especially for a library, must be a well thought process as it has an impact on downstream consumers.
At the same time, used correctly, it will help consumers understand what combination of libraries do not work together in their context.
See <a href="#sec:enforcing_dependency_version">overriding dependency version</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rich version information will be preserved in the Gradle Module Metadata format.
However conversion to Ivy or Maven metadata formats will be lossy.
The highest level will be published, that is <code>strictly</code> or <code>require</code> over <code>prefer</code>.
In addition, any <code>reject</code> will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rich version declaration is accessed through the <code>version</code> DSL method on a dependency or constraint declaration which gives access to <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/MutableVersionConstraint.html">MutableVersionConstraint</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 297. Rich version declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-api</span><span class="delimiter">'</span></span>) {
        version {
            strictly <span class="string"><span class="delimiter">'</span><span class="content">[1.7, 1.8[</span><span class="delimiter">'</span></span>
            prefer <span class="string"><span class="delimiter">'</span><span class="content">1.7.25</span><span class="delimiter">'</span></span>
        }
    }

    constraints {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-core</span><span class="delimiter">'</span></span>) {
            version {
                require <span class="string"><span class="delimiter">'</span><span class="content">4.2.9.RELEASE</span><span class="delimiter">'</span></span>
                reject <span class="string"><span class="delimiter">'</span><span class="content">4.3.16.RELEASE</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.slf4j:slf4j-api&quot;) {
        version {
            strictly(&quot;[1.7, 1.8[&quot;)
            prefer(&quot;1.7.25&quot;)
        }
    }

    constraints {
        add(&quot;implementation&quot;, &quot;org.springframework:spring-core&quot;) {
            version {
                require(&quot;4.2.9.RELEASE&quot;)
                reject(&quot;4.3.16.RELEASE&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:dynamic_versions_and_changing_modules"><a class="anchor" href="#sec:dynamic_versions_and_changing_modules"></a><a class="link" href="#sec:dynamic_versions_and_changing_modules">Handling versions which change over time</a></h4>
<div class="paragraph">
<p>There are many situations when you want to use the latest version of a particular module dependency, or the latest in a range of versions.
This can be a requirement during development, or you may be developing a library that is designed to work with a range of dependency versions.
You can easily depend on these constantly changing dependencies by using a <em>dynamic version</em>.
A <a href="#sub:declaring_dependency_with_dynamic_version">dynamic version</a> can be either a version range (e.g. <code>2.+</code>) or it can be a placeholder for the latest version available e.g. <code>latest.integration</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the module you request can change over time even for the same version, a so-called <a href="#sub:declaring_dependency_with_changing_version">changing version</a>.
An example of this type of <em>changing module</em> is a Maven <code>SNAPSHOT</code> module, which always points at the latest artifact published.
In other words, a standard Maven snapshot is a module that is continually evolving, it is a "changing module".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using dynamic versions and changing modules can lead to unreproducible builds. As new versions of a particular module are published, its API may become incompatible with your source code. Use this feature with caution!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sub:declaring_dependency_with_dynamic_version"><a class="anchor" href="#sub:declaring_dependency_with_dynamic_version"></a><a class="link" href="#sub:declaring_dependency_with_dynamic_version">Declaring a dynamic version</a></h5>
<div class="paragraph">
<p>Projects might adopt a more aggressive approach for consuming dependencies to modules.
For example you might want to always integrate the latest version of a dependency to consume cutting edge features at any given time.
A <em>dynamic version</em> allows for resolving the latest version or the latest version of a version range for a given module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using dynamic versions in a build bears the risk of potentially breaking it. As soon as a new version of the dependency is released that contains an incompatible API change your source code might stop compiling.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 298. Declaring a dependency with a dynamic version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.+</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.springframework:spring-web:5.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <a href="https://scans.gradle.com/">build scan</a> can effectively visualize dynamic dependency versions and their respective, selected versions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dependency-management-dynamic-dependency-build-scan.png" alt="dependency management dynamic dependency build scan">
</div>
<div class="title">Figure 21. Dynamic dependencies in build scan</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions of dependencies for 24 hours. Within this time frame, Gradle does not try to resolve newer versions from the declared repositories.
The <a href="#sec:controlling-dynamic-version-caching">threshold can be configured</a> as needed for example if you want to resolve new versions earlier.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:declaring_dependency_with_changing_version"><a class="anchor" href="#sub:declaring_dependency_with_changing_version"></a><a class="link" href="#sub:declaring_dependency_with_changing_version">Declaring a changing version</a></h5>
<div class="paragraph">
<p>A team might decide to implement a series of features before releasing a new version of the application or library. A common strategy to allow consumers to integrate an unfinished version of their artifacts early and often is to release a module with a so-called <em>changing version</em>.
A changing version indicates that the feature set is still under active development and hasn&#8217;t released a stable version for general availability yet.</p>
</div>
<div class="paragraph">
<p>In Maven repositories, changing versions are commonly referred to as <a href="https://maven.apache.org/guides/getting-started/index.html#What_is_a_SNAPSHOT_version">snapshot versions</a>.
Snapshot versions contain the suffix <code>-SNAPSHOT</code>.
The following example demonstrates how to declare a snapshot version on the Spring dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 299. Declaring a dependency with a changing version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.spring.io/snapshot/</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-web:5.0.3.BUILD-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
    maven {
        url = uri(&quot;https://repo.spring.io/snapshot/&quot;)
    }
}

dependencies {
    implementation(&quot;org.springframework:spring-web:5.0.3.BUILD-SNAPSHOT&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches changing versions of dependencies for 24 hours.
Within this time frame, Gradle does not try to resolve newer versions from the declared repositories. The <a href="#sec:controlling-dynamic-version-caching">threshold can be configured</a> as needed for example if you want to resolve new snapshot versions earlier.</p>
</div>
<div class="paragraph">
<p>Gradle is flexible enough to treat any version as changing version e.g. if you wanted to model snapshot behavior for an Ivy module.
All you need to do is to set the property <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ExternalModuleDependency.html#setChanging-boolean-">ExternalModuleDependency.setChanging(boolean)</a> to <code>true</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:controlling-dynamic-version-caching"><a class="anchor" href="#sec:controlling-dynamic-version-caching"></a><a class="link" href="#sec:controlling-dynamic-version-caching">Controlling dynamic version caching</a></h5>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions and changing modules for 24 hours. During that time frame Gradle does not contact any of the declared, remote repositories for new versions. If you want Gradle to check the remote repository more frequently or with every execution of your build, then you will need to change the time to live (TTL) threshold.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using a short TTL threshold for dynamic or changing versions may result in longer build times due to the increased number of HTTP(s) calls.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can override the default cache modes using <a href="#sec:controlling_dependency_caching_command_line">command line options</a>. You can also <a href="#sec:controlling_dependency_caching_programmatically">change the cache expiry times in your build programmatically</a> using the resolution strategy.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:controlling_dependency_caching_programmatically"><a class="anchor" href="#sec:controlling_dependency_caching_programmatically"></a><a class="link" href="#sec:controlling_dependency_caching_programmatically">Controlling dependency caching programmatically</a></h5>
<div class="paragraph">
<p>You can fine-tune certain aspects of caching programmatically using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ResolutionStrategy.html">ResolutionStrategy</a> for a configuration. The programmatic approach is useful if you would like to change the settings permanently.</p>
</div>
<div class="paragraph">
<p>By default, Gradle caches dynamic versions for 24 hours. To change how long Gradle will cache the resolved version for a dynamic version, use:</p>
</div>
<div class="exampleblock">
<div class="title">Example 300. Dynamic version cache control</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor <span class="integer">10</span>, <span class="string"><span class="delimiter">'</span><span class="content">minutes</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor(10, &quot;minutes&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Gradle caches changing modules for 24 hours. To change how long Gradle will cache the meta-data and artifacts for a changing module, use:</p>
</div>
<div class="exampleblock">
<div class="title">Example 301. Changing module cache control</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.cacheChangingModulesFor <span class="integer">4</span>, <span class="string"><span class="delimiter">'</span><span class="content">hours</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.cacheChangingModulesFor(4, &quot;hours&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:controlling_dependency_caching_command_line"><a class="anchor" href="#sec:controlling_dependency_caching_command_line"></a><a class="link" href="#sec:controlling_dependency_caching_command_line">Controlling dependency caching from the command line</a></h5>
<div class="sect5">
<h6 id="sec:offline-mode"><a class="anchor" href="#sec:offline-mode"></a><a class="link" href="#sec:offline-mode">Avoiding network access with offline mode</a></h6>
<div class="paragraph">
<p>The <code>--offline</code> command line switch tells Gradle to always use dependency modules from the cache, regardless if they are due to be checked again. When running with offline, Gradle will never attempt to access the network to perform dependency resolution. If required modules are not present in the dependency cache, build execution will fail.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:refreshing-dependencies"><a class="anchor" href="#sec:refreshing-dependencies"></a><a class="link" href="#sec:refreshing-dependencies">Refreshing dependencies</a></h6>
<div class="paragraph">
<p>You can control the behavior of dependency caching for a distinct build invocation from the command line.
Command line options are helpful for making a selective, ad-hoc choice for a single execution of the build.</p>
</div>
<div class="paragraph">
<p>At times, the Gradle Dependency Cache can become out of sync with the actual state of the configured repositories.
Perhaps a repository was initially misconfigured, or perhaps a "non-changing" module was published incorrectly.
To refresh all dependencies in the dependency cache, use the <code>--refresh-dependencies</code> option on the command line.</p>
</div>
<div class="paragraph">
<p>The <code>--refresh-dependencies</code> option tells Gradle to ignore all cached entries for resolved modules and artifacts.
A fresh resolve will be performed against all configured repositories, with dynamic versions recalculated, modules refreshed, and artifacts downloaded.
However, where possible Gradle will check if the previously downloaded artifacts are valid before downloading again.
This is done by comparing published SHA1 values in the repository with the SHA1 values for existing downloaded artifacts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>new versions of dynamic dependencies</p>
</li>
<li>
<p>new versions of changing modules (modules which use the same version string but can have different contents)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Refreshing dependencies will cause Gradle to invalidate its listing caches.
However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it will perform HTTP HEAD requests on metadata files but <em>will not re-download them</em> if they are identical</p>
</li>
<li>
<p>it will perform HTTP HEAD requests on artifact files but <em>will not re-download them</em> if they are identical</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, refreshing dependencies <em>only</em> has an impact if you actually use dynamic dependencies <em>or</em> that you have changing dependencies that you were not aware of (in which case it is your responsibility to declare them correctly to Gradle as changing dependencies).</p>
</div>
<div class="paragraph">
<p>It&#8217;s a common misconception to think that using <code>--refresh-dependencies</code> will force download of dependencies.
This is <strong>not</strong> the case: Gradle will only perform what is strictly required to refresh the dynamic dependencies.
This <em>may</em> involve downloading new listing or metadata files, or even artifacts, but if nothing changed, the impact is minimal.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:component_selection_rules"><a class="anchor" href="#sec:component_selection_rules"></a><a class="link" href="#sec:component_selection_rules">Using component selection rules</a></h5>
<div class="paragraph">
<p>Component selection rules may influence which component instance should be selected when multiple versions are available that match a version selector.
Rules are applied against every available version and allow the version to be explicitly rejected by rule.
This allows Gradle to ignore any component instance that does not satisfy conditions set by the rule.
Examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a dynamic version like <code>1.+</code> certain versions may be explicitly rejected from selection.</p>
</li>
<li>
<p>For a static version like <code>1.4</code> an instance may be rejected based on extra component metadata such as the Ivy branch attribute, allowing an instance from a subsequent repository to be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rules are configured via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ComponentSelectionRules.html">ComponentSelectionRules</a> object.
Each rule configured will be called with a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ComponentSelection.html">ComponentSelection</a> object as an argument which contains information about the candidate version being considered.
Calling <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ComponentSelection.html#org.gradle.api.artifacts.ComponentSelection:reject(java.lang.String)">ComponentSelection.reject(java.lang.String)</a> causes the given candidate version to be explicitly rejected, in which case the candidate will not be considered for the selector.</p>
</div>
<div class="paragraph">
<p>The following example shows a rule that disallows a particular version of a module but allows the dynamic version to choose the next best candidate.</p>
</div>
<div class="exampleblock">
<div class="title">Example 302. Component selection rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    rejectConfig {
        resolutionStrategy {
            componentSelection {
                <span class="comment">// Accept the highest version matching the requested version that isn't '1.5'</span>
                all { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.group == <span class="string"><span class="delimiter">'</span><span class="content">org.sample</span><span class="delimiter">'</span></span> &amp;&amp; selection.candidate.module == <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span> &amp;&amp; selection.candidate.version == <span class="string"><span class="delimiter">'</span><span class="content">1.5</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">version 1.5 is broken for 'org.sample:api'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}

dependencies {
    rejectConfig <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:api:1.+</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;rejectConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                // Accept the highest version matching the requested version that isn't '1.5'
                all {
                    if (candidate.group == &quot;org.sample&quot; &amp;&amp; candidate.module == &quot;api&quot; &amp;&amp; candidate.version == &quot;1.5&quot;) {
                        reject(&quot;version 1.5 is broken for 'org.sample:api'&quot;)
                    }
                }
            }
        }
    }
}

dependencies {
    &quot;rejectConfig&quot;(&quot;org.sample:api:1.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that version selection is applied starting with the highest version first.
The version selected will be the first version found that all component selection rules accept.
A version is considered accepted if no rule explicitly rejects it.</p>
</div>
<div class="paragraph">
<p>Similarly, rules can be targeted at specific modules.
Modules must be specified in the form of <code>group:module</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 303. Component selection rule with module target</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    targetConfig {
        resolutionStrategy {
            componentSelection {
                withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:api</span><span class="delimiter">&quot;</span></span>) { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.version == <span class="string"><span class="delimiter">&quot;</span><span class="content">1.5</span><span class="delimiter">&quot;</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">version 1.5 is broken for 'org.sample:api'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;targetConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                withModule(&quot;org.sample:api&quot;) {
                    if (candidate.version == &quot;1.5&quot;) {
                        reject(&quot;version 1.5 is broken for 'org.sample:api'&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Component selection rules can also consider component metadata when selecting a version.
Possible additional metadata that can be considered are <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadata.html">ComponentMetadata</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ivy/IvyModuleDescriptor.html">IvyModuleDescriptor</a>.
Note that this extra information may not always be available and thus should be checked for <code>null</code> values.</p>
</div>
<div class="exampleblock">
<div class="title">Example 304. Component selection rule with metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    metadataRulesConfig {
        resolutionStrategy {
            componentSelection {
                <span class="comment">// Reject any versions with a status of 'experimental'</span>
                all { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.candidate.group == <span class="string"><span class="delimiter">'</span><span class="content">org.sample</span><span class="delimiter">'</span></span> &amp;&amp; selection.metadata?.status == <span class="string"><span class="delimiter">'</span><span class="content">experimental</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">don't use experimental candidates from 'org.sample'</span><span class="delimiter">&quot;</span></span>)
                    }
                }
                <span class="comment">// Accept the highest version with either a &quot;release&quot; branch or a status of 'milestone'</span>
                withModule(<span class="string"><span class="delimiter">'</span><span class="content">org.sample:api</span><span class="delimiter">'</span></span>) { ComponentSelection selection -&gt;
                    <span class="keyword">if</span> (selection.getDescriptor(IvyModuleDescriptor)?.branch != <span class="string"><span class="delimiter">&quot;</span><span class="content">release</span><span class="delimiter">&quot;</span></span> &amp;&amp; selection.metadata?.status != <span class="string"><span class="delimiter">'</span><span class="content">milestone</span><span class="delimiter">'</span></span>) {
                        selection.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">'org.sample:api' must have testing branch or milestone status</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;metadataRulesConfig&quot;) {
        resolutionStrategy {
            componentSelection {
                // Reject any versions with a status of 'experimental'
                all {
                    if (candidate.group == &quot;org.sample&quot; &amp;&amp; metadata?.status == &quot;experimental&quot;) {
                        reject(&quot;don't use experimental candidates from 'org.sample'&quot;)
                    }
                }
                // Accept the highest version with either a &quot;release&quot; branch or a status of 'milestone'
                withModule(&quot;org.sample:api&quot;) {
                    if (getDescriptor(IvyModuleDescriptor::class)?.branch != &quot;release&quot; &amp;&amp; metadata?.status != &quot;milestone&quot;) {
                        reject(&quot;'org.sample:api' must have testing branch or milestone status&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ComponentSelection.html">ComponentSelection</a> argument is <em>always</em> required as parameter when declaring a component selection rule.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dependency-locking"><a class="anchor" href="#dependency-locking"></a><a class="link" href="#dependency-locking">Locking dependency versions</a></h4>
<div class="paragraph">
<p>Use of dynamic dependency versions (e.g. <code>1.+</code> or <code>[1.0,2.0)</code>) makes builds non-deterministic.
This causes builds to break without any obvious change, and worse, can be caused by a transitive dependency that the build author has no control over.</p>
</div>
<div class="paragraph">
<p>To achieve <a href="https://reproducible-builds.org/">reproducible builds</a>, it is necessary to <em>lock</em> versions of dependencies and transitive dependencies such that a build with the same inputs will always resolve the same module versions.
This is called <em>dependency locking</em>.</p>
</div>
<div class="paragraph">
<p>It enables, amongst others, the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Companies dealing with multi repositories no longer need to rely on <code>-SNAPSHOT</code> or changing dependencies,
which sometimes result in cascading failures when a dependency introduces a bug or incompatibility.
Now dependencies can be declared against major or minor version range, enabling to test with the latest versions on CI while leveraging locking for stable developer builds.</p>
</li>
<li>
<p>Teams that want to always use the latest of their dependencies can use dynamic versions, locking their dependencies only for releases.
The release tag will contain the lock states, allowing that build to be fully reproducible when bug fixes need to be developed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Combined with <a href="#publishing_maven:resolved_dependencies">publishing resolved versions</a>, you can also replace the declared dynamic version part at publication time.
Consumers will instead see the versions that your release resolved.</p>
</div>
<div class="paragraph">
<p>Locking is enabled per <a href="#sec:what-are-dependency-configurations">dependency configuration</a>.
Once enabled, you must create an initial lock state.
It will cause Gradle to verify that resolution results do not change, resulting in the same selected dependencies even if newer versions are produced.
Modifications to your build that would impact the resolved set of dependencies will cause it to fail.
This makes sure that changes, either in published dependencies or build definitions, do not alter resolution without adapting the lock state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dependency locking makes sense only with <a href="#sub:declaring_dependency_with_dynamic_version">dynamic versions</a>.
It will have no impact on <a href="#sub:declaring_dependency_with_changing_version">changing versions</a> (like <code>-SNAPSHOT</code>) whose coordinates remain the same, though the content may change.
Gradle will even emit a warning when persisting lock state and changing dependencies are present in the resolution result.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="enabling_locking_on_configurations"><a class="anchor" href="#enabling_locking_on_configurations"></a><a class="link" href="#enabling_locking_on_configurations">Enabling locking on configurations</a></h5>
<div class="paragraph">
<p>Locking of a configuration happens through the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">ResolutionStrategy</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 305. Locking a specific configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.compileClasspath {
    resolutionStrategy.activateDependencyLocking()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or the following, as a way to lock all configurations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 306. Locking all configurations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyLocking {
    lockAllConfigurations()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyLocking {
    lockAllConfigurations()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only configurations that can be resolved will have lock state attached to them.
Applying locking on non resolvable-configurations is simply a no-op.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above will lock all <em>project</em> configurations, but not the <em>buildscript</em> ones.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also disable locking on a specific configuration.
This can be useful if a plugin configured locking on all configurations but you happen to add one that should not be locked.</p>
</div>
<div class="exampleblock">
<div class="title">Example 307. Unlocking a specific configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.deactivateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.compileClasspath {
    resolutionStrategy.deactivateDependencyLocking()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="locking_buildscript_classpath_configuration"><a class="anchor" href="#locking_buildscript_classpath_configuration"></a><a class="link" href="#locking_buildscript_classpath_configuration">Locking buildscript classpath configuration</a></h6>
<div class="paragraph">
<p>If you apply plugins to your build, you may want to leverage dependency locking there as well.
In order to lock the <a href="#sec:applying_plugins_buildscript"><code>classpath</code> configuration</a> used for script plugins, do the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 308. Locking buildscript classpath configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    configurations.classpath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    configurations.classpath {
        resolutionStrategy.activateDependencyLocking()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generating_and_updating_dependency_locks"><a class="anchor" href="#generating_and_updating_dependency_locks"></a><a class="link" href="#generating_and_updating_dependency_locks">Generating and updating dependency locks</a></h5>
<div class="paragraph">
<p>In order to generate or update lock state, you specify the <code>--write-locks</code> command line argument in addition to the normal tasks that would trigger configurations to be resolved.
This will cause the creation of lock state for each resolved configuration in that build execution.
Note that if lock state existed previously, it is overwritten.</p>
</div>
<div class="sect5">
<h6 id="lock_all_configurations_in_one_build_execution"><a class="anchor" href="#lock_all_configurations_in_one_build_execution"></a><a class="link" href="#lock_all_configurations_in_one_build_execution">Lock all configurations in one build execution</a></h6>
<div class="paragraph">
<p>When locking multiple configurations, you may want to lock them all at once, during a single build execution.</p>
</div>
<div class="paragraph">
<p>For this, you have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>gradle dependencies --write-locks</code>.
This will effectively lock all resolvable configurations that have locking enabled.
Note that in a multi project setup, <code>dependencies</code> only is executed on <em>one</em> project, the root one in this case.</p>
</li>
<li>
<p>Declare a custom task that will resolve all configurations</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 309. Resolving all configurations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task resolveAndLockAll {
    doFirst {
        <span class="keyword">assert</span> gradle.startParameter.writeDependencyLocks
    }
    doLast {
        configurations.findAll {
            <span class="comment">// Add any custom filtering on the configurations to be resolved</span>
            <span class="local-variable">it</span>.canBeResolved
        }.each { <span class="local-variable">it</span>.resolve() }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;resolveAndLockAll&quot;) {
    doFirst {
        require(gradle.startParameter.isWriteDependencyLocks)
    }
    doLast {
        configurations.filter {
            // Add any custom filtering on the configurations to be resolved
            it.isCanBeResolved
        }.forEach { it.resolve() }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That second option, with proper choosing of configurations, can be the only option in the native world, where not all configurations can be resolved on a single platform.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="lock_state_location_and_format"><a class="anchor" href="#lock_state_location_and_format"></a><a class="link" href="#lock_state_location_and_format">Lock state location and format</a></h5>
<div class="paragraph">
<p>Lock state will be preserved in a file located in the folder <code>gradle/dependency-locks</code> inside the project or subproject directory.
Each file is named by the configuration it locks and has the <code>lockfile</code> extension.
The one exception to this rule is for configurations for the <a href="#sec:applying_plugins_buildscript">buildscript itself</a>.
In that case the configuration name will be prefixed with <code>buildscript-</code>.</p>
</div>
<div class="paragraph">
<p>The content of the file is a module notation per line, with a header giving some context.
Module notations are ordered alphabetically, to ease diffs.</p>
</div>
<div class="listingblock">
<div class="title">gradle/dependency-locks/compileClasspath.lockfile</div>
<div class="content">
<pre># This is a Gradle generated file for dependency locking.
# Manual edits can break the build and are not advised.
# This file is expected to be part of source control.
org.springframework:spring-beans:5.0.5.RELEASE
org.springframework:spring-core:5.0.5.RELEASE
org.springframework:spring-jcl:5.0.5.RELEASE</pre>
</div>
</div>
<div class="paragraph">
<p>which matches the following dependency declaration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 310. Dynamic dependency declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-beans:[5.0,6.0)</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.springframework:spring-beans:[5.0,6.0)&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running_a_build_with_lock_state_present"><a class="anchor" href="#running_a_build_with_lock_state_present"></a><a class="link" href="#running_a_build_with_lock_state_present">Running a build with lock state present</a></h5>
<div class="paragraph">
<p>The moment a build needs to resolve a configuration that has locking enabled and it finds a matching lock state,
it will use it to verify that the given configuration still resolves the same versions.</p>
</div>
<div class="paragraph">
<p>A successful build indicates that the same dependencies are used as stored in the lock state, regardless if new versions matching the dynamic selector have been produced.</p>
</div>
<div class="paragraph">
<p>The complete validation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Existing entries in the lock state must be matched in the build</p>
<div class="ulist">
<ul>
<li>
<p>A version mismatch or missing resolved module causes a build failure</p>
</li>
</ul>
</div>
</li>
<li>
<p>Resolution result must not contain extra dependencies compared to the lock state</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="fine_tuning_dependency_locking_behaviour_with_lock_mode"><a class="anchor" href="#fine_tuning_dependency_locking_behaviour_with_lock_mode"></a><a class="link" href="#fine_tuning_dependency_locking_behaviour_with_lock_mode">Fine tuning dependency locking behaviour with lock mode</a></h6>
<div class="paragraph">
<p>While the default lock mode behaves as described above, two other modes are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Strict mode</dt>
<dd>
<p>In this mode, in addition to the validations above, dependency locking will fail if a configuration marked as <em>locked</em> does not have lock state associated with it.</p>
</dd>
<dt class="hdlist1">Lenient mode</dt>
<dd>
<p>In this mode, dependency locking will still pin dynamic versions but otherwise changes to the dependency resolution are no longer errors.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The lock mode can be controlled from the <code>dependencyLocking</code> block as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 311. Setting the lock mode</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyLocking {
    lockMode = LockMode.STRICT
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencyLocking {
    lockMode.set(LockMode.STRICT)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="selectively_updating_lock_state_entries"><a class="anchor" href="#selectively_updating_lock_state_entries"></a><a class="link" href="#selectively_updating_lock_state_entries">Selectively updating lock state entries</a></h5>
<div class="paragraph">
<p>In order to update only specific modules of a configuration, you can use the <code>--update-locks</code> command line flag.
It takes a comma (<code>,</code>) separated list of module notations.
In this mode, the existing lock state is still used as input to resolution, filtering out the modules targeted by the update.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> gradle classes --update-locks org.apache.commons:commons-lang3,org.slf4j:slf4j-api</pre>
</div>
</div>
<div class="paragraph">
<p>Wildcards, indicated with <code>*</code>, can be used in the group or module name. They can be the only character or appear at the end of the group or module respectively.
The following wildcard notation examples are valid:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.commons:*</code>: will let all modules belonging to group <code>org.apache.commons</code> update</p>
</li>
<li>
<p><code>*:guava</code>: will let all modules named <code>guava</code>, whatever their group, update</p>
</li>
<li>
<p><code>org.springframework.spring*:spring*</code>: will let all modules having their group starting with <code>org.springframework.spring</code> and name starting with <code>spring</code> update</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The resolution may cause other module versions to update, as dictated by the Gradle resolution rules.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="disabling_dependency_locking"><a class="anchor" href="#disabling_dependency_locking"></a><a class="link" href="#disabling_dependency_locking">Disabling dependency locking</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that the configuration for which you no longer want locking is not configured with locking.</p>
</li>
<li>
<p>Remove the file matching the configurations where you no longer want locking.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you only perform the second step above, then locking will effectively no longer be applied.
However, if that configuration happens to be resolved in the future at a time where lock state is persisted, it will once again be locked.</p>
</div>
</div>
<div class="sect4">
<h5 id="single_lock_file_per_project"><a class="anchor" href="#single_lock_file_per_project"></a><a class="link" href="#single_lock_file_per_project">Single lock file per project</a></h5>
<div class="paragraph">
<p>Gradle supports an improved lock file format.
The goal is to have only a single lock file per project, which contains the lock state for all configurations of said project.
By default, the file is named <code>gradle.lockfile</code> and is located inside the project directory.
The lock state for the buildscript itself is found in a file named <code>buildscript-gradle.lockfile</code> inside the project directory.</p>
</div>
<div class="paragraph">
<p>The main benefit is a substantial reduction in the number of lock files compared to the format requiring one lockfile per locked configuration.</p>
</div>
<div class="paragraph">
<p>This format requires a migration for existing locking users and is thus opt-in.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The objective is to default to this single lock file per project in Gradle 7.0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The format can be activated by enabling the matching <a href="feature_lifecycle.html#feature_preview">feature preview</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 312. Single lock file per project activation</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">locking-single-file</span><span class="delimiter">'</span></span>

enableFeaturePreview(<span class="string"><span class="delimiter">'</span><span class="content">ONE_LOCKFILE_PER_PROJECT</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;locking-single-file&quot;

enableFeaturePreview(&quot;ONE_LOCKFILE_PER_PROJECT&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then with the following dependency declaration and locked configurations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 313. Explicit locking</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    runtimeClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    annotationProcessor {
        resolutionStrategy.activateDependencyLocking()
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.springframework:spring-beans:[5.0,6.0)</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    runtimeClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
    annotationProcessor {
        resolutionStrategy.activateDependencyLocking()
    }
}

dependencies {
    implementation(&quot;org.springframework:spring-beans:[5.0,6.0)&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The lockfile will have the following content:</p>
</div>
<div class="listingblock">
<div class="title">gradle.lockfile</div>
<div class="content">
<pre># This is a Gradle generated file for dependency locking.
# Manual edits can break the build and are not advised.
# This file is expected to be part of source control.
org.springframework:spring-beans:5.0.5.RELEASE=compileClasspath, runtimeClasspath
org.springframework:spring-core:5.0.5.RELEASE=compileClasspath, runtimeClasspath
org.springframework:spring-jcl:5.0.5.RELEASE=compileClasspath, runtimeClasspath
empty=annotationProcessor</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Each line still represents a single dependency in the <code>group:artifact:version</code> notation</p>
</li>
<li>
<p>It then lists all configurations that contain the given dependency</p>
</li>
<li>
<p>The last line of the file lists all empty configurations, that is configurations known to have no dependencies</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="migrating_to_the_single_lockfile_per_project_format"><a class="anchor" href="#migrating_to_the_single_lockfile_per_project_format"></a><a class="link" href="#migrating_to_the_single_lockfile_per_project_format">Migrating to the single lockfile per project format</a></h6>
<div class="paragraph">
<p>Once you have activated the feature preview (see above), you can simply follow the documentation for <a href="#lock_all_configurations_in_one_build_execution">writing</a> or <a href="#selectively_updating_lock_state_entries">updating</a> dependency lock state.</p>
</div>
<div class="paragraph">
<p>Then after confirming the single lock file per project contains the lock state for a given configuration, the matching per configuration lock file can be removed from <code>gradle/dependency-locks</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring_the_per_project_lock_file_name_and_location"><a class="anchor" href="#configuring_the_per_project_lock_file_name_and_location"></a><a class="link" href="#configuring_the_per_project_lock_file_name_and_location">Configuring the per project lock file name and location</a></h6>
<div class="paragraph">
<p>When using the single lock file per project, you can configure its name and location.
The main reason for providing this is to enable having a file name that is determined by some project properties, effectively allowing a single project to store different lock state for different execution contexts.
One trivial example in the JVM ecosystem is the Scala version that is often found in artifact coordinates.</p>
</div>
<div class="exampleblock">
<div class="title">Example 314. Changing the lock file name</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> scalaVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">2.12</span><span class="delimiter">&quot;</span></span>
dependencyLocking {
    lockFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>projectDir</span><span class="content">/locking/gradle-</span><span class="inline"><span class="inline-delimiter">${</span>scalaVersion<span class="inline-delimiter">}</span></span><span class="content">.lockfile</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val scalaVersion = &quot;2.12&quot;
dependencyLocking {
    lockFile.set(file(&quot;$projectDir/locking/gradle-${scalaVersion}.lockfile&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking_limitations"><a class="anchor" href="#locking_limitations"></a><a class="link" href="#locking_limitations">Locking limitations</a></h5>
<div class="ulist">
<ul>
<li>
<p>Locking cannot yet be applied to source dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="nebula_locking_plugin"><a class="anchor" href="#nebula_locking_plugin"></a><a class="link" href="#nebula_locking_plugin">Nebula locking plugin</a></h5>
<div class="paragraph">
<p>This feature is inspired by the <a href="https://github.com/nebula-plugins/gradle-dependency-lock-plugin">Nebula Gradle dependency lock plugin</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controlling_transitive_dependencies"><a class="anchor" href="#controlling_transitive_dependencies"></a><a class="link" href="#controlling_transitive_dependencies">Controlling Transitive Dependencies</a></h3>
<div class="sect3">
<h4 id="dependency-constraints"><a class="anchor" href="#dependency-constraints"></a><a class="link" href="#dependency-constraints">Upgrading versions of transitive dependencies</a></h4>
<div class="sect4">
<h5 id="sec:direct-vs-transitive-deps"><a class="anchor" href="#sec:direct-vs-transitive-deps"></a><a class="link" href="#sec:direct-vs-transitive-deps">Direct dependencies vs dependency constraints</a></h5>
<div class="paragraph">
<p>A component may have two different kinds of dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>direct dependencies are <em>directly required by the component</em>.
A direct dependency is also referred to as a <em>first level dependency</em>.
For example, if your project source code requires Guava, Guava should be declared as <em>direct dependency</em>.</p>
</li>
<li>
<p>transitive dependencies are dependencies that your component needs, but only because another dependency needs them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s quite common that issues with dependency management are about <em>transitive dependencies</em>.
Often developers incorrectly fix transitive dependency issues by adding <em>direct dependencies</em>.
To avoid this, Gradle provides the concept of <em>dependency constraints</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:adding-constraints-transitive-deps"><a class="anchor" href="#sec:adding-constraints-transitive-deps"></a><a class="link" href="#sec:adding-constraints-transitive-deps">Adding constraints on transitive dependencies</a></h5>
<div class="paragraph">
<p>Dependency constraints allow you to define the version or the version range of both dependencies declared in the build script and transitive dependencies.
It is the preferred method to express constraints that should be applied to all dependencies of a configuration.
When Gradle attempts to resolve a dependency to a module version, all <a href="#">dependency declarations with version</a>, all transitive dependencies and all dependency constraints for that module are taken into consideration.
The highest version that matches all conditions is selected.
If no such version is found, Gradle fails with an error showing the conflicting declarations.
If this happens you can adjust your dependencies or dependency constraints declarations, or make other adjustments to the transitive dependencies if needed.
Similar to dependency declarations, dependency constraint declarations are <a href="#sec:what-are-dependency-configurations">scoped by configurations</a> and can therefore be selectively defined for parts of a build.
If a dependency constraint influenced the resolution result, any type of <a href="#sec:dependency_resolve_rules">dependency resolve rules</a> may still be applied afterwards.</p>
</div>
<div class="exampleblock">
<div class="title">Example 315. Define dependency constraints</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient</span><span class="delimiter">'</span></span>
    constraints {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.3</span><span class="delimiter">'</span></span>) {
            because <span class="string"><span class="delimiter">'</span><span class="content">previous versions have a bug impacting this application</span><span class="delimiter">'</span></span>
        }
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.11</span><span class="delimiter">'</span></span>) {
            because <span class="string"><span class="delimiter">'</span><span class="content">version 1.9 pulled from httpclient has bugs affecting this application</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient&quot;)
    constraints {
        implementation(&quot;org.apache.httpcomponents:httpclient:4.5.3&quot;) {
            because(&quot;previous versions have a bug impacting this application&quot;)
        }
        implementation(&quot;commons-codec:commons-codec:1.11&quot;) {
            because(&quot;version 1.9 pulled from httpclient has bugs affecting this application&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, all versions are omitted from the dependency declaration.
Instead, the versions are defined in the constraints block.
The version definition for <code>commons-codec:1.11</code> is only taken into account if <code>commons-codec</code> is brought in as transitive dependency, since <code>commons-codec</code> is not defined as dependency in the project.
Otherwise, the constraint has no effect.
Dependency constraints can also define a <a href="#">rich version constraint</a> and support <a href="#sec:strict-version">strict versions</a> to enforce a version even if it contradicts with the version defined by a transitive dependency (e.g. if the version needs to be downgraded).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dependency constraints are only published when using <a href="#sec:understanding-gradle-module-md">Gradle Module Metadata</a>.
This means that currently they are only fully supported if Gradle is used for publishing and consuming (i.e. they are 'lost' when consuming modules with Maven or Ivy).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependency constraints themselves can also be added transitively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="downgrading_versions_and_excluding_dependencies"><a class="anchor" href="#downgrading_versions_and_excluding_dependencies"></a><a class="link" href="#downgrading_versions_and_excluding_dependencies">Downgrading versions and excluding dependencies</a></h4>
<div class="sect4">
<h5 id="sec:enforcing_dependency_version"><a class="anchor" href="#sec:enforcing_dependency_version"></a><a class="link" href="#sec:enforcing_dependency_version">Overriding transitive dependency versions</a></h5>
<div class="paragraph">
<p>Gradle resolves any dependency version conflicts by selecting the latest version found in the dependency graph.
Some projects might need to divert from the default behavior and enforce an earlier version of a dependency e.g. if the source code of the project depends on an older API of a dependency than some of the external libraries.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Forcing a version of a dependency requires a conscious decision.
Changing the version of a transitive dependency might lead to runtime errors if external libraries do not properly function without them.
Consider upgrading your source code to use a newer version of the library as an alternative approach.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general, forcing dependencies is done to downgrade a dependency.
There might be different use cases for downgrading:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a bug was discovered in the latest release</p>
</li>
<li>
<p>your code depends on a lower version which is not binary compatible</p>
</li>
<li>
<p>your code doesn&#8217;t depend on the code paths which need a higher version of a dependency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all situations, this is best expressed saying that your code <em>strictly depends on</em> a version of a transitive.
Using <a href="#sec:strict-version">strict versions</a>, you will effectively depend on the version you declare, even if a transitive dependency says otherwise.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Strict dependencies are to some extent similar to Maven&#8217;s <em>nearest first</em> strategy, but there are subtle differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>strict dependencies</em> don&#8217;t suffer an ordering problem: they are applied transitively to the subgraph, and it doesn&#8217;t matter in which order dependencies are declared.</p>
</li>
<li>
<p>conflicting strict dependencies will trigger a build failure that you have to resolve</p>
</li>
<li>
<p>strict dependencies can be used with rich versions, meaning that <a href="#sec:strict-version-consequences">it&#8217;s better to express the requirement in terms of a <em>strict range</em> combined with a single <em>preferred version</em></a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s say a project uses the <a href="https://hc.apache.org/httpcomponents-client-ga/">HttpClient library</a> for performing HTTP calls. HttpClient pulls in <a href="https://commons.apache.org/proper/commons-codec/">Commons Codec</a> as transitive dependency with version 1.10.
However, the production source code of the project requires an API from Commons Codec 1.9 which is not available in 1.10 anymore.
A dependency version can be enforced by declaring it as strict it in the build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 316. Setting a strict version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.4</span><span class="delimiter">'</span></span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec</span><span class="delimiter">'</span></span>) {
        version {
            strictly <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient:4.5.4&quot;)
    implementation(&quot;commons-codec:commons-codec&quot;) {
        version {
            strictly(&quot;1.9&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:strict-version-consequences"><a class="anchor" href="#sec:strict-version-consequences"></a><a class="link" href="#sec:strict-version-consequences">Consequences of using strict versions</a></h6>
<div class="paragraph">
<p>Using a strict version must be carefully considered, in particular by library authors.
As the <em>producer</em>, a strict version will effectively behave like a <em>force</em>: the version declaration takes precedence over whatever is found in the transitive dependency graph.
In particular, a <em>strict version</em> will override any other <em>strict version</em> on the same module found transitively.</p>
</div>
<div class="paragraph">
<p>However, for consumers, strict versions are still considered globally during graph resolution and <em>may trigger an error</em> if the consumer disagrees.</p>
</div>
<div class="paragraph">
<p>For example, imagine that your project <code>B</code> <em>strictly</em> depends on <code>C:1.0</code>.
Now, a consumer, <code>A</code>, depends on both <code>B</code> and <code>C:1.1</code>.</p>
</div>
<div class="paragraph">
<p>Then this would trigger a resolution error because <code>A</code> says it needs <code>C:1.1</code> but <code>B</code>, <em>within its subgraph</em>, strictly needs <code>1.0</code>.
This means that if you choose a <em>single version</em> in a strict constraint, then the version can <em>no longer be upgraded</em>, unless the consumer also sets a strict version constraint on the same module.</p>
</div>
<div class="paragraph">
<p>In the example above, <code>A</code> would have to say it <em>strictly depends on 1.1</em>.</p>
</div>
<div class="paragraph">
<p>For this reason, a good practice is that if you use <em>strict versions</em>, you should express them in terms of ranges and a preferred version within this range.
For example, <code>B</code> might say, instead of <code>strictly 1.0</code>, that it <em>strictly depends</em> on the <code>[1.0, 2.0[</code> range, but <em>prefers</em> <code>1.0</code>.
Then if a consumer chooses 1.1 (or any other version in the range), the build will <em>no longer fail</em> (constraints are resolved).</p>
</div>
</div>
<div class="sect5">
<h6 id="forced_dependencies_vs_strict_dependencies"><a class="anchor" href="#forced_dependencies_vs_strict_dependencies"></a><a class="link" href="#forced_dependencies_vs_strict_dependencies">Forced dependencies vs strict dependencies</a></h6>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Forcing dependencies via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ExternalDependency.html#setForce-boolean-">ExternalDependency.setForce(boolean)</a> is deprecated and no longer recommended:
forced dependencies suffer an ordering issue which can be hard to diagnose and will not work well together with other rich version constraints.
You should prefer <a href="#sec:enforcing_dependency_version">strict versions</a> instead.
If you are authoring and publishing a <a href="#">library</a>, you also need to be aware that <code>force</code> is <strong>not</strong> published.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If, for some reason, you can&#8217;t use <a href="#sec:enforcing_dependency_version">strict versions</a>, you can force a dependency doing this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 317. Enforcing a dependency version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.4</span><span class="delimiter">'</span></span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.9</span><span class="delimiter">'</span></span>) {
        force = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient:4.5.4&quot;)
    implementation(&quot;commons-codec:commons-codec:1.9&quot;) {
        isForce = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the project requires a specific version of a dependency on a configuration-level then it can be achieved by calling the method <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ResolutionStrategy.html#org.gradle.api.artifacts.ResolutionStrategy:force(java.lang.Object[])">ResolutionStrategy.force(java.lang.Object[])</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 318. Enforcing a dependency version on the configuration-level</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    compileClasspath {
        resolutionStrategy.force <span class="string"><span class="delimiter">'</span><span class="content">commons-codec:commons-codec:1.9</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.4</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;compileClasspath&quot; {
        resolutionStrategy.force(&quot;commons-codec:commons-codec:1.9&quot;)
    }
}

dependencies {
    implementation(&quot;org.apache.httpcomponents:httpclient:4.5.4&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:excluding-transitive-deps"><a class="anchor" href="#sec:excluding-transitive-deps"></a><a class="link" href="#sec:excluding-transitive-deps">Excluding transitive dependencies</a></h5>
<div class="paragraph">
<p>While the previous section showed how you can enforce a certain version of a transitive dependency, this section covers <em>excludes</em> as a way to remove a transitive dependency completely.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Similar as forcing a version of a dependency, excluding a dependency completely requires a conscious decision.
Excluding a transitive dependency might lead to runtime errors if external libraries do not properly function without them.
If you use excludes, make sure that you do not utilise any code path requiring the excluded dependency by sufficient test coverage.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Transitive dependencies can be excluded on the level of a declared dependency.
Exclusions are spelled out as a key/value pair via the attributes <code>group</code> and/or <code>module</code> as shown in the example below.
For more information, refer to <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ModuleDependency.html#exclude-java.util.Map-">ModuleDependency.exclude(java.util.Map)</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 319. Excluding a transitive dependency for a particular dependency declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, we add a dependency to <code>commons-beanutils</code> but exclude the transitive dependency <code>commons-collections</code>.
In our code, shown below, we only use one method from the beanutils library, <code>PropertyUtils.setSimpleProperty()</code>.
Using this method for existing setters does not require any functionality from <code>commons-collections</code> as we verified through test coverage.</p>
</div>
<div class="exampleblock">
<div class="title">Example 320. Using a utility from the beanutils library</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/Main.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.commons.beanutils.PropertyUtils</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Object</span> person = <span class="keyword">new</span> Person();
        PropertyUtils.setSimpleProperty(person, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart Simpson</span><span class="delimiter">&quot;</span></span>);
        PropertyUtils.setSimpleProperty(person, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">38</span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Effectively, we are expressing that we only use a <em>subset</em> of the library, which does not require the <code>commons-collection</code> library.
This can be seen as implicitly defining a <a href="#">feature variant</a> that has not been explicitly declared by <code>commons-beanutils</code> itself.
However, the risk of breaking an untested code path increased by doing this.</p>
</div>
<div class="paragraph">
<p>For example, here we use the <code>setSimpleProperty()</code> method to modify properties defined by setters in the <code>Person</code> class, which works fine.
If we would attempt to set a property not existing on the class, we <em>should</em> get an error like <code>Unknown property on class Person</code>.
However, because the error handling path uses a class from <code>commons-collections</code>, the error we now get is <code>NoClassDefFoundError: org/apache/commons/collections/FastHashMap</code>.
So if our code would be more dynamic, and we would forget to cover the error case sufficiently, consumers of our library might be confronted with unexpected errors.</p>
</div>
<div class="paragraph">
<p>This is only an example to illustrate potential pitfalls.
In practice, larger libraries or frameworks can bring in a huge set of dependencies.
If those libraries fail to declare features separately and can only be consumed in a "all or nothing" fashion, excludes can be a valid method to reduce the library to the feature set actually required.</p>
</div>
<div class="paragraph">
<p>On the upside, Gradle&#8217;s exclude handling is, in contrast to Maven, taking the whole dependency graph into account.
So if there are multiple dependencies on a library, excludes are only exercised if all dependencies agree on them.
For example, if we add <code>opencsv</code> as another dependency to our project above, which also depends on <code>commons-beanutils</code>, <code>commons-collection</code> is no longer excluded as <code>opencsv</code> itself does <strong>not</strong> exclude it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 321. Excludes only apply if all dependency declarations agree on an exclude</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    dependencies {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
            exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
        }
        implementation <span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span> <span class="comment">// depends on 'commons-beanutils' without exclude and brings back 'commons-collections'</span>
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
    implementation(&quot;com.opencsv:opencsv:4.6&quot;) // depends on 'commons-beanutils' without exclude and brings back 'commons-collections'
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we still want to have <code>commons-collections</code> excluded, because our combined usage of <code>commons-beanutils</code> and <code>opencsv</code> does not need it, we need to exclude it from the transitive dependencies of <code>opencsv</code> as well.</p>
</div>
<div class="exampleblock">
<div class="title">Example 322. Excluding a transitive dependency for multiple dependency declaration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    dependencies {
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>) {
            exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
        }
        implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span>) {
            exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    dependencies {
        implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;) {
            exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
        }
        implementation(&quot;com.opencsv:opencsv:4.6&quot;) {
            exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Historically, excludes were also used as a band aid to fix other issues not supported by some dependency management systems.
Gradle however, offers a variety of features that might be better suited to solve a certain use case.
You may consider to look into the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:enforcing_dependency_version">Update</a> or <a href="#sec:enforcing_dependency_version">downgrade</a> dependency versions:
If versions of dependencies clash, it is usually better to adjust the version through a dependency constraint, instead of attempting to exclude the dependency with the undesired version.</p>
</li>
<li>
<p><a href="#">Component Metadata Rules</a>:
If a library&#8217;s metadata is clearly wrong, for example if it includes a compile time dependency which is never needed at compile time, a possible solution is to remove the dependency in a component metadata rule.
By this, you tell Gradle that a dependency between two modules is never needed  i.e. the metadata was wrong  and therefore should <strong>never</strong> be considered.
If you are developing a library, you have to be aware that this information is not published, and so sometimes an <em>exclude</em> can be the better alternative.</p>
</li>
<li>
<p><a href="#">Resolving mutually exclusive dependency conflicts</a>:
Another situation that you often see solved by excludes is that two dependencies cannot be used together because they represent two implementations of the same thing (the same <a href="#sub:capabilities">capability</a>).
A popular example are clashing logging API implementations (like <code>log4j</code> and <code>log4j-over-slf4j</code>) or modules that have different coordinates in different versions (like <code>com.google.collections</code> and <code>guava</code>).
In this case, if this information is not known to Gradle, it is recommended to add the missing capability information via component metadata rules as described in the <a href="#sub:declaring-component-capabilities">declaring component capabilities</a> section.
Even if you are developing a library, and your consumers will have to deal with resolving the conflict again, it is often the right solution to leave the decision to the final consumers of libraries.
I.e. you as a library author should not have to decide which logging implementation your consumers use in the end.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:sharing-dep-versions-between-projects"><a class="anchor" href="#sec:sharing-dep-versions-between-projects"></a><a class="link" href="#sec:sharing-dep-versions-between-projects">Sharing dependency versions between projects</a></h4>
<div class="sect4">
<h5 id="sub:using-platform-to-control-transitive-deps"><a class="anchor" href="#sub:using-platform-to-control-transitive-deps"></a><a class="link" href="#sub:using-platform-to-control-transitive-deps">Using a platform to control transitive versions</a></h5>
<div class="paragraph">
<p>A <a href="#sub::terminology_platform">platform</a> is a special software component which can be used to control transitive dependency versions.
In most cases it&#8217;s exclusively composed of <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> which will either <em>suggest</em> dependency versions or <em>enforce</em> some versions.
As such, this is a perfect tool whenever you need to <em>share dependency versions between projects</em>.
In this case, a project will typically be organized this way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>platform</code> project which defines constraints for the various dependencies found in the different sub-projects</p>
</li>
<li>
<p>a number of sub-projects which <em>depend on</em> the platform and declare dependencies <em>without version</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Java ecosystem, Gradle provides a <a href="#java_platform_plugin">plugin</a> for this purpose.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also common to find platforms published as Maven BOMs which <a href="#sub:bom_import">Gradle supports natively</a>.</p>
</div>
<div class="paragraph">
<p>A dependency on a platform is created using the <code>platform</code> keyword:</p>
</div>
<div class="exampleblock">
<div class="title">Example 323. Getting versions declared in a platform</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// get recommended versions from the platform project</span>
    api platform(project(<span class="string"><span class="delimiter">'</span><span class="content">:platform</span><span class="delimiter">'</span></span>))
    <span class="comment">// no version required</span>
    api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // get recommended versions from the platform project
    api(platform(project(&quot;:platform&quot;)))
    // no version required
    api(&quot;commons-httpclient:commons-httpclient&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This <code>platform</code> notation is a short-hand notation which actually performs several operations under the hood:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Category.html">org.gradle.category attribute</a> to <code>platform</code>, which means that Gradle will select the <em>platform</em> component of the dependency.</p>
</li>
<li>
<p>it sets the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ModuleDependency.html#endorseStrictVersions--">endorseStrictVersions</a> behavior by default, meaning that if the platform declares strict dependencies, they will be enforced.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that by default, a dependency to a platform triggers the inheritance of all <a href="#sec:strict-version">strict versions</a> defined in that platform, which can be useful for platform authors to make sure that all consumers respect their decisions in terms of versions of dependencies.
This can be turned off by explicitly calling the <code>doNotEndorseStrictVersions</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:bom_import"><a class="anchor" href="#sub:bom_import"></a><a class="link" href="#sub:bom_import">Importing Maven BOMs</a></h5>
<div class="paragraph">
<p>Gradle provides support for importing <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Importing_Dependencies">bill of materials (BOM) files</a>, which are effectively <code>.pom</code> files that use <code>&lt;dependencyManagement&gt;</code> to control the dependency versions of direct and transitive dependencies.
The BOM support in Gradle works similar to using <code>&lt;scope&gt;import&lt;/scope&gt;</code> when depending on a BOM in Maven.
In Gradle however, it is done via a regular dependency declaration on the BOM:</p>
</div>
<div class="exampleblock">
<div class="title">Example 324. Depending on a BOM to import its dependency constraints</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// import a BOM</span>
    implementation platform(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE</span><span class="delimiter">'</span></span>)

    <span class="comment">// define dependencies without versions</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">dom4j:dom4j</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // import a BOM
    implementation(platform(&quot;org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE&quot;))

    // define dependencies without versions
    implementation(&quot;com.google.code.gson:gson&quot;)
    implementation(&quot;dom4j:dom4j&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, the versions of <code>gson</code> and <code>dom4j</code> are provided by the Spring Boot BOM.
This way, if you are developing for a platform like Spring Boot, you do not have to declare any versions yourself but can rely on the versions the platform provides.</p>
</div>
<div class="paragraph">
<p>Gradle treats all entries in the <code>&lt;dependencyManagement&gt;</code> block of a BOM similar to <a href="#sec:adding-constraints-transitive-deps">Gradle&#8217;s dependency constraints</a>.
This means that any version defined in the <code>&lt;dependencyManagement&gt;</code> block can impact the dependency resolution result.
In order to qualify as a BOM, a <code>.pom</code> file needs to have <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code> set.</p>
</div>
<div class="paragraph">
<p>However often BOMs are not only providing versions as recommendations, but also a way to override any other version found in the graph.
You can enable this behavior by using the <code>enforcedPlatform</code> keyword, instead of <code>platform</code>, when importing the BOM:</p>
</div>
<div class="exampleblock">
<div class="title">Example 325. Importing a BOM, making sure the versions it defines override any other version found</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// import a BOM. The versions used in this file will override any other version found in the graph</span>
    implementation enforcedPlatform(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE</span><span class="delimiter">'</span></span>)

    <span class="comment">// define dependencies without versions</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">dom4j:dom4j</span><span class="delimiter">'</span></span>

    <span class="comment">// this version will be overridden by the one found in the BOM</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:1.8.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // import a BOM. The versions used in this file will override any other version found in the graph
    implementation(enforcedPlatform(&quot;org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE&quot;))

    // define dependencies without versions
    implementation(&quot;com.google.code.gson:gson&quot;)
    implementation(&quot;dom4j:dom4j&quot;)

    // this version will be overridden by the one found in the BOM
    implementation(&quot;org.codehaus.groovy:groovy:1.8.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="version_alignment"><a class="anchor" href="#version_alignment"></a><a class="link" href="#version_alignment">Aligning dependency versions</a></h4>
<div class="paragraph">
<p>Dependency version alignment allows different modules belonging to the same logical group (a <em>platform</em>) to have identical versions in a dependency graph.</p>
</div>
<div class="sect4">
<h5 id="handling_inconsistent_module_versions"><a class="anchor" href="#handling_inconsistent_module_versions"></a><a class="link" href="#handling_inconsistent_module_versions">Handling inconsistent module versions</a></h5>
<div class="paragraph">
<p>Gradle supports aligning versions of modules which belong to the same "platform".
It is often preferable, for example, that the API and implementation modules of a component are using the same version.
However, because of the game of transitive dependency resolution, it is possible that different modules belonging to the same platform end up using different versions.
For example, your project may depend on the <code>jackson-databind</code> and <code>vert.x</code> libraries, as illustrated below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 326. Declaring dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// a dependency on Jackson Databind</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson.core:jackson-databind:2.8.9</span><span class="delimiter">'</span></span>

    <span class="comment">// and a dependency on vert.x</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">io.vertx:vertx-core:3.5.3</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // a dependency on Jackson Databind
    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.8.9&quot;)

    // and a dependency on vert.x
    implementation(&quot;io.vertx:vertx-core:3.5.3&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because <code>vert.x</code> depends on <code>jackson-core</code>, we would actually resolve the following dependency versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jackson-core</code> version <code>2.9.5</code> (brought by <code>vertx-core</code>)</p>
</li>
<li>
<p><code>jackson-databind</code> version <code>2.9.5</code> (by conflict resolution)</p>
</li>
<li>
<p><code>jackson-annotation</code> version <code>2.9.0</code> (dependency of <code>jackson-databind:2.9.5</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s easy to end up with a set of versions which do not work well together.
To fix this, Gradle supports dependency version alignment, which is supported by the concept of platforms.
A platform represents a set of modules which "work well together".
Either because they are actually published as a whole (when one of the members of the platform is published, all other modules are also published with the same version), or because someone tested the modules and indicates that they work well together (typically, the Spring Platform).</p>
</div>
</div>
<div class="sect4">
<h5 id="aligning_versions_natively_with_gradle"><a class="anchor" href="#aligning_versions_natively_with_gradle"></a><a class="link" href="#aligning_versions_natively_with_gradle">Aligning versions natively with Gradle</a></h5>
<div class="paragraph">
<p>Gradle natively supports alignment of modules produced by Gradle.
This is a direct consequence of the transitivity of <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a>.
So if you have a multi-project build, and you wish that consumers get the same version of all your modules, Gradle provides a simple way to do this using the <a href="#">Java Platform Plugin</a>.</p>
</div>
<div class="paragraph">
<p>For example, if you have a project that consists of 3 modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lib</code></p>
</li>
<li>
<p><code>utils</code></p>
</li>
<li>
<p><code>core</code>, depending on <code>lib</code> and <code>utils</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And a consumer that declares the following dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core</code> version 1.0</p>
</li>
<li>
<p><code>lib</code> version 1.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then by default resolution would select <code>core:1.0</code> and <code>lib:1.1</code>, because <code>lib</code> has no dependency on <code>core</code>.
We can fix this by adding a new module in our project, a <em>platform</em>, that will add constraints on all the modules of your project:</p>
</div>
<div class="exampleblock">
<div class="title">Example 327. The platform module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-platform</span><span class="delimiter">'</span></span>
}

dependencies {
    <span class="comment">// The platform declares constraints on all components that</span>
    <span class="comment">// require alignment</span>
    constraints {
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:core</span><span class="delimiter">&quot;</span></span>))
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))
        api(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:utils</span><span class="delimiter">&quot;</span></span>))
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-platform`
}

dependencies {
    // The platform declares constraints on all components that
    // require alignment
    constraints {
        api(project(&quot;:core&quot;))
        api(project(&quot;:lib&quot;))
        api(project(&quot;:utils&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once this is done, we need to make sure that all modules now <em>depend on the platform</em>, like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 328. Declaring a dependency on the platform</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Each project has a dependency on the platform</span>
    api(platform(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:platform</span><span class="delimiter">&quot;</span></span>)))

    <span class="comment">// And any additional dependency required</span>
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:utils</span><span class="delimiter">&quot;</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Each project has a dependency on the platform
    api(platform(project(&quot;:platform&quot;)))

    // And any additional dependency required
    implementation(project(&quot;:lib&quot;))
    implementation(project(&quot;:utils&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is important that the platform contains a constraint on all the components, but also that each component has a dependency on the platform.
By doing this, whenever Gradle will add a dependency to a module of the platform on the graph, it will <em>also</em> include constraints on the other modules of the platform.
This means that if we see another module belonging to the same platform, we will automatically upgrade to the same version.</p>
</div>
<div class="paragraph">
<p>In our example, it means that we first see <code>core:1.0</code>, which brings a platform <code>1.0</code> with constraints on <code>lib:1.0</code> and <code>lib:1.0</code>.
Then we add <code>lib:1.1</code> which has a dependency on <code>platform:1.1</code>.
By conflict resolution, we select the <code>1.1</code> platform, which has a constraint on <code>core:1.1</code>.
Then we conflict resolve between <code>core:1.0</code> and <code>core:1.1</code>, which means that <code>core</code> and <code>lib</code> are now aligned properly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This behavior is enforced for published components only if you use Gradle Module Metadata.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:align-versions-unpublished"><a class="anchor" href="#sec:align-versions-unpublished"></a><a class="link" href="#sec:align-versions-unpublished">Aligning versions of modules not published with Gradle</a></h5>
<div class="paragraph">
<p>Whenever the publisher doesn&#8217;t use Gradle, like in our Jackson example, we can explain to Gradle that all Jackson modules "belong to" the same platform and benefit from the same behavior as with native alignment.
There are two options to express that a set of modules belong to a platform:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A platform is <strong>published</strong> as a <a href="#sub:bom_import">BOM</a> and can be used:
For example, <code>com.fasterxml.jackson:jackson-bom</code> can be used as platform.
The information missing to Gradle in that case is that the platform should be added to the dependencies if one of its members is used.</p>
</li>
<li>
<p>No existing platform can be used. Instead, a <strong>virtual platform</strong> should be created by Gradle:
In this case, Gradle builds up the platform itself based on all the members that are used.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To provide the missing information to Gradle, you can define <a href="#">component metadata rules</a> as explained in the following.</p>
</div>
<div class="sect5">
<h6 id="sec:align_bom_platform"><a class="anchor" href="#sec:align_bom_platform"></a><a class="link" href="#sec:align_bom_platform">Align versions of modules using a published BOM</a></h6>
<div class="exampleblock">
<div class="title">Example 329. A dependency version alignment rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">JacksonBomAlignmentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext ctx) {
        ctx.details.with {
            <span class="keyword">if</span> (id.group.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson</span><span class="delimiter">&quot;</span></span>)) {
                <span class="comment">// declare that Jackson modules belong to the platform defined by the Jackson BOM</span>
                belongsTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson:jackson-bom:</span><span class="inline"><span class="inline-delimiter">${</span>id.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class JacksonBomAlignmentRule: ComponentMetadataRule {
    override fun execute(ctx: ComponentMetadataContext) {
        ctx.details.run {
            if (id.group.startsWith(&quot;com.fasterxml.jackson&quot;)) {
                // declare that Jackson modules belong to the platform defined by the Jackson BOM
                belongsTo(&quot;com.fasterxml.jackson:jackson-bom:${id.version}&quot;, false)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By using the <code>belongsTo</code> with <code>false</code> (<strong>not</strong> virtual), we declare that all modules belong to the same <em>published platform</em>.
In this case, the platform is <code>com.fasterxml.jackson:jackson-bom</code> and Gradle will look for it, as for any other module, in the declared repositories.</p>
</div>
<div class="exampleblock">
<div class="title">Example 330. Making use of a dependency version alignment rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components.all(JacksonBomAlignmentRule)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components.all&lt;JacksonBomAlignmentRule&gt;()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the rule, the versions in the example above align to whatever the selected version of <code>com.fasterxml.jackson:jackson-bom</code> defines.
In this case, <code>com.fasterxml.jackson:jackson-bom:2.9.5</code> will be selected as <code>2.9.5</code> is the highest version of a module selected.
In that BOM, the following versions are defined and will be used:
<code>jackson-core:2.9.5</code>,
<code>jackson-databind:2.9.5</code> and
<code>jackson-annotation:2.9.0</code>.
The lower versions of <code>jackson-annotation</code> here might be the desired result as it is what the BOM recommends.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This behavior is working reliable since Gradle 6.1. Effectively, it is similar to a <a href="#">component metadata rule</a> that adds a platform dependency to all members of the platform using <code>withDependencies</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="sec:virtual_platform"><a class="anchor" href="#sec:virtual_platform"></a><a class="link" href="#sec:virtual_platform">Align versions of modules without a published platform</a></h6>
<div class="exampleblock">
<div class="title">Example 331. A dependency version alignment rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">JacksonAlignmentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext ctx) {
        ctx.details.with {
            <span class="keyword">if</span> (id.group.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson</span><span class="delimiter">&quot;</span></span>)) {
                <span class="comment">// declare that Jackson modules all belong to the Jackson virtual platform</span>
                belongsTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.fasterxml.jackson:jackson-virtual-platform:</span><span class="inline"><span class="inline-delimiter">${</span>id.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class JacksonAlignmentRule: ComponentMetadataRule {
    override fun execute(ctx: ComponentMetadataContext) {
        ctx.details.run {
            if (id.group.startsWith(&quot;com.fasterxml.jackson&quot;)) {
                // declare that Jackson modules all belong to the Jackson virtual platform
                belongsTo(&quot;com.fasterxml.jackson:jackson-virtual-platform:${id.version}&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By using the <code>belongsTo</code> keyword without further parameter (platform <strong>is</strong> virtual), we declare that all modules belong to the same <em>virtual platform</em>, which is treated specially by the engine.
A virtual platform will not be retrieved from a repository.
The identifier, in this case <code>com.fasterxml.jackson:jackson-virtual-platform</code>, is something you as the build author define yourself.
The "content" of the platform is then created by Gradle on the fly by collecting all <code>belongsTo</code> statements pointing at the same virtual platform.</p>
</div>
<div class="exampleblock">
<div class="title">Example 332. Making use of a dependency version alignment rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components.all(JacksonAlignmentRule)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components.all&lt;JacksonAlignmentRule&gt;()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the rule, all versions in the example above would align to <code>2.9.5</code>.
In this case, also <code>jackson-annotation:2.9.5</code> will be taken, as that is how we defined our local virtual platform.</p>
</div>
<div class="paragraph">
<p>For both published and virtual platforms, Gradle lets you override the version choice of the platform itself by specifying an <em>enforced</em> dependency on the platform:</p>
</div>
<div class="exampleblock">
<div class="title">Example 333. Forceful platform downgrade</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Forcefully downgrade the virtual Jackson platform to 2.8.9</span>
    implementation enforcedPlatform(<span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson:jackson-virtual-platform:2.8.9</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Forcefully downgrade the virtual Jackson platform to 2.8.9
    implementation(enforcedPlatform(&quot;com.fasterxml.jackson:jackson-virtual-platform:2.8.9&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:handling-mutually-exclusive-deps"><a class="anchor" href="#sec:handling-mutually-exclusive-deps"></a><a class="link" href="#sec:handling-mutually-exclusive-deps">Handling mutually exclusive dependencies</a></h4>
<div class="sect4">
<h5 id="sub:capabilities"><a class="anchor" href="#sub:capabilities"></a><a class="link" href="#sub:capabilities">Introduction to component capabilities</a></h5>
<div class="paragraph">
<p>Often a dependency graph would accidentally contain multiple implementations of the same API.
This is particularly common with logging frameworks, where multiple bindings are available, and that one library chooses a binding when another transitive dependency chooses another.
Because those implementations live at different GAV coordinates, the build tool has usually no way to find out that there&#8217;s a conflict between those libraries.
To solve this, Gradle provides the concept of <em>capability</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s illegal to find two components providing the same <em>capability</em> in a single dependency graph.
Intuitively, it means that if Gradle finds two components that provide the same thing on classpath, it&#8217;s going to fail with an error indicating what modules are in conflict.
In our example, it means that different bindings of a logging framework provide the same capability.</p>
</div>
</div>
<div class="sect4">
<h5 id="capability_coordinates"><a class="anchor" href="#capability_coordinates"></a><a class="link" href="#capability_coordinates">Capability coordinates</a></h5>
<div class="paragraph">
<p>A <em>capability</em> is defined by a <code>(group, module, version)</code> triplet.
Each component defines an implicit capability corresponding to its GAV coordinates (group, artifact, version).
For example, the <code>org.apache.commons:commons-lang3:3.8</code> module has an implicit capability with group <code>org.apache.commons</code>, name <code>commons-lang3</code> and version <code>3.8</code>.
It is important to realize that capabilities are <em>versioned</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:declaring-component-capabilities"><a class="anchor" href="#sub:declaring-component-capabilities"></a><a class="link" href="#sub:declaring-component-capabilities">Declaring component capabilities</a></h5>
<div class="paragraph">
<p>By default, Gradle will fail if two components in the dependency graph provide the same capability.
Because most modules are currently published without Gradle Module Metadata, capabilities are not always automatically discovered by Gradle.
It is however interesting to use <em>rules</em> to declare component capabilities in order to discover conflicts as soon as possible, during the build instead of runtime.</p>
</div>
<div class="paragraph">
<p>A typical example is whenever a component is relocated at different coordinates in a new release.
For example, the ASM library lived at <code>asm:asm</code> coordinates until version <code>3.3.1</code>, then changed to <code>org.ow2.asm:asm</code> since <code>4.0</code>.
It is illegal to have both ASM &lt;= 3.3.1 and 4.0+ on the classpath, because they provide the same feature, it&#8217;s just that the component has been relocated.
Because each component has an implicit capability corresponding to its GAV coordinates, we can "fix" this by having a rule that will declare that the <code>asm:asm</code> module provides the <code>org.ow2.asm:asm</code> capability:</p>
</div>
<div class="exampleblock">
<div class="title">Example 334. Conflict resolution by capability</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">AsmCapability</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.with {
            <span class="keyword">if</span> (id.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span> &amp;&amp; id.name == <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span>) {
                allVariants {
                    <span class="local-variable">it</span>.withCapabilities {
                        <span class="comment">// Declare that ASM provides the org.ow2.asm:asm capability, but with an older version</span>
                        <span class="local-variable">it</span>.addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.ow2.asm</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">asm</span><span class="delimiter">&quot;</span></span>, id.version)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class AsmCapability : ComponentMetadataRule {
    override
    fun execute(context: ComponentMetadataContext) = context.details.run {
        if (id.group == &quot;asm&quot; &amp;&amp; id.name == &quot;asm&quot;) {
            allVariants {
                withCapabilities {
                    // Declare that ASM provides the org.ow2.asm:asm capability, but with an older version
                    addCapability(&quot;org.ow2.asm&quot;, &quot;asm&quot;, id.version)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the build is going to <em>fail</em> whenever the two components are found in the same dependency graph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At this stage, Gradle will <em>only</em> make more builds fail.
It will <strong>not</strong> automatically fix the problem for you, but it helps you realize that you have a problem.
It is recommended to write such rules in <em>plugins</em> which are then applied to your builds.
Then, users <em>have to</em> express their preferences, if possible, or fix the problem of having incompatible things on the classpath, as explained in the following section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:selecting-between-candidates"><a class="anchor" href="#sub:selecting-between-candidates"></a><a class="link" href="#sub:selecting-between-candidates">Selecting between candidates</a></h5>
<div class="paragraph">
<p>At some point, a dependency graph is going to include either <em>incompatible modules</em>, or modules which are <em>mutually exclusive</em>.
For example, you may have different logger implementations and you need to choose one binding.
<a href="#sub:capabilities">Capabilities</a> help <em>realizing</em> that you have a conflict, but Gradle also provides tools to express how to solve the conflicts.</p>
</div>
<div class="sect5">
<h6 id="sub:selecting-preferred-capability-provider"><a class="anchor" href="#sub:selecting-preferred-capability-provider"></a><a class="link" href="#sub:selecting-preferred-capability-provider">Selecting between different capability candidates</a></h6>
<div class="paragraph">
<p>In the relocation example above, Gradle was able to tell you that you have two versions of the same API on classpath: an "old" module and a "relocated" one.
Now we can solve the conflict by automatically choosing the component which has the highest capability version:</p>
</div>
<div class="exampleblock">
<div class="title">Example 335. Conflict resolution by capability versioning</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(<span class="string"><span class="delimiter">'</span><span class="content">org.ow2.asm:asm</span><span class="delimiter">'</span></span>) {
        selectHighestVersion()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.capabilitiesResolution.withCapability(&quot;org.ow2.asm:asm&quot;) {
        selectHighestVersion()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, fixing by choosing the highest capability version conflict resolution is not always suitable.
For a logging framework, for example, it doesn&#8217;t matter what version of the logging frameworks we use, we should always select Slf4j.</p>
</div>
<div class="paragraph">
<p>In this case, we can fix it by explicitly selecting slf4j as the winner:</p>
</div>
<div class="exampleblock">
<div class="title">Example 336. Substitute log4j with slf4j</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    configurations.all {
        resolutionStrategy.capabilitiesResolution.withCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j:log4j</span><span class="delimiter">&quot;</span></span>) {
            <span class="keyword">def</span> toBeSelected = candidates.find { <span class="local-variable">it</span>.id <span class="keyword">instanceof</span> ModuleComponentIdentifier &amp;&amp; <span class="local-variable">it</span>.id.module == <span class="string"><span class="delimiter">'</span><span class="content">log4j-over-slf4j</span><span class="delimiter">'</span></span> }
            <span class="keyword">if</span> (toBeSelected != <span class="predefined-constant">null</span>) {
                select(toBeSelected)
            }
            because <span class="string"><span class="delimiter">'</span><span class="content">use slf4j in place of log4j</span><span class="delimiter">'</span></span>
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    configurations.all {
        resolutionStrategy.capabilitiesResolution.withCapability(&quot;log4j:log4j&quot;) {
            val toBeSelected = candidates.firstOrNull { it.id.let { id -&gt; id is ModuleComponentIdentifier &amp;&amp; id.module == &quot;log4j-over-slf4j&quot; } }
            if (toBeSelected != null) {
                select(toBeSelected)
            }
            because(&quot;use slf4j in place of log4j&quot;)
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this approach works also well if you have multiple <em>Slf4j bindings</em> on the classpath:
bindings are basically different logger implementations and you need only one.
However, the selected implementation may depend on the configuration being resolved.
For example, for tests, <code>slf4j-simple</code> may be enough but for production, <code>slf4-over-log4j</code> may be better.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Resolution can only be made in favor of a module <em>found</em> in the graph.</p>
</div>
<div class="paragraph">
<p>The <code>select</code> method only accepts a module found in the <em>current</em> candidates.
If the module you want to select is not part of the conflict, you can abstain from performing a selection, effectively not resolving <em>this</em> conflict.
It might be that another conflict exists in the graph for the same capability and will have the module you want to select.</p>
</div>
<div class="paragraph">
<p>If no resolution is given for all conflicts on a given capability, the build will fail given the module chosen for resolution was not part of the graph at all.</p>
</div>
<div class="paragraph">
<p>In addition <code>select(null)</code> will result in an error and so should be avoided.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, check out the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ResolutionStrategy.html#capabilitiesResolution">the capabilities resolution API</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:component_metadata_rules"><a class="anchor" href="#sec:component_metadata_rules"></a><a class="link" href="#sec:component_metadata_rules">Fixing metadata with component metadata rules</a></h4>
<div class="paragraph">
<p>Each module that is pulled from a repository has metadata associated with it, such as its group, name, version as well as the different variants it provides with their artifacts and dependencies.
Sometimes, this metadata is incomplete or incorrect.
To manipulate such incomplete metadata from within the build script, Gradle offers an API to write <em>component metadata rules</em>.
These rules take effect after a module&#8217;s metadata has been downloaded, but before it is used in dependency resolution.</p>
</div>
<div class="sect4">
<h5 id="basics_of_writing_a_component_metadata_rule"><a class="anchor" href="#basics_of_writing_a_component_metadata_rule"></a><a class="link" href="#basics_of_writing_a_component_metadata_rule">Basics of writing a component metadata rule</a></h5>
<div class="paragraph">
<p>Component metadata rules are applied in the components (<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.ComponentMetadataHandler.html">ComponentMetadataHandler</a>) section of the dependencies block (<a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">DependencyHandler</a>) of a build script.
The rules can be defined in two different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As an action directly when they are applied in the <em>components</em> section</p>
</li>
<li>
<p>As an isolated class implementing the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadataRule.html">ComponentMetadataRule</a> interface</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While defining rules inline as action can be convenient for experimentation, it is generally recommended to define rules as separate classes.
Rules that are written as isolated classes can be annotated with <code>@CacheableRule</code> to cache the results of their application such that they do not need to be re-executed each time dependencies are resolved.</p>
</div>
<div class="exampleblock">
<div class="title">Example 337. Example of a configurable component metadata rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">TargetJvmVersionRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="directive">final</span> <span class="predefined-type">Integer</span> jvmVersion
    <span class="annotation">@Inject</span> TargetJvmVersionRule(<span class="predefined-type">Integer</span> jvmVersion) {
        <span class="local-variable">this</span>.jvmVersion = jvmVersion
    }

    <span class="annotation">@Inject</span> <span class="predefined-type">ObjectFactory</span> getObjects() { }

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.withVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, jvmVersion)
                attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_API))
            }
        }
    }
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-io:commons-io</span><span class="delimiter">&quot;</span></span>, TargetJvmVersionRule) {
            params(<span class="integer">7</span>)
        }
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-collections:commons-collections</span><span class="delimiter">&quot;</span></span>, TargetJvmVersionRule) {
            params(<span class="integer">8</span>)
        }
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">&quot;</span></span>)
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">commons-collections:commons-collections:3.2.2</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class TargetJvmVersionRule @Inject constructor(val jvmVersion: Int) : ComponentMetadataRule {
    @Inject open fun getObjects(): ObjectFactory = throw UnsupportedOperationException()

    override fun execute(context: ComponentMetadataContext) {
        context.details.withVariant(&quot;compile&quot;) {
            attributes {
                attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, jvmVersion)
                attribute(Usage.USAGE_ATTRIBUTE, getObjects().named(Usage.JAVA_API))
            }
        }
    }
}
dependencies {
    components {
        withModule&lt;TargetJvmVersionRule&gt;(&quot;commons-io:commons-io&quot;) {
            params(7)
        }
        withModule&lt;TargetJvmVersionRule&gt;(&quot;commons-collections:commons-collections&quot;) {
            params(8)
        }
    }
    implementation(&quot;commons-io:commons-io:2.6&quot;)
    implementation(&quot;commons-collections:commons-collections:3.2.2&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the examples above, component metadata rules are defined by implementing <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadataRule.html">ComponentMetadataRule</a> which has a single <code>execute</code> method receiving an instance of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a> as parameter.
In this example, the rule is also further configured through an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/ActionConfiguration.html">ActionConfiguration</a>.
This is supported by having a constructor in your implementation of <code>ComponentMetadataRule</code> accepting the parameters that were configured and the services that need injecting.</p>
</div>
<div class="paragraph">
<p>Gradle enforces isolation of instances of <code>ComponentMetadataRule</code>.
This means that all parameters must be <code>Serializable</code> or known Gradle types that can be isolated.</p>
</div>
<div class="paragraph">
<p>In addition, Gradle services can be injected into your <code>ComponentMetadataRule</code>.
Because of this, the moment you have a constructor, it must be annotated with <code>@javax.inject.Inject</code>.
A commonly required service is <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> to create instances of strongly typed value objects like a value for setting an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Attribute.html">Attribute</a>.
A service which is helpful for advanced usage of component metadata rules with custom metadata is the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/repositories/RepositoryResourceAccessor.html">RepositoryResourceAccessor</a>.</p>
</div>
<div class="paragraph">
<p>A component metadata rule can be applied to all modules  <code>all(rule)</code>  or to a selected module  <code>withModule(groupAndName, rule)</code>.
Usually, a rule is specifically written to enrich metadata of one specific module and hence the <code>withModule</code> API should be preferred.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:component_metadata_rules_details"><a class="anchor" href="#sec:component_metadata_rules_details"></a><a class="link" href="#sec:component_metadata_rules_details">Which parts of metadata can be modified?</a></h5>
<div class="paragraph">
<p>The component metadata rules API is oriented at the features supported by <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> and the <em>dependencies</em> API in build scripts.
The main difference between writing rules and defining dependencies and artifacts in the build script is that component metadata rules, following the structure of Gradle Module Metadata, operate on <a href="#understanding-variant-selection">variants</a> directly.
On the contrary, in build scripts you often influence the shape of multiple variants at once (e.g. an <em>api</em> dependency is added to the <em>api</em> and <em>runtime</em> variant of a Java library, the artifact produced by the <em>jar</em> task is also added to these two variants).</p>
</div>
<div class="paragraph">
<p>Variants can be addressed for modification through the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>allVariants</code>: modify all variants of a component</p>
</li>
<li>
<p><code>withVariant(name)</code>: modify a single variant identified by its name</p>
</li>
<li>
<p><code>addVariant(name)</code> or <code>addVariant(name, base)</code>: add a new variant to the component either <em>from scratch</em> or by <em>copying</em> the details of an existing variant (base)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following details of each variant can be adjusted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="#sec:abm_configuration_attributes">attributes</a> that identify the variant  <code>attributes {}</code> block</p>
</li>
<li>
<p>The <a href="#declaring-component-capabilities">capabilities</a> the variant provides  <code>withCapabilities { }</code> block</p>
</li>
<li>
<p>The <a href="#">dependencies</a> of the variant, including <a href="#">rich versions</a>  <code>withDependencies {}</code> block</p>
</li>
<li>
<p>The <a href="#sec:adding-constraints-transitive-deps">dependency constraints</a> of the variant, including <a href="#">rich versions</a>  <code>withDependencyConstraints {}</code> block</p>
</li>
<li>
<p>The location of the published files that make up the actual content of the variant  <code>withFiles { }</code> block</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also a few properties of the whole component that can be changed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>component level attributes</em>, currently the only meaningful attribute there is <code>org.gradle.status</code></p>
</li>
<li>
<p>The <em>status scheme</em> to influence interpretation of the <code>org.gradle.status</code> attribute during version selection</p>
</li>
<li>
<p>The <em>belongsTo</em> property for <a href="#sec:declaring-capabilities-external-modules">version alignment through virtual platforms</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the format of the metadata of a module, it is mapped differently to the variant-centric representation of the metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the module has Gradle Module Metadata, the data structure the rule operates on is very similar to what you find in the module&#8217;s <code>.module</code> file.</p>
</li>
<li>
<p>If the module was published only with <code>.pom</code> metadata, a number of fixed variants is derived as explained in the <a href="#sub:maven-mapping-to-variants">mapping of POM files to variants</a> section.</p>
</li>
<li>
<p>If the module was published only with an <code>ivy.xml</code> file, the <em>Ivy configurations</em> defined in the file can be accessed instead of variants.
Their dependencies, dependency constraints and files can be modified.
Additionally, the <code>addVariant(name, baseVariantOrConfiguration) { }</code> API can be used to derive variants from <em>Ivy configurations</em> if desired (for example, <a href="#sub:ivy-mapping-to-variants"><em>compile</em> and <em>runtime</em> variants for the Java library plugin</a> can be defined with this).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="when_to_use_component_metadata_rules"><a class="anchor" href="#when_to_use_component_metadata_rules"></a><a class="link" href="#when_to_use_component_metadata_rules">When to use Component Metadata Rules?</a></h5>
<div class="paragraph">
<p>In general, if you consider using component metadata rules to adjust the metadata of a certain module, you should check first if that module was published with Gradle Module Metadata (<code>.module</code> file) or traditional metadata only (<code>.pom</code> or <code>ivy.xml</code>).</p>
</div>
<div class="paragraph">
<p>If a module was published with Gradle Module Metadata, the metadata is likely complete although there can still be cases where something is just plainly wrong.
For these modules you should only use component metadata rules if you have clearly identified a problem with the metadata itself.
If you have an issue with the dependency resolution result, you should first check if you can solve the issue by declaring <a href="#">dependency constraints with rich versions</a>.
In particular, if you are developing a library that you publish, you should remember that dependency constraints, in contrast to component metadata rules, are published as part of the metadata of your own library.
So with dependency constraints, you automatically share the solution of dependency resolution issues with your consumers, while component metadata rules are only applied to your own build.</p>
</div>
<div class="paragraph">
<p>If a module was published with traditional metadata (<code>.pom</code> or <code>ivy.xml</code> only, no <code>.module</code> file) it is more likely that the metadata is incomplete as features such as variants or dependency constraints are not supported in these formats.
Still, conceptually such modules can contain different variants or might have dependency constraints they just omitted (or wrongly defined as dependencies).
In the next sections, we explore a number existing oss modules with such incomplete metadata and the rules for adding the missing metadata information.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, you should contemplate if the rule you are writing also works out of context of your build.
That is, does the rule still produce a correct and useful result if applied in any other build that uses the module(s) it affects?</p>
</div>
</div>
<div class="sect4">
<h5 id="fixing_wrong_dependency_details"><a class="anchor" href="#fixing_wrong_dependency_details"></a><a class="link" href="#fixing_wrong_dependency_details">Fixing wrong dependency details</a></h5>
<div class="paragraph">
<p>Let&#8217;s consider as an example the publication of the Jaxen XPath Engine on <a href="https://repo1.maven.org/maven2/jaxen/jaxen">Maven central</a>.
The pom of version 1.1.3 declares a number of dependencies in the compile scope which are not actually needed for compilation.
These have been removed in the 1.1.4 pom.
Assuming that we need to work with 1.1.3 for some reason, we can fix the metadata with the following rule:</p>
</div>
<div class="exampleblock">
<div class="title">Example 338. Rule to remove unused dependencies of Jaxen metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">JaxenDependenciesRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.allVariants {
            withDependencies {
                removeAll { <span class="local-variable">it</span>.group <span class="keyword">in</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">dom4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xerces</span><span class="delimiter">&quot;</span></span>,  <span class="string"><span class="delimiter">&quot;</span><span class="content">maven-plugins</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xml-apis</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">xom</span><span class="delimiter">&quot;</span></span>] }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class JaxenDependenciesRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.allVariants {
            withDependencies {
                removeAll { it.group in listOf(&quot;dom4j&quot;, &quot;jdom&quot;, &quot;xerces&quot;,  &quot;maven-plugins&quot;, &quot;xml-apis&quot;, &quot;xom&quot;) }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Within the <code>withDependencies</code> block you have access to the full list of dependencies and can use all methods available on the Java collection interface to inspect and modify that list.
In addition, there are <code>add(notation, configureAction)</code> methods accepting the usual notations similar to <a href="#">declaring dependencies</a> in the build script.
Dependency constraints can be inspected and modified the same way in the <code>withDependencyConstraints</code> block.</p>
</div>
<div class="paragraph">
<p>If we take a closer look at the Jaxen 1.1.4 pom, we observe that the <em>dom4j</em>, <em>jdom</em> and <em>xerces</em> dependencies are still there but marked as <em>optional</em>.
Optional dependencies in poms are not automatically processed by Gradle nor Maven.
The reason is that they indicate that there are <a href="#">optional feature variants</a> provided by the Jaxen library which require one or more of these dependencies, but the information what these features are and which dependency belongs to which is missing.
Such information cannot be represented in pom files, but in Gradle Module Metadata through variants and <a href="#declaring-component-capabilities">capabilities</a>.
Hence, we can add this information in a rule as well.</p>
</div>
<div class="exampleblock">
<div class="title">Example 339. Rule to add optional feature to Jaxen metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">JaxenCapabilitiesRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime-dom4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
            withCapabilities {
                removeCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>)
                addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen-dom4j</span><span class="delimiter">&quot;</span></span>, context.details.id.version)
            }
            withDependencies {
                add(<span class="string"><span class="delimiter">&quot;</span><span class="content">dom4j:dom4j:1.6.1</span><span class="delimiter">&quot;</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class JaxenCapabilitiesRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.addVariant(&quot;runtime-dom4j&quot;, &quot;runtime&quot;) {
            withCapabilities {
                removeCapability(&quot;jaxen&quot;, &quot;jaxen&quot;)
                addCapability(&quot;jaxen&quot;, &quot;jaxen-dom4j&quot;, context.details.id.version)
            }
            withDependencies {
                add(&quot;dom4j:dom4j:1.6.1&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we first use the <code>addVariant(name, baseVariant)</code> method to create an additional variant, which we identify as <em>feature variant</em> by defining a new capability <em>jaxen-dom4j</em> to represent the optional dom4j integration feature of Jaxen.
This works similar to <a href="#sec::declare_feature_variants">defining optional feature variants</a> in build scripts.
We then use one of the <code>add</code> methods for adding dependencies to define which dependencies this optional feature needs.</p>
</div>
<div class="paragraph">
<p>In the build script, we can then add a <a href="#sec::consuming_feature_variants">dependency to the optional feature</a> and Gradle will use the enriched metadata to discover the correct transitive dependencies.</p>
</div>
<div class="exampleblock">
<div class="title">Example 340. Applying and utilising rules for Jaxen metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen</span><span class="delimiter">&quot;</span></span>, JaxenDependenciesRule)
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen</span><span class="delimiter">&quot;</span></span>, JaxenCapabilitiesRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen:1.1.3</span><span class="delimiter">&quot;</span></span>)
    runtimeOnly(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen:1.1.3</span><span class="delimiter">&quot;</span></span>) {
        capabilities { requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">jaxen:jaxen-dom4j</span><span class="delimiter">&quot;</span></span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components {
        withModule&lt;JaxenDependenciesRule&gt;(&quot;jaxen:jaxen&quot;)
        withModule&lt;JaxenCapabilitiesRule&gt;(&quot;jaxen:jaxen&quot;)
    }
    implementation(&quot;jaxen:jaxen:1.1.3&quot;)
    runtimeOnly(&quot;jaxen:jaxen:1.1.3&quot;) {
        capabilities { requireCapability(&quot;jaxen:jaxen-dom4j&quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="making_variants_published_as_classified_jars_explicit"><a class="anchor" href="#making_variants_published_as_classified_jars_explicit"></a><a class="link" href="#making_variants_published_as_classified_jars_explicit">Making variants published as classified jars explicit</a></h5>
<div class="paragraph">
<p>While in the previous example, all variants, "main variants" and optional features, were packaged in one jar file, it is common to publish certain variants as separate files.
In particular, when the variants are mutual exclusive  i.e. they are <strong>not</strong> feature variants, but different variants offering alternative choices.
One example <strong>all</strong> pom-based libraries already have are the <em>runtime</em> and <em>compile</em> variants, where Gradle can choose only one depending on the task at hand.
Another of such alternatives discovered often in the Java ecosystems are jars targeting different Java versions.</p>
</div>
<div class="paragraph">
<p>As example, we look at version 0.7.9 of the asynchronous programming library Quasar published on <a href="https://repo1.maven.org/maven2/co/paralleluniverse/quasar-core/0.7.9">Maven central</a>.
If we inspect the directory listing, we discover that a <code>quasar-core-0.7.9-jdk8.jar</code> was published, in addition to <code>quasar-core-0.7.9.jar</code>.
Publishing additional jars with a <em>classifier</em> (here <em>jdk8</em>) is common practice in maven repositories.
And while both Maven and Gradle allow you to reference such jars by classifier, they are not mentioned at all in the metadata.
Thus, there is no information that these jars exist and if there are any other differences, like different dependencies, between the variants represented by such jars.</p>
</div>
<div class="paragraph">
<p>In Gradle Module Metadata, this variant information would be present and for the already published Quasar library, we can add it using the following rule:</p>
</div>
<div class="exampleblock">
<div class="title">Example 341. Rule to add JDK 8 variants to Quasar metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">QuasarRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdk8</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">8</span>)
                }
                withFiles {
                    removeAllFiles()
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.name<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-jdk8.jar</span><span class="delimiter">&quot;</span></span>)
                }
            }
            context.details.withVariant(base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">7</span>)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class QuasarRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            context.details.addVariant(&quot;jdk8${base.capitalize()}&quot;, base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 8)
                }
                withFiles {
                    removeAllFiles()
                    addFile(&quot;${context.details.id.name}-${context.details.id.version}-jdk8.jar&quot;)
                }
            }
            context.details.withVariant(base) {
                attributes {
                    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 7)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, it is pretty clear that the classifier stands for a target Java version, which is a <a href="#sec:variant-aware-matching">known Java ecosystem attribute</a>.
Because we also need both a <em>compile</em> and <em>runtime</em> for Java 8, we create two new variants but use the existing <em>compile</em> and <em>runtime</em> variants as <em>base</em>.
This way, all other Java ecosystem attributes are already set correctly and all dependencies are carried over.
Then we set the <code>TARGET_JVM_VERSION_ATTRIBUTE</code> to <code>8</code> for both variants, remove any existing file from the new variants with <code>removeAllFiles()</code>, and add the jdk8 jar file with <code>addFile()</code>.
The <code>removeAllFiles()</code> is needed, because the reference to the main jar <code>quasar-core-0.7.5.jar</code> is copied from the corresponding base variant.</p>
</div>
<div class="paragraph">
<p>We also enrich the existing <em>compile</em> and <em>runtime</em> variants with the information that they target Java 7  <code>attribute(TARGET_JVM_VERSION_ATTRIBUTE, 7)</code>.</p>
</div>
<div class="paragraph">
<p>Now, we can request a Java 8 versions for all of our dependencies on the compile classpath in the build script and Gradle will automatically select the best fitting variant for each library.
In the case of Quasar this will now be the <em>jdk8Compile</em> variant exposing the <code>quasar-core-0.7.9-jdk8.jar</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 342. Applying and utilising rule for Quasar metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.compileClasspath.attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">8</span>)
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">co.paralleluniverse:quasar-core</span><span class="delimiter">&quot;</span></span>, QuasarRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">co.paralleluniverse:quasar-core:0.7.9</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;compileClasspath&quot;].attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 8)
}
dependencies {
    components {
        withModule&lt;QuasarRule&gt;(&quot;co.paralleluniverse:quasar-core&quot;)
    }
    implementation(&quot;co.paralleluniverse:quasar-core:0.7.9&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="making_variants_encoded_in_versions_explicit"><a class="anchor" href="#making_variants_encoded_in_versions_explicit"></a><a class="link" href="#making_variants_encoded_in_versions_explicit">Making variants encoded in versions explicit</a></h5>
<div class="paragraph">
<p>Another solution to publish multiple alternatives for the same library is the usage of a a versioning pattern as done by the popular Guava library.
Here, each new version is published twice by appending the classifier to the version instead of the jar artifact.
In the case of Guava 28 for example, we can find a <em>28.0-jre</em> (Java 8) and <em>28.0-android</em> (Java 6) version on <a href="https://repo1.maven.org/maven2/com/google/guava/guava">Maven central</a>.
The advantage of using this pattern when working only with pom metadata is that both variants are discoverable through the version.
The disadvantage is that there is no information what the different version suffixes mean semantically.
So in the case of conflict, Gradle would just pick the highest version when comparing the version strings.</p>
</div>
<div class="paragraph">
<p>Turning this into proper variants is a bit more tricky, as Gradle first selects a version of a module and then selects the best fitting variant.
So the concept that variants are encoded as versions is not supported directly.
However, since both variants are always published together we can assume that the files are physically located in the same repository.
And since they are published with Maven repository conventions, we know the location of each file if we know module name and version.
We can write the following rule:</p>
</div>
<div class="exampleblock">
<div class="title">Example 343. Rule to add JDK 6 and JDK 8 variants to Guava metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GuavaRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> variantVersion = context.details.id.version
        <span class="keyword">def</span> version = variantVersion.substring(<span class="integer">0</span>, variantVersion.indexOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>))
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            [<span class="integer">6</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">android</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jre</span><span class="delimiter">&quot;</span></span>].each { targetJvmVersion, jarName -&gt;
                context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdk</span><span class="inline"><span class="inline-delimiter">$</span>targetJvmVersion</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                    attributes {
                        attributes.attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, targetJvmVersion)
                    }
                    withFiles {
                        removeAllFiles()
                        addFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">guava-</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>jarName<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">../</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">$</span>jarName</span><span class="content">/guava-</span><span class="inline"><span class="inline-delimiter">$</span>version</span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>jarName<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GuavaRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val variantVersion = context.details.id.version
        val version = variantVersion.substring(0, variantVersion.indexOf(&quot;-&quot;))
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            mapOf(6 to &quot;android&quot;, 8 to &quot;jre&quot;).forEach { (targetJvmVersion, jarName) -&gt;
                context.details.addVariant(&quot;jdk$targetJvmVersion${base.capitalize()}&quot;, base) {
                    attributes {
                        attributes.attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, targetJvmVersion)
                    }
                    withFiles {
                        removeAllFiles()
                        addFile(&quot;guava-$version-$jarName.jar&quot;, &quot;../$version-$jarName/guava-$version-$jarName.jar&quot;)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similar to the previous example, we add runtime and compile variants for both Java versions.
In the <code>withFiles</code> block however, we now also specify a relative path for the corresponding jar file which allows Gradle to find the file no matter if it has selected a <em>-jre</em> or <em>-android</em> version.
The path is always relative to the location of the metadata (in this case <code>pom</code>) file of the selection module version.
So with this rules, both Guava 28 "versions" carry both the <em>jdk6</em> and <em>jdk8</em> variants.
So it does not matter to which one Gradle resolves.
The variant, and with it the correct jar file, is determined based on the requested <code>TARGET_JVM_VERSION_ATTRIBUTE</code> value.</p>
</div>
<div class="exampleblock">
<div class="title">Example 344. Applying and utilising rule for Guava metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.compileClasspath.attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, <span class="integer">6</span>)
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava</span><span class="delimiter">&quot;</span></span>, GuavaRule)
    }
    <span class="comment">// '23.3-android' and '23.3-jre' are now the same as both offer both variants</span>
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava:23.3+</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;compileClasspath&quot;].attributes {
    attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, 6)
}
dependencies {
    components {
        withModule&lt;GuavaRule&gt;(&quot;com.google.guava:guava&quot;)
    }
    // '23.3-android' and '23.3-jre' are now the same as both offer both variants
    implementation(&quot;com.google.guava:guava:23.3+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="adding_variants_for_native_jars"><a class="anchor" href="#adding_variants_for_native_jars"></a><a class="link" href="#adding_variants_for_native_jars">Adding variants for native jars</a></h5>
<div class="paragraph">
<p>Jars with classifiers are also used to separate parts of a library for which multiple alternatives exists, for example native code, from the main artifact.
This is for example done by the Lightweight Java Game Library (LWGJ), which publishes several platform specific jars to <a href="https://repo1.maven.org/maven2/org/lwjgl/lwjgl/3.2.3">Maven central</a> from which always one is needed, in addition to the main jar, at runtime.
It is not possible to convey this information in pom metadata as there is no concept of putting multiple artifacts in relation through the metadata.
In Gradle Module Metadata, each variant can have arbitrary many files and we can leverage that by writing the following rule:</p>
</div>
<div class="exampleblock">
<div class="title">Example 345. Rule to add native runtime variants to LWGJ metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LwjglRule</span> <span class="directive">implements</span> ComponentMetadataRule { <span class="comment">//val os: String, val arch: String, val classifier: String)</span>
    <span class="directive">private</span> <span class="keyword">def</span> nativeVariants = [
        [<span class="key">os</span>: OperatingSystemFamily.LINUX,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">arm32</span><span class="delimiter">&quot;</span></span>,  <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-linux-arm32</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.LINUX,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">arm64</span><span class="delimiter">&quot;</span></span>,  <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-linux-arm64</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.WINDOWS, <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>,    <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-windows-x86</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.WINDOWS, <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86-64</span><span class="delimiter">&quot;</span></span>, <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-windows</span><span class="delimiter">&quot;</span></span>],
        [<span class="key">os</span>: OperatingSystemFamily.MACOS,   <span class="key">arch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x86-64</span><span class="delimiter">&quot;</span></span>, <span class="key">classifier</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">natives-macos</span><span class="delimiter">&quot;</span></span>]
    ]

    <span class="annotation">@Inject</span> <span class="predefined-type">ObjectFactory</span> getObjects() { }

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.withVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>))
                attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(MachineArchitecture, <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>))
            }
        }
        nativeVariants.each { variantDefinition -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>variantDefinition.classifier<span class="inline-delimiter">}</span></span><span class="content">-runtime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>) {
                attributes {
                    attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, variantDefinition.os))
                    attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, objects.named(MachineArchitecture, variantDefinition.arch))
                }
                withFiles {
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.name<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">${</span>variantDefinition.classifier<span class="inline-delimiter">}</span></span><span class="content">.jar</span><span class="delimiter">&quot;</span></span>)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class LwjglRule: ComponentMetadataRule {
    data class NativeVariant(val os: String, val arch: String, val classifier: String)

    private val nativeVariants = listOf(
        NativeVariant(OperatingSystemFamily.LINUX,   &quot;arm32&quot;,  &quot;natives-linux-arm32&quot;),
        NativeVariant(OperatingSystemFamily.LINUX,   &quot;arm64&quot;,  &quot;natives-linux-arm64&quot;),
        NativeVariant(OperatingSystemFamily.WINDOWS, &quot;x86&quot;,    &quot;natives-windows-x86&quot;),
        NativeVariant(OperatingSystemFamily.WINDOWS, &quot;x86-64&quot;, &quot;natives-windows&quot;),
        NativeVariant(OperatingSystemFamily.MACOS,   &quot;x86-64&quot;, &quot;natives-macos&quot;)
    )

    @Inject open fun getObjects(): ObjectFactory = throw UnsupportedOperationException()

    override fun execute(context: ComponentMetadataContext) {
        context.details.withVariant(&quot;runtime&quot;) {
            attributes {
                attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, getObjects().named(&quot;none&quot;))
                attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, getObjects().named(&quot;none&quot;))
            }
        }
        nativeVariants.forEach { variantDefinition -&gt;
            context.details.addVariant(&quot;${variantDefinition.classifier}-runtime&quot;, &quot;runtime&quot;) {
                attributes {
                    attributes.attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, getObjects().named(variantDefinition.os))
                    attributes.attribute(MachineArchitecture.ARCHITECTURE_ATTRIBUTE, getObjects().named(variantDefinition.arch))
                }
                withFiles {
                    addFile(&quot;${context.details.id.name}-${context.details.id.version}-${variantDefinition.classifier}.jar&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This rule is quite similar to the Quasar library example above.
Only this time we have five different runtime variants we add and nothing we need to change for the compile variant.
The runtime variants are all based on the existing <em>runtime</em> variant and we do not change any existing information.
All Java ecosystem attributes, the dependencies and the main jar file stay part of each of the runtime variants.
We only set the additional attributes <code>OPERATING_SYSTEM_ATTRIBUTE</code> and <code>ARCHITECTURE_ATTRIBUTE</code> which are defined as part of Gradle&#8217;s <a href="#">native support</a>.
And we add the corresponding native jar file so that each runtime variant now carries two files: the main jar and the native jar.</p>
</div>
<div class="paragraph">
<p>In the build script, we can now request a specific variant and Gradle will fail with a selection error if more information is needed to make a decision.</p>
</div>
<div class="exampleblock">
<div class="title">Example 346. Applying and utilising rule for LWGJ metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations[<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeClasspath</span><span class="delimiter">&quot;</span></span>].attributes {
    attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(OperatingSystemFamily, <span class="string"><span class="delimiter">&quot;</span><span class="content">windows</span><span class="delimiter">&quot;</span></span>))
}
dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.lwjgl:lwjgl</span><span class="delimiter">&quot;</span></span>, LwjglRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.lwjgl:lwjgl:3.2.3</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations[&quot;runtimeClasspath&quot;].attributes {
    attribute(OperatingSystemFamily.OPERATING_SYSTEM_ATTRIBUTE, objects.named(&quot;windows&quot;))
}
dependencies {
    components {
        withModule&lt;LwjglRule&gt;(&quot;org.lwjgl:lwjgl&quot;)
    }
    implementation(&quot;org.lwjgl:lwjgl:3.2.3&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle fails to select a variant because a machine architecture needs to be chosen</div>
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':runtimeClasspath'.
   &gt; Could not resolve org.lwjgl:lwjgl:3.2.3.
     Required by:
         project :
      &gt; Cannot choose between the following variants of org.lwjgl:lwjgl:3.2.3:
          - natives-windows-runtime
          - natives-windows-x86-runtime</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="making_different_flavors_of_a_library_available_through_capabilities"><a class="anchor" href="#making_different_flavors_of_a_library_available_through_capabilities"></a><a class="link" href="#making_different_flavors_of_a_library_available_through_capabilities">Making different flavors of a library available through capabilities</a></h5>
<div class="paragraph">
<p>Because it is difficult to model <a href="#">optional feature variants</a> as separate jars with pom metadata, libraries sometimes compose different jars with a different feature set.
That is, instead of composing your flavor of the library from different feature variants, you select one of the pre-composed variants (offering everything in one jar).
One such library is the well-known dependency injection framework Guice, published on <a href="https://repo1.maven.org/maven2/com/google/inject/guice/4.2.2">Maven central</a>, which offers a complete flavor (the main jar) and a reduced variant without aspect-oriented programming support (<code>guice-4.2.2-no_aop.jar</code>).
That second variant with a classifier is not mentioned in the pom metadata.
With the following rule, we create compile and runtime variants based on that file and make it selectable through a capability named <code>com.google.inject:guice-no_aop</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 347. Rule to add no_aop feature variant to Guice metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GuiceRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>].each { base -&gt;
            context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">noAop</span><span class="inline"><span class="inline-delimiter">${</span>base.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, base) {
                withCapabilities {
                    addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">guice-no_aop</span><span class="delimiter">&quot;</span></span>, context.details.id.version)
                }
                withFiles {
                    removeAllFiles()
                    addFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">guice-</span><span class="inline"><span class="inline-delimiter">${</span>context.details.id.version<span class="inline-delimiter">}</span></span><span class="content">-no_aop.jar</span><span class="delimiter">&quot;</span></span>)
                }
                withDependencies {
                    removeAll { <span class="local-variable">it</span>.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">aopalliance</span><span class="delimiter">&quot;</span></span> }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GuiceRule: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        listOf(&quot;compile&quot;, &quot;runtime&quot;).forEach { base -&gt;
            context.details.addVariant(&quot;noAop${base.capitalize()}&quot;, base) {
                withCapabilities {
                    addCapability(&quot;com.google.inject&quot;, &quot;guice-no_aop&quot;, context.details.id.version)
                }
                withFiles {
                    removeAllFiles()
                    addFile(&quot;guice-${context.details.id.version}-no_aop.jar&quot;)
                }
                withDependencies {
                    removeAll { it.group == &quot;aopalliance&quot; }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The new variants also have the dependency on the standardized aop interfaces library <code>aopalliance:aopalliance</code> removed, as this is clearly not needed by these variants.
Again, this is information that cannot be expressed in pom metadata.
We can now select a <code>guice-no_aop</code> variant and will get the correct jar file <strong>and</strong> the correct dependencies.</p>
</div>
<div class="exampleblock">
<div class="title">Example 348. Applying and utilising rule for Guice metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    components {
        withModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice</span><span class="delimiter">&quot;</span></span>, GuiceRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice:4.2.2</span><span class="delimiter">&quot;</span></span>) {
        capabilities { requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.inject:guice-no_aop</span><span class="delimiter">&quot;</span></span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    components {
        withModule&lt;GuiceRule&gt;(&quot;com.google.inject:guice&quot;)
    }
    implementation(&quot;com.google.inject:guice:4.2.2&quot;) {
        capabilities { requireCapability(&quot;com.google.inject:guice-no_aop&quot;) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="adding_missing_capabilities_to_detect_conflicts"><a class="anchor" href="#adding_missing_capabilities_to_detect_conflicts"></a><a class="link" href="#adding_missing_capabilities_to_detect_conflicts">Adding missing capabilities to detect conflicts</a></h5>
<div class="paragraph">
<p>Another usage of capabilities is to express that two different modules, for example <code>log4j</code> and <code>log4j-over-slf4j</code>, provide alternative implementations of the same thing.
By declaring that both provide the same capability, Gradle only accepts one of them in a dependency graph.
This example, and how it can be tackled with a component metadata rule, is described in detail in the  <a href="#sec:declaring-capabilities-external-modules">feature modelling</a> section.</p>
</div>
</div>
<div class="sect4">
<h5 id="making_ivy_modules_variant_aware"><a class="anchor" href="#making_ivy_modules_variant_aware"></a><a class="link" href="#making_ivy_modules_variant_aware">Making Ivy modules variant-aware</a></h5>
<div class="paragraph">
<p>Modules with Ivy metadata, do not have variants by default.
However, <em>Ivy configurations</em> can be mapped to variants as the <code>addVariant(name, baseVariantOrConfiguration)</code> accepts any Ivy configuration that was published as base.
This can be used, for example, to define runtime and compile variants.
An example of a corresponding rule can be found <a href="#sub:ivy-mapping-to-variants">here</a>.
Ivy details of Ivy configurations (e.g. dependencies and files) can also be modified using the <code>withVariant(configurationName)</code> API.
However, modifying attributes or capabilities on Ivy configurations has no effect.</p>
</div>
<div class="paragraph">
<p>For very Ivy specific use cases, the component metadata rules API also offers access to other details only found in Ivy metadata.
These are available through the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ivy/IvyModuleDescriptor.html">IvyModuleDescriptor</a> interface and can be accessed using <code>getDescriptor(IvyModuleDescriptor)</code> on the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 349. Ivy component metadata rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">IvyComponentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> descriptor = context.getDescriptor(IvyModuleDescriptor)
        <span class="keyword">if</span> (descriptor != <span class="predefined-constant">null</span> &amp;&amp; descriptor.branch == <span class="string"><span class="delimiter">&quot;</span><span class="content">testing</span><span class="delimiter">&quot;</span></span>) {
            context.details.status = <span class="string"><span class="delimiter">&quot;</span><span class="content">rc</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class IvyComponentRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val descriptor = context.getDescriptor(IvyModuleDescriptor::class)
        if (descriptor != null &amp;&amp; descriptor.branch == &quot;testing&quot;) {
            context.details.status = &quot;rc&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="filter_using_maven_metadata"><a class="anchor" href="#filter_using_maven_metadata"></a><a class="link" href="#filter_using_maven_metadata">Filter using Maven metadata</a></h5>
<div class="paragraph">
<p>For Maven specific use cases, the component metadata rules API also offers access to other details only found in POM metadata.
These are available through the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/PomModuleDescriptor.html">PomModuleDescriptor</a> interface and can be accessed using <code>getDescriptor(PomModuleDescriptor)</code> on the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ComponentMetadataContext.html">ComponentMetadataContext</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 350. Access pom packaging type in component metadata rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MavenComponentRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="keyword">def</span> descriptor = context.getDescriptor(PomModuleDescriptor)
        <span class="keyword">if</span> (descriptor != <span class="predefined-constant">null</span> &amp;&amp; descriptor.packaging == <span class="string"><span class="delimiter">&quot;</span><span class="content">war</span><span class="delimiter">&quot;</span></span>) {
            <span class="comment">// ...</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class MavenComponentRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        val descriptor = context.getDescriptor(PomModuleDescriptor::class)
        if (descriptor != null &amp;&amp; descriptor.packaging == &quot;war&quot;) {
            // ...
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="modifying_metadata_on_the_component_level_for_alignment"><a class="anchor" href="#modifying_metadata_on_the_component_level_for_alignment"></a><a class="link" href="#modifying_metadata_on_the_component_level_for_alignment">Modifying metadata on the component level for alignment</a></h5>
<div class="paragraph">
<p>While all the examples above made modifications to variants of a component, there is also a limited set of modifications that can be done to the metadata of the component itself.
This information can influence the <a href="#">version selection</a> process for a module during dependency resolution, which is performed <em>before</em> one or multiple variants of a component are selected.</p>
</div>
<div class="paragraph">
<p>The first API available on the component is <code>belongsTo()</code> to create virtual platforms for aligning versions of multiple modules without Gradle Module Metadata.
It is explained in detail in the section on <a href="#sec:align-versions-unpublished">aligning versions of modules not published with Gradle</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_status_scheme"><a class="anchor" href="#sec:custom_status_scheme"></a><a class="link" href="#sec:custom_status_scheme">Modifying metadata on the component level for version selection based on status</a></h5>
<div class="paragraph">
<p>Gradle and Gradle Module Metadata also allow attributes to be set on the whole component instead of a single variant.
Each of these attributes carries special semantics as they influence version selection which is done <em>before</em> variant selection.
While variant selection can handle <a href="#sec:declaring_attributes">any custom attribute</a>, version selection only considers attributes for which specific semantics are implemented.
At the moment, the only attribute with meaning here is <code>org.gradle.status</code>.
It is therefore recommended to only modify this attribute, if any, on the component level.
A dedicated API <code>setStatus(value)</code> is available for this.
To modify another attribute for all variants of a component <code>withAllVariants { attributes {} }</code> should be utilised instead.</p>
</div>
<div class="paragraph">
<p>A module&#8217;s status is taken into consideration when a <a href="#"><em>latest</em> version selector</a> is resolved.
Specifically, <code>latest.someStatus</code> will resolve to the highest module version that has status <code>someStatus</code> or a more mature status.
For example, <code>latest.integration</code> will select the highest module version regardless of its status (because <code>integration</code> is the least mature status as explained below), whereas <code>latest.release</code> will select the highest module version with status <code>release</code>.</p>
</div>
<div class="paragraph">
<p>The interpretation of the status can be influenced by changing a module&#8217;s <em>status scheme</em> through the <code>setStatusScheme(valueList)</code> API.
This concept models the different levels of maturity that a module transitions through over time with different publications.
The default status scheme, ordered from least to most mature status, is <code>integration</code>, <code>milestone</code>, <code>release</code>.
The <code>org.gradle.status</code> attribute must be set, to one of the values in the components status scheme.
Thus each component always has a status which is determined from the metadata as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata: the value that was published for the <code>org.gradle.status</code> attribute on the component</p>
</li>
<li>
<p>Ivy metadata: <code>status</code> defined in the ivy.xml, defaults to <code>integration</code> if missing</p>
</li>
<li>
<p>Pom metadata: <code>integration</code> for modules with a SNAPSHOT version, <code>release</code> for all others</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates <code>latest</code> selectors based on a custom status scheme declared in a component metadata rule that applies to all modules:</p>
</div>
<div class="exampleblock">
<div class="title">Example 351. Custom status scheme</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">CustomStatusRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.statusScheme = [<span class="string"><span class="delimiter">&quot;</span><span class="content">nightly</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">milestone</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">rc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">release</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">if</span> (context.details.status == <span class="string"><span class="delimiter">&quot;</span><span class="content">integration</span><span class="delimiter">&quot;</span></span>) {
            context.details.status = <span class="string"><span class="delimiter">&quot;</span><span class="content">nightly</span><span class="delimiter">&quot;</span></span>
        }
    }
}

dependencies {
    components {
        all(CustomStatusRule)
    }
    implementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons:commons-lang3:latest.rc</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class CustomStatusRule : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) {
        context.details.statusScheme = listOf(&quot;nightly&quot;, &quot;milestone&quot;, &quot;rc&quot;, &quot;release&quot;)
        if (context.details.status == &quot;integration&quot;) {
            context.details.status = &quot;nightly&quot;
        }
    }
}

dependencies {
    components {
        all&lt;CustomStatusRule&gt;()
    }
    implementation(&quot;org.apache.commons:commons-lang3:latest.rc&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Compared to the default scheme, the rule inserts a new status <code>rc</code> and replaces <code>integration</code> with <code>nightly</code>.
Existing modules with the state <code>integration</code> are mapped to <code>nightly</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resolution_rules"><a class="anchor" href="#resolution_rules"></a><a class="link" href="#resolution_rules">Customizing resolution of a dependency directly</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This section covers mechanisms Gradle offers to directly influence the behavior of the dependency resolution engine.
In contrast to the other concepts covered in this chapter, like <a href="#">dependency constraints</a> or <a href="#">component metadata rules</a>, which are all <strong>inputs</strong> to resolution, the following mechanisms allow you to write rules which are directly injected into the resolution engine.
Because of this, they can be seen as <em>brute force</em> solutions, that may hide future problems (e.g. if new dependencies are added).
Therefore, the general advice is to only use the following mechanisms if other means are not sufficient.
If you are authoring a <a href="#">library</a>, you should always prefer <a href="#">dependency constraints</a> as they are published for your consumers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:dependency_resolve_rules"><a class="anchor" href="#sec:dependency_resolve_rules"></a><a class="link" href="#sec:dependency_resolve_rules">Using dependency resolve rules</a></h5>
<div class="paragraph">
<p>A dependency resolve rule is executed for each resolved dependency, and offers a powerful api for manipulating a requested dependency prior to that dependency being resolved.
The feature currently offers the ability to change the group, name and/or version of a requested dependency, allowing a dependency to be substituted with a completely different module during resolution.</p>
</div>
<div class="paragraph">
<p>Dependency resolve rules provide a very powerful way to control the dependency resolution process, and can be used to implement all sorts of advanced patterns in dependency management.
Some of these patterns are outlined below.
For more information and code samples see the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.ResolutionStrategy.html">ResolutionStrategy</a> class in the API documentation.</p>
</div>
<div class="sect5">
<h6 id="sec:custom_versioning_scheme"><a class="anchor" href="#sec:custom_versioning_scheme"></a><a class="link" href="#sec:custom_versioning_scheme">Implementing a custom versioning scheme</a></h6>
<div class="paragraph">
<p>In some corporate environments, the list of module versions that can be declared in Gradle builds is maintained and audited externally.
Dependency resolve rules provide a neat implementation of this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the build script, the developer declares dependencies with the module group and name, but uses a placeholder version, for example: <code>default</code>.</p>
</li>
<li>
<p>The <code>default</code> version is resolved to a specific version via a dependency resolve rule, which looks up the version in a corporate catalog of approved modules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This rule implementation can be neatly encapsulated in a corporate plugin, and shared across all builds within the organisation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 352. Using a custom versioning scheme</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        <span class="keyword">if</span> (details.requested.version == <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>) {
            <span class="keyword">def</span> version = findDefaultVersionInCatalog(details.requested.group, details.requested.name)
            details.useVersion version.version
            details.because version.because
        }
    }
}

<span class="keyword">def</span> <span class="function">findDefaultVersionInCatalog</span>(<span class="predefined-type">String</span> group, <span class="predefined-type">String</span> name) {
    <span class="comment">//some custom logic that resolves the default version into a specific version</span>
    [<span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>, <span class="key">because</span>: <span class="string"><span class="delimiter">'</span><span class="content">tested by QA</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.version == &quot;default&quot;) {
            val version = findDefaultVersionInCatalog(requested.group, requested.name)
            useVersion(version.version)
            because(version.because)
        }
    }
}

data class DefaultVersion(val version: String, val because: String)

fun findDefaultVersionInCatalog(group: String, name: String): DefaultVersion {
    //some custom logic that resolves the default version into a specific version
    return DefaultVersion(version = &quot;1.0&quot;, because = &quot;tested by QA&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:blacklisting_version"><a class="anchor" href="#sec:blacklisting_version"></a><a class="link" href="#sec:blacklisting_version">Blacklisting a particular version with a replacement</a></h6>
<div class="paragraph">
<p>Dependency resolve rules provide a mechanism for blacklisting a particular version of a dependency and providing a replacement version.
This can be useful if a certain dependency version is broken and should not be used, where a dependency resolve rule causes this version to be replaced with a known good version.
One example of a broken module is one that declares a dependency on a library that cannot be found in any of the public repositories, but there are many other reasons why a particular module version is unwanted and a different version is preferred.</p>
</div>
<div class="paragraph">
<p>In example below, imagine that version <code>1.2.1</code> contains important fixes and should always be used in preference to <code>1.2</code>.
The rule provided will enforce just this: any time version <code>1.2</code> is encountered it will be replaced with <code>1.2.1</code>.
Note that this is different from a forced version as described above, in that any other versions of this module would not be affected.
This means that the 'newest' conflict resolution strategy would still select version <code>1.3</code> if this version was also pulled transitively.</p>
</div>
<div class="exampleblock">
<div class="title">Example 353. Example: Blacklisting a version with a replacement</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        <span class="keyword">if</span> (details.requested.group == <span class="string"><span class="delimiter">'</span><span class="content">org.software</span><span class="delimiter">'</span></span> &amp;&amp; details.requested.name == <span class="string"><span class="delimiter">'</span><span class="content">some-library</span><span class="delimiter">'</span></span> &amp;&amp; details.requested.version == <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>) {
            details.useVersion <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span>
            details.because <span class="string"><span class="delimiter">'</span><span class="content">fixes critical bug in 1.2</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == &quot;org.software&quot; &amp;&amp; requested.name == &quot;some-library&quot; &amp;&amp; requested.version == &quot;1.2&quot;) {
            useVersion(&quot;1.2.1&quot;)
            because(&quot;fixes critical bug in 1.2&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s a difference with using the <em>reject</em> directive of <a href="#rich-version-constraints">rich version constraints</a>: rich versions will cause the build to fail if a rejected version is found in the graph, or select a non rejected version when using dynamic dependencies.
Here, we <em>manipulate the requested versions</em> in order to select a different version when we find a rejected one.
In other words, this is a <em>solution</em> to rejected versions, while rich version constraints allow declaring the <em>intent</em> (you should not use this version).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:module_replacement"><a class="anchor" href="#sec:module_replacement"></a><a class="link" href="#sec:module_replacement">Using module replacement rules</a></h5>
<div class="paragraph">
<p>It is preferable to express module conflicts in terms of <a href="#sub:capabilities">capabilities conflicts</a>.
However, if there&#8217;s no such rule declared or that you are working on versions of Gradle which do not support capabilities, Gradle provides tooling to work around those issues.</p>
</div>
<div class="paragraph">
<p>Module replacement rules allow a build to declare that a legacy library has been replaced by a new one.
A good example when a new library replaced a legacy one is the <code>google-collections</code> -&gt; <code>guava</code> migration.
The team that created google-collections decided to change the module name from <code>com.google.collections:google-collections</code> into <code>com.google.guava:guava</code>.
This is a legal scenario in the industry: teams need to be able to change the names of products they maintain, including the module coordinates. Renaming of the module coordinates has impact on conflict resolution.</p>
</div>
<div class="paragraph">
<p>To explain the impact on conflict resolution, let&#8217;s consider the <code>google-collections</code> -&gt; <code>guava</code> scenario.
It may happen that both libraries are pulled into the same dependency graph.
For example, <em>our project</em> depends on <code>guava</code> but some of <em>our dependencies</em> pull in a legacy version of <code>google-collections</code>.
This can cause runtime errors, for example during test or application execution.
Gradle does not automatically resolve the <code>google-collections</code> -&gt; <code>guava</code> conflict because it is not considered as a <em>version conflict</em>.
It&#8217;s because the module coordinates for both libraries are completely different and conflict resolution is activated when <code>group</code> and <code>module</code> coordinates are the same but there are different versions available in the dependency graph (for more info, refer to the section on conflict resolution).
Traditional remedies to this problem are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declare exclusion rule to avoid pulling in <code>google-collections</code> to graph. It is probably the most popular approach.</p>
</li>
<li>
<p>Avoid dependencies that pull in legacy libraries.</p>
</li>
<li>
<p>Upgrade the dependency version if the new version no longer pulls in a legacy library.</p>
</li>
<li>
<p>Downgrade to <code>google-collections</code>. It&#8217;s not recommended, just mentioned for completeness.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Traditional approaches work but they are not general enough.
For example, an organisation wants to resolve the <code>google-collections</code> -&gt; <code>guava</code> conflict resolution problem in all projects.
It is possible to declare that certain module was replaced by other.
This enables organisations to include the information about module replacement in the corporate plugin suite and resolve the problem holistically for all Gradle-powered projects in the enterprise.</p>
</div>
<div class="exampleblock">
<div class="title">Example 354. Declaring a module replacement</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    modules {
        module(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.collections:google-collections</span><span class="delimiter">&quot;</span></span>) {
            replacedBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava:guava</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">google-collections is now part of Guava</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    modules {
        module(&quot;com.google.collections:google-collections&quot;) {
            replacedBy(&quot;com.google.guava:guava&quot;, &quot;google-collections is now part of Guava&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more examples and detailed API, refer to the DSL reference for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/dsl/ComponentMetadataHandler.html">ComponentMetadataHandler</a>.</p>
</div>
<div class="paragraph">
<p>What happens when we declare that <code>google-collections</code> is replaced by <code>guava</code>?
Gradle can use this information for conflict resolution. Gradle will consider every version of <code>guava</code> newer/better than any version of <code>google-collections</code>.
Also, Gradle will ensure that only guava jar is present in the classpath / resolved file list.
Note that if only <code>google-collections</code> appears in the dependency graph (e.g. no <code>guava</code>) Gradle will not eagerly replace it with <code>guava</code>.
Module replacement is an information that Gradle uses for resolving conflicts.
If there is no conflict (e.g. only <code>google-collections</code> or only <code>guava</code> in the graph) the replacement information is not used.</p>
</div>
<div class="paragraph">
<p>Currently it is not possible to declare that a given module is replaced by a set of modules.
However, it is possible to declare that multiple modules are replaced by a single module.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:dependency_substitution_rules"><a class="anchor" href="#sec:dependency_substitution_rules"></a><a class="link" href="#sec:dependency_substitution_rules">Using dependency substitution rules</a></h5>
<div class="paragraph">
<p>Dependency substitution rules work similarly to dependency resolve rules.
In fact, many capabilities of dependency resolve rules can be implemented with dependency substitution rules.
 They allow project and module dependencies to be transparently substituted with specified replacements.
 Unlike dependency resolve rules, dependency substitution rules allow project and module dependencies to be substituted interchangeably.</p>
</div>
<div class="paragraph">
<p><em>Adding a dependency substitution rule to a configuration changes the timing of when that configuration is resolved.</em>
Instead of being resolved on first use, the configuration is instead resolved when the task graph is being constructed.
This can have unexpected consequences if the configuration is being further modified during task execution, or if the configuration relies on modules that are published during execution of another task.</p>
</div>
<div class="paragraph">
<p>To explain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Configuration</code> can be declared as an input to any Task, and that configuration can include project dependencies when it is resolved.</p>
</li>
<li>
<p>If a project dependency is an input to a Task (via a configuration), then tasks to build the project artifacts must be added to the task dependencies.</p>
</li>
<li>
<p>In order to determine the project dependencies that are inputs to a task, Gradle needs to resolve the <code>Configuration</code> inputs.</p>
</li>
<li>
<p>Because the Gradle task graph is fixed once task execution has commenced, Gradle needs to perform this resolution prior to executing any tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the absence of dependency substitution rules, Gradle knows that an external module dependency will never transitively reference a project dependency.
This makes it easy to determine the full set of project dependencies for a configuration through simple graph traversal.
With this functionality, Gradle can no longer make this assumption, and must perform a full resolve in order to determine the project dependencies.</p>
</div>
<div class="sect5">
<h6 id="sub:module_to_project_substitution"><a class="anchor" href="#sub:module_to_project_substitution"></a><a class="link" href="#sub:module_to_project_substitution">Substituting an external module dependency with a project dependency</a></h6>
<div class="paragraph">
<p>One use case for dependency substitution is to use a locally developed version of a module in place of one that is downloaded from an external repository.
This could be useful for testing a local, patched version of a dependency.</p>
</div>
<div class="paragraph">
<p>The module to be replaced can be declared with or without a version specified.</p>
</div>
<div class="exampleblock">
<div class="title">Example 355. Substituting a module with a project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:api</span><span class="delimiter">&quot;</span></span>) because <span class="string"><span class="delimiter">&quot;</span><span class="content">we work with the unreleased development version</span><span class="delimiter">&quot;</span></span> with project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:api</span><span class="delimiter">&quot;</span></span>)
        substitute module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:util:2.5</span><span class="delimiter">&quot;</span></span>) with project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:util</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(module(&quot;org.utils:api&quot;)).apply {
            with(project(&quot;:api&quot;))
            because(&quot;we work with the unreleased development version&quot;)
        }
        substitute(module(&quot;org.utils:util:2.5&quot;)).with(project(&quot;:util&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a project that is substituted must be included in the multi-project build (via <code>settings.gradle</code>).
Dependency substitution rules take care of replacing the module dependency with the project dependency and wiring up any task dependencies, but do not implicitly include the project in the build.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:project_to_module_substitution"><a class="anchor" href="#sub:project_to_module_substitution"></a><a class="link" href="#sub:project_to_module_substitution">Substituting a project dependency with a module replacement</a></h6>
<div class="paragraph">
<p>Another way to use substitution rules is to replace a project dependency with a module in a multi-project build.
This can be useful to speed up development with a large multi-project build, by allowing a subset of the project dependencies to be downloaded from a repository rather than being built.</p>
</div>
<div class="paragraph">
<p>The module to be used as a replacement must be declared with a version specified.</p>
</div>
<div class="exampleblock">
<div class="title">Example 356. Substituting a project with a module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:api</span><span class="delimiter">&quot;</span></span>) because <span class="string"><span class="delimiter">&quot;</span><span class="content">we use a stable version of org.utils:api</span><span class="delimiter">&quot;</span></span> with module(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.utils:api:1.3</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(project(&quot;:api&quot;)).apply {
            with(module(&quot;org.utils:api:1.3&quot;))
            because(&quot;we use a stable version of org.utils:api&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a project dependency has been replaced with a module dependency, that project is still included in the overall multi-project build.
However, tasks to build the replaced dependency will not be executed in order to resolve the depending <code>Configuration</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:conditional_dependency_substitution"><a class="anchor" href="#sub:conditional_dependency_substitution"></a><a class="link" href="#sub:conditional_dependency_substitution">Conditionally substituting a dependency</a></h6>
<div class="paragraph">
<p>A common use case for dependency substitution is to allow more flexible assembly of sub-projects within a multi-project build.
This can be useful for developing a local, patched version of an external dependency or for building a subset of the modules within a large multi-project build.</p>
</div>
<div class="paragraph">
<p>The following example uses a dependency substitution rule to replace any module dependency with the group <code>org.example</code>, but only if a local project matching the dependency name can be located.</p>
</div>
<div class="exampleblock">
<div class="title">Example 357. Conditionally substituting a dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    configurations.all {
        resolutionStrategy.dependencySubstitution.all { DependencySubstitution dependency -&gt;
            <span class="keyword">if</span> (dependency.requested <span class="keyword">instanceof</span> ModuleComponentSelector &amp;&amp; dependency.requested.group == <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>) {
                <span class="keyword">def</span> targetProject = findProject(<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="inline"><span class="inline-delimiter">${</span>dependency.requested.module<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                <span class="keyword">if</span> (targetProject != <span class="predefined-constant">null</span>) {
                    dependency.useTarget targetProject
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    configurations.all {
        resolutionStrategy.dependencySubstitution.all {
            requested.let {
                if (it is ModuleComponentSelector &amp;&amp; it.group == &quot;org.example&quot;) {
                    val targetProject = findProject(&quot;:${it.module}&quot;)
                    if (targetProject != null) {
                        useTarget(targetProject)
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that a project that is substituted must be included in the multi-project build (via <code>settings.gradle</code>).
Dependency substitution rules take care of replacing the module dependency with the project dependency, but do not implicitly include the project in the build.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:disabling_resolution_transitive_dependencies"><a class="anchor" href="#sec:disabling_resolution_transitive_dependencies"></a><a class="link" href="#sec:disabling_resolution_transitive_dependencies">Disabling transitive resolution</a></h5>
<div class="paragraph">
<p>By default Gradle resolves all transitive dependencies specified by the dependency metadata.
Sometimes this behavior may not be desirable e.g. if the metadata is incorrect or defines a large graph of transitive dependencies.
You can tell Gradle to disable transitive dependency management for a dependency by setting <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ModuleDependency.html#setTransitive-boolean-">ModuleDependency.setTransitive(boolean)</a> to <code>false</code>.
As a result only the main artifact will be resolved for the declared dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 358. Disabling transitive dependency resolution for a declared dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>) {
        transitive = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;com.google.guava:guava:23.0&quot;) {
        isTransitive = false
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling transitive dependency resolution will likely require you to declare the necessary runtime dependencies in your build script which otherwise would have been resolved automatically. Not doing so might lead to runtime classpath issues.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A project can decide to disable transitive dependency resolution completely.
You either don&#8217;t want to rely on the metadata published to the consumed repositories or you want to gain full control over the dependencies in your graph.
For more information, see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/Configuration.html#setTransitive-boolean-">Configuration.setTransitive(boolean)</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 359. Disabling transitive dependency resolution on the configuration-level</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    transitive = <span class="predefined-constant">false</span>
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations.all {
    isTransitive = false
}

dependencies {
    implementation(&quot;com.google.guava:guava:23.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="changing_configuration_dependencies_prior_to_resolution"><a class="anchor" href="#changing_configuration_dependencies_prior_to_resolution"></a><a class="link" href="#changing_configuration_dependencies_prior_to_resolution">Changing configuration dependencies prior to resolution</a></h5>
<div class="paragraph">
<p>At times, a plugin may want to modify the dependencies of a configuration before it is resolved.
The <code>withDependencies</code> method permits dependencies to be added, removed or modified programmatically.</p>
</div>
<div class="exampleblock">
<div class="title">Example 360. Modifying dependencies on a configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    implementation {
        withDependencies { DependencySet dependencies -&gt;
            ExternalModuleDependency dep = dependencies.find { <span class="local-variable">it</span>.name == <span class="string"><span class="delimiter">'</span><span class="content">to-modify</span><span class="delimiter">'</span></span> } <span class="keyword">as</span> ExternalModuleDependency
            dep.version {
                strictly <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;implementation&quot;) {
        withDependencies {
            val dep = this.find { it.name == &quot;to-modify&quot; } as ExternalModuleDependency
            dep.version {
                strictly(&quot;1.2&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuration_defaults"><a class="anchor" href="#sec:configuration_defaults"></a><a class="link" href="#sec:configuration_defaults">Setting default configuration dependencies</a></h5>
<div class="paragraph">
<p>A configuration can be configured with default dependencies to be used if no dependencies are explicitly set for the configuration.
A primary use case of this functionality is for developing plugins that make use of versioned tools that the user might override.
By specifying default dependencies, the plugin can use a default version of the tool only if the user has not specified a particular version to use.</p>
</div>
<div class="exampleblock">
<div class="title">Example 361. Specifying default dependencies on a configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    pluginTool {
        defaultDependencies { dependencies -&gt;
            dependencies.add(project.dependencies.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle:my-util:1.0</span><span class="delimiter">&quot;</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;pluginTool&quot;) {
        defaultDependencies {
            add(project.dependencies.create(&quot;org.gradle:my-util:1.0&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="excluding_a_dependency_from_a_configuration_completely"><a class="anchor" href="#excluding_a_dependency_from_a_configuration_completely"></a><a class="link" href="#excluding_a_dependency_from_a_configuration_completely">Excluding a dependency from a configuration completely</a></h5>
<div class="paragraph">
<p>Similar to <a href="#sec:excluding-transitive-deps">excluding a dependency in a dependency declaration</a>, you can exclude a transitive dependency for a particular configuration completely by using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.Configuration.html#org.gradle.api.artifacts.Configuration:exclude(java.util.Map)">Configuration.exclude(java.util.Map)</a>.
This will automatically exclude the transitive dependency for all dependencies declared on the configuration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 362. Excluding transitive dependency for a particular configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    implementation {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">commons-collections</span><span class="delimiter">'</span></span>
    }
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-beanutils:commons-beanutils:1.9.4</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.opencsv:opencsv:4.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;implementation&quot; {
        exclude(group = &quot;commons-collections&quot;, module = &quot;commons-collections&quot;)
    }
}

dependencies {
    implementation(&quot;commons-beanutils:commons-beanutils:1.9.4&quot;)
    implementation(&quot;com.opencsv:opencsv:4.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="matching_dependencies_to_repositories"><a class="anchor" href="#matching_dependencies_to_repositories"></a><a class="link" href="#matching_dependencies_to_repositories">Matching dependencies to repositories</a></h5>
<div class="paragraph">
<p>Gradle exposes an API to declare what a repository may or may not contain.
This feature offers a fine grained control on which repository serve which artifacts, which can be one way of controlling the source of dependencies.</p>
</div>
<div class="paragraph">
<p>Head over to <a href="#sec:repository-content-filtering">the section on repository content filtering</a> to know more about this feature.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:ivy_dynamic_resolve_mode"><a class="anchor" href="#sec:ivy_dynamic_resolve_mode"></a><a class="link" href="#sec:ivy_dynamic_resolve_mode">Enabling Ivy dynamic resolve mode</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s Ivy repository implementations support the equivalent to Ivy&#8217;s dynamic resolve mode.
Normally, Gradle will use the <code>rev</code> attribute for each dependency definition included in an <code>ivy.xml</code> file.
In dynamic resolve mode, Gradle will instead prefer the <code>revConstraint</code> attribute over the <code>rev</code> attribute for a given dependency definition.
If the <code>revConstraint</code> attribute is not present, the <code>rev</code> attribute is used instead.</p>
</div>
<div class="paragraph">
<p>To enable dynamic resolve mode, you need to set the appropriate option on the repository definition.
A couple of examples are shown below.
Note that dynamic resolve mode is only available for Gradle&#8217;s Ivy repositories.
It is not available for Maven repositories, or custom Ivy <code>DependencyResolver</code> implementations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 363. Enabling dynamic resolve mode</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Can enable dynamic resolve mode when you define the repository</span>
repositories {
    ivy {
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
        resolve.dynamicMode = <span class="predefined-constant">true</span>
    }
}

<span class="comment">// Can use a rule instead to enable (or disable) dynamic resolve mode for all repositories</span>
repositories.withType(IvyArtifactRepository) {
    resolve.dynamicMode = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// Can enable dynamic resolve mode when you define the repository
repositories {
    ivy {
        url = uri(&quot;http://repo.mycompany.com/repo&quot;)
        resolve.isDynamicMode = true
    }
}

// Can use a rule instead to enable (or disable) dynamic resolve mode for all repositories
repositories.withType&lt;IvyArtifactRepository&gt; {
    resolve.isDynamicMode = true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="producing_and_consuming_variants_of_libraries"><a class="anchor" href="#producing_and_consuming_variants_of_libraries"></a><a class="link" href="#producing_and_consuming_variants_of_libraries">Producing and Consuming Variants of Libraries</a></h3>
<div class="sect3">
<h4 id="declaring-component-capabilities"><a class="anchor" href="#declaring-component-capabilities"></a><a class="link" href="#declaring-component-capabilities">Declaring Capabilities of a Library</a></h4>
<div class="sect4">
<h5 id="capabilities_as_first_level_concept"><a class="anchor" href="#capabilities_as_first_level_concept"></a><a class="link" href="#capabilities_as_first_level_concept">Capabilities as first-level concept</a></h5>
<div class="paragraph">
<p>Components provide a number of features which are often orthogonal to the software architecture used to provide those features.
For example, a library may include several features in a single artifact.
However, such a library would be published at single GAV (group, artifact and version) coordinates.
This means that, at single coordinates, potentially co-exist different "features" of a component.</p>
</div>
<div class="paragraph">
<p>With Gradle it becomes interesting to explicitly declare what features a component provides.
For this, Gradle provides the concept of <a href="#sec:adding-constraints-transitive-deps">capability</a>.</p>
</div>
<div class="paragraph">
<p>A feature is often built by combining different <em>capabilities</em>.</p>
</div>
<div class="paragraph">
<p>In an ideal world, components shouldn&#8217;t declare dependencies on explicit GAVs, but rather express their requirements in terms of capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"give me a component which provides logging"</p>
</li>
<li>
<p>"give me a scripting engine"</p>
</li>
<li>
<p>"give me a scripting engine that supports Groovy"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By modeling <em>capabilities</em>, the dependency management engine can be smarter and tell you whenever you have <em>incompatible capabilities</em> in a dependency graph, or ask you to choose whenever different modules in a graph provide the same <em>capability</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring-capabilities-external-modules"><a class="anchor" href="#sec:declaring-capabilities-external-modules"></a><a class="link" href="#sec:declaring-capabilities-external-modules">Declaring capabilities for external modules</a></h5>
<div class="paragraph">
<p>It&#8217;s worth noting that Gradle supports declaring capabilities for components you build, but also for external components in case they didn&#8217;t.</p>
</div>
<div class="paragraph">
<p>For example, if your build file contains the following dependencies:</p>
</div>
<div class="exampleblock">
<div class="title">Example 364. A build file with an implicit conflict of logging frameworks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This dependency will bring log4:log4j transitively</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.zookeeper:zookeeper:3.4.9</span><span class="delimiter">'</span></span>

    <span class="comment">// We use log4j over slf4j</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:log4j-over-slf4j:1.7.10</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This dependency will bring log4:log4j transitively
    implementation(&quot;org.apache.zookeeper:zookeeper:3.4.9&quot;)

    // We use log4j over slf4j
    implementation(&quot;org.slf4j:log4j-over-slf4j:1.7.10&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As is, it&#8217;s pretty hard to figure out that you will end up with two logging frameworks on the classpath.
In fact, <code>zookeeper</code> will bring in <code>log4j</code>, where what we want to use is <code>log4j-over-slf4j</code>.
We can preemptively detect the conflict by adding a rule which will declare that both logging frameworks provide the same capability:</p>
</div>
<div class="exampleblock">
<div class="title">Example 365. A build file with an implicit conflict of logging frameworks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Activate the &quot;LoggingCapability&quot; rule</span>
    components.all(LoggingCapability)
}

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">LoggingCapability</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; LOGGING_MODULES = [<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j-over-slf4j</span><span class="delimiter">&quot;</span></span>] <span class="keyword">as</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        context.details.with {
            <span class="keyword">if</span> (LOGGING_MODULES.contains(id.name)) {
                allVariants {
                    <span class="local-variable">it</span>.withCapabilities {
                        <span class="comment">// Declare that both log4j and log4j-over-slf4j provide the same capability</span>
                        <span class="local-variable">it</span>.addCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span>, id.version)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Activate the &quot;LoggingCapability&quot; rule
    components.all(LoggingCapability::class.java)
}

class LoggingCapability : ComponentMetadataRule {
    val loggingModules = setOf(&quot;log4j&quot;, &quot;log4j-over-slf4j&quot;)

    override
    fun execute(context: ComponentMetadataContext) = context.details.run {
        if (loggingModules.contains(id.name)) {
            allVariants {
                withCapabilities {
                    // Declare that both log4j and log4j-over-slf4j provide the same capability
                    addCapability(&quot;log4j&quot;, &quot;log4j&quot;, id.version)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By adding this rule, we will make sure that Gradle <em>will</em> detect conflicts and properly fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':compileClasspath'.
   &gt; Could not resolve org.slf4j:log4j-over-slf4j:1.7.10.
     Required by:
         project :
      &gt; Module 'org.slf4j:log4j-over-slf4j' has been rejected:
           Cannot select module with conflict on capability 'log4j:log4j:1.7.10' also provided by [log4j:log4j:1.2.16(compile)]
   &gt; Could not resolve log4j:log4j:1.2.16.
     Required by:
         project : &gt; org.apache.zookeeper:zookeeper:3.4.9
      &gt; Module 'log4j:log4j' has been rejected:
           Cannot select module with conflict on capability 'log4j:log4j:1.2.16' also provided by [org.slf4j:log4j-over-slf4j:1.7.10(compile)]</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#sub:selecting-between-candidates">capabilities section of the documentation</a> to figure out how to fix capability conflicts.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_additional_capabilities_for_a_local_component"><a class="anchor" href="#declaring_additional_capabilities_for_a_local_component"></a><a class="link" href="#declaring_additional_capabilities_for_a_local_component">Declaring additional capabilities for a local component</a></h5>
<div class="paragraph">
<p>All components have an <em>implicit capability</em> corresponding to the same GAV coordinates as the component.
This is convenient whenever a library published at different GAV coordinates is an <em>alternate implementation</em> of the same API.
However, it is also possible to declare additional <em>explicit capabilities</em> for a component:</p>
</div>
<div class="exampleblock">
<div class="title">Example 366. Declaring capabilities of a component</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    apiElements {
        outgoing {
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme:my-library:1.0</span><span class="delimiter">&quot;</span></span>)
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.other:module:1.1</span><span class="delimiter">&quot;</span></span>)
        }
    }
    runtimeElements {
        outgoing {
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme:my-library:1.0</span><span class="delimiter">&quot;</span></span>)
            capability(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.other:module:1.1</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    apiElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
    runtimeElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Capabilities must be attached to <em>outgoing configurations</em>, which are <a href="#sec:resolvable-consumable-configs">consumable configurations</a> of a component.</p>
</div>
<div class="paragraph">
<p>This example shows that we declare two capabilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>com.acme:my-library:1.0</code>, which corresponds to the <em>implicit capability</em> of the library</p>
</li>
<li>
<p><code>com.other:module:1.1</code>, which corresponds to another capability of this library</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting we need to do 1. because as soon as you start declaring <em>explicit</em> capabilities, then <em>all</em> capabilities need to be declared, including the <em>implicit</em> one.</p>
</div>
<div class="paragraph">
<p>The second capability can be specific to this library, or it can correspond to a capability provided by an external component.
In that case, if <code>com.other:module</code> appears in the same dependency graph, the build will fail and consumers <a href="#sub:selecting-between-candidates">will have to choose what module to use</a>.</p>
</div>
<div class="paragraph">
<p>Capabilities are published to Gradle Module Metadata.
However, they have <em>no equivalent</em> in POM or Ivy metadata files.
As a consequence, when publishing such a component, Gradle will warn you that this feature is only for Gradle consumers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Maven publication 'maven' contains dependencies that cannot be represented in a published pom file.
  - Declares capability com.acme:my-library:1.0
  - Declares capability com.other:module:1.1</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="feature_variants"><a class="anchor" href="#feature_variants"></a><a class="link" href="#feature_variants">Modeling feature variants and optional dependencies</a></h4>
<div class="paragraph">
<p>Gradle supports the concept of <em>feature variants</em>: when building a library, it&#8217;s often the case that some features should only be available when some dependencies are present, or when special artifacts are used.</p>
</div>
<div class="paragraph">
<p>Feature variants let consumers choose what <em>features</em> of a library they need: the dependency management engine will select the right artifacts and dependencies.</p>
</div>
<div class="paragraph">
<p>This allows for a number of different scenarios (list is non-exhaustive):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a (better) substitute for <a href="https://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html">Maven optional dependencies</a></p>
</li>
<li>
<p>a <em>main</em> library is built with support for different mutually-exclusive implementations of runtime features; the <a href="#sec::incompatible_variants">user must choose one, and only one, implementation of each such feature</a></p>
</li>
<li>
<p>a <em>main</em> library is built with support for optional runtime features, each of which requires a different set of dependencies</p>
</li>
<li>
<p>a <em>main</em> library comes with secondary variants like <em>test fixtures</em></p>
</li>
<li>
<p>a <em>main</em> library comes with a main artifact, and enabling an additional feature requires additional artifacts</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec::feature_variant_selection"><a class="anchor" href="#sec::feature_variant_selection"></a><a class="link" href="#sec::feature_variant_selection">Selection of feature variants and capabilities</a></h5>
<div class="paragraph">
<p>Declaring a dependency on a component is usually done by providing a set of coordinates (group, artifact, version also known as GAV coordinates).
This allows the engine to determine the <em>component</em> we&#8217;re looking for, but such a component may provide different <em>variants</em>.
A <em>variant</em> is typically chosen based on the usage. For example, we might choose a different variant for compiling against a component (in which case we need the API of the component) or when executing code (in which case we need the runtime of the component).
All variants of a component provide a number of <a href="#sub:capabilities">capabilities</a>, which are denoted similarly using GAV coordinates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A capability is denoted by GAV coordinates, but you must think of it as feature description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"I provide an SLF4J binding"</p>
</li>
<li>
<p>"I provide runtime support for MySQL"</p>
</li>
<li>
<p>"I provide a Groovy runtime"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And in general, having two components that provide the <em>same thing</em> in the graph is a problem (they conflict).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is an important concept because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by default a variant provides a capability corresponding to the GAV coordinates of its component</p>
</li>
<li>
<p>it is not allowed to have different components or different variants of a component in a dependency graph if they provide the same capability</p>
</li>
<li>
<p>it is allowed to select two variants of the same component, as long as they provide <em>different capabilities</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A typical component will <strong>only</strong> provide variants with the default capability.
A Java library, for example, exposes two variants (API and runtime) which provide the <em>same capability</em>.
As a consequence, it is an error to have both the <em>API</em> and <em>runtime</em> of a single component in a dependency graph.</p>
</div>
<div class="paragraph">
<p>However, imagine that you need the <em>runtime</em> and the <em>test fixtures</em> of a component.
Then it is allowed as long as the <em>runtime</em> and <em>test fixtures</em> variant of the library declare different capabilities.</p>
</div>
<div class="paragraph">
<p>If we do so, a consumer would then have to declare two dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one on the "main" variant, the library</p>
</li>
<li>
<p>one on the "test fixtures" variant, by <em>requiring its capability</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>While the engine supports feature variants independently of the ecosystem, this feature is currently only available using the Java plugins and is incubating.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec::declare_feature_variants"><a class="anchor" href="#sec::declare_feature_variants"></a><a class="link" href="#sec::declare_feature_variants">Declaring feature variants</a></h5>
<div class="paragraph">
<p>Feature variants can be declared by applying the <code>java</code> or <code>java-library</code> plugins.
The following code illustrates how to declare a feature named <code>mongodbSupport</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 367. Declaring a feature variant</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongodbSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.main)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">group = &quot;org.gradle.demo&quot;
version = &quot;1.0&quot;

java {
    registerFeature(&quot;mongodbSupport&quot;) {
        usingSourceSet(sourceSets[&quot;main&quot;])
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle will automatically setup a number of things for you, in a very similar way to how the <a href="#java_library_plugin">Java Library Plugin</a> sets up configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the configuration <code>mongodbSupportApi</code>, used to <em>declare API dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportImplementation</code>, used to <em>declare implementation dependencies</em> for this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportApiElements</code>, used by consumers to fetch the artifacts and API dependencies of this feature</p>
</li>
<li>
<p>the configuration <code>mongodbSupportRuntimeElements</code>, used by consumers to fetch the artifacts and runtime dependencies of this feature</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most users will only need to care about the first two configurations, to declare the specific dependencies of this feature:</p>
</div>
<div class="exampleblock">
<div class="title">Example 368. Declaring dependencies of a feature</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    mongodbSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.mongodb:mongodb-driver-sync:3.9.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    &quot;mongodbSupportImplementation&quot;(&quot;org.mongodb:mongodb-driver-sync:3.9.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By convention, Gradle maps the feature name to a capability whose group and version are the same as the group and version of the main component, respectively, but whose name is the main component name followed by a <code>-</code> followed by the kebab-cased feature name.</p>
</div>
<div class="paragraph">
<p>For example, if the group is <code>org.gradle.demo</code>, the name of the component is <code>provider</code>, its version is <code>1.0</code> and the feature is named <code>mongodbSupport</code>, the feature variant will be <code>org.gradle.demo:provider-mongodb-support:1.0</code>.</p>
</div>
<div class="paragraph">
<p>If you choose the capability name yourself or add more capabilities to a variant, it is recommended to follow the same convention.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="sec:feature_variant_source_set"><a class="anchor" href="#sec:feature_variant_source_set"></a><a class="link" href="#sec:feature_variant_source_set">Feature variant source set</a></h6>
<div class="paragraph">
<p>In the previous example, we&#8217;re declaring a feature variant which uses the <em>main source set</em>.
This is a typical use case in the Java ecosystem, where it&#8217;s, for whatever reason, not possible to split the sources of a project into different subprojects or different source sets.
Gradle will therefore declare the configurations as described, but will also setup the compile classpath and runtime classpath of the <em>main source set</em> so that it extends from the feature configuration.
Said differently, this allows you to declare the dependencies specific to a feature in their own "bucket", but everything is still compiled as a single source set.
There will also be a single artifact (the component Jar) including support for all features.</p>
</div>
<div class="paragraph">
<p>However, it is often preferred to have a <em>separate source set</em> for a feature. Gradle will then perform a similar mapping, but will <em>not</em> make the compile and runtime classpath of the main component extend from the dependencies of the registered features.
It will also, by convention, create a <code>Jar</code> task to bundle the classes built from this feature source set, using a classifier corresponding to the kebab-case name of the feature:</p>
</div>
<div class="exampleblock">
<div class="title">Example 369. Declaring a feature variant using a separate source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    mongodbSupport {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/mongodb/java</span><span class="delimiter">'</span></span>
        }
    }
}

java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongodbSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mongodbSupport)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    create(&quot;mongodbSupport&quot;) {
        java {
            srcDir(&quot;src/mongodb/java&quot;)
        }
    }
}

java {
    registerFeature(&quot;mongodbSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mongodbSupport&quot;])
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec::publishing_feature_variants"><a class="anchor" href="#sec::publishing_feature_variants"></a><a class="link" href="#sec::publishing_feature_variants">Publishing feature variants</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Depending on the metadata file format, publishing feature variants may be lossy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a>, everything is published and consumers will get the full benefit of feature variants</p>
</li>
<li>
<p>using POM metadata (Maven), feature variants are published as <strong>optional dependencies</strong> and artifacts of feature variants are published with different <em>classifiers</em></p>
</li>
<li>
<p>using Ivy metadata, feature variants are published as extra configurations, which are <em>not</em> extended by the <code>default</code> configuration</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Publishing feature variants is supported using the <code>maven-publish</code> and <code>ivy-publish</code> plugins only.
The Java Plugin (or Java Library Plugin) will take care of registering the additional variants for you, so there&#8217;s no additional configuration required, only the regular publications:</p>
</div>
<div class="exampleblock">
<div class="title">Example 370. Publishing a component with feature variants</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}
<span class="comment">// ...</span>
publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
}
// ...
publishing {
    publications {
        create(&quot;myLibrary&quot;, MavenPublication::class.java) {
            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:javadoc_sources_features_variants"><a class="anchor" href="#sub:javadoc_sources_features_variants"></a><a class="link" href="#sub:javadoc_sources_features_variants">Adding javadoc and sources JARs</a></h6>
<div class="paragraph">
<p>Similar to the <a href="#sec:java_packaging">main Javadoc and sources JARs</a>, you can configure the added feature variant so that it produces JARs for the Javadoc and sources.
This however only makes sense when using a source set other than the main one.</p>
</div>
<div class="exampleblock">
<div class="title">Example 371. Producing javadoc and sources JARs for feature variants</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongodbSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.mongodbSupport)
        withJavadocJar()
        withSourcesJar()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    registerFeature(&quot;mongodbSupport&quot;) {
        usingSourceSet(sourceSets[&quot;mongodbSupport&quot;])
        withJavadocJar()
        withSourcesJar()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec::consuming_feature_variants"><a class="anchor" href="#sec::consuming_feature_variants"></a><a class="link" href="#sec::consuming_feature_variants">Dependencies on feature variants</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>As mentioned earlier, feature variants can be lossy when published.
As a consequence, a consumer can depend on a feature variant only in these cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>with a project dependency (in a multi-project build)</p>
</li>
<li>
<p>with Gradle Module Metadata available, that is the publisher MUST have published it</p>
</li>
<li>
<p>within the Ivy world, by declaring a dependency on the configuration matching the feature</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A consumer can specify that it needs a specific feature of a producer by declaring required capabilities.
For example, if a producer declares a "MySQL support" feature like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 372. A library declaring a feature to support MySQL</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mysqlSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.main)
    }
}

dependencies {
    mysqlSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:8.0.14</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    registerFeature(&quot;mysqlSupport&quot;) {
        usingSourceSet(sourceSets[&quot;main&quot;])
    }
}

dependencies {
    &quot;mysqlSupportImplementation&quot;(&quot;mysql:mysql-connector-java:8.0.14&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then the consumer can declare a dependency on the MySQL support feature by doing this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 373. Consuming specific features in a multi-project build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This project requires the main producer component</span>
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>))

    <span class="comment">// But we also want to use its MySQL support</span>
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mysql-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(project(&quot;:producer&quot;))

    // But we also want to use its MySQL support
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mysql-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will automatically bring the <code>mysql-connector-java</code> dependency on the runtime classpath.
If there were more than one dependency, all of them would be brought, meaning that a feature can be used to group dependencies which contribute to a feature together.</p>
</div>
<div class="paragraph">
<p>Similarly, if an external library with feature variants was published with <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a>, it is possible to depend on a feature provided by that library:</p>
</div>
<div class="exampleblock">
<div class="title">Example 374. Consuming specific features from an external repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// This project requires the main producer component</span>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo:producer:1.0</span><span class="delimiter">'</span></span>)

    <span class="comment">// But we also want to use its MongoDB support</span>
    runtimeOnly(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo:producer:1.0</span><span class="delimiter">'</span></span>) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mongodb-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(&quot;org.gradle.demo:producer:1.0&quot;)

    // But we also want to use its MongoDB support
    runtimeOnly(&quot;org.gradle.demo:producer:1.0&quot;) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mongodb-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec::incompatible_variants"><a class="anchor" href="#sec::incompatible_variants"></a><a class="link" href="#sec::incompatible_variants">Handling mutually exclusive variants</a></h5>
<div class="paragraph">
<p>The main advantage of using <em>capabilities</em> as a way to handle features is that you can precisely handle compatibility of variants.
The rule is simple:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It&#8217;s not allowed to have two variants of components that provide the same capability in a single dependency graph.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We can leverage that to ask Gradle to fail whenever the user mis-configures dependencies.
Imagine, for example, that your library supports MySQL, Postgres and MongoDB, but that it&#8217;s only allowed to choose <em>one</em> of those at the same time.
Not allowed should directly translate to "provide the same capability", so there must be a capability provided by all three features:</p>
</div>
<div class="exampleblock">
<div class="title">Example 375. A producer of multiple features that are mutually exclusive</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mysqlSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.main)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-mysql-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">postgresSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.main)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-postgres-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
    registerFeature(<span class="string"><span class="delimiter">'</span><span class="content">mongoSupport</span><span class="delimiter">'</span></span>) {
        usingSourceSet(sourceSets.main)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-db-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
        capability(<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.demo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">producer-mongo-support</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)
    }
}

dependencies {
    mysqlSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:8.0.14</span><span class="delimiter">'</span></span>
    postgresSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.postgresql:postgresql:42.2.5</span><span class="delimiter">'</span></span>
    mongoSupportImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.mongodb:mongodb-driver-sync:3.9.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    registerFeature(&quot;mysqlSupport&quot;) {
        usingSourceSet(sourceSets[&quot;main&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-mysql-support&quot;, &quot;1.0&quot;)
    }
    registerFeature(&quot;postgresSupport&quot;) {
        usingSourceSet(sourceSets[&quot;main&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-postgres-support&quot;, &quot;1.0&quot;)
    }
    registerFeature(&quot;mongoSupport&quot;) {
        usingSourceSet(sourceSets[&quot;main&quot;])
        capability(&quot;org.gradle.demo&quot;, &quot;producer-db-support&quot;, &quot;1.0&quot;)
        capability(&quot;org.gradle.demo&quot;, &quot;producer-mongo-support&quot;, &quot;1.0&quot;)
    }
}

dependencies {
    &quot;mysqlSupportImplementation&quot;(&quot;mysql:mysql-connector-java:8.0.14&quot;)
    &quot;postgresSupportImplementation&quot;(&quot;org.postgresql:postgresql:42.2.5&quot;)
    &quot;mongoSupportImplementation&quot;(&quot;org.mongodb:mongodb-driver-sync:3.9.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the producer declares 3 variants, one for each database runtime support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mysql-support</code> provides both the <code>db-support</code> and <code>mysql-support</code> capabilities</p>
</li>
<li>
<p><code>postgres-support</code> provides both the <code>db-support</code> and <code>postgres-support</code> capabilities</p>
</li>
<li>
<p><code>mongo-support</code> provides both the <code>db-support</code> and <code>mongo-support</code> capabilities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then if the consumer tries to get both the <code>postgres-support</code> and <code>mysql-support</code> like this (this also works transitively):</p>
</div>
<div class="exampleblock">
<div class="title">Example 376. A consumer trying to use 2 incompatible variants at the same time</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>))

    <span class="comment">// Let's try to ask for both MySQL and Postgres support</span>
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-mysql-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
    runtimeOnly(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>)) {
        capabilities {
            requireCapability(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.demo:producer-postgres-support</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // This project requires the main producer component
    implementation(project(&quot;:producer&quot;))

    // Let's try to ask for both MySQL and Postgres support
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-mysql-support&quot;)
        }
    }
    runtimeOnly(project(&quot;:producer&quot;)) {
        capabilities {
            requireCapability(&quot;org.gradle.demo:producer-postgres-support&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependency resolution would fail with the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot choose between
   org.gradle.demo:producer:1.0 variant mysqlSupportRuntimeElements and
   org.gradle.demo:producer:1.0 variant postgresSupportRuntimeElements
   because they provide the same capability: org.gradle.demo:producer-db-support:1.0</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="understanding-variant-selection"><a class="anchor" href="#understanding-variant-selection"></a><a class="link" href="#understanding-variant-selection">Understanding variant selection</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s dependency management engine is known as <em>variant aware</em>.
In a traditional dependency management engine like Apache Maven, dependencies are bound to components published at GAV coordinates.
This means that the set of transitive dependencies for a component is solely determined by the GAV coordinates of this component.
It doesn&#8217;t matter what <em>artifact</em> is actually resolved, the set of dependencies is <em>always the same</em>.
In addition, selecting a different artifact for a component (for example, using the <code>jdk7</code> artifact) is cumbersome as it requires the use of <em>classifiers</em>.
One issue with this model is that it cannot guarantee global graph consistency because there are no common semantics associated with <em>classifiers</em>.
What this means is that there&#8217;s nothing which prevents from having both the <code>jdk7</code> and <code>jdk8</code> versions of a single module on classpath, because the engine has no idea what semantics are associated with the classifier name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/component-model-maven.png" alt="component model maven">
</div>
<div class="title">Figure 22. The Maven component model</div>
</div>
<div class="paragraph">
<p>Gradle, in addition to the concept of a <em>module</em> published at GAV coordinates, introduces the concept of <em>variants</em> of this module.
Variants correspond to the different "views" of a component that is published at the same GAV coordinates.
In the Gradle model, artifacts are attached to <em>variants</em>, not modules.
This means, in practice, that different <em>artifacts</em> can have a different set of dependencies:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/component-model-gradle.png" alt="component model gradle">
</div>
<div class="title">Figure 23. The Gradle component model</div>
</div>
<div class="paragraph">
<p>This intermediate level, which associates artifacts and dependencies to variants instead of directly to the component, allows Gradle to model properly what each artifact is used for.</p>
</div>
<div class="paragraph">
<p>However, this raises the question about how variants are selected: how does Gradle know which variant to choose when there&#8217;s more than one?
In practice, variants are selected thanks to the use of <a href="#">attributes</a>, which provide semantics to the variants and help the engine in achieving a <em>consistent resolution result</em>.</p>
</div>
<div class="paragraph">
<p>For historical reasons, Gradle differentiates between two kind of components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>local components, built from sources, for which <a href="#sec:abm_configuration_attributes">variants are mapped to outgoing configurations</a></p>
</li>
<li>
<p>external components, published on repositories, in which case either the module was published with Gradle Module Metadata and variants are natively supported, or the module is using Ivy/Maven metadata and <a href="#sec:mapping-maven-ivy-to-variants">variants are derived from metadata</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, Gradle performs <em>variant aware selection</em>.</p>
</div>
<div class="sect4">
<h5 id="sec:abm_configuration_attributes"><a class="anchor" href="#sec:abm_configuration_attributes"></a><a class="link" href="#sec:abm_configuration_attributes">Configuration and variant attributes</a></h5>
<div class="paragraph">
<p>Local components expose variants as <em>outgoing configurations</em>, which are <a href="#sec:resolvable-consumable-configs">consumable configurations</a>.
When dependency resolution happens, the engine will select one variant of an outgoing component by selecting one of its <em>consumable configurations</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are 2 noticeable exception to this rule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whenever a producer does <em>not</em> expose any consumable configuration</p>
</li>
<li>
<p>whenever the consumer <em>explicitly selects a target configuration</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, <em>variant aware resolution is bypassed</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Attributes are used on both <em>resolvable configurations</em> (also known as a <em>consumer</em>) and <em>consumable configurations</em> (on the <em>producer</em>).
Adding attributes to other kinds of configurations simply has no effect, as attributes are not inherited between configurations.</p>
</div>
<div class="paragraph">
<p>The role of the dependency resolution engine is to find a suitable <em>variant</em> of a <em>producer</em> given the constraints expressed by a <em>consumer</em>.</p>
</div>
<div class="paragraph">
<p>This is where attributes come into play: their role is to perform the selection of the right <em>variant</em> of a component.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Variants vs configurations</div>
<div class="paragraph">
<p>For external components, the terminology is to use the word <em>variants</em>, not <em>configurations</em>. Configurations are a super-set of variants.</p>
</div>
<div class="paragraph">
<p>This means that an external component provides <em>variants</em>, which also have attributes.
However, sometimes the term <em>configuration</em> may leak into the DSL for historical reasons, or because you use Ivy which also has this concept of <em>configuration</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:variant-visual"><a class="anchor" href="#sec:variant-visual"></a><a class="link" href="#sec:variant-visual">Visualizing variant information</a></h5>
<div class="paragraph">
<p>Gradle offers a report task called <code>outgoingVariants</code> that displays the variants of a project, with their capabilities, attributes and artifacts.
It is conceptually similar to the <code>dependencyInsight</code> <a href="#sec:identifying_reason_dependency_selection">reporting task</a>.</p>
</div>
<div class="paragraph">
<p>By default, <code>outgoingVariants</code> prints information about all variants.
It offers the optional parameter <code>--variant &lt;variantName&gt;</code> to select a single variant to display.
It also accepts the <code>-all</code> flag to include information about legacy and deprecated configurations.</p>
</div>
<div class="paragraph">
<p>Here is the output of the <code>outgoingVariants</code> task on a freshly generated <code>java-library</code> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Task :outgoingVariants
--------------------------------------------------
Variant apiElements
--------------------------------------------------
Description = API elements for main.

Capabilities
    - [default capability]
Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 8
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-api

Artifacts
    - build/libs/variant-report.jar (artifactType = jar)

Secondary variants (*)
    - Variant : classes
       - Attributes
          - org.gradle.category            = library
          - org.gradle.dependency.bundling = external
          - org.gradle.jvm.version         = 8
          - org.gradle.libraryelements     = classes
          - org.gradle.usage               = java-api
       - Artifacts
          - build/classes/java/main (artifactType = java-classes-directory)

--------------------------------------------------
Variant runtimeElements
--------------------------------------------------
Description = Elements of runtime for main.

Capabilities
    - [default capability]
Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 8
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime

Artifacts
    - build/libs/variant-report.jar (artifactType = jar)

Secondary variants (*)
    - Variant : classes
       - Attributes
          - org.gradle.category            = library
          - org.gradle.dependency.bundling = external
          - org.gradle.jvm.version         = 8
          - org.gradle.libraryelements     = classes
          - org.gradle.usage               = java-runtime
       - Artifacts
          - build/classes/java/main (artifactType = java-classes-directory)
    - Variant : resources
       - Attributes
          - org.gradle.category            = library
          - org.gradle.dependency.bundling = external
          - org.gradle.jvm.version         = 8
          - org.gradle.libraryelements     = resources
          - org.gradle.usage               = java-runtime
       - Artifacts
          - build/resources/main (artifactType = java-resources-directory)


(*) Secondary variants are variants created via the Configuration#getOutgoing(): ConfigurationPublications API which also participate in selection, in addition to the configuration itself.</pre>
</div>
</div>
<div class="paragraph">
<p>From this you can see the two main variants that are exposed by a java library, <code>apiElements</code> and <code>runtimeElements</code>.
Notice that the main difference is on the <code>org.gradle.usage</code> attribute, with values <code>java-api</code> and <code>java-runtime</code>.
As they indicate, this is where the difference is made between what needs to be on the <em>compile</em> classpath of consumers, versus what&#8217;s needed on the <em>runtime</em> classpath.</p>
</div>
<div class="paragraph">
<p>It also shows <em>secondary</em> variants, which are exclusive to Gradle projects and not published.
For example, the secondary variant <code>classes</code> from <code>apiElements</code> is what allows Gradle to skip the JAR creation when compiling against a <a href="#sec:java_library_classes_usage"><code>java-library</code> project</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:variant-aware-matching"><a class="anchor" href="#sec:variant-aware-matching"></a><a class="link" href="#sec:variant-aware-matching">Variant aware matching</a></h5>
<div class="paragraph">
<p>Let&#8217;s take the example of a <code>lib</code> library which exposes 2 variants: its API (via a variant named <code>exposedApi</code>) and its runtime (via a variant named <code>exposedRuntime</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">About producer variants</div>
<div class="paragraph">
<p>The variant <em>name</em> is there mostly for debugging purposes and to get a nicer display in error messages.
The name, in particular, doesn&#8217;t participate in the <em>id</em> of a variant: only its attributes do.
That is to say that to search for a particular variant, one <em>must</em> rely on its attributes, <em>not</em> its name.</p>
</div>
<div class="paragraph">
<p>There are no restrictions on the number of variants a component can expose.
Traditionally, a component would expose an API and an implementation, but we may, for example, want to expose the test fixtures of a component too.
It is also possible to expose <em>different APIs</em> for different consumers (think about different environments, like Linux vs Windows).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A consumer needs to explain <em>what</em> variant it needs and this is done by setting <em>attributes</em> on the <em>consumer</em>.</p>
</div>
<div class="paragraph">
<p>Attributes consist of a <em>name</em> and a <em>value</em> pair.
For example, Gradle comes with a standard attribute named <code>org.gradle.usage</code> specifically to deal with the concept of selecting the right variant of a component based on the usage of the consumer (compile, runtime &#8230;&#8203;).
It is however possible to define an arbitrary number of attributes.
As a producer, we can express that a consumable configuration represents the API of a component by attaching the <code>(org.gradle.usage,JAVA_API)</code> attribute to the variant.
As a consumer, we can express that we need the API of the dependencies of a resolvable configuration by attaching the <code>(org.gradle.usage,JAVA_API)</code> attribute to it.
Doing this, Gradle has a way to <em>automatically select the appropriate variant</em> by looking at the configuration attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the consumer wants <code>org.gradle.usage=JAVA_API</code></p>
</li>
<li>
<p>the producer, <code>lib</code> exposes 2 different variants. One with <code>org.gradle.usage=JAVA_API</code>, the other with <code>org.gradle.usage=JAVA_RUNTIME</code>.</p>
</li>
<li>
<p>Gradle chooses the <code>org.gradle.usage=JAVA_API</code> variant of the producer because it <em>matches the consumer attributes</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words: attributes are used to perform the selection based on the values of the attributes.</p>
</div>
<div class="paragraph">
<p>A more elaborate example involves more than one attribute.
Typically, a Java Library project in Gradle will involve 4 different attributes, found both on the producer and consumer sides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage</code>, explaining if the variant is the API of a component, or its implementation</p>
</li>
<li>
<p><code>org.gradle.dependency.bundling</code>, which declares how the dependencies of the component are bundled (for example, if the artifact is a fat jar, then the bundling is <code>EMBEDDED</code>)</p>
</li>
<li>
<p><code>org.gradle.libraryelements</code>, which is used to explain what <em>parts</em> of the library the variant contains (classes, resources or everything)</p>
</li>
<li>
<p><code>org.gradle.jvm.version</code>, which is used to explain what <em>minimal version</em> of Java this variant is targeted at</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now imagine that our library comes in two different flavors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one for JDK 8</p>
</li>
<li>
<p>one for JDK 9+</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is typically achieved, in Maven, by producing 2 different artifacts, a "main" artifact and a "classified" one.
However, in Maven a consumer cannot express the fact it needs the <em>most appropriate</em> version of the library based on the runtime.</p>
</div>
<div class="paragraph">
<p>With Gradle, this is elegantly solved by having the producer declare 2 variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one with <code>org.gradle.jvm.version=8</code>, for consumers <em>at least running on JDK 8</em></p>
</li>
<li>
<p>one with <code>org.gradle.jvm.version=9</code>, for consumers starting from JDK 9</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the artifacts for both variants will be different, but their dependencies <em>may</em> be different too.
Typically, the JDK 8 variant may need a "backport" library of JDK 9+ to work, that only consumers running on JDK 8 should get.</p>
</div>
<div class="paragraph">
<p>On the consumer side, the <em>resolvable configuration</em> will set all four attributes above, and, depending on the runtime, will set its <code>org.gradle.jvm.version</code> to 8 or more.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">A note about compatibility of variants</div>
<div class="paragraph">
<p>What if the consumer sets <code>org.gradle.jvm.version</code> to 7?</p>
</div>
<div class="paragraph">
<p>Then resolution would <em>fail</em> with an error message explaining that there&#8217;s no matching variant of the producer.
This is because Gradle recognizes that the consumer wants a Java 7 compatible library, but the <em>minimal</em> version of Java available on the producer is 8.
If, on the other hand, the consumer needs <em>11</em>, then Gradle knows both the <em>8</em> and <em>9</em> variant would work, but it will select <em>9</em> because it&#8217;s the highest compatible version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:variant-select-errors"><a class="anchor" href="#sec:variant-select-errors"></a><a class="link" href="#sec:variant-select-errors">Variant selection errors</a></h5>
<div class="paragraph">
<p>In the process of identifying the right variant of a component, two situations will result in a resolution error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>More than one variant from the producer match the consumer attributes, there is variant ambiguity</p>
</li>
<li>
<p>No variant from the producer match the consumer attributes</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="sub:variant-ambiguity"><a class="anchor" href="#sub:variant-ambiguity"></a><a class="link" href="#sub:variant-ambiguity">Dealing with ambiguous variant selection errors</a></h6>
<div class="paragraph">
<p>An ambiguous variant selection looks somewhat like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; Could not resolve all files for configuration ':compileClasspath'.
   &gt; Could not resolve project :lib.
     Required by:
         project :ui
      &gt; Cannot choose between the following variants of project :lib:
          - feature1ApiElements
          - feature2ApiElements
        All of them match the consumer attributes:
          - Variant 'feature1ApiElements' capability org.test:test-capability:1.0:
              - Unmatched attribute:
                  - Found org.gradle.category 'library' but wasn't required.
              - Compatible attributes:
                  - Provides org.gradle.dependency.bundling 'external'
                  - Provides org.gradle.jvm.version '11'
                  - Required org.gradle.libraryelements 'classes' and found value 'jar'.
                  - Provides 'java-api'
          - Variant 'feature2ApiElements' capability org.test:test-capability:1.0:
              - Unmatched attribute:
                  - Found org.gradle.category 'library' but wasn't required.
              - Compatible attributes:
                  - Provides org.gradle.dependency.bundling 'external'
                  - Provides org.gradle.jvm.version '11'
                  - Required org.gradle.libraryelements 'classes' and found value 'jar'.
                  - Provides org.gradle.usage 'java-api'</pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, all <em>compatible</em> candidate variants are displayed, with their attributes.
These are then grouped into two sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unmatched attributes are presented first, as they might be the missing piece in selecting the proper variant.</p>
</li>
<li>
<p>Compatible attributes are presented second as they indicate what the consumer wanted and how these variants do match that request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There cannot be any mismatched attributes as the variant would not be a candidate then.
Similarly, the set of displayed variants also excludes the ones that have been disambiguated.</p>
</div>
<div class="paragraph">
<p>In the example above, the fix does not lie in attribute matching but in <a href="#sec:adding-constraints-transitive-deps">capability matching</a>, which are shown next to the variant name.
Because these two variants effectively provide the same attributes and capabilities, they cannot be disambiguated.
So in this case, the fix is most likely to provide different capabilities on the producer side (<code>project :lib</code>) and express a capability choice on the consumer side (<code>project :ui</code>).</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:variant-no-match"><a class="anchor" href="#sub:variant-no-match"></a><a class="link" href="#sub:variant-no-match">Dealing with no matching variant errors</a></h6>
<div class="paragraph">
<p>A no matching variant error looks somewhat like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; No variants of project :lib match the consumer attributes:
  - Configuration ':lib:compile':
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attribute:
          - Provides usage 'api'
  - Configuration ':lib:compile' variant debug:
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attributes:
          - Found buildType 'debug' but wasn't required.
          - Provides usage 'api'
  - Configuration ':lib:compile' variant release:
      - Incompatible attribute:
          - Required artifactType 'dll' and found incompatible value 'jar'.
      - Other compatible attributes:
          - Found buildType 'release' but wasn't required.
          - Provides usage 'api'</pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, <em>all</em> candidate variants are displayed, with their attributes.
These are then grouped into two sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incompatible attributes are presented first, as they usually are the key in understanding why a variant could not be selected.</p>
</li>
<li>
<p>Other attributes are presented second, this includes <em>required</em> and <em>compatible</em> ones as well as all extra <em>producer</em> attributes that are not requested by the consumer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similarly with the ambiguous variant error, the goal is then to understand which variant is to be selected and see which attribute or capability can be tweaked on the consumer for this to happen.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:mapping-maven-ivy-to-variants"><a class="anchor" href="#sec:mapping-maven-ivy-to-variants"></a><a class="link" href="#sec:mapping-maven-ivy-to-variants">Mapping from Maven/Ivy to variants</a></h5>
<div class="paragraph">
<p>Neither Maven nor Ivy have the concept of <em>variants</em>, which are only natively supported by Gradle Module Metadata.
However, it doesn&#8217;t prevent Gradle from working with them thanks to different strategies.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Relationship with Gradle Module Metadata</div>
<div class="paragraph">
<p>Gradle Module Metadata is a metadata format for modules published on Maven, Ivy or other kind of repositories.
It is similar to <code>pom.xml</code> or <code>ivy.xml</code> files, but this format is <em>aware of variants</em>.
This means that if your project produces additional variants, those are available and published as part of the module metadata, which greatly improves the user experience.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata specification</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="sub:maven-mapping-to-variants"><a class="anchor" href="#sub:maven-mapping-to-variants"></a><a class="link" href="#sub:maven-mapping-to-variants">Mapping of POM files to variants</a></h6>
<div class="paragraph">
<p>Modules published on a Maven repository are converted into variant-aware modules.
A particularity of Maven modules is that there is no way to know what kind of component is published.
In particular, there&#8217;s no way to make the difference between a BOM representing a <em>platform</em>, and a BOM used as a super-POM.
Sometimes, it is even possible for a POM file to act both as a platform <em>and</em> a library.</p>
</div>
<div class="paragraph">
<p>As a consequence, Maven modules are derived into 6 distinct variants, which allows Gradle users to explain precisely what they depend on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>2 "library" variants (attribute <code>org.gradle.category</code> = <code>library</code>)</p>
<div class="ulist">
<ul>
<li>
<p>the <code>compile</code> variant maps the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> dependencies.
This variant is equivalent to the <code>apiElements</code> variant of the <a href="#">Java Library plugin</a>.
All dependencies of this scope are considered <em>API dependencies</em>.</p>
</li>
<li>
<p>the <code>runtime</code> variant maps both the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> and <code>&lt;scope&gt;runtime&lt;/scope&gt;</code> dependencies.
This variant is equivalent to the <code>runtimeElements</code> variant of the <a href="#">Java Library plugin</a>.
All dependencies of those scopes are considered <em>runtime dependencies</em>.</p>
<div class="ulist">
<ul>
<li>
<p>in both cases, the <code>&lt;dependencyManagement&gt;</code> dependencies are <em>not converted to constraints</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>4 "platform" variants derived from the <code>&lt;dependencyManagement&gt;</code> block (attribute <code>org.gradle.category</code> = <code>platform</code>):</p>
<div class="ulist">
<ul>
<li>
<p>the <code>platform-compile</code> variant maps the  <code>&lt;scope&gt;compile&lt;/scope&gt;</code> dependency management dependencies as <em>dependency constraints</em>.</p>
</li>
<li>
<p>the <code>platform-runtime</code> variant maps both the <code>&lt;scope&gt;compile&lt;/scope&gt;</code> and <code>&lt;scope&gt;runtime&lt;/scope&gt;</code> dependency management dependencies as <em>dependency constraints</em>.</p>
</li>
<li>
<p>the <code>enforced-platform-compile</code> is similar to <code>platform-compile</code> but all the constraints are <em>forced</em></p>
</li>
<li>
<p>the <code>enforced-platform-runtime</code> is similar to <code>platform-runtime</code> but all the constraints are <em>forced</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can understand more about the use of platform and enforced platforms variants by looking at the <a href="#sub:bom_import">importing BOMs</a> section of the manual.
By default, whenever you declare a dependency on a Maven module, Gradle is going to look for the <code>library</code> variants.
However, using the <code>platform</code> or <code>enforcedPlatform</code> keyword, Gradle is now looking for one of the "platform" variants, which allows you to import the constraints from the POM files, instead of the dependencies.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:ivy-mapping-to-variants"><a class="anchor" href="#sub:ivy-mapping-to-variants"></a><a class="link" href="#sub:ivy-mapping-to-variants">Mapping of Ivy files to variants</a></h6>
<div class="paragraph">
<p>Contrary to <a href="#sub:maven-mapping-to-variants">Maven</a>, there is no derivation strategy implemented for Ivy files by default.
The reason fo this is that, contrary to pom, Ivy is a flexible format that allows you to publish arbitrary many and customized <em>configurations</em>.
So there is no notion of compile/runtime scope or compile/runtime variants in Ivy in general.
Only if you use the <a href="#publishing_ivy">ivy-publish plugin</a> to publish ivy files with Gradle, you get a structure that follows a similar pattern as pom files.
But since there is not guarantee that <strong>all</strong> ivy metadata files consumed by a build follow this pattern, Gradle cannot enforce a derivation strategy based on it.</p>
</div>
<div class="paragraph">
<p>However, if you want to implement a derivation strategy for <em>compile</em> and <em>runtime</em> variants for Ivy, you can do so with <a href="#sec:component_metadata_rules">component metadata rule</a>.
The component metadata rules API allows you to <a href="#sec:component_metadata_rules_details">access ivy configurations</a> and create variants based on them.
If you know that all the ivy modules your are consuming have been published with Gradle without further customizations of the <code>ivy.xml</code> file, you can add the following rule to your build:</p>
</div>
<div class="exampleblock">
<div class="title">Example 377. Deriving compile and runtime variants for Ivy metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">IvyVariantDerivationRule</span> <span class="directive">implements</span> ComponentMetadataRule {
    <span class="annotation">@Inject</span> <span class="predefined-type">ObjectFactory</span> getObjects() { }

    <span class="type">void</span> execute(ComponentMetadataContext context) {
        <span class="comment">// This filters out any non Ivy module</span>
        <span class="keyword">if</span>(context.getDescriptor(IvyModuleDescriptor) == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span>
        }

        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeElements</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, getObjects().named(LibraryElements, LibraryElements.JAR))
                attribute(Category.CATEGORY_ATTRIBUTE, getObjects().named(Category, Category.LIBRARY))
                attribute(Usage.USAGE_ATTRIBUTE, getObjects().named(Usage, Usage.JAVA_RUNTIME))
            }
        }
        context.details.addVariant(<span class="string"><span class="delimiter">&quot;</span><span class="content">apiElements</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, getObjects().named(LibraryElements, LibraryElements.JAR))
                attribute(Category.CATEGORY_ATTRIBUTE, getObjects().named(Category, Category.LIBRARY))
                attribute(Usage.USAGE_ATTRIBUTE, getObjects().named(Usage, Usage.JAVA_API))
            }
        }
    }
}

dependencies {
    components { all(IvyVariantDerivationRule) }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class IvyVariantDerivationRule : ComponentMetadataRule {
    @Inject open fun getObjects(): ObjectFactory = throw UnsupportedOperationException()

    override fun execute(context: ComponentMetadataContext) {
        // This filters out any non Ivy module
        if(context.getDescriptor(IvyModuleDescriptor::class) == null) {
            return
        }

        context.details.addVariant(&quot;runtimeElements&quot;, &quot;default&quot;) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, getObjects().named(LibraryElements.JAR))
                attribute(Category.CATEGORY_ATTRIBUTE, getObjects().named(Category.LIBRARY))
                attribute(Usage.USAGE_ATTRIBUTE, getObjects().named(Usage.JAVA_RUNTIME))
            }
        }
        context.details.addVariant(&quot;apiElements&quot;, &quot;compile&quot;) {
            attributes {
                attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, getObjects().named(LibraryElements.JAR))
                attribute(Category.CATEGORY_ATTRIBUTE, getObjects().named(Category.LIBRARY))
                attribute(Usage.USAGE_ATTRIBUTE, getObjects().named(Usage.JAVA_API))
            }
        }
    }
}

dependencies {
    components { all&lt;IvyVariantDerivationRule&gt;() }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule creates an <code>apiElements</code> variant based on the <code>compile</code> configuration and a <code>runtimeElements</code> variant based on the <code>default</code> configuration of each ivy module.
For each variant, it sets the corresponding <a href="#sec:variant-aware-matching">Java ecosystem attributes</a>.
Dependencies and artifacts of the variants are taken from the underlying configurations.
If not all consumed ivy modules follow this pattern, the rule can be adjusted or only applied to a selected set of modules.</p>
</div>
<div class="paragraph">
<p>For all ivy modules without variants, Gradle falls back to legacy configuration selection (i.e. Gradle does <em>not</em> perform variant aware resolution for these modules).
This means either the <code>default</code> configuration or the configuration explicitly defined in the dependency to the corresponding module is selected.
(Note that explicit configuration selection is only possible from build scripts or ivy metadata, and should be avoided in favor of variant selection.)</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="variant_attributes"><a class="anchor" href="#variant_attributes"></a><a class="link" href="#variant_attributes">Working with Variant Attributes</a></h4>
<div class="paragraph">
<p>As explained in the section on <a href="#sec:variant-aware-matching">variant aware matching</a>, attributes give semantics to variants and are used to perform the selection between them.</p>
</div>
<div class="paragraph">
<p>As a user of Gradle, attributes are often hidden as implementation details.
But it might be useful to understand the <em>standard attributes</em> defined by Gradle and its core plugins.</p>
</div>
<div class="paragraph">
<p>As a plugin author, these attributes, and the way they are defined, can serve as a basis for <a href="#sec:declaring_attributes">building your own set of attributes</a> in your eco system plugin.</p>
</div>
<div class="sect4">
<h5 id="sec:standard_attributes"><a class="anchor" href="#sec:standard_attributes"></a><a class="link" href="#sec:standard_attributes">Standard attributes defined by Gradle</a></h5>
<div class="paragraph">
<p>Gradle defines a list of standard attributes used by Gradle&#8217;s core plugins.</p>
</div>
<div class="sect5">
<h6 id="ecosystem_independent_standard_attributes"><a class="anchor" href="#ecosystem_independent_standard_attributes"></a><a class="link" href="#ecosystem_independent_standard_attributes">Ecosystem-independent standard attributes</a></h6>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. Ecosystem-independent standard variant attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Usage.html#USAGE_ATTRIBUTE"><code>org.gradle.usage</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates main purpose of variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Usage</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Usage.html">Usage</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. <code>java-runtime</code> can be used in place of <code>java-api</code> but not the opposite)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Category.html#CATEGORY_ATTRIBUTE"><code>org.gradle.category</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the category of this software component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Category</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Category.html">Category</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. <code>library</code> is default on the JVM, no compatibility otherwise)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/LibraryElements.html#LIBRARY_ELEMENTS_ATTRIBUTE"><code>org.gradle.libraryelements</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the contents of a <code>org.gradle.category=library</code> variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LibraryElements</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/LibraryElements.html">LibraryElements</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics(e.g. in the JVM world, <code>jar</code> is the default and is compatible with <code>classes</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/DocsType.html#DOCS_TYPE_ATTRIBUTE"><code>org.gradle.docstype</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the contents of a <code>org.gradle.category=documentation</code> variant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DocsType</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/DocsType.html">DocsType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default, no compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Bundling.html#BUNDLING_ATTRIBUTE"><code>org.gradle.dependency.bundling</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how dependencies of a variant are accessed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bundling</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/Bundling.html">Bundling</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following ecosystem semantics (e.g. in the JVM world, <code>embedded</code> is compatible with <code>external</code>)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 13. Ecosystem-independent standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.gradle.status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component level attribute, derived</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Based on <a href="#sec:custom_status_scheme">a status scheme</a>, with a default one existing based on the source repository.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Based on the scheme in use</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="sub:jvm_default_attributes"><a class="anchor" href="#sub:jvm_default_attributes"></a><a class="link" href="#sub:jvm_default_attributes">JVM ecosystem specific attributes</a></h6>
<div class="paragraph">
<p>In addition to the ecosystem independent attributes defined above, the JVM ecosystem adds the following attribute:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 14. JVM ecosystem standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/java/TargetJvmVersion.html#TARGET_JVM_VERSION_ATTRIBUTE"><code>org.gradle.jvm.version</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the JVM version compatibility.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer using the version after the <code>1.</code> for Java 1.4 and before, the major version for Java 5 and beyond.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to the JVM version used by Gradle, lower is compatible with higher, prefers highest compatible.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The JVM ecosystem also contains a number of compatibility and disambiguation rules over the different attributes.
The reader willing to know more can take a look at the code for <code>org.gradle.api.internal.artifacts.JavaEcosystemSupport</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="native_ecosystem_specific_attributes"><a class="anchor" href="#native_ecosystem_specific_attributes"></a><a class="link" href="#native_ecosystem_specific_attributes">Native ecosystem specific attributes</a></h6>
<div class="paragraph">
<p>In addition to the ecosystem independent attributes defined above, the native ecosystem adds the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 15. Native ecosystem standard component attributes</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">compatibility and disambiguation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/cpp/CppBinary.html#DEBUGGABLE_ATTRIBUTE"><code>org.gradle.native.debuggable</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if the binary was built with debugging symbols</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/cpp/CppBinary.html#OPTIMIZED_ATTRIBUTE"><code>org.gradle.native.optimized</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if the binary was built with optimization flags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/MachineArchitecture.html#ARCHITECTURE_ATTRIBUTE"><code>org.gradle.native.architecture</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the target architecture of the binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MachineArchitecture</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/MachineArchitecture.html">MachineArchitecture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/OperatingSystemFamily.html#OPERATING_SYSTEM_ATTRIBUTE"><code>org.gradle.native.operatingSystem</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the target operating system of the binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OperatingSystemFamily</code> values built from constants defined in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/OperatingSystemFamily.html">OperatingSystemFamily</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:declaring_attributes"><a class="anchor" href="#sec:declaring_attributes"></a><a class="link" href="#sec:declaring_attributes">Declaring custom attributes</a></h5>
<div class="paragraph">
<p>If you are extending Gradle, e.g. by writing a plugin for another ecosystem, declaring custom attributes could be an option if you want to support variant-aware dependency management features in your plugin.
However, you should be cautious if you also attempt to publish libraries.
Semantics of new attributes are usually defined through a plugin, which can carry <a href="#sec:abm_compatibility_rules">compatibility</a> and <a href="#sec:abm_disambiguation_rules">disambiguation</a> rules.
Consequently, builds that consume libraries published for a certain ecosystem, also need to apply the corresponding plugin to interpret attributes correctly.
If your plugin is intended for a larger audience, i.e. if it is openly available and libraries are published to public repositories, defining new attributes effectively extends the semantics of Gradle Module Metadata and comes with responsibilities.
E.g., support for attributes that are already published should not be removed again, or should be handled in some kind of compatibility layer in future versions of the plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating_attributes_in_a_build_script_or_plugin"><a class="anchor" href="#creating_attributes_in_a_build_script_or_plugin"></a><a class="link" href="#creating_attributes_in_a_build_script_or_plugin">Creating attributes in a build script or plugin</a></h5>
<div class="paragraph">
<p>Attributes are <em>typed</em>. An attribute can be created via the <code>Attribute&lt;T&gt;.of</code> method:</p>
</div>
<div class="exampleblock">
<div class="title">Example 378. Define attributes</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// An attribute of type `String`</span>
<span class="keyword">def</span> myAttribute = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.attribute.name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>)
<span class="comment">// An attribute of type `Usage`</span>
<span class="keyword">def</span> myUsage = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.usage.attribute</span><span class="delimiter">&quot;</span></span>, Usage)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// An attribute of type `String`
val myAttribute = Attribute.of(&quot;my.attribute.name&quot;, String::class.java)
// An attribute of type `Usage`
val myUsage = Attribute.of(&quot;my.usage.attribute&quot;, Usage::class.java)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Currently, only attribute types of <code>String</code>, or anything extending <code>Named</code> is supported.
Attributes must be declared in the <em>attribute schema</em> found on the <code>dependencies</code> handler:</p>
</div>
<div class="exampleblock">
<div class="title">Example 379. Registering attributes on the attributes schema</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies.attributesSchema {
    <span class="comment">// registers this attribute to the attributes schema</span>
    attribute(myAttribute)
    attribute(myUsage)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies.attributesSchema {
    // registers this attribute to the attributes schema
    attribute(myAttribute)
    attribute(myUsage)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then configurations can be configured to set values for attributes:</p>
</div>
<div class="exampleblock">
<div class="title">Example 380. Setting attributes on configurations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myConfiguration {
        attributes {
            attribute(myAttribute, <span class="string"><span class="delimiter">'</span><span class="content">my-value</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    create(&quot;myConfiguration&quot;) {
        attributes {
            attribute(myAttribute, &quot;my-value&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For attributes which type extends <code>Named</code>, the value of the attribute <strong>must</strong> be created via the <em>object factory</em>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 381. Named attributes</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    myConfiguration {
        attributes {
            attribute(myUsage, project.objects.named(Usage, <span class="string"><span class="delimiter">'</span><span class="content">my-value</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    &quot;myConfiguration&quot; {
        attributes {
            attribute(myUsage, project.objects.named(Usage::class.java, &quot;my-value&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:abm_compatibility_rules"><a class="anchor" href="#sec:abm_compatibility_rules"></a><a class="link" href="#sec:abm_compatibility_rules">Attribute compatibility rules</a></h6>
<div class="paragraph">
<p>Attributes let the engine select <em>compatible variants</em>.
However, there are cases where a provider may not have <em>exactly</em> what the consumer wants, but still something that it can use.
For example, if the consumer is asking for the API of a library, there&#8217;s a possibility that the producer doesn&#8217;t have such a variant, but only a <em>runtime</em> variant.
This is typical of libraries published on external repositories.
In this case, we know that even if we don&#8217;t have an exact match (API), we can still compile against the runtime variant (it contains <em>more</em> than what we need to compile but it&#8217;s still ok to use).
To deal with this, Gradle provides <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributeCompatibilityRule.html">attribute compatibility rules</a>.
The role of a compatibility rule is to explain what variants are <em>compatible</em> with what the consumer asked for.</p>
</div>
<div class="paragraph">
<p>Attribute compatibility rules have to be registered via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributeMatchingStrategy.html">attribute matching strategy</a> that you can obtain from the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributesSchema.html">attributes schema</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:abm_disambiguation_rules"><a class="anchor" href="#sec:abm_disambiguation_rules"></a><a class="link" href="#sec:abm_disambiguation_rules">Attribute disambiguation rules</a></h6>
<div class="paragraph">
<p>Because multiple values for an attribute can be <em>compatible</em> with the requested attribute, Gradle needs to choose between the candidates.
This is done by implementing an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributeDisambiguationRule.html">attribute disambiguation rule</a>.</p>
</div>
<div class="paragraph">
<p>Attribute disambiguation rules have to be registered via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributeMatchingStrategy.html">attribute matching strategy</a> that you can obtain from the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/attributes/AttributesSchema.html">attributes schema</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cross_project_publications"><a class="anchor" href="#cross_project_publications"></a><a class="link" href="#cross_project_publications">Sharing outputs between projects</a></h4>
<div class="paragraph">
<p>A common pattern, in multi-project builds, is that one project consumes the artifacts of another project.
In general, the simplest consumption form in the Java ecosystem is that when <code>A</code> depends on <code>B</code>, then <code>A</code> would depend on the <code>jar</code> produced by project <code>B</code>.
As previously described in this chapter, this is modeled by <code>A</code> depending on a <em>variant of</em> <code>B</code>, where the variant is selected based on the needs of <code>A</code>.
For compilation, we need the API dependencies of <code>B</code>, provided by the <code>apiElements</code> variant.
For runtime, we need the runtime dependencies of <code>B</code>, provided by the <code>runtimeElements</code> variant.</p>
</div>
<div class="paragraph">
<p>However, what if you need a <em>different</em> artifact than the main one?
Gradle provides, for example, built-in support for depending on the <a href="#sec:java_test_fixtures">test fixtures</a> of another project, but sometimes the artifact you need to depend on simply isn&#8217;t exposed as a variant.</p>
</div>
<div class="paragraph">
<p>In order to be <em>safe to share</em> between projects and allow maximum performance (parallelism), such artifacts must be exposed via <em>outgoing configurations</em>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="title">Don&#8217;t reference other project tasks directly</div>
<div class="paragraph">
<p>A frequent anti-pattern to declare cross-project dependencies is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
   <span class="comment">// this is unsafe!</span>
   implementation project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:other</span><span class="delimiter">&quot;</span></span>).tasks.someOtherJar
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This publication model is <em>unsafe</em> and can lead to non-reproducible and hard to parallelize builds.
This section explains how to <em>properly create cross-project boundaries</em> by defining "exchanges" between projects by using <em>variants</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two, complementary, options to share artifacts between projects.
The <a href="#sec:simple-sharing-artifacts-between-projects">simplified version</a> is only suitable if what you need to share is a simple artifact that doesn&#8217;t depend on the consumer.
The simple solution is also limited to cases where this artifact is not published to a repository.
This also implies that the consumer does not publish a dependency to this artifact.
In cases where the consumer resolves to different artifacts in different contexts (e.g., different target platforms) or that publication is required, you need to use the <a href="#sec:variant-aware-sharing">advanced version</a>.</p>
</div>
<div class="sect4">
<h5 id="sec:simple-sharing-artifacts-between-projects"><a class="anchor" href="#sec:simple-sharing-artifacts-between-projects"></a><a class="link" href="#sec:simple-sharing-artifacts-between-projects">Simple sharing of artifacts between projects</a></h5>
<div class="paragraph">
<p>First, a producer needs to declare a configuration which is going to be <em>exposed</em> to consumers.
As explained in the <a href="#sec:resolvable-consumable-configs">configurations chapter</a>, this corresponds to a <em>consumable configuration</em>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine that the consumer requires <em>instrumented classes</em> from the producer, but that this artifact is <em>not</em> the main one.
The producer can expose its instrumented classes by creating a configuration that will "carry" this artifact:</p>
</div>
<div class="exampleblock">
<div class="title">Example 382. Declaring an outgoing variant</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedJars {
        canBeConsumed = <span class="predefined-constant">true</span>
        canBeResolved = <span class="predefined-constant">false</span>
        <span class="comment">// If you want this configuration to share the same dependencies, otherwise omit this line</span>
        extendsFrom implementation, runtimeOnly
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedJars by configurations.creating {
    isCanBeConsumed = true
    isCanBeResolved = false
    // If you want this configuration to share the same dependencies, otherwise omit this line
    extendsFrom(configurations[&quot;implementation&quot;], configurations[&quot;runtimeOnly&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This configuration is <em>consumable</em>, which means it&#8217;s an "exchange" meant for consumers.
We&#8217;re now going to add artifacts to this configuration, that consumers would get when they consume it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 383. Attaching an artifact to an outgoing configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">artifacts {
    instrumentedJars(instrumentedJar)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">artifacts {
    add(&quot;instrumentedJars&quot;, instrumentedJar)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the "artifact" we&#8217;re attaching is a <em>task</em> that actually generates a Jar.
Doing so, Gradle can automatically track dependencies of this task and build them as needed.
This is possible because the <code>Jar</code> task extends <code>AbstractArchiveTask</code>.
If it&#8217;s not the case, you will need to explicitly declare how the artifact is generated.</p>
</div>
<div class="exampleblock">
<div class="title">Example 384. Explicitly declaring the task dependency of an artifact</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">artifacts {
    instrumentedJars(someTask.outputFile) {
        builtBy(someTask)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">artifacts {
    add(&quot;instrumentedJars&quot;, someTask.outputFile) {
        builtBy(someTask)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the <em>consumer</em> needs to depend on this configuration in order to get the right artifact:</p>
</div>
<div class="exampleblock">
<div class="title">Example 385. An explicit configuration dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    instrumentedClasspath(project(<span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">:producer</span><span class="delimiter">&quot;</span></span>, <span class="key">configuration</span>: <span class="string"><span class="delimiter">'</span><span class="content">instrumentedJars</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    instrumentedClasspath(project(mapOf(
        &quot;path&quot; to &quot;:producer&quot;,
        &quot;configuration&quot; to &quot;instrumentedJars&quot;)))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Declaring a dependency on an explicit target configuration is <em>not recommended</em> if you plan to publish the component which has this dependency:
this would likely lead to broken metadata.
If you need to publish the component on a remote repository, follow the instructions of the <a href="#sec:variant-aware-sharing">variant-aware cross publication documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case, we&#8217;re adding the dependency to the <em>instrumentedClasspath</em> configuration, which is a <em>consumer specific configuration</em>.
In Gradle terminology, this is called a <a href="#sec:resolvable-consumable-configs">resolvable configuration</a>, which is defined this way:</p>
</div>
<div class="exampleblock">
<div class="title">Example 386. Declaring a resolvable configuration on the consumer</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedClasspath {
        canBeConsumed = <span class="predefined-constant">false</span>
        canBeResolved = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedClasspath by configurations.creating {
    isCanBeConsumed = false
    isCanBeResolved = true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:variant-aware-sharing"><a class="anchor" href="#sec:variant-aware-sharing"></a><a class="link" href="#sec:variant-aware-sharing">Variant-aware sharing of artifacts between projects</a></h5>
<div class="paragraph">
<p>In the <a href="#sec:simple-sharing-artifacts-between-projects">simple sharing solution</a>, we defined a configuration on the producer side which serves as an exchange of artifacts between the producer and the consumer.
However, the consumer has to explicitly tell which configuration it depends on, which is something we want to avoid in <em>variant aware resolution</em>.
In fact, we also <a href="#understanding-variant-selection">have explained</a> that it is possible for a consumer to express requirements using <em>attributes</em> and that the producer should provide the appropriate outgoing variants using attributes too.
This allows for smarter selection, because using a single dependency declaration, without any explicit target configuration, the consumer may resolve different things.
The typical example is that using a single dependency declaration <code>project(":myLib")</code>, we would either choose the <code>arm64</code> or <code>i386</code> version of <code>myLib</code> depending on the architecture.</p>
</div>
<div class="paragraph">
<p>To do this, we will add attributes to both the consumer and the producer.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to understand that once configurations have attributes, they participate in <em>variant aware resolution</em>, which means that they are candidates considered whenever <em>any</em> notation like <code>project(":myLib")</code> is used.
In other words, the attributes set on the producer <em>must be consistent with the other variants produced on the same project</em>.
They must not, in particular, introduce ambiguity for the existing selection.</p>
</div>
<div class="paragraph">
<p>In practice, it means that the attribute set used on the configuration you create are likely to be dependent on the <em>ecosystem</em> in use (Java, C++, &#8230;&#8203;) because the relevant plugins for those ecosystems often use different attributes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s enhance our previous example which happens to be a Java Library project.
Java libraries expose a couple of variants to their consumers, <code>apiElements</code> and <code>runtimeElements</code>. Now, we&#8217;re adding a 3rd one, <code>instrumentedJars</code>.</p>
</div>
<div class="paragraph">
<p>Therefore, we need to understand what our new variant is used for in order to set the proper attributes on it.
Let&#8217;s look at the attributes we find on the <code>runtimeElements</code> configuration:</p>
</div>
<div class="listingblock">
<div class="title">gradle outgoingVariants --variant runtimeElements</div>
<div class="content">
<pre>Attributes
    - org.gradle.category            = library
    - org.gradle.dependency.bundling = external
    - org.gradle.jvm.version         = 11
    - org.gradle.libraryelements     = jar
    - org.gradle.usage               = java-runtime</pre>
</div>
</div>
<div class="paragraph">
<p>What it tells us is that the Java Library plugin produces variants with 5 attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.category</code> tells us that this variant represents a <em>library</em></p>
</li>
<li>
<p><code>org.gradle.dependency.bundling</code> tells us that the dependencies of this variant are found as jars (they are not, for example, repackaged inside the jar)</p>
</li>
<li>
<p><code>org.gradle.jvm.version</code> tells us that the minimum Java version this library supports is Java 11</p>
</li>
<li>
<p><code>org.gradle.libraryelements</code> tells us this variant contains all elements found in a jar (classes and resources)</p>
</li>
<li>
<p><code>org.gradle.usage</code> says that this variant is a Java runtime, therefore suitable for a Java compiler but also at runtime</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a consequence, if we want our instrumented classes to be used in place of this variant when executing tests, we need to attach similar attributes to our variant.
In fact, the attribute we care about is <code>org.gradle.libraryelements</code> which explains <em>what the variant contains</em>, so we can setup the variant this way:</p>
</div>
<div class="exampleblock">
<div class="title">Example 387. Declaring the variant attributes</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    instrumentedJars {
        canBeConsumed = <span class="predefined-constant">true</span>
        canBeResolved = <span class="predefined-constant">false</span>
        attributes {
            attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.LIBRARY))
            attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))
            attribute(Bundling.BUNDLING_ATTRIBUTE, objects.named(Bundling, Bundling.EXTERNAL))
            attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, JavaVersion.current().majorVersion.toInteger())
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">producer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val instrumentedJars by configurations.creating {
    isCanBeConsumed = true
    isCanBeResolved = false
    attributes {
        attribute(Category.CATEGORY_ATTRIBUTE, namedAttribute(Category.LIBRARY))
        attribute(Usage.USAGE_ATTRIBUTE, namedAttribute(Usage.JAVA_RUNTIME))
        attribute(Bundling.BUNDLING_ATTRIBUTE, namedAttribute(Bundling.EXTERNAL))
        attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, JavaVersion.current().majorVersion.toInt())
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, namedAttribute(&quot;instrumented-jar&quot;))
    }
}

inline fun &lt;reified T: Named&gt; Project.namedAttribute(value: String) = objects.named(T::class.java, value)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Choosing the right attributes to set is the hardest thing in this process, because they carry the semantics of the variant.
Therefore, before adding <em>new attributes</em>, you should always ask yourself if there isn&#8217;t an attribute which carries the semantics you need.
If there isn&#8217;t, then you may add a new attribute.
When adding new attributes, you must also be careful because it&#8217;s possible that it creates ambiguity during selection.
Often adding an attribute means adding it to <em>all</em> existing variants.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What we have done here is that we have added a <em>new</em> variant, which can be used <em>at runtime</em>, but contains instrumented classes instead of the normal classes.
However, it now means that for runtime, the consumer has to choose between two variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>runtimeElements</code>, the regular variant offered by the <code>java-library</code> plugin</p>
</li>
<li>
<p><code>instrumentedJars</code>, the variant we have created</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In particular, say we want the instrumented classes on the test runtime classpath.
We can now, on the consumer, declare our dependency as a regular project dependency:</p>
</div>
<div class="exampleblock">
<div class="title">Example 388. Declaring the project dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
    testImplementation project(<span class="string"><span class="delimiter">'</span><span class="content">:producer</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
    testImplementation(project(&quot;:producer&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we stop here, Gradle will still select the <code>runtimeElements</code> variant in place of our <code>instrumentedJars</code> variant.
This is because the <code>testRuntimeClasspath</code> configuration asks for a configuration which <code>libraryelements</code> attribute is <code>jar</code>, and our new <code>instrumented-jars</code> value is <em>not compatible</em>.</p>
</div>
<div class="paragraph">
<p>So we need to change the requested attributes so that we now look for instrumented jars:</p>
</div>
<div class="exampleblock">
<div class="title">Example 389. Changing the consumer attributes</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    testRuntimeClasspath {
        attributes {
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span>))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">configurations {
    testRuntimeClasspath {
        attributes {
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements::class.java, &quot;instrumented-jar&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we&#8217;re telling that whenever we&#8217;re going to resolve the test runtime classpath, what we are looking for is <em>instrumented classes</em>.
There is a problem though: in our dependencies list, we have JUnit, which, obviously, is <em>not</em> instrumented.
So if we stop here, Gradle is going to fail, explaining that there&#8217;s no variant of JUnit which provide instrumented classes.
This is because we didn&#8217;t explain that it&#8217;s fine to use the regular jar, if no instrumented version is available.
To do this, we need to write a <em>compatibility rule</em>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 390. A compatibility rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">InstrumentedJarsRule</span> <span class="directive">implements</span> AttributeCompatibilityRule&lt;LibraryElements&gt; {

    <span class="annotation">@Override</span>
    <span class="type">void</span> execute(CompatibilityCheckDetails&lt;LibraryElements&gt; details) {
        <span class="keyword">if</span> (details.consumerValue.name == <span class="string"><span class="delimiter">'</span><span class="content">instrumented-jar</span><span class="delimiter">'</span></span> &amp;&amp; details.producerValue.name == <span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) {
            details.compatible()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class InstrumentedJarsRule: AttributeCompatibilityRule&lt;LibraryElements&gt; {

    override fun execute(details: CompatibilityCheckDetails&lt;LibraryElements&gt;) = details.run {
        if (consumerValue?.name == &quot;instrumented-jar&quot; &amp;&amp; producerValue?.name == &quot;jar&quot;) {
            compatible()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>which we need to declare on the attributes schema:</p>
</div>
<div class="exampleblock">
<div class="title">Example 391. Making use of the compatibility rule</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    attributesSchema {
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE) {
            compatibilityRules.add(InstrumentedJarsRule)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">consumer/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    attributesSchema {
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE) {
            compatibilityRules.add(InstrumentedJarsRule::class.java)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it! Now we have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>added a variant which provides instrumented jars</p>
</li>
<li>
<p>explained that this variant is a substitute for the runtime</p>
</li>
<li>
<p>explained that the consumer needs this variant <em>only for test runtime</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle therefore offers a powerful mechanism to select the right variants based on preferences and compatibility.
More details can be found in the <a href="#">variant aware plugins section of the documentation</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By adding a value to an existing attribute like we have done, or by defining new attributes, we are extending the model.
This means that <em>all consumers</em> have to know about this extended model.
For local consumers, this is usually not a problem because all projects understand and share the same schema, but if you had to publish this new variant to an external repository, it means that external consumers would have to add the same rules to their builds for them to pass.
This is in general not a problem for <em>ecosystem plugins</em> (e.g: the Kotlin plugin) where consumption is in any case not possible without applying the plugin, but it is a problem if you add custom values or attributes.</p>
</div>
<div class="paragraph">
<p>So, <strong>avoid publishing custom variants</strong> if they are for internal use only.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="targeting-different-platforms"><a class="anchor" href="#targeting-different-platforms"></a><a class="link" href="#targeting-different-platforms">Targeting different platforms</a></h5>
<div class="paragraph">
<p>It is common for a library to target different platforms.
In the Java ecosystem, we often see different artifacts for the same library, distinguished by a different <em>classifier</em>.
A typical example is Guava, which is published as this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>guava-jre</code> for JDK 8 and above</p>
</li>
<li>
<p><code>guava-android</code> for JDK 7</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The problem with this approach is that there&#8217;s no semantics associated with the classifier.
The dependency resolution engine, in particular, cannot determine automatically which version to use based on the consumer requirements.
For example, it would be better to express that you have a dependency on Guava, and let the engine choose between <code>jre</code> and <code>android</code> based on what is compatible.</p>
</div>
<div class="paragraph">
<p>Gradle provides an improved model for this, which doesn&#8217;t have the weakness of classifiers: attributes.</p>
</div>
<div class="paragraph">
<p>In particular, in the Java ecosystem, Gradle provides a built-in attribute that library authors can use to express compatibility with the Java ecosystem: <code>org.gradle.jvm.version</code>.
This attribute expresses the <em>minimal version that a consumer must have in order to work properly</em>.</p>
</div>
<div class="paragraph">
<p>When you apply the <code>java</code> or <code>java-library</code> plugins, Gradle will automatically associate this attribute to the outgoing variants.
This means that all libraries published with Gradle automatically tell which target platform they use.</p>
</div>
<div class="paragraph">
<p>By default, the <code>org.gradle.jvm.version</code> is set to the <em>target compatibility</em> of the source set.</p>
</div>
<div class="paragraph">
<p>While this attribute is automatically set, Gradle <em>will not</em>, by default, let you build a project for different JVMs.
If you need to do this, then you will need to create additional variants following the <a href="#sec:variant-aware-sharing">instructions on variant-aware matching</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Future versions of Gradle will provide ways to automatically build for different Java platforms.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:abm_artifact_transforms"><a class="anchor" href="#sec:abm_artifact_transforms"></a><a class="link" href="#sec:abm_artifact_transforms">Transforming dependency artifacts on resolution</a></h4>
<div class="paragraph">
<p>As described in <a href="#sec:resolvable-consumable-configs">different kinds of configurations</a>, there may be different variants for the same dependency.
For example, an external Maven dependency has a variant which should be used when compiling against the dependency (<code>java-api</code>), and a variant for running an application which uses the dependency (<code>java-runtime</code>).
A project dependency has even more variants, for example the classes of the project which are used for compilation are available as classes directories (<code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code>) or as JARs (<code>org.gradle.usage=java-api, org.gradle.libraryelements=jar</code>).</p>
</div>
<div class="paragraph">
<p>The variants of a dependency may differ in its transitive dependencies or in the artifact itself.
For example, the <code>java-api</code> and <code>java-runtime</code> variants of a Maven dependency only differ in the transitive dependencies and both use the same artifact  the JAR file.
For a project dependency, the <code>java-api,classes</code> and the <code>java-api,jars</code> variants have the same transitive dependencies and different artifacts  the classes directories and the JAR files respectively.</p>
</div>
<div class="paragraph">
<p>Gradle identifies a variant of a dependency uniquely by its set of <a href="#sec:abm_configuration_attributes">attributes</a>.
The <code>java-api</code> variant of a dependency is the variant identified by the <code>org.gradle.usage</code> attribute with value <code>java-api</code>.</p>
</div>
<div class="paragraph">
<p>When Gradle resolves a configuration, the <a href="#sec:abm_configuration_attributes">attributes</a> on the resolved configuration determine the <em>requested attributes</em>.
For all dependencies in the configuration, the variant with the requested attributes is selected when resolving the configuration.
For example, when the configuration requests <code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code> on a project dependency, then the classes directory is selected as the artifact.</p>
</div>
<div class="paragraph">
<p>When the dependency does not have a variant with the requested attributes, resolving the configuration fails.
Sometimes it is possible to transform the artifact of the dependency into the requested variant without changing the transitive dependencies.
For example, unzipping a JAR transforms the artifact of the <code>java-api,jars</code> variant into the <code>java-api,classes</code> variant.
Such a transformation is called <em>Artifact Transform</em>.
Gradle allows registering artifact transforms, and when the dependency does not have the requested variant, then Gradle will try to find a chain of artifact transforms for creating the variant.</p>
</div>
<div class="sect4">
<h5 id="artifact_transform_selection_and_execution"><a class="anchor" href="#artifact_transform_selection_and_execution"></a><a class="link" href="#artifact_transform_selection_and_execution">Artifact transform selection and execution</a></h5>
<div class="paragraph">
<p>As described above, when Gradle resolves a configuration and a dependency in the configuration does not have a variant with the requested attributes, Gradle tries to find a chain of artifact transforms to create the variant.
The process of finding a matching chain of artifact transforms is called <em>artifact transform selection</em>.
Each registered transform converts from a set of attributes to a set of attributes.
For example, the unzip transform can convert from <code>org.gradle.usage=java-api, org.gradle.libraryelements=jars</code> to <code>org.gradle.usage=java-api, org.gradle.libraryelements=classes</code>.</p>
</div>
<div class="paragraph">
<p>In order to find a chain, Gradle starts with the requested attributes and then considers all transforms which modify some of the requested attributes as possible paths leading there.
Going backwards, Gradle tries to obtain a path to some existing variant using transforms.</p>
</div>
<div class="paragraph">
<p>For example, consider a <code>minified</code> attribute with two values: <code>true</code> and <code>false</code>.
The minified attribute represents a variant of a dependency with unnecessary class files removed.
There is an artifact transform registered, which can transform <code>minified</code> from <code>false</code> to <code>true</code>.
When <code>minified=true</code> is requested for a dependency, and there are only variants with <code>minified=false</code>, then Gradle selects the registered minify transform.
The minify transform is able to transform the artifact of the dependency with <code>minified=false</code> to the artifact with <code>minified=true</code>.</p>
</div>
<div class="paragraph">
<p>Of all the found transform chains, Gradle tries to select the best one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is only one transform chain, it is selected.</p>
</li>
<li>
<p>If there are two transform chains, and one is a suffix of the other one, it is selected.</p>
</li>
<li>
<p>If there is a shortest transform chain, then it is selected.</p>
</li>
<li>
<p>In all other cases, the selection fails and an error is reported.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Gradle does not try to select artifact transforms when there is already a variant of the dependency matching the requested attributes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>artifactType</code> attribute is special, since it is only present on resolved artifacts and not on dependencies.
As a consequence, any transform which is only mutating <code>artifactType</code> will never be selected when resolving a configuration with only the <code>artifactType</code> as requested attribute.
It will only be considered when using an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ArtifactView.html">ArtifactView</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After selecting the required artifact transforms, Gradle resolves the variants of the dependencies which are necessary for the initial transform in the chain.
As soon as Gradle finishes resolving the artifacts for the variant, either by downloading an external dependency or executing a task producing the artifact, Gradle starts transforming the artifacts of the variant with the selected chain of artifact transforms.
Gradle executes the transform chains in parallel when possible.</p>
</div>
<div class="paragraph">
<p>Picking up the minify example above, consider a configuration with two dependencies, the external <code>guava</code> dependency and a project dependency on the <code>producer</code> project.
The configuration has the attributes <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>.
The external <code>guava</code> dependency has two variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> and</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=jar,minified=false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the minify transform, Gradle can convert the variant <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> of <code>guava</code> to <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>, which are the requested attributes.
The project dependency also has variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-runtime,org.gradle.libraryelements=classes,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=jar,minified=false</code>,</p>
</li>
<li>
<p><code>org.gradle.usage=java-api,org.gradle.libraryelements=classes,minified=false</code></p>
</li>
<li>
<p>and a few more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again, using the minify transform, Gradle can convert the variant <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=false</code> of the project <code>producer</code> to <code>org.gradle.usage=java-runtime,org.gradle.libraryelements=jar,minified=true</code>, which are the requested attributes.</p>
</div>
<div class="paragraph">
<p>When the configuration is resolved, Gradle needs to download the <code>guava</code> JAR and minify it.
Gradle also needs to execute the <code>producer:jar</code> task to generate the JAR artifact of the project and then minify it.
The downloading and the minification of the <code>guava.jar</code> happens in parallel to the execution of the <code>producer:jar</code> task and the minification of the resulting JAR.</p>
</div>
<div class="paragraph">
<p>Here is how to setup the <code>minified</code> attribute so that the above works.
You need to register the new attribute in the schema, add it to all JAR artifacts and request it on all resolvable configurations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 392. Artifact transform attribute setup</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
<span class="keyword">def</span> minified = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">minified</span><span class="delimiter">'</span></span>, <span class="predefined-type">Boolean</span>)
dependencies {
    attributesSchema {
        attribute(minified)                      // <b class="conum">(1)</b>
    }
    artifactTypes.getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>) {
        attributes.attribute(minified, <span class="predefined-constant">false</span>)    // <b class="conum">(2)</b>
    }
}

configurations.all {
    afterEvaluate {
        <span class="keyword">if</span> (canBeResolved) {
            attributes.attribute(minified, <span class="predefined-constant">true</span>) // <b class="conum">(3)</b>
        }
    }
}

dependencies {
    registerTransform(Minify) {
        from.attribute(minified, <span class="predefined-constant">false</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
        to.attribute(minified, <span class="predefined-constant">true</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
    }
}

dependencies {                                 // <b class="conum">(4)</b>
    implementation(<span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:27.1-jre</span><span class="delimiter">'</span></span>)
    implementation(project(<span class="string"><span class="delimiter">'</span><span class="content">:producer</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)
val minified = Attribute.of(&quot;minified&quot;, Boolean::class.javaObjectType)
dependencies {
    attributesSchema {
        attribute(minified)                      // <b class="conum">(1)</b>
    }
    artifactTypes.getByName(&quot;jar&quot;) {
        attributes.attribute(minified, false)    // <b class="conum">(2)</b>
    }
}

configurations.all {
    afterEvaluate {
        if (isCanBeResolved) {
            attributes.attribute(minified, true) // <b class="conum">(3)</b>
        }
    }
}

dependencies {
    registerTransform(Minify::class) {
        from.attribute(minified, false).attribute(artifactType, &quot;jar&quot;)
        to.attribute(minified, true).attribute(artifactType, &quot;jar&quot;)
    }
}

dependencies {                                 // <b class="conum">(4)</b>
    implementation(&quot;com.google.guava:guava:27.1-jre&quot;)
    implementation(project(&quot;:producer&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add the attribute to the schema</p>
</li>
<li>
<p>All JAR files are not minified</p>
</li>
<li>
<p>Request <code>minified=true</code> on all resolvable configurations</p>
</li>
<li>
<p>Add the dependencies which will be transformed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now see what happens when we run the <code>resolveRuntimeClasspath</code> task which resolves the <code>runtimeClasspath</code> configuration.
Observe that Gradle transforms the project dependency before the <code>resolveRuntimeClasspath</code> task starts.
Gradle transforms the binary dependencies when it executes the <code>resolveRuntimeClasspath</code> task.</p>
</div>
<div class="listingblock">
<div class="title">Output when resolving the runtimeClasspath configuration</div>
<div class="content">
<pre>&gt; gradle resolveRuntimeClasspath

&gt; Task :producer:compileJava
&gt; Task :producer:processResources NO-SOURCE
&gt; Task :producer:classes
&gt; Task :producer:jar

&gt; Transform artifact producer.jar (project :producer) with Minify
Nothing to minify - using producer.jar unchanged

&gt; Task :resolveRuntimeClasspath
Minifying guava-27.1-jre.jar
Nothing to minify - using listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar unchanged
Nothing to minify - using jsr305-3.0.2.jar unchanged
Nothing to minify - using checker-qual-2.5.2.jar unchanged
Nothing to minify - using error_prone_annotations-2.2.0.jar unchanged
Nothing to minify - using j2objc-annotations-1.1.jar unchanged
Nothing to minify - using animal-sniffer-annotations-1.17.jar unchanged
Nothing to minify - using failureaccess-1.0.1.jar unchanged

BUILD SUCCESSFUL in 0s
3 actionable tasks: 3 executed</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:implementing-artifact-transforms"><a class="anchor" href="#sec:implementing-artifact-transforms"></a><a class="link" href="#sec:implementing-artifact-transforms">Implementing artifact transforms</a></h5>
<div class="paragraph">
<p>Similar to task types, an artifact transform consists of an action and some parameters.
The major difference to custom task types is that the action and the parameters are implemented as two separate classes.</p>
</div>
<div class="paragraph">
<p>The implementation of the artifact transform action is a class implementing <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.transform.TransformAction.html">TransformAction</a>.
You need to implement the <code>transform()</code> method on the action, which converts an input artifact into zero, one or multiple of output artifacts.
Most artifact transforms will be one-to-one, so the transform method will transform the input artifact to exactly one output artifact.</p>
</div>
<div class="paragraph">
<p>The implementation of the artifact transform action needs to register each output artifact by calling
 <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.transform.TransformOutputs.html#org.gradle.api.artifacts.transform.TransformOutputs:dir(java.lang.Object)">TransformOutputs.dir()</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.transform.TransformOutputs.html#org.gradle.api.artifacts.transform.TransformOutputs:file(java.lang.Object)">TransformOutputs.file()</a>.</p>
</div>
<div class="paragraph">
<p>You can only supply two types of paths to the <code>dir</code> or <code>file</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute path to the input artifact or in the input artifact (for an input directory).</p>
</li>
<li>
<p>A relative path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle uses the absolute path as the location of the output artifact.
For example, if the input artifact is an exploded WAR, then the transform action can call <code>TransformOutputs.file()</code> for all jar files in the <code>WEB-INF/lib</code> directory.
The output of the transform would then be the library JARs of the web application.</p>
</div>
<div class="paragraph">
<p>For a relative path, the <code>dir()</code> or <code>file()</code> method returns a workspace to the transform action.
The implementation of the transform action needs to create the transformed artifact at the location of the provided workspace.</p>
</div>
<div class="paragraph">
<p>The output artifacts replace the input artifact in the transformed variant in the order they were registered.
For example, if the configuration consists of the artifacts <code>lib1.jar</code>, <code>lib2.jar</code>, <code>lib3.jar</code>, and the transform action registers a minified output artifact <code>&lt;artifact-name&gt;-min.jar</code> for the input artifact, then the transformed configuration consists of the artifacts <code>lib1-min.jar</code>, <code>lib2-min.jar</code> and <code>lib3-min.jar</code>.</p>
</div>
<div class="paragraph">
<p>Here is the implementation of an <code>Unzip</code> transform which transforms a JAR file into a classes directory by unzipping it.
The <code>Unzip</code> transform does not require any parameters.
Note how the implementation uses <code>@InputArtifact</code> to inject the artifact to transform into the action.
It requests a directory for the unzipped classes by using <code>TransformOutputs.dir()</code> and then unzips the JAR file into this directory.</p>
</div>
<div class="exampleblock">
<div class="title">Example 393. Artifact transform without parameters</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Unzip</span> <span class="directive">implements</span> TransformAction&lt;TransformParameters.None&gt; { // <b class="conum">(1)</b>
    <span class="annotation">@InputArtifact</span>                                                          // <b class="conum">(2)</b>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInputArtifact()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> input = inputArtifact.get().asFile
        <span class="keyword">def</span> unzipDir = outputs.dir(input.name)                              // <b class="conum">(3)</b>
        unzipTo(input, unzipDir)                                            // <b class="conum">(4)</b>
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> unzipTo(<span class="predefined-type">File</span> zipFile, <span class="predefined-type">File</span> unzipDir) {
        <span class="comment">// implementation...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Unzip : TransformAction&lt;TransformParameters.None&gt; {          // <b class="conum">(1)</b>
    @get:InputArtifact                                                      // <b class="conum">(2)</b>
    abstract val inputArtifact: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val input = inputArtifact.get().asFile
        val unzipDir = outputs.dir(input.name)                              // <b class="conum">(3)</b>
        unzipTo(input, unzipDir)                                            // <b class="conum">(4)</b>
    }

    private fun unzipTo(zipFile: File, unzipDir: File) {
        // implementation...
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>TransformParameters.None</code> if the transform does not use parameters</p>
</li>
<li>
<p>Inject the input artifact</p>
</li>
<li>
<p>Request an output location for the unzipped files</p>
</li>
<li>
<p>Do the actual work of the transform</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An artifact transform may require parameters, like a <code>String</code> determining some filter, or some file collection which is used for supporting the transformation of the input artifact.
In order to pass those parameters to the transform action, you need to define a new type with the desired parameters.
The type needs to implement the marker interface <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/transform/TransformParameters.html">TransformParameters</a>.
The parameters must be represented using <a href="#managed_properties">managed properties</a> and the parameters type must be a <a href="#managed_types">managed type</a>.
You can use an interface or abstract class declaring the getters and Gradle will generate the implementation.
All getters need to have proper input annotations, see the table in the section on <a href="#table:incremental_build_annotations">incremental build</a>.</p>
</div>
<div class="paragraph">
<p>You can find out more about implementing artifact transform parameters in <a href="#custom_gradle_types">Developing Custom Gradle Types</a>.</p>
</div>
<div class="paragraph">
<p>Here is the implementation of a <code>Minify</code> transform that makes JARs smaller by only keeping certain classes in them.
The <code>Minify</code> transform requires the classes to keep as parameters.
Observe how you can obtain the parameters by <code>TransformAction.getParameters()</code> in the <code>transform()</code> method.
The implementation of the <code>transform()</code> method requests a location for the minified JAR by using <code>TransformOutputs.file()</code> and then creates the minified JAR at this location.</p>
</div>
<div class="exampleblock">
<div class="title">Example 394. Minify transform implementation</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Minify</span> <span class="directive">implements</span> TransformAction&lt;Parameters&gt; { // <b class="conum">(1)</b>
    <span class="type">interface</span> Parameters <span class="directive">extends</span> TransformParameters {         // <b class="conum">(2)</b>
        <span class="annotation">@Input</span>
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;&gt; getKeepClassesByArtifact()
        <span class="type">void</span> setKeepClassesByArtifact(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt;&gt; keepClasses)
    }

    <span class="annotation">@PathSensitive</span>(PathSensitivity.NAME_ONLY)
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInputArtifact()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> fileName = inputArtifact.get().asFile.name
        <span class="keyword">for</span> (entry <span class="keyword">in</span> parameters.keepClassesByArtifact) {      // <b class="conum">(3)</b>
            <span class="keyword">if</span> (fileName.startsWith(entry.key)) {
                <span class="keyword">def</span> nameWithoutExtension = fileName.substring(<span class="integer">0</span>, fileName.length() - <span class="integer">4</span>)
                minify(inputArtifact.get().asFile, entry.value, outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>nameWithoutExtension<span class="inline-delimiter">}</span></span><span class="content">-min.jar</span><span class="delimiter">&quot;</span></span>))
                <span class="keyword">return</span>
            }
        }
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Nothing to minify - using </span><span class="inline"><span class="inline-delimiter">${</span>fileName<span class="inline-delimiter">}</span></span><span class="content"> unchanged</span><span class="delimiter">&quot;</span></span>
        outputs.file(inputArtifact)                            // <b class="conum">(4)</b>
    }

    <span class="directive">private</span> <span class="type">void</span> minify(<span class="predefined-type">File</span> artifact, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; keepClasses, <span class="predefined-type">File</span> jarFile) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Minifying </span><span class="inline"><span class="inline-delimiter">${</span>artifact.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="comment">// Implementation ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Minify : TransformAction&lt;Minify.Parameters&gt; {   // <b class="conum">(1)</b>
    interface Parameters : TransformParameters {               // <b class="conum">(2)</b>
        @get:Input
        var keepClassesByArtifact: Map&lt;String, Set&lt;String&gt;&gt;

    }

    @get:PathSensitive(PathSensitivity.NAME_ONLY)
    @get:InputArtifact
    abstract val inputArtifact: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val fileName = inputArtifact.get().asFile.name
        for (entry in parameters.keepClassesByArtifact) {      // <b class="conum">(3)</b>
            if (fileName.startsWith(entry.key)) {
                val nameWithoutExtension = fileName.substring(0, fileName.length - 4)
                minify(inputArtifact.get().asFile, entry.value, outputs.file(&quot;${nameWithoutExtension}-min.jar&quot;))
                return
            }
        }
        println(&quot;Nothing to minify - using ${fileName} unchanged&quot;)
        outputs.file(inputArtifact)                            // <b class="conum">(4)</b>
    }

    private fun minify(artifact: File, keepClasses: Set&lt;String&gt;, jarFile: File) {
        println(&quot;Minifying ${artifact.name}&quot;)
        // Implementation ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declare the parameter type</p>
</li>
<li>
<p>Interface for the transform parameters</p>
</li>
<li>
<p>Use the parameters</p>
</li>
<li>
<p>Use the unchanged input artifact when no minification is required</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remember that the input artifact is a dependency, which may have its own dependencies.
If your artifact transform needs access to those transitive dependencies, it can declare an abstract getter returning a <code>FileCollection</code> and annotate it with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/transform/InputArtifactDependencies.html">@InputArtifactDependencies</a>.
When your transform runs, Gradle will inject the transitive dependencies into that <code>FileCollection</code> property by implementing the getter.
Note that using input artifact dependencies in a transform has performance implications, only inject them when you really need them.</p>
</div>
<div class="paragraph">
<p>Moreover, artifact transforms can make use of the <a href="#build_cache">build cache</a> for their outputs.
To enable the build cache for an artifact transform, add the <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/transform/CacheableTransform.html">CacheableTransform</a></code> annotation on the action class.
For cacheable transforms, you must annotate its <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/transform/InputArtifact.html">@InputArtifact</a> property  and any property marked with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/transform/InputArtifactDependencies.html">@InputArtifactDependencies</a>  with normalization annotations such as <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/PathSensitive.html">@PathSensitive</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows a more complicated transform.
It moves some selected classes of a JAR to a different package, rewriting the byte code of the moved classes and all classes using the moved classes (class relocation).
In order to determine the classes to relocate, it looks at the packages of the input artifact and the dependencies of the input artifact.
It also does not relocate packages contained in JAR files in an external classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 395. Artifact transform for class relocation</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CacheableTransform</span>                                                          // <b class="conum">(1)</b>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">ClassRelocator</span> <span class="directive">implements</span> TransformAction&lt;Parameters&gt; {
    <span class="type">interface</span> Parameters <span class="directive">extends</span> TransformParameters {                       // <b class="conum">(2)</b>
        <span class="annotation">@CompileClasspath</span>                                                    // <b class="conum">(3)</b>
        ConfigurableFileCollection getExternalClasspath()
        <span class="annotation">@Input</span>
        Property&lt;<span class="predefined-type">String</span>&gt; getExcludedPackage()
    }

    <span class="annotation">@Classpath</span>                                                               // <b class="conum">(4)</b>
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getPrimaryInput()

    <span class="annotation">@CompileClasspath</span>
    <span class="annotation">@InputArtifactDependencies</span>                                               // <b class="conum">(5)</b>
    <span class="directive">abstract</span> FileCollection getDependencies()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> primaryInputFile = primaryInput.get().asFile
        <span class="keyword">if</span> (parameters.externalClasspath.contains(primaryInput)) {           // <b class="conum">(6)</b>
            outputs.file(primaryInput)
        } <span class="keyword">else</span> {
            <span class="keyword">def</span> baseName = primaryInputFile.name.substring(<span class="integer">0</span>, primaryInputFile.name.length - <span class="integer">4</span>)
            relocateJar(outputs.file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>baseName</span><span class="content">-relocated.jar</span><span class="delimiter">&quot;</span></span>))
        }
    }

    <span class="directive">private</span> relocateJar(<span class="predefined-type">File</span> output) {
        <span class="comment">// implementation...</span>
        <span class="keyword">def</span> relocatedPackages = (dependencies.collectMany { readPackages(<span class="local-variable">it</span>) } + readPackages(primaryInput.get().asFile)) <span class="keyword">as</span> <span class="predefined-type">Set</span>
        <span class="keyword">def</span> nonRelocatedPackages = parameters.externalClasspath.collectMany { readPackages(<span class="local-variable">it</span>) }
        <span class="keyword">def</span> relocations = (relocatedPackages - nonRelocatedPackages).collect { packageName -&gt;
            <span class="keyword">def</span> toPackage = <span class="string"><span class="delimiter">&quot;</span><span class="content">relocated.</span><span class="inline"><span class="inline-delimiter">$</span>packageName</span><span class="delimiter">&quot;</span></span>
            println(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>packageName</span><span class="content"> -&gt; </span><span class="inline"><span class="inline-delimiter">$</span>toPackage</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">new</span> Relocation(packageName, toPackage)
        }
        <span class="keyword">new</span> JarRelocator(primaryInput.get().asFile, output, relocations).run()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@CacheableTransform                                                          // <b class="conum">(1)</b>
abstract class ClassRelocator : TransformAction&lt;ClassRelocator.Parameters&gt; {
    interface Parameters : TransformParameters {                             // <b class="conum">(2)</b>
        @get:CompileClasspath                                                // <b class="conum">(3)</b>
        val externalClasspath: ConfigurableFileCollection
        @get:Input
        val excludedPackage: Property&lt;String&gt;
    }

    @get:Classpath                                                           // <b class="conum">(4)</b>
    @get:InputArtifact
    abstract val primaryInput: Provider&lt;FileSystemLocation&gt;

    @get:CompileClasspath
    @get:InputArtifactDependencies                                           // <b class="conum">(5)</b>
    abstract val dependencies: FileCollection

    override
    fun transform(outputs: TransformOutputs) {
        val primaryInputFile = primaryInput.get().asFile
        if (parameters.externalClasspath.contains(primaryInputFile)) {       // <b class="conum">(6)</b>
            outputs.file(primaryInput)
        } else {
            val baseName = primaryInputFile.name.substring(0, primaryInputFile.name.length - 4)
            relocateJar(outputs.file(&quot;$baseName-relocated.jar&quot;))
        }
    }

    private fun relocateJar(output: File) {
        // implementation...
        val relocatedPackages = (dependencies.flatMap { it.readPackages() } + primaryInput.get().asFile.readPackages()).toSet()
        val nonRelocatedPackages = parameters.externalClasspath.flatMap { it.readPackages() }
        val relocations = (relocatedPackages - nonRelocatedPackages).map { packageName -&gt;
            val toPackage = &quot;relocated.$packageName&quot;
            println(&quot;$packageName -&gt; $toPackage&quot;)
            Relocation(packageName, toPackage)
        }
        JarRelocator(primaryInput.get().asFile, output, relocations).run()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declare the transform cacheable</p>
</li>
<li>
<p>Interface for the transform parameters</p>
</li>
<li>
<p>Declare input type for each parameter</p>
</li>
<li>
<p>Declare a normalization for the input artifact</p>
</li>
<li>
<p>Inject the input artifact dependencies</p>
</li>
<li>
<p>Use the parameters</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="registering_artifact_transforms"><a class="anchor" href="#registering_artifact_transforms"></a><a class="link" href="#registering_artifact_transforms">Registering artifact transforms</a></h5>
<div class="paragraph">
<p>You need to register the artifact transform actions, providing parameters if necessary, so that they can be selected when resolving dependencies.</p>
</div>
<div class="paragraph">
<p>In order to register an artifact transform, you must use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html#org.gradle.api.artifacts.dsl.DependencyHandler:registerTransform(java.lang.Class,%20org.gradle.api.Action)">registerTransform()</a> within the <code>dependencies {}</code> block.</p>
</div>
<div class="paragraph">
<p>There are a few points to consider when using <code>registerTransform()</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>from</code> and <code>to</code> attributes are required.</p>
</li>
<li>
<p>The transform action itself can have configuration options. You can configure them with the <code>parameters {}</code> block.</p>
</li>
<li>
<p>You must register the transform on the project that has the configuration that will be resolved.</p>
</li>
<li>
<p>You can supply any type implementing <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.transform.TransformAction.html">TransformAction</a> to the <code>registerTransform()</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, imagine you want to unpack some dependencies and put the unpacked directories and files on the classpath.
You can do so by registering an artifact transform action of type <code>Unzip</code>, as shown here:</p>
</div>
<div class="exampleblock">
<div class="title">Example 396. Artifact transform registration without parameters</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)

dependencies {
    registerTransform(Unzip) {
        from.attribute(artifactType, <span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>)
        to.attribute(artifactType, <span class="string"><span class="delimiter">'</span><span class="content">java-classes-directory</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)

dependencies {
    registerTransform(Unzip::class) {
        from.attribute(artifactType, &quot;jar&quot;)
        to.attribute(artifactType, &quot;java-classes-directory&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another example is that you want to minify JARs by only keeping some <code>class</code> files from them.
Note the use of the <code>parameters {}</code> block to provide the classes to keep in the minified JARs to the <code>Minify</code> transform.</p>
</div>
<div class="exampleblock">
<div class="title">Example 397. Artifact transform registration with parameters</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> artifactType = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">artifactType</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
<span class="keyword">def</span> minified = <span class="predefined-type">Attribute</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">minified</span><span class="delimiter">'</span></span>, <span class="predefined-type">Boolean</span>)
<span class="keyword">def</span> keepPatterns = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">guava</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.common.base.Optional</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.common.base.AbstractIterator</span><span class="delimiter">&quot;</span></span>
    ] <span class="keyword">as</span> <span class="predefined-type">Set</span>
]


dependencies {
    registerTransform(Minify) {
        from.attribute(minified, <span class="predefined-constant">false</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)
        to.attribute(minified, <span class="predefined-constant">true</span>).attribute(artifactType, <span class="string"><span class="delimiter">&quot;</span><span class="content">jar</span><span class="delimiter">&quot;</span></span>)

        parameters {
            keepClassesByArtifact = keepPatterns
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val artifactType = Attribute.of(&quot;artifactType&quot;, String::class.java)
val minified = Attribute.of(&quot;minified&quot;, Boolean::class.javaObjectType)
val keepPatterns = mapOf(
    &quot;guava&quot; to setOf(
        &quot;com.google.common.base.Optional&quot;,
        &quot;com.google.common.base.AbstractIterator&quot;
    )
)


dependencies {
    registerTransform(Minify::class) {
        from.attribute(minified, false).attribute(artifactType, &quot;jar&quot;)
        to.attribute(minified, true).attribute(artifactType, &quot;jar&quot;)

        parameters {
            keepClassesByArtifact = keepPatterns
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implementing_incremental_artifact_transforms"><a class="anchor" href="#implementing_incremental_artifact_transforms"></a><a class="link" href="#implementing_incremental_artifact_transforms">Implementing incremental artifact transforms</a></h5>
<div class="paragraph">
<p>Similar to <a href="#incremental_tasks">incremental tasks</a>, artifact transforms can avoid work by only processing changed files from the last execution.
This is done by using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a> interface.
For artifact transforms, only the input artifact is an incremental input, and therefore the transform can only query for changes there.
In order to use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a> in the transform action, inject it into the action.
For more information on how to use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a>, see the corresponding documentation for <a href="#incremental_tasks">incremental tasks</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example of an incremental transform that counts the lines of code in Java source files:</p>
</div>
<div class="exampleblock">
<div class="title">Example 398. Artifact transform for lines of code counting</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">CountLoc</span> <span class="directive">implements</span> TransformAction&lt;TransformParameters.None&gt; {

    <span class="annotation">@Inject</span>                                                             // <b class="conum">(1)</b>
    <span class="directive">abstract</span> InputChanges getInputChanges()

    <span class="annotation">@PathSensitive</span>(PathSensitivity.RELATIVE)
    <span class="annotation">@InputArtifact</span>
    <span class="directive">abstract</span> <span class="predefined-type">Provider</span>&lt;FileSystemLocation&gt; getInput()

    <span class="annotation">@Override</span>
    <span class="type">void</span> transform(TransformOutputs outputs) {
        <span class="keyword">def</span> outputDir = outputs.dir(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>input.get().asFile.name<span class="inline-delimiter">}</span></span><span class="content">.loc</span><span class="delimiter">&quot;</span></span>)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Running transform on </span><span class="inline"><span class="inline-delimiter">${</span>input.get().asFile.name<span class="inline-delimiter">}</span></span><span class="content">, incremental: </span><span class="inline"><span class="inline-delimiter">${</span>inputChanges.incremental<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        inputChanges.getFileChanges(input).forEach { change -&gt;          // <b class="conum">(2)</b>
            <span class="keyword">def</span> changedFile = change.file
            <span class="keyword">if</span> (change.fileType != FileType.FILE) {
                <span class="keyword">return</span>
            }
            <span class="keyword">def</span> outputLocation = <span class="keyword">new</span> <span class="predefined-type">File</span>(outputDir, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>change.normalizedPath<span class="inline-delimiter">}</span></span><span class="content">.loc</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">switch</span> (change.changeType) {
                <span class="keyword">case</span> <span class="key">ADDED</span>:
                <span class="keyword">case</span> <span class="key">MODIFIED</span>:
                    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Processing file </span><span class="inline"><span class="inline-delimiter">${</span>changedFile.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                    outputLocation.parentFile.mkdirs()

                    outputLocation.text = changedFile.readLines().size()

                <span class="keyword">case</span> <span class="key">REMOVED</span>:
                    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Removing leftover output file </span><span class="inline"><span class="inline-delimiter">${</span>outputLocation.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                    outputLocation.delete()

            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class CountLoc : TransformAction&lt;TransformParameters.None&gt; {

    @get:Inject                                                         // <b class="conum">(1)</b>
    abstract val inputChanges: InputChanges

    @get:PathSensitive(PathSensitivity.RELATIVE)
    @get:InputArtifact
    abstract val input: Provider&lt;FileSystemLocation&gt;

    override
    fun transform(outputs: TransformOutputs) {
        val outputDir = outputs.dir(&quot;${input.get().asFile.name}.loc&quot;)
        println(&quot;Running transform on ${input.get().asFile.name}, incremental: ${inputChanges.isIncremental}&quot;)
        inputChanges.getFileChanges(input).forEach { change -&gt;          // <b class="conum">(2)</b>
            val changedFile = change.file
            if (change.fileType != FileType.FILE) {
                return@forEach
            }
            val outputLocation = outputDir.resolve(&quot;${change.normalizedPath}.loc&quot;)
            when (change.changeType) {
                ChangeType.ADDED, ChangeType.MODIFIED -&gt; {

                    println(&quot;Processing file ${changedFile.name}&quot;)
                    outputLocation.parentFile.mkdirs()

                    outputLocation.writeText(changedFile.readLines().size.toString())
                }
                ChangeType.REMOVED -&gt; {
                    println(&quot;Removing leftover output file ${outputLocation.name}&quot;)
                    outputLocation.delete()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Inject <code>InputChanges</code></p>
</li>
<li>
<p>Query for changes in the input artifact</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="working_in_a_multi_repo_environment"><a class="anchor" href="#working_in_a_multi_repo_environment"></a><a class="link" href="#working_in_a_multi_repo_environment">Working in a Multi-repo Environment</a></h3>
<div class="sect3">
<h4 id="composite_builds"><a class="anchor" href="#composite_builds"></a><a class="link" href="#composite_builds">Composing builds</a></h4>
<div class="sect4">
<h5 id="composite_build_intro"><a class="anchor" href="#composite_build_intro"></a><a class="link" href="#composite_build_intro">What is a composite build?</a></h5>
<div class="paragraph">
<p>A composite build is simply a build that includes other builds.
In many ways a composite build is similar to a Gradle multi-project build, except that instead of including single <code>projects</code>, complete <code>builds</code> are included.</p>
</div>
<div class="paragraph">
<p>Composite builds allow you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>combine builds that are usually developed independently, for instance when trying out a bug fix in a library that your application uses</p>
</li>
<li>
<p>decompose a large multi-project build into smaller, more isolated chunks that can be worked in independently or together as needed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A build that is included in a composite build is referred to, naturally enough, as an "included build". Included builds do not share any configuration with the composite build, or the other included builds. Each included build is configured and executed in isolation.</p>
</div>
<div class="paragraph">
<p>Included builds interact with other builds via <a href="#sec:dependency_substitution_rules"><em>dependency substitution</em></a>.
If any build in the composite has a dependency that can be satisfied by the included build, then that dependency will be replaced by a project dependency on the included build.
<em>Because of the reliance on dependency substitution, composite builds may force configurations to be resolved earlier, when composing the task execution graph.
This can have a negative impact on overall build performance, because these configurations are not resolved in parallel.</em></p>
</div>
<div class="paragraph">
<p>By default, Gradle will attempt to determine the dependencies that can be substituted by an included build. However for more flexibility, it is possible to explicitly declare these substitutions if the default ones determined by Gradle are not correct for the composite. See <a href="#included_build_declaring_substitutions">Declaring substitutions</a>.</p>
</div>
<div class="paragraph">
<p>As well as consuming outputs via project dependencies, a composite build can directly declare task dependencies on included builds. Included builds are isolated, and are not able to declare task dependencies on the composite build or on other included builds.
See <a href="#included_build_task_dependencies">Depending on tasks in an included build</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="defining_composite_builds"><a class="anchor" href="#defining_composite_builds"></a><a class="link" href="#defining_composite_builds">Defining a composite build</a></h5>
<div class="paragraph">
<p>The following examples demonstrate the various ways that 2 Gradle builds that are normally developed separately can be combined into a composite build. For these examples, the <code>my-utils</code> multi-project build produces 2 different java libraries (<code>number-utils</code> and <code>string-utils</code>), and the <code>my-app</code> build produces an executable using functions from those libraries.</p>
</div>
<div class="paragraph">
<p>The <code>my-app</code> build does not have direct dependencies on <code>my-utils</code>.
Instead, it declares binary dependencies on the libraries produced by <code>my-utils</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 399. Dependencies of my-app</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">my-app/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">idea</span><span class="delimiter">'</span></span>
}

group <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample</span><span class="delimiter">&quot;</span></span>
version <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>

application {
    mainClass = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample.myapp.Main</span><span class="delimiter">&quot;</span></span>
}

dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:number-utils:1.0</span><span class="delimiter">&quot;</span></span>
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.sample:string-utils:1.0</span><span class="delimiter">&quot;</span></span>
}

repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">my-app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
    application
    idea
}

group = &quot;org.sample&quot;
version = &quot;1.0&quot;

application {
    mainClass.set(&quot;org.sample.myapp.Main&quot;)
}

dependencies {
    implementation(&quot;org.sample:number-utils:1.0&quot;)
    implementation(&quot;org.sample:string-utils:1.0&quot;)
}

repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="command_line_composite"><a class="anchor" href="#command_line_composite"></a><a class="link" href="#command_line_composite">Defining a composite build via <code>--include-build</code></a></h6>
<div class="paragraph">
<p>The <code>--include-build</code> command-line argument turns the executed build into a composite, substituting dependencies from the included build into the executed build.</p>
</div>
</div>
<div class="sect5">
<h6 id="example_declaring_a_command_line_composite"><a class="anchor" href="#example_declaring_a_command_line_composite"></a><a class="link" href="#example_declaring_a_command_line_composite">Example: Declaring a command-line composite</a></h6>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle --include-build ../my-utils run</code></strong></div>
<div class="content">
<pre>&gt; gradle --include-build ../my-utils run
&gt; Task :processResources NO-SOURCE
&gt; Task :my-utils:string-utils:compileJava
&gt; Task :my-utils:string-utils:processResources NO-SOURCE
&gt; Task :my-utils:string-utils:classes
&gt; Task :my-utils:string-utils:jar
&gt; Task :my-utils:number-utils:compileJava
&gt; Task :my-utils:number-utils:processResources NO-SOURCE
&gt; Task :my-utils:number-utils:classes
&gt; Task :my-utils:number-utils:jar
&gt; Task :compileJava
&gt; Task :classes

&gt; Task :run
The answer is 42


BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="settings_defined_composite"><a class="anchor" href="#settings_defined_composite"></a><a class="link" href="#settings_defined_composite">Defining a composite build via the settings file</a></h6>
<div class="paragraph">
<p>It&#8217;s possible to make the above arrangement persistent, by using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:includeBuild(java.lang.Object)">Settings.includeBuild(java.lang.Object)</a> to declare the included build in the <code>settings.gradle</code> (or <code>settings.gradle.kts</code> in Kotlin) file.
The settings file can be used to add subprojects and included builds at the same time. Included builds are added by location.
See the examples below for more details.</p>
</div>
</div>
<div class="sect5">
<h6 id="separate_composite"><a class="anchor" href="#separate_composite"></a><a class="link" href="#separate_composite">Defining a separate composite build</a></h6>
<div class="paragraph">
<p>One downside of the above approach is that it requires you to modify an existing build, rendering it less useful as a standalone build. One way to avoid this is to define a separate composite build, whose only purpose is to combine otherwise separate builds.</p>
</div>
<div class="exampleblock">
<div class="title">Example 400. Declaring a separate composite</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">adhoc</span><span class="delimiter">'</span></span>

includeBuild <span class="string"><span class="delimiter">'</span><span class="content">../my-app</span><span class="delimiter">'</span></span>
includeBuild <span class="string"><span class="delimiter">'</span><span class="content">../my-utils</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;adhoc&quot;

includeBuild(&quot;../my-app&quot;)
includeBuild(&quot;../my-utils&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this scenario, the 'main' build that is executed is the composite, and it doesn&#8217;t define any useful tasks to execute itself. In order to execute the 'run' task in the 'my-app' build, the composite build must define a delegating task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 401. Depending on task from included build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task run {
    dependsOn gradle.includedBuild(<span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span>).task(<span class="string"><span class="delimiter">'</span><span class="content">:run</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;run&quot;) {
    dependsOn(gradle.includedBuild(&quot;my-app&quot;).task(&quot;:run&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>More details about tasks that depend on included build tasks are below.</p>
</div>
</div>
<div class="sect5">
<h6 id="included_builds"><a class="anchor" href="#included_builds"></a><a class="link" href="#included_builds">Restrictions on included builds</a></h6>
<div class="paragraph">
<p>Most builds can be included into a composite, including other composite builds.
However there are some limitations.</p>
</div>
<div class="paragraph">
<p>Every included build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>must not have a <code>rootProject.name</code> the same as another included build.</p>
</li>
<li>
<p>must not have a <code>rootProject.name</code> the same as a top-level project of the composite build.</p>
</li>
<li>
<p>must not have a <code>rootProject.name</code> the same as the composite build <code>rootProject.name</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="interacting_with_composite_builds"><a class="anchor" href="#interacting_with_composite_builds"></a><a class="link" href="#interacting_with_composite_builds">Interacting with a composite build</a></h5>
<div class="paragraph">
<p>In general, interacting with a composite build is much the same as a regular multi-project build.
Tasks can be executed, tests can be run, and builds can be imported into the IDE.</p>
</div>
<div class="sect5">
<h6 id="composite_build_executing_tasks"><a class="anchor" href="#composite_build_executing_tasks"></a><a class="link" href="#composite_build_executing_tasks">Executing tasks</a></h6>
<div class="paragraph">
<p>Tasks from the composite build can be executed from the command line, or from your IDE.
Executing a task will result in direct task dependencies being executed, as well as those tasks required to build dependency artifacts from included builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is not (yet) any means to directly execute a task from an included build via the command line.
Included build tasks are automatically executed in order to generate required dependency artifacts, or the <a href="#included_build_task_dependencies">including build can declare a dependency on a task from an included build</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="composite_build_ide_integration"><a class="anchor" href="#composite_build_ide_integration"></a><a class="link" href="#composite_build_ide_integration">Importing into the IDE</a></h6>
<div class="paragraph">
<p>One of the most useful features of composite builds is IDE integration. By applying the <a href="#idea_plugin">idea</a> or <a href="#eclipse_plugin">eclipse</a> plugin to your build, it is possible to generate a single IDEA or Eclipse project that permits all builds in the composite to be developed together.</p>
</div>
<div class="paragraph">
<p>In addition to these Gradle plugins, recent versions of <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> and <a href="https://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship</a> support direct import of a composite build.</p>
</div>
<div class="paragraph">
<p>Importing a composite build permits sources from separate Gradle builds to be easily developed together. For every included build, each sub-project is included as an IDEA Module or Eclipse Project.
Source dependencies are configured, providing cross-build navigation and refactoring.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="included_build_declaring_substitutions"><a class="anchor" href="#included_build_declaring_substitutions"></a><a class="link" href="#included_build_declaring_substitutions">Declaring the dependencies substituted by an included build</a></h5>
<div class="paragraph">
<p>By default, Gradle will configure each included build in order to determine the dependencies it can provide.
The algorithm for doing this is very simple: Gradle will inspect the group and name for the projects in the included build, and substitute project dependencies for any external dependency matching <code>${project.group}:${project.name}</code>.</p>
</div>
<div class="paragraph">
<p>There are cases when the default substitutions determined by Gradle are not sufficient, or they are not correct for a particular composite.
For these cases it is possible to explicitly declare the substitutions for an included build.
Take for example a single-project build 'anonymous-library', that produces a java utility library but does not declare a value for the group attribute:</p>
</div>
<div class="exampleblock">
<div class="title">Example 402. Build that does not declare group attribute</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When this build is included in a composite, it will attempt to substitute for the dependency module "undefined:anonymous-library" ("undefined" being the default value for <code>project.group</code>, and "anonymous-library" being the root project name).
Clearly this isn&#8217;t going to be very useful in a composite build.
To use the unpublished library unmodified in a composite build, the composing build can explicitly declare the substitutions that it provides:</p>
</div>
<div class="exampleblock">
<div class="title">Example 403. Declaring the substitutions for an included build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">app</span><span class="delimiter">'</span></span>

includeBuild(<span class="string"><span class="delimiter">'</span><span class="content">../anonymous-library</span><span class="delimiter">'</span></span>) {
    dependencySubstitution {
        substitute module(<span class="string"><span class="delimiter">'</span><span class="content">org.sample:number-utils</span><span class="delimiter">'</span></span>) with project(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;app&quot;

includeBuild(&quot;../anonymous-library&quot;) {
    dependencySubstitution {
        substitute(module(&quot;org.sample:number-utils&quot;)).with(project(&quot;:&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this configuration, the "my-app" composite build will substitute any dependency on <code>org.sample:number-utils</code> with a dependency on the root project of "anonymous-library".</p>
</div>
<div class="sect5">
<h6 id="included_build_substitution_requirements"><a class="anchor" href="#included_build_substitution_requirements"></a><a class="link" href="#included_build_substitution_requirements">Cases where included build substitutions must be declared</a></h6>
<div class="paragraph">
<p>Many builds that use the <code>uploadArchives</code> task to publish artifacts will function automatically as an included build, without declared substitutions.
Here are some common cases where declared substitutions are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the <code>archivesBaseName</code> property is used to set the name of the published artifact.</p>
</li>
<li>
<p>When a configuration other than <code>default</code> is published: this usually means a task other than <code>uploadArchives</code> is used.</p>
</li>
<li>
<p>When the <code>MavenPom.addFilter()</code> is used to publish artifacts that don&#8217;t match the project name.</p>
</li>
<li>
<p>When the <code>maven-publish</code> or <code>ivy-publish</code> plugins are used for publishing, and the publication coordinates don&#8217;t match <code>${project.group}:${project.name}</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="included_build_substitution_limitations"><a class="anchor" href="#included_build_substitution_limitations"></a><a class="link" href="#included_build_substitution_limitations">Cases where composite build substitutions won&#8217;t work</a></h6>
<div class="paragraph">
<p>Some builds won&#8217;t function correctly when included in a composite, even when dependency substitutions are explicitly declared. This limitation is due to the fact that a project dependency that is substituted will always point to the <code>default</code> configuration of the target project.
Any time that the artifacts and dependencies specified for the default configuration of a project don&#8217;t match what is actually published to a repository, then the composite build may exhibit different behaviour.</p>
</div>
<div class="paragraph">
<p>Here are some cases where the publish module metadata may be different from the project default configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a configuration other than <code>default</code> is published.</p>
</li>
<li>
<p>When the <code>maven-publish</code> or <code>ivy-publish</code> plugins are used.</p>
</li>
<li>
<p>When the <code>POM</code> or <code>ivy.xml</code> file is tweaked as part of publication.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Builds using these features function incorrectly when included in a composite build.
We plan to improve this in the future.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="included_build_task_dependencies"><a class="anchor" href="#included_build_task_dependencies"></a><a class="link" href="#included_build_task_dependencies">Depending on tasks in an included build</a></h5>
<div class="paragraph">
<p>While included builds are isolated from one another and cannot declare direct dependencies, a composite build is able to declare task dependencies on its included builds. The included builds are accessed using <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:includedBuilds">Gradle.getIncludedBuilds()</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html#org.gradle.api.invocation.Gradle:includedBuild(java.lang.String)">Gradle.includedBuild(java.lang.String)</a>, and a task reference is obtained via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.IncludedBuild.html#org.gradle.api.initialization.IncludedBuild:task(java.lang.String)">IncludedBuild.task(java.lang.String)</a> method.</p>
</div>
<div class="paragraph">
<p>Using these APIs, it is possible to declare a dependency on a task in a particular included build, or tasks with a certain path in all or some of the included builds.</p>
</div>
<div class="exampleblock">
<div class="title">Example 404. Depending on a single task from an included build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task run {
    dependsOn gradle.includedBuild(<span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span>).task(<span class="string"><span class="delimiter">'</span><span class="content">:run</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">composite/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;run&quot;) {
    dependsOn(gradle.includedBuild(&quot;my-app&quot;).task(&quot;:run&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 405. Depending on a task with path in all included builds</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task publishDeps {
    dependsOn gradle.includedBuilds*.task(<span class="string"><span class="delimiter">'</span><span class="content">:publishIvyPublicationToIvyRepository</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;publishDeps&quot;) {
    dependsOn(gradle.includedBuilds.map { it.task(&quot;:publishIvyPublicationToIvyRepository&quot;) })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="current_limitations_and_future_work"><a class="anchor" href="#current_limitations_and_future_work"></a><a class="link" href="#current_limitations_and_future_work">Current limitations and future plans for composite builds</a></h5>
<div class="paragraph">
<p>We think composite builds are pretty useful already.
However, there are some things that don&#8217;t yet work the way we&#8217;d like, and other improvements that we think will make things work even better.</p>
</div>
<div class="paragraph">
<p>Limitations of the current implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No support for included builds that have publications that don&#8217;t mirror the project default configuration. See <a href="#included_build_substitution_limitations">Cases where composite builds won&#8217;t work</a>.</p>
</li>
<li>
<p>Software model based native builds are not supported. (Binary dependencies are not yet supported for native builds).</p>
</li>
<li>
<p>Multiple composite builds may conflict when run in parallel, if more than one includes the same build. Gradle does not share the project lock of a shared composite build to between Gradle invocation to prevent concurrent execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Improvements we have planned for upcoming releases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Better detection of dependency substitution, for build that publish with custom coordinates, builds that produce multiple components, etc. This will reduce the cases where dependency substitution needs to be explicitly declared for an included build.</p>
</li>
<li>
<p>The ability to target a task or tasks in an included build directly from the command line. We are currently exploring syntax options for allowing this functionality, which will remove many cases where a delegating task is required in the composite.</p>
</li>
<li>
<p>Making the implicit <code>buildSrc</code> project an included build.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_libraries"><a class="anchor" href="#publishing_libraries"></a><a class="link" href="#publishing_libraries">Publishing Libraries</a></h3>
<div class="sect3">
<h4 id="publishing_components"><a class="anchor" href="#publishing_components"></a><a class="link" href="#publishing_components">Publishing a project as module</a></h4>
<div id="publishing_overview" class="paragraph">
<p>The vast majority of software projects build something that aims to be consumed in some way.
It could be a library that other software projects use or it could be an application for end users.
<em>Publishing</em> is the process by which the thing being built is made available to consumers.</p>
</div>
<div class="paragraph">
<p>In Gradle, that process looks like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define <a href="#publishing_overview:what">what</a> to publish</p>
</li>
<li>
<p>Define <a href="#publishing_overview:where">where</a> to publish it to</p>
</li>
<li>
<p><a href="#publishing_overview:how">Do</a> the publishing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each of the these steps is dependent on the type of repository to which you want to publish artifacts.
The two most common types are Maven-compatible and Ivy-compatible repositories, or Maven and Ivy repositories for short.</p>
</div>
<div class="paragraph">
<p>As of Gradle 6.0, the <a href="#sec:understanding-gradle-module-md">Gradle Module Metadata</a> will always be published alongside the Ivy XML or Maven POM metadata file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Looking for information on upload tasks and the <code>archives</code> configuration?
See the <a href="artifact_management.html#artifact_management">Legacy Publishing</a> chapter, a feature which is now deprecated and scheduled for removal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle makes it easy to publish to these types of repository by providing some prepackaged infrastructure in the form of the <a href="#publishing_maven">Maven Publish Plugin</a> and the <a href="#publishing_ivy">Ivy Publish Plugin</a>.
These plugins allow you to configure what to publish and perform the publishing with a minimum of effort.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/publishing-process.png" alt="publishing process">
</div>
<div class="title">Figure 24. The publishing process</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at those steps in more detail:</p>
</div>
<div id="publishing_overview:what" class="dlist">
<dl>
<dt class="hdlist1">What to publish</dt>
<dd>
<p>Gradle needs to know what files and information to publish so that consumers can use your project.
This is typically a combination of <a href="#sub:terminology_artifact">artifacts</a> and metadata that Gradle calls a <a href="#sub:terminology_publication">publication</a>.
Exactly what a publication contains depends on the type of repository it&#8217;s being published to.</p>
<div class="paragraph">
<p>For example, a publication destined for a Maven repository includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more artifacts  typically built by the project,</p>
</li>
<li>
<p>The Gradle Module Metadata file which will describe the variants of the published component,</p>
</li>
<li>
<p>The Maven POM file will identify the primary artifact and its dependencies.
The primary artifact is typically the project&#8217;s production JAR and secondary artifacts might consist of "-sources" and "-javadoc" JARs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, Gradle will publish checksums for all of the above, and <a href="#">signatures</a> when configured to do so.
From Gradle 6.0 onwards, this includes <code>SHA256</code> and <code>SHA512</code> checksums.</p>
</div>
</dd>
</dl>
</div>
<div id="publishing_overview:where" class="dlist">
<dl>
<dt class="hdlist1">Where to publish</dt>
<dd>
<p>Gradle needs to know where to publish artifacts so that consumers can get hold of them. This is done via <a href="#sub:terminology_repository">repositories</a>, which store and make available all sorts of artifact.
Gradle also needs to interact with the repository, which is why you must provide the type of the repository and its location.</p>
</dd>
</dl>
</div>
<div id="publishing_overview:how" class="dlist">
<dl>
<dt class="hdlist1">How to publish</dt>
<dd>
<p>Gradle automatically generates publishing tasks for all possible combinations of publication and repository, allowing you to publish any artifact to any repository. If you&#8217;re publishing to a Maven repository, the tasks are of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a>, while for Ivy repositories the tasks are of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>What follows is a practical example that demonstrates the entire publishing process.</p>
</div>
<div class="sect4">
<h5 id="sec:basic_publishing"><a class="anchor" href="#sec:basic_publishing"></a><a class="link" href="#sec:basic_publishing">Setting up basic publishing</a></h5>
<div class="paragraph">
<p>The first step in publishing, irrespective of your project type, is to apply the appropriate publishing plugin. As mentioned in the introduction, Gradle supports both Maven and Ivy repositories via the following plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#publishing_maven">Maven Publish Plugin</a></p>
</li>
<li>
<p><a href="#publishing_ivy">Ivy Publish Plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These provide the specific publication and repository classes needed to configure publishing for the corresponding repository type. Since Maven repositories are the most commonly used ones, they will be the basis for this example and for the other samples in the chapter. Don&#8217;t worry, we will explain how to adjust individual samples for Ivy repositories.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we&#8217;re working with a simple Java library project, so only the following plugins are applied:</p>
</div>
<div class="exampleblock">
<div class="title">Example 406. Applying the necessary plugins</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once the appropriate plugin has been applied, you can configure the publications and repositories. For this example, we want to publish the project&#8217;s production JAR file the one produced by the <code>jar</code> task  to a custom, Maven repository. We do that with the following <code>publishing {}</code> block, which is backed by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 407. Configuring a Java library for publishing</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group = <span class="string"><span class="delimiter">'</span><span class="content">org.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
        }
    }

    repositories {
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">myRepo</span><span class="delimiter">'</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="content">file://</span><span class="inline"><span class="inline-delimiter">${</span>buildDir<span class="inline-delimiter">}</span></span><span class="content">/repo</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">group = &quot;org.example&quot;
version = &quot;1.0&quot;

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myLibrary&quot;) {
            from(components[&quot;java&quot;])
        }
    }

    repositories {
        maven {
            name = &quot;myRepo&quot;
            url = uri(&quot;file://${buildDir}/repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This defines a publication called "myLibrary" that can be published to a Maven repositoryby virtue of its type: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>.
This publication consists of just the production JAR artifact and its metadata, which combined are represented by the <code>java</code> <a href="#sub:terminology_component">component</a> of the project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Components are the standard way of defining a publication. They are provided by plugins, usually of the language or platform variety. For example, the Java Plugin defines the <code>components.java</code> <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/SoftwareComponent.html">SoftwareComponent</a>, while the War Plugin defines <code>components.web</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example also defines a file-based Maven repository with the name "myRepo". Such a file-based repository is convenient for a sample, but real-world builds typically work with HTTPS-based repository servers, such as Maven Central or an internal company server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You may define one, and only one, repository without a name. This translates to an implicit name of "Maven" for Maven repositories and "Ivy" for Ivy repositories. All other repository definitions must be given an explicit name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In combination with the project&#8217;s <code>group</code> and <code>version</code>, the publication and repository definitions provide everything that Gradle needs to publish the project&#8217;s production JAR. Gradle will then create a dedicated <code>publishMyLibraryPublicationToMyRepoRepository</code> task that does just that. Its name is based on the template <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code>. See the appropriate publishing plugin&#8217;s documentation for more details on the nature of this task and any other tasks that may be available to you.</p>
</div>
<div class="paragraph">
<p>You can either execute the individual publishing tasks directly, or you can execute <code>publish</code>, which will run all the available publishing tasks. In this example, <code>publish</code> will just run <code>publishMyLibraryPublicationToMavenRepository</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Basic publishing to an Ivy repository is very similar: you simply use the Ivy Publish Plugin, replace  <code>MavenPublication</code> with <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>, and use <code>ivy</code> instead of <code>maven</code> in the repository definition.</p>
</div>
<div class="paragraph">
<p>There are differences between the two types of repository, particularly around the extra metadata that each support for example, Maven repositories require a POM file while Ivy ones have their own metadata format  so see the plugin chapters for comprehensive information on how to configure both publications and repositories for whichever repository type you&#8217;re working with.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That&#8217;s everything for the basic use case. However, many projects need more control over what gets published, so we look at several common scenarios in the following sections.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:understanding-gradle-module-md"><a class="anchor" href="#sec:understanding-gradle-module-md"></a><a class="link" href="#sec:understanding-gradle-module-md">Understanding Gradle Module Metadata</a></h4>
<div class="paragraph">
<p>Gradle Module Metadata is a format used to serialize the Gradle component model.
It is similar to <a href="https://maven.apache.org/pom.html">Apache Maven's POM file</a> or <a href="http://ant.apache.org/ivy/">Apache Ivy ivy.xml</a> files.
The goal of metadata files is to provide <em>to consumers</em> a reasonable model of what is published on a repository.</p>
</div>
<div class="paragraph">
<p>Gradle Module Metadata is a unique format aimed at improving dependency resolution by making it multi-platform and variant-aware.</p>
</div>
<div class="paragraph">
<p>In particular, Gradle Module Metadata supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rich-version-constraints">rich version constraints</a></p>
</li>
<li>
<p><a href="#sec:adding-constraints-transitive-deps">dependency constraints</a></p>
</li>
<li>
<p><a href="#declaring-component-capabilities">component capabilities</a></p>
</li>
<li>
<p><a href="#understanding-variant-selection">variant-aware resolution</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Publication of Gradle Module Metadata will enable better dependency management for your consumers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>early discovery of problems by detecting <a href="#declaring-component-capabilities">incompatible modules</a></p>
</li>
<li>
<p>consistent selection of <a href="#targeting-different-platforms">platform-specific dependencies</a></p>
</li>
<li>
<p>native <a href="#version_alignment">dependency version alignement</a></p>
</li>
<li>
<p>automatically getting dependencies for specific <a href="#">features of your library</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle Module Metadata is automatically published when using the <a href="#">Maven Publish plugin</a> or the <a href="#">Ivy Publish plugin</a>.
It is <em>not</em> supported on the legacy <code>maven</code> and <code>ivy</code> plugins.</p>
</div>
<div class="paragraph">
<p>The specification for Gradle Module Metadata specification can be found <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">here</a>.</p>
</div>
<div class="sect4">
<h5 id="sub:mapping-with-other-formats"><a class="anchor" href="#sub:mapping-with-other-formats"></a><a class="link" href="#sub:mapping-with-other-formats">Mapping with other formats</a></h5>
<div class="paragraph">
<p>Gradle Module Metadata is automatically published on Maven or Ivy repositories.
However, it doesn&#8217;t replace the <em>pom.xml</em> or <em>ivy.xml</em> files: it is published alongside those files.
This is done to maximize compatibility with third-party build tools.</p>
</div>
<div class="paragraph">
<p>Gradle does its best to map Gradle-specific concepts to Maven or Ivy.
When a build file uses features that can only be represented in Gradle Module Metadata, Gradle will warn you at publication time.
The table below summarizes how some Gradle specific features are mapped to Maven and Ivy:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Mapping of Gradle specific concepts to Maven and Ivy</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Ivy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:adding-constraints-transitive-deps">dependency constraints</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;dependencyManagement&gt;</code> dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle dependency constraints are <em>transitive</em>, while Maven&#8217;s dependency management block <em>isn&#8217;t</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rich-version-constraints">rich version constraints</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publishes the <em>requires</em> version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published the <em>requires</em> version</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#declaring-component-capabilities">component capabilities</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component capabilities are unique to Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#">Feature variants</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variant artifacts are uploaded, dependencies are published as _optional dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variant artifacts are uploaded, dependencies are not published</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature variants are a good replacement for optional dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:publishing-custom-components">Custom component types</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts are uploaded, dependencies are those described by the mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts are uploaded, dependencies are ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom component types are probably not consumable from Maven or Ivy in any case. They usually exist in the context of a custom ecosystem.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="disabling_metadata_compatibility_publication_warnings"><a class="anchor" href="#disabling_metadata_compatibility_publication_warnings"></a><a class="link" href="#disabling_metadata_compatibility_publication_warnings">Disabling metadata compatibility publication warnings</a></h6>
<div class="paragraph">
<p>If you want to suppress warnings, you can use the following APIs to do so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Maven, see the <code>suppress*</code> methods in <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:suppressAllPomMetadataWarnings()">MavenPublication</a></p>
</li>
<li>
<p>For Ivy, see the <code>suppress*</code> methods in <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:suppressAllIvyMetadataWarnings()">IvyPublication</a></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 408. Disabling publication warnings</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    publications {
        maven(MavenPublication) {
            from components.java
            suppressPomMetadataWarningsFor(<span class="string"><span class="delimiter">'</span><span class="content">runtimeElements</span><span class="delimiter">'</span></span>)
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    publications {
        register&lt;MavenPublication&gt;(&quot;maven&quot;) {
            from(components[&quot;java&quot;])
            suppressPomMetadataWarningsFor(&quot;runtimeElements&quot;)
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:interactions-other-build-tools"><a class="anchor" href="#sub:interactions-other-build-tools"></a><a class="link" href="#sub:interactions-other-build-tools">Interactions with other build tools</a></h5>
<div class="paragraph">
<p>Because Gradle Module Metadata is not widely spread and that it aims at <a href="#sub:mapping-with-other-formats">maximizing compatibility with other tools</a>, Gradle does a couple of things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata is systematically published alongside the normal descriptor for a given repository (Maven or Ivy)</p>
</li>
<li>
<p>the <code>pom.xml</code> or <code>ivy.xml</code> file will contain a <em>marker comment</em> which tells Gradle that Gradle Module Metadata exists for this module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of the marker is <em>not</em> for other tools to parse module metadata: it&#8217;s for Gradle users only.
It explains to Gradle that a <em>better</em> module metadata file exists and that it should use it instead.
It doesn&#8217;t mean that consumption from Maven or Ivy would be broken either, only that it works in <a href="#sub:mapping-with-other-formats">degraded mode</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This must be seen as a <em>performance optimization</em>: instead of having to do 2 network requests, one to get Gradle Module Metadata, then one to get the POM/Ivy file in case of a miss, Gradle will first look at the file which is most likely to be present, then only perform a 2nd request if the module was actually published with Gradle Module Metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you know that the modules you depend on are always published with Gradle Module Metadata, you can optimize the network calls configuring the metadata sources for a repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 409. Resolving Gradle Module Metadata only</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    repositories {
        maven {
            url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://repo.mycompany.com/repo</span><span class="delimiter">&quot;</span></span>
            metadataSources {
                gradleMetadata()
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    repositories {
        maven {
            setUrl(&quot;http://repo.mycompany.com/repo&quot;)
            metadataSources {
                gradleMetadata()
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sub:gmm-validation"><a class="anchor" href="#sub:gmm-validation"></a><a class="link" href="#sub:gmm-validation">Gradle Module Metadata validation</a></h5>
<div class="paragraph">
<p>Gradle Module Metadata is validated before being published.</p>
</div>
<div class="paragraph">
<p>The following rules are enforced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variant names must be unique,</p>
</li>
<li>
<p>Each variant must have at least <a href="#">one attribute</a>,</p>
</li>
<li>
<p>Two variants cannot have the <a href="#">exact same attributes and capabilities</a>,</p>
</li>
<li>
<p>If there are dependencies, at least one, across all variants, must carry <a href="#">version information</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These rules ensure the quality of the metadata produced, and help confirm that consumption will not be problematic.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:disabling-gmm-publication"><a class="anchor" href="#sub:disabling-gmm-publication"></a><a class="link" href="#sub:disabling-gmm-publication">Disabling Gradle Module Metadata publication</a></h5>
<div class="paragraph">
<p>There are situations where you might want to disable publication of Gradle Module Metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the repository you are uploading to rejects the metadata file (unknown format)</p>
</li>
<li>
<p>you are using Maven or Ivy specific concepts which are not properly mapped to Gradle Module Metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, disabling the publication of Gradle Module Metadata is done simply by disabling the task which generates the metadata file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 410. Disabling publication of Gradle Module Metadata</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    tasks.withType(GenerateModuleMetadata) {
        enabled = <span class="predefined-constant">false</span>
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    tasks.withType&lt;GenerateModuleMetadata&gt; {
        enabled = false
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:signing"><a class="anchor" href="#publishing_maven:signing"></a><a class="link" href="#publishing_maven:signing">Signing artifacts</a></h4>
<div class="paragraph">
<p>The <a href="#signing_plugin">Signing Plugin</a> can be used to sign all artifacts and metadata files that make up a publication, including Maven POM files and Ivy module descriptors. In order to use it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Apply the Signing Plugin</p>
</li>
<li>
<p>Configure the <a href="#sec:signatory_credentials">signatory credentials</a>  follow the link to see how</p>
</li>
<li>
<p>Specify the publications you want signed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an example that configures the plugin to sign the <code>mavenJava</code> publication:</p>
</div>
<div class="exampleblock">
<div class="title">Example 411. Signing a publication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    sign publishing.publications.mavenJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    sign(publishing.publications[&quot;mavenJava&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will create a <code>Sign</code> task for each publication you specify and wire all <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks to depend on it. Thus, publishing any publication will automatically create and publish the signatures for its artifacts and metadata, as you can see from this output:</p>
</div>
<div class="sect4">
<h5 id="example_sign_and_publish_a_project"><a class="anchor" href="#example_sign_and_publish_a_project"></a><a class="link" href="#example_sign_and_publish_a_project">Example: Sign and publish a project</a></h5>
<div class="listingblock">
<div class="title">Output of <code>gradle publish</code></div>
<div class="content">
<pre>&gt; gradle publish
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :javadoc
&gt; Task :javadocJar
&gt; Task :sourcesJar
&gt; Task :generateMetadataFileForMavenJavaPublication
&gt; Task :generatePomFileForMavenJavaPublication
&gt; Task :signMavenJavaPublication
&gt; Task :publishMavenJavaPublicationToMavenRepository
&gt; Task :publish

BUILD SUCCESSFUL in 0s
10 actionable tasks: 10 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customizing_publishing"><a class="anchor" href="#customizing_publishing"></a><a class="link" href="#customizing_publishing">Customizing publishing</a></h4>
<div class="sect4">
<h5 id="sec:adding-variants-to-existing-components"><a class="anchor" href="#sec:adding-variants-to-existing-components"></a><a class="link" href="#sec:adding-variants-to-existing-components">Modifying and adding variants to existing components for publishing</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s publication model is based on the notion of <em>components</em>, which are defined by plugins.
For example, the Java Library plugin defines a <code>java</code> component which corresponds to a library, but the Java Platform plugin defines another kind of component, named <code>javaPlatform</code>, which is effectively a different kind of software component (a <em>platform</em>).</p>
</div>
<div class="paragraph">
<p>Sometimes we want to add <em>more variants</em> to or modify <em>existing variants</em> of an existing component.
For example, if you <a href="#targeting-different-platforms">added a variant of a Java library for a different platform</a>, you may just want to declare this additional variant on the <code>java</code> component itself.
In general, declaring additional variants is often the best solution to publish <em>additional artifacts</em>.</p>
</div>
<div class="paragraph">
<p>To perform such additions or modifications, the <code>AdhocComponentWithVariants</code> interface declares two methods called <code>addVariantsFromConfiguration</code> and <code>withVariantsFromConfiguration</code> which accept two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="#sec:resolvable-consumable-configs">outgoing configuration</a> that is used as a variant source</p>
</li>
<li>
<p>a customization action which allows you to <em>filter</em> which variants are going to be published</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To utilise these methods, you must make sure that the <code>SoftwareComponent</code> you work with is itself an <code>AdhocComponentWithVariants</code>, which is the case for the components created by the Java plugins (Java, Java Library, Java Platform).
Adding a variant is then very simple:</p>
</div>
<div class="exampleblock">
<div class="title">Example 412. Adding a variant to an existing software component</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        AdhocComponentWithVariants javaComponent = (AdhocComponentWithVariants) project.components.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>)
        javaComponent.addVariantsFromConfiguration(outgoing) {
            <span class="comment">// dependencies for this variant are considered runtime dependencies</span>
            <span class="local-variable">it</span>.mapToMavenScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>)
            <span class="comment">// and also optional dependencies, because we don't want them to leak</span>
            <span class="local-variable">it</span>.mapToOptional()
        }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        val javaComponent = components.findByName(&quot;java&quot;) as AdhocComponentWithVariants
        javaComponent.addVariantsFromConfiguration(outgoing) {
            // dependencies for this variant are considered runtime dependencies
            mapToMavenScope(&quot;runtime&quot;)
            // and also optional dependencies, because we don't want them to leak
            mapToOptional()
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other cases, you might want to modify a variant that was added by one of the Java plugins already.
For example, if you activate publishing of Javadoc and sources, these become additional variants of the <code>java</code> component.
If you only want to publish one of them, e.g. only Javadoc but no sources, you can modify the <code>sources</code> variant to not being published:</p>
</div>
<div class="exampleblock">
<div class="title">Example 413. Publish a java library with Javadoc but without sources</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    withJavadocJar()
    withSourcesJar()
}

components.java.withVariantsFromConfiguration(configurations.sourcesElements) {
    skip()
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    withJavadocJar()
    withSourcesJar()
}

val javaComponent = components[&quot;java&quot;] as AdhocComponentWithVariants
javaComponent.withVariantsFromConfiguration(configurations[&quot;sourcesElements&quot;]) {
    skip()
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:publishing-custom-components"><a class="anchor" href="#sec:publishing-custom-components"></a><a class="link" href="#sec:publishing-custom-components">Creating and publishing custom components</a></h5>
<div class="paragraph">
<p>In the <a href="#sec:adding-variants-to-existing-components">previous example</a>, we have demonstrated how to extend or modify an existing component, like the components provided by the Java plugins.
But Gradle also allows you to build a custom component (not a Java Library, not a Java Platform, not something supported natively by Gradle).</p>
</div>
<div class="paragraph">
<p>To create a custom component, you first need to create an empty <em>adhoc</em> component.
At the moment, this is only possible via a plugin because you need to get a handle on the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/SoftwareComponentFactory.html">SoftwareComponentFactory</a> :</p>
</div>
<div class="exampleblock">
<div class="title">Example 414. Injecting the software component factory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="directive">private</span> <span class="directive">final</span> SoftwareComponentFactory softwareComponentFactory

    <span class="annotation">@Inject</span>
    InstrumentedJarsPlugin(SoftwareComponentFactory softwareComponentFactory) {
        <span class="local-variable">this</span>.softwareComponentFactory = softwareComponentFactory
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class InstrumentedJarsPlugin @Inject constructor(
    private val softwareComponentFactory: SoftwareComponentFactory) : Plugin&lt;Project&gt; {</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Declaring <em>what</em> a custom component publishes is still done via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/AdhocComponentWithVariants.html">AdhocComponentWithVariants</a> API.
For a custom component, the first step is to create custom outgoing variants, following the instructions in <a href="#sec:variant-aware-sharing">this chapter</a>.
At this stage, what you should have is variants which can be used in cross-project dependencies, but that we are now going to publish to external repositories.</p>
</div>
<div class="exampleblock">
<div class="title">Example 415. Creating a custom, adhoc component</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="comment">// create an adhoc component</span>
        <span class="keyword">def</span> adhocComponent = softwareComponentFactory.adhoc(<span class="string"><span class="delimiter">&quot;</span><span class="content">myAdhocComponent</span><span class="delimiter">&quot;</span></span>)
        <span class="comment">// add it to the list of components that this project declares</span>
        project.components.add(adhocComponent)
        <span class="comment">// and register a variant for publication</span>
        adhocComponent.addVariantsFromConfiguration(outgoing) {
            <span class="local-variable">it</span>.mapToMavenScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">runtime</span><span class="delimiter">&quot;</span></span>)
        }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">InstrumentedJarsPlugin.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        // create an adhoc component
        val adhocComponent = softwareComponentFactory.adhoc(&quot;myAdhocComponent&quot;)
        // add it to the list of components that this project declares
        components.add(adhocComponent)
        // and register a variant for publication
        adhocComponent.addVariantsFromConfiguration(outgoing) {
            mapToMavenScope(&quot;runtime&quot;)
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>First we use the factory to create a new adhoc component.
Then we add a variant through the <code>addVariantsFromConfiguration</code> method, which is described in more detail in the <a href="#sec:adding-variants-to-existing-components">previous section</a>.</p>
</div>
<div class="paragraph">
<p>In simple cases, there&#8217;s a one-to-one mapping between a <code>Configuration</code> and a variant, in which case you can publish all variants issued from a single <code>Configuration</code> because they are effectively the same thing.
However, there are cases where a <code>Configuration</code> is associated with additional <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/ConfigurationPublications.html">configuration publications</a> that we also call <em>secondary variants</em>.
Such configurations make sense in the <a href="#">cross-project publications</a> use case, but not when publishing externally.
This is for example the case when between projects you share a <em>directory of files</em>, but there&#8217;s no way you can publish a <em>directory</em> directly on a Maven repository (only packaged things like jars or zips).
Look at the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/ConfigurationVariantDetails.html">ConfigurationVariantDetails</a> class for details about how to skip publication of a particular variant.
If <code>addVariantsFromConfiguration</code> has already been called for a configuration, further modification of the resulting variants can be performed using <code>withVariantsFromConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>When publishing an adhoc component like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle Module Metadata will <em>exactly</em> represent the published variants. In particular, all outgoing variants will inherit dependencies, artifacts and attributes of the published configuration.</p>
</li>
<li>
<p>Maven and Ivy metadata files will be generated, but you need to declare how the dependencies are mapped to Maven scopes via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/ConfigurationVariantDetails.html">ConfigurationVariantDetails</a> class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, it means that components created this way can be consumed by Gradle the same way as if they were "local components".</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:publishing_custom_artifacts_to_maven"><a class="anchor" href="#sec:publishing_custom_artifacts_to_maven"></a><a class="link" href="#sec:publishing_custom_artifacts_to_maven">Adding custom artifacts to a publication</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of thinking in terms of artifacts, you should embrace the variant aware model of Gradle.
It is expected that a single module may need multiple artifacts.
However this rarely stops there, if the additional artifacts represent an <a href="#">optional feature</a>, they might also have different dependencies and more.</p>
</div>
<div class="paragraph">
<p>Gradle, via <em>Gradle Module Metadata</em>, supports the publication of <em>additional variants</em> which make those artifacts known to the dependency resolution engine.
Please refer to the <a href="#sec:variant-aware-sharing">variant-aware sharing</a> section of the documentation to see how to declare such variants and <a href="#sec:publishing-custom-components">check out how to publish custom components</a>.</p>
</div>
<div class="paragraph">
<p>If you attach extra artifacts to a publication directly, they are published "out of context".
That means, they are not referenced in the metadata at all and can then only be addressed directly through a classifier on a dependency.
In contrast to Gradle Module Metadata, Maven pom metadata will not contain information on additional artifacts regardless of whether they are added through a variant or directly, as variants cannot be represented in the pom format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following section describes how you publish artifacts directly if you are sure that metadata, for example Gradle or POM metadata, is irrelevant for your use case.
For example, if your project doesn&#8217;t need to be consumed by other projects and the only thing required as result of the publishing are the artifacts themselves.</p>
</div>
<div class="paragraph">
<p>In general, there are two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a publication only with artifacts</p>
</li>
<li>
<p>Add artifacts to a publication based on a component with metadata (not recommended, instead <a href="#sec:adding-variants-to-existing-components">adjust a component</a> or use a <a href="#sec:publishing-custom-components">adhoc component publication</a> which will both also produce metadata fitting your artifacts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a publication based on artifacts, start by defining a custom artifact and attaching it to a Gradle <a href="#sub:terminology_configuration">configuration</a> of your choice.
The following sample defines an RPM artifact that is produced by an <code>rpm</code> task (not shown) and attaches that artifact to the <code>archives</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 416. Defining a custom artifact for a configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> rpmFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/rpms/my-package.rpm</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> rpmArtifact = artifacts.add(<span class="string"><span class="delimiter">'</span><span class="content">archives</span><span class="delimiter">'</span></span>, rpmFile) {
    type <span class="string"><span class="delimiter">'</span><span class="content">rpm</span><span class="delimiter">'</span></span>
    builtBy <span class="string"><span class="delimiter">'</span><span class="content">rpm</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val rpmFile = file(&quot;$buildDir/rpms/my-package.rpm&quot;)
val rpmArtifact = artifacts.add(&quot;archives&quot;, rpmFile) {
    type = &quot;rpm&quot;
    builtBy(&quot;rpm&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>artifacts.add()</code> method from <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.dsl.ArtifactHandler.html">ArtifactHandler</a>  returns an artifact object of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/PublishArtifact.html">PublishArtifact</a> that can then be used in defining a publication, as shown in the following sample:</p>
</div>
<div class="exampleblock">
<div class="title">Example 417. Attaching a custom PublishArtifact to a publication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        maven(MavenPublication) {
            artifact rpmArtifact
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;maven&quot;) {
            artifact(rpmArtifact)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>artifact()</code> method accepts <em>publish artifacts</em> as argument  like <code>rpmArtifact</code> in the sample  as well as any type of argument accepted by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a>, such as a <code>File</code> instance, a string file path or a archive task.</p>
</li>
<li>
<p>Publishing plugins support different artifact configuration properties, so always check the plugin documentation for more details. The <code>classifier</code> and <code>extension</code> properties are supported by both the <a href="#publishing_maven">Maven Publish Plugin</a> and the <a href="#publishing_ivy">Ivy Publish Plugin</a>.</p>
</li>
<li>
<p>Custom artifacts need to be distinct within a publication, typically via a unique combination of <code>classifier</code> and <code>extension</code>. See the documentation for the plugin you&#8217;re using for the precise requirements.</p>
</li>
<li>
<p>If you use <code>artifact()</code> with an archive task, Gradle automatically populates the artifact&#8217;s metadata with the <code>classifier</code> and <code>extension</code> properties from that task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can publish the RPM.</p>
</div>
<div class="paragraph">
<p>If you really want to add an artifact to a publication based on a component, instead of <a href="#sec:adding-variants-to-existing-components">adjusting the component</a> itself, you can combine the <code>from components.someComponent</code> and <code>artifact someArtifact</code> notations.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:publishing_maven:conditional_publishing"><a class="anchor" href="#sec:publishing_maven:conditional_publishing"></a><a class="link" href="#sec:publishing_maven:conditional_publishing">Restricting publications to specific repositories</a></h5>
<div class="paragraph">
<p>When you have defined multiple publications or repositories, you often want to control which publications are published to which repositories. For instance, consider the following sample that defines two publications one that consists of just a binary and another that contains the binary and associated sources and two repositories  one for internal use and one for external consumers:</p>
</div>
<div class="exampleblock">
<div class="title">Example 418. Adding multiple publications and repositories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        binary(MavenPublication) {
            from components.java
        }
        binaryAndSources(MavenPublication) {
            from components.java
            artifact sourcesJar
        }
    }
    repositories {
        <span class="comment">// change URLs to point to your repos, e.g. http://my.org/repo</span>
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">external</span><span class="delimiter">'</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/external</span><span class="delimiter">&quot;</span></span>
        }
        maven {
            name = <span class="string"><span class="delimiter">'</span><span class="content">internal</span><span class="delimiter">'</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/internal</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;binary&quot;) {
            from(components[&quot;java&quot;])
        }
        create&lt;MavenPublication&gt;(&quot;binaryAndSources&quot;) {
            from(components[&quot;java&quot;])
            artifact(tasks[&quot;sourcesJar&quot;])
        }
    }
    repositories {
        // change URLs to point to your repos, e.g. http://my.org/repo
        maven {
            name = &quot;external&quot;
            url = uri(&quot;$buildDir/repos/external&quot;)
        }
        maven {
            name = &quot;internal&quot;
            url = uri(&quot;$buildDir/repos/internal&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The publishing plugins will create tasks that allow you to publish either of the publications to either repository. They also attach those tasks to the <code>publish</code> aggregate task. But let&#8217;s say you want to restrict the binary-only publication to the external repository and the binary-with-sources publication to the internal one. To do that, you need to make the publishing <em>conditional</em>.</p>
</div>
<div class="paragraph">
<p>Gradle allows you to skip any task you want based on a condition via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:onlyIf(org.gradle.api.specs.Spec)">Task.onlyIf(org.gradle.api.specs.Spec)</a> method. The following sample demonstrates how to implement the constraints we just mentioned:</p>
</div>
<div class="exampleblock">
<div class="title">Example 419. Configuring which artifacts should be published to which repositories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(PublishToMavenRepository) {
    onlyIf {
        (repository == publishing.repositories.external &amp;&amp;
            publication == publishing.publications.binary) ||
        (repository == publishing.repositories.internal &amp;&amp;
            publication == publishing.publications.binaryAndSources)
    }
}
tasks.withType(PublishToMavenLocal) {
    onlyIf {
        publication == publishing.publications.binaryAndSources
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;PublishToMavenRepository&gt;().configureEach {
    onlyIf {
        (repository == publishing.repositories[&quot;external&quot;] &amp;&amp;
            publication == publishing.publications[&quot;binary&quot;]) ||
        (repository == publishing.repositories[&quot;internal&quot;] &amp;&amp;
            publication == publishing.publications[&quot;binaryAndSources&quot;])
    }
}
tasks.withType&lt;PublishToMavenLocal&gt;().configureEach {
    onlyIf {
        publication == publishing.publications[&quot;binaryAndSources&quot;]
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle publish</code></div>
<div class="content">
<pre>&gt; gradle publish
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :generateMetadataFileForBinaryAndSourcesPublication
&gt; Task :generatePomFileForBinaryAndSourcesPublication
&gt; Task :sourcesJar
&gt; Task :publishBinaryAndSourcesPublicationToExternalRepository SKIPPED
&gt; Task :publishBinaryAndSourcesPublicationToInternalRepository
&gt; Task :generateMetadataFileForBinaryPublication
&gt; Task :generatePomFileForBinaryPublication
&gt; Task :publishBinaryPublicationToExternalRepository
&gt; Task :publishBinaryPublicationToInternalRepository SKIPPED
&gt; Task :publish

BUILD SUCCESSFUL in 0s
10 actionable tasks: 10 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You may also want to define your own aggregate tasks to help with your workflow. For example, imagine that you have several publications that should be published to the external repository. It could be very useful to publish all of them in one go without publishing the internal ones.</p>
</div>
<div class="paragraph">
<p>The following sample demonstrates how you can do this by defining an aggregate task <code>publishToExternalRepository</code> that depends on all the relevant publish tasks:</p>
</div>
<div class="exampleblock">
<div class="title">Example 420. Defining your own shorthand tasks for publishing</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task publishToExternalRepository {
    group = <span class="string"><span class="delimiter">'</span><span class="content">publishing</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Publishes all Maven publications to the external Maven repository.</span><span class="delimiter">'</span></span>
    dependsOn tasks.withType(PublishToMavenRepository).matching {
        <span class="local-variable">it</span>.repository == publishing.repositories.external
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;publishToExternalRepository&quot;) {
    group = &quot;publishing&quot;
    description = &quot;Publishes all Maven publications to the external Maven repository.&quot;
    dependsOn(tasks.withType&lt;PublishToMavenRepository&gt;().matching {
        it.repository == publishing.repositories[&quot;external&quot;]
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This particular sample automatically handles the introduction or removal of the relevant publishing tasks by using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskCollection.html#withType-java.lang.Class-">TaskCollection.withType(java.lang.Class)</a> with the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a> task type. You can do the same with <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a> if you&#8217;re publishing to Ivy-compatible repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:configuring_publishing_tasks"><a class="anchor" href="#sec:configuring_publishing_tasks"></a><a class="link" href="#sec:configuring_publishing_tasks">Configuring publishing tasks</a></h5>
<div class="paragraph">
<p>The publishing plugins create their non-aggregate tasks after the project has been evaluated, which means you cannot directly reference them from your build script. If you would like to configure any of these tasks, you should use deferred task configuration. This can be done in a number of ways via the project&#8217;s <code>tasks</code> collection.</p>
</div>
<div class="paragraph">
<p>For example, imagine you want to change where the <code>generatePomFileFor<em>PubName</em>Publication</code> tasks write their POM files. You can do this by using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskCollection.html#withType-java.lang.Class-">TaskCollection.withType(java.lang.Class)</a> method, as demonstrated by this sample:</p>
</div>
<div class="exampleblock">
<div class="title">Example 421. Configuring a dynamically named task created by the publishing plugins</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(GenerateMavenPom).all {
    <span class="keyword">def</span> matcher = name =~ <span class="regexp"><span class="delimiter">/</span><span class="content">generatePomFileFor(</span><span class="char">\w</span><span class="content">+)Publication</span><span class="delimiter">/</span></span>
    <span class="keyword">def</span> publicationName = matcher[<span class="integer">0</span>][<span class="integer">1</span>]
    destination = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/poms/</span><span class="inline"><span class="inline-delimiter">${</span>publicationName<span class="inline-delimiter">}</span></span><span class="content">-pom.xml</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;GenerateMavenPom&gt;().configureEach {
    val matcher = Regex(&quot;&quot;&quot;generatePomFileFor(\w+)Publication&quot;&quot;&quot;).matchEntire(name)
    val publicationName = matcher?.let { it.groupValues[1] }
    destination = file(&quot;$buildDir/poms/$publicationName-pom.xml&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above sample uses a regular expression to extract the name of the publication from the name of the task. This is so that there is no conflict between the file paths of all the POM files that might be generated. If you only have one publication, then you don&#8217;t have to worry about such conflicts since there will only be one POM file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dependency_management_terminology"><a class="anchor" href="#dependency_management_terminology"></a><a class="link" href="#dependency_management_terminology">Dependency Management Terminology</a></h4>
<div class="paragraph">
<p>Dependency management comes with a wealth of terminology.
Here you can find the most commonly-used terms including references to the user guide to learn about their practical application.</p>
</div>
<div class="sect4">
<h5 id="sub:terminology_artifact"><a class="anchor" href="#sub:terminology_artifact"></a><a class="link" href="#sub:terminology_artifact">Artifact</a></h5>
<div class="paragraph">
<p>A file or directory produced by a build, such as a JAR, a ZIP distribution, or a native executable.</p>
</div>
<div class="paragraph">
<p>Artifacts are typically designed to be used or consumed by users or other projects, or deployed to hosting systems.
In such cases, the artifact is a single file.
Directories are common in the case of inter-project dependencies to avoid the cost of producing the publishable artifact.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_capability"><a class="anchor" href="#sub:terminology_capability"></a><a class="link" href="#sub:terminology_capability">Capability</a></h5>
<div class="paragraph">
<p>A capability identifies a feature offered by one or multiple components.
A capability is identified by coordinates similar to the coordinates used for <a href="#sub:terminology_module_version">module versions</a>.
By default, each module version offers a capability that matches its coordinates, for example <code>com.google:guava:18.0</code>.
Capabilities can be used to express that a component provides multiple <a href="#sub:terminology_feature_variant">feature variants</a> or that two different components implement the same feature (and thus cannot be used together).
For more details, see the section on <a href="#">capabilities</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_component"><a class="anchor" href="#sub:terminology_component"></a><a class="link" href="#sub:terminology_component">Component</a></h5>
<div class="paragraph">
<p>Any single version of a <a href="#sub:terminology_module">module</a>.</p>
</div>
<div class="paragraph">
<p>For external libraries, the term component refers to one published version of the library.</p>
</div>
<div class="paragraph">
<p>In a build, components are defined by plugins (e.g. the Java Library plugin) and provide a simple way to define a publication for publishing.
They comprise <a href="#sub:terminology_artifact">artifacts</a> as well as the appropriate <a href="#sub:terminology_artifact">metadata</a> that describes a component&#8217;s <a href="#sub:terminology_variant">variants</a> in detail.
For example, the <code>java</code> component in its default setup consists of a JAR produced by the <code>jar</code> task and the dependency information of the Java <em>api</em> and <em>runtime</em> variants.
It may also define additional variants, for example <em>sources</em> and <em>Javadoc</em>, with the corresponding artifacts.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_configuration"><a class="anchor" href="#sub:terminology_configuration"></a><a class="link" href="#sub:terminology_configuration">Configuration</a></h5>
<div class="paragraph">
<p>A configuration is a named set of <a href="#sub:terminology_dependency">dependencies</a> grouped together for a specific goal.
Configurations provide access to the underlying, resolved <a href="#sub:terminology_module">modules</a> and their artifacts.
For more information, see the sections on <a href="#sec:what-are-dependency-configurations">dependency configurations</a> as well as <a href="#sec:resolvable-consumable-configs">resolvable and consumable configurations</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The word "configuration" is an overloaded term and has a different meaning outside of the context of dependency management.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_dependency"><a class="anchor" href="#sub:terminology_dependency"></a><a class="link" href="#sub:terminology_dependency">Dependency</a></h5>
<div class="paragraph">
<p>A dependency is a pointer to another piece of software required to build, test or run a <a href="#sub:terminology_module">module</a>.
For more information, see the section on <a href="#">declaring dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_dependency_constraint"><a class="anchor" href="#sub:terminology_dependency_constraint"></a><a class="link" href="#sub:terminology_dependency_constraint">Dependency constraint</a></h5>
<div class="paragraph">
<p>A dependency constraint defines requirements that need to be met by a module to make it a valid resolution result for the dependency.
For example, a dependency constraint can narrow down the set of supported module versions.
Dependency constraints can be used to express such requirements for transitive dependencies.
For more information, see the sections on <a href="#">upgrading</a> and <a href="#">downgrading</a> transitive dependencies.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_feature_variant"><a class="anchor" href="#sub:terminology_feature_variant"></a><a class="link" href="#sub:terminology_feature_variant">Feature Variant</a></h5>
<div class="paragraph">
<p>A feature variant is a <a href="#sub:terminology_variant">variant</a> representing a feature of a component that can be individually selected or not.
A feature variant is identified by one or more <a href="#sub:terminology_capability">capabilities</a>.
For more information, see the sections on <a href="#">modeling feature variants and optional dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_module"><a class="anchor" href="#sub:terminology_module"></a><a class="link" href="#sub:terminology_module">Module</a></h5>
<div class="paragraph">
<p>A piece of software that evolves over time e.g. <a href="https://github.com/google/guava">Google Guava</a>.
Every module has a name. Each release of a module is optimally represented by a <a href="#sub:terminology_module_version">module version</a>.
For convenient consumption, modules can be hosted in a <a href="#sub:terminology_repository">repository</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_module_metadata"><a class="anchor" href="#sub:terminology_module_metadata"></a><a class="link" href="#sub:terminology_module_metadata">Module metadata</a></h5>
<div class="paragraph">
<p>Releases of a <a href="#sub:terminology_module">module</a> provide metadata.
Metadata is the data that describes the module in more detail e.g. information about the location of artifacts or required <a href="#sub:terminology_transitive_dependency">transitive dependencies</a>.
Gradle offers its own metadata format called <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> (<code>.module</code> file) but also supports Maven (<code>.pom</code>) and Ivy (<code>ivy.xml</code>) metadata.
See the section on <a href="#">understanding Gradle Module Metadata</a> for more information on the supported metadata formats.</p>
</div>
</div>
<div class="sect4">
<h5 id="component_metadata_rule"><a class="anchor" href="#component_metadata_rule"></a><a class="link" href="#component_metadata_rule">Component metadata rule</a></h5>
<div class="paragraph">
<p>A component metadata rule is a rule that modifies a component&#8217;s metadata after it was fetched from a repository, e.g. to add missing information or to correct wrong information.
In contrast to <a href="#sub:terminology_resolution_rule">resolution rules</a>, component metadata rules are applied <strong>before</strong> resolution starts.
Component metadata rules are defined as part of the build logic and can be shared through plugins.
For more information, see the section on <a href="#">fixing metadata with component metadata rules</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_module_version"><a class="anchor" href="#sub:terminology_module_version"></a><a class="link" href="#sub:terminology_module_version">Module version</a></h5>
<div class="paragraph">
<p>A module version represents a distinct set of changes of a released <a href="#sub:terminology_module">module</a>.
For example <code>18.0</code> represents the version of the module with the coordinates <code>com.google:guava:18.0</code>.
In practice there&#8217;s no limitation to the scheme of the module version.
Timestamps, numbers, special suffixes like <code>-GA</code> are all allowed identifiers.
The most widely-used versioning strategy is <a href="https://semver.org/">semantic versioning</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub::terminology_platform"><a class="anchor" href="#sub::terminology_platform"></a><a class="link" href="#sub::terminology_platform">Platform</a></h5>
<div class="paragraph">
<p>A platform is a set of modules aimed to be used together. There are different categories of platforms, corresponding to different use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>module set: often a set of modules published together as a whole. Using one module of the set often means we want to use the same version for all modules of the set. For example, if using <code>groovy</code> 1.2, also use <code>groovy-json</code> 1.2.</p>
</li>
<li>
<p>runtime environment: a set of libraries known to work well together. e.g., the Spring Platform, recommending versions for both Spring and components that work well with Spring.</p>
</li>
<li>
<p>deployment environment: Java runtime, application server, &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition Gradle defines <a href="#sec:virtual_platform">virtual platforms</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Maven&#8217;s BOM (bill-of-material) is a popular kind of platform that <a href="#sub:bom_import">Gradle supports</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_publication"><a class="anchor" href="#sub:terminology_publication"></a><a class="link" href="#sub:terminology_publication">Publication</a></h5>
<div class="paragraph">
<p>A description of the files and metadata that should be published to a repository as a single entity for use by consumers.</p>
</div>
<div class="paragraph">
<p>A publication has a name and consists of one or more artifacts plus information about those artifacts (the <a href="#sub:terminology_module_metadata">metadata</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_repository"><a class="anchor" href="#sub:terminology_repository"></a><a class="link" href="#sub:terminology_repository">Repository</a></h5>
<div class="paragraph">
<p>A repository hosts a set of <a href="#sub:terminology_module">modules</a>, each of which may provide one or many releases (components) indicated by a <a href="#sub:terminology_module_version">module version</a>.
The repository can be based on a binary repository product (e.g. Artifactory or Nexus) or a directory structure in the filesystem.
For more information, see <a href="#">Declaring Repositories</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_resolution_rule"><a class="anchor" href="#sub:terminology_resolution_rule"></a><a class="link" href="#sub:terminology_resolution_rule">Resolution rule</a></h5>
<div class="paragraph">
<p>A resolution rule influences the behavior of how a <a href="#sub:terminology_dependency">dependency</a> is resolved directly.
Resolution rules are defined as part of the build logic.
For more information, see the section on <a href="#">customizing resolution of a dependency directly</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_transitive_dependency"><a class="anchor" href="#sub:terminology_transitive_dependency"></a><a class="link" href="#sub:terminology_transitive_dependency">Transitive dependency</a></h5>
<div class="paragraph">
<p>A variant of a <a href="#sub:terminology_component">component</a> can have dependencies on other modules to work properly, so-called transitive dependencies.
Releases of a module hosted on a <a href="#sub:terminology_repository">repository</a> can provide <a href="#sub:terminology_module_metadata">metadata</a> to declare those transitive dependencies.
By default, Gradle resolves transitive dependencies automatically.
The version selection for transitive dependencies can be influenced by declaring <a href="#">dependency constraints</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_variant"><a class="anchor" href="#sub:terminology_variant"></a><a class="link" href="#sub:terminology_variant">Variant (of a component)</a></h5>
<div class="paragraph">
<p>Each <a href="#sub:terminology_component">component</a> consists of one or more variants.
A variant consists of a set of artifacts and defines a set of dependencies.
It is identified by a set of <a href="#sub:terminology_attribute">attributes</a> and <a href="#sub:terminology_capability">capabilities</a>.</p>
</div>
<div class="paragraph">
<p>Gradle&#8217;s dependency resolution is variant-aware and selects one or more variants of each component after a component (i.e. one version of a module) has been selected.
It may also fail if the variant selection result is ambiguous, meaning that Gradle does not have enough information to select one of multiple mutual exclusive variants.
In that case, more information can be provided through <a href="#sub:terminology_attribute">variant attributes</a>.
Examples of variants each Java components typically offers are <em>api</em> and <em>runtime</em> variants.
Others examples are JDK8 and JDK11 variants.
For more information, see the section on <a href="#">variant selection</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:terminology_attribute"><a class="anchor" href="#sub:terminology_attribute"></a><a class="link" href="#sub:terminology_attribute">Variant Attribute</a></h5>
<div class="paragraph">
<p>Attributes are used to identify and select <a href="#sub:terminology_variant">variants</a>.
A variant has one or more attributes defined, for example <code>org.gradle.usage=java-api</code>, <code>org.gradle.jvm.version=11</code>.
When dependencies are resolved, a set of attributes are requested and Gradle finds the best fitting variant(s) for each component in the dependency graph.
Compatibility and disambiguation rules can be implemented for an attribute to express compatibility between values (e.g. Java 8 is compatible with Java 11, but Java 11 should be preferred if the requested version is 11 or higher).
Such rules are typically provided by plugins.
For more information, see the sections on <a href="#">variant selection</a> and <a href="#">declaring attributes</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:jvm_projects"><a class="anchor" href="#part:jvm_projects"></a><a class="link" href="#part:jvm_projects">Java &amp; Other JVM Projects</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="building_java_projects"><a class="anchor" href="#building_java_projects"></a><a class="link" href="#building_java_projects">Building Java &amp; JVM projects</a></h3>
<div class="paragraph">
<p>Gradle uses a convention-over-configuration approach to building JVM-based projects that borrows several conventions from Apache Maven. In particular, it uses the same default directory structure for source files and resources, and it works with Maven-compatible repositories.</p>
</div>
<div class="paragraph">
<p>We will look at Java projects in detail in this chapter, but most of the topics apply to other supported JVM languages as well, such as <a href="https://guides.gradle.org/building-kotlin-jvm-libraries/">Kotlin</a>, <a href="#groovy_plugin">Groovy</a> and <a href="#scala_plugin">Scala</a>.
If you don&#8217;t have much experience with building JVM-based projects with Gradle, take a look at the <a href="https://guides.gradle.org/?q=JVM">Java tutorials</a> for step-by-step instructions on how to build various types of basic Java projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The example in this section use the Java Library Plugin.
However the described features are shared by all JVM plugins.
Specifics of the different plugins are available in their dedicated documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">Introduction</a></h4>
<div class="paragraph">
<p>The simplest build script for a Java project applies the <a href="#">Java Library Plugin</a> and optionally sets the project version and Java compatibility versions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 422. Applying the Java Library Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

version = &quot;1.2.1&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By applying the Java Library Plugin, you get a whole host of features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>compileJava</code> task that compiles all the Java source files under <em>src/main/java</em></p>
</li>
<li>
<p>A <code>compileTestJava</code> task for source files under <em>src/test/java</em></p>
</li>
<li>
<p>A <code>test</code> task that runs the tests from <em>src/test/java</em></p>
</li>
<li>
<p>A <code>jar</code> task that packages the <code>main</code> compiled classes and resources from <em>src/main/resources</em> into a single JAR named <em>&lt;project&gt;-&lt;version&gt;.jar</em></p>
</li>
<li>
<p>A <code>javadoc</code> task that generates Javadoc for the <code>main</code> classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This isn&#8217;t sufficient to build any non-trivial Java project  at the very least, you&#8217;ll probably have some file dependencies. But it means that your build script only needs the information that is specific to <em>your</em> project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Although the properties in the example are optional, we recommend that you specify them in your projects. The compatibility options mitigate against problems with the project being built with different Java compiler versions, and the version string is important for tracking the progression of the project. The project version is also used in archive names by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Java Library Plugin also integrates the above tasks into the standard <a href="#sec:base_tasks">Base Plugin lifecycle tasks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jar</code> is attached to <code>assemble</code> <sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup></p>
</li>
<li>
<p><code>test</code> is attached to <code>check</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest of the chapter explains the different avenues for customizing the build to your requirements. You will also see later how to adjust the build for libraries, applications, web apps and enterprise apps.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_source_sets"><a class="anchor" href="#sec:java_source_sets"></a><a class="link" href="#sec:java_source_sets">Declaring your source files via source sets</a></h4>
<div class="paragraph">
<p>Gradle&#8217;s Java support was the first to introduce a new concept for building source-based projects: <em>source sets</em>. The main idea is that source files and resources are often logically grouped by type, such as application code, unit tests and integration tests. Each logical group typically has its own sets of file dependencies, classpaths, and more. Significantly, the files that form a source set <em>don&#8217;t have to be located in the same directory</em>!</p>
</div>
<div class="paragraph">
<p>Source sets are a powerful concept that tie together several aspects of compilation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the source files and where they&#8217;re located</p>
</li>
<li>
<p>the compilation classpath, including any required dependencies (via Gradle <a href="#sub:terminology_configuration">configurations</a>)</p>
</li>
<li>
<p>where the compiled class files are placed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see how these relate to one another in this diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-sourcesets-compilation.png" alt="java sourcesets compilation">
</div>
<div class="title">Figure 25. Source sets and Java compilation</div>
</div>
<div class="paragraph">
<p>The shaded boxes represent properties of the source set itself.
On top of that, the Java Library Plugin automatically creates a compilation task for every source set you or a plugin defines  named <code>compile<em>SourceSet</em>Java</code>  and several <a href="#java_source_set_configurations">dependency configurations</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">The <code>main</code> source set</div>
<div class="paragraph">
<p>Most language plugins, Java included, automatically create a source set called <code>main</code>, which is used for the project&#8217;s production code. This source set is special in that its name is not included in the names of the configurations and tasks, hence why you have just a <code>compileJava</code> task and <code>compileOnly</code> and <code>implementation</code> configurations rather than <code>compileMainJava</code>, <code>mainCompileOnly</code> and <code>mainImplementation</code> respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Java projects typically include resources other than source files, such as properties files, that may need processing  for example by replacing tokens within the files  and packaging within the final JAR.
The Java Library Plugin handles this by automatically creating a dedicated task for each defined source set called <code>process<em>SourceSet</em>Resources</code> (or <code>processResources</code> for the <code>main</code> source set).
The following diagram shows how the source set fits in with this task:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-sourcesets-process-resources.png" alt="java sourcesets process resources">
</div>
<div class="title">Figure 26. Processing non-source files for a source set</div>
</div>
<div class="paragraph">
<p>As before, the shaded boxes represent properties of the source set, which in this case comprises the locations of the resource files and where they are copied to.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>main</code> source set, the Java Library Plugin defines a <code>test</code> source set that represents the project&#8217;s tests.
This source set is used by the <code>test</code> task, which runs the tests.
You can learn more about this task and related topics in the <a href="#java_testing">Java testing</a> chapter.</p>
</div>
<div class="paragraph">
<p>Projects typically use this source set for unit tests, but you can also use it for integration, acceptance and other types of test if you wish.
The alternative approach is to <a href="#sec:custom_java_source_sets">define a new source set</a> for each of your other test types, which is typically done for one or both of the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You want to keep the tests separate from one another for aesthetics and manageability</p>
</li>
<li>
<p>The different test types require different compilation or runtime classpaths or some other difference in setup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see an example of this approach in the Java testing chapter, which shows you <a href="#sec:configuring_java_integration_tests">how to set up integration tests</a> in a project.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll learn more about source sets and the features they provide in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sec:custom_java_source_set_paths">Customizing file and directory locations</a></p>
</li>
<li>
<p><a href="#sec:configuring_java_integration_tests">Configuring Java integration tests</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_dependency_management_overview"><a class="anchor" href="#sec:java_dependency_management_overview"></a><a class="link" href="#sec:java_dependency_management_overview">Managing your dependencies</a></h4>
<div class="paragraph">
<p>The vast majority of Java projects rely on libraries, so managing a project&#8217;s dependencies is an important part of building a Java project.
Dependency management is a big topic, so we will focus on the basics for Java projects here.
If you&#8217;d like to dive into the detail, check out the <a href="#">introduction to dependency management</a>.</p>
</div>
<div class="paragraph">
<p>Specifying the dependencies for your Java project requires just three pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Which dependency you need, such as a name and version</p>
</li>
<li>
<p>What it&#8217;s needed for, e.g. compilation or running</p>
</li>
<li>
<p>Where to look for it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two are specified in a <code>dependencies {}</code> block and the third in a <code>repositories {}</code> block. For example, to tell Gradle that your project requires version 3.6.7 of <a href="http://hibernate.org/">Hibernate</a> Core to compile and run your production code, and that you want to download the library from the Maven Central repository, you can use the following fragment:</p>
</div>
<div class="exampleblock">
<div class="title">Example 423. Declaring dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Gradle terminology for the three elements is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Repository</em> (ex: <code>mavenCentral()</code>)  where to look for the modules you declare as dependencies</p>
</li>
<li>
<p><em>Configuration</em> (ex: <code>implementation</code>)  a named collection of dependencies, grouped together for a specific goal such as compiling or running a module a more flexible form of Maven scopes</p>
</li>
<li>
<p><em>Module coordinate</em> (ex: <code>org.hibernate:hibernate-core-3.6.7.Final</code>)  the ID of the dependency, usually in the form '<em>&lt;group&gt;</em>:<em>&lt;module&gt;</em>:<em>&lt;version&gt;</em>' (or '<em>&lt;groupId&gt;</em>:<em>&lt;artifactId&gt;</em>:<em>&lt;version&gt;</em>' in Maven terminology)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a more comprehensive glossary of dependency management terms <a href="#">here</a>.</p>
</div>
<div class="paragraph">
<p>As far as configurations go, the main ones of interest are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compileOnly</code> for dependencies that are necessary to compile your production code but shouldn&#8217;t be part of the runtime classpath</p>
</li>
<li>
<p><code>implementation</code> (supersedes <code>compile</code>) used for compilation and runtime</p>
</li>
<li>
<p><code>runtimeOnly</code> (supersedes <code>runtime</code>)  only used at runtime, not for compilation</p>
</li>
<li>
<p><code>testCompileOnly</code>  same as <code>compileOnly</code> except it&#8217;s for the tests</p>
</li>
<li>
<p><code>testImplementation</code> test equivalent of <code>implementation</code></p>
</li>
<li>
<p><code>testRuntimeOnly</code> test equivalent of <code>runtimeOnly</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about these and how they relate to one another in the <a href="#sec:java_plugin_and_dependency_management">plugin reference chapter</a>.</p>
</div>
<div class="paragraph">
<p>Be aware that the <a href="#java_library_plugin">Java Library Plugin</a> creates an additional configuration  <code>api</code>  for dependencies that are required for compiling both the module and any modules that depend on it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Why no <code>compile</code> configuration?</div>
<div class="paragraph">
<p>The Java Library Plugin has historically used the <code>compile</code> configuration for dependencies that are required to both compile and run a project&#8217;s production code.
It is now deprecated, and will issue warnings when used, because it doesn&#8217;t distinguish between dependencies that impact the public API of a Java library project and those that don&#8217;t.
You can learn more about the importance of this distinction in <a href="#sec:building_java_libraries">Building Java libraries</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have only scratched the surface here, so we recommend that you read the dedicated dependency management chapters once you&#8217;re comfortable with the basics of building Java projects with Gradle. Some common scenarios that require further reading include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defining a custom <a href="#sec:maven_repo">Maven-</a> or <a href="#sec:ivy_repositories">Ivy-compatible</a> repository</p>
</li>
<li>
<p>Using dependencies from a <a href="#sub:flat_dir_resolver">local filesystem directory</a></p>
</li>
<li>
<p>Declaring dependencies with <a href="#sub:declaring_dependency_with_changing_version">changing</a> (e.g. SNAPSHOT) and <a href="#sub:declaring_dependency_with_dynamic_version">dynamic</a> (range) versions</p>
</li>
<li>
<p>Declaring a sibling <a href="#sub:project_dependencies">project as a dependency</a></p>
</li>
<li>
<p><a href="#">Controlling transitive dependencies and their versions</a></p>
</li>
<li>
<p>Testing your fixes to a 3rd-party dependency via <a href="#composite_builds">composite builds</a> (a better alternative to publishing to and consuming from <a href="#sub:maven_local">Maven Local</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You&#8217;ll discover that Gradle has a rich API for working with dependencies one that takes time to master, but is straightforward to use for common scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:compile"><a class="anchor" href="#sec:compile"></a><a class="link" href="#sec:compile">Compiling your code</a></h4>
<div class="paragraph">
<p>Compiling both your production and test code can be trivially easy if you follow the conventions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put your production source code under the <em>src/main/java</em> directory</p>
</li>
<li>
<p>Put your test source code under <em>src/test/java</em></p>
</li>
<li>
<p>Declare your production compile dependencies in the <code>compileOnly</code> or <code>implementation</code> configurations (see previous section)</p>
</li>
<li>
<p>Declare your test compile dependencies in the <code>testCompileOnly</code> or <code>testImplementation</code> configurations</p>
</li>
<li>
<p>Run the <code>compileJava</code> task for the production code and <code>compileTestJava</code> for the tests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Other JVM language plugins, such as the one for <a href="#groovy_plugin">Groovy</a>, follow the same pattern of conventions. We recommend that you follow these conventions wherever possible, but you don&#8217;t have to. There are several options for customization, as you&#8217;ll see next.</p>
</div>
<div class="sect4">
<h5 id="sec:custom_java_source_set_paths"><a class="anchor" href="#sec:custom_java_source_set_paths"></a><a class="link" href="#sec:custom_java_source_set_paths">Customizing file and directory locations</a></h5>
<div class="paragraph">
<p>Imagine you have a legacy project that uses an <em>src</em> directory for the production code and <em>test</em> for the test code. The conventional directory structure won&#8217;t work, so you need to tell Gradle where to find the source files. You do that via source set configuration.</p>
</div>
<div class="paragraph">
<p>Each source set defines where its source code resides, along with the resources and the output directory for the class files. You can override the convention values by using the following syntax:</p>
</div>
<div class="exampleblock">
<div class="title">Example 424. Declaring custom source directories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
         java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>]
         }
    }

    test {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java {
            setSrcDirs(listOf(&quot;src&quot;))
        }
    }

    test {
        java {
            setSrcDirs(listOf(&quot;test&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now Gradle will only search directly in <em>src</em> and <em>test</em> for the respective source code. What if you don&#8217;t want to override the convention, but simply want to <em>add</em> an extra source directory, perhaps one that contains some third-party source code you want to keep separate? The syntax is similar:</p>
</div>
<div class="exampleblock">
<div class="title">Example 425. Declaring custom source directories additively</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">thirdParty/src/main/java</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java {
            srcDir(&quot;thirdParty/src/main/java&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Crucially, we&#8217;re using the <em>method</em> <code>srcDir()</code> here to append a directory path, whereas setting the <code>srcDirs</code> property replaces any existing values. This is a common convention in Gradle: setting a property replaces values, while the corresponding method appends values.</p>
</div>
<div class="paragraph">
<p>You can see all the properties and methods available on source sets in the DSL reference for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSet.html">SourceSet</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a>. Note that <code>srcDirs</code> and <code>srcDir()</code> are both on <code>SourceDirectorySet</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="changing_compiler_options"><a class="anchor" href="#changing_compiler_options"></a><a class="link" href="#changing_compiler_options">Changing compiler options</a></h5>
<div class="paragraph">
<p>Most of the compiler options are accessible through the corresponding task, such as <code>compileJava</code> and <code>compileTestJava</code>. These tasks are of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>, so read the task reference for an up-to-date and comprehensive list of the options.</p>
</div>
<div class="paragraph">
<p>For example, if you want to use a separate JVM process for the compiler and prevent compilation failures from failing the build, you can use this configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 426. Setting Java compiler options</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compileJava {
    options.incremental = <span class="predefined-constant">true</span>
    options.fork = <span class="predefined-constant">true</span>
    options.failOnError = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.compileJava {
    options.isIncremental = true
    options.isFork = true
    options.isFailOnError = false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s also how you can change the verbosity of the compiler, disable debug output in the byte code and configure where the compiler can find annotation processors.</p>
</div>
<div class="paragraph">
<p>Two common options for the Java compiler are defined at the project level:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>sourceCompatibility</code></dt>
<dd>
<p>Defines which language version of Java your source files should be treated as.</p>
</dd>
<dt class="hdlist1"><code>targetCompatibility</code></dt>
<dd>
<p>Defines the minimum JVM version your code should run on, i.e. it determines the version of byte code the compiler generates.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you need or want more than one compilation task for any reason, you can either <a href="#sec:custom_java_source_sets">create a new source set</a> or simply define a new task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a>. We look at setting up a new source set next.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_cross_compilation"><a class="anchor" href="#sec:java_cross_compilation"></a><a class="link" href="#sec:java_cross_compilation">Compiling and testing Java 6/7</a></h5>
<div class="paragraph">
<p>Gradle can only run on Java version 8 or higher.</p>
</div>
<div class="paragraph">
<p>Gradle still supports compiling, testing, generating Javadoc and executing applications for Java 6 and Java 7. Java 5 is not supported.</p>
</div>
<div class="paragraph">
<p>To use Java 6 or Java 7, the following tasks need to be configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JavaCompile</code> task to fork and use the correct Java home</p>
</li>
<li>
<p><code>Javadoc</code> task to use the correct <code>javadoc</code> executable</p>
</li>
<li>
<p><code>Test</code> and the <code>JavaExec</code> task to use the correct <code>java</code> executable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sample shows how the <code>build.gradle</code> needs to be adjusted. In order to be able to make the build machine-independent, the location of the old Java home and target version should be configured in <code>GRADLE_USER_HOME/gradle.properties</code> <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup> in the user&#8217;s home directory on each developer machine, as shown in the example.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configure_java_7_build"><a class="anchor" href="#example_configure_java_7_build"></a><a class="link" href="#example_configure_java_7_build">Example: Configure Java 7 build</a></h5>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># in $HOME/.gradle/gradle.properties
javaHome=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home
targetJavaVersion=1.7</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">javaHome</span><span class="delimiter">'</span></span>): <span class="string"><span class="delimiter">&quot;</span><span class="content">Set the property 'javaHome' in your your gradle.properties pointing to a Java 6 or 7 installation</span><span class="delimiter">&quot;</span></span>
<span class="keyword">assert</span> hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">targetJavaVersion</span><span class="delimiter">'</span></span>): <span class="string"><span class="delimiter">&quot;</span><span class="content">Set the property 'targetJavaVersion' in your your gradle.properties to '1.6' or '1.7'</span><span class="delimiter">&quot;</span></span>

java {
    sourceCompatibility = JavaVersion.toVersion(targetJavaVersion)
}

<span class="keyword">def</span> javaExecutablesPath = <span class="keyword">new</span> <span class="predefined-type">File</span>(javaHome, <span class="string"><span class="delimiter">'</span><span class="content">bin</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> javaExecutables = [:].withDefault { execName -&gt;
    <span class="keyword">def</span> executable = <span class="keyword">new</span> <span class="predefined-type">File</span>(javaExecutablesPath, execName)
    <span class="keyword">assert</span> executable.exists(): <span class="string"><span class="delimiter">&quot;</span><span class="content">There is no </span><span class="inline"><span class="inline-delimiter">${</span>execName<span class="inline-delimiter">}</span></span><span class="content"> executable in </span><span class="inline"><span class="inline-delimiter">${</span>javaExecutablesPath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    executable
}
tasks.withType(AbstractCompile) {
    options.with {
        fork = <span class="predefined-constant">true</span>
        forkOptions.javaHome = file(javaHome)
    }
}
tasks.withType(Javadoc) {
    executable = javaExecutables.javadoc
}
tasks.withType(Test) {
    executable = javaExecutables.java
}
tasks.withType(JavaExec) {
    executable = javaExecutables.java
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">require(hasProperty(&quot;javaHome&quot;)) { &quot;Set the property 'javaHome' in your your gradle.properties pointing to a Java 6 or 7 installation&quot; }
require(hasProperty(&quot;targetJavaVersion&quot;)) { &quot;Set the property 'targetJavaVersion' in your your gradle.properties to '1.6' or '1.7'&quot; }

val javaHome: String by project
val targetJavaVersion: String by project

java {
    sourceCompatibility = JavaVersion.toVersion(targetJavaVersion)
}

val javaExecutablesPath = File(javaHome, &quot;bin&quot;)
fun javaExecutable(execName: String): String {
    val executable = File(javaExecutablesPath, execName)
    require(executable.exists()) { &quot;There is no ${execName} executable in ${javaExecutablesPath}&quot; }
    return executable.toString()
}
tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.apply {
        isFork = true
        forkOptions.javaHome = file(javaHome)
    }
}
tasks.withType&lt;Javadoc&gt;().configureEach {
    executable = javaExecutable(&quot;javadoc&quot;)
}
tasks.withType&lt;Test&gt;().configureEach {
    executable = javaExecutable(&quot;java&quot;)
}
tasks.withType&lt;JavaExec&gt;().configureEach {
    executable = javaExecutable(&quot;java&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_java_source_sets"><a class="anchor" href="#sec:custom_java_source_sets"></a><a class="link" href="#sec:custom_java_source_sets">Compiling independent sources separately</a></h5>
<div class="paragraph">
<p>Most projects have at least two independent sets of sources: the production code and the test code. Gradle already makes this scenario part of its Java convention, but what if you have other sets of sources? One of the most common scenarios is when you have separate integration tests of some form or other. In that case, a custom source set may be just what you need.</p>
</div>
<div class="paragraph">
<p>You can see a complete example for setting up integration tests in the <a href="#sec:configuring_java_integration_tests">Java testing chapter</a>. You can set up other source sets that fulfil different roles in the same way. The question then becomes: when should you define a custom source set?</p>
</div>
<div class="paragraph">
<p>To answer that question, consider whether the sources:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Need to be compiled with a unique classpath</p>
</li>
<li>
<p>Generate classes that are handled differently from the <code>main</code> and <code>test</code> ones</p>
</li>
<li>
<p>Form a natural part of the project</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If your answer to both 3 and either one of the others is yes, then a custom source set is probably the right approach. For example, integration tests are typically part of the project because they test the code in <code>main</code>. In addition, they often have either their own dependencies independent of the <code>test</code> source set or they need to be run with a custom <code>Test</code> task.</p>
</div>
<div class="paragraph">
<p>Other common scenarios are less clear cut and may have better solutions. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Separate API and implementation JARs it may make sense to have these as separate projects, particularly if you already have a multi-project build</p>
</li>
<li>
<p>Generated sources if the resulting sources should be compiled with the production code, add their path(s) to the <code>main</code> source set and make sure that the <code>compileJava</code> task depends on the task that generates the sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re unsure whether to create a custom source set or not, then go ahead and do so. It should be straightforward and if it&#8217;s not, then it&#8217;s probably not the right tool for the job.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_resources"><a class="anchor" href="#sec:java_resources"></a><a class="link" href="#sec:java_resources">Managing resources</a></h4>
<div class="paragraph">
<p>Many Java projects make use of resources beyond source files, such as images, configuration files and localization data.
Sometimes these files simply need to be packaged unchanged and sometimes they need to be processed as template files or in some other way.
Either way, the Java Library Plugin adds a specific <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a> task for each source set that handles the processing of its associated resources.</p>
</div>
<div class="paragraph">
<p>The task&#8217;s name follows the convention of <code>process<em>SourceSet</em>Resources</code> or <code>processResources</code> for the <code>main</code> source set and it will automatically copy any files in <em>src/[sourceSet]/resources</em> to a directory that will be included in the production JAR. This target directory will also be included in the runtime classpath of the tests.</p>
</div>
<div class="paragraph">
<p>Since <code>processResources</code> is an instance of the <code>Copy</code> task, you can perform any of the processing described in the <a href="#sec:copying_files">Working With Files</a> chapter.</p>
</div>
<div class="sect4">
<h5 id="sec:properties_files"><a class="anchor" href="#sec:properties_files"></a><a class="link" href="#sec:properties_files">Java properties files and reproducible builds</a></h5>
<div class="paragraph">
<p>You can easily create Java properties files via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.WriteProperties.html">WriteProperties</a> task, which fixes a well-known problem with <code>Properties.store()</code> that can reduce the usefulness of <a href="#sec:up_to_date_checks">incremental builds</a>.</p>
</div>
<div class="paragraph">
<p>The standard Java API for writing properties files produces a unique file every time, even when the same properties and values are used, because it includes a timestamp in the comments. Gradle&#8217;s <code>WriteProperties</code> task generates exactly the same output byte-for-byte if none of the properties have changed. This is achieved by a few tweaks to how a properties file is generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>no timestamp comment is added to the output</p>
</li>
<li>
<p>the line separator is system independent, but can be configured explicitly (it defaults to <code>'\n'</code>)</p>
</li>
<li>
<p>the properties are sorted alphabetically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sometimes it can be desirable to recreate archives in a byte for byte way on different machines. You want to be sure that building an artifact from source code produces the same result, byte for byte, no matter when and where it is built. This is necessary for projects like reproducible-builds.org.</p>
</div>
<div class="paragraph">
<p>These tweaks not only lead to better incremental build integration, but they also help with <a href="https://reproducible-builds.org">reproducible builds</a>. In essence, reproducible builds guarantee that you will see the same results from a build execution  including test results and production binaries no matter when or on what system you run it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:running_java_tests"><a class="anchor" href="#sec:running_java_tests"></a><a class="link" href="#sec:running_java_tests">Running tests</a></h4>
<div class="paragraph">
<p>Alongside providing automatic compilation of unit tests in <em>src/test/java</em>, the Java Library Plugin has native support for running tests that use JUnit 3, 4 &amp; 5 (JUnit 5 support <a href="https://docs.gradle.org/4.6/release-notes.html#junit-5-support">came in Gradle 4.6</a>) and TestNG.
You get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An automatic <code>test</code> task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>, using the <code>test</code> source set</p>
</li>
<li>
<p>An HTML test report that includes the results from <em>all</em> <code>Test</code> tasks that run</p>
</li>
<li>
<p>Easy filtering of which tests to run</p>
</li>
<li>
<p>Fine-grained control over how the tests are run</p>
</li>
<li>
<p>The opportunity to create your own test execution and test reporting tasks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You do <em>not</em> get a <code>Test</code> task for every source set you declare, since not every source set represents tests! That&#8217;s why you typically need to <a href="#sec:custom_java_source_sets">create your own <code>Test</code> tasks</a> for things like integration and acceptance tests if they can&#8217;t be included with the <code>test</code> source set.</p>
</div>
<div class="paragraph">
<p>As there is a lot to cover when it comes to testing, the topic has its <a href="#java_testing">own chapter</a> in which we look at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How tests are run</p>
</li>
<li>
<p>How to run a subset of tests via filtering</p>
</li>
<li>
<p>How Gradle discovers tests</p>
</li>
<li>
<p>How to configure test reporting and add your own reporting tasks</p>
</li>
<li>
<p>How to make use of specific JUnit and TestNG features</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also learn more about configuring tests in the DSL reference for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_packaging"><a class="anchor" href="#sec:java_packaging"></a><a class="link" href="#sec:java_packaging">Packaging and publishing</a></h4>
<div class="paragraph">
<p>How you package and potentially publish your Java project depends on what type of project it is.
Libraries, applications, web applications and enterprise applications all have differing requirements.
In this section, we will focus on the bare bones provided by the Java Library Plugin.</p>
</div>
<div class="paragraph">
<p>By default, the Java Library Plugin provides the <code>jar</code> task that packages all the compiled production classes and resources into a single JAR.
This JAR is also automatically built by the <code>assemble</code> task.
Furthermore, the plugin can be configured to provide the <code>javadocJar</code> and <code>sourcesJar</code> tasks to package Javadoc and source code if so desired.
If a publishing plugin is used, these tasks will automatically run during publishing or can be called directly.</p>
</div>
<div class="exampleblock">
<div class="title">Example 427. Configure a project to publish Javadoc and sources</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    withJavadocJar()
    withSourcesJar()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    withJavadocJar()
    withSourcesJar()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to create an 'uber' (AKA 'fat') JAR, then you can use a task definition like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 428. Creating a Java uber or fat JAR</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-io:commons-io:2.6</span><span class="delimiter">'</span></span>
}

task uberJar(<span class="key">type</span>: Jar) {
    archiveClassifier = <span class="string"><span class="delimiter">'</span><span class="content">uber</span><span class="delimiter">'</span></span>

    from sourceSets.main.output

    dependsOn configurations.runtimeClasspath
    from {
        configurations.runtimeClasspath.findAll { <span class="local-variable">it</span>.name.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>) }.collect { zipTree(<span class="local-variable">it</span>) }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}

version = &quot;1.0.0&quot;

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;commons-io:commons-io:2.6&quot;)
}

tasks.register&lt;Jar&gt;(&quot;uberJar&quot;) {
    archiveClassifier.set(&quot;uber&quot;)

    from(sourceSets.main.get().output)

    dependsOn(configurations.runtimeClasspath)
    from({
        configurations.runtimeClasspath.get().filter { it.name.endsWith(&quot;jar&quot;) }.map { zipTree(it) }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a> for more details on the configuration options available to you.
And note that you need to use <code>archiveClassifier</code> rather than <code>archiveAppendix</code> here for correct publication of the JAR.</p>
</div>
<div class="paragraph">
<p>You can use one of the publishing plugins to publish the JARs created by a Java project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#publishing_maven">Maven Publish Plugin</a></p>
</li>
<li>
<p><a href="#publishing_ivy">Ivy Publish Plugin</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:jar_manifest"><a class="anchor" href="#sec:jar_manifest"></a><a class="link" href="#sec:jar_manifest">Modifying the JAR manifest</a></h5>
<div class="paragraph">
<p>Each instance of the <code>Jar</code>, <code>War</code> and <code>Ear</code> tasks has a <code>manifest</code> property that allows you to customize the <em>MANIFEST.MF</em> file that goes into the corresponding archive. The following example demonstrates how to set attributes in the JAR&#8217;s manifest:</p>
</div>
<div class="exampleblock">
<div class="title">Example 429. Customization of MANIFEST.MF</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
    manifest {
        attributes(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gradle</span><span class="delimiter">&quot;</span></span>,
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Version</span><span class="delimiter">&quot;</span></span>: archiveVersion)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar {
    manifest {
        attributes(
            &quot;Implementation-Title&quot; to &quot;Gradle&quot;,
            &quot;Implementation-Version&quot; to archiveVersion
        )
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/java/archives/Manifest.html">Manifest</a> for the configuration options it provides.</p>
</div>
<div class="paragraph">
<p>You can also create standalone instances of <code>Manifest</code>. One reason for doing so is to share manifest information between JARs. The following example demonstrates how to share common attributes between JARs:</p>
</div>
<div class="exampleblock">
<div class="title">Example 430. Creating a manifest object.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.sharedManifest = manifest {
    attributes(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gradle</span><span class="delimiter">&quot;</span></span>,
               <span class="string"><span class="delimiter">&quot;</span><span class="content">Implementation-Version</span><span class="delimiter">&quot;</span></span>: version)
}
task fooJar(<span class="key">type</span>: Jar) {
    manifest = project.manifest {
        from sharedManifest
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val sharedManifest = the&lt;JavaPluginConvention&gt;().manifest {
    attributes (
        &quot;Implementation-Title&quot; to &quot;Gradle&quot;,
        &quot;Implementation-Version&quot; to version
    )
}

tasks.register&lt;Jar&gt;(&quot;fooJar&quot;) {
    manifest = project.the&lt;JavaPluginConvention&gt;().manifest {
        from(sharedManifest)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another option available to you is to merge manifests into a single <code>Manifest</code> object. Those source manifests can take the form of a text for or another <code>Manifest</code> object. In the following example, the source manifests are all text files except for <code>sharedManifest</code>, which is the <code>Manifest</code> object from the previous example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 431. Separate MANIFEST.MF for a particular archive</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task barJar(<span class="key">type</span>: Jar) {
    manifest {
        attributes <span class="key">key1</span>: <span class="string"><span class="delimiter">'</span><span class="content">value1</span><span class="delimiter">'</span></span>
        from sharedManifest, <span class="string"><span class="delimiter">'</span><span class="content">src/config/basemanifest.txt</span><span class="delimiter">'</span></span>
        from([<span class="string"><span class="delimiter">'</span><span class="content">src/config/javabasemanifest.txt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">src/config/libbasemanifest.txt</span><span class="delimiter">'</span></span>]) {
            eachEntry { details -&gt;
                <span class="keyword">if</span> (details.baseValue != details.mergeValue) {
                    details.value = baseValue
                }
                <span class="keyword">if</span> (details.key == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>) {
                    details.exclude()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Jar&gt;(&quot;barJar&quot;) {
    manifest {
        attributes(&quot;key1&quot; to &quot;value1&quot;)
        from(sharedManifest, &quot;src/config/basemanifest.txt&quot;)
        from(listOf(&quot;src/config/javabasemanifest.txt&quot;, &quot;src/config/libbasemanifest.txt&quot;)) {
            eachEntry(Action&lt;ManifestMergeDetails&gt; {
                if (baseValue != mergeValue) {
                    value = baseValue
                }
                if (key == &quot;foo&quot;) {
                    exclude()
                }
            })
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Manifests are merged in the order they are declared in the <code>from</code> statement. If the base manifest and the merged manifest both define values for the same key, the merged manifest wins by default. You can fully customize the merge behavior by adding <code>eachEntry</code> actions in which you have access to a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/java/archives/ManifestMergeDetails.html">ManifestMergeDetails</a> instance for each entry of the resulting manifest. Note that the merge is done lazily, either when generating the JAR or when <code>Manifest.writeTo()</code> or <code>Manifest.getEffectiveManifest()</code> are called.</p>
</div>
<div class="paragraph">
<p>Speaking of <code>writeTo()</code>, you can use that to easily write a manifest to disk at any time, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 432. Saving a MANIFEST.MF to disk</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar.manifest.writeTo(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/mymanifest.mf</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Jar&gt;(&quot;jar&quot;) { manifest.writeTo(&quot;$buildDir/mymanifest.mf&quot;) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:generating_javadocs"><a class="anchor" href="#sec:generating_javadocs"></a><a class="link" href="#sec:generating_javadocs">Generating API documentation</a></h4>
<div class="paragraph">
<p>The Java Library Plugin provides a <code>javadoc</code> task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Javadoc.html">Javadoc</a>, that will generate standard Javadocs for all your production code, i.e. whatever source is in the <code>main</code> source set.
The task supports the core Javadoc and standard doclet options described in the <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html#options">Javadoc reference documentation</a>.
See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/external/javadoc/CoreJavadocOptions.html">CoreJavadocOptions</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.html">StandardJavadocDocletOptions</a> for a complete list of those options.</p>
</div>
<div class="paragraph">
<p>As an example of what you can do, imagine you want to use Asciidoc syntax in your Javadoc comments. To do this, you need to add Asciidoclet to Javadoc&#8217;s doclet path. Here&#8217;s an example that does just that:</p>
</div>
<div class="exampleblock">
<div class="title">Example 433. Using a custom doclet with Javadoc</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    asciidoclet
}

dependencies {
    asciidoclet <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor:asciidoclet:1.+</span><span class="delimiter">'</span></span>
}

task configureJavadoc {
    doLast {
        javadoc {
            options.doclet = <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.Asciidoclet</span><span class="delimiter">'</span></span>
            options.docletpath = configurations.asciidoclet.files.toList()
        }
    }
}

javadoc {
    dependsOn configureJavadoc
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val asciidoclet by configurations.creating

dependencies {
    asciidoclet(&quot;org.asciidoctor:asciidoclet:1.+&quot;)
}

tasks.register(&quot;configureJavadoc&quot;) {
    doLast {
        tasks.javadoc {
            options.doclet = &quot;org.asciidoctor.Asciidoclet&quot;
            options.docletpath = asciidoclet.files.toList()
        }
    }
}

tasks.javadoc {
    dependsOn(&quot;configureJavadoc&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have to create a configuration for this, but it&#8217;s an elegant way to handle dependencies that are required for a unique purpose.</p>
</div>
<div class="paragraph">
<p>You might also want to create your own Javadoc tasks, for example to generate API docs for the tests:</p>
</div>
<div class="exampleblock">
<div class="title">Example 434. Defining a custom Javadoc task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task testJavadoc(<span class="key">type</span>: Javadoc) {
    source = sourceSets.test.allJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Javadoc&gt;(&quot;testJavadoc&quot;) {
    source = sourceSets.test.get().allJava
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These are just two non-trivial but common customizations that you might come across.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cleaning_java_build"><a class="anchor" href="#sec:cleaning_java_build"></a><a class="link" href="#sec:cleaning_java_build">Cleaning the build</a></h4>
<div class="paragraph">
<p>The Java Library Plugin adds a <code>clean</code> task to your project by virtue of applying the <a href="#base_plugin">Base Plugin</a>.
This task simply deletes everything in the <code>$buildDir</code> directory, hence why you should always put files generated by the build in there.
The task is an instance of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a> and you can change what directory it deletes by setting its <code>dir</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_jvm_components"><a class="anchor" href="#sec:building_jvm_components"></a><a class="link" href="#sec:building_jvm_components">Building JVM components</a></h4>
<div class="paragraph">
<p>All of the specific JVM plugins are built on top of the <a href="#">Java Plugin</a>.
The examples above only illustrated concepts provided by this base plugin and shared with all JVM plugins.</p>
</div>
<div class="paragraph">
<p>Read on to understand which plugins fits which project type, as it is recommended to pick a specific plugin instead of applying the Java Plugin directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_libraries"><a class="anchor" href="#sec:building_java_libraries"></a><a class="link" href="#sec:building_java_libraries">Building Java libraries</a></h4>
<div class="paragraph">
<p>The unique aspect of library projects is that they are used (or "consumed") by other Java projects.
That means the dependency metadata published with the JAR file  usually in the form of a Maven POM  is crucial.
In particular, consumers of your library should be able to distinguish between two different types of dependencies: those that are only required to compile your library and those that are also required to compile the consumer.</p>
</div>
<div class="paragraph">
<p>Gradle manages this distinction via the <a href="#java_library_plugin">Java Library Plugin</a>, which introduces an <em>api</em> configuration in addition to the <em>implementation</em> one covered in this chapter.
If the types from a dependency appear in public fields or methods of your library&#8217;s public classes, then that dependency is exposed via your library&#8217;s public API and should therefore be added to the <em>api</em> configuration.
Otherwise, the dependency is an internal implementation detail and should be added to <em>implementation</em>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re unsure of the difference between an API and implementation dependency, the <a href="#sec:java_library_recognizing_dependencies">Java Library Plugin chapter</a> has a detailed explanation. In addition, you can see a basic, practical example of building a Java library in the corresponding <a href="https://guides.gradle.org/building-java-libraries/"><em>guide</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_applications"><a class="anchor" href="#sec:building_java_applications"></a><a class="link" href="#sec:building_java_applications">Building Java applications</a></h4>
<div class="paragraph">
<p>Java applications packaged as a JAR aren&#8217;t set up for easy launching from the command line or a desktop environment.
The <a href="#application_plugin">Application Plugin</a> solves the command line aspect by creating a distribution that includes the production JAR, its dependencies and launch scripts Unix-like and Windows systems.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s chapter for more details, but here&#8217;s a quick summary of what you get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>assemble</code> creates ZIP and TAR distributions of the application containing everything needed to run it</p>
</li>
<li>
<p>A <code>run</code> task that starts the application from the build (for easy testing)</p>
</li>
<li>
<p>Shell and Windows Batch scripts to start the application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see a basic example of building a Java application in the corresponding <a href="https://guides.gradle.org/building-java-applications/"><em>guide</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_webapps"><a class="anchor" href="#sec:building_java_webapps"></a><a class="link" href="#sec:building_java_webapps">Building Java web applications</a></h4>
<div class="paragraph">
<p>Java web applications can be packaged and deployed in a number of ways depending on the technology you use. For example, you might use <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> with a fat JAR or a <a href="https://www.reactivemanifesto.org/">Reactive</a>-based system running on <a href="https://netty.io/">Netty</a>. Whatever technology you use, Gradle and its large community of plugins will satisfy your needs. Core Gradle, though, only directly supports traditional Servlet-based web applications deployed as WAR files.</p>
</div>
<div class="paragraph">
<p>That support comes via the <a href="#war_plugin">War Plugin</a>, which automatically applies the Java Plugin and adds an extra packaging step that does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copies static resources from <em>src/main/webapp</em> into the root of the WAR</p>
</li>
<li>
<p>Copies the compiled production classes into a <em>WEB-INF/classes</em> subdirectory of the WAR</p>
</li>
<li>
<p>Copies the library dependencies into a <em>WEB-INF/lib</em> subdirectory of the WAR</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by the <code>war</code> task, which effectively replaces the <code>jar</code> task  although that task remains and is attached to the <code>assemble</code> lifecycle task. See the plugin&#8217;s chapter for more details and configuration options.</p>
</div>
<div class="paragraph">
<p>There is no core support for running your web application directly from the build, but we do recommend that you try the <a href="https://plugins.gradle.org/plugin/org.gretty">Gretty</a> community plugin, which provides an embedded Servlet container.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_enterprise_apps"><a class="anchor" href="#sec:building_java_enterprise_apps"></a><a class="link" href="#sec:building_java_enterprise_apps">Building Java EE applications</a></h4>
<div class="paragraph">
<p>Java enterprise systems have changed a lot over the years, but if you&#8217;re still deploying to JEE application servers, you can make use of the <a href="#ear_plugin">Ear Plugin</a>. This adds conventions and a task for building EAR files. The plugin&#8217;s chapter has more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_java_platform"><a class="anchor" href="#sec:building_java_platform"></a><a class="link" href="#sec:building_java_platform">Building Java Platforms</a></h4>
<div class="paragraph">
<p>A Java platform represents a set of dependency declarations and constraints that form a cohesive unit to be applied on consuming projects.
The platform has no source and no artifact of its own.
It maps in the Maven world to a <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Management">BOM</a>.</p>
</div>
<div class="paragraph">
<p>The support comes via the <a href="#">Java Platform plugin</a>, which sets up the different configurations and publication components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This plugin is the exception as it does not apply the Java Plugin.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:feature_preview"><a class="anchor" href="#sec:feature_preview"></a><a class="link" href="#sec:feature_preview">Enabling Java preview features</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using a Java preview feature is very likely to make your code incompatible with that compiled without a feature preview. As a consequence, we strongly recommend you not to publish libraries compiled with preview features and restrict the use of feature previews to toy projects.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable Java <a href="https://openjdk.java.net/jeps/12">preview features</a> for compilation, test execution and runtime, you can use the following DSL snippet:</p>
</div>
<div class="exampleblock">
<div class="title">Example 435. Enabling Java feature preview</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(JavaCompile) {
    options.compilerArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}
tasks.withType(Test) {
    jvmArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}
tasks.withType(JavaExec) {
    jvmArgs += <span class="string"><span class="delimiter">&quot;</span><span class="content">--enable-preview</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;JavaCompile&gt; {
    options.compilerArgs.add(&quot;--enable-preview&quot;)
}
tasks.withType&lt;Test&gt; {
    jvmArgs(&quot;--enable-preview&quot;)
}
tasks.withType&lt;JavaExec&gt; {
    jvmArgs(&quot;--enable-preview&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_jvm_lang"><a class="anchor" href="#sec:building_jvm_lang"></a><a class="link" href="#sec:building_jvm_lang">Building other JVM language projects</a></h4>
<div class="paragraph">
<p>If you want to leverage the multi language aspect of the JVM, most of what was described here will still apply.</p>
</div>
<div class="paragraph">
<p>Gradle itself provides <a href="#">Groovy</a> and <a href="#">Scala</a> plugins.
The plugins automatically apply support for compiling Java code and can be further enhanced by combining them with the <code>java-library</code> plugin.</p>
</div>
<div class="sect4">
<h5 id="sub:compile_deps_jvm_lang"><a class="anchor" href="#sub:compile_deps_jvm_lang"></a><a class="link" href="#sub:compile_deps_jvm_lang">Compilation dependency between languages</a></h5>
<div class="paragraph">
<p>These plugins create a dependency between Groovy/Scala compilation and Java compilation (of source code in the <code>java</code> folder of a source set).
You can change this default behavior by adjusting the classpath of the involved compile tasks as shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 436. Changing the classpath of compile tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileGroovy</span><span class="delimiter">'</span></span>) {
    <span class="comment">// Groovy only needs the declared dependencies</span>
    <span class="comment">// (and not longer the output of compileJava)</span>
    classpath = sourceSets.main.compileClasspath
}
tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">compileJava</span><span class="delimiter">'</span></span>) {
    <span class="comment">// Java also depends on the result of Groovy compilation</span>
    <span class="comment">// (which automatically makes it depend of compileGroovy)</span>
    classpath += files(sourceSets.main.groovy.classesDirectory)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;AbstractCompile&gt;(&quot;compileGroovy&quot;) {
    // Groovy only needs the declared dependencies
    // (and not longer the output of compileJava)
    classpath = sourceSets.main.get().compileClasspath
}
tasks.named&lt;AbstractCompile&gt;(&quot;compileJava&quot;) {
    // Java also depends on the result of Groovy compilation
    // (which automatically makes it depend of compileGroovy)
    classpath += files(sourceSets.main.get().withConvention(GroovySourceSet::class) { groovy }.classesDirectory)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By setting the <code>compileGroovy</code> classpath to be only <code>sourceSets.main.compileClasspath</code>, we effectively remove the previous dependency on <code>compileJava</code> that was declared by having the classpath also take into consideration <code>sourceSets.main.java.classesDirectory</code></p>
</li>
<li>
<p>By adding <code>sourceSets.main.groovy.classesDirectory</code> to the <code>compileJava</code> <code>classpath</code>, we effectively declare a dependency on the <code>compileGroovy</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All of this is possible through the use of <a href="#">directory properties</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="extra_language_support"><a class="anchor" href="#extra_language_support"></a><a class="link" href="#extra_language_support">Extra language support</a></h5>
<div class="paragraph">
<p>Beyond core Gradle, there are other <a href="https://plugins.gradle.org/search?term=jvm">great plugins</a> for more JVM languages!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_testing"><a class="anchor" href="#java_testing"></a><a class="link" href="#java_testing">Testing in Java &amp; JVM projects</a></h3>
<div class="paragraph">
<p>Testing on the JVM is a rich subject matter. There are many different testing libraries and frameworks, as well as many different types of test. All need to be part of the build, whether they are executed frequently or infrequently. This chapter is dedicated to explaining how Gradle handles differing requirements between and within builds, with significant coverage of how it integrates with the two most common testing frameworks: <a href="https://junit.org/">JUnit</a> and <a href="https://testng.org/">TestNG</a>.</p>
</div>
<div class="paragraph">
<p>It explains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ways to control how the tests are run (<a href="#sec:test_execution">Test execution</a>)</p>
</li>
<li>
<p>How to select specific tests to run (<a href="#test_filtering">Test filtering</a>)</p>
</li>
<li>
<p>What test reports are generated and how to influence the process (<a href="#test_reporting">Test reporting</a>)</p>
</li>
<li>
<p>How Gradle finds tests to run (<a href="#sec:test_detection">Test detection</a>)</p>
</li>
<li>
<p>How to make use of the major frameworks' mechanisms for grouping tests together (<a href="#test_grouping">Test grouping</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But first, we look at the basics of JVM testing in Gradle.</p>
</div>
<div class="sect3">
<h4 id="sec:java_testing_basics"><a class="anchor" href="#sec:java_testing_basics"></a><a class="link" href="#sec:java_testing_basics">The basics</a></h4>
<div class="paragraph">
<p>All JVM testing revolves around a single task type: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>. This runs a collection of test cases using any supported test library  JUnit, JUnit Platform or TestNG and collates the results. You can then turn those results into a report via an instance of the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type.</p>
</div>
<div class="paragraph">
<p>In order to operate, the <code>Test</code> task type requires just two pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Where to find the compiled test classes (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:testClassesDirs">Test.getTestClassesDirs()</a>)</p>
</li>
<li>
<p>The execution classpath, which should include the classes under test as well as the test library that you&#8217;re using (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:classpath">Test.getClasspath()</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you&#8217;re using a JVM language plugin  such as the <a href="#java_plugin">Java Plugin</a> you will automatically get the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dedicated <code>test</code> source set for unit tests</p>
</li>
<li>
<p>A <code>test</code> task of type <code>Test</code> that runs those unit tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JVM language plugins use the source set to configure the task with the appropriate execution classpath and the directory containing the compiled test classes. In addition, they attach the <code>test</code> task to the <code>check</code> <a href="#sec:lifecycle_tasks">lifecycle task</a>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also worth bearing in mind that the <code>test</code> source set automatically creates <a href="#java_source_set_configurations">corresponding dependency configurations</a>  of which the most useful are <code>testImplementation</code> and <code>testRuntimeOnly</code>  that the plugins tie into the <code>test</code> task&#8217;s classpath.</p>
</div>
<div class="paragraph">
<p>All you need to do in most cases is configure the appropriate compilation and runtime dependencies and add any necessary configuration to the <code>test</code> task. The following example shows a simple setup that uses JUnit 4.x and changes the maximum heap size for the tests' JVM to 1 gigabyte:</p>
</div>
<div class="exampleblock">
<div class="title">Example 437. A basic configuration for the 'test' task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}

test {
    useJUnit()

    maxHeapSize = <span class="string"><span class="delimiter">'</span><span class="content">1G</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
}

tasks.test {
    useJUnit()

    maxHeapSize = &quot;1G&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> task has many generic configuration options as well as several framework-specific ones that you can find described in <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/junit/JUnitOptions.html">JUnitOptions</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/junitplatform/JUnitPlatformOptions.html">JUnitPlatformOptions</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html">TestNGOptions</a>. We cover a significant number of them in the rest of the chapter.</p>
</div>
<div class="paragraph">
<p>If you want to set up your own <code>Test</code> task with its own set of test classes, then the easiest approach is to create your own source set and <code>Test</code> task instance, as shown in <a href="#sec:configuring_java_integration_tests">Configuring integration tests</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:test_execution"><a class="anchor" href="#sec:test_execution"></a><a class="link" href="#sec:test_execution">Test execution</a></h4>
<div class="paragraph">
<p>Gradle executes tests in a separate ('forked') JVM, isolated from the main build process. This prevents classpath pollution and excessive memory consumption for the build process. It also allows you to run the tests with different JVM arguments than the build is using.</p>
</div>
<div class="paragraph">
<p>You can control how the test process is launched via several properties on the <code>Test</code> task, including the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>maxParallelForks</code>  default: 1</dt>
<dd>
<p>You can run your tests in parallel by setting this property to a value greater than 1. This may make your test suites complete faster, particularly if you run them on a multi-core CPU. When using parallel test execution, make sure your tests are properly isolated from one another. Tests that interact with the filesystem are particularly prone to conflict, causing intermittent test failures.</p>
<div class="paragraph">
<p>Your tests can distinguish between parallel test processes by using the value of the <code>org.gradle.test.worker</code> property, which is unique for each process. You can use this for anything you want, but it&#8217;s particularly useful for filenames and other resource identifiers to prevent the kind of conflict we just mentioned.</p>
</div>
</dd>
<dt class="hdlist1"><code>forkEvery</code>  default: 0 (no maximum)</dt>
<dd>
<p>This property specifies the maximum number of test classes that Gradle should run on a test process before its disposed of and a fresh one created. This is mainly used as a way to manage leaky tests or frameworks that have static state that can&#8217;t be cleared or reset between tests.</p>
<div class="paragraph">
<p><strong>Warning: a low value (other than 0) can severely hurt the performance of the tests</strong></p>
</div>
</dd>
<dt class="hdlist1"><code>ignoreFailures</code>  default: false</dt>
<dd>
<p>If this property is <code>true</code>, Gradle will continue with the project&#8217;s build once the tests have completed, even if some of them have failed. Note that, by default, the <code>Test</code> task always executes every test that it detects, irrespective of this setting.</p>
</dd>
<dt class="hdlist1"><code>failFast</code>  (since Gradle 4.6) default: false</dt>
<dd>
<p>Set this to <code>true</code> if you want the build to fail and finish as soon as one of your tests fails. This can save a lot of time when you have a long-running test suite and is particularly useful when running the build on continuous integration servers. When a build fails before all tests have run, the test reports only include the results of the tests that have completed, successfully or not.</p>
<div class="paragraph">
<p>You can also enable this behavior by using the <code>--fail-fast</code> command line option.</p>
</div>
</dd>
<dt class="hdlist1"><code>testLogging</code> default: <em>not set</em></dt>
<dd>
<p>This property represents a set of options that control which test events are logged and at what level. You can also configure other logging behavior via this property. See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/logging/TestLoggingContainer.html">TestLoggingContainer</a> for more detail.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> for details on all the available configuration options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The test process can exit unexpectedly if configured incorrectly. For instance, if the Java executable does not exist or an invalid JVM argument is provided, the test process will fail to start. Similarly, if a test makes programmatic changes to the test process, this can also cause unexpected failures.</p>
</div>
<div class="paragraph">
<p>For example, issues may occur if a <code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/SecurityManager.html">SecurityManager</a></code> is modified in a test because
Gradle&#8217;s internal messaging depends on reflection and socket communication, which may be disrupted if the permissions on the security manager change. In this particular case, you should restore the original <code>SecurityManager</code> after the test so that the
gradle test worker process can continue to function.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="test_filtering"><a class="anchor" href="#test_filtering"></a><a class="link" href="#test_filtering">Test filtering</a></h4>
<div class="paragraph">
<p>It&#8217;s a common requirement to run subsets of a test suite, such as when you&#8217;re fixing a bug or developing a new test case. Gradle provides two mechanisms to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filtering (the preferred option)</p>
</li>
<li>
<p>Test inclusion/exclusion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Filtering supersedes the inclusion/exclusion mechanism, but you may still come across the latter in the wild.</p>
</div>
<div class="paragraph">
<p>With Gradle&#8217;s test filtering you can select tests to run based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A fully-qualified class name or fully qualified method name, e.g. <code>org.gradle.SomeTest</code>, <code>org.gradle.SomeTest.someMethod</code></p>
</li>
<li>
<p>A simple class name or method name if the pattern starts with an upper-case letter, e.g. <code>SomeTest</code>, <code>SomeTest.someMethod</code> (since Gradle 4.7)</p>
</li>
<li>
<p>'*' wildcard matching</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable filtering either in the build script or via the <code>--tests</code> command-line option. Here&#8217;s an example of some filters that are applied every time the build runs:</p>
</div>
<div class="exampleblock">
<div class="title">Example 438. Filtering tests in the build script</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    filter {
        <span class="comment">//include specific method in any of the tests</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">*UiCheck</span><span class="delimiter">&quot;</span></span>

        <span class="comment">//include all tests from package</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.internal.*</span><span class="delimiter">&quot;</span></span>

        <span class="comment">//include all integration tests</span>
        includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">*IntegTest</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    filter {
        //include specific method in any of the tests
        includeTestsMatching(&quot;*UiCheck&quot;)

        //include all tests from package
        includeTestsMatching(&quot;org.gradle.internal.*&quot;)

        //include all integration tests
        includeTestsMatching(&quot;*IntegTest&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more details and examples of declaring filters in the build script, please see the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/TestFilter.html">TestFilter</a> reference.</p>
</div>
<div class="paragraph">
<p>The command-line option is especially useful to execute a single test method. When you use <code>--tests</code>, be aware that the inclusions declared in the build script are still honored. It is also possible to supply multiple <code>--tests</code> options, all of whose patterns will take effect. The following sections have several examples of using the command-line option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Not all test frameworks play well with filtering. Some advanced, synthetic tests may not be fully compatible.
However, the vast majority of tests and use cases work perfectly well with Gradle&#8217;s filtering mechanism.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following two sections look at the specific cases of simple class/method names and fully-qualified names.</p>
</div>
<div class="sect4">
<h5 id="simple_name_pattern"><a class="anchor" href="#simple_name_pattern"></a><a class="link" href="#simple_name_pattern">Simple name pattern</a></h5>
<div class="paragraph">
<p>Since 4.7, Gradle has treated a pattern starting with an uppercase letter as a simple class name, or a class name + method name. For example, the following command lines run either all or exactly one of the tests in the <code>SomeTestClass</code> test case, regardless of what  package it&#8217;s in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Executes all tests in SomeTestClass
gradle test --tests SomeTestClass

# Executes a single specified test in SomeTestClass
gradle test --tests SomeTestClass.someSpecificMethod

gradle test --tests SomeTestClass.*someMethod*</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="full_qualified_name_pattern"><a class="anchor" href="#full_qualified_name_pattern"></a><a class="link" href="#full_qualified_name_pattern">Fully-qualified name pattern</a></h5>
<div class="paragraph">
<p>Prior to 4.7 or if the pattern doesn&#8217;t start with an uppercase letter, Gradle treats the pattern as fully-qualified. So if you want to use the test class name irrespective of its package, you would use <code>--tests *.SomeTestClass</code>. Here are some more examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># specific class
gradle test --tests org.gradle.SomeTestClass

# specific class and method
gradle test --tests org.gradle.SomeTestClass.someSpecificMethod

# method name containing spaces
gradle test --tests "org.gradle.SomeTestClass.some method containing spaces"

# all classes at specific package (recursively)
gradle test --tests 'all.in.specific.package*'

# specific method at specific package (recursively)
gradle test --tests 'all.in.specific.package*.someSpecificMethod'

gradle test --tests '*IntegTest'

gradle test --tests '*IntegTest*ui*'

gradle test --tests '*ParameterizedTest.foo*'

# the second iteration of a parameterized test
gradle test --tests '*ParameterizedTest.*[2]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the wildcard '*' has no special understanding of the '.' package separator. It&#8217;s purely text based. So <code>--tests *.SomeTestClass</code> will match any package, regardless of its 'depth'.</p>
</div>
<div class="paragraph">
<p>You can also combine filters defined at the command line with <a href="#sec:continuous_build">continuous build</a> to re-execute a subset of tests immediately after every change to a production or test source file. The following executes all tests in the 'com.mypackage.foo' package or subpackages whenever a change triggers the tests to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>gradle test --continuous --tests "com.mypackage.foo.*"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test_reporting"><a class="anchor" href="#test_reporting"></a><a class="link" href="#test_reporting">Test reporting</a></h4>
<div class="paragraph">
<p>The <code>Test</code> task generates the following results by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An HTML test report</p>
</li>
<li>
<p>XML test results in a format compatible with the Ant JUnit report task one that is supported by many other tools, such as CI servers</p>
</li>
<li>
<p>An efficient binary format of the results used by the <code>Test</code> task to generate the other formats</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, you&#8217;ll work with the standard HTML report, which automatically includes the results from <em>all</em> your <code>Test</code> tasks, even the ones you explicitly add to the build yourself. For example, if you add a <code>Test</code> task for integration tests, the report will include the results of both the unit tests and the integration tests if both tasks are run.</p>
</div>
<div class="paragraph">
<p>Unlike with many of the testing configuration options, there are several project-level <a href="#sec:java_convention_properties">convention properties that affect the test reports</a>. For example, you can change the destination of the test results and reports like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 439. Changing the default test report and results directories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">reporting.baseDir = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-reports</span><span class="delimiter">&quot;</span></span>
testResultsDirName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/my-test-results</span><span class="delimiter">&quot;</span></span>

task showDirs {
    doLast {
        logger.quiet(rootDir.toPath().relativize(project.reportsDir.toPath()).toString())
        logger.quiet(rootDir.toPath().relativize(project.testResultsDir.toPath()).toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">reporting.baseDir = file(&quot;my-reports&quot;)
project.setProperty(&quot;testResultsDirName&quot;, &quot;$buildDir/my-test-results&quot;)

tasks.register(&quot;showDirs&quot;) {
    doLast {
        logger.quiet(rootDir.toPath().relativize((project.properties[&quot;reportsDir&quot;] as File).toPath()).toString())
        logger.quiet(rootDir.toPath().relativize((project.properties[&quot;testResultsDir&quot;] as File).toPath()).toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q showDirs</code></strong></div>
<div class="content">
<pre>&gt; gradle -q showDirs
my-reports
build/my-test-results</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the link to the convention properties for more details.</p>
</div>
<div class="paragraph">
<p>There is also a standalone <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type that you can use to generate a custom HTML test report. All it requires are a value for <code>destinationDir</code> and the test results you want included in the report. Here is a sample which generates a combined report for the unit tests from all subprojects:</p>
</div>
<div class="exampleblock">
<div class="title">Example 440. Creating a unit test report for subprojects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>

    <span class="comment">// Disable the test report for the individual test task</span>
    test {
        reports.html.enabled = <span class="predefined-constant">false</span>
    }
}

task testReport(<span class="key">type</span>: TestReport) {
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports/allTests</span><span class="delimiter">&quot;</span></span>)
    <span class="comment">// Include the results from the `test` task in all subprojects</span>
    reportOn subprojects*.test
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    apply(plugin = &quot;java&quot;)

    // Disable the test report for the individual test task
    tasks.named&lt;Test&gt;(&quot;test&quot;) {
        reports.html.isEnabled = false
    }
}

tasks.register&lt;TestReport&gt;(&quot;testReport&quot;) {
    destinationDir = file(&quot;$buildDir/reports/allTests&quot;)
    // Include the results from the `test` task in all subprojects
    reportOn(subprojects.map { it.tasks[&quot;test&quot;] })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You should note that the <code>TestReport</code> type combines the results from multiple test tasks and needs to aggregate the results of individual test classes. This means that if a given test class is executed by multiple test tasks, then the test report will include executions of that class, but it can be hard to distinguish individual executions of that class and their output.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:test_detection"><a class="anchor" href="#sec:test_detection"></a><a class="link" href="#sec:test_detection">Test detection</a></h4>
<div class="paragraph">
<p>By default, Gradle will run all tests that it detects, which it does by inspecting the compiled test classes. This detection uses different criteria depending on the test framework used.</p>
</div>
<div class="paragraph">
<p>For <em>JUnit</em>, Gradle scans for both JUnit 3 and 4 test classes. A class is considered to be a JUnit test if it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ultimately inherits from <code>TestCase</code> or <code>GroovyTestCase</code></p>
</li>
<li>
<p>Is annotated with <code>@RunWith</code></p>
</li>
<li>
<p>Contains a method annotated with <code>@Test</code> or a super class does</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <em>TestNG</em>, Gradle scans for methods annotated with <code>@Test</code>.</p>
</div>
<div class="paragraph">
<p>Note that abstract classes are not executed. In addition, be aware that Gradle scans up the inheritance tree into jar files on the test classpath. So if those JARs contain test classes, they will also be run.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use test class detection, you can disable it by setting the <code>scanForTestClasses</code> property on <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> to <code>false</code>. When you do that, the test task uses only the <code>includes</code> and <code>excludes</code> properties to find test classes.</p>
</div>
<div class="paragraph">
<p>If <code>scanForTestClasses</code> is false and no include or exclude patterns are specified, Gradle defaults to running any class that matches the patterns <code>**/*Tests.class</code> and <code>**/*Test.class</code>, excluding those that match <code>**/Abstract*.class</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>With <a href="http://junit.org/junit5/docs/current/user-guide">JUnit Platform</a>, only <code>includes</code> and <code>excludes</code> are used to filter test classes  <code>scanForTestClasses</code> has no effect.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="test_grouping"><a class="anchor" href="#test_grouping"></a><a class="link" href="#test_grouping">Test grouping</a></h4>
<div class="paragraph">
<p>JUnit, JUnit Platform and TestNG allow sophisticated groupings of test methods.</p>
</div>
<div class="paragraph">
<p>JUnit 4.8 introduced the concept of categories for grouping JUnit 4 tests classes and methods.<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup> <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:useJUnit(org.gradle.api.Action)">Test.useJUnit(org.gradle.api.Action)</a> allows you to specify the JUnit categories you want to include and exclude. For example, the following configuration includes tests in <code>CategoryA</code> and excludes those in <code>CategoryB</code> for the <code>test</code> task:</p>
</div>
<div class="exampleblock">
<div class="title">Example 441. JUnit Categories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useJUnit {
        includeCategories <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.junit.CategoryA</span><span class="delimiter">'</span></span>
        excludeCategories <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.junit.CategoryB</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useJUnit {
        includeCategories(&quot;org.gradle.junit.CategoryA&quot;)
        excludeCategories(&quot;org.gradle.junit.CategoryB&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="http://junit.org/junit5/docs/current/user-guide">JUnit Platform</a> introduced <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering">tagging</a> to replace categories. You can specify the included/excluded tags via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/Test.html#useJUnitPlatform-org.gradle.api.Action-">Test.useJUnitPlatform(org.gradle.api.Action)</a>, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 442. JUnit Platform Tags</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useJUnitPlatform {
        includeTags <span class="string"><span class="delimiter">'</span><span class="content">fast</span><span class="delimiter">'</span></span>
        excludeTags <span class="string"><span class="delimiter">'</span><span class="content">slow</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useJUnitPlatform {
        includeTags(&quot;fast&quot;)
        excludeTags(&quot;slow&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The TestNG framework uses the concept of test groups for a similar effect.<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup> You can configure which test groups to include or exclude during the test execution via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:useTestNG(org.gradle.api.Action)">Test.useTestNG(org.gradle.api.Action)</a> setting, as seen here:</p>
</div>
<div class="exampleblock">
<div class="title">Example 443. Grouping TestNG tests</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        excludeGroups <span class="string"><span class="delimiter">'</span><span class="content">integrationTests</span><span class="delimiter">'</span></span>
        includeGroups <span class="string"><span class="delimiter">'</span><span class="content">unitTests</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useTestNG {
        val options = this as TestNGOptions
        options.excludeGroups(&quot;integrationTests&quot;)
        options.includeGroups(&quot;unitTests&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using_junit5"><a class="anchor" href="#using_junit5"></a><a class="link" href="#using_junit5">Using JUnit 5</a></h4>
<div class="paragraph">
<p><a href="http://junit.org/junit5">JUnit 5</a> is the latest version of the well-known JUnit test framework.
Unlike its predecessor, JUnit 5 is modularized and composed of several modules:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</pre>
</div>
</div>
<div class="paragraph">
<p>The JUnit Platform serves as a foundation for launching testing frameworks on the JVM. JUnit Jupiter is the combination of the new <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests">programming model</a>
 and <a href="http://junit.org/junit5/docs/current/user-guide/#extensions">extension model</a> for writing tests and extensions in JUnit 5. JUnit Vintage provides a <code>TestEngine</code> for running JUnit 3 and JUnit 4 based tests on the platform.</p>
</div>
<div class="paragraph">
<p>The following code enables JUnit Platform support in <code>build.gradle</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 444. Enabling JUnit Platform to run your tests</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Test&gt;(&quot;test&quot;) {
    useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/Test.html#useJUnitPlatform--">Test.useJUnitPlatform()</a> for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are some known limitations of using JUnit 5 with Gradle, for example that tests in static nested classes won&#8217;t be discovered and classes are still displayed by their class name instead of <code>@DisplayName</code>. These will be fixed in future version of Gradle. If you find more, please tell us at <a href="https://github.com/gradle/gradle/issues/new" class="bare">https://github.com/gradle/gradle/issues/new</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="compiling_and_executing_junit_jupiter_tests"><a class="anchor" href="#compiling_and_executing_junit_jupiter_tests"></a><a class="link" href="#compiling_and_executing_junit_jupiter_tests">Compiling and executing JUnit Jupiter tests</a></h5>
<div class="paragraph">
<p>To enable JUnit Jupiter support in Gradle, all you need to do is add the following dependencies:</p>
</div>
<div class="exampleblock">
<div class="title">Example 445. JUnit Jupiter dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter-api:5.6.0</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter-engine</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter-api:5.6.0&quot;)
    testRuntimeOnly(&quot;org.junit.jupiter:junit-jupiter-engine&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then put your test cases into <em>src/test/java</em> as normal and execute them with <code>gradle test</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="executing_legacy_tests_with_junit_vintage"><a class="anchor" href="#executing_legacy_tests_with_junit_vintage"></a><a class="link" href="#executing_legacy_tests_with_junit_vintage">Executing legacy tests with JUnit Vintage</a></h5>
<div class="paragraph">
<p>If you want to run JUnit 3/4 tests on JUnit Platform, or even mix them with Jupiter tests, you should add extra JUnit Vintage Engine dependencies:</p>
</div>
<div class="exampleblock">
<div class="title">Example 446. JUnit Vintage dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter-api:5.6.0</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.jupiter:junit-jupiter-engine</span><span class="delimiter">'</span></span>
    testCompileOnly <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
    testRuntimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.junit.vintage:junit-vintage-engine</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.junit.jupiter:junit-jupiter-api:5.6.0&quot;)
    testRuntimeOnly(&quot;org.junit.jupiter:junit-jupiter-engine&quot;)
    testCompileOnly(&quot;junit:junit:4.12&quot;)
    testRuntimeOnly(&quot;org.junit.vintage:junit-vintage-engine&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way, you can use <code>gradle test</code> to test JUnit 3/4 tests on JUnit Platform, without the need to rewrite them.</p>
</div>
<div class="paragraph">
<p>A sample of mixed tests can be found at <code>samples/testing/junitplatform/mix</code> in the '-all' distribution of Gradle.</p>
</div>
</div>
<div class="sect4">
<h5 id="filtering_test_engine"><a class="anchor" href="#filtering_test_engine"></a><a class="link" href="#filtering_test_engine">Filtering test engine</a></h5>
<div class="paragraph">
<p>JUnit Platform allows you to use different test engines. JUnit currently provides two <code>TestEngine</code> implementations out of the box:
<a href="https://junit.org/junit5/docs/current/api/org.junit.jupiter.engine/module-summary.html">junit-jupiter-engine</a> and <a href="https://junit.org/junit5/docs/current/api/org.junit.vintage.engine/module-summary.html">junit-vintage-engine</a>.
You can also write and plug in your own <code>TestEngine</code> implementation as documented <a href="https://junit.org/junit5/docs/current/user-guide/#launcher-api-engines-custom">here</a>.</p>
</div>
<div class="paragraph">
<p>By default, all test engines on the test runtime classpath will be used.
To control specific test engine implementations explicitly, you can add the following setting to your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 447. Filter specific engines</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useJUnitPlatform {
        includeEngines <span class="string"><span class="delimiter">'</span><span class="content">junit-vintage</span><span class="delimiter">'</span></span>
        <span class="comment">// excludeEngines 'junit-jupiter'</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useJUnitPlatform {
        includeEngines(&quot;junit-vintage&quot;)
        // excludeEngines(&quot;junit-jupiter&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A test engine filtering sample can be found at <code>samples/testing/junitplatform/engine</code> in the '-all' distribution of Gradle.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test_execution_order"><a class="anchor" href="#test_execution_order"></a><a class="link" href="#test_execution_order">Test execution order in TestNG</a></h4>
<div class="paragraph">
<p>TestNG allows explicit control of the execution order of tests when you use a <em>testng.xml</em> file. Without such a file  or an equivalent one configured by <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html#getSuiteXmlBuilder--">TestNGOptions.getSuiteXmlBuilder()</a>  you can&#8217;t specify the test execution order. However, what you <em>can</em> do is control whether all aspects of a test  including its associated <code>@BeforeXXX</code> and <code>@AfterXXX</code> methods, such as those annotated with <code>@Before/AfterClass</code> and <code>@Before/AfterMethod</code>are executed before the next test starts. You do this by setting the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/testng/TestNGOptions.html#getPreserveOrder--">TestNGOptions.getPreserveOrder()</a> property to <code>true</code>. If you set it to <code>false</code>, you may encounter scenarios in which the execution order is something like: <code>TestA.doBeforeClass()</code> &#8594; <code>TestB.doBeforeClass()</code> &#8594; <code>TestA</code> tests.</p>
</div>
<div class="paragraph">
<p>While preserving the order of tests is the default behavior when directly working with <em>testng.xml</em> files, the <a href="https://jitpack.io/com/github/cbeust/testng/master/javadoc/org/testng/TestNG.html">TestNG API</a> that is used by Gradle&#8217;s TestNG integration executes tests in unpredictable order by default.<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup> The ability to preserve test execution order was introduced with TestNG version 5.14.5. Setting the <code>preserveOrder</code> property to <code>true</code> for an older TestNG version will cause the build to fail.</p>
</div>
<div class="exampleblock">
<div class="title">Example 448. Preserving order of TestNG tests</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        preserveOrder <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useTestNG {
        preserveOrder = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>groupByInstance</code> property controls whether tests should be grouped by instance rather than by class. The <a href="http://testng.org/doc/documentation-main.html#dependencies-with-annotations">TestNG documentation</a> explains the difference in more detail, but essentially, if you have a test method <code>A()</code> that depends on <code>B()</code>, grouping by instance ensures that each A-B pairing, e.g. <code>B(1)</code>-<code>A(1)</code>, is executed before the next pairing. With group by class, all <code>B()</code> methods are run and then all <code>A()</code> ones.</p>
</div>
<div class="paragraph">
<p>Note that you typically only have more than one instance of a test if you&#8217;re using a data provider to parameterize it. Also, grouping tests by instances was introduced with TestNG version 6.1. Setting the <code>groupByInstances</code> property to <code>true</code> for an older TestNG version will cause the build to fail.</p>
</div>
<div class="exampleblock">
<div class="title">Example 449. Grouping TestNG tests by instances</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG {
        groupByInstances = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    useTestNG {
        groupByInstances = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="testNgParameterizedReporting"><a class="anchor" href="#testNgParameterizedReporting"></a><a class="link" href="#testNgParameterizedReporting">TestNG parameterized methods and reporting</a></h5>
<div class="paragraph">
<p>TestNG supports <a href="http://testng.org/doc/documentation-main.html#parameters">parameterizing test methods</a>, allowing a particular test method to be executed multiple times with different inputs. Gradle includes the parameter values in its reporting of the test method execution.</p>
</div>
<div class="paragraph">
<p>Given a parameterized test method named <code>aTestMethod</code> that takes two parameters, it will be reported with the name <code>aTestMethod(toStringValueOfParam1, toStringValueOfParam2)</code>. This makes it easy to identify the parameter values for a particular iteration.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_java_integration_tests"><a class="anchor" href="#sec:configuring_java_integration_tests"></a><a class="link" href="#sec:configuring_java_integration_tests">Configuring integration tests</a></h4>
<div class="paragraph">
<p>A common requirement for projects is to incorporate integration tests in one form or another. Their aim is to verify that the various parts of the project are working together properly. This often means that they require special execution setup and dependencies compared to unit tests.</p>
</div>
<div class="paragraph">
<p>The simplest way to add integration tests to your build is by taking these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new <a href="#sec:java_source_sets">source set</a> for them</p>
</li>
<li>
<p>Add the dependencies you need to the appropriate configurations for that source set</p>
</li>
<li>
<p>Configure the compilation and runtime classpaths for that source set</p>
</li>
<li>
<p>Create a task to run the integration tests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You may also need to perform some additional configuration depending on what form the integration tests take. We will discuss those as we go.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a practical example that implements the first three steps in a build script, centered around a new source set <code>intTest</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 450. Setting up working integration tests</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    intTest {
        compileClasspath += sourceSets.main.output
        runtimeClasspath += sourceSets.main.output
    }
}

configurations {
    intTestImplementation.extendsFrom implementation
    intTestRuntimeOnly.extendsFrom runtimeOnly
}

dependencies {
    intTestImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    create(&quot;intTest&quot;) {
        compileClasspath += sourceSets.main.get().output
        runtimeClasspath += sourceSets.main.get().output
    }
}

val intTestImplementation by configurations.getting {
    extendsFrom(configurations.implementation.get())
}

configurations[&quot;intTestRuntimeOnly&quot;].extendsFrom(configurations.runtimeOnly.get())

dependencies {
    intTestImplementation(&quot;junit:junit:4.12&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will set up a new source set called <code>intTest</code> that automatically creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>intTestImplementation</code>, <code>intTestCompileOnly</code>, <code>intTestRuntimeOnly</code> configurations (and <a href="#java_source_set_configurations">a few others</a> that are less commonly needed)</p>
</li>
<li>
<p>A <code>compileIntTestJava</code> task that will compile all the source files under <em>src/intTest/java</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example also does the following, not all of which you may need for your specific integration tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adds the production classes from the <code>main</code> source set to the compilation and runtime classpaths of the integration tests  <code>sourceSets.main.output</code> is a <a href="#sec:file_collections">file collection</a> of all the directories containing compiled production classes and resources</p>
</li>
<li>
<p>Makes the <code>intTestImplementation</code> configuration extend from <code>implementation</code>, which means that all the declared dependencies of the production code also become dependencies of the integration tests</p>
</li>
<li>
<p>Does the same for the <code>intTestRuntimeOnly</code> configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, you want your integration tests to have access to the classes under test, which is why we ensure that those are included on the compilation and runtime classpaths in this example. But some types of test interact with the production code in a different way. For example, you may have tests that run your application as an executable and verify the output. In the case of web applications, the tests may interact with your application via HTTP. Since the tests don&#8217;t need direct access to the classes under test in such cases, you don&#8217;t need to add the production classes to the test classpath.</p>
</div>
<div class="paragraph">
<p>Another common step is to attach all the unit test dependencies to the integration tests as well  via <code>intTestImplementation.extendsFrom testImplementation</code>  but that only makes sense if the integration tests require <em>all</em> or nearly all the same dependencies that the unit tests have.</p>
</div>
<div class="paragraph">
<p>There are a couple of other facets of the example you should take note of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+=</code> allows you to append paths and collections of paths to <code>compileClasspath</code> and <code>runtimeClasspath</code> instead of overwriting them</p>
</li>
<li>
<p>If you want to use the convention-based configurations, such as <code>intTestImplementation</code>, you <em>must</em> declare the dependencies <em>after</em> the new source set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating and configuring a source set automatically sets up the compilation stage, but it does nothing with respect to running the integration tests. So the last piece of the puzzle is a custom test task that uses the information from the new source set to configure its runtime classpath and the test classes:</p>
</div>
<div class="exampleblock">
<div class="title">Example 451. Defining a working integration test task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task integrationTest(<span class="key">type</span>: Test) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">Runs integration tests.</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>

    testClassesDirs = sourceSets.intTest.output.classesDirs
    classpath = sourceSets.intTest.runtimeClasspath
    shouldRunAfter test
}

check.dependsOn integrationTest</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val integrationTest = task&lt;Test&gt;(&quot;integrationTest&quot;) {
    description = &quot;Runs integration tests.&quot;
    group = &quot;verification&quot;

    testClassesDirs = sourceSets[&quot;intTest&quot;].output.classesDirs
    classpath = sourceSets[&quot;intTest&quot;].runtimeClasspath
    shouldRunAfter(&quot;test&quot;)
}

tasks.check { dependsOn(integrationTest) }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, we&#8217;re accessing a source set to get the relevant information, i.e. where the compiled test classes are the <code>testClassesDirs</code> property and what needs to be on the classpath when running them <code>classpath</code>.</p>
</div>
<div class="paragraph">
<p>Users commonly want to run integration tests after the unit tests, because they are often slower to run and you want the build to fail early on the unit tests rather than later on the integration tests. That&#8217;s why the above example adds a <code>shouldRunAfter()</code> declaration. This is preferred over <code>mustRunAfter()</code> so that Gradle has more flexibility in executing the build in parallel.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_testing_modular"><a class="anchor" href="#sec:java_testing_modular"></a><a class="link" href="#sec:java_testing_modular">Testing Java Modules</a></h4>
<div class="paragraph">
<p>If you are <a href="#">developing Java Modules</a>, everything described in this chapter still applies and any of the supported test frameworks can be used.
However, there are some things to consider depending on whether you need module information to be available, and module boundaries to be enforced, during test execution.
In this context, the terms <em>whitebox testing</em> (module boundaries are deactivated or relaxed) and <em>blackbox testing</em> (module boundaries are in place) are often used.
Whitebox testing is used/needed for unit testing and blackbox testing fits functional or integration test requirements.</p>
</div>
<div class="paragraph">
<p>Sample: <a href="../samples/sample_java_modules_multi_project_with_integration_tests.html">Java Modules multi-project with integration tests</a></p>
</div>
<div class="sect4">
<h5 id="whitebox_unit_test_execution_on_the_classpath"><a class="anchor" href="#whitebox_unit_test_execution_on_the_classpath"></a><a class="link" href="#whitebox_unit_test_execution_on_the_classpath">Whitebox unit test execution on the classpath</a></h5>
<div class="paragraph">
<p>The simplest setup to write unit tests for functions or classes in modules is to <em>not</em> use module specifics during test execution.
For this, you just need to write tests the same way you would write them for normal libraries.
If you don&#8217;t have a <code>module-info.java</code> file in your test source set (<code>src/main/test</code>) this source set will be considered as traditional Java library during compilation and test runtime.
This means, all dependencies, including Jars with module information, are put on the classpath.
The advantage is that all internal classes of your (or other) modules are then accessible directly in tests.
This may be a totally valid setup for unit testing, where we do not care about the larger module structure, but only about testing single functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Eclipse: By default, Eclipse also runs unit tests as modules using module patching (see <a href="#sec:java_testing_modular_patching">below</a>).
In an imported Gradle project, unit testing a module with the Eclipse test runner might fail.
You then need to manually adjust the classpath/module path in the test run configuration or delegate test execution to Gradle.
This only concerns the test execution.
Unit test compilation and development works fine in Eclipse.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="blackbox_integration_testing"><a class="anchor" href="#blackbox_integration_testing"></a><a class="link" href="#blackbox_integration_testing">Blackbox integration testing</a></h5>
<div class="paragraph">
<p>For integration tests, you have the option to define the test set itself as additional module.
You do this similar to how you turn your main sources into a module:
by adding a <code>module-info.java</code> file to the corresponding source set (e.g. <code>integrationTests/java/module-info.java</code>).</p>
</div>
<div class="paragraph">
<p>You can find a full example that includes blackbox integration tests <a href="../samples/sample_java_modules_multi_project_with_integration_tests.html">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Eclipse, compiling multiple modules in one project is <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=520667">currently not support</a>.
Therefore the integration test (blackbox) setup described here only works in Eclipse if the tests are moved to a separate subproject.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_testing_modular_patching"><a class="anchor" href="#sec:java_testing_modular_patching"></a><a class="link" href="#sec:java_testing_modular_patching">Whitebox test execution with module patching</a></h5>
<div class="paragraph">
<p>Another approach for whitebox testing is to stay in the module world by <em>patching</em> the tests into the module under test.
This way, module boundaries stay in place, but the tests themselves become part of the module under test and can then access the module&#8217;s internals.</p>
</div>
<div class="paragraph">
<p>For which uses cases this is relevant and how this is best done is a topic of discussion.
There is no general best approach at the moment.
Thus, there is no special support for this in Gradle right now.</p>
</div>
<div class="paragraph">
<p>You can however, setup module patching for tests like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a <code>module-info.java</code> to your test source set that is a copy of the main <code>module-info.java</code> with additional dependencies needed for testing (e.g. <code>requires org.junit.jupiter.api</code>).</p>
</li>
<li>
<p>Configure both the <code>testCompileJava</code> and <code>test</code> tasks with arguments to patch the the main classes with the test classes as shown below.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 452. Patch module for testing using command line arguments</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> moduleName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.sample</span><span class="delimiter">&quot;</span></span>
<span class="keyword">def</span> patchArgs = [<span class="string"><span class="delimiter">&quot;</span><span class="content">--patch-module</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>moduleName</span><span class="content">=</span><span class="inline"><span class="inline-delimiter">${</span>tasks.compileJava.destinationDirectory.asFile.get().path<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>]
tasks.compileTestJava {
    options.compilerArgs += patchArgs
}
tasks.test {
    jvmArgs += patchArgs
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val moduleName = &quot;org.gradle.sample&quot;
val patchArgs = listOf(&quot;--patch-module&quot;, &quot;$moduleName=${tasks.compileJava.get().destinationDirectory.asFile.get().path}&quot;)
tasks.compileTestJava {
    options.compilerArgs.addAll(patchArgs)
}
tasks.test {
    jvmArgs(patchArgs)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If custom arguments are used for patching, these are not picked up by Eclipse and IDEA.
You will most likely see invalid compilation errors in the IDE.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:skipping_java_tests"><a class="anchor" href="#sec:skipping_java_tests"></a><a class="link" href="#sec:skipping_java_tests">Skipping the tests</a></h4>
<div class="paragraph">
<p>If you want to skip the tests when running a build, you have a few options. You can either do it via <a href="#sec:excluding_tasks_from_the_command_line">command line arguments</a> or <a href="#sec:skipping_tasks">in the build script</a>. To do it on the command line, you can use the <code>-x</code> or <code>--exclude-task</code> option like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gradle build -x test</pre>
</div>
</div>
<div class="paragraph">
<p>This excludes the <code>test</code> task and any other task that it <em>exclusively</em> depends on, i.e. no other task depends on the same task. Those tasks will not be marked "SKIPPED" by Gradle, but will simply not appear in the list of tasks executed.</p>
</div>
<div class="paragraph">
<p>Skipping a test via the build script can be done a few ways. One common approach is to make test execution conditional via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html#org.gradle.api.Task:onlyIf(org.gradle.api.specs.Spec)">Task.onlyIf(org.gradle.api.specs.Spec)</a> method. The following sample skips the <code>test</code> task if the project has a property called <code>mySkipTests</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 453. Skipping the unit tests based on a project property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test.onlyIf { !project.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">mySkipTests</span><span class="delimiter">'</span></span>) }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test { onlyIf { !project.hasProperty(&quot;mySkipTests&quot;) } }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, Gradle will mark the skipped tests as "SKIPPED" rather than exclude them from the build.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:forcing_java_tests_to_run"><a class="anchor" href="#sec:forcing_java_tests_to_run"></a><a class="link" href="#sec:forcing_java_tests_to_run">Forcing tests to run</a></h4>
<div class="paragraph">
<p>In well-defined builds, you can rely on Gradle to only run tests if the tests themselves or the production code change. However, you may encounter situations where the tests rely on a third-party service or something else that might change but can&#8217;t be modeled in the build.</p>
</div>
<div class="paragraph">
<p>You can force tests to run in this situation by cleaning the output of the relevant <code>Test</code> task  say <code>test</code>  and running the tests again, like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gradle cleanTest test</pre>
</div>
</div>
<div class="paragraph">
<p><code>cleanTest</code> is based on a <a href="#sec:task_rules">task rule</a> provided by the <a href="#sec:base_tasks">Base Plugin</a>. You can use it for <em>any</em> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:debugging_java_tests"><a class="anchor" href="#sec:debugging_java_tests"></a><a class="link" href="#sec:debugging_java_tests">Debugging when running tests</a></h4>
<div class="paragraph">
<p>On the few occasions that you want to debug your code while the tests are running, it can be helpful if you can attach a debugger at that point. You can either set the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html#org.gradle.api.tasks.testing.Test:debug">Test.getDebug()</a> property to <code>true</code> or use the <code>--debug-jvm</code> command line option.</p>
</div>
<div class="paragraph">
<p>When debugging for tests is enabled, Gradle will start the test process suspended and listening on port 5005.</p>
</div>
<div class="paragraph">
<p>You can also enable debugging in the DSL, where you can also configure other properties:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>test {
    debugOptions {
        enabled = true
        port = 4455
        server = true
        suspend = true
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration the test JVM will behave just like when passing the <code>--debug-jvm</code> argument but it will listen on port 4455.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_test_fixtures"><a class="anchor" href="#sec:java_test_fixtures"></a><a class="link" href="#sec:java_test_fixtures">Using test fixtures</a></h4>
<div class="sect4">
<h5 id="producing_and_using_test_fixtures_within_a_single_project"><a class="anchor" href="#producing_and_using_test_fixtures_within_a_single_project"></a><a class="link" href="#producing_and_using_test_fixtures_within_a_single_project">Producing and using test fixtures within a single project</a></h5>
<div class="paragraph">
<p>Test fixtures are commonly used to setup the code under test, or provide utilities aimed at facilitating the tests of a component.
Java projects can enable test fixtures support by applying the <code>java-test-fixtures</code> plugin, in addition to the <code>java</code> or <code>java-library</code> plugins:</p>
</div>
<div class="exampleblock">
<div class="title">Example 454. Applying the Java test fixtures plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    <span class="comment">// A Java Library</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    <span class="comment">// which produces test fixtures</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java-test-fixtures</span><span class="delimiter">'</span></span>
    <span class="comment">// and is published</span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    // A Java Library
    `java-library`
    // which produces test fixtures
    `java-test-fixtures`
    // and is published
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will automatically create a <code>testFixtures</code> source set, in which you can write your test fixtures.
Test fixtures are configured so that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they can see the <em>main</em> source set classes</p>
</li>
<li>
<p><em>test</em> sources can see the <em>test fixtures</em> classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example for this main class:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/acme/Person.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> lastName;

    <span class="directive">public</span> Person(<span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName) {
        <span class="local-variable">this</span>.firstName = firstName;
        <span class="local-variable">this</span>.lastName = lastName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() {
        <span class="keyword">return</span> firstName;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastName() {
        <span class="keyword">return</span> lastName;
    }

    <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A test fixture can be written in <code>src/testFixtures/java</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/testFixtures/java/com/acme/Simpsons.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Simpsons</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person HOMER = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Homer</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person MARGE = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Majorie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person BART = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bartholomew</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person LISA = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Elisabeth Marie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Person MAGGIE = <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Margaret Eve</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Person&gt; FAMILY = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Person&gt;() {{
        add(HOMER);
        add(MARGE);
        add(BART);
        add(LISA);
        add(MAGGIE);
    }};

    <span class="directive">public</span> <span class="directive">static</span> Person homer() { <span class="keyword">return</span> HOMER; }

    <span class="directive">public</span> <span class="directive">static</span> Person marge() { <span class="keyword">return</span> MARGE; }

    <span class="directive">public</span> <span class="directive">static</span> Person bart() { <span class="keyword">return</span> BART; }

    <span class="directive">public</span> <span class="directive">static</span> Person lisa() { <span class="keyword">return</span> LISA; }

    <span class="directive">public</span> <span class="directive">static</span> Person maggie() { <span class="keyword">return</span> MAGGIE; }

    <span class="comment">// ...</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declaring_dependencies_of_test_fixtures"><a class="anchor" href="#declaring_dependencies_of_test_fixtures"></a><a class="link" href="#declaring_dependencies_of_test_fixtures">Declaring dependencies of test fixtures</a></h5>
<div class="paragraph">
<p>Similarly to the <a href="java_library_plugin.html">Java Library Plugin</a>, test fixtures expose an API and an implementation configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 455. Declaring test fixture dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>

    <span class="comment">// API dependencies are visible to consumers when building</span>
    testFixturesApi <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.9</span><span class="delimiter">'</span></span>

    <span class="comment">// Implementation dependencies are not leaked to consumers when building</span>
    testFixturesImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-text:1.6</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)

    // API dependencies are visible to consumers when building
    testFixturesApi(&quot;org.apache.commons:commons-lang3:3.9&quot;)

    // Implementation dependencies are not leaked to consumers when building
    testFixturesImplementation(&quot;org.apache.commons:commons-text:1.6&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s worth noticing that if a dependency is an <em>implementation</em> dependency of test fixtures, then <em>when compiling tests that depend on those test fixtures</em>, the implementation dependencies will <em>not leak</em> into the compile classpath.
This results in improved separation of concerns and better compile avoidance.</p>
</div>
</div>
<div class="sect4">
<h5 id="consuming_test_fixtures_of_another_project"><a class="anchor" href="#consuming_test_fixtures_of_another_project"></a><a class="link" href="#consuming_test_fixtures_of_another_project">Consuming test fixtures of another project</a></h5>
<div class="paragraph">
<p>Test fixtures are not limited to a single project.
It is often the case that a dependent project tests also needs the test fixtures of the dependency.
This can be achieved very easily using the <code>testFixtures</code> keyword:</p>
</div>
<div class="exampleblock">
<div class="title">Example 456. Adding a dependency on test fixtures of another project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>))

    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
    testImplementation(testFixtures(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(project(&quot;:lib&quot;))

    testImplementation(&quot;junit:junit:4.12&quot;)
    testImplementation(testFixtures(project(&quot;:lib&quot;)))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="publishing_test_fixtures"><a class="anchor" href="#publishing_test_fixtures"></a><a class="link" href="#publishing_test_fixtures">Publishing test fixtures</a></h5>
<div class="paragraph">
<p>One of the advantages of using the <code>java-test-fixtures</code> plugin is that test fixtures are published.
By convention, test fixtures will be published with an artifact having the <code>test-fixtures</code> classifier.
For both Maven and Ivy, an artifact with that classifier is simply published alongside the regular artifacts.
However, if you use the <code>maven-publish</code> or <code>ivy-publish</code> plugin, test fixtures are published as additional variants in <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-1.0-specification.md">Gradle Module Metadata</a> and you can directly depend on test fixtures of external libraries in another Gradle project:</p>
</div>
<div class="exampleblock">
<div class="title">Example 457. Adding a dependency on test fixtures of an external library</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Adds a dependency on the test fixtures of Gson, however this</span>
    <span class="comment">// project doesn't publish such a thing</span>
    functionalTest testFixtures(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.code.gson:gson:2.8.5</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // Adds a dependency on the test fixtures of Gson, however this
    // project doesn't publish such a thing
    functionalTest(testFixtures(&quot;com.google.code.gson:gson:2.8.5&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that if the external project is <em>not</em> publishing Gradle Module Metadata, then resolution will fail with an error indicating that such a variant cannot be found:</p>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependencyInsight --configuration functionalTestClasspath --dependency gson</code></strong></div>
<div class="content">
<pre>&gt; gradle dependencyInsight --configuration functionalTestClasspath --dependency gson

&gt; Task :dependencyInsight
com.google.code.gson:gson:2.8.5 FAILED
   Failures:
      - Could not resolve com.google.code.gson:gson:2.8.5.
          - Unable to find a variant of com.google.code.gson:gson:2.8.5 providing the requested capability com.google.code.gson:gson-test-fixtures:
               - Variant compile provides com.google.code.gson:gson:2.8.5
               - Variant runtime provides com.google.code.gson:gson:2.8.5
               - Variant platform-compile provides com.google.code.gson:gson-derived-platform:2.8.5
               - Variant platform-runtime provides com.google.code.gson:gson-derived-platform:2.8.5
               - Variant enforced-platform-compile provides com.google.code.gson:gson-derived-enforced-platform:2.8.5
               - Variant enforced-platform-runtime provides com.google.code.gson:gson-derived-enforced-platform:2.8.5

com.google.code.gson:gson:2.8.5 FAILED
\--- functionalTestClasspath

A web-based, searchable dependency report is available by adding the --scan option.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>The error message mentions the missing <code>com.google.code.gson:gson-test-fixtures</code> capability, which is indeed not defined for this library.
That&#8217;s because by convention, for projects that use the <code>java-test-fixtures</code> plugin, Gradle automatically creates test fixtures variants with a capability whose name is the name of the main component, with the appendix <code>-test-fixtures</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you publish your library and use test fixtures, but do not want to publish the fixtures, you can deactivate publishing of the <em>test fixtures variants</em> as shown below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 458. Disable publishing of test fixtures variants</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">components.java.withVariantsFromConfiguration(configurations.testFixturesApiElements) { skip() }
components.java.withVariantsFromConfiguration(configurations.testFixturesRuntimeElements) { skip() }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val javaComponent = components[&quot;java&quot;] as AdhocComponentWithVariants
javaComponent.withVariantsFromConfiguration(configurations[&quot;testFixturesApiElements&quot;]) { skip() }
javaComponent.withVariantsFromConfiguration(configurations[&quot;testFixturesRuntimeElements&quot;]) { skip() }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency_management_for_java_projects"><a class="anchor" href="#dependency_management_for_java_projects"></a><a class="link" href="#dependency_management_for_java_projects">Managing Dependencies of JVM Projects</a></h3>
<div class="paragraph">
<p>This chapter explains how to apply basic dependency management concepts to JVM-based projects.
For a detailed introduction to dependency management, see <a href="#">dependency management in Gradle</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:setting_up_a_standard_build_script_java_tutorial"><a class="anchor" href="#sec:setting_up_a_standard_build_script_java_tutorial"></a><a class="link" href="#sec:setting_up_a_standard_build_script_java_tutorial">Dissecting a typical build script</a></h4>
<div class="paragraph">
<p>Let&#8217;s have a look at a very simple build script for a JVM-based project.
It applies the <a href="#java_library_plugin">Java Library plugin</a> which automatically introduces a standard project layout, provides tasks for performing typical work and adequate support for dependency management.</p>
</div>
<div class="exampleblock">
<div class="title">Example 459. Dependency declarations for a JVM-based project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}

repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
    api <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:23.0</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.+</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
    api(&quot;com.google.guava:guava:23.0&quot;)
    testImplementation(&quot;junit:junit:4.+&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:dependencies(groovy.lang.Closure)">Project.dependencies{}</a> code block declares that Hibernate core 3.6.7.Final is required to compile the project&#8217;s production source code. It also states that junit &gt;= 4.0 is required to compile the project&#8217;s tests. All dependencies are supposed to be looked up in the Maven Central repository as defined by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">Project.repositories{}</a>. The following sections explain each aspect in more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:module_dependencies_java_tutorial"><a class="anchor" href="#sec:module_dependencies_java_tutorial"></a><a class="link" href="#sec:module_dependencies_java_tutorial">Declaring module dependencies</a></h4>
<div class="paragraph">
<p>There are various <a href="#sec:dependency-types">types of dependencies</a> that you can declare.
One such type is a <em>module dependency</em>.
A <a href="#sub:module_dependencies">module dependency</a> represents a dependency on a module with a specific version built outside the current build.
Modules are usually stored in a repository, such as Maven Central, a corporate Maven or Ivy repository, or a directory in the local file system.</p>
</div>
<div class="paragraph">
<p>To define an module dependency, you add it to a <a href="#sec:configurations_java_tutorial">dependency configuration</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 460. Definition of a module dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-core:3.6.7.Final</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.hibernate:hibernate-core:3.6.7.Final&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To find out more about defining dependencies, have a look at <a href="#">Declaring Dependencies</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:configurations_java_tutorial"><a class="anchor" href="#sec:configurations_java_tutorial"></a><a class="link" href="#sec:configurations_java_tutorial">Using dependency configurations</a></h4>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.Configuration.html">Configuration</a> is a named set of dependencies and artifacts. There are three main purposes for a <em>configuration</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaring dependencies</dt>
<dd>
<p>A plugin uses configurations to make it easy for build authors to declare what other subprojects or external artifacts are needed for various purposes during the execution of tasks defined by the plugin. For example a plugin may need the Spring web framework dependency to compile the source code.</p>
</dd>
<dt class="hdlist1">Resolving dependencies</dt>
<dd>
<p>A plugin uses configurations to find (and possibly download) inputs to the tasks it defines. For example Gradle needs to download Spring web framework JAR files from Maven Central.</p>
</dd>
<dt class="hdlist1">Exposing artifacts for consumption</dt>
<dd>
<p>A plugin uses configurations to define what <em>artifacts</em> it generates for other projects to consume. For example the project would like to publish its compiled source code packaged in the JAR file to an in-house Artifactory repository.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With those three purposes in mind, let&#8217;s take a look at a few of the <a href="#sec:java_library_configurations_graph">standard configurations defined by the Java Library Plugin</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">implementation</dt>
<dd>
<p>The dependencies required to compile the production source of the project which <em>are not</em> part of the API exposed by the project. For example the project uses Hibernate for its internal persistence layer implementation.</p>
</dd>
<dt class="hdlist1">api</dt>
<dd>
<p>The dependencies required to compile the production source of the project which <em>are</em> part of the API exposed by the project. For example the project uses Guava and exposes public interfaces with Guava classes in their method signatures.</p>
</dd>
<dt class="hdlist1">testImplementation</dt>
<dd>
<p>The dependencies required to compile and run the test source of the project. For example the project decided to write test code with the test framework JUnit.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Various plugins add further standard configurations.
You can also define your own custom configurations in your build via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:configurations(groovy.lang.Closure)">Project.configurations{}</a>.
See <a href="#sec:what-are-dependency-configurations">What are dependency configurations</a> for the details of defining and customizing dependency configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:repositories_java_tutorial"><a class="anchor" href="#sec:repositories_java_tutorial"></a><a class="link" href="#sec:repositories_java_tutorial">Declaring common Java repositories</a></h4>
<div class="paragraph">
<p>How does Gradle know where to find the files for external dependencies? Gradle looks for them in a <em>repository</em>.
A repository is a collection of modules, organized by <code>group</code>, <code>name</code> and <code>version</code>.
Gradle understands different <a href="#sec:repository-types">repository types</a>, such as Maven and Ivy, and supports various ways of accessing the repository via HTTP or other protocols.</p>
</div>
<div class="paragraph">
<p>By default, Gradle does not define any repositories. You need to define at least one with the help of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:repositories(groovy.lang.Closure)">Project.repositories{}</a> before you can use module dependencies. One option is use the Maven Central repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 461. Usage of Maven central repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also have repositories on the local file system. This works for both Maven and Ivy repositories.</p>
</div>
<div class="exampleblock">
<div class="title">Example 462. Usage of a local Ivy directory</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    ivy {
        <span class="comment">// URL can refer to a local directory</span>
        url <span class="string"><span class="delimiter">&quot;</span><span class="content">../local-repo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    ivy {
        // URL can refer to a local directory
        url = uri(&quot;../local-repo&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A project can have multiple repositories. Gradle will look for a dependency in each repository in the order they are specified, stopping at the first repository that contains the requested module.</p>
</div>
<div class="paragraph">
<p>To find out more about defining repositories, have a look at <a href="#">Declaring Repositories</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_artifacts_java_tutorial"><a class="anchor" href="#sec:publishing_artifacts_java_tutorial"></a><a class="link" href="#sec:publishing_artifacts_java_tutorial">Publishing artifacts</a></h4>
<div class="paragraph">
<p>To learn more about publishing artifacts, have a look at <a href="#">publishing plugins</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:native_projects"><a class="anchor" href="#part:native_projects"></a><a class="link" href="#part:native_projects">C++ &amp; Other Native Projects</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="building_cpp_projects"><a class="anchor" href="#building_cpp_projects"></a><a class="link" href="#building_cpp_projects">Building C&#43;&#43; projects</a></h3>
<div class="paragraph">
<p>Gradle uses a convention-over-configuration approach to building native projects.
If you are coming from another native build system, these concepts may be unfamiliar at first, but they serve a purpose to simplify build script authoring.</p>
</div>
<div class="paragraph">
<p>We will look at C&#43;&#43; projects in detail in this chapter, but most of the topics will apply to other supported native languages as well.
If you dont have much experience with building native projects with Gradle, take a look at the C&#43;&#43; tutorials for step-by-step instructions on how to build various types of basic C&#43;&#43; projects as well as some common use cases.</p>
</div>
<div class="paragraph">
<p>The C&#43;&#43; plugins covered in this chapter were <a href="https://blog.gradle.org/introducing-the-new-cpp-plugins">introduced in 2018</a> and we recommend users to use those plugins over <a href="#">the older Native plugins</a> that you may find references to.</p>
</div>
<div class="sect3">
<h4 id="sec:cpp_introduction"><a class="anchor" href="#sec:cpp_introduction"></a><a class="link" href="#sec:cpp_introduction">Introduction</a></h4>
<div class="paragraph">
<p>The simplest build script for a C&#43;&#43; project applies the C&#43;&#43; application plugin or the C&#43;&#43; library plugin and optionally sets the project version:</p>
</div>
<div class="exampleblock">
<div class="title">Example 463. Applying the C&#43;&#43; Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">cpp-application</span><span class="delimiter">'</span></span> <span class="comment">// or 'cpp-library'</span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `cpp-application` // or `cpp-library`
}

version = &quot;1.2.1&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By applying either of the C&#43;&#43; plugins, you get a whole host of features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compileDebugCpp</code> and <code>compileReleaseCpp</code> tasks that compiles the C&#43;&#43; source files under <em>src/main/cpp</em> for the well-known debug and release build types, respectively.</p>
</li>
<li>
<p><code>linkDebug</code> and <code>linkRelease</code> tasks that link the compiled C&#43;&#43; object files into an executable for applications or shared library for libraries with shared linkage for the debug and release build types.</p>
</li>
<li>
<p><code>createDebug</code> and <code>createRelease</code> tasks that assemble the compiled C&#43;&#43; object files into a static library for libraries with static linkage for the debug and release build types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For any non-trivial C&#43;&#43; project, youll probably have some file dependencies and additional configuration specific to <em>your</em> project.</p>
</div>
<div class="paragraph">
<p>The C&#43;&#43; plugins also integrates the above tasks into the standard <a href="#sec:base_tasks">lifecycle tasks</a>. The task that produces the development binary is attached to <code>assemble</code>.  By default, the development binary is the debug variant.</p>
</div>
<div class="paragraph">
<p>The rest of the chapter explains the different ways to customize the build to your requirements when building libraries and applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:introducing_build_variants-cpp"><a class="anchor" href="#sec:introducing_build_variants-cpp"></a><a class="link" href="#sec:introducing_build_variants-cpp">Introducing build variants</a></h4>
<div class="paragraph">
<p>Native projects can typically produce several different binaries, such as debug or release ones, or ones that target particular platforms and processor architectures.
Gradle manages this through the concepts of <em>dimensions</em> and <em>variants</em>.</p>
</div>
<div class="paragraph">
<p>A dimension is simply a category, where each category is orthogonal to the rest.
For example, the "build type" dimension is a category that includes debug and release.
The "architecture" dimension covers processor architectures like x86-64 and PowerPC.</p>
</div>
<div class="paragraph">
<p>A variant is a combination of values for these dimensions, consisting of exactly one value for each dimension.
You might have a "debug x86-64" or a "release PowerPC" variant.</p>
</div>
<div class="paragraph">
<p>Gradle has built-in support for several dimensions and several values within each dimension.
You can find a list of them in the <a href="#native_languages">native plugin reference chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cpp_source_sets"><a class="anchor" href="#sec:cpp_source_sets"></a><a class="link" href="#sec:cpp_source_sets">Declaring your source files</a></h4>
<div class="paragraph">
<p>Gradles C&#43;&#43; support uses a <code>ConfigurableFileCollection</code> directly from the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppApplication.html">application</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppLibrary.html">library</a> script block to configure the set of sources to compile.</p>
</div>
<div class="paragraph">
<p>Libraries make a distinction between private (implementation details) and public (exported to consumer) headers.</p>
</div>
<div class="paragraph">
<p>You can also configure sources for each binary build for those cases where sources are compiled only on certain target machines.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/cpp-sourcesets-compilation.png" alt="cpp sourcesets compilation">
</div>
<div class="title">Figure 27. Sources and C&#43;&#43; compilation</div>
</div>
<div class="paragraph">
<p>Test sources are configured on each test suite script block. See <a href="#">Testing C&#43;&#43; projects</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cpp_dependency_management_overview"><a class="anchor" href="#sec:cpp_dependency_management_overview"></a><a class="link" href="#sec:cpp_dependency_management_overview">Managing your dependencies</a></h4>
<div class="paragraph">
<p>The vast majority of projects rely on other projects, so managing your project&#8217;s dependencies is an important part of building any project.
Dependency management is a big topic, so we will only focus on the basics for C&#43;&#43; projects here.
If youd like to dive into the details, check out the <a href="#">introduction to dependency management</a>.</p>
</div>
<div class="paragraph">
<p>Gradle provides support for consuming pre-built binaries from Maven repositories published by Gradle <sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>We will cover how to add dependencies between projects within a multi-build project.</p>
</div>
<div class="paragraph">
<p>Specifying dependencies for your C&#43;&#43; project requires two pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identifying information for the dependency (project path, Maven GAV)</p>
</li>
<li>
<p>What its needed for, e.g. compilation, linking, runtime or all of the above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information is specified in a <code>dependencies {}</code> block of the C&#43;&#43; <code>application</code> or <code>library</code> script block.
For example, to tell Gradle that your project requires library <code>common</code> to compile and link your production code, you can use the following fragment:</p>
</div>
<div class="exampleblock">
<div class="title">Example 464. Declaring dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:common</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    dependencies {
        implementation(project(&quot;:common&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Gradle terminology for the three elements is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Configuration</em> (ex: <code>implementation</code>) - a named collection of dependencies, grouped together for a specific goal such as compiling or linking a module</p>
</li>
<li>
<p><em>Project reference</em> (ex: <code>project(':common')</code>) - the project referenced by the specified path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a more comprehensive glossary of dependency management terms <a href="#">here</a>.</p>
</div>
<div class="paragraph">
<p>As far as configurations go, the main ones of interest are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>implementation</code> - used for compilation, linking and runtime</p>
</li>
<li>
<p><code>cppCompile<em>Variant</em></code> - for dependencies that are necessary to compile your production code but shouldnt be part of the linking or runtime process</p>
</li>
<li>
<p><code>nativeLink<em>Variant</em></code> - for dependencies that are necessary to link your code but shouldnt be part of the compilation or runtime process</p>
</li>
<li>
<p><code>nativeRuntime<em>Variant</em></code> - for dependencies that are necessary to run your component but shouldnt be part of the compilation or linking process</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about these and how they relate to one another in the <a href="#native_languages">native plugin reference chapter</a>.</p>
</div>
<div class="paragraph">
<p>Be aware that the <a href="cpp_library_plugin.html">C&#43;&#43; Library Plugin</a> creates an additional configuration  <code>api</code>  for dependencies that are required for compiling and linking both the module and any modules that depend on it.</p>
</div>
<div class="paragraph">
<p>We have only scratched the surface here, so we recommend that you read the <a href="#">dedicated dependency management chapters</a> once youre comfortable with the basics of building C&#43;&#43; projects with Gradle.</p>
</div>
<div class="paragraph">
<p>Some common scenarios that require further reading include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defining a custom <a href="#sec:maven_repo">Maven-compatible</a> repository</p>
</li>
<li>
<p>Declaring dependencies with <a href="#sub:declaring_dependency_with_changing_version">changing</a> (e.g. SNAPSHOT) and <a href="#sub:declaring_dependency_with_dynamic_version">dynamic</a> (range) versions</p>
</li>
<li>
<p>Declaring a sibling <a href="#sub:project_dependencies">project as a dependency</a></p>
</li>
<li>
<p><a href="#">Controlling transitive dependencies and their versions</a></p>
</li>
<li>
<p>Testing your fixes to 3rd-party dependency via <a href="#composite_builds">composite builds</a> (a better alternative to publishing to and consuming from <a href="#sub:maven_local">Maven Local</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Youll discover that Gradle has a rich API for working with dependencies  one that takes time to master, but is straightforward to use for common scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cpp_compile_link"><a class="anchor" href="#sec:cpp_compile_link"></a><a class="link" href="#sec:cpp_compile_link">Compiling and linking your code</a></h4>
<div class="paragraph">
<p>Compiling both your code can be trivially easy if you follow the conventions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put your source code under the <em>src/main/cpp</em> directory</p>
</li>
<li>
<p>Declare your compile dependencies in the <code>implementation</code> configurations (see the previous section)</p>
</li>
<li>
<p>Run the <code>assemble</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend that you follow these conventions wherever possible, but you dont have to.</p>
</div>
<div class="paragraph">
<p>There are several options for customization, as youll see next.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.tasks.CppCompile.html">CppCompile</a> tasks are incremental and cacheable.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:cpp_supported_tool_chain"><a class="anchor" href="#sec:cpp_supported_tool_chain"></a><a class="link" href="#sec:cpp_supported_tool_chain">Supported tool chain</a></h5>
<div class="paragraph">
<p>Gradle offers the ability to execute the same build using different tool chains.
When you build a native binary, Gradle will attempt to locate a tool chain installed on your machine that can build the binary.
Gradle select the first tool chain that can build for the target operating system and architecture.
In the future, Gradle will consider source and ABI compatibility when selecting a tool chain.</p>
</div>
<div class="paragraph">
<p>Gradle has general support for the three major tool chains on major operating system: Clang <sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup>, GCC <sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup> and Visual C&#43;&#43; <sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnotedef_17" title="View footnote.">17</a>]</sup> (Windows-only).
GCC and Clang installed using Macports and Homebrew have been reported to work fine, but this isnt tested continuously.</p>
</div>
<div class="sect5">
<h6 id="windows"><a class="anchor" href="#windows"></a><a class="link" href="#windows">Windows</a></h6>
<div class="paragraph">
<p>To build on Windows, install a compatible version of Visual Studio.
The C&#43;&#43; plugins will discover the Visual Studio installations and select the latest version.
There is no need to mess around with environment variables or batch scripts.
This works fine from a Cygwin shell or the Windows command-line.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can install Cygwin or MinGW with GCC.
Clang is currently not supported.</p>
</div>
</div>
<div class="sect5">
<h6 id="macos"><a class="anchor" href="#macos"></a><a class="link" href="#macos">macOS</a></h6>
<div class="paragraph">
<p>To build on macOS, you should install Xcode.
The C&#43;&#43; plugins will discover the Xcode installation using the system PATH.</p>
</div>
<div class="paragraph">
<p>The C&#43;&#43; plugins also work with GCC and Clang installed with Macports or Homebrew <sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnotedef_18" title="View footnote.">18</a>]</sup>.
To use one of the Macports or Homebrew, you will need to add Macports/Homebrew to the system PATH.</p>
</div>
</div>
<div class="sect5">
<h6 id="linux"><a class="anchor" href="#linux"></a><a class="link" href="#linux">Linux</a></h6>
<div class="paragraph">
<p>To build on Linux, install a compatible version of GCC or Clang.
The C&#43;&#43; plugins will discover GCC or Clang using the system PATH.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_cpp_source_set_paths"><a class="anchor" href="#sec:custom_cpp_source_set_paths"></a><a class="link" href="#sec:custom_cpp_source_set_paths">Customizing file and directory locations</a></h5>
<div class="paragraph">
<p>Imagine you have a legacy library project that uses an <em>src</em> directory for the production code and private headers and <em>include</em> directory for exported headers.
The conventional directory structure wont work, so you need to tell Gradle where to find the source and header files.
You do that via the <code>application</code> or <code>library</code> script block.</p>
</div>
<div class="paragraph">
<p>Each component script block, as well as each binary, defines where its source code resides.
You can override the convention values by using the following syntax:</p>
</div>
<div class="exampleblock">
<div class="title">Example 465. Setting C&#43;&#43; source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    library {
        source.from file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        privateHeaders.from file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        publicHeaders.from file(<span class="string"><span class="delimiter">'</span><span class="content">include</span><span class="delimiter">'</span></span>)
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    extensions.configure&lt;CppLibrary&gt; {
        source.from(file(&quot;src&quot;))
        privateHeaders.from(file(&quot;src&quot;))
        publicHeaders.from(file(&quot;include&quot;))
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now Gradle will only search directly in <em>src</em> for the source and private headers and in <em>include</em> for public headers.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_cpp_compile_link"><a class="anchor" href="#sec:custom_cpp_compile_link"></a><a class="link" href="#sec:custom_cpp_compile_link">Changing compiler and linker options</a></h5>
<div class="paragraph">
<p>Most of the compiler and linker options are accessible through the corresponding task, such as <code>compile<em>Variant</em>Cpp</code>, <code>link<em>Variant</em></code> and <code>create<em>Variant</em></code>.
These tasks are of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.tasks.CppCompile.html">CppCompile</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.LinkSharedLibrary.html">LinkSharedLibrary</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.CreateStaticLibrary.html">CreateStaticLibrary</a> respectively.
Read the task reference for an up-to-date and comprehensive list of the options.</p>
</div>
<div class="paragraph">
<p>For example, if you want to change the warning level generated by the compiler for all variants, you can use this configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 466. Setting C&#43;&#43; compiler options for all variants</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(CppCompile).configureEach {
    <span class="comment">// Define a preprocessor macro for every binary</span>
    macros.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">NDEBUG</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>)

    <span class="comment">// Define a compiler options</span>
    compilerArgs.add <span class="string"><span class="delimiter">'</span><span class="content">-W3</span><span class="delimiter">'</span></span>

    <span class="comment">// Define toolchain-specific compiler options</span>
    compilerArgs.addAll toolChain.map { toolChain -&gt;
        <span class="keyword">if</span> (toolChain <span class="keyword">in</span> [ Gcc, Clang ]) {
            <span class="keyword">return</span> [<span class="string"><span class="delimiter">'</span><span class="content">-O2</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-fno-access-control</span><span class="delimiter">'</span></span>]
        } <span class="keyword">else</span> <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
            <span class="keyword">return</span> [<span class="string"><span class="delimiter">'</span><span class="content">/Zi</span><span class="delimiter">'</span></span>]
        }
        <span class="keyword">return</span> <span class="type">[]</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType(CppCompile::class.java).configureEach {
    // Define a preprocessor macro for every binary
    macros.put(&quot;NDEBUG&quot;, null)

    // Define a compiler options
    compilerArgs.add(&quot;-W3&quot;)

    // Define toolchain-specific compiler options
    compilerArgs.addAll(toolChain.map { toolChain -&gt;
        when (toolChain) {
            is Gcc, is Clang -&gt; listOf(&quot;-O2&quot;, &quot;-fno-access-control&quot;)
            is VisualCpp -&gt; listOf(&quot;/Zi&quot;)
            else -&gt; listOf()
        }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Its also possible to find the instance for a specific variant through the <code>BinaryCollection</code> on the <code>application</code> or <code>library</code> script block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 467. Setting C&#43;&#43; compiler options per variant</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    binaries.configureEach(CppStaticLibrary) {
        <span class="comment">// Define a preprocessor macro for every binary</span>
        compileTask.get().macros.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">NDEBUG</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>)

        <span class="comment">// Define a compiler options</span>
        compileTask.get().compilerArgs.add <span class="string"><span class="delimiter">'</span><span class="content">-W3</span><span class="delimiter">'</span></span>

        <span class="comment">// Define toolchain-specific compiler options</span>
        <span class="keyword">if</span> (toolChain <span class="keyword">in</span> [ Gcc, Clang ]) {
            compileTask.get().compilerArgs.addAll([<span class="string"><span class="delimiter">'</span><span class="content">-O2</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-fno-access-control</span><span class="delimiter">'</span></span>])
        } <span class="keyword">else</span> <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
            compileTask.get().compilerArgs.add(<span class="string"><span class="delimiter">'</span><span class="content">/Zi</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    binaries.configureEach(CppStaticLibrary::class.java) {
        // Define a preprocessor macro for every binary
        compileTask.get().macros.put(&quot;NDEBUG&quot;, null)

        // Define a compiler options
        compileTask.get().compilerArgs.add(&quot;-W3&quot;)

        // Define toolchain-specific compiler options
        when (toolChain) {
            is Gcc, is Clang -&gt; compileTask.get().compilerArgs.addAll(listOf(&quot;-O2&quot;, &quot;-fno-access-control&quot;))
            is VisualCpp -&gt; compileTask.get().compilerArgs.add(&quot;/Zi&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:select_cpp_target_machines"><a class="anchor" href="#sec:select_cpp_target_machines"></a><a class="link" href="#sec:select_cpp_target_machines">Selecting target machines</a></h5>
<div class="paragraph">
<p>By default, Gradle will attempt to create a C&#43;&#43; binary variant for the host operating system and architecture.
It is possible to override this by specifying the set of <code>TargetMachine</code> on the <code>application</code> or <code>library</code> script block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 468. Setting target machines</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    targetMachines = [
        machines.linux.x86_64,
        machines.windows.x86, machines.windows.x86_64,
        machines.macOS.x86_64
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    targetMachines.set(listOf(machines.windows.x86, machines.windows.x86_64, machines.macOS.x86_64, machines.linux.x86_64))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:cpp_packaging"><a class="anchor" href="#sec:cpp_packaging"></a><a class="link" href="#sec:cpp_packaging">Packaging and publishing</a></h4>
<div class="paragraph">
<p>How you package and potentially publish your C&#43;&#43; project varies greatly in the native world.
Gradle comes with defaults, but custom packaging can be implemented without any issues.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Executable files are published directly to Maven repositories.</p>
</li>
<li>
<p>Shared and static library files are published directly to Maven repositories along with a zip of the public headers.</p>
</li>
<li>
<p>For applications, Gradle also supports installing and running the executable with all of its shared library dependencies in a known location.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:cleaning_cpp_build"><a class="anchor" href="#sec:cleaning_cpp_build"></a><a class="link" href="#sec:cleaning_cpp_build">Cleaning the build</a></h4>
<div class="paragraph">
<p>The C&#43;&#43; Application and Library Plugins add a <code>clean</code> task to you project by using the <a href="#">base plugin</a>.
This task simply deletes everything in the <code>$buildDir</code> directory, hence why you should always put files generated by the build in there.
The task is an instance of Delete and you can change what directory it deletes by setting its <code>dir</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_cpp_libraries"><a class="anchor" href="#sec:building_cpp_libraries"></a><a class="link" href="#sec:building_cpp_libraries">Building C&#43;&#43; libraries</a></h4>
<div class="paragraph">
<p>The unique aspect of library projects is that they are used (or "consumed") by other C&#43;&#43; projects.
That means the dependency metadata published with the binaries and headers  in the form of Gradle Module Metadata  is crucial.
In particular, consumers of your library should be able to distinguish between two different types of dependencies: those that are only required to compile your library and those that are also required to compile the consumer.</p>
</div>
<div class="paragraph">
<p>Gradle manages this distinction via the <a href="cpp_library_plugin.html">C&#43;&#43; Library Plugin</a>, which introduces an <em>api</em> configuration in addition to the <em>implementation</em> once covered in this chapter.
If the types from a dependency appear as unresolved symbols of the static library or within the public headers then that dependency is exposed via your librarys public API and should, therefore, be added to the <em>api</em> configuration.
Otherwise, the dependency is an internal implementation detail and should be added to <em>implementation</em>.</p>
</div>
<div class="paragraph">
<p>If youre unsure of the difference between an API and implementation dependency, the <a href="cpp_library_plugin.html#sec:cpp_library_api_vs_implementation">C&#43;&#43; Library Plugin</a> chapter has a detailed explanation.
In addition, you can see a basic, practical example of building a C&#43;&#43; library in the corresponding <a href="https://guides.gradle.org/building-cpp-libraries">guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_cpp_applications"><a class="anchor" href="#sec:building_cpp_applications"></a><a class="link" href="#sec:building_cpp_applications">Building C&#43;&#43; applications</a></h4>
<div class="paragraph">
<p>See the <a href="cpp_application_plugin.html">C&#43;&#43; Application Plugin</a> chapter for more details, but heres a quick summary of what you get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>install</code> create a directory containing everything needed to run it</p>
</li>
<li>
<p>Shell and Windows Batch scripts to start the application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see a basic example of building a C&#43;&#43; application in the corresponding <a href="https://guides.gradle.org/building-cpp-applications">guide</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cpp_testing"><a class="anchor" href="#cpp_testing"></a><a class="link" href="#cpp_testing">Testing in C++ projects</a></h3>
<div class="paragraph">
<p>Testing in the native ecosystem takes many forms.</p>
</div>
<div class="paragraph">
<p>There are different testing libraries and frameworks, as well as many different types of test.
All need to be part of the build, whether they are executed frequently or infrequently.
This chapter is dedicated to explaining how Gradle handles differing requirements between and within builds, with significant coverage of how it integrates with the executable-based testing frameworks, such as <a href="https://github.com/google/googletest">Google Test</a>.</p>
</div>
<div class="paragraph">
<p>Testing C++ projects in Gradle is fairly limited when compared to <a href="#java_testing">Testing in Java &amp; JVM projects</a>. In this chapter, we explain the ways to control how tests are run (<a href="#sec:cpp_test_execution">Test execution</a>).</p>
</div>
<div class="paragraph">
<p>But first, we look at the basics of native testing in Gradle.</p>
</div>
<div class="sect3">
<h4 id="sec:cpp_testing_basics"><a class="anchor" href="#sec:cpp_testing_basics"></a><a class="link" href="#sec:cpp_testing_basics">The basics</a></h4>
<div class="paragraph">
<p>All C++ testing revolves around a single task type: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a>.
This runs a single test executable built with any testing framework and asserts the execution was successful using the exit code of the executable.
The test case results arent collected and no reports are generated.</p>
</div>
<div class="paragraph">
<p>In order to operate, the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> task type requires just one piece of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Where to find the built test executable (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html#org.gradle.nativeplatform.test.tasks.RunTestExecutable:executable">RunTestExecutable.getExecutable()</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When youre using the <a href="cpp_unit_test_plugin.html">C&#43;&#43; Unit Test Plugin</a> you will automatically get the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dedicated <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cpp.CppTestSuite.html">unitTest</a> extension for configuring test component and its variants</p>
</li>
<li>
<p>A <code>run</code> task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> that runs the test executable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The test plugins configure the required pieces of information appropriately.
In addition, they attach the <code>run</code> task to the <code>check</code> lifecycle task.
It also create the <code>testImplementation</code> dependency configuration.
Dependencies that are only needed for test compilation, linking and runtime may be added to this configuration.
The <code>unitTest</code> script block behave similarly to a <code>application</code> or <code>library</code> script block.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> task has many configuration options.
We cover a number of them in the rest of the chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:cpp_test_execution"><a class="anchor" href="#sec:cpp_test_execution"></a><a class="link" href="#sec:cpp_test_execution">Test execution</a></h4>
<div class="paragraph">
<p>Gradle executes tests in a separate (forked) process.</p>
</div>
<div class="paragraph">
<p>You can control how the test process is launched via several properties on the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> task, including the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignoreFailures</code> - default: false</dt>
<dd>
<p>If this property is <code>true</code>, Gradle will continue with the projects build once the tests have completed, even if some of them have failed.
Note that, by default, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> task type always executes every test that it detects, irrespective of this setting.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.tasks.RunTestExecutable.html">RunTestExecutable</a> for details on all the available configuration options.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building_swift_projects"><a class="anchor" href="#building_swift_projects"></a><a class="link" href="#building_swift_projects">Building Swift projects</a></h3>
<div class="paragraph">
<p>Gradle uses a convention-over-configuration approach to building native projects.
If you are coming from another native build system, these concepts may be unfamiliar at first, but they serve a purpose to simplify build script authoring.</p>
</div>
<div class="paragraph">
<p>We will look at Swift projects in detail in this chapter, but most of the topics will apply to other supported native languages as well.</p>
</div>
<div class="sect3">
<h4 id="sec:swift_introduction"><a class="anchor" href="#sec:swift_introduction"></a><a class="link" href="#sec:swift_introduction">Introduction</a></h4>
<div class="paragraph">
<p>The simplest build script for a Swift project applies the Swift application plugin or the Swift library plugin and optionally sets the project version:</p>
</div>
<div class="exampleblock">
<div class="title">Example 469. Applying the Swift Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">swift-application</span><span class="delimiter">'</span></span> <span class="comment">// or 'swift-library'</span>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">1.2.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `swift-application` // or `swift-library`
}

version = &quot;1.2.1&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By applying either of the Swift plugins, you get a whole host of features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compileDebugSwift</code> and <code>compileReleaseSwift</code> tasks that compiles the Swift source files under <em>src/main/swift</em> for the well-known debug and release build types, respectively.</p>
</li>
<li>
<p><code>linkDebug</code> and <code>linkRelease</code> tasks that link the compiled Swift object files into an executable for applications or shared library for libraries with shared linkage for the debug and release build types.</p>
</li>
<li>
<p><code>createDebug</code> and <code>createRelease</code> tasks that assemble the compiled Swift object files into a static library for libraries with static linkage for the debug and release build types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For any non-trivial Swift project, youll probably have some file dependencies and additional configuration specific to <em>your</em> project.</p>
</div>
<div class="paragraph">
<p>The Swift plugins also integrates the above tasks into the standard <a href="#sec:base_tasks">lifecycle tasks</a>.
The task that produces the development binary is attached to <code>assemble</code>.
By default, the development binary is the debug variant.</p>
</div>
<div class="paragraph">
<p>The rest of the chapter explains the different ways to customize the build to your requirements when building libraries and applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:introducing_build_variants-swift"><a class="anchor" href="#sec:introducing_build_variants-swift"></a><a class="link" href="#sec:introducing_build_variants-swift">Introducing build variants</a></h4>
<div class="paragraph">
<p>Native projects can typically produce several different binaries, such as debug or release ones, or ones that target particular platforms and processor architectures.
Gradle manages this through the concepts of <em>dimensions</em> and <em>variants</em>.</p>
</div>
<div class="paragraph">
<p>A dimension is simply a category, where each category is orthogonal to the rest.
For example, the "build type" dimension is a category that includes debug and release.
The "architecture" dimension covers processor architectures like x86-64 and x86.</p>
</div>
<div class="paragraph">
<p>A variant is a combination of values for these dimensions, consisting of exactly one value for each dimension.
You might have a "debug x86-64" or a "release x86" variant.</p>
</div>
<div class="paragraph">
<p>Gradle has built-in support for several dimensions and several values within each dimension.
You can find a list of them in the <a href="#native_languages">native plugin reference chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_source_sets"><a class="anchor" href="#sec:swift_source_sets"></a><a class="link" href="#sec:swift_source_sets">Declaring your source files</a></h4>
<div class="paragraph">
<p>Gradles Swift support uses a <code>ConfigurableFileCollection</code> directly from the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.swift.SwiftApplication.html">application</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.swift.SwiftLibrary.html">library</a> script block to configure the set of sources to compile.</p>
</div>
<div class="paragraph">
<p>Libraries make a distinction between private (implementation details) and public (exported to consumer) headers.</p>
</div>
<div class="paragraph">
<p>You can also configure sources for each binary build for those cases where sources are compiled only on certain target machines.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/swift-sourcesets-compilation.png" alt="swift sourcesets compilation">
</div>
<div class="title">Figure 28. Sources and Swift compilation</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_dependency_management_overview"><a class="anchor" href="#sec:swift_dependency_management_overview"></a><a class="link" href="#sec:swift_dependency_management_overview">Managing your dependencies</a></h4>
<div class="paragraph">
<p>The vast majority of projects rely on other projects, so managing your project&#8217;s dependencies is an important part of building any project.
Dependency management is a big topic, so we will only focus on the basics for Swift projects here.
If youd like to dive into the details, check out the <a href="#">introduction to dependency management</a>.</p>
</div>
<div class="paragraph">
<p>Gradle provides support for consuming pre-built binaries from Maven repositories published by Gradle <sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnotedef_19" title="View footnote.">19</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>We will cover how to add dependencies between projects within a multi-build project.</p>
</div>
<div class="paragraph">
<p>Specifying dependencies for your Swift project requires two pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identifying information for the dependency (project path, Maven GAV)</p>
</li>
<li>
<p>What its needed for, e.g. compilation, linking, runtime or all of the above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information is specified in a <code>dependencies {}</code> block of the Swift <code>application</code> or <code>library</code> script block.
For example, to tell Gradle that your project requires library <code>common</code> to compile and link your production code, you can use the following fragment:</p>
</div>
<div class="exampleblock">
<div class="title">Example 470. Declaring dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    dependencies {
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:common</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    dependencies {
        implementation(project(&quot;:common&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Gradle terminology for the three elements is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Configuration</em> (ex: <code>implementation</code>) - a named collection of dependencies, grouped together for a specific goal such as compiling or linking a module</p>
</li>
<li>
<p><em>Project reference</em> (ex: <code>project(':common')</code>) - the project referenced by the specified path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a more comprehensive glossary of dependency management terms <a href="#">here</a>.</p>
</div>
<div class="paragraph">
<p>As far as configurations go, the main ones of interest are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>implementation</code> - used for compilation, linking and runtime</p>
</li>
<li>
<p><code>swiftCompile<em>Variant</em></code> - for dependencies that are necessary to compile your production code but shouldnt be part of the linking or runtime process</p>
</li>
<li>
<p><code>nativeLink<em>Variant</em></code> - for dependencies that are necessary to link your code but shouldnt be part of the compilation or runtime process</p>
</li>
<li>
<p><code>nativeRuntime<em>Variant</em></code> - for dependencies that are necessary to run your component but shouldnt be part of the compilation or linking process</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about these and how they relate to one another in the <a href="#native_languages">native plugin reference chapter</a>.</p>
</div>
<div class="paragraph">
<p>Be aware that the <a href="swift_library_plugin.html">Swift Library Plugin</a> creates an additional configuration  <code>api</code>  for dependencies that are required for compiling and linking both the module and any modules that depend on it.</p>
</div>
<div class="paragraph">
<p>We have only scratched the surface here, so we recommend that you read the <a href="#">dedicated dependency management chapters</a> once youre comfortable with the basics of building Swift projects with Gradle.</p>
</div>
<div class="paragraph">
<p>Some common scenarios that require further reading include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defining a custom <a href="#sec:repository-types">Maven-compatible</a> repository</p>
</li>
<li>
<p>Declaring dependencies with <a href="#sub:declaring_dependency_with_changing_version">changing</a> (e.g. SNAPSHOT) and <a href="#sub:declaring_dependency_with_dynamic_version">dynamic</a> (range) versions</p>
</li>
<li>
<p>Declaring a sibling <a href="#sub:project_dependencies">project as a dependency</a></p>
</li>
<li>
<p><a href="#">Controlling transitive dependencies and their versions</a></p>
</li>
<li>
<p>Testing your fixes to 3rd-party dependency via <a href="#">composite builds</a> (a better alternative to publishing to and consuming from <a href="#sub:maven_local">Maven Local</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Youll discover that Gradle has a rich API for working with dependencies  one that takes time to master, but is straightforward to use for common scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_compile_link"><a class="anchor" href="#sec:swift_compile_link"></a><a class="link" href="#sec:swift_compile_link">Compiling and linking your code</a></h4>
<div class="paragraph">
<p>Compiling both your code can be trivially easy if you follow the conventions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put your source code under the <em>src/main/swift</em> directory</p>
</li>
<li>
<p>Declare your compile dependencies in the <code>implementation</code> configurations (see the previous section)</p>
</li>
<li>
<p>Run the <code>assemble</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend that you follow these conventions wherever possible, but you dont have to.</p>
</div>
<div class="paragraph">
<p>There are several options for customization, as youll see next.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.swift.tasks.SwiftCompile.html">SwiftCompile</a> tasks are incremental and cacheable.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:swift_supported_tool_chain"><a class="anchor" href="#sec:swift_supported_tool_chain"></a><a class="link" href="#sec:swift_supported_tool_chain">Supported tool chain</a></h5>
<div class="paragraph">
<p>Gradle support the <a href="https://swift.org/download/">official Swift tool chain for macOS and Linux</a>.
When you build a native binary, Gradle will attempt to locate a tool chain installed on your machine that can build the binary.
Gradle select the first tool chain that can build for the target operating system, architecture and Swift language support.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For Linux users, Gradle will discover the tool chain using the system PATH.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_swift_source_set_paths"><a class="anchor" href="#sec:custom_swift_source_set_paths"></a><a class="link" href="#sec:custom_swift_source_set_paths">Customizing file and directory locations</a></h5>
<div class="paragraph">
<p>Imagine you are migrating a library project that follows the Swift Package Manager layout (e.g. <code>Sources/<em>ModuleName</em>_</code> directory for the production code).
The conventional directory structure wont work, so you need to tell Gradle where to find the source files.
You do that via the <code>application</code> or <code>library</code> script block.</p>
</div>
<div class="paragraph">
<p>Each component script block, as well as each binary, defines where its source code resides.
You can override the convention values by using the following syntax:</p>
</div>
<div class="exampleblock">
<div class="title">Example 471. Setting Swift source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    library {
        source.from file(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    extensions.configure&lt;SwiftLibrary&gt; {
        source.from(file(&quot;Sources/Common&quot;))
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now Gradle will only search directly in <em>Sources/Common</em> for the source.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:custom_swift_compile_link"><a class="anchor" href="#sec:custom_swift_compile_link"></a><a class="link" href="#sec:custom_swift_compile_link">Changing compiler and linker options</a></h5>
<div class="paragraph">
<p>Most of the compiler and linker options are accessible through the corresponding task, such as <code>compile<em>Variant</em>Swift</code>, <code>link<em>Variant</em></code> and <code>create<em>Variant</em></code>.
These tasks are of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.swift.tasks.SwiftCompile.html">SwiftCompile</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.LinkSharedLibrary.html">LinkSharedLibrary</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.tasks.CreateStaticLibrary.html">CreateStaticLibrary</a> respectively.
Read the task reference for an up-to-date and comprehensive list of the options.</p>
</div>
<div class="paragraph">
<p>For example, if you want to change the warning level generated by the compiler for all variants, you can use this configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 472. Setting Swift compiler options for all variants</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(SwiftCompile).configureEach {
    <span class="comment">// Define a preprocessor macro for every binary</span>
    macros.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">NDEBUG</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">// Define a compiler options</span>
    compilerArgs.add <span class="string"><span class="delimiter">'</span><span class="content">-O</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType(SwiftCompile::class.java).configureEach {
    // Define a preprocessor macro for every binary
    macros.add(&quot;NDEBUG&quot;)

    // Define a compiler options
    compilerArgs.add(&quot;-O&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Its also possible to find the instance for a specific variant through the <code>BinaryCollection</code> on the <code>application</code> or <code>library</code> script block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 473. Setting Swift compiler options per variant</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    binaries.configureEach(SwiftStaticLibrary) {
        <span class="comment">// Define a preprocessor macro for every binary</span>
        compileTask.get().macros.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">NDEBUG</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">// Define a compiler options</span>
        compileTask.get().compilerArgs.add <span class="string"><span class="delimiter">'</span><span class="content">-O</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    binaries.configureEach(SwiftStaticLibrary::class.java) {
        // Define a preprocessor macro for every binary
        compileTask.get().macros.add(&quot;NDEBUG&quot;)

        // Define a compiler options
        compileTask.get().compilerArgs.add(&quot;-O&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:select_swift_target_machines"><a class="anchor" href="#sec:select_swift_target_machines"></a><a class="link" href="#sec:select_swift_target_machines">Selecting target machines</a></h5>
<div class="paragraph">
<p>By default, Gradle will attempt to create a Swift binary variant for the host operating system and architecture.
It is possible to override this by specifying the set of <code>TargetMachine</code> on the <code>application</code> or <code>library</code> script block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 474. Setting target machines</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    targetMachines = [
        machines.linux.x86_64,
        machines.macOS.x86_64
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    targetMachines.set(listOf(machines.linux.x86_64, machines.macOS.x86_64))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_packaging"><a class="anchor" href="#sec:swift_packaging"></a><a class="link" href="#sec:swift_packaging">Packaging and publishing</a></h4>
<div class="paragraph">
<p>How you package and potentially publish your Swift project varies greatly in the native world.
Gradle comes with defaults, but custom packaging can be implemented without any issues.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Executable files are published directly to Maven repositories.</p>
</li>
<li>
<p>Shared and static library files are published directly to Maven repositories along with a zip of the public headers.</p>
</li>
<li>
<p>For applications, Gradle also supports installing and running the executable with all of its shared library dependencies in a known location.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:cleaning_swift_build"><a class="anchor" href="#sec:cleaning_swift_build"></a><a class="link" href="#sec:cleaning_swift_build">Cleaning the build</a></h4>
<div class="paragraph">
<p>The Swift Application and Library Plugins add a <code>clean</code> task to you project by using the <a href="#">base plugin</a>.
This task simply deletes everything in the <code>$buildDir</code> directory, hence why you should always put files generated by the build in there.
The task is an instance of Delete and you can change what directory it deletes by setting its <code>dir</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_swift_libraries"><a class="anchor" href="#sec:building_swift_libraries"></a><a class="link" href="#sec:building_swift_libraries">Building Swift libraries</a></h4>
<div class="paragraph">
<p>The unique aspect of library projects is that they are used (or "consumed") by other Swift projects.
That means the dependency metadata published with the binaries and headers  in the form of Gradle Module Metadata  is crucial.
In particular, consumers of your library should be able to distinguish between two different types of dependencies: those that are only required to compile your library and those that are also required to compile the consumer.</p>
</div>
<div class="paragraph">
<p>Gradle manages this distinction via the <a href="swift_library_plugin.html">Swift Library Plugin</a>, which introduces an <em>api</em> configuration in addition to the <em>implementation</em> once covered in this chapter.
If the types from a dependency appear as unresolved symbols of the static library or within the public headers then that dependency is exposed via your librarys public API and should, therefore, be added to the <em>api</em> configuration.
Otherwise, the dependency is an internal implementation detail and should be added to <em>implementation</em>.</p>
</div>
<div class="paragraph">
<p>If youre unsure of the difference between an API and implementation dependency, the <a href="swift_library_plugin.html#sec:swift_library_api_vs_implementation">Swift Library Plugin</a> chapter has a detailed explanation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_swift_applications"><a class="anchor" href="#sec:building_swift_applications"></a><a class="link" href="#sec:building_swift_applications">Building Swift applications</a></h4>
<div class="paragraph">
<p>See the <a href="swift_application_plugin.html">Swift Application Plugin</a> chapter for more details, but heres a quick summary of what you get:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>install</code> create a directory containing everything needed to run it</p>
</li>
<li>
<p>Shell and Windows Batch scripts to start the application</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="swift_testing"><a class="anchor" href="#swift_testing"></a><a class="link" href="#swift_testing">Testing in Swift projects</a></h3>
<div class="paragraph">
<p>Testing in the native ecosystem is a rich subject matter.
There are many different testing libraries and frameworks, as well as many different types of test.
All need to be part of the build, whether they are executed frequently or infrequently.
This chapter is dedicated to explaining how Gradle handles differing requirements between and within builds, with significant coverage of how it integrates with XCTest on both macOS and Linux.</p>
</div>
<div class="paragraph">
<p>It explains:
- Ways to control how the tests are run (Test execution)
- How to select specific tests to run (Test filtering)
- What test reports are generated and how to influence the process (Test reporting)
- How Gradle finds tests to run (Test detection)</p>
</div>
<div class="paragraph">
<p>But first, we look at the basics of native testing in Gradle.</p>
</div>
<div class="sect3">
<h4 id="sec:swift_testing_basics"><a class="anchor" href="#sec:swift_testing_basics"></a><a class="link" href="#sec:swift_testing_basics">The basics</a></h4>
<div class="paragraph">
<p>Gradle supports deep integration with XCTest testing framework for the Swift language and revolves around the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> task type.
This runs a collection of test cases using the <a href="https://developer.apple.com/documentation/xctest">Xcode XCTest</a> on macOS or the <a href="https://github.com/apple/swift-corelibs-xctest">open source Swift core library alternative</a> on Linux and collates the results.
You can then turn those results into a report via an instance of the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type.</p>
</div>
<div class="paragraph">
<p>In order to operate, the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> task type requires three pieces of information:
- Where to find the built testable bundle (on macOS) or executable (on Linux) (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html#org.gradle.nativeplatform.test.xctest.tasks.XCTest:testInstallDirectory">XCTest.getTestInstalledDirectory()</a>)
- The run script for executing the bundle or executable (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html#org.gradle.nativeplatform.test.xctest.tasks.XCTest:runScriptFile">XCTest.getRunScriptFile()</a>)
- The working directory to execution the bundle or executable (property: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html#org.gradle.nativeplatform.test.xctest.tasks.XCTest:workingDirectory">XCTest.getWorkingDirectory()</a>)</p>
</div>
<div class="paragraph">
<p>When youre using the <a href="xctest_plugin.html">XCTest Plugin</a> you will automatically get the following:
- A dedicated <code>xctest</code> extension of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.SwiftXCTestSuite.html">SwiftXCTestSuite</a> for configuring test component and its variants
- A <code>xcTest</code> task of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> that runs those unit tests
- A testable bundle or executable linked with the main components object files</p>
</div>
<div class="paragraph">
<p>The test plugins configure the required pieces of information appropriately.
In addition, they attach the <code>xcTest</code> or <code>run</code> task to the <code>check</code> lifecycle task.
It also create the <code>testImplementation</code> dependency configuration.
Dependencies that are only needed for test compilation, linking and runtime may be added to this configuration.
The <code>xctest</code> script block behave similarly to a <code>application</code> or <code>library</code> script block.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> task has many configuration options.
We cover a significant number of them in the rest of the chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="test_execution"><a class="anchor" href="#test_execution"></a><a class="link" href="#test_execution">Test execution</a></h4>
<div class="paragraph">
<p>Gradle executes tests in a separate (forked) process.</p>
</div>
<div class="paragraph">
<p>You can control how the test process is launched via several properties on the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> task, including the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignoreFailures</code> - default: false</dt>
<dd>
<p>If this property is <code>true</code>, Gradle will continue with the projects build once the tests have completed, even if some of them have failed.
Note that, by default, both task type always executes every test that it detects, irrespective of this setting.</p>
</dd>
<dt class="hdlist1"><code>testLogging</code> - default: not set</dt>
<dd>
<p>This property represents a set of options that control which test events are logged and at what level.
You can also configure other logging behavior via this property.
Set <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/testing/logging/TestLoggingContainer.html">TestLoggingContainer</a> for more detail.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> for details on all the available configuration options.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_test_filtering"><a class="anchor" href="#sec:swift_test_filtering"></a><a class="link" href="#sec:swift_test_filtering">Test filtering</a></h4>
<div class="paragraph">
<p>Its a common requirement to run subsets of a test suite, such as when youre fixing a bug or developing a new test case.
Gradle provides filtering to do this.
You can select tests to run based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A simple class name or method name, e.g. <code>SomeTest</code>, <code>SomeTest.someMethod</code></p>
</li>
<li>
<p>* wildcard matching</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable filtering either in the build script or via the <code>--tests</code> command-line option.
Heres an example of some filters that are applied every time the build runs:</p>
</div>
<div class="exampleblock">
<div class="title">Example 475. Filter tests on every build</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">xctest {
    binaries.configureEach {
        runTask.get().configure {
            <span class="comment">// include all tests from test class</span>
            filter.includeTestsMatching <span class="string"><span class="delimiter">&quot;</span><span class="content">SomeIntegTest.*</span><span class="delimiter">&quot;</span></span> <span class="comment">// or `&quot;Testing.SomeIntegTest.*&quot;` on macOS</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">xctest {
    binaries.configureEach {
        runTask.get().filter.includeTestsMatching(&quot;SomeIntegTest.*&quot;) // or `&quot;Testing.SomeIntegTest.*&quot;` on macOS
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more details and examples of declaring filters in the build script, please see the TestFilter reference.</p>
</div>
<div class="paragraph">
<p>The command-line option is especially useful to execute a single test method.
It is also possible to supply multiple <code>--tests</code> options, all of whose patterns will take effect.
The following sections have several examples of using command-line option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The test filtering only support XCTest compatible filters at the moment.
It means the same filter will differ between macOS and Linux.
On macOS, the bundle base name needs to be prepended to the filter, e.g. <code>TestBundle.SomeTest</code>, <code>TestBundle.SomeTest.someMethod</code>
See the <a href="#sec:swift_test_filtering_simple_name_pattern">Simple name pattern</a> section below for more information about valid filtering pattern.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following section looks at the specific cases of simple class/method names.</p>
</div>
<div class="sect4">
<h5 id="sec:swift_test_filtering_simple_name_pattern"><a class="anchor" href="#sec:swift_test_filtering_simple_name_pattern"></a><a class="link" href="#sec:swift_test_filtering_simple_name_pattern">Simple name pattern</a></h5>
<div class="paragraph">
<p>Gradle support simple class name, or a class name + method name test filtering.
For example, the following command lines run either all or exactly one of the tests in the <code>SomeTestClass</code> test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Executes all tests in SomeTestClass
gradle xcTest --tests SomeTestClass
# or `gradle xcTest --tests TestBundle.SomeTestClass` on macOS

# Executes a single specified test in SomeTestClass
gradle xcTest --tests TestBundle.SomeTestClass.someSpecificMethod
# or `gradle xcTest --tests TestBundle.SomeTestClass.someSpecificMethod` on macOS</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also combine filters defined at the command line with <a href="#sec:continuous_build">continuous build</a> to re-execute a subset of tests immediately after every change to a production or test source file.
The following executes all tests in the SomeTestClass test class whenever a change triggers the tests to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>gradle test --continuous --tests SomeTestClass</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:swift_test_reporting"><a class="anchor" href="#sec:swift_test_reporting"></a><a class="link" href="#sec:swift_test_reporting">Test reporting</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.xctest.tasks.XCTest.html">XCTest</a> task generates the following results by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An HTML test report</p>
</li>
<li>
<p>XML test results in a format compatible with the Ant JUnit report task - one that is supported by many other tools, such as CI servers</p>
</li>
<li>
<p>An efficient binary format of the results used by the <code>XCTest</code> task to generate the other formats</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases, youll work with the standard HTML report, which automatically includes the result from your <code>XCTest</code> tasks.</p>
</div>
<div class="paragraph">
<p>There is also a standalone <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> task type that you can use to generate a custom HTML test report.
All it requires are a value for <code>destinationDir</code> and the test results you want included in the report.
Here is a sample which generates a combined report for the unit tests from all subprojects:</p>
</div>
<div class="exampleblock">
<div class="title">Example 476. Combine test reports from all subprojects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">xctest</span><span class="delimiter">'</span></span>

    xctest {
        binaries.configureEach {
            runTask.get().configure {
                <span class="comment">// Disable the test report for the individual test task</span>
                reports.html.enabled = <span class="predefined-constant">false</span>
            }
        }
    }
}

tasks.register(<span class="string"><span class="delimiter">'</span><span class="content">testReport</span><span class="delimiter">'</span></span>, TestReport) {
    destinationDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/reports/allTests</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">// Include the results from the XCTest tasks in all subprojects</span>
    reportOn subprojects.collect {
        <span class="local-variable">it</span>.tasks.withType(XCTest)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    apply(plugin = &quot;xctest&quot;)

    extensions.configure&lt;SwiftXCTestSuite&gt;() {
        binaries.configureEach {
            // Disable the test report for the individual test task
            runTask.get().reports.html.isEnabled = false
        }
    }
}

tasks.register&lt;TestReport&gt;(&quot;testReport&quot;) {
    destinationDir = file(&quot;$buildDir/reports/allTests&quot;)

    // Include the results from the `xcTest` task in all subprojects
    reportOn(subprojects.map { it.tasks.withType&lt;XCTest&gt;() })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You should note that the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.TestReport.html">TestReport</a> type combines the results from multiple test tasks and needs to aggregate the results of individual test classes.
This means that it a given test class is executed by multiple test tasks, then the test report will include executions of that class, but it can be hard to distinguish individual executions of that class and their output.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="native_projects_using_the_software_model"><a class="anchor" href="#native_projects_using_the_software_model"></a><a class="link" href="#native_projects_using_the_software_model">Native Projects using the Software Model</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="native_software"><a class="anchor" href="#native_software"></a><a class="link" href="#native_software">Building native software</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">software model</a> is being retired and the plugins mentioned in this chapter will eventually be deprecated and removed.
We recommend new projects looking to build C++ applications and libraries use the newer <a href="#">replacement plugins</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The native software plugins add support for building native software components, such as executables or shared libraries, from code written in C++, C and other languages. While many excellent build tools exist for this space of software development, Gradle offers developers its trademark power and flexibility together with dependency management practices more traditionally found in the JVM development space.</p>
</div>
<div class="paragraph">
<p>The native software plugins make use of the Gradle <a href="#software_model">software model</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:native_features"><a class="anchor" href="#sec:native_features"></a><a class="link" href="#sec:native_features">Features</a></h4>
<div class="paragraph">
<p>The native software plugins provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for building native libraries and applications on Windows, Linux, macOS and other platforms.</p>
</li>
<li>
<p>Support for several source languages.</p>
</li>
<li>
<p>Support for building different variants of the same software, for different architectures, operating systems, or for any purpose.</p>
</li>
<li>
<p>Incremental parallel compilation, precompiled headers.</p>
</li>
<li>
<p>Dependency management between native software components.</p>
</li>
<li>
<p>Unit test execution.</p>
</li>
<li>
<p>Generate Visual studio solution and project files.</p>
</li>
<li>
<p>Deep integration with various tool chain, including discovery of installed tool chains.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:supported_languages"><a class="anchor" href="#sec:supported_languages"></a><a class="link" href="#sec:supported_languages">Supported languages</a></h4>
<div class="paragraph">
<p>The following source languages are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>C</p>
</li>
<li>
<p>C++</p>
</li>
<li>
<p>Objective-C</p>
</li>
<li>
<p>Objective-C++</p>
</li>
<li>
<p>Assembly</p>
</li>
<li>
<p>Windows resources</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="native-binaries:tool-chain-support"><a class="anchor" href="#native-binaries:tool-chain-support"></a><a class="link" href="#native-binaries:tool-chain-support">Tool chain support</a></h4>
<div class="paragraph">
<p>Gradle offers the ability to execute the same build using different tool chains. When you build a native binary, Gradle will attempt to locate a tool chain installed on your machine that can build the binary. You can fine tune exactly how this works, see <a href="#native_binaries:tool_chain">Tool chain support</a> for details.</p>
</div>
<div class="paragraph">
<p>The following tool chains are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operating System</th>
<th class="tableblock halign-left valign-top">Tool Chain</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">GCC</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://clang.llvm.org">Clang</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the Clang tool chain bundled with XCode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://visualstudio.microsoft.com/">Visual C++</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows XP and later, Visual C++ 2010/2012/2013/2015/2017/2019.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">GCC</a> with <a href="http://cygwin.com">Cygwin 32 and Cygwin 64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows XP and later.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">GCC</a> with <a href="http://www.mingw.org/">MinGW</a> and <a href="https://mingw-w64.org/doku.php">MinGW64</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows XP and later.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following tool chains are unofficially supported. They generally work fine, but are not tested continuously:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operating System</th>
<th class="tableblock halign-left valign-top">Tool Chain</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">GCC</a> from Macports</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://clang.llvm.org">Clang</a> from Macports</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNIX-like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gcc.gnu.org/">GCC</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNIX-like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://clang.llvm.org">Clang</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:tool_chain_installation"><a class="anchor" href="#sec:tool_chain_installation"></a><a class="link" href="#sec:tool_chain_installation">Tool chain installation</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that if you are using GCC then you currently need to install support for C++, even if you are not building from C++ source. This restriction will be removed in a future Gradle version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To build native software, you will need to have a compatible tool chain installed:</p>
</div>
<div class="sect4">
<h5 id="sec:windows"><a class="anchor" href="#sec:windows"></a><a class="link" href="#sec:windows">Windows</a></h5>
<div class="paragraph">
<p>To build on Windows, install a compatible version of Visual Studio. The native plugins will discover the Visual Studio installations and select the latest version. There is no need to mess around with environment variables or batch scripts. This works fine from a Cygwin shell or the Windows command-line.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can install Cygwin with GCC or MinGW. Clang is currently not supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:macOS"><a class="anchor" href="#sec:macOS"></a><a class="link" href="#sec:macOS">macOS</a></h5>
<div class="paragraph">
<p>To build on macOS, you should install XCode. The native plugins will discover the XCode installation using the system PATH.</p>
</div>
<div class="paragraph">
<p>The native plugins also work with GCC and Clang bundled with Macports. To use one of the Macports tool chains, you will need to make the tool chain the default using the <code>port select</code> command and add Macports to the system PATH.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:linux"><a class="anchor" href="#sec:linux"></a><a class="link" href="#sec:linux">Linux</a></h5>
<div class="paragraph">
<p>To build on Linux, install a compatible version of GCC or Clang. The native plugins will discover GCC or Clang using the system PATH.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:native_software_model"><a class="anchor" href="#sec:native_software_model"></a><a class="link" href="#sec:native_software_model">Native software model</a></h4>
<div class="paragraph">
<p>The native software model builds on the base Gradle <a href="#software_model_concepts">software model</a>.</p>
</div>
<div class="paragraph">
<p>To build native software using Gradle, your project should define one or more <em>native components</em>. Each component represents either an executable or a library that Gradle should build. A project can define any number of components. Gradle does not define any components by default.</p>
</div>
<div class="paragraph">
<p>For each component, Gradle defines a <em>source set</em> for each language that the component can be built from. A source set is essentially just a set of source directories containing source files. For example, when you apply the <code>c</code> plugin and define a library called <code>helloworld</code>, Gradle will define, by default, a source set containing the C source files in the <code>src/helloworld/c</code> directory. It will use these source files to build the <code>helloworld</code> library. This is described in more detail below.</p>
</div>
<div class="paragraph">
<p>For each component, Gradle defines one or more <em>binaries</em> as output. To build a binary, Gradle will take the source files defined for the component, compile them as appropriate for the source language, and link the result into a binary file. For an executable component, Gradle can produce executable binary files. For a library component, Gradle can produce both static and shared library binary files. For example, when you define a library called <code>helloworld</code> and build on Linux, Gradle will, by default, produce <code>libhelloworld.so</code> and <code>libhelloworld.a</code> binaries.</p>
</div>
<div class="paragraph">
<p>In many cases, more than one binary can be produced for a component. These binaries may vary based on the tool chain used to build, the compiler/linker flags supplied, the dependencies provided, or additional source files provided. Each native binary produced for a component is referred to as a <em>variant</em>. Binary variants are discussed in detail below.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:parallel_compilation"><a class="anchor" href="#sec:parallel_compilation"></a><a class="link" href="#sec:parallel_compilation">Parallel Compilation</a></h4>
<div class="paragraph">
<p>Gradle uses the single build worker pool to concurrently compile and link native components, by default. No special configuration is required to enable concurrent building.</p>
</div>
<div class="paragraph">
<p>By default, the worker pool size is determined by the number of available processors on the build machine (as reported to the build JVM). To explicitly set the number of workers use the <code>--max-workers</code> command-line option or <code>org.gradle.workers.max</code> system property. There is generally no need to change this setting from its default.</p>
</div>
<div class="paragraph">
<p>The build worker pool is shared across all build tasks. This means that when using <a href="#sec:parallel_execution">parallel project execution</a>, the maximum number of concurrent individual compilation operations does not increase. For example, if the build machine has 4 processing cores and 10 projects are compiling in parallel, Gradle will only use 4 total workers, not 40.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_a_library"><a class="anchor" href="#sec:building_a_library"></a><a class="link" href="#sec:building_a_library">Building a library</a></h4>
<div class="paragraph">
<p>To build either a static or shared native library, you define a library component in the <code>components</code> container. The following sample defines a library called <code>hello</code>:</p>
</div>
<div class="sect4">
<h5 id="example_defining_a_library_component"><a class="anchor" href="#example_defining_a_library_component"></a><a class="link" href="#example_defining_a_library_component">Example: Defining a library component</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        hello(NativeLibrarySpec)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A library component is represented using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a>. Each library component can produce at least one shared library binary (<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/SharedLibraryBinarySpec.html">SharedLibraryBinarySpec</a>) and at least one static library binary (<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/StaticLibraryBinarySpec.html">StaticLibraryBinarySpec</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:building_an_executable"><a class="anchor" href="#sec:building_an_executable"></a><a class="link" href="#sec:building_an_executable">Building an executable</a></h4>
<div class="paragraph">
<p>To build a native executable, you define an executable component in the <code>components</code> container. The following sample defines an executable called <code>main</code>:</p>
</div>
<div class="sect4">
<h5 id="example_defining_executable_components"><a class="anchor" href="#example_defining_executable_components"></a><a class="link" href="#example_defining_executable_components">Example: Defining executable components</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        main(NativeExecutableSpec) {
            sources {
               c.lib <span class="key">library</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An executable component is represented using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a>. Each executable component can produce at least one executable binary (<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableBinarySpec.html">NativeExecutableBinarySpec</a>).</p>
</div>
<div class="paragraph">
<p>For each component defined, Gradle adds a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/FunctionalSourceSet.html">FunctionalSourceSet</a> with the same name. Each of these functional source sets will contain a language-specific source set for each of the languages supported by the project.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:dependents"><a class="anchor" href="#sec:dependents"></a><a class="link" href="#sec:dependents">Assembling or building dependents</a></h4>
<div class="paragraph">
<p>Sometimes, you may need to <em>assemble</em> (compile and link) or <em>build</em> (compile, link and test) a component or binary and its <em>dependents</em> (things that depend upon the component or binary). The native software model provides tasks that enable this capability. First, the <em>dependent components</em> report gives insight about the relationships between each component. Second, the <em>build and assemble dependents</em> tasks allow you to assemble or build a component and its dependents in one step.</p>
</div>
<div class="paragraph">
<p>In the following example, the build file defines <code>OpenSSL</code> as a dependency of <code>libUtil</code> and <code>libUtil</code> as a dependency of <code>LinuxApp</code> and <code>WindowsApp</code>. Test suites are treated similarly. Dependents can be thought of as reverse dependencies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/nativeDependents.png" alt="nativeDependents">
</div>
<div class="title">Figure 29. Dependent Components Example</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By following the dependencies backwards, you can see <code>LinuxApp</code> and <code>WindowsApp</code> are <em>dependents</em> of <code>libUtil</code>. When <code>libUtil</code> is changed, Gradle will need to recompile or relink <code>LinuxApp</code> and <code>WindowsApp</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you <em>assemble</em> dependents of a component, the component and all of its dependents are compiled and linked, including any test suite binaries. Gradle&#8217;s up-to-date checks are used to only compile or link if something has changed. For instance, if you have changed source files in a way that do not affect the headers of your project, Gradle will be able to skip compilation for dependent components and only need to re-link with the new library. Tests are not run when assembling a component.</p>
</div>
<div class="paragraph">
<p>When you <em>build</em> dependents of a component, the component and all of its dependent binaries are compiled, linked <em>and checked</em>. Checking components means running any <a href="#sec:check_tasks">check task</a> including executing any test suites, so tests <em>are</em> run when building a component.</p>
</div>
<div class="paragraph">
<p>In the following sections, we will demonstrate the usage of the <code>assembleDependents*</code>, <code>buildDependents*</code> and <code>dependentComponents</code> tasks with a sample build that contains a CUnit test suite. The build script for the sample is the following:</p>
</div>
<div class="sect4">
<h5 id="example_sample_build"><a class="anchor" href="#example_sample_build"></a><a class="link" href="#example_sample_build">Example: Sample build</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">cunit-test-suite</span><span class="delimiter">'</span></span>
}

model {
    flavors {
        passing
        failing
    }
    platforms {
        x86 {
            <span class="keyword">if</span> (operatingSystem.macOsX) {
                architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x64</span><span class="delimiter">&quot;</span></span>
            } <span class="keyword">else</span> {
                architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
    components {
        operators(NativeLibrarySpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
        }
    }
    testSuites {
        operatorsTest(CUnitTestSuiteSpec) {
            testing <span class="error">$</span>.components.operators
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:dependents_report"><a class="anchor" href="#sec:dependents_report"></a><a class="link" href="#sec:dependents_report">Dependent components report</a></h5>
<div class="paragraph">
<p>Gradle provides a report that you can run from the command-line that shows a graph of components in your project and components that depend upon them. The following is an example of running <code>gradle dependentComponents</code> on the sample project:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dependent_components_report"><a class="anchor" href="#example_dependent_components_report"></a><a class="link" href="#example_dependent_components_report">Example: Dependent components report</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependentComponents</code></strong></div>
<div class="content">
<pre>&gt; gradle dependentComponents

&gt; Task :dependentComponents

------------------------------------------------------------
Root project
------------------------------------------------------------

operators - Components that depend on native library 'operators'
+--- operators:failingSharedLibrary
+--- operators:failingStaticLibrary
+--- operators:passingSharedLibrary
\--- operators:passingStaticLibrary

Some test suites were not shown, use --test-suites or --all to show them.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.reporting.dependents.DependentComponentsReport.html">DependentComponentsReport</a> API documentation for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, non-buildable binaries and test suites are hidden from the report. The <code>dependentComponents</code> task provides options that allow you to see all dependents by using the <code>--all</code> option:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dependent_components_report_2"><a class="anchor" href="#example_dependent_components_report_2"></a><a class="link" href="#example_dependent_components_report_2">Example: Dependent components report</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependentComponents --all</code></strong></div>
<div class="content">
<pre>&gt; gradle dependentComponents --all

&gt; Task :dependentComponents

------------------------------------------------------------
Root project
------------------------------------------------------------

operators - Components that depend on native library 'operators'
+--- operators:failingSharedLibrary
+--- operators:failingStaticLibrary
|    \--- operatorsTest:failingCUnitExe (t)
+--- operators:passingSharedLibrary
\--- operators:passingStaticLibrary
     \--- operatorsTest:passingCUnitExe (t)

operatorsTest - Components that depend on Cunit test suite 'operatorsTest'
+--- operatorsTest:failingCUnitExe (t)
\--- operatorsTest:passingCUnitExe (t)

(t) - Test suite binary

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the corresponding report for the <code>operators</code> component, showing dependents of all its binaries:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_report_of_components_that_depends_on_the_operators_component"><a class="anchor" href="#example_report_of_components_that_depends_on_the_operators_component"></a><a class="link" href="#example_report_of_components_that_depends_on_the_operators_component">Example: Report of components that depends on the operators component</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependentComponents --component operators</code></strong></div>
<div class="content">
<pre>&gt; gradle dependentComponents --component operators

&gt; Task :dependentComponents

------------------------------------------------------------
Root project
------------------------------------------------------------

operators - Components that depend on native library 'operators'
+--- operators:failingSharedLibrary
+--- operators:failingStaticLibrary
+--- operators:passingSharedLibrary
\--- operators:passingStaticLibrary

Some test suites were not shown, use --test-suites or --all to show them.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the corresponding report for the <code>operators</code> component, showing dependents of all its binaries, including test suites:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_report_of_components_that_depends_on_the_operators_component_including_test_suites"><a class="anchor" href="#example_report_of_components_that_depends_on_the_operators_component_including_test_suites"></a><a class="link" href="#example_report_of_components_that_depends_on_the_operators_component_including_test_suites">Example: Report of components that depends on the operators component, including test suites</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle dependentComponents --test-suites --component operators</code></strong></div>
<div class="content">
<pre>&gt; gradle dependentComponents --test-suites --component operators

&gt; Task :dependentComponents

------------------------------------------------------------
Root project
------------------------------------------------------------

operators - Components that depend on native library 'operators'
+--- operators:failingSharedLibrary
+--- operators:failingStaticLibrary
|    \--- operatorsTest:failingCUnitExe (t)
+--- operators:passingSharedLibrary
\--- operators:passingStaticLibrary
     \--- operatorsTest:passingCUnitExe (t)

(t) - Test suite binary

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:assemble_dependents"><a class="anchor" href="#sec:assemble_dependents"></a><a class="link" href="#sec:assemble_dependents">Assembling dependents</a></h5>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a>, Gradle will create a task named <code>assembleDependents<em>${component.name}${binary.variant}</em></code> that <em>assembles</em> (compile and link) the binary and all of its dependent binaries.</p>
</div>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeComponentSpec.html">NativeComponentSpec</a>, Gradle will create a task named <code>assembleDependents<em>${component.name}</em></code> that <em>assembles</em> all the binaries of the component and all of their dependent binaries.</p>
</div>
<div class="paragraph">
<p>For example, to assemble the dependents of the "passing" flavor of the "static" library binary of the "operators" component, you would run the <code>assembleDependentsOperatorsPassingStaticLibrary</code> task:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_assemble_components_that_depends_on_the_passingstatic_binary_of_the_operators_component"><a class="anchor" href="#example_assemble_components_that_depends_on_the_passingstatic_binary_of_the_operators_component"></a><a class="link" href="#example_assemble_components_that_depends_on_the_passingstatic_binary_of_the_operators_component">Example: Assemble components that depends on the passing/static binary of the operators component</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle assembleDependentsOperatorsPassingStaticLibrary --max-workers=1</code></strong></div>
<div class="content">
<pre>&gt; gradle assembleDependentsOperatorsPassingStaticLibrary --max-workers=1
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsC
&gt; Task :operatorsTestCUnitLauncher
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsTestC
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsTestCunitLauncher
&gt; Task :linkOperatorsTestPassingCUnitExe
&gt; Task :operatorsTestPassingCUnitExe
&gt; Task :assembleDependentsOperatorsTestPassingCUnitExe
&gt; Task :compileOperatorsPassingStaticLibraryOperatorsC
&gt; Task :createOperatorsPassingStaticLibrary
&gt; Task :operatorsPassingStaticLibrary
&gt; Task :assembleDependentsOperatorsPassingStaticLibrary

BUILD SUCCESSFUL in 0s
7 actionable tasks: 7 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In the output above, the targeted binary gets assembled as well as the test suite binary that depends on it.</p>
</div>
<div class="paragraph">
<p>You can also assemble <em>all</em> of the dependents of a component (i.e. of all its binaries/variants) using the corresponding component task, e.g. <code>assembleDependentsOperators</code>. This is useful if you have many combinations of build types, flavors and platforms and want to assemble all of them.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:build_dependents"><a class="anchor" href="#sec:build_dependents"></a><a class="link" href="#sec:build_dependents">Building dependents</a></h5>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a>, Gradle will create a task named <code>buildDependents<em>${component.name}${binary.variant}</em></code> that <em>builds</em> (compile, link and check) the binary and all of its dependent binaries.</p>
</div>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeComponentSpec.html">NativeComponentSpec</a>, Gradle will create a task named <code>buildDependents<em>${component.name}</em></code> that <em>builds</em> all the binaries of the component and all of their dependent binaries.</p>
</div>
<div class="paragraph">
<p>For example, to build the dependents of the "passing" flavor of the "static" library binary of the "operators" component, you would run the <code>buildDependentsOperatorsPassingStaticLibrary</code> task:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_build_components_that_depends_on_the_passingstatic_binary_of_the_operators_component"><a class="anchor" href="#example_build_components_that_depends_on_the_passingstatic_binary_of_the_operators_component"></a><a class="link" href="#example_build_components_that_depends_on_the_passingstatic_binary_of_the_operators_component">Example: Build components that depends on the passing/static binary of the operators component</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle buildDependentsOperatorsPassingStaticLibrary --max-workers=1</code></strong></div>
<div class="content">
<pre>&gt; gradle buildDependentsOperatorsPassingStaticLibrary --max-workers=1
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsC
&gt; Task :operatorsTestCUnitLauncher
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsTestC
&gt; Task :compileOperatorsTestPassingCUnitExeOperatorsTestCunitLauncher
&gt; Task :linkOperatorsTestPassingCUnitExe
&gt; Task :operatorsTestPassingCUnitExe
&gt; Task :installOperatorsTestPassingCUnitExe
&gt; Task :runOperatorsTestPassingCUnitExe
&gt; Task :checkOperatorsTestPassingCUnitExe
&gt; Task :buildDependentsOperatorsTestPassingCUnitExe
&gt; Task :compileOperatorsPassingStaticLibraryOperatorsC
&gt; Task :createOperatorsPassingStaticLibrary
&gt; Task :operatorsPassingStaticLibrary
&gt; Task :buildDependentsOperatorsPassingStaticLibrary

BUILD SUCCESSFUL in 0s
9 actionable tasks: 9 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In the output above, the targeted binary as well as the test suite binary that depends on it are built and the test suite has run.</p>
</div>
<div class="paragraph">
<p>You can also build <em>all</em> of the dependents of a component (i.e. of all its binaries/variants) using the corresponding component task, e.g. <code>buildDependentsOperators</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:native_tasks"><a class="anchor" href="#sec:native_tasks"></a><a class="link" href="#sec:native_tasks">Tasks</a></h4>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> that can be produced by a build, a single <em>lifecycle task</em> is constructed that can be used to create that binary, together with a set of other tasks that do the actual work of compiling, linking or assembling the binary.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>${component.name}</em>Executable</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableBinarySpec.html">NativeExecutableBinarySpec</a></p>
</dd>
<dt class="hdlist1">Location of created binary</dt>
<dd>
<p><code><em>${project.buildDir}</em>/exe/<em>${component.name}</em>/<em>${component.name}</em></code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><em>${component.name}</em>SharedLibrary</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/SharedLibraryBinarySpec.html">SharedLibraryBinarySpec</a></p>
</dd>
<dt class="hdlist1">Location of created binary</dt>
<dd>
<p><code><em>${project.buildDir}</em>/libs/<em>${component.name}</em>/shared/lib<em>${component.name}</em>.so</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><em>${component.name}</em>StaticLibrary</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/StaticLibraryBinarySpec.html">StaticLibraryBinarySpec</a></p>
</dd>
<dt class="hdlist1">Location of created binary</dt>
<dd>
<p><code><em>${project.buildDir}</em>/libs/<em>${component.name}</em>/static/<em>${component.name}</em>.a</code></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:check_tasks"><a class="anchor" href="#sec:check_tasks"></a><a class="link" href="#sec:check_tasks">Check tasks</a></h5>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> that can be produced by a build, a single <em>check task</em> is constructed that can be used to assemble and check that binary.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>check<em>${component.name}</em>Executable</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableBinarySpec.html">NativeExecutableBinarySpec</a></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>check<em>${component.name}</em>SharedLibrary</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/SharedLibraryBinarySpec.html">SharedLibraryBinarySpec</a></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>check<em>${component.name}</em>StaticLibrary</code></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">Component Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a></p>
</dd>
<dt class="hdlist1">Native Binary Type</dt>
<dd>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/SharedLibraryBinarySpec.html">SharedLibraryBinarySpec</a></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The built-in <code>check</code> task depends on all the <em>check tasks</em> for binaries in the project. Without either <a href="#native_binaries:cunit">CUnit</a> or <a href="#native_binaries:google_test">GoogleTest</a> plugins, the binary check task only depends on the <em>lifecycle task</em> that assembles the binary, see <a href="#sec:native_tasks">Native tasks</a>.</p>
</div>
<div class="paragraph">
<p>When the <a href="#native_binaries:cunit">CUnit</a> or <a href="#native_binaries:google_test">GoogleTest</a> plugins are applied, the task that executes the test suites for a component are automatically wired to the appropriate <em>check task</em>.</p>
</div>
<div class="paragraph">
<p>You can also add custom check tasks as follows:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_adding_a_custom_check_task"><a class="anchor" href="#example_adding_a_custom_check_task"></a><a class="link" href="#example_adding_a_custom_check_task">Example: Adding a custom check task</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">&quot;</span><span class="content">cpp</span><span class="delimiter">&quot;</span></span>
}
<span class="comment">// You don't need to apply the plugin below if you're already using CUnit or GoogleTest support</span>
apply <span class="key">plugin</span>: TestingModelBasePlugin

task myCustomCheck {
    doLast {
        println <span class="string"><span class="delimiter">'</span><span class="content">Executing my custom check</span><span class="delimiter">'</span></span>
    }
}

model {
    components {
        hello(NativeLibrarySpec) {
            binaries.all {
                <span class="comment">// Register our custom check task to all binaries of this component</span>
                checkedBy <span class="error">$</span>.tasks.myCustomCheck
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, running <code>check</code> or any of the <em>check tasks</em> for the <code>hello</code> binaries will run the custom check task:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_running_checks_for_a_given_binary"><a class="anchor" href="#example_running_checks_for_a_given_binary"></a><a class="link" href="#example_running_checks_for_a_given_binary">Example: Running checks for a given binary</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle checkHelloSharedLibrary</code></strong></div>
<div class="content">
<pre>&gt; gradle checkHelloSharedLibrary

&gt; Task :myCustomCheck
Executing my custom check

&gt; Task :checkHelloSharedLibrary

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:working_with_shared_libraries"><a class="anchor" href="#sec:working_with_shared_libraries"></a><a class="link" href="#sec:working_with_shared_libraries">Working with shared libraries</a></h5>
<div class="paragraph">
<p>For each executable binary produced, the <code>cpp</code> plugin provides an <code>install${binary.name}</code> task, which creates a development install of the executable, along with the shared libraries it requires. This allows you to run the executable without needing to install the shared libraries in their final locations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:finding_out_more_about_your_project"><a class="anchor" href="#sec:finding_out_more_about_your_project"></a><a class="link" href="#sec:finding_out_more_about_your_project">Finding out more about your project</a></h4>
<div class="paragraph">
<p>Gradle provides a report that you can run from the command-line that shows some details about the components and binaries that your project produces. To use this report, just run <code>gradle components</code>. Below is an example of running this report for one of the sample projects:</p>
</div>
<div class="sect4">
<h5 id="example_the_components_report"><a class="anchor" href="#example_the_components_report"></a><a class="link" href="#example_the_components_report">Example: The components report</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle components</code></strong></div>
<div class="content">
<pre>&gt; gradle components

&gt; Task :components

------------------------------------------------------------
Root project
------------------------------------------------------------

Native library 'hello'
----------------------

Source sets
    C++ source 'hello:cpp'
        srcDir: src/hello/cpp

Binaries
    Shared library 'hello:sharedLibrary'
        build using task: :helloSharedLibrary
        build type: build type 'debug'
        flavor: flavor 'default'
        target platform: platform 'current'
        tool chain: Tool chain 'clang' (Clang)
        shared library file: build/libs/hello/shared/libhello.dylib
    Static library 'hello:staticLibrary'
        build using task: :helloStaticLibrary
        build type: build type 'debug'
        flavor: flavor 'default'
        target platform: platform 'current'
        tool chain: Tool chain 'clang' (Clang)
        static library file: build/libs/hello/static/libhello.a

Native executable 'main'
------------------------

Source sets
    C++ source 'main:cpp'
        srcDir: src/main/cpp

Binaries
    Executable 'main:executable'
        build using task: :mainExecutable
        install using task: :installMainExecutable
        build type: build type 'debug'
        flavor: flavor 'default'
        target platform: platform 'current'
        tool chain: Tool chain 'clang' (Clang)
        executable file: build/exe/main/main

Note: currently not all plugins register their components, so some components may not be visible here.

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:languages"><a class="anchor" href="#native_binaries:languages"></a><a class="link" href="#native_binaries:languages">Language support</a></h4>
<div class="paragraph">
<p>Presently, Gradle supports building native software from any combination of source languages listed below. A native binary project will contain one or more named <code>FunctionalSourceSet</code> instances (e.g. 'main', 'test', etc), each of which can contain <code>LanguageSourceSet</code>s containing source files, one for each language.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>C</p>
</li>
<li>
<p>C++</p>
</li>
<li>
<p>Objective-C</p>
</li>
<li>
<p>Objective-C++</p>
</li>
<li>
<p>Assembly</p>
</li>
<li>
<p>Windows resources</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:cpp_sources"><a class="anchor" href="#sec:cpp_sources"></a><a class="link" href="#sec:cpp_sources">C++ sources</a></h5>
<div class="paragraph">
<p>C++ language support is provided by means of the <code>'cpp'</code> plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_the_cpp_plugin"><a class="anchor" href="#example_the_cpp_plugin"></a><a class="link" href="#example_the_cpp_plugin">Example: The 'cpp' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">cpp</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>C++ sources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppSourceSet.html">CppSourceSet</a>, which defines a set of C++ source files and optionally a set of exported header files (for a library). By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppSourceSet.html">CppSourceSet</a> contains <code>.cpp</code> source files in <code>src/${name}/cpp</code>, and header files in <code>src/${name}/headers</code>.</p>
</div>
<div class="paragraph">
<p>While the <code>cpp</code> plugin defines these default locations for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppSourceSet.html">CppSourceSet</a>, it is possible to extend or override these defaults to allow for a different project layout.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_c_source_set"><a class="anchor" href="#example_c_source_set"></a><a class="link" href="#example_c_source_set">Example: C++ source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sources {
    cpp {
        source {
            srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/source</span><span class="delimiter">&quot;</span></span>
            include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.cpp</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a library named 'main', header files in <code>src/main/headers</code> are considered the "public" or "exported" headers. Header files that should not be exported should be placed inside the <code>src/main/cpp</code> directory (though be aware that such header files should always be referenced in a manner relative to the file including them).</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:c_sources"><a class="anchor" href="#sec:c_sources"></a><a class="link" href="#sec:c_sources">C sources</a></h5>
<div class="paragraph">
<p>C language support is provided by means of the <code>'c'</code> plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_the_c_plugin"><a class="anchor" href="#example_the_c_plugin"></a><a class="link" href="#example_the_c_plugin">Example: The 'c' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>C sources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.c.CSourceSet.html">CSourceSet</a>, which defines a set of C source files and optionally a set of exported header files (for a library). By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.c.CSourceSet.html">CSourceSet</a> contains <code>.c</code> source files in <code>src/${name}/c</code>, and header files in <code>src/${name}/headers</code>.</p>
</div>
<div class="paragraph">
<p>While the <code>c</code> plugin defines these default locations for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.c.CSourceSet.html">CSourceSet</a>, it is possible to extend or override these defaults to allow for a different project layout.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_c_source_set_2"><a class="anchor" href="#example_c_source_set_2"></a><a class="link" href="#example_c_source_set_2">Example: C source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sources {
    c {
        source {
            srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/source</span><span class="delimiter">&quot;</span></span>
            include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.c</span><span class="delimiter">&quot;</span></span>
        }
        exportedHeaders {
            srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/include</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a library named 'main', header files in <code>src/main/headers</code> are considered the "public" or "exported" headers. Header files that should not be exported should be placed inside the <code>src/main/c</code> directory (though be aware that such header files should always be referenced in a manner relative to the file including them).</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:assembler_sources"><a class="anchor" href="#sec:assembler_sources"></a><a class="link" href="#sec:assembler_sources">Assembler sources</a></h5>
<div class="paragraph">
<p>Assembly language support is provided by means of the <code>'assembler'</code> plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_the_assembler_plugin"><a class="anchor" href="#example_the_assembler_plugin"></a><a class="link" href="#example_the_assembler_plugin">Example: The 'assembler' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">assembler</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assembler sources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.assembler.AssemblerSourceSet.html">AssemblerSourceSet</a>, which defines a set of Assembler source files. By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.assembler.AssemblerSourceSet.html">AssemblerSourceSet</a> contains <code>.s</code> source files under <code>src/${name}/asm</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:objectivec_sources"><a class="anchor" href="#sec:objectivec_sources"></a><a class="link" href="#sec:objectivec_sources">Objective-C sources</a></h5>
<div class="paragraph">
<p>Objective-C language support is provided by means of the <code>'objective-c'</code> plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_the_objective_c_plugin"><a class="anchor" href="#example_the_objective_c_plugin"></a><a class="link" href="#example_the_objective_c_plugin">Example: The 'objective-c' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">objective-c</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Objective-C sources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.objectivec.ObjectiveCSourceSet.html">ObjectiveCSourceSet</a>, which defines a set of Objective-C source files. By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.objectivec.ObjectiveCSourceSet.html">ObjectiveCSourceSet</a> contains <code>.m</code> source files under <code>src/${name}/objectiveC</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:objectivecpp_sources"><a class="anchor" href="#sec:objectivecpp_sources"></a><a class="link" href="#sec:objectivecpp_sources">Objective-C++ sources</a></h5>
<div class="paragraph">
<p>Objective-C++ language support is provided by means of the <code>'objective-cpp'</code> plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_the_objective_cpp_plugin"><a class="anchor" href="#example_the_objective_cpp_plugin"></a><a class="link" href="#example_the_objective_cpp_plugin">Example: The 'objective-cpp' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">objective-cpp</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Objective-C++ sources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.objectivecpp.ObjectiveCppSourceSet.html">ObjectiveCppSourceSet</a>, which defines a set of Objective-C++ source files. By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.objectivecpp.ObjectiveCppSourceSet.html">ObjectiveCppSourceSet</a> contains <code>.mm</code> source files under <code>src/${name}/objectiveCpp</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_the_compiler_assembler_and_linker"><a class="anchor" href="#sec:configuring_the_compiler_assembler_and_linker"></a><a class="link" href="#sec:configuring_the_compiler_assembler_and_linker">Configuring the compiler, assembler and linker</a></h4>
<div class="paragraph">
<p>Each binary to be produced is associated with a set of compiler and linker settings, which include command-line arguments as well as macro definitions. These settings can be applied to all binaries, an individual binary, or selectively to a group of binaries based on some criteria.</p>
</div>
<div class="sect4">
<h5 id="example_settings_that_apply_to_all_binaries"><a class="anchor" href="#example_settings_that_apply_to_all_binaries"></a><a class="link" href="#example_settings_that_apply_to_all_binaries">Example: Settings that apply to all binaries</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    binaries {
        all {
            <span class="comment">// Define a preprocessor macro for every binary</span>
            cppCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">NDEBUG</span><span class="delimiter">&quot;</span></span>

            <span class="comment">// Define toolchain-specific compiler and linker options</span>
            <span class="keyword">if</span> (toolChain <span class="keyword">in</span> Gcc) {
                cppCompiler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">-O2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">-fno-access-control</span><span class="delimiter">&quot;</span></span>
                linker.args <span class="string"><span class="delimiter">&quot;</span><span class="content">-Xlinker</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">-S</span><span class="delimiter">&quot;</span></span>
            }
            <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
                cppCompiler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/Zi</span><span class="delimiter">&quot;</span></span>
                linker.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/DEBUG</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each binary is associated with a particular <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/toolchain/NativeToolChain.html">NativeToolChain</a>, allowing settings to be targeted based on this value.</p>
</div>
<div class="paragraph">
<p>It is easy to apply settings to all binaries of a particular type:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_settings_that_apply_to_all_shared_libraries"><a class="anchor" href="#example_settings_that_apply_to_all_shared_libraries"></a><a class="link" href="#example_settings_that_apply_to_all_shared_libraries">Example: Settings that apply to all shared libraries</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// For any shared library binaries built with Visual C++,</span>
<span class="comment">// define the DLL_EXPORT macro</span>
model {
    binaries {
        withType(SharedLibraryBinarySpec) {
            <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
                cCompiler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/Zi</span><span class="delimiter">&quot;</span></span>
                cCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">DLL_EXPORT</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, it is possible to specify settings that apply to all binaries produced for a particular <code>executable</code> or <code>library</code> component:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_settings_that_apply_to_all_binaries_produced_for_the_main_executable_component"><a class="anchor" href="#example_settings_that_apply_to_all_binaries_produced_for_the_main_executable_component"></a><a class="link" href="#example_settings_that_apply_to_all_binaries_produced_for_the_main_executable_component">Example: Settings that apply to all binaries produced for the 'main' executable component</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        main(NativeExecutableSpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
            binaries.all {
                <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
                    sources {
                        platformAsm(AssemblerSourceSet) {
                            source.srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/asm_i386_masm</span><span class="delimiter">&quot;</span></span>
                        }
                    }
                    assembler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/Zi</span><span class="delimiter">&quot;</span></span>
                } <span class="keyword">else</span> {
                    sources {
                        platformAsm(AssemblerSourceSet) {
                            source.srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/asm_i386_gcc</span><span class="delimiter">&quot;</span></span>
                        }
                    }
                    assembler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">-g</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above will apply the supplied configuration to all <code>executable</code> binaries built.</p>
</div>
<div class="paragraph">
<p>Similarly, settings can be specified to target binaries for a component that are of a particular type: e.g. all shared libraries for the main library component.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_settings_that_apply_only_to_shared_libraries_produced_for_the_main_library_component"><a class="anchor" href="#example_settings_that_apply_only_to_shared_libraries_produced_for_the_main_library_component"></a><a class="link" href="#example_settings_that_apply_only_to_shared_libraries_produced_for_the_main_library_component">Example: Settings that apply only to shared libraries produced for the 'main' library component</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        main(NativeLibrarySpec) {
            binaries.withType(SharedLibraryBinarySpec) {
                <span class="comment">// Define a preprocessor macro that only applies to shared libraries</span>
                cppCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">DLL_EXPORT</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:windows-resources"><a class="anchor" href="#native_binaries:windows-resources"></a><a class="link" href="#native_binaries:windows-resources">Windows Resources</a></h4>
<div class="paragraph">
<p>When using the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.VisualCpp.html">VisualCpp</a> tool chain, Gradle is able to compile Window Resource (<code>rc</code>) files and link them into a native binary. This functionality is provided by the <code>'windows-resources'</code> plugin.</p>
</div>
<div class="sect4">
<h5 id="example_the_windows_resources_plugin"><a class="anchor" href="#example_the_windows_resources_plugin"></a><a class="link" href="#example_the_windows_resources_plugin">Example: The 'windows-resources' plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">windows-resources</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Windows resources to be included in a native binary are provided via a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.rc.WindowsResourceSet.html">WindowsResourceSet</a>, which defines a set of Windows Resource source files. By default, for any named component the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.rc.WindowsResourceSet.html">WindowsResourceSet</a> contains <code>.rc</code> source files under <code>src/${name}/rc</code>.</p>
</div>
<div class="paragraph">
<p>As with other source types, you can configure the location of the windows resources that should be included in the binary.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuring_the_location_of_windows_resource_sources"><a class="anchor" href="#example_configuring_the_location_of_windows_resource_sources"></a><a class="link" href="#example_configuring_the_location_of_windows_resource_sources">Example: Configuring the location of Windows resource sources</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build-resource-only-dll.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sources {
    rc {
        source {
            srcDirs <span class="string"><span class="delimiter">&quot;</span><span class="content">src/hello/rc</span><span class="delimiter">&quot;</span></span>
        }
        exportedHeaders {
            srcDirs <span class="string"><span class="delimiter">&quot;</span><span class="content">src/hello/headers</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are able to construct a resource-only library by providing Windows Resource sources with no other language sources, and configure the linker as appropriate:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_building_a_resource_only_dll"><a class="anchor" href="#example_building_a_resource_only_dll"></a><a class="link" href="#example_building_a_resource_only_dll">Example: Building a resource-only dll</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build-resource-only-dll.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        helloRes(NativeLibrarySpec) {
            binaries.all {
                rcCompiler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/v</span><span class="delimiter">&quot;</span></span>
                linker.args <span class="string"><span class="delimiter">&quot;</span><span class="content">/noentry</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/machine:x86</span><span class="delimiter">&quot;</span></span>
            }
            sources {
                rc {
                    source {
                        srcDirs <span class="string"><span class="delimiter">&quot;</span><span class="content">src/hello/rc</span><span class="delimiter">&quot;</span></span>
                    }
                    exportedHeaders {
                        srcDirs <span class="string"><span class="delimiter">&quot;</span><span class="content">src/hello/headers</span><span class="delimiter">&quot;</span></span>
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above also demonstrates the mechanism of passing extra command-line arguments to the resource compiler. The <code>rcCompiler</code> extension is of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/PreprocessingTool.html">PreprocessingTool</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:library_dependencies"><a class="anchor" href="#sec:library_dependencies"></a><a class="link" href="#sec:library_dependencies">Library Dependencies</a></h4>
<div class="paragraph">
<p>Dependencies for native components are binary libraries that export header files. The header files are used during compilation, with the compiled binary dependency being used during linking and execution. Header files should be organized into subdirectories to prevent clashes of commonly named headers. For instance, if your <code>mylib</code> project has a <code>logging.h</code> header, it will make it less likely the wrong header is used if you include it as <code>"mylib/logging.h"</code> instead of <code>"logging.h"</code>.</p>
</div>
<div class="sect4">
<h5 id="sec:dependencies_within_the_same_project"><a class="anchor" href="#sec:dependencies_within_the_same_project"></a><a class="link" href="#sec:dependencies_within_the_same_project">Dependencies within the same project</a></h5>
<div class="paragraph">
<p>A set of sources may depend on header files provided by another binary component within the same project. A common example is a native executable component that uses functions provided by a separate native library component.</p>
</div>
<div class="paragraph">
<p>Such a library dependency can be added to a source set associated with the <code>executable</code> component:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_providing_a_library_dependency_to_the_source_set"><a class="anchor" href="#example_providing_a_library_dependency_to_the_source_set"></a><a class="link" href="#example_providing_a_library_dependency_to_the_source_set">Example: Providing a library dependency to the source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sources {
    cpp {
        lib <span class="key">library</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, a library dependency can be provided directly to the <code>NativeExecutableBinarySpec</code> for the <code>executable</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_providing_a_library_dependency_to_the_binary"><a class="anchor" href="#example_providing_a_library_dependency_to_the_binary"></a><a class="link" href="#example_providing_a_library_dependency_to_the_binary">Example: Providing a library dependency to the binary</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        hello(NativeLibrarySpec) {
            sources {
                c {
                    source {
                        srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/source</span><span class="delimiter">&quot;</span></span>
                        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.c</span><span class="delimiter">&quot;</span></span>
                    }
                    exportedHeaders {
                        srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/include</span><span class="delimiter">&quot;</span></span>
                    }
                }
            }
        }
        main(NativeExecutableSpec) {
            sources {
                cpp {
                    source {
                        srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">src/source</span><span class="delimiter">&quot;</span></span>
                        include <span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.cpp</span><span class="delimiter">&quot;</span></span>
                    }
                }
            }
            binaries.all {
                <span class="comment">// Each executable binary produced uses the 'hello' static library binary</span>
                lib <span class="key">library</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="key">linkage</span>: <span class="string"><span class="delimiter">'</span><span class="content">static</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:project_dependencies"><a class="anchor" href="#sec:project_dependencies"></a><a class="link" href="#sec:project_dependencies">Project Dependencies</a></h5>
<div class="paragraph">
<p>For a component produced in a different Gradle project, the notation is similar.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_declaring_project_dependencies"><a class="anchor" href="#example_declaring_project_dependencies"></a><a class="link" href="#example_declaring_project_dependencies">Example: Declaring project dependencies</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>) {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cpp</span><span class="delimiter">&quot;</span></span>
    model {
        components {
            main(NativeLibrarySpec)
        }

        <span class="comment">// For any shared library binaries built with Visual C++,</span>
        <span class="comment">// define the DLL_EXPORT macro</span>
        binaries {
            withType(SharedLibraryBinarySpec) {
                <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp) {
                    cppCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">DLL_EXPORT</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}

project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:exe</span><span class="delimiter">&quot;</span></span>) {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cpp</span><span class="delimiter">&quot;</span></span>

    model {
        components {
            main(NativeExecutableSpec) {
                sources {
                    cpp {
                        lib <span class="key">project</span>: <span class="string"><span class="delimiter">'</span><span class="content">:lib</span><span class="delimiter">'</span></span>, <span class="key">library</span>: <span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:preCompiledHeaders"><a class="anchor" href="#native_binaries:preCompiledHeaders"></a><a class="link" href="#native_binaries:preCompiledHeaders">Precompiled Headers</a></h4>
<div class="paragraph">
<p>Precompiled headers are a performance optimization that reduces the cost of compiling widely used headers multiple times. This feature <em>precompiles</em> a header such that the compiled object file can be reused when compiling each source file rather than recompiling the header each time. This support is available for C, C++, Objective-C, and Objective-C++ builds.</p>
</div>
<div class="paragraph">
<p>To configure a precompiled header, first a header file needs to be defined that includes all of the headers that should be precompiled. It must be specified as the first included header in every source file where the precompiled header should be used. It is assumed that this header file, and any headers it contains, make use of header guards so that they can be included in an idempotent manner. If header guards are not used in a header file, it is possible the header could be compiled more than once and could potentially lead to a broken build.</p>
</div>
<div class="sect4">
<h5 id="example_creating_a_precompiled_header_file"><a class="anchor" href="#example_creating_a_precompiled_header_file"></a><a class="link" href="#example_creating_a_precompiled_header_file">Example: Creating a precompiled header file</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/hello/headers/pch.h</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#ifndef</span> PCH_H
<span class="preprocessor">#define</span> PCH_H
<span class="preprocessor">#include</span> <span class="include">&lt;iostream&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;hello.h&quot;</span>
<span class="preprocessor">#endif</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_including_a_precompiled_header_file_in_a_source_file"><a class="anchor" href="#example_including_a_precompiled_header_file_in_a_source_file"></a><a class="link" href="#example_including_a_precompiled_header_file_in_a_source_file">Example: Including a precompiled header file in a source file</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/hello/cpp/hello.cpp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cpp"><span class="preprocessor">#include</span> <span class="include">&quot;pch.h&quot;</span>

<span class="directive">void</span> LIB_FUNC Greeter::hello () {
    std::cout &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span> &lt;&lt; std::endl;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Precompiled headers are specified on a source set. Only one precompiled header file can be specified on a given source set and will be applied to all source files that declare it as the first include. If a source files does not include this header file as the first header, the file will be compiled in the normal manner (without making use of the precompiled header object file). The string provided should be the same as that which is used in the "#include" directive in the source files.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuring_a_precompiled_header"><a class="anchor" href="#example_configuring_a_precompiled_header"></a><a class="link" href="#example_configuring_a_precompiled_header">Example: Configuring a precompiled header</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        hello(NativeLibrarySpec) {
            sources {
                cpp {
                    preCompiledHeader <span class="string"><span class="delimiter">&quot;</span><span class="content">pch.h</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A precompiled header must be included in the same way for all files that use it. Usually, this means the header file should exist in the source set "headers" directory or in a directory included on the compiler include path.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:variants"><a class="anchor" href="#native_binaries:variants"></a><a class="link" href="#native_binaries:variants">Native Binary Variants</a></h4>
<div class="paragraph">
<p>For each executable or library defined, Gradle is able to build a number of different native binary variants. Examples of different variants include debug vs release binaries, 32-bit vs 64-bit binaries, and binaries produced with different custom preprocessor flags.</p>
</div>
<div class="paragraph">
<p>Binaries produced by Gradle can be differentiated on <a href="#native_binaries:build_type">build type</a>, <a href="#native_binaries:platform">platform</a>, and <a href="#native_binaries:flavor">flavor</a>. For each of these 'variant dimensions', it is possible to specify a set of available values as well as target each component at one, some or all of these. For example, a plugin may define a range of support platforms, but you may choose to only target Windows-x86 for a particular component.</p>
</div>
<div class="sect4">
<h5 id="native_binaries:build_type"><a class="anchor" href="#native_binaries:build_type"></a><a class="link" href="#native_binaries:build_type">Build types</a></h5>
<div class="paragraph">
<p>A <code>build type</code> determines various non-functional aspects of a binary, such as whether debug information is included, or what optimisation level the binary is compiled with. Typical build types are 'debug' and 'release', but a project is free to define any set of build types.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_defining_build_types"><a class="anchor" href="#example_defining_build_types"></a><a class="link" href="#example_defining_build_types">Example: Defining build types</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    buildTypes {
        debug
        release
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no build types are defined in a project, then a single, default build type called 'debug' is added.</p>
</div>
<div class="paragraph">
<p>For a build type, a Gradle project will typically define a set of compiler/linker flags per tool chain.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuring_debug_binaries"><a class="anchor" href="#example_configuring_debug_binaries"></a><a class="link" href="#example_configuring_debug_binaries">Example: Configuring debug binaries</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    binaries {
        all {
            <span class="keyword">if</span> (toolChain <span class="keyword">in</span> Gcc &amp;&amp; buildType == buildTypes.debug) {
                cppCompiler.args <span class="string"><span class="delimiter">&quot;</span><span class="content">-g</span><span class="delimiter">&quot;</span></span>
            }
            <span class="keyword">if</span> (toolChain <span class="keyword">in</span> VisualCpp &amp;&amp; buildType == buildTypes.debug) {
                cppCompiler.args <span class="string"><span class="delimiter">'</span><span class="content">/Zi</span><span class="delimiter">'</span></span>
                cppCompiler.define <span class="string"><span class="delimiter">'</span><span class="content">DEBUG</span><span class="delimiter">'</span></span>
                linker.args <span class="string"><span class="delimiter">'</span><span class="content">/DEBUG</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At this stage, it is completely up to the build script to configure the relevant compiler/linker flags for each build type. Future versions of Gradle will automatically include the appropriate debug flags for any 'debug' build type, and may be aware of various levels of optimisation as well.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="native_binaries:platform"><a class="anchor" href="#native_binaries:platform"></a><a class="link" href="#native_binaries:platform">Platform</a></h5>
<div class="paragraph">
<p>An executable or library can be built to run on different operating systems and cpu architectures, with a variant being produced for each platform. Gradle defines each OS/architecture combination as a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.platform.NativePlatform.html">NativePlatform</a>, and a project may define any number of platforms. If no platforms are defined in a project, then a single, default platform 'current' is added.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Presently, a <code>Platform</code> consists of a defined operating system and architecture. As we continue to develop the native binary support in Gradle, the concept of Platform will be extended to include things like C-runtime version, Windows SDK, ABI, etc. Sophisticated builds may use the extensibility of Gradle to apply additional attributes to each platform, which can then be queried to specify particular includes, preprocessor macros or compiler arguments for a native binary.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="example_defining_platforms"><a class="anchor" href="#example_defining_platforms"></a><a class="link" href="#example_defining_platforms">Example: Defining platforms</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    platforms {
        x86 {
            architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
        }
        x64 {
            architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x86_64</span><span class="delimiter">&quot;</span></span>
        }
        itanium {
            architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">ia-64</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a given variant, Gradle will attempt to find a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/toolchain/NativeToolChain.html">NativeToolChain</a> that is able to build for the target platform. Available tool chains are searched in the order defined. See the <a href="#native_binaries:tool_chain">tool chains</a> section below for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="native_binaries:flavor"><a class="anchor" href="#native_binaries:flavor"></a><a class="link" href="#native_binaries:flavor">Flavor</a></h5>
<div class="paragraph">
<p>Each component can have a set of named <code>flavors</code>, and a separate binary variant can be produced for each flavor. While the <code>build type</code> and <code>target platform</code> variant dimensions have a defined meaning in Gradle, each project is free to define any number of flavors and apply meaning to them in any way.</p>
</div>
<div class="paragraph">
<p>An example of component flavors might differentiate between 'demo', 'paid' and 'enterprise' editions of the component, where the same set of sources is used to produce binaries with different functions.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_defining_flavors"><a class="anchor" href="#example_defining_flavors"></a><a class="link" href="#example_defining_flavors">Example: Defining flavors</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    flavors {
        english
        french
    }
    components {
        hello(NativeLibrarySpec) {
            binaries.all {
                <span class="keyword">if</span> (flavor == flavors.french) {
                    cppCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">FRENCH</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, a library is defined with a 'english' and 'french' flavor. When compiling the 'french' variant, a separate macro is defined which leads to a different binary being produced.</p>
</div>
<div class="paragraph">
<p>If no flavor is defined for a component, then a single default flavor named 'default' is used.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:selecting_the_build_types_platforms_and_flavors_for_a_component"><a class="anchor" href="#sec:selecting_the_build_types_platforms_and_flavors_for_a_component"></a><a class="link" href="#sec:selecting_the_build_types_platforms_and_flavors_for_a_component">Selecting the build types, platforms and flavors for a component</a></h5>
<div class="paragraph">
<p>For a default component, Gradle will attempt to create a native binary variant for each and every combination of <code>buildType</code> and <code>flavor</code> defined for the project. It is possible to override this on a per-component basis, by specifying the set of <code>targetBuildTypes</code> and/or <code>targetFlavors</code>. By default, Gradle will build for the default platform, see <a href="#native_binaries:platform">above</a>, unless specified explicitly on a per-component basis by specifying a set of <code>targetPlatforms</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_targeting_a_component_at_particular_platforms"><a class="anchor" href="#example_targeting_a_component_at_particular_platforms"></a><a class="link" href="#example_targeting_a_component_at_particular_platforms">Example: Targeting a component at particular platforms</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    components {
        hello(NativeLibrarySpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x64</span><span class="delimiter">&quot;</span></span>
        }
        main(NativeExecutableSpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x64</span><span class="delimiter">&quot;</span></span>
            sources {
                cpp.lib <span class="key">library</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="key">linkage</span>: <span class="string"><span class="delimiter">'</span><span class="content">static</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.TargetedNativeComponent.html#org.gradle.nativeplatform.TargetedNativeComponent:targetPlatform(java.lang.String)">TargetedNativeComponent.targetPlatform(java.lang.String)</a> method is used to specify a platform that the <code>NativeExecutableSpec</code> named <code>main</code> should be built for.</p>
</div>
<div class="paragraph">
<p>A similar mechanism exists for selecting <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.TargetedNativeComponent.html#org.gradle.nativeplatform.TargetedNativeComponent:targetBuildTypes(java.lang.String[])">TargetedNativeComponent.targetBuildTypes(java.lang.String&#8230;&#8203;)</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.TargetedNativeComponent.html#org.gradle.nativeplatform.TargetedNativeComponent:targetFlavors(java.lang.String[])">TargetedNativeComponent.targetFlavors(java.lang.String&#8230;&#8203;)</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:building_all_possible_variants"><a class="anchor" href="#sec:building_all_possible_variants"></a><a class="link" href="#sec:building_all_possible_variants">Building all possible variants</a></h5>
<div class="paragraph">
<p>When a set of build types, target platforms, and flavors is defined for a component, a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> model element is created for every possible combination of these. However, in many cases it is not possible to build a particular variant, perhaps because no tool chain is available to build for a particular platform.</p>
</div>
<div class="paragraph">
<p>If a binary variant cannot be built for any reason, then the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> associated with that variant will not be <code>buildable</code>. It is possible to use this property to create a task to generate all possible variants on a particular machine.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_building_all_possible_variants"><a class="anchor" href="#example_building_all_possible_variants"></a><a class="link" href="#example_building_all_possible_variants">Example: Building all possible variants</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    tasks {
        buildAllExecutables(Task) {
            dependsOn <span class="error">$</span>.binaries.findAll { <span class="local-variable">it</span>.buildable }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:tool_chain"><a class="anchor" href="#native_binaries:tool_chain"></a><a class="link" href="#native_binaries:tool_chain">Tool chains</a></h4>
<div class="paragraph">
<p>A single build may utilize different tool chains to build variants for different platforms. To this end, the core 'native-binary' plugins will attempt to locate and make available supported tool chains. However, the set of tool chains for a project may also be explicitly defined, allowing additional cross-compilers to be configured as well as allowing the install directories to be specified.</p>
</div>
<div class="sect4">
<h5 id="sec:defining_tool_chains"><a class="anchor" href="#sec:defining_tool_chains"></a><a class="link" href="#sec:defining_tool_chains">Defining tool chains</a></h5>
<div class="paragraph">
<p>The supported tool chain types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.Gcc.html">Gcc</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.Clang.html">Clang</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.VisualCpp.html">VisualCpp</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="example_defining_tool_chains"><a class="anchor" href="#example_defining_tool_chains"></a><a class="link" href="#example_defining_tool_chains">Example: Defining tool chains</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    toolChains {
        visualCpp(VisualCpp) {
            <span class="comment">// Specify the installDir if Visual Studio cannot be located</span>
            <span class="comment">// installDir &quot;C:/Apps/Microsoft Visual Studio 10.0&quot;</span>
        }
        gcc(Gcc) {
            <span class="comment">// Uncomment to use a GCC install that is not in the PATH</span>
            <span class="comment">// path &quot;/usr/bin/gcc&quot;</span>
        }
        clang(Clang)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each tool chain implementation allows for a certain degree of configuration (see the API documentation for more details).</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_tool_chains"><a class="anchor" href="#sec:using_tool_chains"></a><a class="link" href="#sec:using_tool_chains">Using tool chains</a></h5>
<div class="paragraph">
<p>It is not necessary or possible to specify the tool chain that should be used to build. For a given variant, Gradle will attempt to locate a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/toolchain/NativeToolChain.html">NativeToolChain</a> that is able to build for the target platform. Available tool chains are searched in the order defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When a platform does not define an architecture or operating system, the default target of the tool chain is assumed. So if a platform does not define a value for <code>operatingSystem</code>, Gradle will find the first available tool chain that can build for the specified <code>architecture</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The core Gradle tool chains are able to target the following architectures out of the box. In each case, the tool chain will target the current operating system. See the next section for information on cross-compiling for other operating systems.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tool Chain</th>
<th class="tableblock halign-left valign-top">Architectures</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>GCC</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>x86, x86_64</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Clang</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>x86, x86_64</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Visual C++</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>x86, x86_64, ia-64</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So for GCC running on linux, the supported target platforms are 'linux/x86' and 'linux/x86_64'. For GCC running on Windows via Cygwin, platforms 'windows/x86' and 'windows/x86_64' are supported. (The Cygwin POSIX runtime is not yet modelled as part of the platform, but will be in the future.)</p>
</div>
<div class="paragraph">
<p>If no target platforms are defined for a project, then all binaries are built to target a default platform named 'current'. This default platform does not specify any <code>architecture</code> or <code>operatingSystem</code> value, hence using the default values of the first available tool chain.</p>
</div>
<div class="paragraph">
<p>Gradle provides a <em>hook</em> that allows the build author to control the exact set of arguments passed to a tool chain executable. This enables the build author to work around any limitations in Gradle, or assumptions that Gradle makes. The arguments hook should be seen as a 'last-resort' mechanism, with preference given to truly modelling the underlying domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_reconfigure_tool_arguments"><a class="anchor" href="#example_reconfigure_tool_arguments"></a><a class="link" href="#example_reconfigure_tool_arguments">Example: Reconfigure tool arguments</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    toolChains {
        visualCpp(VisualCpp) {
            eachPlatform {
                cppCompiler.withArguments { args -&gt;
                    args &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">-DFRENCH</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
        clang(Clang) {
            eachPlatform {
                cCompiler.withArguments { args -&gt;
                    <span class="predefined-type">Collections</span>.replaceAll(args, <span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOM</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">-DFRENCH</span><span class="delimiter">&quot;</span></span>)
                }
                linker.withArguments { args -&gt;
                    args.remove <span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOM</span><span class="delimiter">&quot;</span></span>
                }
                staticLibArchiver.withArguments { args -&gt;
                    args.remove <span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOM</span><span class="delimiter">&quot;</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:crosscompiling_with_gcc"><a class="anchor" href="#sec:crosscompiling_with_gcc"></a><a class="link" href="#sec:crosscompiling_with_gcc">Cross-compiling with GCC</a></h5>
<div class="paragraph">
<p>Cross-compiling is possible with the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.Gcc.html">Gcc</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.toolchain.Clang.html">Clang</a> tool chains, by adding support for additional target platforms. This is done by specifying a target platform for a toolchain. For each target platform a custom configuration can be specified.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_defining_target_platforms"><a class="anchor" href="#example_defining_target_platforms"></a><a class="link" href="#example_defining_target_platforms">Example: Defining target platforms</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    toolChains {
        gcc(Gcc) {
            target(<span class="string"><span class="delimiter">&quot;</span><span class="content">arm</span><span class="delimiter">&quot;</span></span>){
                cppCompiler.withArguments { args -&gt;
                    args &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">-m32</span><span class="delimiter">&quot;</span></span>
                }
                linker.withArguments { args -&gt;
                    args &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">-m32</span><span class="delimiter">&quot;</span></span>
                }
            }
            target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sparc</span><span class="delimiter">&quot;</span></span>)
        }
    }
    platforms {
        arm {
            architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">arm</span><span class="delimiter">&quot;</span></span>
        }
        sparc {
            architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">sparc</span><span class="delimiter">&quot;</span></span>
        }
    }
    components {
        main(NativeExecutableSpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">arm</span><span class="delimiter">&quot;</span></span>
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">sparc</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:visual_studio"><a class="anchor" href="#native_binaries:visual_studio"></a><a class="link" href="#native_binaries:visual_studio">Visual Studio IDE integration</a></h4>
<div class="paragraph">
<p>Gradle has the ability to generate Visual Studio project and solution files for the native components defined in your build. This ability is added by the <code>visual-studio</code> plugin. For a multi-project build, all projects with native components (and the root project) should have this plugin applied.</p>
</div>
<div class="paragraph">
<p>When the <code>visual-studio</code> plugin is applied to the root project, a task named <code>visualStudio</code> is created, which will generate a Visual Studio solution file containing all components in the build. This solution will include a Visual Studio project for each component, as well as configuring each component to build using Gradle.</p>
</div>
<div class="paragraph">
<p>A task named <code>openVisualStudio</code> is also created by the <code>visual-studio</code> plugin when the project is the root project. This task generates the Visual Studio solution and then opens the solution in Visual Studio. This means you can simply run <code>gradlew openVisualStudio</code> from the root project to generate and open the Visual Studio solution in one convenient step.</p>
</div>
<div class="paragraph">
<p>The content of the generated visual studio files can be modified via API hooks, provided by the <code>visualStudio</code> extension. Take a look at the 'visual-studio' sample, or see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.ide.visualstudio.VisualStudioExtension.html#org.gradle.ide.visualstudio.VisualStudioExtension:projects">VisualStudioExtension.getProjects()</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.ide.visualstudio.VisualStudioRootExtension.html#org.gradle.ide.visualstudio.VisualStudioRootExtension:solution">VisualStudioRootExtension.getSolution()</a> in the API documentation for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:cunit"><a class="anchor" href="#native_binaries:cunit"></a><a class="link" href="#native_binaries:cunit">CUnit support</a></h4>
<div class="paragraph">
<p>The Gradle <code>cunit</code> plugin provides support for compiling and executing CUnit tests in your native-binary project. For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a> defined in your project, Gradle will create a matching <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteSpec.html">CUnitTestSuiteSpec</a> component, named <code>${component.name}Test</code>.</p>
</div>
<div class="sect4">
<h5 id="sec:cunit_sources"><a class="anchor" href="#sec:cunit_sources"></a><a class="link" href="#sec:cunit_sources">CUnit sources</a></h5>
<div class="paragraph">
<p>Gradle will create a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.c.CSourceSet.html">CSourceSet</a> named 'cunit' for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteSpec.html">CUnitTestSuiteSpec</a> component in the project. This source set should contain the cunit test files for the component under test. Source files can be located in the conventional location (<code>src/${component.name}Test/cunit</code>) or can be configured like any other source set.</p>
</div>
<div class="paragraph">
<p>Gradle initialises the CUnit test registry and executes the tests, utilising some generated CUnit launcher sources. Gradle will expect and call a function with the signature <code>void gradle_cunit_register()</code> that you can use to configure the actual CUnit suites and tests to execute.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_registering_cunit_tests"><a class="anchor" href="#example_registering_cunit_tests"></a><a class="link" href="#example_registering_cunit_tests">Example: Registering CUnit tests</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">suite_operators.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;CUnit/Basic.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;gradle_cunit_register.h&quot;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;test_operators.h&quot;</span>

<span class="predefined-type">int</span> suite_init(<span class="directive">void</span>) {
    <span class="keyword">return</span> <span class="integer">0</span>;
}

<span class="predefined-type">int</span> suite_clean(<span class="directive">void</span>) {
    <span class="keyword">return</span> <span class="integer">0</span>;
}

<span class="directive">void</span> gradle_cunit_register() {
    CU_pSuite pSuiteMath = CU_add_suite(<span class="string"><span class="delimiter">&quot;</span><span class="content">operator tests</span><span class="delimiter">&quot;</span></span>, suite_init, suite_clean);
    CU_add_test(pSuiteMath, <span class="string"><span class="delimiter">&quot;</span><span class="content">test_plus</span><span class="delimiter">&quot;</span></span>, test_plus);
    CU_add_test(pSuiteMath, <span class="string"><span class="delimiter">&quot;</span><span class="content">test_minus</span><span class="delimiter">&quot;</span></span>, test_minus);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Due to this mechanism, your CUnit sources may not contain a <code>main</code> method since this will clash with the method provided by Gradle.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:building_cunit_executables"><a class="anchor" href="#sec:building_cunit_executables"></a><a class="link" href="#sec:building_cunit_executables">Building CUnit executables</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteSpec.html">CUnitTestSuiteSpec</a> component has an associated <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a> component. For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> configured for the main component, a matching <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteBinarySpec.html">CUnitTestSuiteBinarySpec</a> will be configured on the test suite component. These test suite binaries can be configured in a similar way to any other binary instance:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuring_cunit_tests"><a class="anchor" href="#example_configuring_cunit_tests"></a><a class="link" href="#example_configuring_cunit_tests">Example: Configuring CUnit tests</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    binaries {
        withType(CUnitTestSuiteBinarySpec) {
            lib <span class="key">library</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cunit</span><span class="delimiter">&quot;</span></span>, <span class="key">linkage</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">static</span><span class="delimiter">&quot;</span></span>

            <span class="keyword">if</span> (flavor == flavors.failing) {
                cCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">PLUS_BROKEN</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Both the CUnit sources provided by your project and the generated launcher require the core CUnit headers and libraries. Presently, this library dependency must be provided by your project for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteBinarySpec.html">CUnitTestSuiteBinarySpec</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:running_cunit_tests"><a class="anchor" href="#sec:running_cunit_tests"></a><a class="link" href="#sec:running_cunit_tests">Running CUnit tests</a></h5>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.cunit.CUnitTestSuiteBinarySpec.html">CUnitTestSuiteBinarySpec</a>, Gradle will create a task to execute this binary, which will run all of the registered CUnit tests. Test results will be found in the <code><em>${build.dir}</em>/test-results</code> directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_running_cunit_tests"><a class="anchor" href="#example_running_cunit_tests"></a><a class="link" href="#example_running_cunit_tests">Example: Running CUnit tests</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">cunit-test-suite</span><span class="delimiter">'</span></span>
}

model {
    flavors {
        passing
        failing
    }
    platforms {
        x86 {
            <span class="keyword">if</span> (operatingSystem.macOsX) {
                architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x64</span><span class="delimiter">&quot;</span></span>
            } <span class="keyword">else</span> {
                architecture <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
    repositories {
        libs(PrebuiltLibraries) {
            cunit {
                headers.srcDir <span class="string"><span class="delimiter">&quot;</span><span class="content">libs/cunit/2.1-2/include</span><span class="delimiter">&quot;</span></span>
                binaries.withType(StaticLibraryBinary) {
                    staticLibraryFile =
                        file(<span class="string"><span class="delimiter">&quot;</span><span class="content">libs/cunit/2.1-2/lib/</span><span class="delimiter">&quot;</span></span> +
                             findCUnitLibForPlatform(targetPlatform))
                }
            }
        }
    }
    components {
        operators(NativeLibrarySpec) {
            targetPlatform <span class="string"><span class="delimiter">&quot;</span><span class="content">x86</span><span class="delimiter">&quot;</span></span>
        }
    }
    testSuites {
        operatorsTest(CUnitTestSuiteSpec) {
            testing <span class="error">$</span>.components.operators
        }
    }
}
model {
    binaries {
        withType(CUnitTestSuiteBinarySpec) {
            lib <span class="key">library</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cunit</span><span class="delimiter">&quot;</span></span>, <span class="key">linkage</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">static</span><span class="delimiter">&quot;</span></span>

            <span class="keyword">if</span> (flavor == flavors.failing) {
                cCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">PLUS_BROKEN</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q runOperatorsTestFailingCUnitExe</code></div>
<div class="content">
<pre>&gt; gradle -q runOperatorsTestFailingCUnitExe

There were test failures:
  1. /home/user/gradle/samples/src/operatorsTest/c/test_plus.c:6  - plus(0, -2) == -2
  2. /home/user/gradle/samples/src/operatorsTest/c/test_plus.c:7  - plus(2, 2) == 4


FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':runOperatorsTestFailingCUnitExe'.
&gt; There were failing tests. See the results at: file:///home/user/gradle/samples/build/test-results/operatorsTest/failing/

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 0s</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The current support for CUnit is quite rudimentary. Plans for future integration include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow tests to be declared with Javadoc-style annotations.</p>
</li>
<li>
<p>Improved HTML reporting, similar to that available for JUnit.</p>
</li>
<li>
<p>Real-time feedback for test execution.</p>
</li>
<li>
<p>Support for additional test frameworks.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native_binaries:google_test"><a class="anchor" href="#native_binaries:google_test"></a><a class="link" href="#native_binaries:google_test">GoogleTest support</a></h4>
<div class="paragraph">
<p>The Gradle <code>google-test</code> plugin provides support for compiling and executing GoogleTest tests in your native-binary project. For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a> defined in your project, Gradle will create a matching <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteSpec.html">GoogleTestTestSuiteSpec</a> component, named <code>${component.name}Test</code>.</p>
</div>
<div class="sect4">
<h5 id="sec:googletest_sources"><a class="anchor" href="#sec:googletest_sources"></a><a class="link" href="#sec:googletest_sources">GoogleTest sources</a></h5>
<div class="paragraph">
<p>Gradle will create a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.language.cpp.CppSourceSet.html">CppSourceSet</a> named 'cpp' for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteSpec.html">GoogleTestTestSuiteSpec</a> component in the project. This source set should contain the GoogleTest test files for the component under test. Source files can be located in the conventional location (<code>src/${component.name}Test/cpp</code>) or can be configured like any other source set.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:building_googletest_executables"><a class="anchor" href="#sec:building_googletest_executables"></a><a class="link" href="#sec:building_googletest_executables">Building GoogleTest executables</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteSpec.html">GoogleTestTestSuiteSpec</a> component has an associated <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeExecutableSpec.html">NativeExecutableSpec</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeLibrarySpec.html">NativeLibrarySpec</a> component. For each <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/nativeplatform/NativeBinarySpec.html">NativeBinarySpec</a> configured for the main component, a matching <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteBinarySpec.html">GoogleTestTestSuiteBinarySpec</a> will be configured on the test suite component. These test suite binaries can be configured in a similar way to any other binary instance:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_registering_googletest_tests"><a class="anchor" href="#example_registering_googletest_tests"></a><a class="link" href="#example_registering_googletest_tests">Example: Registering GoogleTest tests</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    binaries {
        withType(GoogleTestTestSuiteBinarySpec) {
            lib <span class="key">library</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">googleTest</span><span class="delimiter">&quot;</span></span>, <span class="key">linkage</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">static</span><span class="delimiter">&quot;</span></span>

            <span class="keyword">if</span> (flavor == flavors.failing) {
                cppCompiler.define <span class="string"><span class="delimiter">&quot;</span><span class="content">PLUS_BROKEN</span><span class="delimiter">&quot;</span></span>
            }

            <span class="keyword">if</span> (targetPlatform.operatingSystem.linux) {
                cppCompiler.args <span class="string"><span class="delimiter">'</span><span class="content">-pthread</span><span class="delimiter">'</span></span>
                linker.args <span class="string"><span class="delimiter">'</span><span class="content">-pthread</span><span class="delimiter">'</span></span>

                <span class="keyword">if</span> (toolChain <span class="keyword">instanceof</span> Gcc || toolChain <span class="keyword">instanceof</span> Clang) {
                    <span class="comment">// Use C++03 with the old ABIs, as this is what the googletest binaries were built with</span>
                    cppCompiler.args <span class="string"><span class="delimiter">'</span><span class="content">-std=c++03</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-D_GLIBCXX_USE_CXX11_ABI=0</span><span class="delimiter">'</span></span>
                    linker.args <span class="string"><span class="delimiter">'</span><span class="content">-std=c++03</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The GoogleTest sources provided by your project require the core GoogleTest headers and libraries. Presently, this library dependency must be provided by your project for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteBinarySpec.html">GoogleTestTestSuiteBinarySpec</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:running_googletest_tests"><a class="anchor" href="#sec:running_googletest_tests"></a><a class="link" href="#sec:running_googletest_tests">Running GoogleTest tests</a></h5>
<div class="paragraph">
<p>For each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.nativeplatform.test.googletest.GoogleTestTestSuiteBinarySpec.html">GoogleTestTestSuiteBinarySpec</a>, Gradle will create a task to execute this binary, which will run all of the registered GoogleTest tests. Test results will be found in the <code><em>${build.dir}</em>/test-results</code> directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The current support for GoogleTest is quite rudimentary. Plans for future integration include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Improved HTML reporting, similar to that available for JUnit.</p>
</li>
<li>
<p>Real-time feedback for test execution.</p>
</li>
<li>
<p>Support for additional test frameworks.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="software_model_concepts"><a class="anchor" href="#software_model_concepts"></a><a class="link" href="#software_model_concepts">Software model concepts</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rule based configuration <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">will be deprecated</a>.
New plugins should not use this concept.
Instead, use the standard approach described in the <a href="#custom_plugins">Writing Custom Plugins</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The software model describes how a piece of software is built and how the components of the software relate to each other. The software model is organized around some key concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>component</em> is a general concept that represents some logical piece of software. Examples of components are a command-line application, a web application or a library. A component is often composed of other components. Most Gradle builds will produce at least one component.</p>
</li>
<li>
<p>A <em>library</em> is a reusable component that is linked into or combined into some other component. In the Java ecosystem, a library is often built as a Jar file, and then later bundled into an application of some kind. In the native ecosystem, a library may be built as a shared library or static library, or both.</p>
</li>
<li>
<p>A <em>source set</em> represents a logical group of source files. Most components are built from source sets of various languages. Some source sets contain source that is written by hand, and some source sets may contain source that is generated from something else.</p>
</li>
<li>
<p>A <em>binary</em> represents some output that is built for a component. A component may produce multiple different output binaries. For example, for a C++ library, both a shared library and a static library binary may be produced. Each binary is initially configured to be built from the component sources, but additional source sets can be added to specific binary variants.</p>
</li>
<li>
<p>A <em>variant</em> represents some mutually exclusive binary of a component. A library, for example, might target Java 7 and Java 8, effectively producing two distinct binaries: a Java 7 Jar and a Java 8 Jar. These are different variants of the library.</p>
</li>
<li>
<p>The <em>API</em> of a library represents the artifacts and dependencies that are required to compile against that library. The API typically consists of a binary together with a set of dependencies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#software_model_extend">software model can be extended</a>, enabling deep modeling of specific domains via richly typed DSLs.</p>
</div>
</div>
<div class="sect2">
<h3 id="software_model"><a class="anchor" href="#software_model"></a><a class="link" href="#software_model">Rule based model configuration</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rule based configuration <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">will be deprecated</a>.
New plugins should not use this concept.
Instead, use the standard approach described in the <a href="#custom_plugins">Writing Custom Plugins</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rule based model configuration enables <em>configuration logic to itself have dependencies</em> on other elements of configuration, and to make use of the resolved states of those other elements of configuration while performing its own configuration.</p>
</div>
<div class="sect3">
<h4 id="sec:background"><a class="anchor" href="#sec:background"></a><a class="link" href="#sec:background">Background</a></h4>
<div class="paragraph">
<p>In a nutshell, the Software Model is a very declarative way to describe how a piece of software is built and the other components it needs as dependencies in the process. It also provides a new, rule-based engine for configuring a Gradle build. When we started to implement the software model we set ourselves the following goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Improve configuration and execution time performance.</p>
</li>
<li>
<p>Make customizations of builds with complex tool chains easier.</p>
</li>
<li>
<p>Provide a richer, more standardized way to model different software ecosystems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle drastically improved configuration performance through other measures. There is no longer any need for a drastic, incompatible change in how Gradle builds are configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:basic_concepts"><a class="anchor" href="#sec:basic_concepts"></a><a class="link" href="#sec:basic_concepts">Basic Concepts</a></h4>
<div class="sect4">
<h5 id="sec:the_model_space"><a class="anchor" href="#sec:the_model_space"></a><a class="link" href="#sec:the_model_space">The model space</a></h5>
<div class="paragraph">
<p>The term model spaceis used to refer to the formal model, which can be read and modified by rules.</p>
</div>
<div class="paragraph">
<p>A counterpart to the model space is the project space, which should be familiar to readers. The project space is a graph of objects (e.g <code>project.repositories</code>, <code>project.tasks</code> etc.) having a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> as its root. A build script is effectively adding and configuring objects of this graph. For the most part, the project space is opaque to Gradle. It is an arbitrary graph of objects that Gradle only partially understands.</p>
</div>
<div class="paragraph">
<p>Each project also has its own model space, which is distinct from the project space. A key characteristic of the model space is that Gradle knows much more about it (which is knowledge that can be put to good use). The objects in the model space are managed, to a greater extent than objects in the project space. The origin, structure, state, collaborators and relationships of objects in the model space are first class constructs. This is effectively the characteristic that functionally distinguishes the model space from the project space: the objects of the model space are defined in ways that Gradle can understand them intimately, as opposed to an object that is the result of running relatively opaque code. A ruleis effectively a building block of this definition.</p>
</div>
<div class="paragraph">
<p>The model space will eventually replace the project space, becoming the only space.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:rules"><a class="anchor" href="#sec:rules"></a><a class="link" href="#sec:rules">Rules</a></h5>
<div class="paragraph">
<p>The model space is defined by rules. A rule is just a function (in the abstract sense) that either produces a model element, or acts upon a model element. Every rule has a single subject and zero or more inputs. Only the subject can be changed by a rule, while the inputs are effectively immutable.</p>
</div>
<div class="paragraph">
<p>Gradle guarantees that all inputs are fully realized before the rule executes. The process of realizing a model element is effectively executing all the rules for which it is the subject, transitioning it to its final state. There is a strong analogy here to Gradle&#8217;s task graph and task execution model. Just as tasks depend on each other and Gradle ensures that dependencies are satisfied before executing a task, rules effectively depend on each other (i.e. a rule depends on all rules whose subject is one of the inputs) and Gradle ensures that all dependencies are satisfied before executing the rule.</p>
</div>
<div class="paragraph">
<p>Model elements are very often defined in terms of other model elements. For example, a compile task&#8217;s configuration can be defined in terms of the configuration of the source set that it is compiling. In this scenario, the compile task would be the subject of a rule and the source set an input. Such a rule could configure the task subject based on the source set input without concern for how it was configured, who it was configured by or when the configuration was specified.</p>
</div>
<div class="paragraph">
<p>There are several ways to declare rules, and in several forms.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:rule_sources"><a class="anchor" href="#sec:rule_sources"></a><a class="link" href="#sec:rule_sources">Rule sources</a></h4>
<div class="paragraph">
<p>One way to define rules is via a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> subclass. If an object extends RuleSource and contains any methods annotated by '@Mutate', then each such method defines a rule. For each such method, the first argument is the subject, and zero or more subsequent arguments may follow and are inputs of the rule.</p>
</div>
<div class="sect4">
<h5 id="example_applying_a_rule_source_plugin"><a class="anchor" href="#example_applying_a_rule_source_plugin"></a><a class="link" href="#example_applying_a_rule_source_plugin">Example: applying a rule source plugin</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> Person {
  <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> name)
  <span class="predefined-type">String</span> getFirstName()

  <span class="type">void</span> setLastName(<span class="predefined-type">String</span> name)
  <span class="predefined-type">String</span> getLastName()
}

<span class="type">class</span> <span class="class">PersonRules</span> <span class="directive">extends</span> RuleSource {
  <span class="annotation">@Model</span> <span class="type">void</span> person(Person p) {}

  <span class="comment">//Create a rule that modifies a Person and takes no other inputs</span>
  <span class="annotation">@Mutate</span> <span class="type">void</span> setFirstName(Person p) {
    p.firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
  }

  <span class="comment">//Create a rule that modifies a ModelMap&lt;Task&gt; and takes as input a Person</span>
  <span class="annotation">@Mutate</span> <span class="type">void</span> createHelloTask(ModelMap&lt;Task&gt; tasks, Person p) {
    tasks.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) {
      doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.firstName </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.lastName!</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}

apply <span class="key">plugin</span>: PersonRules</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle hello</code></strong></div>
<div class="content">
<pre>&gt; gradle hello

&gt; Task :hello
Hello John Smith!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Each of the different methods of the rule source are discrete, independent rules. Their order, or the fact that they belong to the same class, do not affect their behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_a_model_creation_rule"><a class="anchor" href="#example_a_model_creation_rule"></a><a class="link" href="#example_a_model_creation_rule">Example: a model creation rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Model</span> <span class="type">void</span> person(Person p) {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule declares that there is a model element at path <code>"person"</code> (defined by the method name), of type <code>Person</code>. This is the form of the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Model.html">Model</a> type rule for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Managed.html">Managed</a> types. Here, the person object is the rule subject. The method could potentially have a body, that mutated the person instance. It could also potentially have more parameters, which would be the rule inputs.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_a_model_mutation_rule"><a class="anchor" href="#example_a_model_mutation_rule"></a><a class="link" href="#example_a_model_mutation_rule">Example: a model mutation rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">//Create a rule that modifies a Person and takes no other inputs</span>
<span class="annotation">@Mutate</span> <span class="type">void</span> setFirstName(Person p) {
  p.firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Mutate.html">Mutate</a> rule mutates the person object. The first parameter to the method is the subject. Here, a by-type reference is used as no <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Path.html">Path</a> annotation is present on the parameter. It could also potentially have more parameters, that would be the rule inputs.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_creating_a_task"><a class="anchor" href="#example_creating_a_task"></a><a class="link" href="#example_creating_a_task">Example: creating a task</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">//Create a rule that modifies a ModelMap&lt;Task&gt; and takes as input a Person</span>
<span class="annotation">@Mutate</span> <span class="type">void</span> createHelloTask(ModelMap&lt;Task&gt; tasks, Person p) {
  tasks.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) {
    doLast {
      println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.firstName </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.lastName!</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Mutate.html">Mutate</a> rule effectively adds a task, by mutating the tasks collection. The subject here is the <code>"tasks"</code> node, which is available as a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a>. The only input is our person element. As the person is being used as an input here, it will have been realised before executing this rule. That is, the task container effectively <em>depends on</em> the person element. If there are other configuration rules for the person element, potentially specified in a build script or other plugin, they will also be guaranteed to have been executed.</p>
</div>
<div class="paragraph">
<p>As <code>Person</code> is a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Managed.html">Managed</a> type in this example, any attempt to modify the person parameter in this method would result in an exception being thrown. Managed objects enforce immutability at the appropriate point in their lifecycle.</p>
</div>
<div class="paragraph">
<p>Rule source plugins can be packaged and distributed in the same manner as other types of plugins (see <a href="#custom_plugins">Custom Plugins</a>). They also may be applied in the same manner (to project objects) as <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> implementations (i.e. via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:apply(java.util.Map)">Project.apply(java.util.Map)</a>).</p>
</div>
<div class="paragraph">
<p>Please see the documentation for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> for more information on constraints on how rule sources must be implemented and for more types of rules.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:advanced_concepts"><a class="anchor" href="#sec:advanced_concepts"></a><a class="link" href="#sec:advanced_concepts">Advanced Concepts</a></h4>
<div class="sect4">
<h5 id="sec:model_paths"><a class="anchor" href="#sec:model_paths"></a><a class="link" href="#sec:model_paths">Model paths</a></h5>
<div class="paragraph">
<p>A model path identifies the location of an element relative to the root of its model space. A common representation is a period-delimited set of names. For example, the model path <code>"tasks"</code> is the path to the element that is the task container. Assuming a task whose name is <code>hello</code>, the path <code>"tasks.hello"</code> is the path to this task.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:managed_model_elements"><a class="anchor" href="#sec:managed_model_elements"></a><a class="link" href="#sec:managed_model_elements">Managed model elements</a></h5>
<div class="paragraph">
<p>Currently, any kind of Java object can be part of the model space. However, there is a difference between managed and unmanagedobjects.</p>
</div>
<div class="paragraph">
<p>A managed object is transparent and enforces immutability once realized. Being transparent means that its structure is understood by the rule infrastructure and as such each of its properties are also individual elements in the model space.</p>
</div>
<div class="paragraph">
<p>An unmanagedobject is opaque to the model space and does not enforce immutability. Over time, more mechanisms will be available for defining managed model elements culminating in all model elements being managed in some way.</p>
</div>
<div class="paragraph">
<p>Managed models can be defined by attaching the <code>@Managed</code> annotation to an interface:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_a_managed_type"><a class="anchor" href="#example_a_managed_type"></a><a class="link" href="#example_a_managed_type">Example: a managed type</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> Person {
  <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> name)
  <span class="predefined-type">String</span> getFirstName()

  <span class="type">void</span> setLastName(<span class="predefined-type">String</span> name)
  <span class="predefined-type">String</span> getLastName()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By defining a getter/setter pair, you are effectively declaring a managed property. A managed property is a property for which Gradle will enforce semantics such as immutability when a node of the model is not the subject of a rule. Therefore, this example declares properties named <em>firstName</em> and <em>lastName</em> on the managed type <em>Person</em>. These properties will only be writable when the view is mutable, that is to say when the <em>Person</em> is the subject of a <code>Rule</code> (see below the explanation for rules).</p>
</div>
<div class="paragraph">
<p>Managed properties can be of any scalar type. In addition, properties can also be of any type which is itself managed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property type</th>
<th class="tableblock halign-left valign-top">Nullable</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>String</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setFirstName(<span class="predefined-type">String</span> name)
<span class="predefined-type">String</span> getFirstName()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>File</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setHomeDirectory(<span class="predefined-type">File</span> homeDir)
<span class="predefined-type">File</span> getHomeDirectory()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Integer</code>, <code>Boolean</code>, <code>Byte</code>, <code>Short</code>, <code>Float</code>, <code>Long</code>, <code>Double</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setId(<span class="predefined-type">Long</span> id)
<span class="predefined-type">Long</span> getId()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>int</code>, <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>float</code>, <code>long</code>, <code>double</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setEmployed(<span class="type">boolean</span> isEmployed)
<span class="type">boolean</span> isEmployed()</code></pre>
</div>
</div>
<hr>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setAge(<span class="type">int</span> age)
<span class="type">int</span> getAge()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Another <em>managed</em> type.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only if read/write</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setMother(Person mother)
Person getMother()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An <em>enumeration</em> type.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setMaritalStatus(MaritalStatus status)
MaritalStatus getMaritalStatus()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A <code>ManagedSet</code>. A managed set supports the creation of new named model elements, but not their removal.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only if read/write</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ModelSet&lt;Person&gt; getChildren()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A <code>Set</code> or <code>List</code> of scalar types. All classic operations on collections are supported: add, remove, clear&#8230;&#8203;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only if read/write</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> setUserGroups(<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; groups)
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getUserGroups()</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the type of a property is itself a managed type, it is possible to declare only a getter, in which case you are declaring a read-only property. A read-only property will be instantiated by Gradle, and cannot be replaced with another object of the same type (for example calling a setter). However, the properties of that property can potentially be changed, if, and only if, the property is the subject of a rule. If it&#8217;s not the case, the property is immutable, like any classic read/write managed property, and properties of the property cannot be changed at all.</p>
</div>
<div class="paragraph">
<p>Managed types can be defined out of interfaces or abstract classes and are usually defined in plugins, which are written either in Java or Groovy. Please see the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Managed.html">Managed</a> annotation for more information on creating managed model objects.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:model_element_types"><a class="anchor" href="#sec:model_element_types"></a><a class="link" href="#sec:model_element_types">Model element types</a></h5>
<div class="paragraph">
<p>There are particular types (language types) supported by the model space and can be generalised as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Type definitions</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A scalar type is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a primitive type (e.g. <code>int</code>) or its boxed type (e.g <code>Integer</code>)</p>
</li>
<li>
<p>a <code>BigInteger</code> or <code>BigDecimal</code></p>
</li>
<li>
<p>a <code>String</code></p>
</li>
<li>
<p>a <code>File</code></p>
</li>
<li>
<p>an enumeration type</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalar Collection</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A java.util.List or java.util.Set containing one of the scalar types</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Managed type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any class which is a valid managed model (i.e.annotated with @<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Managed.html">Managed</a>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Managed collection</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelSet.html">ModelSet</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are various contexts in which these types can be used:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Model type support</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Context</th>
<th class="tableblock halign-left valign-top">Supported types</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creating top level model elements</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Any managed type</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/FunctionalSourceSet.html">FunctionalSourceSet</a> (when the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/plugins/LanguageBasePlugin.html">LanguageBasePlugin</a> plugin has been applied)</p>
</li>
<li>
<p>Subtypes of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/LanguageSourceSet.html">LanguageSourceSet</a> which have been registered via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties of managed model elements</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The properties (attributes) of a managed model elements may be one or more of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A managed type</p>
</li>
<li>
<p>A type which is annotated with @<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Unmanaged.html">Unmanaged</a></p>
</li>
<li>
<p>A Scalar Collection</p>
</li>
<li>
<p>A Managed collection containing managed types</p>
</li>
<li>
<p>A Managed collection containing <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/FunctionalSourceSet.html">FunctionalSourceSet</a>'s (when the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/plugins/LanguageBasePlugin.html">LanguageBasePlugin</a> plugin has been applied)</p>
</li>
<li>
<p>Subtypes of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/LanguageSourceSet.html">LanguageSourceSet</a> which have been registered via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sec:language_source_sets"><a class="anchor" href="#sec:language_source_sets"></a><a class="link" href="#sec:language_source_sets">Language source sets</a></h5>
<div class="paragraph">
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/FunctionalSourceSet.html">FunctionalSourceSet</a>s and subtypes of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/LanguageSourceSet.html">LanguageSourceSet</a> (which have been registered via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a>) can be added to the model space via rules or via the model DSL.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:references_binding_and_scopes"><a class="anchor" href="#sec:references_binding_and_scopes"></a><a class="link" href="#sec:references_binding_and_scopes">References, binding and scopes</a></h5>
<div class="paragraph">
<p>As previously mentioned, a rule has a subject and zero or more inputs. The rule&#8217;s subject and inputs are declared as references and are boundto model elements before execution by Gradle. Each rule must effectively forward declare the subject and inputs as references. Precisely how this is done depends on the form of the rule. For example, the rules provided by a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> declare references as method parameters.</p>
</div>
<div class="paragraph">
<p>A reference is either by-path or by-type.</p>
</div>
<div class="paragraph">
<p>A by-type reference identifies a particular model element by its type. For example, a reference to the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskContainer.html">TaskContainer</a> effectively identifies the <code>"tasks"</code> element in the project model space. The model space is not exhaustively searched for candidates for by-type binding; rather, a rule is given a scope (discussed later) that determines the search space for a by-type binding.</p>
</div>
<div class="paragraph">
<p>A by-pathreference identifies a particular model element by its path in model space. By-path references are always relative to the rule scope; there is currently no way to path out of the scope. All by-path references also have an associated type, but this does not influence what the reference binds to. The element identified by the path must however by type compatible with the reference, or a fatal binding failure will occur.</p>
</div>
<div class="sect5">
<h6 id="sec:binding_scope"><a class="anchor" href="#sec:binding_scope"></a><a class="link" href="#sec:binding_scope">Binding scope</a></h6>
<div class="paragraph">
<p>Rules are bound within a scope, which determines how references bind. Most rules are bound at the project scope (i.e. the root of the model graph for the project). However, rules can be scoped to a node within the graph. The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html#named-java.lang.String-java.lang.Class-">ModelMap.named(java.lang.String, java.lang.Class)</a> method is an example of a mechanism for applying scoped rules. Rules declared in the build script using the <code>model {}</code> block, or via a <code>RuleSource</code> applied as a plugin use the root of the model space as the scope. This can be considered the default scope.</p>
</div>
<div class="paragraph">
<p>By-path references are always relative to the rule scope. When the scope is the root, this effectively allows binding to any element in the graph. When it is not, then only the children of the scope can be referenced using "by-path" notation.</p>
</div>
<div class="paragraph">
<p>When binding by-type references, the following elements are considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The scope element itself.</p>
</li>
<li>
<p>The immediate children of the scope element.</p>
</li>
<li>
<p>The immediate children of the model space (i.e. project space) root.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the common case, where the rule is effectively scoped to the root, only the immediate children of the root need to be considered.</p>
</div>
</div>
<div class="sect5">
<h6 id="binding_all_elements_in_scope"><a class="anchor" href="#binding_all_elements_in_scope"></a><a class="link" href="#binding_all_elements_in_scope">Binding to all elements in a scope matching type</a></h6>
<div class="paragraph">
<p>Mutating or validating all elements of a given type in some scope is a common use-case. To accommodate this, rules can be applied via the <code>@Each</code> annotation.</p>
</div>
<div class="paragraph">
<p>In the example below, a <code>@Defaults</code> rule is applied to each <code>FileItem</code> in the model setting a default file size of "1024". Another rule applies a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> to every <code>DirectoryItem</code> that makes sure all file sizes are positive and divisible by "16".</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_a_dsl_example_applying_a_rule_to_every_element_in_a_scope"><a class="anchor" href="#example_a_dsl_example_applying_a_rule_to_every_element_in_a_scope"></a><a class="link" href="#example_a_dsl_example_applying_a_rule_to_every_element_in_a_scope">Example: a DSL example applying a rule to every element in a scope</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span> <span class="type">interface</span> Item <span class="directive">extends</span> Named {}
<span class="annotation">@Managed</span> <span class="type">interface</span> FileItem <span class="directive">extends</span> Item {
    <span class="type">void</span> setSize(<span class="type">int</span> size)
    <span class="type">int</span> getSize()
}
<span class="annotation">@Managed</span> <span class="type">interface</span> DirectoryItem <span class="directive">extends</span> Item {
    ModelMap&lt;Item&gt; getChildren()
}

<span class="type">class</span> <span class="class">PluginRules</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@Defaults</span> <span class="type">void</span> setDefaultFileSize(<span class="annotation">@Each</span> FileItem file) {
        file.size = <span class="integer">1024</span>
    }

    <span class="annotation">@Rules</span> <span class="type">void</span> applyValidateRules(ValidateRules rules, <span class="annotation">@Each</span> DirectoryItem directory)  {}
}
apply <span class="key">plugin</span>: PluginRules

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">ValidateRules</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@Validate</span>
    <span class="type">void</span> validateSizeIsPositive(ModelMap&lt;FileItem&gt; files) {
        files.each { file -&gt;
            <span class="keyword">assert</span> file.size &gt; <span class="integer">0</span>
        }
    }

    <span class="annotation">@Validate</span>
    <span class="type">void</span> validateSizeDivisibleBySixteen(ModelMap&lt;FileItem&gt; files) {
        files.each { file -&gt;
            <span class="keyword">assert</span> file.size % <span class="integer">16</span> == <span class="integer">0</span>
        }
    }
}

model {
    root(DirectoryItem) {
        children {
            dir(DirectoryItem) {
                children {
                    file1(FileItem)
                    file2(FileItem) { size = <span class="integer">2048</span> }
                }
            }
            file3(FileItem)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="model-dsl"><a class="anchor" href="#model-dsl"></a><a class="link" href="#model-dsl">The model DSL</a></h4>
<div class="paragraph">
<p>In addition to using a RuleSource, it is also possible to declare a model and rules directly in a build script using the model DSL.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The model DSL makes heavy use of various Groovy DSL features. Please have a read of <a href="#groovy-dsl-basics">Groovy DSL basics</a> for an introduction to these Groovy features.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The general form of the model DSL is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    <span class="error"></span>rule-definitions<span class="error"></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All rules are nested inside a <code>model</code> block. There may be any number of rule definitions inside each <code>model</code> block, and there may be any number of <code>model</code> blocks in a build script. You can also use a <code>model</code> block in build scripts that are applied using <code>apply from: $uri</code>.</p>
</div>
<div class="paragraph">
<p>There are currently 2 kinds of rule that you can define using the model DSL: configuration rules, and creation rules.</p>
</div>
<div class="sect4">
<h5 id="sec:configuration_rules"><a class="anchor" href="#sec:configuration_rules"></a><a class="link" href="#sec:configuration_rules">Configuration rules</a></h5>
<div class="paragraph">
<p>You can define a rule that configures a particular model element. A configuration rule has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    <span class="error"></span>model-path-to-subject<span class="error"></span> {
        <span class="error"></span>configuration code<span class="error"></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Continuing with the example so far of the model element <code>"person"</code> of type <code>Person</code> being present, the following DSL snippet adds a configuration rule for the person that sets its <code>lastName</code> property.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dsl_configuration_rule"><a class="anchor" href="#example_dsl_configuration_rule"></a><a class="link" href="#example_dsl_configuration_rule">Example: DSL configuration rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    person {
        lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A configuration rule specifies a path to the subject that should be configured and a closure containing the code to run when the subject is configured. The closure is executed with the subject passed as the closure delegate. Exactly what code you can provide in the closure depends on the type of the subject. This is discussed below.</p>
</div>
<div class="paragraph">
<p>You should note that the configuration code is not executed immediately but is instead executed only when the subject is required. This is an important behaviour of model rules and allows Gradle to configure only those elements that are required for the build, which helps reduce build time. For example, let&#8217;s run a task that uses the "person" object:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuration_run_when_required"><a class="anchor" href="#example_configuration_run_when_required"></a><a class="link" href="#example_configuration_run_when_required">Example: Configuration run when required</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    person {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">configuring person</span><span class="delimiter">&quot;</span></span>
        lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle showPerson</code></strong></div>
<div class="content">
<pre>&gt; gradle showPerson
configuring person

&gt; Task :showPerson
Hello John Smith!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that before the task is run, the "person" element is configured by running the rule closure. Now let&#8217;s run a task that does not require the "person" element:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configuration_not_run_when_not_required"><a class="anchor" href="#example_configuration_not_run_when_not_required"></a><a class="link" href="#example_configuration_not_run_when_not_required">Example: Configuration not run when not required</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle somethingElse</code></strong></div>
<div class="content">
<pre>&gt; gradle somethingElse

&gt; Task :somethingElse
Not using person

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In this instance, you can see that the "person" element is not configured at all.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:creation_rules"><a class="anchor" href="#sec:creation_rules"></a><a class="link" href="#sec:creation_rules">Creation rules</a></h5>
<div class="paragraph">
<p>It is also possible to create model elements at the root level. The general form of a creation rule is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    <span class="error"></span>element-name<span class="error"></span>(<span class="error"></span>element-type<span class="error"></span>) {
        <span class="error"></span>initialization code<span class="error"></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following model rule creates the <code>"person"</code> element:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dsl_creation_rule"><a class="anchor" href="#example_dsl_creation_rule"></a><a class="link" href="#example_dsl_creation_rule">Example: DSL creation rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    person(Person) {
        firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A creation rule definition specifies the path of the element to create, plus its public type, represented as a Java interface or class. Only certain types of model elements can be created.</p>
</div>
<div class="paragraph">
<p>A creation rule may also provide a closure containing the initialization code to run when the element is created. The closure is executed with the element passed as the closure delegate. Exactly what code you can provide in the closure depends on the type of the subject. This is discussed below.</p>
</div>
<div class="paragraph">
<p>The initialization closure is optional and can be omitted, for example:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dsl_creation_rule_without_initialization"><a class="anchor" href="#example_dsl_creation_rule_without_initialization"></a><a class="link" href="#example_dsl_creation_rule_without_initialization">Example: DSL creation rule without initialization</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    barry(Person)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should note that the initialization code is not executed immediately but is instead executed only when the element is required. The initialization code is executed before any configuration rules are run. For example:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_initialization_before_configuration"><a class="anchor" href="#example_initialization_before_configuration"></a><a class="link" href="#example_initialization_before_configuration">Example: Initialization before configuration</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    person {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">configuring person</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">last name is </span><span class="inline"><span class="inline-delimiter">$</span>lastName</span><span class="content">, should be Smythe</span><span class="delimiter">&quot;</span></span>
        lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smythe</span><span class="delimiter">&quot;</span></span>
    }
    person(Person) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">creating person</span><span class="delimiter">&quot;</span></span>
        firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
        lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle showPerson</code></strong></div>
<div class="content">
<pre>&gt; gradle showPerson
creating person
configuring person
last name is Smith, should be Smythe

&gt; Task :showPerson
Hello John Smythe!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the creation rule appears in the build script <em>after</em> the configuration rule, but its code runs before the code of the configuration rule. Gradle collects up all the rules for a particular subject before running any of them, then runs the rules in the appropriate order.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:model_rule_closures"><a class="anchor" href="#sec:model_rule_closures"></a><a class="link" href="#sec:model_rule_closures">Model rule closures</a></h5>
<div class="paragraph">
<p>Most DSL rules take a closure containing some code to run to configure the subject. The code you can use in this closure depends on the type of the subject of the rule.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <a href="#model-report">model report</a> to determine the type of a particular model element.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general, a rule closure may contain arbitrary code, mixed with some type specific DSL syntax.</p>
</div>
<div class="sect5">
<h6 id="sec:modelmap_subject"><a class="anchor" href="#sec:modelmap_subject"></a><a class="link" href="#sec:modelmap_subject"><code>ModelMap&lt;T&gt;</code> subject</a></h6>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> is basically a map of model elements, indexed by some name. When a <code>ModelMap</code> is used as the subject of a DSL rule, the rule closure can use any of the methods defined on the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> interface.</p>
</div>
<div class="paragraph">
<p>A rule closure with <code>ModelMap</code> as a subject can also include nested creation or configuration rules. These behave in a similar way to the creation and configuration rules that appear directly under the <code>model</code> block.</p>
</div>
<div class="paragraph">
<p>Here is an example of a nested creation rule:</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_nested_dsl_creation_rule"><a class="anchor" href="#example_nested_dsl_creation_rule"></a><a class="link" href="#example_nested_dsl_creation_rule">Example: Nested DSL creation rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    people {
        john(Person) {
            firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, a nested creation rule defines a name and public type for the element, and optionally, a closure containing code to use to initialize the element. The code is run only when the element is required in the build.</p>
</div>
<div class="paragraph">
<p>Here is an example of a nested configuration rule:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_nested_dsl_configuration_rule"><a class="anchor" href="#example_nested_dsl_configuration_rule"></a><a class="link" href="#example_nested_dsl_configuration_rule">Example: Nested DSL configuration rule</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    people {
        john {
            lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, a nested configuration rule defines the name of the element to configure and a closure containing code to use to configure the element. The code is run only when the element is required in the build.</p>
</div>
<div class="paragraph">
<p><code>ModelMap</code> introduces several other kinds of rules. For example, you can define a rule that targets each of the elements in the map. The code in the rule closure is executed once for each element in the map, when that element is required. Let&#8217;s run a task that requires all of the children of the "people" element:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_dsl_configuration_rule_for_each_element_in_a_map"><a class="anchor" href="#example_dsl_configuration_rule_for_each_element_in_a_map"></a><a class="link" href="#example_dsl_configuration_rule_for_each_element_in_a_map">Example: DSL configuration rule for each element in a map</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    people {
        john(Person) {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">creating </span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="delimiter">&quot;</span></span>
            firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>
            lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>
        }
        all {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">configuring </span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="delimiter">&quot;</span></span>
        }
        barry(Person) {
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">creating </span><span class="inline"><span class="inline-delimiter">$</span><span class="local-variable">it</span></span><span class="delimiter">&quot;</span></span>
            firstName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Barry</span><span class="delimiter">&quot;</span></span>
            lastName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Barry</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle listPeople</code></strong></div>
<div class="content">
<pre>&gt; gradle listPeople
creating Person 'people.barry'
configuring Person 'people.barry'
creating Person 'people.john'
configuring Person 'people.john'

&gt; Task :listPeople
Hello Barry Barry!
Hello John Smith!

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>Any method on <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> that accepts an <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Action.html">Action</a> as its last parameter can also be used to define a nested rule.</p>
</div>
<div class="sect5">
<h6 id="sec:managed_type_subject"><a class="anchor" href="#sec:managed_type_subject"></a><a class="link" href="#sec:managed_type_subject"><code>@Managed</code> type subject</a></h6>
<div class="paragraph">
<p>When a managed type is used as the subject of a DSL rule, the rule closure can use any of the methods defined on the managed type interface.</p>
</div>
<div class="paragraph">
<p>A rule closure can also configure the properties of the element using nested closures. For example:</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_nested_dsl_property_configuration"><a class="anchor" href="#example_nested_dsl_property_configuration"></a><a class="link" href="#example_nested_dsl_property_configuration">Example: Nested DSL property configuration</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    person {
        address {
            city = <span class="string"><span class="delimiter">&quot;</span><span class="content">Melbourne</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, the nested closures do not define rules and are executed immediately. Please be aware that this behaviour will change in a future Gradle release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="sec:all_other_subjects"><a class="anchor" href="#sec:all_other_subjects"></a><a class="link" href="#sec:all_other_subjects">All other subjects</a></h6>
<div class="paragraph">
<p>For all other types, the rule closure can use any of the methods defined by the type. There is no special DSL defined for these elements.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsl-type-coercion"><a class="anchor" href="#dsl-type-coercion"></a><a class="link" href="#dsl-type-coercion">Automatic type coercion</a></h5>
<div class="paragraph">
<p>Scalar properties in managed types can be assigned <code>CharSequence</code> values (e.g. <code>String</code>, <code>GString</code>, etc.) and they will be converted to the actual property type for you. This works for all scalar types including `File`s, which will be resolved relative to the current project.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_a_dsl_example_showing_type_conversions"><a class="anchor" href="#example_a_dsl_example_showing_type_conversions"></a><a class="link" href="#example_a_dsl_example_showing_type_conversions">Example: a DSL example showing type conversions</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">enum</span> Temperature {
   TOO_HOT,
   TOO_COLD,
   JUST_RIGHT
}

<span class="annotation">@Managed</span>
<span class="type">interface</span> Item {
   <span class="type">void</span> setName(<span class="predefined-type">String</span> n); <span class="predefined-type">String</span> getName()

   <span class="type">void</span> setQuantity(<span class="type">int</span> q); <span class="type">int</span> getQuantity()

   <span class="type">void</span> setPrice(<span class="type">float</span> p); <span class="type">float</span> getPrice()

   <span class="type">void</span> setTemperature(Temperature t)
   Temperature getTemperature()

   <span class="type">void</span> setDataFile(<span class="predefined-type">File</span> f); <span class="predefined-type">File</span> getDataFile()
}

<span class="type">class</span> <span class="class">ItemRules</span> <span class="directive">extends</span> RuleSource {
   <span class="annotation">@Model</span>
   <span class="type">void</span> item(Item item) {
      <span class="keyword">def</span> data = item.dataFile.text.trim()
      <span class="keyword">def</span> (name, quantity, price, temp) = data.split(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)
      item.name = name
      item.quantity = quantity
      item.price = price
      item.temperature = temp
   }

   <span class="annotation">@Defaults</span>
   <span class="type">void</span> setDefaults(Item item) {
      item.dataFile = <span class="string"><span class="delimiter">'</span><span class="content">data.csv</span><span class="delimiter">'</span></span>
   }

   <span class="annotation">@Mutate</span>
   <span class="type">void</span> createDataTask(ModelMap&lt;Task&gt; tasks, Item item) {
      tasks.create(<span class="string"><span class="delimiter">'</span><span class="content">showData</span><span class="delimiter">'</span></span>) {
         doLast {
            println <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
Item '</span><span class="inline"><span class="inline-delimiter">$</span>item</span><span class="content">.name'
   quantity:    </span><span class="inline"><span class="inline-delimiter">$</span>item</span><span class="content">.quantity
   price:       </span><span class="inline"><span class="inline-delimiter">$</span>item</span><span class="content">.price
   temperature: </span><span class="inline"><span class="inline-delimiter">$</span>item</span><span class="content">.temperature</span><span class="delimiter">&quot;&quot;&quot;</span></span>
         }
      }
   }
}

apply <span class="key">plugin</span>: ItemRules

model {
   item {
      price = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>price * (quantity &lt; <span class="integer">10</span> ? <span class="integer">2</span> : <span class="float">0.5</span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, an <code>Item</code> is created and is initialized in <code>setDefaults()</code> by providing the path to the data file. In the <code>item()</code> method the resolved <code>File</code> is parsed to extract and set the data. In the DSL block at the end, the price is adjusted based on the quantity; if there are fewer than 10 remaining the price is doubled, otherwise it is reduced by 50%. The <code>GString</code> expression is a valid value since it resolves to a <code>float</code> value in string form.</p>
</div>
<div class="paragraph">
<p>Finally, in <code>createDataTask()</code> we add the <code>showData</code> task to display all of the configured values.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsl-rule-input-dependencies"><a class="anchor" href="#dsl-rule-input-dependencies"></a><a class="link" href="#dsl-rule-input-dependencies">Declaring input dependencies</a></h5>
<div class="paragraph">
<p>Rules declared in the DSL may <em>depend</em> on other model elements through the use of a special syntax, which is of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>.<span class="error"></span>path-to-model-element<span class="error"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Paths are a period separated list of identifiers. To directly depend on the <code>firstName</code> of the person, the following could be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>.person.firstName</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example_a_dsl_rule_using_inputs"><a class="anchor" href="#example_a_dsl_rule_using_inputs"></a><a class="link" href="#example_a_dsl_rule_using_inputs">Example: a DSL rule using inputs</a></h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    tasks {
        hello(Task) {
            <span class="keyword">def</span> p = <span class="error">$</span>.person
            doLast {
                println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.firstName </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.lastName!</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above snippet, the <code>$.person</code> construct is an input reference. The construct returns the value of the model element at the specified path, as its default type (i.e. the type advertised by the <a href="#model-report">Model Report</a>). It may appear anywhere in the rule that an expression may normally appear. It is not limited to the right hand side of variable assignments.</p>
</div>
<div class="paragraph">
<p>The input element is guaranteed to be fully configured before the rule executes. That is, all of the rules that mutate the element are guaranteed to have been previously executed, leaving the target element in its final, immutable, state.</p>
</div>
<div class="paragraph">
<p>Most model elements enforce immutability when being used as inputs. Any attempt to mutate such an element will result in a runtime error. However, some legacy type objects do not currently implement such checks. Regardless, it is always invalid to attempt to mutate an input to a rule.</p>
</div>
<div class="sect5">
<h6 id="sec:using_modelmap_as_an_input"><a class="anchor" href="#sec:using_modelmap_as_an_input"></a><a class="link" href="#sec:using_modelmap_as_an_input">Using <code>ModelMap&lt;T&gt;</code> as an input</a></h6>
<div class="paragraph">
<p>When you use a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/ModelMap.html">ModelMap</a> as input, each item in the map is made available as a property.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="model-report"><a class="anchor" href="#model-report"></a><a class="link" href="#model-report">The model report</a></h4>
<div class="paragraph">
<p>The built-in <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.reporting.model.ModelReport.html">ModelReport</a> task displays a hierarchical view of the elements in the model space. Each item prefixed with a <code>+</code> on the model report is a model element and the visual nesting of these elements correlates to the model path (e.g. <code>tasks.help</code>). The model report displays the following details about each model element:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 19. Model report - model element details</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Detail</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the underlying type of the model element and is typically a fully qualified class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is conditionally displayed on the report when a model element can be represented as a string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Every model element has a creator. A creator signifies the origin of the model element (i.e. what created the model element).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is a listing of the rules, excluding the creator rule, which are executed for a given model element. The order in which the rules are displayed reflects the order in which they are executed.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="example_model_task_output"><a class="anchor" href="#example_model_task_output"></a><a class="link" href="#example_model_task_output">Example: Model task output</a></h5>
<div class="listingblock">
<div class="title">Output of <code>gradle model</code></div>
<div class="content">
<pre>&gt; gradle model

&gt; Task :model

------------------------------------------------------------
Root project
------------------------------------------------------------

+ person
      | Type:   	Person
      | Creator: 	PersonRules#person(Person)
      | Rules:
          person { ... } @ build.gradle line 97, column 3
          PersonRules#setFirstName(Person)
    + age
          | Type:   	int
          | Value:  	0
          | Creator: 	PersonRules#person(Person)
    + children
          | Type:   	org.gradle.model.ModelSet&lt;Person&gt;
          | Creator: 	PersonRules#person(Person)
    + employed
          | Type:   	boolean
          | Value:  	false
          | Creator: 	PersonRules#person(Person)
    + father
          | Type:   	Person
          | Value:  	null
          | Creator: 	PersonRules#person(Person)
    + firstName
          | Type:   	java.lang.String
          | Value:  	John
          | Creator: 	PersonRules#person(Person)
    + homeDirectory
          | Type:   	java.io.File
          | Value:  	null
          | Creator: 	PersonRules#person(Person)
    + id
          | Type:   	java.lang.Long
          | Value:  	null
          | Creator: 	PersonRules#person(Person)
    + lastName
          | Type:   	java.lang.String
          | Value:  	Smith
          | Creator: 	PersonRules#person(Person)
    + maritalStatus
          | Type:   	MaritalStatus
          | Creator: 	PersonRules#person(Person)
    + mother
          | Type:   	Person
          | Value:  	null
          | Creator: 	PersonRules#person(Person)
    + userGroups
          | Type:   	java.util.List&lt;java.lang.String&gt;
          | Value:  	null
          | Creator: 	PersonRules#person(Person)
+ tasks
      | Type:   	org.gradle.model.ModelMap&lt;org.gradle.api.Task&gt;
      | Creator: 	Project.&lt;init&gt;.tasks()
      | Rules:
          PersonRules#createHelloTask(ModelMap&lt;Task&gt;, Person)
    + buildEnvironment
          | Type:   	org.gradle.api.tasks.diagnostics.BuildEnvironmentReportTask
          | Value:  	task ':buildEnvironment'
          | Creator: 	Project.&lt;init&gt;.tasks.buildEnvironment()
          | Rules:
              copyToTaskContainer
    + components
          | Type:   	org.gradle.api.reporting.components.ComponentReport
          | Value:  	task ':components'
          | Creator: 	Project.&lt;init&gt;.tasks.components()
          | Rules:
              copyToTaskContainer
    + dependencies
          | Type:   	org.gradle.api.tasks.diagnostics.DependencyReportTask
          | Value:  	task ':dependencies'
          | Creator: 	Project.&lt;init&gt;.tasks.dependencies()
          | Rules:
              copyToTaskContainer
    + dependencyInsight
          | Type:   	org.gradle.api.tasks.diagnostics.DependencyInsightReportTask
          | Value:  	task ':dependencyInsight'
          | Creator: 	Project.&lt;init&gt;.tasks.dependencyInsight()
          | Rules:
              copyToTaskContainer
    + dependentComponents
          | Type:   	org.gradle.api.reporting.dependents.DependentComponentsReport
          | Value:  	task ':dependentComponents'
          | Creator: 	Project.&lt;init&gt;.tasks.dependentComponents()
          | Rules:
              copyToTaskContainer
    + hello
          | Type:   	org.gradle.api.Task
          | Value:  	task ':hello'
          | Creator: 	PersonRules#createHelloTask(ModelMap&lt;Task&gt;, Person) &gt; create(hello)
          | Rules:
              copyToTaskContainer
    + help
          | Type:   	org.gradle.configuration.Help
          | Value:  	task ':help'
          | Creator: 	Project.&lt;init&gt;.tasks.help()
          | Rules:
              copyToTaskContainer
    + init
          | Type:   	org.gradle.buildinit.tasks.InitBuild
          | Value:  	task ':init'
          | Creator: 	Project.&lt;init&gt;.tasks.init()
          | Rules:
              copyToTaskContainer
    + model
          | Type:   	org.gradle.api.reporting.model.ModelReport
          | Value:  	task ':model'
          | Creator: 	Project.&lt;init&gt;.tasks.model()
          | Rules:
              copyToTaskContainer
    + outgoingVariants
          | Type:   	org.gradle.api.tasks.diagnostics.OutgoingVariantsReportTask
          | Value:  	task ':outgoingVariants'
          | Creator: 	Project.&lt;init&gt;.tasks.outgoingVariants()
          | Rules:
              copyToTaskContainer
    + prepareKotlinBuildScriptModel
          | Type:   	org.gradle.api.DefaultTask
          | Value:  	task ':prepareKotlinBuildScriptModel'
          | Creator: 	Project.&lt;init&gt;.tasks.prepareKotlinBuildScriptModel()
          | Rules:
              copyToTaskContainer
    + projects
          | Type:   	org.gradle.api.tasks.diagnostics.ProjectReportTask
          | Value:  	task ':projects'
          | Creator: 	Project.&lt;init&gt;.tasks.projects()
          | Rules:
              copyToTaskContainer
    + properties
          | Type:   	org.gradle.api.tasks.diagnostics.PropertyReportTask
          | Value:  	task ':properties'
          | Creator: 	Project.&lt;init&gt;.tasks.properties()
          | Rules:
              copyToTaskContainer
    + tasks
          | Type:   	org.gradle.api.tasks.diagnostics.TaskReportTask
          | Value:  	task ':tasks'
          | Creator: 	Project.&lt;init&gt;.tasks.tasks()
          | Rules:
              copyToTaskContainer
    + wrapper
          | Type:   	org.gradle.api.tasks.wrapper.Wrapper
          | Value:  	task ':wrapper'
          | Creator: 	Project.&lt;init&gt;.tasks.wrapper()
          | Rules:
              copyToTaskContainer</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:limitations_and_future_direction"><a class="anchor" href="#sec:limitations_and_future_direction"></a><a class="link" href="#sec:limitations_and_future_direction">Limitations and future direction</a></h4>
<div class="paragraph">
<p><em>The rule engine that was part of the Software Model will be deprecated.</em> Everything under the model block will be ported as extensions to the current model. Native users will no longer have a separate extension model compared to the rest of the Gradle community, and they will be able to make use of the new variant aware dependency management. For more information, see the <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">blog post</a> on the state and future of the software model.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rule_source"><a class="anchor" href="#rule_source"></a><a class="link" href="#rule_source">Implementing model rules in a plugin</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rule based configuration <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">will be deprecated</a>.
New plugins should not use this concept.
Instead, use the standard approach described in the <a href="#custom_plugins">Writing Custom Plugins</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A plugin can define rules by extending <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> and adding methods that define the rules. The plugin class can either extend <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> directly or can implement <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> and include a nested <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> subclass.</p>
</div>
<div class="paragraph">
<p>Refer to the API docs for <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> for more details.</p>
</div>
<div class="sect3">
<h4 id="sec:applying_additional_rules"><a class="anchor" href="#sec:applying_additional_rules"></a><a class="link" href="#sec:applying_additional_rules">Applying additional rules</a></h4>
<div class="paragraph">
<p>A rule method annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/Rules.html">Rules</a> can apply a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/model/RuleSource.html">RuleSource</a> to a target model element.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="software_model_extend"><a class="anchor" href="#software_model_extend"></a><a class="link" href="#software_model_extend">Extending the software model</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Rule based configuration <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">will be deprecated</a>.
New plugins should not use this concept.
Instead, use the standard approach described in the <a href="#custom_plugins">Writing Custom Plugins</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="introduction_2"><a class="anchor" href="#introduction_2"></a><a class="link" href="#introduction_2">Introduction</a></h4>
<div class="paragraph">
<p>One of the strengths of Gradle has always been its extensibility, and its adaptability to new domains. The software model takes this extensibility to a new level, enabling the deep modeling of specific domains via richly typed DSLs. The following chapter describes how the model and the corresponding DSLs can be extended to support different domains. Before reading this you should be familiar with the Gradle software model <a href="#software_model">rule based configuration</a> and <a href="#software_model_concepts">concepts</a>.</p>
</div>
<div class="paragraph">
<p>The following build script is an example of using a custom software model for building Markdown based documentation:</p>
</div>
<div class="sect4">
<h5 id="example_an_example_of_using_a_custom_software_model"><a class="anchor" href="#example_an_example_of_using_a_custom_software_model"></a><a class="link" href="#example_an_example_of_using_a_custom_software_model">Example: an example of using a custom software model</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">sample.documentation.DocumentationComponent</span>
<span class="keyword">import</span> <span class="include">sample.documentation.TextSourceSet</span>
<span class="keyword">import</span> <span class="include">sample.markdown.MarkdownSourceSet</span>

apply <span class="key">plugin</span>: sample.documentation.DocumentationPlugin
apply <span class="key">plugin</span>: sample.markdown.MarkdownPlugin

model {
    components {
        docs(DocumentationComponent) {
            sources {
                reference(TextSourceSet)
                userguide(MarkdownSourceSet) {
                    generateIndex = <span class="predefined-constant">true</span>
                    smartQuotes = <span class="predefined-constant">true</span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of this chapter is dedicated to explaining what is going on behind this build script.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:concepts"><a class="anchor" href="#sec:concepts"></a><a class="link" href="#sec:concepts">Concepts</a></h4>
<div class="paragraph">
<p>A custom software model type has a public type, a base interface and internal views. Multiple such types then collaborate to define a custom software model.</p>
</div>
<div class="sect4">
<h5 id="sec:public_type_and_base_interfaces"><a class="anchor" href="#sec:public_type_and_base_interfaces"></a><a class="link" href="#sec:public_type_and_base_interfaces">Public type and base interfaces</a></h5>
<div class="paragraph">
<p>Extended types declare a <em>public type</em> that extends a <em>base interface</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Components extend the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentSpec.html">ComponentSpec</a> base interface</p>
</li>
<li>
<p>Binaries extend the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/BinarySpec.html">BinarySpec</a> base interface</p>
</li>
<li>
<p>Source sets extend the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/LanguageSourceSet.html">LanguageSourceSet</a> base interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>public type</em> is exposed to build logic.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:internal_views"><a class="anchor" href="#sec:internal_views"></a><a class="link" href="#sec:internal_views">Internal views</a></h5>
<div class="paragraph">
<p>Adding internal views to your model type, you can make some data visible to build logic via a public type, while hiding the rest of the data behind the internal view types. This is covered in a <a href="#software-model-extend-internal-views">dedicated section</a> below.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:components_all_the_way_down"><a class="anchor" href="#sec:components_all_the_way_down"></a><a class="link" href="#sec:components_all_the_way_down">Components all the way down</a></h5>
<div class="paragraph">
<p>Components are composed of other components. A source set is just a special kind of component representing sources. It might be that the sources are provided, or generated. Similarly, some components are composed of different binaries, which are built by tasks. All buildable components are built by tasks. In the software model, you will write rules to generate both binaries from components and tasks from binaries.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:components"><a class="anchor" href="#sec:components"></a><a class="link" href="#sec:components">Components</a></h4>
<div class="paragraph">
<p>To declare a custom component type one must extend <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentSpec.html">ComponentSpec</a>, or one of the following, depending on the use case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/SourceComponentSpec.html">SourceComponentSpec</a> represents a component which has sources</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/VariantComponentSpec.html">VariantComponentSpec</a> represents a component which generates different binaries based on context (target platforms, build flavors, &#8230;&#8203;). Such a component generally produces multiple binaries.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/GeneralComponentSpec.html">GeneralComponentSpec</a> is a convenient base interface for components that are built from sources and variant-aware. This is the typical case for a lot of software components, and therefore it should be in most of the cases the base type to be extended.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The core software model includes more types that can be used as base for extension. For example: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/LibrarySpec.html">LibrarySpec</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ApplicationSpec.html">ApplicationSpec</a> can also be extended in this manner. Theses are no-op extensions of <code>GeneralComponentSpec</code> used to describe a software model better by distinguishing libraries and applications components. <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testing/base/TestSuiteSpec.html">TestSuiteSpec</a> should be used for all components that describe a test suite.</p>
</div>
<div class="sect4">
<h5 id="example_declare_a_custom_component"><a class="anchor" href="#example_declare_a_custom_component"></a><a class="link" href="#example_declare_a_custom_component">Example: Declare a custom component</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationComponent.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> DocumentationComponent <span class="directive">extends</span> GeneralComponentSpec {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types extending <code>ComponentSpec</code> are registered via a rule annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a>:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_register_a_custom_component"><a class="anchor" href="#example_register_a_custom_component"></a><a class="link" href="#example_register_a_custom_component">Example: Register a custom component</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DocumentationPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@ComponentType</span>
    <span class="type">void</span> registerComponent(TypeBuilder&lt;DocumentationComponent&gt; builder) {}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:binaries"><a class="anchor" href="#sec:binaries"></a><a class="link" href="#sec:binaries">Binaries</a></h4>
<div class="paragraph">
<p>To declare a custom binary type one must extend <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/BinarySpec.html">BinarySpec</a>.</p>
</div>
<div class="sect4">
<h5 id="example_declare_a_custom_binary"><a class="anchor" href="#example_declare_a_custom_binary"></a><a class="link" href="#example_declare_a_custom_binary">Example: Declare a custom binary</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationBinary.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> DocumentationBinary <span class="directive">extends</span> BinarySpec {
    <span class="predefined-type">File</span> getOutputDir()
    <span class="type">void</span> setOutputDir(<span class="predefined-type">File</span> outputDir)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types extending <code>BinarySpec</code> are registered via a rule annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a>:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_register_a_custom_binary"><a class="anchor" href="#example_register_a_custom_binary"></a><a class="link" href="#example_register_a_custom_binary">Example: Register a custom binary</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DocumentationPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@ComponentType</span>
    <span class="type">void</span> registerBinary(TypeBuilder&lt;DocumentationBinary&gt; builder) {}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:source_sets"><a class="anchor" href="#sec:source_sets"></a><a class="link" href="#sec:source_sets">Source sets</a></h4>
<div class="paragraph">
<p>To declare a custom source set type one must extend <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/language/base/LanguageSourceSet.html">LanguageSourceSet</a>.</p>
</div>
<div class="sect4">
<h5 id="example_declare_a_custom_source_set"><a class="anchor" href="#example_declare_a_custom_source_set"></a><a class="link" href="#example_declare_a_custom_source_set">Example: Declare a custom source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">MarkdownSourceSet.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span>
<span class="type">interface</span> MarkdownSourceSet <span class="directive">extends</span> LanguageSourceSet {
    <span class="type">boolean</span> isGenerateIndex()
    <span class="type">void</span> setGenerateIndex(<span class="type">boolean</span> generateIndex)

    <span class="type">boolean</span> isSmartQuotes()
    <span class="type">void</span> setSmartQuotes(<span class="type">boolean</span> smartQuotes)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types extending <code>LanguageSourceSet</code> are registered via a rule annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentType.html">ComponentType</a>:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_register_a_custom_source_set"><a class="anchor" href="#example_register_a_custom_source_set"></a><a class="link" href="#example_register_a_custom_source_set">Example: Register a custom source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">MarkdownPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MarkdownPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@ComponentType</span>
    <span class="type">void</span> registerMarkdownLanguage(TypeBuilder&lt;MarkdownSourceSet&gt; builder) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting the <em>language name</em> is mandatory.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:putting_it_all_together"><a class="anchor" href="#sec:putting_it_all_together"></a><a class="link" href="#sec:putting_it_all_together">Putting it all together</a></h4>
<div class="sect4">
<h5 id="sec:generating_binaries_from_components"><a class="anchor" href="#sec:generating_binaries_from_components"></a><a class="link" href="#sec:generating_binaries_from_components">Generating binaries from components</a></h5>
<div class="paragraph">
<p>Binaries generation from components is done via rules annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/ComponentBinaries.html">ComponentBinaries</a>. This rule generates a <code>DocumentationBinary</code> named <code>exploded</code> for each <code>DocumentationComponent</code> and sets its <code>outputDir</code> property:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_generates_documentation_binaries"><a class="anchor" href="#example_generates_documentation_binaries"></a><a class="link" href="#example_generates_documentation_binaries">Example: Generates documentation binaries</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DocumentationPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@ComponentBinaries</span>
    <span class="type">void</span> generateDocBinaries(ModelMap&lt;DocumentationBinary&gt; binaries, VariantComponentSpec component, <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">buildDir</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">File</span> buildDir) {
        binaries.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">exploded</span><span class="delimiter">&quot;</span></span>) { binary -&gt;
            outputDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(buildDir, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>component.name<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>binary.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:generating_tasks_from_binaries"><a class="anchor" href="#sec:generating_tasks_from_binaries"></a><a class="link" href="#sec:generating_tasks_from_binaries">Generating tasks from binaries</a></h5>
<div class="paragraph">
<p>Tasks generation from binaries is done via rules annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/platform/base/BinaryTasks.html">BinaryTasks</a>. This rule generates a <code>Copy</code> task for each <code>TextSourceSet</code> of each <code>DocumentationBinary</code>:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_generates_tasks_for_text_source_sets"><a class="anchor" href="#example_generates_tasks_for_text_source_sets"></a><a class="link" href="#example_generates_tasks_for_text_source_sets">Example: Generates tasks for text source sets</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">DocumentationPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DocumentationPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@BinaryTasks</span>
    <span class="type">void</span> generateTextTasks(ModelMap&lt;Task&gt; tasks, <span class="directive">final</span> DocumentationBinary binary) {
        binary.inputs.withType(TextSourceSet) { textSourceSet -&gt;
            <span class="keyword">def</span> taskName = binary.tasks.taskName(<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, textSourceSet.name)
            <span class="keyword">def</span> outputDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(binary.outputDir, textSourceSet.name)
            tasks.create(taskName, Copy) {
                from textSourceSet.source
                destinationDir = outputDir
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule generates a <code>MarkdownCompileTask</code> task for each <code>MarkdownSourceSet</code> of each <code>DocumentationBinary</code>:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_register_a_custom_source_set_2"><a class="anchor" href="#example_register_a_custom_source_set_2"></a><a class="link" href="#example_register_a_custom_source_set_2">Example: Register a custom source set</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">MarkdownPlugin.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MarkdownPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@BinaryTasks</span>
    <span class="type">void</span> processMarkdownDocumentation(ModelMap&lt;Task&gt; tasks, <span class="directive">final</span> DocumentationBinary binary) {
        binary.inputs.withType(MarkdownSourceSet) { markdownSourceSet -&gt;
            <span class="keyword">def</span> taskName = binary.tasks.taskName(<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span>, markdownSourceSet.name)
            <span class="keyword">def</span> outputDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(binary.outputDir, markdownSourceSet.name)
            tasks.create(taskName, MarkdownHtmlCompile) { compileTask -&gt;
                compileTask.source = markdownSourceSet.source
                compileTask.destinationDir = outputDir
                compileTask.smartQuotes = markdownSourceSet.smartQuotes
                compileTask.generateIndex = markdownSourceSet.generateIndex
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the sample source for more on the <code>MarkdownCompileTask</code> task.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_your_custom_model"><a class="anchor" href="#sec:using_your_custom_model"></a><a class="link" href="#sec:using_your_custom_model">Using your custom model</a></h5>
<div class="paragraph">
<p>This build script demonstrate usage of the custom model defined in the sections above:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_an_example_of_using_a_custom_software_model_2"><a class="anchor" href="#example_an_example_of_using_a_custom_software_model_2"></a><a class="link" href="#example_an_example_of_using_a_custom_software_model_2">Example: an example of using a custom software model</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">sample.documentation.DocumentationComponent</span>
<span class="keyword">import</span> <span class="include">sample.documentation.TextSourceSet</span>
<span class="keyword">import</span> <span class="include">sample.markdown.MarkdownSourceSet</span>

apply <span class="key">plugin</span>: sample.documentation.DocumentationPlugin
apply <span class="key">plugin</span>: sample.markdown.MarkdownPlugin

model {
    components {
        docs(DocumentationComponent) {
            sources {
                reference(TextSourceSet)
                userguide(MarkdownSourceSet) {
                    generateIndex = <span class="predefined-constant">true</span>
                    smartQuotes = <span class="predefined-constant">true</span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in the components reports for such a build script we can see our model types properly registered:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_components_report"><a class="anchor" href="#example_components_report"></a><a class="link" href="#example_components_report">Example: components report</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q components</code></strong></div>
<div class="content">
<pre>&gt; gradle -q components

------------------------------------------------------------
Root project
------------------------------------------------------------

DocumentationComponent 'docs'
-----------------------------

Source sets
    Markdown source 'docs:userguide'
        srcDir: src/docs/userguide
    Text source 'docs:reference'
        srcDir: src/docs/reference

Binaries
    DocumentationBinary 'docs:exploded'
        build using task: :docsExploded

Note: currently not all plugins register their components, so some components may not be visible here.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="software-model-extend-internal-views"><a class="anchor" href="#software-model-extend-internal-views"></a><a class="link" href="#software-model-extend-internal-views">About internal views</a></h4>
<div class="paragraph">
<p>Internal views can be added to an already registered type or to a new custom type. In other words, using internal views, you can attach extra properties to already registered components, binaries and source sets types like <code>JvmLibrarySpec</code>, <code>JarBinarySpec</code> or <code>JavaSourceSet</code> and to the custom types you write.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple component public type and its internal view declarations:</p>
</div>
<div class="sect4">
<h5 id="example_public_type_and_internal_view_declaration"><a class="anchor" href="#example_public_type_and_internal_view_declaration"></a><a class="link" href="#example_public_type_and_internal_view_declaration">Example: public type and internal view declaration</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Managed</span> <span class="type">interface</span> MyComponent <span class="directive">extends</span> ComponentSpec {
    <span class="predefined-type">String</span> getPublicData()
    <span class="type">void</span> setPublicData(<span class="predefined-type">String</span> data)
}
<span class="annotation">@Managed</span> <span class="type">interface</span> MyComponentInternal <span class="directive">extends</span> MyComponent {
    <span class="predefined-type">String</span> getInternalData()
    <span class="type">void</span> setInternalData(<span class="predefined-type">String</span> internal)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type registration is as follows:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_type_registration"><a class="anchor" href="#example_type_registration"></a><a class="link" href="#example_type_registration">Example: type registration</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@ComponentType</span>
    <span class="type">void</span> registerMyComponent(TypeBuilder&lt;MyComponent&gt; builder) {
        builder.internalView(MyComponentInternal)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>internalView(type)</code> method of the type builder can be called several times. This is how you would add several internal views to a type.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s mutate both public and internal data using some rule:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_public_and_internal_data_mutation"><a class="anchor" href="#example_public_and_internal_data_mutation"></a><a class="link" href="#example_public_and_internal_data_mutation">Example: public and internal data mutation</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">extends</span> RuleSource {
    <span class="annotation">@Mutate</span>
    <span class="type">void</span> mutateMyComponents(ModelMap&lt;MyComponentInternal&gt; components) {
        components.all { component -&gt;
            component.publicData = <span class="string"><span class="delimiter">&quot;</span><span class="content">Some PUBLIC data</span><span class="delimiter">&quot;</span></span>
            component.internalData = <span class="string"><span class="delimiter">&quot;</span><span class="content">Some INTERNAL data</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our <code>internalData</code> property should not be exposed to build logic. Let&#8217;s check this using the <code>model</code> task on the following build file:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_build_script_and_model_report_output"><a class="anchor" href="#example_build_script_and_model_report_output"></a><a class="link" href="#example_build_script_and_model_report_output">Example: Build script and model report output</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: MyPlugin
model {
    components {
        my(MyComponent)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q model</code></div>
<div class="content">
<pre>&gt; gradle -q model

------------------------------------------------------------
Root project
------------------------------------------------------------

+ components
      | Type:   	org.gradle.platform.base.ComponentSpecContainer
      | Creator: 	ComponentBasePlugin.PluginRules#components(ComponentSpecContainer)
      | Rules:
          components { ... } @ build.gradle line 53, column 5
          MyPlugin#mutateMyComponents(ModelMap&lt;MyComponentInternal&gt;)
    + my
          | Type:   	MyComponent
          | Creator: 	components { ... } @ build.gradle line 53, column 5 &gt; create(my)
          | Rules:
              MyPlugin#mutateMyComponents(ModelMap&lt;MyComponentInternal&gt;) &gt; all()
        + publicData
              | Type:   	java.lang.String
              | Value:  	Some PUBLIC data
              | Creator: 	components { ... } @ build.gradle line 53, column 5 &gt; create(my)
+ tasks
      | Type:   	org.gradle.model.ModelMap&lt;org.gradle.api.Task&gt;
      | Creator: 	Project.&lt;init&gt;.tasks()
    + assemble
          | Type:   	org.gradle.api.DefaultTask
          | Value:  	task ':assemble'
          | Creator: 	Project.&lt;init&gt;.tasks.assemble()
          | Rules:
              copyToTaskContainer
    + build
          | Type:   	org.gradle.api.DefaultTask
          | Value:  	task ':build'
          | Creator: 	Project.&lt;init&gt;.tasks.build()
          | Rules:
              copyToTaskContainer
    + buildEnvironment
          | Type:   	org.gradle.api.tasks.diagnostics.BuildEnvironmentReportTask
          | Value:  	task ':buildEnvironment'
          | Creator: 	Project.&lt;init&gt;.tasks.buildEnvironment()
          | Rules:
              copyToTaskContainer
    + check
          | Type:   	org.gradle.api.DefaultTask
          | Value:  	task ':check'
          | Creator: 	Project.&lt;init&gt;.tasks.check()
          | Rules:
              copyToTaskContainer
    + clean
          | Type:   	org.gradle.api.tasks.Delete
          | Value:  	task ':clean'
          | Creator: 	Project.&lt;init&gt;.tasks.clean()
          | Rules:
              copyToTaskContainer
    + components
          | Type:   	org.gradle.api.reporting.components.ComponentReport
          | Value:  	task ':components'
          | Creator: 	Project.&lt;init&gt;.tasks.components()
          | Rules:
              copyToTaskContainer
    + dependencies
          | Type:   	org.gradle.api.tasks.diagnostics.DependencyReportTask
          | Value:  	task ':dependencies'
          | Creator: 	Project.&lt;init&gt;.tasks.dependencies()
          | Rules:
              copyToTaskContainer
    + dependencyInsight
          | Type:   	org.gradle.api.tasks.diagnostics.DependencyInsightReportTask
          | Value:  	task ':dependencyInsight'
          | Creator: 	Project.&lt;init&gt;.tasks.dependencyInsight()
          | Rules:
              copyToTaskContainer
    + dependentComponents
          | Type:   	org.gradle.api.reporting.dependents.DependentComponentsReport
          | Value:  	task ':dependentComponents'
          | Creator: 	Project.&lt;init&gt;.tasks.dependentComponents()
          | Rules:
              copyToTaskContainer
    + help
          | Type:   	org.gradle.configuration.Help
          | Value:  	task ':help'
          | Creator: 	Project.&lt;init&gt;.tasks.help()
          | Rules:
              copyToTaskContainer
    + init
          | Type:   	org.gradle.buildinit.tasks.InitBuild
          | Value:  	task ':init'
          | Creator: 	Project.&lt;init&gt;.tasks.init()
          | Rules:
              copyToTaskContainer
    + model
          | Type:   	org.gradle.api.reporting.model.ModelReport
          | Value:  	task ':model'
          | Creator: 	Project.&lt;init&gt;.tasks.model()
          | Rules:
              copyToTaskContainer
    + outgoingVariants
          | Type:   	org.gradle.api.tasks.diagnostics.OutgoingVariantsReportTask
          | Value:  	task ':outgoingVariants'
          | Creator: 	Project.&lt;init&gt;.tasks.outgoingVariants()
          | Rules:
              copyToTaskContainer
    + prepareKotlinBuildScriptModel
          | Type:   	org.gradle.api.DefaultTask
          | Value:  	task ':prepareKotlinBuildScriptModel'
          | Creator: 	Project.&lt;init&gt;.tasks.prepareKotlinBuildScriptModel()
          | Rules:
              copyToTaskContainer
    + projects
          | Type:   	org.gradle.api.tasks.diagnostics.ProjectReportTask
          | Value:  	task ':projects'
          | Creator: 	Project.&lt;init&gt;.tasks.projects()
          | Rules:
              copyToTaskContainer
    + properties
          | Type:   	org.gradle.api.tasks.diagnostics.PropertyReportTask
          | Value:  	task ':properties'
          | Creator: 	Project.&lt;init&gt;.tasks.properties()
          | Rules:
              copyToTaskContainer
    + tasks
          | Type:   	org.gradle.api.tasks.diagnostics.TaskReportTask
          | Value:  	task ':tasks'
          | Creator: 	Project.&lt;init&gt;.tasks.tasks()
          | Rules:
              copyToTaskContainer
    + wrapper
          | Type:   	org.gradle.api.tasks.wrapper.Wrapper
          | Value:  	task ':wrapper'
          | Creator: 	Project.&lt;init&gt;.tasks.wrapper()
          | Rules:
              copyToTaskContainer</pre>
</div>
</div>
<div class="paragraph">
<p>We can see in this report that <code>publicData</code> is present and that <code>internalData</code> is not.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:extending_gradle"><a class="anchor" href="#part:extending_gradle"></a><a class="link" href="#part:extending_gradle">Extending Gradle</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="custom_tasks"><a class="anchor" href="#custom_tasks"></a><a class="link" href="#custom_tasks">Developing Custom Gradle Task Types</a></h3>
<div class="paragraph">
<p>Gradle supports two types of task. One such type is the simple task, where you define the task with an action closure. We have seen these in <a href="#tutorial_using_tasks">Build Script Basics</a>. For this type of task, the action closure determines the behaviour of the task. This type of task is good for implementing one-off tasks in your build script.</p>
</div>
<div class="paragraph">
<p>The other type of task is the enhanced task, where the behaviour is built into the task, and the task provides some properties which you can use to configure the behaviour. We have seen these in <a href="#more_about_tasks">Authoring Tasks</a>. Most Gradle plugins use enhanced tasks. With enhanced tasks, you don&#8217;t need to implement the task behaviour as you do with simple tasks. You simply declare the task and configure the task using its properties. In this way, enhanced tasks let you reuse a piece of behaviour in many different places, possibly across different builds.</p>
</div>
<div class="paragraph">
<p>The behaviour and properties of an enhanced task are defined by the task&#8217;s class. When you declare an enhanced task, you specify the type, or class of the task.</p>
</div>
<div class="paragraph">
<p>Implementing your own custom task class in Gradle is easy. You can implement a custom task class in pretty much any language you like, provided it ends up compiled to JVM bytecode. In our examples, we are going to use Groovy as the implementation language. Groovy, Java or Kotlin are all good choices as the language to use to implement a task class, as the Gradle API has been designed to work well with these languages. In general, a task implemented using Java or Kotlin, which are statically typed, will perform better than the same task implemented using Groovy.</p>
</div>
<div class="sect3">
<h4 id="sec:packaging_a_task_class"><a class="anchor" href="#sec:packaging_a_task_class"></a><a class="link" href="#sec:packaging_a_task_class">Packaging a task class</a></h4>
<div class="paragraph">
<p>There are several places where you can put the source for the task class.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Build script</dt>
<dd>
<p>You can include the task class directly in the build script. This has the benefit that the task class is automatically compiled and included in the classpath of the build script without you having to do anything. However, the task class is not visible outside the build script, and so you cannot reuse the task class outside the build script it is defined in.</p>
</dd>
<dt class="hdlist1"><code>buildSrc</code> project</dt>
<dd>
<p>You can put the source for the task class in the <code><em>rootProjectDir</em>/buildSrc/src/main/groovy</code> directory (or <code><em>rootProjectDir</em>/buildSrc/src/main/java</code> or <code><em>rootProjectDir</em>/buildSrc/src/main/kotlin</code> depending on which language you prefer). Gradle will take care of compiling and testing the task class and making it available on the classpath of the build script. The task class is visible to every build script used by the build. However, it is not visible outside the build, and so you cannot reuse the task class outside the build it is defined in. Using the <code>buildSrc</code> project approach separates the task declaration  that is, what the task should do  from the task implementation  that is, how the task does it.</p>
<div class="paragraph">
<p>See <a href="#organizing_gradle_projects">Organizing Gradle Projects</a> for more details about the <code>buildSrc</code> project.</p>
</div>
</dd>
<dt class="hdlist1">Standalone project</dt>
<dd>
<p>You can create a separate project for your task class. This project produces and publishes a JAR which you can then use in multiple builds and share with others. Generally, this JAR might include some custom plugins, or bundle several related task classes into a single library. Or some combination of the two.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In our examples, we will start with the task class in the build script, to keep things simple. Then we will look at creating a standalone project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:writing_a_simple_task_class"><a class="anchor" href="#sec:writing_a_simple_task_class"></a><a class="link" href="#sec:writing_a_simple_task_class">Writing a simple task class</a></h4>
<div class="paragraph">
<p>To implement a custom task class, you extend <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.DefaultTask.html">DefaultTask</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 477. Defining a custom task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingTask : DefaultTask() {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This task doesn&#8217;t do anything useful, so let&#8217;s add some behaviour. To do so, we add a method to the task and mark it with the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskAction.html">TaskAction</a> annotation. Gradle will call the method when the task executes. You don&#8217;t have to use a method to define the behaviour for the task. You could, for instance, call <code>doFirst()</code> or <code>doLast()</code> with a closure in the task constructor to add behaviour.</p>
</div>
<div class="exampleblock">
<div class="title">Example 478. A hello world task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">greet</span>() {
        println <span class="string"><span class="delimiter">'</span><span class="content">hello from GreetingTask</span><span class="delimiter">'</span></span>
    }
}

<span class="comment">// Create a task using the task type</span>
task hello(<span class="key">type</span>: GreetingTask)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingTask : DefaultTask() {
    @TaskAction
    fun greet() {
        println(&quot;hello from GreetingTask&quot;)
    }
}

// Create a task using the task type
tasks.register&lt;GreetingTask&gt;(&quot;hello&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
hello from GreetingTask</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add a property to the task, so we can customize it. Tasks are simply POGOs, and when you declare a task, you can set the properties or call methods on the task object. Here we add a <code>greeting</code> property, and set the value when we declare the <code>greeting</code> task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 479. A customizable hello world task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Input</span>
    <span class="predefined-type">String</span> greeting = <span class="string"><span class="delimiter">'</span><span class="content">hello from GreetingTask</span><span class="delimiter">'</span></span>

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">greet</span>() {
        println greeting
    }
}

<span class="comment">// Use the default greeting</span>
task hello(<span class="key">type</span>: GreetingTask)

<span class="comment">// Customize the greeting</span>
task greeting(<span class="key">type</span>: GreetingTask) {
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">greetings from GreetingTask</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingTask : DefaultTask() {
    @get:Input
    var greeting = &quot;hello from GreetingTask&quot;

    @TaskAction
    fun greet() {
        println(greeting)
    }
}

// Use the default greeting
tasks.register&lt;GreetingTask&gt;(&quot;hello&quot;)

// Customize the greeting
tasks.register&lt;GreetingTask&gt;(&quot;greeting&quot;) {
    greeting = &quot;greetings from GreetingTask&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello greeting</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello greeting
hello from GreetingTask
greetings from GreetingTask</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_tasks_standalone_project"><a class="anchor" href="#sec:custom_tasks_standalone_project"></a><a class="link" href="#sec:custom_tasks_standalone_project">A standalone project</a></h4>
<div class="paragraph">
<p>Now we will move our task to a standalone project, so we can publish it and share it with others. This project is simply a Groovy project that produces a JAR containing the task class. Here is a simple build script for the project. It applies the Groovy plugin, and adds the Gradle API as a compile-time dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 480. A build for a custom task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
}

dependencies {
    implementation gradleApi()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
}

dependencies {
    implementation(gradleApi())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We just follow the convention for where the source for the task class should go.</p>
</div>
<div class="sect4">
<h5 id="example_a_custom_task"><a class="anchor" href="#example_a_custom_task"></a><a class="link" href="#example_a_custom_task">Example: A custom task</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/main/groovy/org/gradle/GreetingTask.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.gradle

<span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>

<span class="type">class</span> <span class="class">GreetingTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="annotation">@Input</span>
    <span class="predefined-type">String</span> greeting = <span class="string"><span class="delimiter">'</span><span class="content">hello from GreetingTask</span><span class="delimiter">'</span></span>

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">greet</span>() {
        println greeting
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_your_task_class_in_another_project"><a class="anchor" href="#sec:using_your_task_class_in_another_project"></a><a class="link" href="#sec:using_your_task_class_in_another_project">Using your task class in another project</a></h5>
<div class="paragraph">
<p>To use a task class in a build script, you need to add the class to the build script&#8217;s classpath. To do this, you use a <code>buildscript { }</code> block, as described in <a href="#sec:build_script_external_dependencies">External dependencies for the build script</a>. The following example shows how you might do this when the JAR containing the task class has been published to a local repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 481. Using a custom task in another project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        maven {
            url = uri(repoLocation)
        }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">'</span><span class="content">org.gradle:customTask:1.0-SNAPSHOT</span><span class="delimiter">'</span></span>
    }
}

task greeting(<span class="key">type</span>: org.gradle.GreetingTask) {
    greeting = <span class="string"><span class="delimiter">'</span><span class="content">howdy!</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        maven {
            url = uri(repoLocation)
        }
    }
    dependencies {
        classpath(&quot;org.gradle:customPlugin:1.0-SNAPSHOT&quot;)
    }
}

tasks.register&lt;org.gradle.GreetingTask&gt;(&quot;greeting&quot;) {
    greeting = &quot;howdy!&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:writing_tests_for_your_task_class"><a class="anchor" href="#sec:writing_tests_for_your_task_class"></a><a class="link" href="#sec:writing_tests_for_your_task_class">Writing tests for your task class</a></h5>
<div class="paragraph">
<p>You can use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testfixtures/ProjectBuilder.html">ProjectBuilder</a> class to create <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> instances to use when you test your task class.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_testing_a_custom_task"><a class="anchor" href="#example_testing_a_custom_task"></a><a class="link" href="#example_testing_a_custom_task">Example: Testing a custom task</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/test/groovy/org/gradle/GreetingTaskTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingTaskTest</span> {
    <span class="annotation">@Test</span>
    <span class="type">void</span> canAddTaskToProject() {
        Project project = ProjectBuilder.builder().build()
        <span class="keyword">def</span> task = project.task(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, <span class="key">type</span>: GreetingTask)
        assertTrue(task <span class="keyword">instanceof</span> GreetingTask)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="incremental_tasks"><a class="anchor" href="#incremental_tasks"></a><a class="link" href="#incremental_tasks">Incremental tasks</a></h4>
<div class="paragraph">
<p>With Gradle, it&#8217;s very simple to implement a task that is skipped when all of its inputs and outputs are up to date (see <a href="#sec:up_to_date_checks">Incremental Builds</a>).
However, there are times when only a few input files have changed since the last execution, and you&#8217;d like to avoid reprocessing all of the unchanged inputs.
This can be particularly useful for a transformer task that converts input files to output files on a 1:1 basis.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like to optimize your build so that only out-of-date input files are processed, you can do so with an <em>incremental task</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/incremental/IncrementalTaskInputs.html">IncrementalTaskInputs</a> API, which is available in Gradle versions before 5.4.
When using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/incremental/IncrementalTaskInputs.html">IncrementalTaskInputs</a>, it is only possible to query for all file changes of the task inputs.
It is not possible to query for changes of individual input file properties.
Moreover, the old API does not distinguish between incremental and non-incremental task inputs, so the task itself needs to determine where the changes originated from.
Therefore, the usage of this API is deprecated, and it will be removed eventually.
The new <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a> API, which is documented here, replaces the old API and addresses its shortcomings.
If you need to use the old API, have a look at the documentation in the <a href="https://docs.gradle.org/5.3.1/userguide/custom_tasks.html#incremental_tasks">user manual for Gradle 5.3.1</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sec:implementing_an_incremental_task"><a class="anchor" href="#sec:implementing_an_incremental_task"></a><a class="link" href="#sec:implementing_an_incremental_task">Implementing an incremental task</a></h5>
<div class="paragraph">
<p>For a task to process inputs incrementally, that task must contain an <em>incremental task action</em>.
This is a task action method that has a single <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html">InputChanges</a> parameter.
That parameter tells Gradle that the action only wants to process the changed inputs.
In addition, the task needs to declare at least one incremental file input property by using either <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/Incremental.html">@Incremental</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/SkipWhenEmpty.html">@SkipWhenEmpty</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To query incremental changes for an input file property, that property always needs to return the same instance.
The easiest way to accomplish this is to use one of the following types for such properties: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/RegularFileProperty.html">RegularFileProperty</a>, <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/DirectoryProperty.html">DirectoryProperty</a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html">ConfigurableFileCollection</a>.</p>
</div>
<div class="paragraph">
<p>You can learn more about <code>RegularFileProperty</code> and <code>DirectoryProperty</code> in the <a href="#lazy_configuration">Lazy Configuration</a> chapter, especially the sections on <a href="#lazy_properties">using read-only and configurable properties</a> and <a href="#working_with_files_in_lazy_properties">lazy file properties</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The incremental task action can use <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a> to find out what files have changed for a given file-based input property, be it of type <code>RegularFileProperty</code>, <code>DirectoryProperty</code> or <code>ConfigurableFileCollection</code>.
The method returns an <code>Iterable</code> of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/FileChange.html">FileChanges</a>, which in turn can be queried for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/FileChange.html#getFile--">affected file</a></p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/FileChange.html#getChangeType--">change type</a> (<code>ADDED</code>, <code>REMOVED</code> or <code>MODIFIED</code>)</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/FileChange.html#getNormalizedPath--">normalized path</a> of the changed file</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/work/FileChange.html#getFileType--">file type</a> of the changed file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates an incremental task that has a directory input.
It assumes that the directory contains a collection of text files and copies them to an output directory, reversing the text within each file.
The key things to note are the type of the <code>inputDir</code> property, its annotations, and how the action (<code>execute()</code>) uses <code>getFileChanges()</code> to process the subset of files that have actually changed since the last build.
You can also see how the action deletes a target file if the corresponding input file has been removed:</p>
</div>
<div id="taskDefinition" class="exampleblock">
<div class="title">Example 482. Defining an incremental task action</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">IncrementalReverseTask</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@Incremental</span>
    <span class="annotation">@PathSensitive</span>(PathSensitivity.NAME_ONLY)
    <span class="annotation">@InputDirectory</span>
    <span class="directive">abstract</span> DirectoryProperty getInputDir()

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">abstract</span> DirectoryProperty getOutputDir()

    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">String</span>&gt; getInputProperty()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> execute(InputChanges inputChanges) {
        println(inputChanges.incremental
            ? <span class="string"><span class="delimiter">'</span><span class="content">Executing incrementally</span><span class="delimiter">'</span></span>
            : <span class="string"><span class="delimiter">'</span><span class="content">Executing non-incrementally</span><span class="delimiter">'</span></span>
        )

        inputChanges.getFileChanges(inputDir).each { change -&gt;
            <span class="keyword">if</span> (change.fileType == FileType.DIRECTORY) <span class="keyword">return</span>

            println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>change.changeType<span class="inline-delimiter">}</span></span><span class="content">: </span><span class="inline"><span class="inline-delimiter">${</span>change.normalizedPath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> targetFile = outputDir.file(change.normalizedPath).get().asFile
            <span class="keyword">if</span> (change.changeType == ChangeType.REMOVED) {
                targetFile.delete()
            } <span class="keyword">else</span> {
                targetFile.text = change.file.text.reverse()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class IncrementalReverseTask : DefaultTask() {
    @get:Incremental
    @get:PathSensitive(PathSensitivity.NAME_ONLY)
    @get:InputDirectory
    abstract val inputDir: DirectoryProperty

    @get:OutputDirectory
    abstract val outputDir: DirectoryProperty

    @get:Input
    abstract val inputProperty: Property&lt;String&gt;

    @TaskAction
    fun execute(inputChanges: InputChanges) {
        println(
            if (inputChanges.isIncremental) &quot;Executing incrementally&quot;
            else &quot;Executing non-incrementally&quot;
        )

        inputChanges.getFileChanges(inputDir).forEach { change -&gt;
            if (change.fileType == FileType.DIRECTORY) return@forEach

            println(&quot;${change.changeType}: ${change.normalizedPath}&quot;)
            val targetFile = outputDir.file(change.normalizedPath).get().asFile
            if (change.changeType == ChangeType.REMOVED) {
                targetFile.delete()
            } else {
                targetFile.writeText(change.file.readText().reversed())
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If for some reason the task is executed non-incrementally, for example by running with <code>--rerun-tasks</code>, all files are reported as <code>ADDED</code>, irrespective of the previous state.
In this case, Gradle automatically removes the previous outputs, so the incremental task only needs to process the given files.</p>
</div>
<div class="paragraph">
<p>For a simple transformer task like the above example, the task action simply needs to generate output files for any out-of-date inputs and delete output files for any removed inputs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>A task may only contain a single incremental task action.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sec:which_inputs_are_considered_out_of_date"><a class="anchor" href="#sec:which_inputs_are_considered_out_of_date"></a><a class="link" href="#sec:which_inputs_are_considered_out_of_date">Which inputs are considered out of date?</a></h5>
<div class="paragraph">
<p>When there is a previous execution of the task, and the only changes since that execution are to incremental input file properties, then Gradle is able to determine which input files need to be processed (incremental execution).
In this case, the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a> method returns details for all input files for the given property that were <em>added</em>, <em>modified</em> or <em>removed</em>.</p>
</div>
<div class="paragraph">
<p>However, there are many cases where Gradle is unable to determine which input files need to be processed (non-incremental execution).
Examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no history available from a previous execution.</p>
</li>
<li>
<p>You are building with a different version of Gradle. Currently, Gradle does not use task history from a different version.</p>
</li>
<li>
<p>An <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskOutputs.html#upToDateWhen-groovy.lang.Closure-"><code>upToDateWhen</code></a> criterion added to the task returns <code>false</code>.</p>
</li>
<li>
<p>An input property has changed since the previous execution.</p>
</li>
<li>
<p>A non-incremental input file property has changed since the previous execution.</p>
</li>
<li>
<p>One or more output files have changed since the previous execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all of these cases, Gradle will report all input files as <code>ADDED</code> and the <code>getFileChanges()</code> method will return details for all the files that comprise the given input property.</p>
</div>
<div class="paragraph">
<p>You can check if the task execution is incremental or not with the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges.html##org.gradle.work.InputChanges:incremental">InputChanges.isIncremental()</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:an_incremental_task_in_action"><a class="anchor" href="#sec:an_incremental_task_in_action"></a><a class="link" href="#sec:an_incremental_task_in_action">An incremental task in action</a></h5>
<div class="paragraph">
<p>Given the example incremental task implementation <a href="#taskDefinition">above</a>, let&#8217;s walk through some scenarios based on it.</p>
</div>
<div class="paragraph">
<p>First, consider an instance of <code>IncrementalReverseTask</code> that is executed against a set of inputs for the first time.
In this case, all inputs will be considered added, as shown here:</p>
</div>
<div id="ex:incremental_task_definition" class="exampleblock">
<div class="title">Example 483. Running the incremental task for the first time</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task incrementalReverse(<span class="key">type</span>: IncrementalReverseTask) {
    inputDir = file(<span class="string"><span class="delimiter">'</span><span class="content">inputs</span><span class="delimiter">'</span></span>)
    outputDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/outputs</span><span class="delimiter">&quot;</span></span>)
    inputProperty = project.properties[<span class="string"><span class="delimiter">'</span><span class="content">taskInputProperty</span><span class="delimiter">'</span></span>] ?: <span class="string"><span class="delimiter">'</span><span class="content">original</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;IncrementalReverseTask&gt;(&quot;incrementalReverse&quot;) {
    inputDir.set(file(&quot;inputs&quot;))
    outputDir.set(file(&quot;$buildDir/outputs&quot;))
    inputProperty.set(project.properties[&quot;taskInputProperty&quot;] as String? ?: &quot;original&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Build layout</div>
<div class="content">
<pre>.
 build.gradle
 inputs
     1.txt
     2.txt
     3.txt</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle -q incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Naturally when the task is executed again with no changes, then the entire task is up to date and the task action is not executed:</p>
</div>
<div class="exampleblock">
<div class="title">Example 484. Running the incremental task with unchanged inputs</div>
<div class="content">
<div class="listingblock">
<div class="title">Output of <code>gradle incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle incrementalReverse
&gt; Task :incrementalReverse UP-TO-DATE

BUILD SUCCESSFUL in 0s
1 actionable task: 1 up-to-date</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When an input file is modified in some way or a new input file is added, then re-executing the task results in those files being returned by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a>.
The following example modifies the content of one file and adds another before running the incremental task:</p>
</div>
<div class="exampleblock">
<div class="title">Example 485. Running the incremental task with updated input files</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task updateInputs() {
    doLast {
        file(<span class="string"><span class="delimiter">'</span><span class="content">inputs/1.txt</span><span class="delimiter">'</span></span>).text = <span class="string"><span class="delimiter">'</span><span class="content">Changed content for existing file 1.</span><span class="delimiter">'</span></span>
        file(<span class="string"><span class="delimiter">'</span><span class="content">inputs/4.txt</span><span class="delimiter">'</span></span>).text = <span class="string"><span class="delimiter">'</span><span class="content">Content for new file 4.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;updateInputs&quot;) {
    doLast {
        file(&quot;inputs/1.txt&quot;).writeText(&quot;Changed content for existing file 1.&quot;)
        file(&quot;inputs/4.txt&quot;).writeText(&quot;Content for new file 4.&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q updateInputs incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle -q updateInputs incrementalReverse
Executing incrementally
MODIFIED: 1.txt
ADDED: 4.txt</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The various mutation tasks (<code>updateInputs</code>, <code>removeInput</code>, etc) are only present to demonstrate the behavior of incremental tasks.
They should not be viewed as the kinds of tasks or task implementations you should have in your own build scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an existing input file is removed, then re-executing the task results in that file being returned by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a> as <code>REMOVED</code>.
The following example removes one of the existing files before executing the incremental task:</p>
</div>
<div class="exampleblock">
<div class="title">Example 486. Running the incremental task with an input file removed</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task removeInput() {
    doLast {
        file(<span class="string"><span class="delimiter">'</span><span class="content">inputs/3.txt</span><span class="delimiter">'</span></span>).delete()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;removeInput&quot;) {
    doLast {
        file(&quot;inputs/3.txt&quot;).delete()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q removeInput incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle -q removeInput incrementalReverse
Executing incrementally
REMOVED: 3.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When an <em>output</em> file is deleted (or modified), then Gradle is unable to determine which input files are out of date.
In this case, details for <em>all</em> the input files for the given property are returned by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a>.
The following example removes just one of the output files from the build directory, but notice how all the input files are considered to be <code>ADDED</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 487. Running the incremental task with an output file removed</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task removeOutput() {
    doLast {
        file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/outputs/1.txt</span><span class="delimiter">&quot;</span></span>).delete()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;removeOutput&quot;) {
    doLast {
        file(&quot;$buildDir/outputs/1.txt&quot;).delete()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>gradle -q removeOutput incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle -q removeOutput incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The last scenario we want to cover concerns what happens when a non-file-based input property is modified.
In such cases, Gradle is unable to determine how the property impacts the task outputs, so the task is executed non-incrementally.
This means that <em>all</em> input files for the given property are returned by <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.work.InputChanges.html#org.gradle.work.InputChanges:getFileChanges(org.gradle.api.file.FileCollection)">InputChanges.getFileChanges()</a> and they are all treated as <code>ADDED</code>.
The following example sets the project property <code>taskInputProperty</code> to a new value when running the <code>incrementalReverse</code> task and that project property is used to initialize the task&#8217;s <code>inputProperty</code> property, as you can see in the <a href="#ex:incremental_task_definition">first example of this section</a>.
Here&#8217;s the output you can expect in this case:</p>
</div>
<div class="exampleblock">
<div class="title">Example 488. Running the incremental task with an input property changed</div>
<div class="content">
<div class="listingblock">
<div class="title">Output of <code>gradle -q -PtaskInputProperty=changed incrementalReverse</code></div>
<div class="content">
<pre>&gt; gradle -q -PtaskInputProperty=changed incrementalReverse
Executing non-incrementally
ADDED: 1.txt
ADDED: 2.txt
ADDED: 3.txt</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:storing_incremental_task_state"><a class="anchor" href="#sec:storing_incremental_task_state"></a><a class="link" href="#sec:storing_incremental_task_state">Storing incremental state for cached tasks</a></h5>
<div class="paragraph">
<p>Using Gradle&#8217;s <code>InputChanges</code> is not the only way to create tasks that only work on changes since the last execution.
Tools like the Kotlin compiler provide incrementality as a built-in feature.
The way this is typically implemented is that the tool stores some analysis data about the state of the previous execution in some file.
If such state files are <a href="#sec:task_output_caching_inputs">relocatable</a>, then they can be declared as outputs of the task.
This way when the task&#8217;s results are loaded from cache, the next execution can already use the analysis data loaded from cache, too.</p>
</div>
<div class="paragraph">
<p>However, if the state files are non-relocatable, then they can&#8217;t be shared via the build cache.
Indeed, when the task is loaded from cache, any such state files must be cleaned up to prevent stale state from confusing the tool during the next execution.
Gradle can ensure such stale files are removed if they are declared via <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/TaskLocalState.html#register-java.lang.Object...-">task.localState.register()</a> or if a property is marked with the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/LocalState.html">@LocalState</a> annotation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:declaring_and_using_command_line_options"><a class="anchor" href="#sec:declaring_and_using_command_line_options"></a><a class="link" href="#sec:declaring_and_using_command_line_options">Declaring and Using Command Line Options</a></h4>
<div class="paragraph">
<p>Sometimes a user wants to declare the value of an exposed task property on the command line instead of the build script. Being able to pass in property values on the command line is particularly helpful if they change more frequently. The task API supports a mechanism for marking a property to automatically generate a corresponding command line parameter with a specific name at runtime.</p>
</div>
<div class="sect4">
<h5 id="sec:declaring_task_option"><a class="anchor" href="#sec:declaring_task_option"></a><a class="link" href="#sec:declaring_task_option">Declaring a command-line option</a></h5>
<div class="paragraph">
<p>Exposing a new command line option for a task property is straightforward. You just have to annotate the corresponding setter method of a property with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/Option.html">Option</a>. An option requires a mandatory identifier. Additionally, you can provide an optional description. A task can expose as many command line options as properties available in the class.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at an example to illustrate the functionality. The custom task <code>UrlVerify</code> verifies whether a given URL can be resolved by making a HTTP call and checking the response code. The URL to be verified is configurable through the property <code>url</code>. The setter method for the property is annotated with <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/Option.html">@Option</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_declaring_a_command_line_option"><a class="anchor" href="#example_declaring_a_command_line_option"></a><a class="link" href="#example_declaring_a_command_line_option">Example: Declaring a command line option</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">UrlVerify.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.Option</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">UrlVerify</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="predefined-type">String</span> url;

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the URL to be verified.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setUrl(<span class="predefined-type">String</span> url) {
        <span class="local-variable">this</span>.url = url;
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getUrl() {
        <span class="keyword">return</span> url;
    }

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> verify() {
        getLogger().quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Verifying URL '{}'</span><span class="delimiter">&quot;</span></span>, url);

        <span class="comment">// verify URL by making a HTTP call</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All options declared for a task can be <a href="#sec:listing_task_options">rendered as console output</a> by running the <code>help</code> task and the <code>--task</code> option.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_task_option_command_line"><a class="anchor" href="#sec:using_task_option_command_line"></a><a class="link" href="#sec:using_task_option_command_line">Using an option on the command line</a></h5>
<div class="paragraph">
<p>Using an option on the command line has to adhere to the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The option uses a double-dash as prefix e.g. <code>--url</code>. A single dash does not qualify as valid syntax for a task option.</p>
</li>
<li>
<p>The option argument follows directly after the task declaration e.g. <code>verifyUrl --url=http://www.google.com/</code>.</p>
</li>
<li>
<p>Multiple options of a task can be declared in any order on the command line following the task name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Getting back to the previous example, the build script creates a task instance of type <code>UrlVerify</code> and provides a value from the command line through the exposed option.</p>
</div>
<div class="exampleblock">
<div class="title">Example 489. Using a command line option</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task verifyUrl(<span class="key">type</span>: UrlVerify)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;UrlVerify&gt;(&quot;verifyUrl&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q verifyUrl --url=http://www.google.com/</code></strong></div>
<div class="content">
<pre>&gt; gradle -q verifyUrl --url=http://www.google.com/
Verifying URL 'http://www.google.com/'</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:supported_task_option_data_types"><a class="anchor" href="#sec:supported_task_option_data_types"></a><a class="link" href="#sec:supported_task_option_data_types">Supported data types for options</a></h5>
<div class="paragraph">
<p>Gradle limits the set of data types that can be used for declaring command line options. The use on the command line differ per type.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>boolean</code>, <code>Boolean</code>, <code>Property&lt;Boolean&gt;</code></dt>
<dd>
<p>Describes an option with the value <code>true</code> or <code>false</code>. Passing the option on the command line treats the value as <code>true</code>. For example <code>--enabled</code> equates to <code>true</code>. The absence of the option uses the default value of the property.</p>
</dd>
<dt class="hdlist1"><code>String</code>, <code>Property&lt;String&gt;</code></dt>
<dd>
<p>Describes an option with an arbitrary String value. Passing the option on the command line also requires a value e.g. <code>--container-id=2x94held</code> or <code>--container-id 2x94held</code>.</p>
</dd>
<dt class="hdlist1"><code>enum</code>, <code>Property&lt;enum&gt;</code></dt>
<dd>
<p>Describes an option as an enumerated type. Passing the option on the command line also requires a value e.g. <code>--log-level=DEBUG</code> or <code>--log-level debug</code>. The value is not case sensitive.</p>
</dd>
<dt class="hdlist1"><code>List&lt;String&gt;</code>, <code>List&lt;enum&gt;</code></dt>
<dd>
<p>Describes an option that can takes multiple values of a given type. The values for the option have to be provided as multiple declarations e.g. <code>--image-id=123 --image-id=456</code>. Other notations such as comma-separated lists or multiple values separated by a space character are currently not supported.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:documenting_available_task_option_values"><a class="anchor" href="#sec:documenting_available_task_option_values"></a><a class="link" href="#sec:documenting_available_task_option_values">Documenting available values for an option</a></h5>
<div class="paragraph">
<p>In theory, an option for a property type <code>String</code> or <code>List&lt;String&gt;</code> can accept any arbitrary value. Expected values for such an option can be documented programmatically with the help of the annotation <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/OptionValues.html">OptionValues</a>. This annotation may be assigned to any method that returns a <code>List</code> of one of the supported data types. In addition, you have to provide the option identifier to indicate the relationship between option and available values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Passing a value on the command line that is not supported by the option does not fail the build or throw an exception. You&#8217;ll have to implement custom logic for such behavior in the task action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example demonstrates the use of multiple options for a single task. The task implementation provides a list of available values for the option <code>output-type</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_declaring_available_values_for_an_option"><a class="anchor" href="#example_declaring_available_values_for_an_option"></a><a class="link" href="#example_declaring_available_values_for_an_option">Example: Declaring available values for an option</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">UrlProcess.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.Option</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.options.OptionValues</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">UrlProcess</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="predefined-type">String</span> url;
    <span class="directive">private</span> OutputType outputType;

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the URL to be write to the output.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setUrl(<span class="predefined-type">String</span> url) {
        <span class="local-variable">this</span>.url = url;
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getUrl() {
        <span class="keyword">return</span> url;
    }

    <span class="annotation">@Option</span>(option = <span class="string"><span class="delimiter">&quot;</span><span class="content">output-type</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Configures the output type.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setOutputType(OutputType outputType) {
        <span class="local-variable">this</span>.outputType = outputType;
    }

    <span class="annotation">@OptionValues</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">output-type</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;OutputType&gt; getAvailableOutputTypes() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;OutputType&gt;(<span class="predefined-type">Arrays</span>.asList(OutputType.values()));
    }

    <span class="annotation">@Input</span>
    <span class="directive">public</span> OutputType getOutputType() {
        <span class="keyword">return</span> outputType;
    }

    <span class="annotation">@TaskAction</span>
    <span class="directive">public</span> <span class="type">void</span> process() {
        getLogger().quiet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Writing out the URL response from '{}' to '{}'</span><span class="delimiter">&quot;</span></span>, url, outputType);

        <span class="comment">// retrieve content from URL and write to output</span>
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">enum</span> OutputType {
        CONSOLE, FILE
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_task_options"><a class="anchor" href="#sec:listing_task_options"></a><a class="link" href="#sec:listing_task_options">Listing command line options</a></h5>
<div class="paragraph">
<p>Command line options using the annotations <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/Option.html">Option</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/options/OptionValues.html">OptionValues</a> are self-documenting. You will see <a href="#sec:declaring_task_option">declared options</a> and their <a href="#sec:documenting_available_task_option_values">available values</a> reflected in the console output of the <code>help</code> task. The output renders options in alphabetical order.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_listing_available_values_for_option"><a class="anchor" href="#example_listing_available_values_for_option"></a><a class="link" href="#example_listing_available_values_for_option">Example: Listing available values for option</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q help --task processUrl</code></strong></div>
<div class="content">
<pre>&gt; gradle -q help --task processUrl
Detailed task information for processUrl

Path
     :processUrl

Type
     UrlProcess (UrlProcess)

Options
     --output-type     Configures the output type.
                       Available values are:
                            CONSOLE
                            FILE

     --url     Configures the URL to be write to the output.

Description
     -

Group
     -</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="limitations"><a class="anchor" href="#limitations"></a><a class="link" href="#limitations">Limitations</a></h5>
<div class="paragraph">
<p>Support for declaring command line options currently comes with a few limitations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command line options can only be declared for custom tasks via annotation. There&#8217;s no programmatic equivalent for defining options.</p>
</li>
<li>
<p>Options cannot be declared globally e.g. on a project-level or as part of a plugin.</p>
</li>
<li>
<p>When assigning an option on the command line then the task exposing the option needs to be spelled out explicitly e.g. <code>gradle check --tests abc</code> does not work even though the <code>check</code> task depends on the <code>test</code> task.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="worker_api"><a class="anchor" href="#worker_api"></a><a class="link" href="#worker_api">The Worker API</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Worker API is an <a href="feature_lifecycle.html#feature_lifecycle">incubating</a> feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As can be seen from the discussion of <a href="#incremental_tasks">incremental tasks</a>, the work that a task performs can be viewed as discrete units (i.e. a subset of inputs that are transformed to a certain subset of outputs). Many times, these units of work are highly independent of each other, meaning they can be performed in any order and simply aggregated together to form the overall action of the task. In a single threaded execution, these units of work would execute in sequence, however if we have multiple processors, it would be desirable to perform independent units of work concurrently. By doing so, we can fully utilize the available resources at build time and complete the activity of the task faster.</p>
</div>
<div class="paragraph">
<p>The Worker API provides a mechanism for doing exactly this. It allows for safe, concurrent execution of multiple items of work during a task action. But the benefits of the Worker API are not confined to parallelizing the work of a task. You can also configure a desired level of isolation such that work can be executed in an isolated classloader or even in an isolated process. Furthermore, the benefits extend beyond even the execution of a single task. Using the Worker API, Gradle can begin to execute tasks in parallel by default. In other words, once a task has submitted its work to be executed asynchronously, and has exited the task action, Gradle can then begin the execution of other independent tasks in parallel, even if those tasks are in the same project.</p>
</div>
<div class="sect4">
<h5 id="using-the-worker-api"><a class="anchor" href="#using-the-worker-api"></a><a class="link" href="#using-the-worker-api">Using the Worker API</a></h5>
<div class="paragraph">
<p>In order to submit work to the Worker API, two things must be provided: an implementation of the unit of work, and the parameters for the unit of work.</p>
</div>
<div class="paragraph">
<p>The parameters for the unit of work are defined as an interface or abstract class that implements <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkParameters.html">WorkParameters</a>.
The parameters type must be a <a href="#managed_types">managed type</a>.</p>
</div>
<div class="paragraph">
<p>You can find out more about implementing work parameters in <a href="#custom_gradle_types">Developing Custom Gradle Types</a>.</p>
</div>
<div class="paragraph">
<p>The implementation is a class that extends <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkAction.html">WorkAction</a>. This class should be abstract and should not implement the <code>getParameters()</code> method. Gradle will inject an implementation of this method at runtime with the parameters object for each unit of work.</p>
</div>
<div class="exampleblock">
<div class="title">Example 490. Defining the unit of work parameters and implementation</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// The parameters for a single unit of work</span>
<span class="type">interface</span> ReverseParameters <span class="directive">extends</span> WorkParameters {
    RegularFileProperty getFileToReverse()
    DirectoryProperty getDestinationDir()
}

<span class="comment">// The implementation of a single unit of work.</span>
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">ReverseFile</span> <span class="directive">implements</span> WorkAction&lt;ReverseParameters&gt; {
    <span class="directive">private</span> <span class="directive">final</span> FileSystemOperations fileSystemOperations

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> ReverseFile(FileSystemOperations fileSystemOperations) {
        <span class="local-variable">this</span>.fileSystemOperations = fileSystemOperations
    }

    <span class="annotation">@Override</span>
    <span class="type">void</span> execute() {
        fileSystemOperations.copy {
            from parameters.fileToReverse
            into parameters.destinationDir
            filter { <span class="predefined-type">String</span> line -&gt; line.reverse() }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import javax.inject.Inject

// The parameters for a single unit of work
interface ReverseParameters : WorkParameters {
    val fileToReverse : RegularFileProperty
    val destinationDir : DirectoryProperty
}

// The implementation of a single unit of work
abstract class ReverseFile @Inject constructor(val fileSystemOperations: FileSystemOperations) : WorkAction&lt;ReverseParameters&gt; {
    override fun execute() {
        fileSystemOperations.copy {
            from(parameters.fileToReverse)
            into(parameters.destinationDir)
            filter { line: String -&gt; line.reversed() }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>WorkAction</code> implementation can inject services that provide capabilities during work execution, such as the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileSystemOperations.html">FileSystemOperations</a> service in the example above.  See <a href="#service_injection">Service Injection</a> for further information on injecting service types.</p>
</div>
<div class="paragraph">
<p>In order to submit the unit of work, it is necessary to first acquire the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a>. To do this, a task should have a constructor annotated with <code>javax.inject.Inject</code> that accepts a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> parameter. Gradle will inject the instance of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> at runtime when the task is created.  Then a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkQueue.html">WorkQueue</a> object can be created and individual items of work can be submitted.</p>
</div>
<div class="exampleblock">
<div class="title">Example 491. Submitting a unit of work for execution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ReverseFiles</span> <span class="directive">extends</span> SourceTask {
    <span class="directive">private</span> <span class="directive">final</span> WorkerExecutor workerExecutor

    <span class="annotation">@OutputDirectory</span>
    <span class="predefined-type">File</span> outputDir

    <span class="comment">// The WorkerExecutor will be injected by Gradle at runtime</span>
    <span class="annotation">@Inject</span>
    ReverseFiles(WorkerExecutor workerExecutor) {
        <span class="local-variable">this</span>.workerExecutor = workerExecutor
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> reverseFiles() {
        <span class="comment">// Create a WorkQueue to submit work items</span>
        WorkQueue workQueue = workerExecutor.noIsolation()

        <span class="comment">// Create and submit a unit of work for each file</span>
        source.each { file -&gt;
            workQueue.submit(ReverseFile.class) { ReverseParameters parameters -&gt;
                parameters.fileToReverse = file
                parameters.destinationDir = outputDir
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// The WorkerExecutor will be injected by Gradle at runtime
open class ReverseFiles @Inject constructor(private val workerExecutor: WorkerExecutor) : SourceTask() {
    @OutputDirectory
    lateinit var outputDir: File

    @TaskAction
    fun reverseFiles() {
        // Create a WorkQueue to submit work items
        val workQueue = workerExecutor.noIsolation()

        // Create and submit a unit of work for each file
        source.forEach { file -&gt;
            workQueue.submit(ReverseFile::class) {
                fileToReverse.set(file)
                destinationDir.set(outputDir)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once all of the work for a task action has been submitted, it is safe to exit the task action. The work will be executed asynchronously and in parallel (up to the setting of <code>max-workers</code>). Of course, any tasks that are dependent on this task (and any subsequent task actions of this task) will not begin executing until all of the asynchronous work completes. However, other independent tasks that have no relationship to this task can begin executing immediately.</p>
</div>
<div class="paragraph">
<p>If any failures occur while executing the asynchronous work, the task will fail and a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutionException.html">WorkerExecutionException</a> will be thrown detailing the failure for each failed work item. This will be treated like any failure during task execution and will prevent any dependent tasks from executing.</p>
</div>
<div class="paragraph">
<p>In some cases, however, it might be desirable to wait for work to complete before exiting the task action. This is possible using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkQueue.html#await--">WorkQueue.await()</a> method. As in the case of allowing the work to complete asynchronously, any failures that occur while executing an item of work will be surfaced as a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutionException.html">WorkerExecutionException</a> thrown from the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkQueue.html#await--">WorkQueue.await()</a> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Gradle will only begin running other independent tasks in parallel when a task has exited a task action and returned control of execution to Gradle. When <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkQueue.html#await--">WorkQueue.await()</a> is used, execution does not leave the task action. This means that Gradle will not allow other tasks to begin executing and will wait for the task action to complete before doing so.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 492. Waiting for asynchronous work to complete</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="comment">// Create a WorkQueue to submit work items</span>
        WorkQueue workQueue = workerExecutor.noIsolation()

        <span class="comment">// Create and submit a unit of work for each file</span>
        source.each { file -&gt;
            workQueue.submit(ReverseFile.class) { ReverseParameters parameters -&gt;
                parameters.fileToReverse = file
                parameters.destinationDir = outputDir
            }
        }

        <span class="comment">// Wait for all asynchronous work submitted to this queue to complete before continuing</span>
        workQueue.await()
        logger.lifecycle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Created </span><span class="inline"><span class="inline-delimiter">${</span>outputDir.listFiles().size()<span class="inline-delimiter">}</span></span><span class="content"> reversed files in </span><span class="inline"><span class="inline-delimiter">${</span>projectLayout.projectDirectory.asFile.relativePath(outputDir)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        // Create a WorkQueue to submit work items
        val workQueue = workerExecutor.noIsolation()

        // Create and submit a unit of work for each file
        source.forEach { file -&gt;
            workQueue.submit(ReverseFile::class) {
                fileToReverse.set(file)
                destinationDir.set(outputDir)
            }
        }

        // Wait for all asynchronous work submitted to this queue to complete before continuing
        workQueue.await()
        logger.lifecycle(&quot;Created ${outputDir.listFiles().size} reversed files in ${outputDir.toRelativeString(projectLayout.projectDirectory.asFile)}&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="isolation-modes"><a class="anchor" href="#isolation-modes"></a><a class="link" href="#isolation-modes">Isolation Modes</a></h5>
<div class="paragraph">
<p>Gradle provides three isolation modes that can be configured when creating a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkQueue.html">WorkQueue</a> and are specified using the one of the following methods on <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html#noIsolation--">WorkerExecutor.noIsolation()</a></dt>
<dd>
<p>This states that the work should be run in a thread with a minimum of isolation. For instance, it will share the same classloader that the task is loaded from. This is the fastest level of isolation.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html#classLoaderIsolation-org.gradle.api.Action-">WorkerExecutor.classLoaderIsolation()</a></dt>
<dd>
<p>This states that the work should be run in a thread with an isolated classloader. The classloader will have the classpath from the classloader that the unit of work implementation class was loaded from as well as any additional classpath entries added through <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/ClassLoaderWorkerSpec.html#getClasspath--">ClassLoaderWorkerSpec.getClasspath()</a>.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html#processIsolation-org.gradle.api.Action-">WorkerExecutor.processIsolation()</a></dt>
<dd>
<p>This states that the work should be run with a maximum level of isolation by executing the work in a separate process. The classloader of the process will use the classpath from the classloader that the unit of work was loaded from as well as any additional classpath entries added through <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/ClassLoaderWorkerSpec.html#getClasspath--">ClassLoaderWorkerSpec.getClasspath()</a>. Furthermore, the process will be a <em>Worker Daemon</em> which will stay alive and can be reused for future work items that may have the same requirements. This process can be configured with different settings than the Gradle JVM using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/ProcessWorkerSpec.html#forkOptions-org.gradle.api.Action-">ProcessWorkerSpec.forkOptions(org.gradle.api.Action)</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="worker-daemons"><a class="anchor" href="#worker-daemons"></a><a class="link" href="#worker-daemons">Worker Daemons</a></h5>
<div class="paragraph">
<p>When using <code>processIsolation()</code>, gradle will start a long-lived <em>Worker Daemon</em> process that can be reused for future work items.</p>
</div>
<div class="exampleblock">
<div class="title">Example 493. Submitting an item of work to run in a worker daemon</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="comment">// Create a WorkQueue with process isolation</span>
        WorkQueue workQueue = workerExecutor.processIsolation() { ProcessWorkerSpec spec -&gt;
            <span class="comment">// Configure the options for the forked process</span>
            forkOptions { JavaForkOptions options -&gt;
                options.maxHeapSize = <span class="string"><span class="delimiter">&quot;</span><span class="content">512m</span><span class="delimiter">&quot;</span></span>
                options.systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.sample.showFileSize</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
            }
        }

        <span class="comment">// Create and submit a unit of work for each file</span>
        source.each { file -&gt;
            workQueue.submit(ReverseFile.class) { ReverseParameters parameters -&gt;
                parameters.fileToReverse = file
                parameters.destinationDir = outputDir
            }
        }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">        // Create a WorkQueue with process isolation
        val workQueue = workerExecutor.processIsolation() {
            // Configure the options for the forked process
            forkOptions {
                maxHeapSize = &quot;512m&quot;
                systemProperty(&quot;org.gradle.sample.showFileSize&quot;, &quot;true&quot;)
            }
        }

        // Create and submit a unit of work for each file
        source.forEach { file -&gt;
            workQueue.submit(ReverseFile::class) {
                fileToReverse.set(file)
                destinationDir.set(outputDir)
            }
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a unit of work for a Worker Daemon is submitted, Gradle will first look to see if a compatible, idle daemon already exists. If so, it will send the unit of work to the idle daemon, marking it as busy. If not, it will start a new daemon. When evaluating compatibility, Gradle looks at a number of criteria, all of which can be controlled through <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/ProcessWorkerSpec.html#forkOptions-org.gradle.api.Action-">ProcessWorkerSpec.forkOptions(org.gradle.api.Action)</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">executable</dt>
<dd>
<p>A daemon is considered compatible only if it uses the same java executable.</p>
</dd>
<dt class="hdlist1">classpath</dt>
<dd>
<p>A daemon is considered compatible if its classpath contains all of the classpath entries requested. Note that a daemon is considered compatible only if the classpath exactly matches the requested classpath.</p>
</dd>
<dt class="hdlist1">heap settings</dt>
<dd>
<p>A daemon is considered compatible if it has at least the same heap size settings as requested. In other words, a daemon that has higher heap settings than requested would be considered compatible.</p>
</dd>
<dt class="hdlist1">jvm arguments</dt>
<dd>
<p>A daemon is considered compatible if it has set all of the jvm arguments requested. Note that a daemon is considered compatible if it has additional jvm arguments beyond those requested (except for arguments treated specially such as heap settings, assertions, debug, etc).</p>
</dd>
<dt class="hdlist1">system properties</dt>
<dd>
<p>A daemon is considered compatible if it has set all of the system properties requested with the same values. Note that a daemon is considered compatible if it has additional system properties beyond those requested.</p>
</dd>
<dt class="hdlist1">environment variables</dt>
<dd>
<p>A daemon is considered compatible if it has set all of the environment variables requested with the same values. Note that a daemon is considered compatible if it has more environment variables in addition to those requested.</p>
</dd>
<dt class="hdlist1">bootstrap classpath</dt>
<dd>
<p>A daemon is considered compatible if it contains all of the bootstrap classpath entries requested. Note that a daemon is considered compatible if it has more bootstrap classpath entries in addition to those requested.</p>
</dd>
<dt class="hdlist1">debug</dt>
<dd>
<p>A daemon is considered compatible only if debug is set to the same value as requested (true or false).</p>
</dd>
<dt class="hdlist1">enable assertions</dt>
<dd>
<p>A daemon is considered compatible only if enable assertions is set to the same value as requested (true or false).</p>
</dd>
<dt class="hdlist1">default character encoding</dt>
<dd>
<p>A daemon is considered compatible only if the default character encoding is set to the same value as requested.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Worker daemons will remain running until either the build daemon that started them is stopped, or system memory becomes scarce. When available system memory is low, Gradle will begin stopping worker daemons in an attempt to minimize memory consumption.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cancellation_and_timeouts"><a class="anchor" href="#cancellation_and_timeouts"></a><a class="link" href="#cancellation_and_timeouts">Cancellation and timeouts</a></h4>
<div class="paragraph">
<p>In order to support cancellation (e.g. when the user stops the build with CTRL+C) and task timeouts, custom tasks should react to their executing thread being interrupted.
The same is true for work items submitted via the worker API. If a task does not respond to an interrupt within 10s, the daemon will shut down in order to free up system resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="more_details"><a class="anchor" href="#more_details"></a><a class="link" href="#more_details">More details</a></h4>
<div class="paragraph">
<p>It&#8217;s often a good approach to package custom task types in a custom Gradle plugin.
The plugin can provide useful defaults and conventions for the task type, and provides a convenient way to use the task type from a build script or another plugin.
Please see <a href="#custom_plugins">Developing Custom Gradle Plugins</a> for more details.</p>
</div>
<div class="paragraph">
<p>Gradle provides a number of features that are helpful when developing Gradle types, including tasks. Please see <a href="#">Developing Custom Gradle Types</a> for more details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_plugins"><a class="anchor" href="#custom_plugins"></a><a class="link" href="#custom_plugins">Developing Custom Gradle Plugins</a></h3>
<div class="paragraph">
<p>A Gradle plugin packages up reusable pieces of build logic, which can be used across many different projects and builds.
Gradle allows you to implement your own plugins, so you can reuse your build logic, and share it with others.</p>
</div>
<div class="paragraph">
<p>You can implement a Gradle plugin in any language you like, provided the implementation ends up compiled as JVM bytecode.
In our examples, we are going to use Java as the implementation language for standalone plugin project and Groovy or Kotlin in the buildscript plugin examples.
In general, a plugin implemented using Java or Kotlin, which are statically typed, will perform better than the same plugin implemented using Groovy.</p>
</div>
<div class="sect3">
<h4 id="sec:packaging_a_plugin"><a class="anchor" href="#sec:packaging_a_plugin"></a><a class="link" href="#sec:packaging_a_plugin">Packaging a plugin</a></h4>
<div class="paragraph">
<p>There are several places where you can put the source for the plugin.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Build script</dt>
<dd>
<p>You can include the source for the plugin directly in the build script.
This has the benefit that the plugin is automatically compiled and included in the classpath of the build script without you having to do anything.
However, the plugin is not visible outside the build script, and so you cannot reuse the plugin outside the build script it is defined in.</p>
</dd>
<dt class="hdlist1"><code>buildSrc</code> project</dt>
<dd>
<p>You can put the source for the plugin in the <code><em>rootProjectDir</em>/buildSrc/src/main/java</code> directory
(or <code><em>rootProjectDir</em>/buildSrc/src/main/groovy</code> or <code><em>rootProjectDir</em>/buildSrc/src/main/kotlin</code> depending on which language you prefer).
Gradle will take care of compiling and testing the plugin and making it available on the classpath of the build script.
The plugin is visible to every build script used by the build. However, it is not visible outside the build, and so you cannot reuse the plugin outside the build it is defined in.</p>
<div class="paragraph">
<p>See <a href="#organizing_gradle_projects">Organizing Gradle Projects</a> for more details about the <code>buildSrc</code> project.</p>
</div>
</dd>
<dt class="hdlist1">Standalone project</dt>
<dd>
<p>You can create a separate project for your plugin. This project produces and publishes a JAR which you can then use in multiple builds and share with others.
Generally, this JAR might include some plugins, or bundle several related task classes into a single library. Or some combination of the two.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In our examples, we will start with the plugin in the build script, to keep things simple. Then we will look at creating a standalone project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:writing_a_simple_plugin"><a class="anchor" href="#sec:writing_a_simple_plugin"></a><a class="link" href="#sec:writing_a_simple_plugin">Writing a simple plugin</a></h4>
<div class="paragraph">
<p>To create a Gradle plugin, you need to write a class that implements the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> interface.
When the plugin is applied to a project, Gradle creates an instance of the plugin class and calls the instance&#8217;s <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html#apply-T-">Plugin.apply()</a> method.
The project object is passed as a parameter, which the plugin can use to configure the project however it needs to.
The following sample contains a greeting plugin, which adds a <code>hello</code> task to the project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 494. A custom plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println <span class="string"><span class="delimiter">'</span><span class="content">Hello from the GreetingPlugin</span><span class="delimiter">'</span></span>
            }
        }
    }
}

<span class="comment">// Apply the plugin</span>
apply <span class="key">plugin</span>: GreetingPlugin</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        project.task(&quot;hello&quot;) {
            doLast {
                println(&quot;Hello from the GreetingPlugin&quot;)
            }
        }
    }
}

// Apply the plugin
apply&lt;GreetingPlugin&gt;()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hello from the GreetingPlugin</pre>
</div>
</div>
<div class="paragraph">
<p>One thing to note is that a new instance of a plugin is created for each project it is applied to. Also note that the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> class is a generic type.
This example has it receiving the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> type as a type parameter.
A plugin can instead receive a parameter of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html">Settings</a>, in which case the plugin can be applied in a settings script,
or a parameter of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a>, in which case the plugin can be applied in an initialization script.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:getting_input_from_the_build"><a class="anchor" href="#sec:getting_input_from_the_build"></a><a class="link" href="#sec:getting_input_from_the_build">Making the plugin configurable</a></h4>
<div class="paragraph">
<p>Most plugins offer some configuration options for build scripts and other plugins to use to customize how the plugin works. Plugins do this using <em>extension objects</em>.
The Gradle <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> has an associated <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/ExtensionContainer.html">ExtensionContainer</a> object
that contains all the settings and properties for the plugins that have been applied to the project.
You can provide configuration for your plugin by adding an extension object to this container.
An extension object is simply an object with Java Bean properties that represent the configuration.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add a simple extension object to the project. Here we add a <code>greeting</code> extension object to the project, which allows you to configure the greeting.</p>
</div>
<div class="exampleblock">
<div class="title">Example 495. A custom plugin extension</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingPluginExtension</span> {
    <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">'</span><span class="content">Hello from GreetingPlugin</span><span class="delimiter">'</span></span>
}

<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="comment">// Add the 'greeting' extension object</span>
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, GreetingPluginExtension)
        <span class="comment">// Add a task that uses configuration from the extension object</span>
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println extension.message
            }
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin

<span class="comment">// Configure the extension</span>
greeting.message = <span class="string"><span class="delimiter">'</span><span class="content">Hi from Gradle</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingPluginExtension {
    var message = &quot;Hello from GreetingPlugin&quot;
}

class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        // Add the 'greeting' extension object
        val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)
        // Add a task that uses configuration from the extension object
        project.task(&quot;hello&quot;) {
            doLast {
                println(extension.message)
            }
        }
    }
}

apply&lt;GreetingPlugin&gt;()

// Configure the extension
the&lt;GreetingPluginExtension&gt;().message = &quot;Hi from Gradle&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hi from Gradle</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>GreetingPluginExtension</code> is an object with a property called <code>message</code>. The extension object is added to the project with the name <code>greeting</code>.
This object then becomes available as a project property with the same name as the extension object.</p>
</div>
<div class="paragraph">
<p>Oftentimes, you have several related properties you need to specify on a single plugin. Gradle adds a configuration block for each extension object, so you can group settings together.
The following example shows you how this works.</p>
</div>
<div class="exampleblock">
<div class="title">Example 496. A custom plugin with configuration block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingPluginExtension</span> {
    <span class="predefined-type">String</span> message
    <span class="predefined-type">String</span> greeter
}

<span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="type">void</span> apply(Project project) {
        <span class="keyword">def</span> extension = project.extensions.create(<span class="string"><span class="delimiter">'</span><span class="content">greeting</span><span class="delimiter">'</span></span>, GreetingPluginExtension)
        project.task(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
            doLast {
                println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>extension.message<span class="inline-delimiter">}</span></span><span class="content"> from </span><span class="inline"><span class="inline-delimiter">${</span>extension.greeter<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}

apply <span class="key">plugin</span>: GreetingPlugin

<span class="comment">// Configure the extension using a DSL block</span>
greeting {
    message = <span class="string"><span class="delimiter">'</span><span class="content">Hi</span><span class="delimiter">'</span></span>
    greeter = <span class="string"><span class="delimiter">'</span><span class="content">Gradle</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingPluginExtension {
    var message: String? = null
    var greeter: String? = null
}

class GreetingPlugin : Plugin&lt;Project&gt; {
    override fun apply(project: Project) {
        val extension = project.extensions.create&lt;GreetingPluginExtension&gt;(&quot;greeting&quot;)
        project.task(&quot;hello&quot;) {
            doLast {
                println(&quot;${extension.message} from ${extension.greeter}&quot;)
            }
        }
    }
}

apply&lt;GreetingPlugin&gt;()

// Configure the extension using a DSL block
configure&lt;GreetingPluginExtension&gt; {
    message = &quot;Hi&quot;
    greeter = &quot;Gradle&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q hello</code></strong></div>
<div class="content">
<pre>&gt; gradle -q hello
Hi from Gradle</pre>
</div>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>In this example, several settings can be grouped together within the <code>greeting</code> closure. The name of the closure block in the build script (<code>greeting</code>) needs to match the extension object name.
Then, when the closure is executed, the fields on the extension object will be mapped to the variables within the closure based on the standard Groovy closure delegate feature.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>In this example, several settings can be grouped together within the <code>configure&lt;GreetingPluginExtension&gt;</code> block.
The type used on the <code>configure</code> function in the build script (<code>GreetingPluginExtension</code>) needs to match the extension type.
Then, when the block is executed, the receiver of the block is the extension.</p>
</div>
<div class="paragraph">
<p>In this way, using an extension object <em>extends</em> the Gradle DSL to add a project property and DSL block for the plugin.
And because an extension object is simply a regular object, you can provide your own DSL nested inside the plugin block by adding properties and methods to the extension object.</p>
</div>
<div class="sect4">
<h5 id="developing_project_extensions"><a class="anchor" href="#developing_project_extensions"></a><a class="link" href="#developing_project_extensions">Developing project extensions</a></h5>
<div class="paragraph">
<p>You can find out more about implementing project extensions in <a href="#custom_gradle_types">Developing Custom Gradle Types</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:working_with_files_in_custom_tasks_and_plugins"><a class="anchor" href="#sec:working_with_files_in_custom_tasks_and_plugins"></a><a class="link" href="#sec:working_with_files_in_custom_tasks_and_plugins">Working with files in custom tasks and plugins</a></h4>
<div class="paragraph">
<p>When developing custom tasks and plugins, it&#8217;s a good idea to be very flexible when accepting input configuration for file locations.
To do this, you can leverage the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method to resolve values to files as late as possible.</p>
</div>
<div class="exampleblock">
<div class="title">Example 497. Evaluating file properties lazily</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GreetingToFileTask</span> <span class="directive">extends</span> DefaultTask {

    <span class="keyword">def</span> destination

    <span class="annotation">@OutputFile</span>
    <span class="predefined-type">File</span> getDestination() {
        project.file(destination)
    }

    <span class="annotation">@TaskAction</span>
    <span class="keyword">def</span> <span class="function">greet</span>() {
        <span class="keyword">def</span> file = getDestination()
        file.parentFile.mkdirs()
        file.write <span class="string"><span class="delimiter">'</span><span class="content">Hello!</span><span class="delimiter">'</span></span>
    }
}

task greet(<span class="key">type</span>: GreetingToFileTask) {
    destination = { project.greetingFile }
}

task sayGreeting(<span class="key">dependsOn</span>: greet) {
    doLast {
        println file(greetingFile).text
    }
}

ext.greetingFile = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/hello.txt</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">open class GreetingToFileTask : DefaultTask() {

    var destination: Any? = null

    @OutputFile
    fun getDestination(): File {
        return project.file(destination!!)
    }

    @TaskAction
    fun greet() {
        val file = getDestination()
        file.parentFile.mkdirs()
        file.writeText(&quot;Hello!&quot;)
    }
}

tasks.register&lt;GreetingToFileTask&gt;(&quot;greet&quot;) {
    destination = { project.extra[&quot;greetingFile&quot;]!! }
}

tasks.register(&quot;sayGreeting&quot;) {
    dependsOn(&quot;greet&quot;)
    doLast {
        println(file(project.extra[&quot;greetingFile&quot;]!!).readText())
    }
}

extra[&quot;greetingFile&quot;] = &quot;$buildDir/hello.txt&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle -q sayGreeting</code></strong></div>
<div class="content">
<pre>&gt; gradle -q sayGreeting
Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we configure the <code>greet</code> task <code>destination</code> property as a closure/provider, which is evaluated with
the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:file(java.lang.Object)">Project.file(java.lang.Object)</a> method to turn the return value of the closure/provider
into a <code>File</code> object at the last minute. You will notice that in the example above we specify the <code>greetingFile</code> property value after we have configured to use it for the task.
This kind of lazy evaluation is a key benefit of accepting any value when setting a file property, then resolving that value when reading the property.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:mapping_extension_properties_to_task_properties"><a class="anchor" href="#sec:mapping_extension_properties_to_task_properties"></a><a class="link" href="#sec:mapping_extension_properties_to_task_properties">Mapping extension properties to task properties</a></h4>
<div class="paragraph">
<p>Capturing user input from the build script through an extension and mapping it to input/output properties of a custom task is a useful pattern.
The build script author interacts only with the DSL defined by the extension. The imperative logic is hidden in the plugin implementation.</p>
</div>
<div class="paragraph">
<p>Gradle provides some types that you can use in task implementations and extensions to help you with this. Refer to <a href="#lazy_configuration">Lazy Configuration</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:custom_plugins_standalone_project"><a class="anchor" href="#sec:custom_plugins_standalone_project"></a><a class="link" href="#sec:custom_plugins_standalone_project">A standalone project</a></h4>
<div class="paragraph">
<p>Now we will move our plugin to a standalone project so that we can publish it and share it with others. This project is simply a Java project that produces a JAR containing the plugin classes.
The easiest and the recommended way to package and publish a plugin is to use the <a href="#java_gradle_plugin">Java Gradle Plugin Development Plugin</a>.
This plugin will automatically apply the <a href="#java_plugin">Java Plugin</a>, add the <code>gradleApi()</code> dependency to the implementation configuration,
generate the required plugin descriptors in the resulting JAR file and configure the <a href="#sec:plugin_markers">Plugin Marker Artifact</a> to be used when publishing.
Here is a simple build script for the project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 498. A build for a custom plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}

gradlePlugin {
    plugins {
        simplePlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">org.samples.greeting</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.GreetingPlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}

gradlePlugin {
    plugins {
        create(&quot;simplePlugin&quot;) {
            id = &quot;org.samples.greeting&quot;
            implementationClass = &quot;org.gradle.GreetingPlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:creating_a_plugin_id"><a class="anchor" href="#sec:creating_a_plugin_id"></a><a class="link" href="#sec:creating_a_plugin_id">Creating a plugin id</a></h5>
<div class="paragraph">
<p>Plugin ids are fully qualified in a manner similar to Java packages (i.e. a reverse domain name). This helps to avoid collisions and provides a way to group plugins with similar ownership.</p>
</div>
<div class="paragraph">
<p>Your plugin id should be a combination of components that reflect namespace (a reasonable pointer to you or your organization) and the name of the plugin it provides.
For example if you had a Github account named "foo" and your plugin was named "bar", a suitable plugin id might be <code>com.github.foo.bar</code>.
Similarly, if the plugin was developed at the baz organization, the plugin id might be <code>org.baz.bar</code>.</p>
</div>
<div class="paragraph">
<p>Plugin ids should conform to the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>May contain any alphanumeric character, '.', and '-'.</p>
</li>
<li>
<p>Must contain at least one '.' character separating the namespace from the name of the plugin.</p>
</li>
<li>
<p>Conventionally use a lowercase reverse domain name convention for the namespace.</p>
</li>
<li>
<p>Conventionally use only lowercase characters in the name.</p>
</li>
<li>
<p><code>org.gradle</code> and <code>com.gradleware</code> namespaces may not be used.</p>
</li>
<li>
<p>Cannot start or end with a '.' character.</p>
</li>
<li>
<p>Cannot contain consecutive '.' characters (i.e. '..').</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although there are conventional similarities between plugin ids and package names, package names are generally more detailed than is necessary for a plugin id.
For instance, it might seem reasonable to add "gradle" as a component of your plugin id, but since plugin ids are only used for Gradle plugins, this would be superfluous.
Generally, a namespace that identifies ownership and a name are all that are needed for a good plugin id.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:publishing_your_plugin"><a class="anchor" href="#sec:publishing_your_plugin"></a><a class="link" href="#sec:publishing_your_plugin">Publishing your plugin</a></h5>
<div class="paragraph">
<p>If you are publishing your plugin internally for use within your organization, you can publish it like any other code artifact.
See the <a href="#publishing_ivy">Ivy</a> and <a href="#publishing_maven">Maven</a> chapters on publishing artifacts.</p>
</div>
<div class="paragraph">
<p>If you are interested in publishing your plugin to be used by the wider Gradle community, you can publish it to the <a href="http://plugins.gradle.org">Gradle Plugin Portal</a>.
This site provides the ability to search for and gather information about plugins contributed by the Gradle community.
Please refer to the corresponding <a href="https://guides.gradle.org/publishing-plugins-to-gradle-plugin-portal/">guide</a> on how to make your plugin available on this site.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:using_your_plugin_in_another_project"><a class="anchor" href="#sec:using_your_plugin_in_another_project"></a><a class="link" href="#sec:using_your_plugin_in_another_project">Using your plugin in another project</a></h5>
<div class="paragraph">
<p>To use a plugin in a build script, you need to configure the repository in <code>pluginManagement {}</code> block of the project&#8217;s settings file.
The following example shows how you might do this when the plugin has been published to a local repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 499. Using a custom plugin in another project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pluginManagement {
    repositories {
        maven {
            url = uri(repoLocation)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">org.samples.greeting</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.0-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        maven {
            url = uri(repoLocation)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.samples.greeting&quot;) version &quot;1.0-SNAPSHOT&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="note_for_plugins_published_without_java_gradle_plugin"><a class="anchor" href="#note_for_plugins_published_without_java_gradle_plugin"></a><a class="link" href="#note_for_plugins_published_without_java_gradle_plugin">Note for plugins published without <code>java-gradle-plugin</code></a></h6>
<div class="paragraph">
<p>If your plugin was published without using the <a href="#java_gradle_plugin">Java Gradle Plugin Development Plugin</a>, the publication will be lacking <a href="#sec:plugin_markers">Plugin Marker Artifact</a>, which is needed for <a href="#sec:plugins_block">plugins DSL</a> to locate the plugin.
In this case, the recommended way to resolve the plugin in another project is to add a <code>resolutionStrategy</code> section to the <code>pluginManagement {}</code> block of the project&#8217;s settings file as shown below.</p>
</div>
<div class="exampleblock">
<div class="title">Example 500. Resolution strategy for plugins without Plugin Marker Artifact</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    resolutionStrategy {
        eachPlugin {
            <span class="keyword">if</span> (requested.id.namespace == <span class="string"><span class="delimiter">'</span><span class="content">org.samples</span><span class="delimiter">'</span></span>) {
                useModule(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle:customPlugin:</span><span class="inline"><span class="inline-delimiter">${</span>requested.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    resolutionStrategy {
        eachPlugin {
            if (requested.id.namespace == &quot;org.samples&quot;) {
                useModule(&quot;org.gradle:customPlugin:${requested.version}&quot;)
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:precompiled_plugins"><a class="anchor" href="#sec:precompiled_plugins"></a><a class="link" href="#sec:precompiled_plugins">Precompiled script plugins</a></h4>
<div class="paragraph">
<p>In addition to plugins written as standalone projects, Gradle also allows you to provide build logic written in either Groovy or Kotlin DSLs as precompiled script plugins. You write these as <code>*.gradle</code> files in <code>src/main/groovy</code>
directory or <code>*.gradle.kts</code> files in <code>src/main/kotlin</code> directory.</p>
</div>
<div class="paragraph">
<p>Precompiled script plugins are compiled into class files and packaged into a jar. For all intents and purposes, they are binary plugins and can be applied by plugin ID, tested and published as binary plugins. In fact, the plugin metadata for
them is generated using the <a href="#java_gradle_plugin">Gradle Plugin Development Plugin</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Kotlin DSL precompiled script plugins built with Gradle 6.0 cannot be used with earlier versions of Gradle.
This limitation will be lifted in a future version of Gradle.</p>
</div>
<div class="paragraph">
<p>Groovy DSL precompiled script plugins are available starting with Gradle 6.4.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>To apply a precompiled script plugin, you need to know its ID which is derived from the plugin script&#8217;s
filename (minus the <code>.gradle</code> extension).</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>To apply a precompiled script plugin, you need to know its ID which is derived from the plugin script&#8217;s
filename (minus the <code>.gradle.kts</code> extension) and its (optional) package declaration.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>For example, the script <code>src/main/groovy/java-library-convention.gradle</code> would have a plugin ID of <code>java-library-convention</code>.
Likewise, <code>src/main/groovy/my.java-library-convention.gradle</code> would result in a plugin ID of <code>my.java-library-convention</code>.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>For example, the script <code>src/main/kotlin/java-library-convention.gradle.kts</code> would have a plugin ID of
<code>java-library-convention</code> (assuming it has no package declaration).
Likewise, <code>src/main/kotlin/my/java-library-convention.gradle.kts</code> would result in a plugin ID of
<code>my.java-library-convention</code> as long as it has a package declaration of <code>my</code>.</p>
</div>
<div class="paragraph">
<p>To demonstrate how you can implement and use a precompiled script plugin, let&#8217;s walk through an example based on a <code>buildSrc</code> project.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>First, you need a <code>buildSrc/build.gradle</code> file that applies the <code>groovy-gradle-plugin</code> plugin:</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>First, you need a <code>buildSrc/build.gradle.kts</code> file that applies the <code>kotlin-dsl</code> plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 501. Enabling precompiled script plugins</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>We recommend that you also create a <code>buildSrc/settings.gradle</code> file, which you may leave empty.</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>We recommend that you also create a <code>buildSrc/settings.gradle.kts</code> file, which you may leave empty.</p>
</div>
<div class="paragraph multi-language-text lang-groovy">
<p>Next, create a new <code>java-library-convention.gradle</code> file in the <code>buildSrc/src/main/groovy</code> directory and set its contents to the following:</p>
</div>
<div class="paragraph multi-language-text lang-kotlin">
<p>Next, create a new <code>java-library-convention.gradle.kts</code> file in the <code>buildSrc/src/main/kotlin</code> directory and set its contents to the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 502. Creating a simple script plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/java-library-convention.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">checkstyle</span><span class="delimiter">'</span></span>
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

checkstyle {
    maxWarnings = <span class="integer">0</span>
    <span class="comment">// ...</span>
}

tasks.withType(JavaCompile) {
    options.warnings = <span class="predefined-constant">true</span>
    <span class="comment">// ...</span>
}

dependencies {
    testImplementation(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.12</span><span class="delimiter">&quot;</span></span>)
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/java-library-convention.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    checkstyle
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

checkstyle {
    maxWarnings = 0
    // ...
}

tasks.withType&lt;JavaCompile&gt; {
    options.isWarnings = true
    // ...
}

dependencies {
    testImplementation(&quot;junit:junit:4.12&quot;)
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This script plugin simply applies the Java Library and Checkstyle Plugins and configures them.
Note that this will actually apply the plugins to the main project, i.e. the one that applies the precompiled script plugin.</p>
</div>
<div class="paragraph">
<p>Finally, apply the script plugin to the root project as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 503. Applying the precompiled script plugin to the main project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library-convention</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library-convention`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="applying_external_plugins_in_precompiled_script_plugins"><a class="anchor" href="#applying_external_plugins_in_precompiled_script_plugins"></a><a class="link" href="#applying_external_plugins_in_precompiled_script_plugins">Applying external plugins in precompiled script plugins</a></h5>
<div class="paragraph">
<p>In order to apply an external plugin in a precompiled script plugin,
it has to be added to the plugin project&#8217;s implementation classpath in the plugin&#8217;s build file.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy-gradle-plugin</span><span class="delimiter">'</span></span>
}

repositories {
    jcenter()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.bmuschko:gradle-docker-plugin:6.4.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    jcenter()
}

dependencies {
    implementation(&quot;com.bmuschko:gradle-docker-plugin:6.4.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It can then be applied in the precompiled script plugin.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/groovy/my-plugin.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">com.bmuschko.docker-remote-api</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/src/main/kotlin/my-plugin.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.bmuschko.docker-remote-api&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin version in this case is defined in the dependency declaration.</p>
</div>
<div class="paragraph">
<p>This limitation will be removed in future versions of Gradle.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:writing_tests_for_your_plugin"><a class="anchor" href="#sec:writing_tests_for_your_plugin"></a><a class="link" href="#sec:writing_tests_for_your_plugin">Writing tests for your plugin</a></h4>
<div class="paragraph">
<p>You can use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testfixtures/ProjectBuilder.html">ProjectBuilder</a> class to create <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a> instances to use when you test your plugin implementation.</p>
</div>
<div class="sect4">
<h5 id="example_testing_a_custom_plugin"><a class="anchor" href="#example_testing_a_custom_plugin"></a><a class="link" href="#example_testing_a_custom_plugin">Example: Testing a custom plugin</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/test/java/org/gradle/GreetingPluginTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingPluginTest</span> {
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> greeterPluginAddsGreetingTaskToProject() {
        Project project = ProjectBuilder.builder().build();
        project.getPluginManager().apply(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.samples.greeting</span><span class="delimiter">&quot;</span></span>);

        assertTrue(project.getTasks().getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) <span class="keyword">instanceof</span> GreetingTask);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="more_details_2"><a class="anchor" href="#more_details_2"></a><a class="link" href="#more_details_2">More details</a></h4>
<div class="paragraph">
<p>Plugins often also provide custom task types. Please see <a href="#custom_tasks">Developing Custom Gradle Task Types</a> for more details.</p>
</div>
<div class="paragraph">
<p>Gradle provides a number of features that are helpful when developing Gradle types, including plugins. Please see <a href="#custom_gradle_types">Developing Custom Gradle Types</a> for more details.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
When developing Gradle Plugins, it is important to be cautious when logging information to the build log.
Logging sensitive information (e.g. credentials, tokens, certain environment variables) is <a href="#sec:debug_security">considered a security vulnerability</a>.
Build logs for public Continuous Integration services are world-viewable and can expose this sensitive information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="behind_the_scenes"><a class="anchor" href="#behind_the_scenes"></a><a class="link" href="#behind_the_scenes">Behind the scenes</a></h4>
<div class="paragraph">
<p>So how does Gradle find the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> implementation?
The answer is - you need to provide a properties file in the JAR&#8217;s <code>META-INF/gradle-plugins</code> directory that matches the id of your plugin, which is handled by <a href="#java_gradle_plugin">Java Gradle Plugin Development Plugin</a>.</p>
</div>
<div class="sect4">
<h5 id="example_wiring_for_a_custom_plugin"><a class="anchor" href="#example_wiring_for_a_custom_plugin"></a><a class="link" href="#example_wiring_for_a_custom_plugin">Example: Wiring for a custom plugin</a></h5>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/gradle-plugins/org.samples.greeting.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">implementation-class=org.gradle.GreetingPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the properties filename matches the plugin id and is placed in the resources folder, and that the <code>implementation-class</code> property identifies the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Plugin.html">Plugin</a> implementation class.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_gradle_types"><a class="anchor" href="#custom_gradle_types"></a><a class="link" href="#custom_gradle_types">Developing Custom Gradle Types</a></h3>
<div class="paragraph">
<p>There are several different kinds of "add-ons" to Gradle that you can develop, such as <a href="#custom_plugins">plugins</a>, <a href="#custom_tasks">tasks</a>,
<a href="#sec:getting_input_from_the_build">project extensions</a> or <a href="#sec:implementing-artifact-transforms">artifact transforms</a>,
that are all implemented as classes and other types that can run on the JVM.
This chapter discusses some of the features and concepts that are common to these types.
You can use these features to help implement custom Gradle types and provide a consistent DSL for your users.</p>
</div>
<div class="paragraph">
<p>This chapter applies to the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plugin types.</p>
</li>
<li>
<p>Task types.</p>
</li>
<li>
<p>Artifact transform parameters types.</p>
</li>
<li>
<p>Worker API work action parameters types.</p>
</li>
<li>
<p>Extension objects created using <code>ExtensionContainer.create()</code>, for example a project extension registered by a plugin.</p>
</li>
<li>
<p>Objects created using <code>ObjectFactory.newInstance()</code>.</p>
</li>
<li>
<p>Objects created for a managed nested property.</p>
</li>
<li>
<p>Elements of a <code>NamedDomainObjectContainer</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuration_using_bean_properties"><a class="anchor" href="#configuration_using_bean_properties"></a><a class="link" href="#configuration_using_bean_properties">Configuration using bean properties</a></h4>
<div class="paragraph">
<p>The custom Gradle types that you implement often hold some configuration that you want to make available to build scripts and other plugins.
For example, a download task may have configuration that specifies the URL to download from and the file system location to write the result to.
This configuration is represented as Java bean properties.</p>
</div>
<div class="paragraph">
<p>Kotlin and Groovy provide conveniences for declaring Java bean properties, which make them good language choices to use to implement Gradle types.
These conveniences are demonstrated in the samples below.</p>
</div>
<div class="paragraph">
<p>Gradle also provides some conveniences for implementing types with bean properties.</p>
</div>
<div class="sect4">
<h5 id="managed_properties"><a class="anchor" href="#managed_properties"></a><a class="link" href="#managed_properties">Managed properties</a></h5>
<div class="paragraph">
<p>Gradle can provide an implementation of an abstract property. This is called a <em>managed property</em>, as Gradle takes care of managing the state of the property.
A property may be <em>mutable</em>, meaning that it has both a getter method and setter method, or <em>read-only</em>, meaning that it has only a getter method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Managed properties are currently an <a href="feature_lifecycle.html#feature_lifecycle">incubating</a> feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="mutable_managed_properties"><a class="anchor" href="#mutable_managed_properties"></a><a class="link" href="#mutable_managed_properties">Mutable managed properties</a></h6>
<div class="paragraph">
<p>To declare a mutable managed property, add an abstract getter method and an abstract setter method for the property to the type.</p>
</div>
<div class="paragraph">
<p>Here is an example of a task type with a <code>uri</code> property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 504. Mutable managed property</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter and setter method</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> <span class="predefined-type">URI</span> getUri();
    <span class="directive">abstract</span> <span class="type">void</span> setUri(<span class="predefined-type">URI</span> uri);

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `uri` property</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading </span><span class="delimiter">&quot;</span></span> + getUri());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.DefaultTask
import org.gradle.api.tasks.Input
import org.gradle.api.tasks.TaskAction
import java.net.URI

abstract class Download : DefaultTask() {
    // Use an abstract var
    @get:Input
    abstract var uri: URI

    @TaskAction
    fun run() {
        // Use the `uri` property
        println(&quot;Downloading $uri&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract property</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> <span class="predefined-type">URI</span> uri

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `uri` property</span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">downloading </span><span class="inline"><span class="inline-delimiter">${</span>uri<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that for a property to be considered a mutable managed property, <em>all</em> of the property&#8217;s getter methods and setter methods must be <code>abstract</code> and have <code>public</code> or <code>protected</code> visibility.</p>
</div>
</div>
<div class="sect5">
<h6 id="read_only_managed_properties"><a class="anchor" href="#read_only_managed_properties"></a><a class="link" href="#read_only_managed_properties">Read-only managed properties</a></h6>
<div class="paragraph">
<p>To declare a read-only managed property, add an abstract getter method for the property to the type.
The property should not have any setter methods.
Gradle will provide an implementation of the getter and also create a value for the property.</p>
</div>
<div class="paragraph">
<p>This is a useful pattern to use with one of Gradle&#8217;s configurable <a href="#lazy_configuration">lazy property</a> or container types.</p>
</div>
<div class="paragraph">
<p>Here is an example of a task type with a <code>uri</code> property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 505. Read-only managed property</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">URI</span>&gt; getUri();

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `uri` property</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading </span><span class="delimiter">&quot;</span></span> + getUri().get());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.api.DefaultTask
import org.gradle.api.tasks.Input
import org.gradle.api.tasks.TaskAction
import org.gradle.api.provider.Property
import java.net.URI

abstract class Download : DefaultTask() {
    // Use an abstract val
    @get:Input
    abstract val uri: Property&lt;URI&gt;

    @TaskAction
    fun run() {
        // Use the `uri` property
        println(&quot;Downloading ${uri.get()}&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.Input</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.provider.Property</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method</span>
    <span class="annotation">@Input</span>
    <span class="directive">abstract</span> Property&lt;<span class="predefined-type">URI</span>&gt; getUri()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `uri` property</span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">downloading </span><span class="inline"><span class="inline-delimiter">${</span>uri.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that for a property to be considered a read only managed property, <em>all</em> of the property&#8217;s getter methods must be <code>abstract</code> and have <code>public</code> or <code>protected</code> visibility.
The property must not have any setter methods.
In addition, the property type must have one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Property&lt;T&gt;</code></p>
</li>
<li>
<p><code>RegularFileProperty</code></p>
</li>
<li>
<p><code>DirectoryProperty</code></p>
</li>
<li>
<p><code>ListProperty&lt;T&gt;</code></p>
</li>
<li>
<p><code>SetProperty&lt;T&gt;</code></p>
</li>
<li>
<p><code>MapProperty&lt;K, V&gt;</code></p>
</li>
<li>
<p><code>ConfigurableFileCollection</code></p>
</li>
<li>
<p><code>ConfigurableFileTree</code></p>
</li>
<li>
<p><code>DomainObjectSet&lt;T&gt;</code></p>
</li>
<li>
<p><code>NamedDomainObjectContainer&lt;T&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle creates values for read-only managed properties in the same way as <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="read_only_managed_nested_properties"><a class="anchor" href="#read_only_managed_nested_properties"></a><a class="link" href="#read_only_managed_nested_properties">Read-only managed nested properties</a></h6>
<div class="paragraph">
<p>To declare a read-only managed nested property, add an abstract getter method for the property to the type annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.
The property should not have any setter methods.
Gradle provides an implementation for the getter method, and also creates a value for the property.
The nested type is also treated as a custom type, and can use the features discussed in this chapter.</p>
</div>
<div class="paragraph">
<p>This pattern is useful when a custom type has a nested complex type which has the same lifecycle.
If the lifecycle is different, consider using <code>Property&lt;NestedType&gt;</code> instead.</p>
</div>
<div class="paragraph">
<p>Here is an example of a task type with a <code>resource</code> property. The <code>Resource</code> type is also a custom Gradle type and defines some managed properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 506. Read-only managed nested property</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method annotated with @Nested</span>
    <span class="annotation">@Nested</span>
    <span class="directive">abstract</span> Resource getResource();

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `resource` property</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading https://</span><span class="delimiter">&quot;</span></span> + getResource().getHostName().get() + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + getResource().getPath().get());
    }
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Resource</span> {
    <span class="annotation">@Input</span>
    Property&lt;<span class="predefined-type">String</span>&gt; getHostName();
    <span class="annotation">@Input</span>
    Property&lt;<span class="predefined-type">String</span>&gt; getPath();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">abstract class Download : DefaultTask() {
    // Use an abstract getter method annotated with @Nested
    @get:Nested
    abstract val resource: Resource

    @TaskAction
    fun run() {
        // Use the `resource` property
        println(&quot;Downloading https://${resource.hostName.get()}/${resource.path.get()}&quot;)
    }
}

interface Resource {
    @get:Input
    val hostName: Property&lt;String&gt;
    @get:Input
    val path: Property&lt;String&gt;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method annotated with @Nested</span>
    <span class="annotation">@Nested</span>
    <span class="directive">abstract</span> Resource getResource()

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the `resource` property</span>
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Downloading https://</span><span class="inline"><span class="inline-delimiter">${</span>resource.hostName.get()<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>resource.path.get()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}

<span class="type">interface</span> Resource {
    <span class="annotation">@Input</span>
    Property&lt;<span class="predefined-type">String</span>&gt; getHostName()
    <span class="annotation">@Input</span>
    Property&lt;<span class="predefined-type">String</span>&gt; getPath()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that for a property to be considered a read only managed nested property, <em>all</em> of the property&#8217;s getter methods must be <code>abstract</code> and have <code>public</code> or <code>protected</code> visibility.
The property must not have any setter methods.
In addition, the property getter must be annotated with <code>@<a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/Nested.html">Nested</a></code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="managed_types"><a class="anchor" href="#managed_types"></a><a class="link" href="#managed_types">Managed types</a></h5>
<div class="paragraph">
<p>A <em>managed type</em> is an abstract class or interface with no fields and whose properties are all managed.
That is, it is a type whose state is entirely managed by Gradle.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsl_support_and_extensibility"><a class="anchor" href="#dsl_support_and_extensibility"></a><a class="link" href="#dsl_support_and_extensibility">DSL support and extensibility</a></h4>
<div class="paragraph">
<p>When Gradle creates an instance of a custom type, it <em>decorates</em> the instance to mix-in DSL and extensibility support.</p>
</div>
<div class="paragraph">
<p>Each decorated instance implements <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/ExtensionAware.html">ExtensionAware</a>, and so can have extension
objects attached to it.</p>
</div>
<div class="paragraph">
<p>Note that plugins and the elements of containers created using <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#container-java.lang.Class-">Project.container()</a> are currently not decorated, due to backwards compatibility issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="service_injection"><a class="anchor" href="#service_injection"></a><a class="link" href="#service_injection">Service injection</a></h4>
<div class="paragraph">
<p>Gradle provides a number of useful services that can be used by custom Gradle types.
For example, the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> service can be used by a task to run work in parallel, as seen in the <a href="#worker_api">worker API</a> section.
The services are made available through <em>service injection</em>.</p>
</div>
<div class="sect4">
<h5 id="services_for_injection"><a class="anchor" href="#services_for_injection"></a><a class="link" href="#services_for_injection">Available services</a></h5>
<div class="paragraph">
<p>The following services are available for injection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> - Allows model objects to be created. See <a href="#nested_objects">Creating nested objects</a> for more details.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/ProjectLayout.html">ProjectLayout</a> - Provides access to key project locations. See <a href="#working_with_files_in_lazy_properties">lazy configuration</a> for more details. This service is unavailable in Worker API actions.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/provider/ProviderFactory.html">ProviderFactory</a> - Creates <code>Provider</code> instances. See <a href="#lazy_configuration">lazy configuration</a> for more details.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/workers/WorkerExecutor.html">WorkerExecutor</a> - Allows a task to run work in parallel. See <a href="#worker_api">the worker API</a> for more details.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileSystemOperations.html">FileSystemOperations</a> - Allows a task to run operations on the filesystem such as deleting files, copying files or syncing directories.</p>
</li>
<li>
<p><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/process/ExecOperations.html">ExecOperations</a> - Allows a task to run external processes with dedicated support for running external <code>java</code> programs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Out of the above, <code>ProjectLayout</code> and <code>WorkerExecutor</code> services are only available for injection in project plugins.</p>
</div>
</div>
<div class="sect4">
<h5 id="constructor_injection"><a class="anchor" href="#constructor_injection"></a><a class="link" href="#constructor_injection">Constructor injection</a></h5>
<div class="paragraph">
<p>There are 2 ways that an object can receive the services that it needs. The first option is to add the service as a parameter of the class constructor.
The constructor must be annotated with the <code>javax.inject.Inject</code> annotation.
Gradle uses the declared type of each constructor parameter to determine the services that the object requires.
The order of the constructor parameters and their names are not significant and can be whatever you like.</p>
</div>
<div class="paragraph">
<p>Here is an example that shows a task type that receives an <code>ObjectFactory</code> via its constructor:</p>
</div>
<div class="exampleblock">
<div class="title">Example 507. Constructor service injection</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.OutputDirectory</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="directive">final</span> DirectoryProperty outputDirectory;

    <span class="comment">// Inject an ObjectFactory into the constructor</span>
    <span class="annotation">@Inject</span>
    <span class="directive">public</span> Download(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use the factory</span>
        outputDirectory = objectFactory.directoryProperty();
    }

    <span class="annotation">@OutputDirectory</span>
    <span class="directive">public</span> DirectoryProperty getOutputDirectory() {
        <span class="keyword">return</span> outputDirectory;
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import javax.inject.Inject
import org.gradle.api.model.ObjectFactory
import org.gradle.api.DefaultTask
import org.gradle.api.tasks.TaskAction
import org.gradle.api.file.DirectoryProperty
import org.gradle.api.tasks.OutputDirectory

open class Download
// Inject an ObjectFactory into the constructor
@Inject constructor(objectFactory: ObjectFactory) : DefaultTask() {
    // Use the factory
    @OutputDirectory
    val outputDirectory = objectFactory.directoryProperty()

    @TaskAction
    fun run() {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.file.DirectoryProperty</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.OutputDirectory</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="annotation">@OutputDirectory</span>
    <span class="directive">final</span> DirectoryProperty outputDirectory

    <span class="comment">// Inject an ObjectFactory into the constructor</span>
    <span class="annotation">@Inject</span>
    Download(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use the factory</span>
        outputDirectory = objectFactory.directoryProperty()
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property_injection"><a class="anchor" href="#property_injection"></a><a class="link" href="#property_injection">Property injection</a></h5>
<div class="paragraph">
<p>Alternatively, a service can be injected by adding a property getter method annotated with the <code>javax.inject.Inject</code> annotation to the class.
This can be useful, for example, when you cannot change the constructor of the class due to backwards compatibility constraints.
This pattern also allows Gradle to defer creation of the service until the getter method is called, rather than when the instance is created. This can help with performance.
Gradle uses the declared return type of the getter method to determine the service to make available. The name of the property is not significant and can be whatever you like.</p>
</div>
<div class="paragraph">
<p>The property getter method must be <code>public</code> or <code>protected</code>. The method can be <code>abstract</code> or, in cases where this isn&#8217;t possible, can have a dummy method body.
The method body is discarded.</p>
</div>
<div class="paragraph">
<p>Here is an example that shows a task type that receives a two services via property getter methods:</p>
</div>
<div class="exampleblock">
<div class="title">Example 508. Property service injection</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">Download.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkerExecutor</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method</span>
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">ObjectFactory</span> getObjectFactory();

    <span class="comment">// Alternatively, use a getter method with a dummy implementation</span>
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> WorkerExecutor getWorkerExecutor() {
        <span class="comment">// Method body is ignored</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>();
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        WorkerExecutor workerExecutor = getWorkerExecutor();
        <span class="predefined-type">ObjectFactory</span> objectFactory = getObjectFactory();
        <span class="comment">// Use the executor and factory ...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import javax.inject.Inject
import org.gradle.api.model.ObjectFactory
import org.gradle.api.DefaultTask
import org.gradle.api.tasks.TaskAction
import org.gradle.workers.WorkerExecutor

abstract class Download : DefaultTask() {
    // Use an abstract property
    // Note that the @Inject annotation must be attached to the getter
    @get:Inject
    abstract val objectFactory: ObjectFactory

    // Alternatively, use a property getter with a dummy implementation
    // Note that the property must be open and the @Inject annotation must be attached to the getter
    @get:Inject
    open val workerExecutor: WorkerExecutor
        get() {
            // Getter body is ignored
            throw UnsupportedOperationException()
        }

    @TaskAction
    fun run() {
        // Use the executor and factory ...
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Download.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>
<span class="keyword">import</span> <span class="include">org.gradle.workers.WorkerExecutor</span>

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="directive">abstract</span> <span class="type">class</span> <span class="class">Download</span> <span class="directive">extends</span> DefaultTask {
    <span class="comment">// Use an abstract getter method</span>
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">ObjectFactory</span> getObjectFactory()

    <span class="comment">// Alternatively, use a getter method with a dummy implementation</span>
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> WorkerExecutor getWorkerExecutor() {
        <span class="comment">// Method body is ignored</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>()
    }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> run() {
        <span class="comment">// Use the executor and factory ...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nested_objects"><a class="anchor" href="#nested_objects"></a><a class="link" href="#nested_objects">Creating nested objects</a></h4>
<div class="paragraph">
<p>A custom Gradle type can use the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> service to create instances of Gradle types to use for its property values.
These instances can make use of the features discussed in this chapter, allowing you to create 'nested' object and a nested DSL.</p>
</div>
<div class="paragraph">
<p>You can also have Gradle create nested objects for you by using a <a href="#read_only_managed_nested_properties">managed nested property</a>.</p>
</div>
<div class="paragraph">
<p>In the following example, a project extension receives an <code>ObjectFactory</code> instance through its constructor.
The constructor uses this to create a nested <code>Resource</code> object (also a custom Gradle type) and makes this object available through the <code>resource</code> property.</p>
</div>
<div class="exampleblock">
<div class="title">Example 509. Nested object creation</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DownloadExtension</span> {
    <span class="comment">// A nested instance</span>
    <span class="directive">private</span> <span class="directive">final</span> Resource resource;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> DownloadExtension(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use an injected ObjectFactory to create a Resource object</span>
        resource = objectFactory.newInstance(Resource.class);
    }

    <span class="directive">public</span> Resource getResource() {
        <span class="keyword">return</span> resource;
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Resource</span> {
    <span class="directive">private</span> <span class="predefined-type">URI</span> uri;

    <span class="directive">public</span> <span class="predefined-type">URI</span> getUri() {
        <span class="keyword">return</span> uri;
    }
    <span class="directive">public</span> <span class="type">void</span> setUri(<span class="predefined-type">URI</span> uri) {
        <span class="local-variable">this</span>.uri = uri;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import javax.inject.Inject
import org.gradle.api.model.ObjectFactory

open class DownloadExtension @Inject constructor(objectFactory: ObjectFactory) {
    // Use an injected ObjectFactory to create a nested Resource object
    val resource: Resource = objectFactory.newInstance(Resource::class.java)
}

open class Resource {
    var uri: URI? = null
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="type">class</span> <span class="class">DownloadExtension</span> {
    <span class="comment">// A nested instance</span>
    <span class="directive">final</span> Resource resource

    <span class="annotation">@Inject</span>
    DownloadExtension(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use an injected ObjectFactory to create a Resource object</span>
        resource = objectFactory.newInstance(Resource)
    }
}

<span class="type">class</span> <span class="class">Resource</span> {
    <span class="predefined-type">URI</span> uri
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collection_types"><a class="anchor" href="#collection_types"></a><a class="link" href="#collection_types">Collection types</a></h4>
<div class="paragraph">
<p>Gradle provides types for maintaining collections of objects, intended to work well with the Gradle DSL and provide useful features such as lazy configuration.</p>
</div>
<div class="sect4">
<h5 id="nameddomainobjectcontainer"><a class="anchor" href="#nameddomainobjectcontainer"></a><a class="link" href="#nameddomainobjectcontainer">NamedDomainObjectContainer</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/NamedDomainObjectContainer.html">NamedDomainObjectContainer</a> manages a set of objects, where each element has a name associated with it.
The container takes care of creating and configuring the elements, and provides a DSL that build scripts can use to define and configure elements.
It is intended to hold objects which are themselves configurable, for example a set of custom Gradle objects.</p>
</div>
<div class="paragraph">
<p>Gradle uses <code>NamedDomainObjectContainer</code> type extensively throughout the API.
For example, the <code>project.tasks</code> object used to manage the tasks of a project is a <code>NamedDomainObjectContainer&lt;Task&gt;</code>.</p>
</div>
<div class="paragraph">
<p>You can create a container instance using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html">ObjectFactory</a> service, which provides the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#domainObjectContainer-java.lang.Class-">ObjectFactory.domainObjectContainer()</a> method.
This is also available using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Project.html#container-java.lang.Class-">Project.container()</a> method, however in a custom Gradle type it&#8217;s
generally better to use the injected <code>ObjectFactory</code> service instead of passing around a <code>Project</code> instance.</p>
</div>
<div class="paragraph">
<p>You can also create a container instance using a <a href="#read_only_managed_properties">read-only managed property</a>, described above.</p>
</div>
<div class="paragraph">
<p>In order to use a type with any of the <code>domainObjectContainer()</code> methods, it must expose a property named &#8220;name&#8221; as the unique, and constant, name for the object.
The <code>domainObjectContainer(Class)</code> variant of the method creates new instances by calling the constructor of the class that takes a string argument, which is the desired name of the object.
Objects created this way are treated as custom Gradle types, and so can make use of the features discussed in this chapter, for example service injection or managed properties.</p>
</div>
<div class="paragraph">
<p>See the above link for <code>domainObjectContainer()</code> method variants that allow custom instantiation strategies.</p>
</div>
<div class="exampleblock">
<div class="title">Example 510. Managing a collection of objects</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.gradle.api.NamedDomainObjectContainer</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DownloadExtension</span> {
    <span class="comment">// A container of `Resource` objects</span>
    <span class="directive">private</span> <span class="directive">final</span> NamedDomainObjectContainer&lt;Resource&gt; resources;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> DownloadExtension(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use an injected ObjectFactory to create a container</span>
        resources = objectFactory.domainObjectContainer(Resource.class);
    }

    <span class="directive">public</span> NamedDomainObjectContainer&lt;Resource&gt; getResources() {
        <span class="keyword">return</span> resources;
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Resource</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">URI</span> uri;
    <span class="directive">private</span> <span class="predefined-type">String</span> userName;

    <span class="comment">// Type must have a public constructor that takes the element name as a parameter</span>
    <span class="directive">public</span> Resource(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="comment">// Type must have a 'name' property, which should be read-only</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="predefined-type">URI</span> getUri() {
        <span class="keyword">return</span> uri;
    }
    <span class="directive">public</span> <span class="type">void</span> setUri(<span class="predefined-type">URI</span> uri) {
        <span class="local-variable">this</span>.uri = uri;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getUserName() {
        <span class="keyword">return</span> userName;
    }
    <span class="directive">public</span> <span class="type">void</span> setUserName(<span class="predefined-type">String</span> userName) {
        <span class="local-variable">this</span>.userName = userName;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import javax.inject.Inject
import org.gradle.api.model.ObjectFactory
import org.gradle.api.NamedDomainObjectContainer

open class DownloadExtension @Inject constructor(objectFactory: ObjectFactory) {
    // Use an injected ObjectFactory to create a container of `Resource` objects
    val resources = objectFactory.domainObjectContainer(Resource::class.java)
}

// Type must have a public constructor that takes the element name as a parameter
// Type must have a 'name' property, which should be read-only
open class Resource(val name: String) {
    var uri: URI? = null
    var userName: String? = null
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">DownloadExtension.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.gradle.api.NamedDomainObjectContainer</span>
<span class="keyword">import</span> <span class="include">org.gradle.api.model.ObjectFactory</span>

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="type">class</span> <span class="class">DownloadExtension</span> {
    <span class="comment">// A container of `Resource` instances</span>
    <span class="directive">final</span> NamedDomainObjectContainer&lt;Resource&gt; resources

    <span class="annotation">@Inject</span>
    DownloadExtension(<span class="predefined-type">ObjectFactory</span> objectFactory) {
        <span class="comment">// Use an injected ObjectFactory to create a container</span>
        resources = objectFactory.domainObjectContainer(Resource)
    }
}

<span class="type">class</span> <span class="class">Resource</span> {
    <span class="comment">// Type must have a 'name' property, which should be read-only</span>
    <span class="directive">final</span> <span class="predefined-type">String</span> name
    <span class="predefined-type">URI</span> uri
    <span class="predefined-type">String</span> userName

    <span class="comment">// Type must have a public constructor that takes the element name as a parameter</span>
    Resource(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For each container property, Gradle automatically adds a block to the Groovy and Kotlin DSL that you can use to configure the
contents of the container:</p>
</div>
<div class="exampleblock">
<div class="title">Example 511. Configure block</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;org.gradle.sample.download&quot;)
}

download {
    // Can use a block to configure the container contents
    resources {
        register(&quot;gradle&quot;) {
            uri = uri(&quot;https://gradle.org&quot;)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.sample.download</span><span class="delimiter">&quot;</span></span>)
}

download {
    <span class="comment">// Can use a block to configure the container contents</span>
    resources {
        gradle {
            uri = uri(<span class="string"><span class="delimiter">'</span><span class="content">https://gradle.org</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="extensiblepolymorphicdomainobjectcontainer"><a class="anchor" href="#extensiblepolymorphicdomainobjectcontainer"></a><a class="link" href="#extensiblepolymorphicdomainobjectcontainer">ExtensiblePolymorphicDomainObjectContainer</a></h5>
<div class="paragraph">
<p>An <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/ExtensiblePolymorphicDomainObjectContainer.html">ExtensiblePolymorphicDomainObjectContainer</a> is a <code>NamedDomainObjectContainer</code> that allows you to
define instantiation strategies for different types of objects.</p>
</div>
<div class="paragraph">
<p>You can create an instance using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#polymorphicDomainObjectContainer-java.lang.Class-">ObjectFactory.polymorphicDomainObjectContainer()</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="nameddomainobjectset"><a class="anchor" href="#nameddomainobjectset"></a><a class="link" href="#nameddomainobjectset">NamedDomainObjectSet</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/NamedDomainObjectSet.html">NamedDomainObjectSet</a> holds a set of configurable objects, where each element has a name associated with it.
This is similar to <code>NamedDomainObjectContainer</code>, however a <code>NamedDomainObjectSet</code> doesn&#8217;t manage the objects in the collection. They need to be created and added manually.</p>
</div>
<div class="paragraph">
<p>You can create an instance using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#namedDomainObjectSet-java.lang.Class-">ObjectFactory.namedDomainObjectSet()</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="nameddomainobjectlist"><a class="anchor" href="#nameddomainobjectlist"></a><a class="link" href="#nameddomainobjectlist">NamedDomainObjectList</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/NamedDomainObjectList.html">NamedDomainObjectList</a> holds a list of configurable objects, where each element has a name associated with it.
This is similar to <code>NamedDomainObjectContainer</code>, however a <code>NamedDomainObjectList</code> doesn&#8217;t manage the objects in the collection. They need to be created and added manually.</p>
</div>
<div class="paragraph">
<p>You can create an instance using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#namedDomainObjectList-java.lang.Class-">ObjectFactory.namedDomainObjectList()</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="domainobjectset"><a class="anchor" href="#domainobjectset"></a><a class="link" href="#domainobjectset">DomainObjectSet</a></h5>
<div class="paragraph">
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/DomainObjectSet.html">DomainObjectSet</a> simply holds a set of configurable objects.
Compared to <code>NamedDomainObjectContainer</code>, a <code>DomainObjectSet</code> doesn&#8217;t manage the objects in the collection. They need to be created and added manually.</p>
</div>
<div class="paragraph">
<p>You can create an instance using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/model/ObjectFactory.html#domainObjectSet-java.lang.Class-">ObjectFactory.domainObjectSet()</a> method.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_gradle_plugin"><a class="anchor" href="#java_gradle_plugin"></a><a class="link" href="#java_gradle_plugin">Gradle Plugin Development Plugin</a></h3>
<div class="paragraph">
<p>The Java Gradle Plugin development plugin can be used to assist in the development of Gradle plugins. It automatically applies the <a href="#">Java Library</a> plugin, adds the <code>gradleApi()</code> dependency to the <code>api</code> configuration and performs validation of plugin metadata during <code>jar</code> task execution.</p>
</div>
<div class="paragraph">
<p>The plugin also integrates with <a href="#test_kit">TestKit</a>, a library that aids in writing and executing functional tests for plugin code. It automatically adds the <code>gradleTestKit()</code> dependency to the <code>testImplementation</code> configuration and generates a plugin classpath manifest file consumed by a <code>GradleRunner</code> instance if found. Please refer to <a href="#sub:test-kit-automatic-classpath-injection">Automatic classpath injection with the Plugin Development Plugin</a> for more on its usage, configuration options and samples.</p>
</div>
<div class="sect3">
<h4 id="sec:gradle_plugin_dev_usage"><a class="anchor" href="#sec:gradle_plugin_dev_usage"></a><a class="link" href="#sec:gradle_plugin_dev_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java Gradle Plugin Development plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 512. Using the Java Gradle Plugin Development plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-gradle-plugin</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-gradle-plugin`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Applying the plugin automatically applies the <a href="#">Java Library</a> plugin and adds the <code>gradleApi()</code> dependency to the <code>api</code> configuration. It also adds some validations to the build.</p>
</div>
<div class="paragraph">
<p>The following validations are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a plugin descriptor defined for the plugin.</p>
</li>
<li>
<p>The plugin descriptor contains an <code>implementation-class</code> property.</p>
</li>
<li>
<p>The <code>implementation-class</code> property references a valid class file in the jar.</p>
</li>
<li>
<p>Each property getter or the corresponding field must be annotated with a property annotation like <code>@InputFile</code> and <code>@OutputDirectory</code>. Properties that don&#8217;t participate in up-to-date checks should be annotated with <code>@Internal</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any failed validations will result in a warning message.</p>
</div>
<div class="paragraph">
<p>For each plugin you are developing, add an entry to the <code>gradlePlugin {}</code> script block:</p>
</div>
<div class="exampleblock">
<div class="title">Example 513. Using the gradlePlugin {} block.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradlePlugin {
    plugins {
        simplePlugin {
            id = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.simple-plugin</span><span class="delimiter">'</span></span>
            implementationClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.SimplePlugin</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradlePlugin {
    plugins {
        create(&quot;simplePlugin&quot;) {
            id = &quot;org.gradle.sample.simple-plugin&quot;
            implementationClass = &quot;org.gradle.sample.SimplePlugin&quot;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>gradlePlugin {}</code> block defines the plugins being built by the project including the <code>id</code> and <code>implementationClass</code> of the plugin. From this data about the plugins being developed, Gradle can automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate the plugin descriptor in the <code>jar</code> file&#8217;s <code>META-INF</code> directory.</p>
</li>
<li>
<p>Configure the <a href="#publishing_maven">Maven</a> or <a href="#publishing_ivy">Ivy Publish Plugins</a> publishing plugins to publish a <a href="#sec:plugin_markers">Plugin Marker Artifact</a> for each plugin.</p>
</li>
<li>
<p>Moreover, if the <a href="https://plugins.gradle.org/docs/publish-plugin">Plugin Publishing Plugin</a> is applied, it will publish each plugin using the same name, plugin id, display name, and description to the Gradle Plugin Portal (see <a href="https://guides.gradle.org/publishing-plugins-to-gradle-plugin-portal/">Publishing Plugins to Gradle Plugin Portal</a> for details).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:reference"><a class="anchor" href="#part:reference"></a><a class="link" href="#part:reference">Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="groovy_build_script_primer"><a class="anchor" href="#groovy_build_script_primer"></a><a class="link" href="#groovy_build_script_primer">A Groovy Build Script Primer</a></h3>
<div class="paragraph">
<p>Ideally, a Groovy build script looks mostly like configuration: setting some properties of the project, configuring dependencies, declaring tasks, and so on. That configuration is based on Groovy language constructs. This primer aims to explain what those constructs are and most importantly how they relate to Gradle&#8217;s API documentation.</p>
</div>
<div class="sect3">
<h4 id="groovy:project_object"><a class="anchor" href="#groovy:project_object"></a><a class="link" href="#groovy:project_object">The <code>Project</code> object</a></h4>
<div class="paragraph">
<p>As Groovy is an object-oriented language based on Java, its properties and methods apply to objects. In some cases, the object is implicit  particularly at the top level of a build script, i.e. not nested inside a <code>{}</code> block.</p>
</div>
<div class="paragraph">
<p>Consider this fragment of build script, which contains an unqualified property and block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.GA</span><span class="delimiter">'</span></span>

configurations {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>version</code> and <code>configurations {}</code> are part of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">org.gradle.api.Project</a>.</p>
</div>
<div class="paragraph">
<p>This example reflects how every Groovy build script is backed by an implicit instance of <code>Project</code>. If you see an unqualified element and you don&#8217;t know where it&#8217;s defined, always check the <code>Project</code> API documentation to see if that&#8217;s where it&#8217;s coming from.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid using <a href="https://groovy-lang.org/metaprogramming.html#_metaclasses">Groovy MetaClass</a> programming techniques in your build scripts. Gradle provides its own API for adding <a href="#sec:extra_properties">dynamic runtime properties</a>.</p>
</div>
<div class="paragraph">
<p>Use of Groovy-specific metaprogramming can cause builds to retain large amounts of memory between builds that will eventually cause the Gradle daemon to run out-of-memory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy:properties"><a class="anchor" href="#groovy:properties"></a><a class="link" href="#groovy:properties">Properties</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt;                <span class="comment">// Get a property value</span>
&lt;obj&gt;.&lt;name&gt; = &lt;value&gt;      <span class="comment">// Set a property to a new value</span>
<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="content">&lt;name&gt;</span><span class="delimiter">&quot;</span></span>                   <span class="comment">// Embed a property value in a string</span>
<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>&lt;obj&gt;.&lt;name&gt;<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>           <span class="comment">// Same as previous (embedded value)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span>
myCopyTask.description = <span class="string"><span class="delimiter">'</span><span class="content">Copies some files</span><span class="delimiter">'</span></span>

file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/classes</span><span class="delimiter">&quot;</span></span>)
println <span class="string"><span class="delimiter">&quot;</span><span class="content">Destination: </span><span class="inline"><span class="inline-delimiter">${</span>myCopyTask.destinationDir<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A property represents some state of an object. The presence of an <code>=</code> sign is a clear indicator that you&#8217;re looking at a property. Otherwise, a qualified name  it begins with <code>&lt;obj&gt;.</code> without any other decoration is also a property.</p>
</div>
<div class="paragraph">
<p>If the name is unqualified, then it may be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A task instance with that name.</p>
</li>
<li>
<p>A property on <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a>.</p>
</li>
<li>
<p>An <a href="#sec:extra_properties">extra property</a> defined elsewhere in the project.</p>
</li>
<li>
<p>A property of an implicit object within a <a href="#groovy:blocks">block</a>.</p>
</li>
<li>
<p>A <a href="#groovy:local_variables">local variable</a> defined earlier in the build script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that plugins can add their own properties to the <code>Project</code> object. The <a href="https://docs.gradle.org/6.4.1/dsl/">API documentation</a> lists all the properties added by core plugins. If you&#8217;re struggling to find where a property comes from, check the documentation for the plugins that the build uses.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When referencing a project property in your build script that is added by a non-core plugin, consider prefixing it with <code>project.</code> it&#8217;s clear then that the property belongs to the project object.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="properties_in_the_api_documentation"><a class="anchor" href="#properties_in_the_api_documentation"></a><a class="link" href="#properties_in_the_api_documentation">Properties in the API documentation</a></h5>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/">Groovy DSL reference</a> shows properties as they are used in your build scripts, but the Javadocs only display methods. That&#8217;s because properties are implemented as methods behind the scenes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A property can be <em>read</em> if there is a method named <code>get&lt;PropertyName&gt;</code> with zero arguments that returns the same type as the property.</p>
</li>
<li>
<p>A property can be <em>modified</em> if there is a method named <code>set&lt;PropertyName&gt;</code> with one argument that has the same type as the property and a return type of <code>void</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that property names usually start with a lower-case letter, but that letter is upper case in the method names. So the getter method <code>getProjectVersion()</code> corresponds to the property <code>projectVersion</code>. This convention does not apply when the name begins with at least two upper-case letters, in which case there is not change in case. For example, <code>getRAM()</code> corresponds to the property <code>RAM</code>.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">project.getVersion()
project.version

project.setVersion(<span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span>)
project.version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.1</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy:methods"><a class="anchor" href="#groovy:methods"></a><a class="link" href="#groovy:methods">Methods</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt;()              <span class="comment">// Method call with no arguments</span>
&lt;obj&gt;.&lt;name&gt;(&lt;arg&gt;, &lt;arg&gt;)  <span class="comment">// Method call with multiple arguments</span>
&lt;obj&gt;.&lt;name&gt; &lt;arg&gt;, &lt;arg&gt;   <span class="comment">// Method call with multiple args (no parentheses)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myCopyTask.include <span class="string"><span class="delimiter">'</span><span class="content">**/*.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">**/*.properties</span><span class="delimiter">'</span></span>

ext.resourceSpec = copySpec()   <span class="comment">// `copySpec()` comes from `Project`</span>

file(<span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span>)
println <span class="string"><span class="delimiter">'</span><span class="content">Hello, World!</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A method represents some behavior of an object, although Gradle often uses methods to configure the state of objects as well. Methods are identifiable by their arguments or empty parentheses. Note that parentheses are sometimes required, such as when a method has zero arguments, so you may find it simplest to always use parentheses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gradle has a convention whereby if a method has the same name as a collection-based property, then the method <em>appends</em> its values to that collection.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy:blocks"><a class="anchor" href="#groovy:blocks"></a><a class="link" href="#groovy:blocks">Blocks</a></h4>
<div class="paragraph">
<p>Blocks are also <a href="#groovy:methods">methods</a>, just with specific types for the last argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;obj&gt;.&lt;name&gt; {
     ...
}

&lt;obj&gt;.&lt;name&gt;(&lt;arg&gt;, &lt;arg&gt;) {
     ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    assets
}

sourceSets {
    main {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>]
        }
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:util</span><span class="delimiter">'</span></span>) {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Blocks are a mechanism for configuring multiple aspects of a build element in one go. They also provide a way to nest configuration, leading to a form of structured data.</p>
</div>
<div class="paragraph">
<p>There are two important aspects of blocks that you should understand:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They are implemented as methods with specific signatures.</p>
</li>
<li>
<p>They can change the target ("delegate") of unqualified methods and properties.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both are based on Groovy language features and we explain them in the following sections.</p>
</div>
<div class="sect4">
<h5 id="block_method_signatures"><a class="anchor" href="#block_method_signatures"></a><a class="link" href="#block_method_signatures">Block method signatures</a></h5>
<div class="paragraph">
<p>You can easily identify a method as the implementation behind a block by its signature, or more specifically, its argument types. If a method corresponds to a block:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must have at least one argument.</p>
</li>
<li>
<p>The <em>last</em> argument must be of type <a href="https://docs.groovy-lang.org/latest/html/gapi/groovy/lang/Closure.html"><code>groovy.lang.Closure</code></a> or <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/Action.html">org.gradle.api.Action</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">Project.copy(Action)</a> matches these requirements, so you can use the syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">copy {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">custom-resources</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That leads to the question of how <code>into()</code> and <code>from()</code> work. They&#8217;re clearly methods, but where would you find them in the API documentation? The answer comes from understanding object <em>delegation</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="delegation"><a class="anchor" href="#delegation"></a><a class="link" href="#delegation">Delegation</a></h5>
<div class="paragraph">
<p>The <a href="#groovy:properties">section on properties</a> lists where unqualified properties might be found. One common place is on the <code>Project</code> object. But there is an alternative source for those unqualified properties and methods inside a block: the block&#8217;s <em>delegate object</em>.</p>
</div>
<div class="paragraph">
<p>To help explain this concept, consider the last example from the previous section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">copy {
    into <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">custom-resources</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the methods and properties in this example are unqualified. You can easily find <code>copy()</code> and <code>buildDir</code> in the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html"><code>Project</code> API documentation</a>, but what about <code>into()</code> and <code>from()</code>? These are resolved against the delegate of the <code>copy {}</code> block. What is the type of that delegate? You&#8217;ll need to <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:copy(org.gradle.api.Action)">check the API documentation for that</a>.</p>
</div>
<div class="paragraph">
<p>There are two ways to determine the delegate type, depending on the signature of the block method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>Action</code> arguments, look at the type&#8217;s parameter.</p>
<div class="paragraph">
<p>In the example above, the method signature is <code>copy(Action&lt;? super CopySpec&gt;)</code> and it&#8217;s the bit inside the angle brackets that tells you the delegate type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> in this case.</p>
</div>
</li>
<li>
<p>For <code>Closure</code> arguments, the documentation will explicitly say in the description what type is being configured or what type the delegate it (different terminology for the same thing).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hence you can find both <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#into-java.lang.Object-">into()</a> and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html#from-java.lang.Object...-">from()</a> on <code>CopySpec</code>. You might even notice that both of those methods have variants that take an <code>Action</code> as their last argument, which means you can use block syntax with them.</p>
</div>
<div class="paragraph">
<p>All new Gradle APIs declare an <code>Action</code> argument type rather than <code>Closure</code>, which makes it very easy to pick out the delegate type. Even older APIs have an <code>Action</code> variant in addition to the old <code>Closure</code> one.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy:local_variables"><a class="anchor" href="#groovy:local_variables"></a><a class="link" href="#groovy:local_variables">Local variables</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> &lt;name&gt; = &lt;value&gt;        <span class="comment">// Untyped variable</span>
&lt;type&gt; &lt;name&gt; = &lt;value&gt;     <span class="comment">// Typed variable</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> i = <span class="integer">1</span>
<span class="predefined-type">String</span> errorMsg = <span class="string"><span class="delimiter">'</span><span class="content">Failed, because reasons</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Local variables are a Groovy construct  unlike <a href="#sec:extra_properties">extra properties</a> that can be used to share values within a build script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid using local variables in the root of the project, i.e. as pseudo project properties. They cannot be read outside of the build script and Gradle has no knowledge of them.</p>
</div>
<div class="paragraph">
<p>Within a narrower context such as configuring a task  local variables can occasionally be helpful.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kotlin_dsl"><a class="anchor" href="#kotlin_dsl"></a><a class="link" href="#kotlin_dsl">Gradle Kotlin DSL Primer</a></h3>
<div class="paragraph">
<p>Gradle&#8217;s Kotlin DSL provides an alternative syntax to the traditional Groovy DSL with an enhanced editing experience in supported IDEs, with superior content assist, refactoring, documentation, and more.
This chapter provides details of the main Kotlin DSL constructs and how to use it to interact with the Gradle API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are interested in migrating an existing Gradle build to the Kotlin DSL, please also check out the dedicated <a href="https://guides.gradle.org/migrating-build-logic-from-groovy-to-kotlin/">migration guide</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="kotdsl:prerequisites"><a class="anchor" href="#kotdsl:prerequisites"></a><a class="link" href="#kotdsl:prerequisites">Prerequisites</a></h4>
<div class="ulist">
<ul>
<li>
<p>The embedded Kotlin compiler is known to work on Linux, macOS, Windows, Cygwin, FreeBSD and Solaris on x86-64 architectures.</p>
</li>
<li>
<p>Knowledge of Kotlin syntax and basic language features is very helpful. The <a href="https://kotlinlang.org/docs/reference/">Kotlin reference documentation</a> and <a href="https://kotlinlang.org/docs/tutorials/koans.html">Kotlin Koans</a> will help you to learn the basics.</p>
</li>
<li>
<p>Use of the <a href="#sec:plugins_block">plugins {}</a> block to declare Gradle plugins significantly improves the editing experience and is highly recommended.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:ide_support"><a class="anchor" href="#sec:ide_support"></a><a class="link" href="#sec:ide_support">IDE support</a></h4>
<div class="paragraph">
<p>The Kotlin DSL is fully supported by IntelliJ IDEA and Android Studio. Other IDEs do not yet provide helpful tools for editing Kotlin DSL files, but you can still import Kotlin-DSL-based builds and work with them as usual.</p>
</div>
<table class="tableblock frame-none grid-rows stretch">
<caption class="title">Table 20. IDE support matrix</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-middle"></th>
<th class="tableblock halign-center valign-middle">Build import</th>
<th class="tableblock halign-center valign-middle">Syntax highlighting <sup>1</sup></th>
<th class="tableblock halign-center valign-middle">Semantic editor <sup>2</sup></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">IntelliJ IDEA</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Android Studio</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Eclipse IDE</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">CLion</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Apache NetBeans</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Visual Studio Code <sup>(LSP)</sup></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-middle"><p class="tableblock">Visual Studio</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="green"><strong></strong></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="red"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>1</sup> <sup>Kotlin</sup> <sup>syntax</sup> <sup>highlighting</sup> <sup>in</sup> <sup>Gradle</sup> <sup>Kotlin</sup> <sup>DSL</sup> <sup>scripts</sup><br>
<sup>2</sup> <sup>code</sup> <sup>completion,</sup> <sup>navigation</sup> <sup>to</sup> <sup>sources,</sup> <sup>documentation,</sup> <sup>refactorings</sup> <sup>etc&#8230;&#8203;</sup> <sup>in</sup> <sup>Gradle</sup> <sup>Kotlin</sup> <sup>DSL</sup> <sup>scripts</sup></p>
</div>
<div class="paragraph">
<p>As mentioned in the limitations, you must <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import">import your project from the Gradle model</a> to get content-assist and refactoring tools for Kotlin DSL scripts in IntelliJ IDEA.</p>
</div>
<div class="paragraph">
<p>In addition, IntelliJ IDEA and Android Studio might spawn up to 3 Gradle daemons when editing Gradle scripts  one for each type of script: build scripts, settings files and initialization scripts.
Builds with slow configuration time might affect the IDE responsiveness, so please check out the <a href="https://guides.gradle.org/performance/#configuration">performance guide</a> to help resolve such issues.</p>
</div>
<div class="sect4">
<h5 id="automatic_build_import_vs_automatic_reloading_of_script_dependencies"><a class="anchor" href="#automatic_build_import_vs_automatic_reloading_of_script_dependencies"></a><a class="link" href="#automatic_build_import_vs_automatic_reloading_of_script_dependencies">Automatic build import vs. automatic reloading of script dependencies</a></h5>
<div class="paragraph">
<p>Both IntelliJ IDEA and Android Studio which is derived from IntelliJ IDEA  will detect when you make changes to your build logic and offer two suggestions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the whole build again</p>
<div class="imageblock">
<div class="content">
<img src="img/intellij-build-import-popup.png" alt="IntelliJ IDEA" width="300">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/android-studio-build-sync-popup.png" alt="IntelliJ IDEA">
</div>
</div>
</li>
<li>
<p>Reload script dependencies when editing a build script</p>
<div class="imageblock">
<div class="content">
<img src="img/intellij-script-dependencies-reload.png" alt="Reload script dependencies">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We recommend that you <em>disable automatic build import</em>, but <em>enable automatic reloading of script dependencies</em>.
That way you get early feedback while editing Gradle scripts and control over when the whole build setup gets synchronized with your IDE.</p>
</div>
</div>
<div class="sect4">
<h5 id="troubleshooting_2"><a class="anchor" href="#troubleshooting_2"></a><a class="link" href="#troubleshooting_2">Troubleshooting</a></h5>
<div class="paragraph">
<p>The IDE support is provided by two components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kotlin Plugin used by IntelliJ IDEA/Android Studio</p>
</li>
<li>
<p>Gradle</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The level of support varies based on the versions of each.</p>
</div>
<div class="paragraph">
<p>If you run into trouble, the first thing you should try is running <code>./gradlew tasks</code> from the command line to see whether your issue is limited to the IDE. If you encounter the same problem from the command line, then the issue is with the build rather than the IDE integration.</p>
</div>
<div class="paragraph">
<p>If you can run the build successfully from the command line but your script editor is complaining, then you should try restarting your IDE and invalidating its caches.</p>
</div>
<div class="paragraph">
<p>If the above doesn&#8217;t work and you suspect an issue with the Kotlin DSL script editor, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>./gradle tasks</code> to get more details</p>
</li>
<li>
<p>Check the logs in one of these locations:</p>
<div class="ulist">
<ul>
<li>
<p><code>$HOME/Library/Logs/gradle-kotlin-dsl</code> on Mac OS X</p>
</li>
<li>
<p><code>$HOME/.gradle-kotlin-dsl/logs</code> on Linux</p>
</li>
<li>
<p><code>$HOME/AppData/Local/gradle-kotlin-dsl/log</code> on Windows</p>
</li>
</ul>
</div>
</li>
<li>
<p>Open an issue on the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>, including as much detail as you can.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From version 5.1 onwards, the log directory is cleaned up automatically.
It is checked periodically (at most every 24 hours) and log files are deleted if they havent been used for 7 days.</p>
</div>
<div class="paragraph">
<p>If the above isn&#8217;t enough to pinpoint the problem, you can enable the <code>org.gradle.kotlin.dsl.logging.tapi</code> system property in your IDE. This will cause the Gradle Daemon to log extra information in its log file located in <code>$HOME/.gradle/daemon</code>. In IntelliJ IDEA this can be done by opening <code>Help &gt; Edit Custom VM Options&#8230;&#8203;</code> and adding <code>-Dorg.gradle.kotlin.dsl.logging.tapi=true</code>.</p>
</div>
<div class="paragraph">
<p>For IDE problems outside of the Kotlin DSL script editor, please open issues in the corresponding IDE&#8217;s issue tracker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="">JetBrains&#8217;s IDEA issue tracker</a>,</p>
</li>
<li>
<p><a href="">Google&#8217;s Android Studio issue tracker</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lastly, if you face problems with Gradle itself or with the Kotlin DSL, please open issues on the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scripts"><a class="anchor" href="#sec:scripts"></a><a class="link" href="#sec:scripts">Kotlin DSL scripts</a></h4>
<div class="paragraph">
<p>Just like the Groovy-based equivalent, the Kotlin DSL is implemented on top of Gradle&#8217;s Java API.
Everything you can read in a Kotlin DSL script is Kotlin code compiled and executed by Gradle.
Many of the objects, functions and properties you use in your build scripts come from the Gradle API and the APIs of the applied plugins.</p>
</div>
<div class="sect4">
<h5 id="script_file_names"><a class="anchor" href="#script_file_names"></a><a class="link" href="#script_file_names">Script file names</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Groovy DSL script files use the <code>.gradle</code> file name extension.</p>
</div>
<div class="paragraph">
<p>Kotlin DSL script files use the <code>.gradle.kts</code> file name extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To activate the Kotlin DSL, simply use the <code>.gradle.kts</code> extension for your build scripts in place of <code>.gradle</code>. That also applies to the <a href="#sec:settings_file">settings file</a>  for example <code>settings.gradle.kts</code>  and <a href="#init_scripts">initialization scripts</a>.</p>
</div>
<div class="paragraph">
<p>Note that you can mix Groovy DSL build scripts with Kotlin DSL ones, i.e. a Kotlin DSL build script can apply a Groovy DSL one and each project in a multi-project build can use either one.</p>
</div>
<div class="paragraph">
<p>We recommend that you apply the following conventions to get better IDE support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name settings scripts (or any script that is backed by a Gradle <code>Settings</code> object) according to the pattern <code>*.settings.gradle.kts</code> this includes script plugins that are applied from settings scripts</p>
</li>
<li>
<p>Name <a href="#init_scripts">initialization scripts</a> according to the pattern <code>*.init.gradle.kts</code> or simply <code>init.gradle.kts</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is so that the IDE knows what type of object "backs" the script, be it <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html">Project</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.initialization.Settings.html">Settings</a> or <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.invocation.Gradle.html">Gradle</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:implicit_imports"><a class="anchor" href="#sec:implicit_imports"></a><a class="link" href="#sec:implicit_imports">Implicit imports</a></h5>
<div class="paragraph">
<p>All Kotlin DSL build scripts have implicit imports consisting of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="#script-default-imports">default Gradle API imports</a></p>
</li>
<li>
<p>The Kotlin DSL API, which is all types within the <code>org.gradle.kotlin.dsl</code> and <code>org.gradle.kotlin.dsl.plugins.dsl</code> packages currently</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="title">Avoid using internal Kotlin DSL APIs</div>
<div class="paragraph">
<p>Use of internal Kotlin DSL APIs in plugins and build scripts has the potential to break builds when either Gradle or plugins change.
The <a href="https://gradle.github.io/kotlin-dsl-docs/api/">Kotlin DSL API</a> extends the <a href="#sec:avoiding_gradle_internal_apis">Gradle public API</a> with the types listed in the <a href="https://gradle.github.io/kotlin-dsl-docs/api/">corresponding API docs</a> that are in the <code>org.gradle.kotlin.dsl</code> or <code>org.gradle.kotlin.dsl.plugins.dsl</code> packages (but not subpackages of those).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type-safe-accessors"><a class="anchor" href="#type-safe-accessors"></a><a class="link" href="#type-safe-accessors">Type-safe model accessors</a></h4>
<div class="paragraph">
<p>The Groovy DSL allows you to reference many elements of the build model by name, even when they are defined at runtime. Think named configurations, named source sets, and so on. For example, you can get hold of the <code>implementation</code> configuration via <code>configurations.implementation</code>.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL replaces such dynamic resolution with type-safe model accessors that work with model elements contributed by plugins.</p>
</div>
<div class="sect4">
<h5 id="kotdsl:accessor_applicability"><a class="anchor" href="#kotdsl:accessor_applicability"></a><a class="link" href="#kotdsl:accessor_applicability">Understanding when type-safe model accessors are available</a></h5>
<div class="paragraph">
<p>The Kotlin DSL currently supports type-safe model accessors for any of the following that are contributed by plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency and artifact configurations (such as <code>implementation</code> and <code>runtimeOnly</code> contributed by the Java Plugin)</p>
</li>
<li>
<p>Project extensions and conventions (such as <code>sourceSets</code>)</p>
</li>
<li>
<p>Elements in the <code>tasks</code> and <code>configurations</code> containers</p>
</li>
<li>
<p>Elements in <a href="#kotdsl:containers">project-extension containers</a> (for example the source sets contributed by the Java Plugin that are added to the <code>sourceSets</code> container)</p>
</li>
<li>
<p>Extensions on each of the above</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only the main project build scripts and precompiled project script plugins have type-safe model accessors.
Initialization scripts, settings scripts, script plugins do not.
These limitations will be removed in a future Gradle release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The set of type-safe model accessors available is calculated right before evaluating the script body, immediately after the <code>plugins {}</code> block.
Any model elements contributed after that point do not work with type-safe model accessors.
For example, this includes any configurations you might define in your own build script.
However, this approach does mean that you can use type-safe accessors for any model elements that are contributed by plugins that are <em>applied by parent projects</em>.</p>
</div>
<div class="paragraph">
<p>The following project build script demonstrates how you can access various configurations, extensions and other elements using type-safe accessors:</p>
</div>
<div class="exampleblock">
<div class="title">Example 514. Using type-safe model accessors</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

dependencies {                              // <b class="conum">(1)</b>
    api(&quot;junit:junit:4.12&quot;)
    implementation(&quot;junit:junit:4.12&quot;)
    testImplementation(&quot;junit:junit:4.12&quot;)
}

configurations {                            // <b class="conum">(1)</b>
    implementation {
        resolutionStrategy.failOnVersionConflict()
    }
}

sourceSets {                                // <b class="conum">(2)</b>
    main {                                  // <b class="conum">(3)</b>
        java.srcDir(&quot;src/core/java&quot;)
    }
}

java {                                      // <b class="conum">(4)</b>
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

tasks {
    test {                                  // <b class="conum">(5)</b>
        testLogging.showExceptions = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Uses type-safe accessors for the <code>api</code>, <code>implementation</code> and <code>testImplementation</code> dependency configurations contributed by the <a href="#java_library_plugin">Java Library Plugin</a></p>
</li>
<li>
<p>Uses an accessor to configure the <code>sourceSets</code> project extension</p>
</li>
<li>
<p>Uses an accessor to configure the <code>main</code> source set</p>
</li>
<li>
<p>Uses an accessor to configure the <code>java</code> source for the <code>main</code> source set</p>
</li>
<li>
<p>Uses an accessor to configure the <code>test</code> task</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your IDE knows about the type-safe accessors, so it will include them in its suggestions.
This will happen both at the top level of your build scripts  most plugin extensions are added to the <code>Project</code> object  and within the blocks that configure an extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that accessors for elements of containers such as <code>configurations</code>, <code>tasks</code> and <code>sourceSets</code> leverage Gradle&#8217;s <a href="#lazy_configuration">configuration avoidance APIs</a>.
For example, on <code>tasks</code> they are of type <code>TaskProvider&lt;T&gt;</code> and provide a lazy reference and lazy configuration of the underlying task.
Here are some examples that illustrate the situations in which configuration avoidance applies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    // lazy configuration
}

// Lazy reference
val testProvider: TaskProvider&lt;Test&gt; = tasks.test

testProvider {
    // lazy configuration
}

// Eagerly realized Test task, defeat configuration avoidance if done out of a lazy context
val test: Test = tasks.test.get()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For all other containers than <code>tasks</code>, accessors for elements are of type <code>NamedDomainObjectProvider&lt;T&gt;</code> and provide the same behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_using_standard_api"><a class="anchor" href="#sec:kotlin_using_standard_api"></a><a class="link" href="#sec:kotlin_using_standard_api">Understanding what to do when type-safe model accessors are not available</a></h5>
<div class="paragraph">
<p>Consider the sample build script shown above that demonstrates the use of type-safe accessors.
The following sample is exactly the same except that is uses the <code>apply()</code> method to apply the plugin.
The build script can not use type-safe accessors in this case because the <code>apply()</code> call happens in the body of the build script.
You have to use other techniques instead, as demonstrated here:</p>
</div>
<div class="exampleblock">
<div class="title">Example 515. Configuring plugins without type-safe accessors</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

dependencies {
    &quot;api&quot;(&quot;junit:junit:4.12&quot;)
    &quot;implementation&quot;(&quot;junit:junit:4.12&quot;)
    &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)
}

configurations {
    &quot;implementation&quot; {
        resolutionStrategy.failOnVersionConflict()
    }
}

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}

configure&lt;JavaPluginConvention&gt; {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

tasks {
    named&lt;Test&gt;(&quot;test&quot;) {
        testLogging.showExceptions = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Type-safe accessors are unavailable for model elements contributed by the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plugins applied via the <code>apply(plugin = "id")</code> method</p>
</li>
<li>
<p>The project build script</p>
</li>
<li>
<p>Script plugins, via <code>apply(from = "script-plugin.gradle.kts")</code></p>
</li>
<li>
<p>Plugins applied via <a href="#sec:kotlin_cross_project_configuration">cross-project configuration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You also can not use type-safe accessors in Binary Gradle plugins implemented in Kotlin.</p>
</div>
<div class="paragraph">
<p>If you can&#8217;t find a type-safe accessor, <em>fall back to using the normal API</em> for the corresponding types.
To do that, you need to know the names and/or types of the configured model elements.
We&#8217;ll now show you how those can be discovered by looking at the above script in detail.</p>
</div>
<div class="sect5">
<h6 id="artifact_configurations"><a class="anchor" href="#artifact_configurations"></a><a class="link" href="#artifact_configurations">Artifact configurations</a></h6>
<div class="paragraph">
<p>The following sample demonstrates how to reference and configure artifact configurations without type accessors:</p>
</div>
<div class="exampleblock">
<div class="title">Example 516. Artifact configurations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

dependencies {
    &quot;api&quot;(&quot;junit:junit:4.12&quot;)
    &quot;implementation&quot;(&quot;junit:junit:4.12&quot;)
    &quot;testImplementation&quot;(&quot;junit:junit:4.12&quot;)
}

configurations {
    &quot;implementation&quot; {
        resolutionStrategy.failOnVersionConflict()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The code looks similar to that for the type-safe accessors, except that the configuration names are string literals in this case.
You can use string literals for configuration names in dependency declarations and within the <code>configurations {}</code> block.</p>
</div>
<div class="paragraph">
<p>The IDE won&#8217;t be able to help you discover the available configurations in this situation, but you can look them up either in the corresponding plugin&#8217;s documentation or by running <code>gradle dependencies</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="project_extensions_and_conventions"><a class="anchor" href="#project_extensions_and_conventions"></a><a class="link" href="#project_extensions_and_conventions">Project extensions and conventions</a></h6>
<div class="paragraph">
<p>Project extensions and <a href="#sec:kotlin_dsl_about_conventions">conventions</a> have both a name and a unique type, but the Kotlin DSL only needs to know the type in order to configure them.
As the following sample shows for the <code>sourceSets {}</code> and <code>java {}</code> blocks from the original example build script, you can use the <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-project/configure.html"><code>configure&lt;T&gt;()</code></a> function with the corresponding type to do that:</p>
</div>
<div class="exampleblock">
<div class="title">Example 517. Project extensions and conventions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}

configure&lt;JavaPluginConvention&gt; {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that <code>sourceSets</code> is a Gradle extension on <code>Project</code> of type <code>SourceSetContainer</code> and <code>java</code> is an extension on <code>Project</code> of type <code>JavaPluginExtension</code>.</p>
</div>
<div class="paragraph">
<p>You can discover what extensions and conventions are available either by looking at the documentation for the applied plugins or by running <code>gradle kotlinDslAccessorsReport</code>, which prints the Kotlin code necessary to access the model elements contributed by all the applied plugins.
The report provides both names and types.
As a last resort, you can also check a plugin&#8217;s source code, but that shouldn&#8217;t be necessary in the majority of cases.</p>
</div>
<div class="paragraph">
<p>Note that you can also use the <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-project/the.html"><code>the&lt;T&gt;()</code></a> function if you only need a reference to the extension or convention without configuring it, or if you want to perform a one-line configuration, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">the&lt;SourceSetContainer&gt;()[&quot;main&quot;].srcDir(&quot;src/core/java&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above also demonstrates one way of configuring the elements of a project extension that is a container.</p>
</div>
</div>
<div class="sect5">
<h6 id="elements_in_project_extension_containers"><a class="anchor" href="#elements_in_project_extension_containers"></a><a class="link" href="#elements_in_project_extension_containers">Elements in project-extension containers</a></h6>
<div class="paragraph">
<p>Container-based project extensions, such as <code>SourceSetContainer</code>, also allow you to configure the elements held by them.
In our sample build script, we want to configure a source set named <code>main</code> within the source set container, which we can do by using the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/NamedDomainObjectCollection.html#named-java.lang.String-">named()</a> method in place of an accessor, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 518. Elements of project extensions that are containers</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

configure&lt;SourceSetContainer&gt; {
    named(&quot;main&quot;) {
        java.srcDir(&quot;src/core/java&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All elements within a container-based project extension have a name, so you can use this technique in all such cases.</p>
</div>
<div class="paragraph">
<p>As for project extensions and conventions themselves, you can discover what elements are present in any container by either looking at the documentation of the applied plugins or by running <code>gradle kotlinDslAccessorsReport</code>.
And as a last resort, you may be able to view the plugin&#8217;s source code to find out what it does, but that shouldn&#8217;t be necessary in the majority of cases.</p>
</div>
</div>
<div class="sect5">
<h6 id="tasks"><a class="anchor" href="#tasks"></a><a class="link" href="#tasks">Tasks</a></h6>
<div class="paragraph">
<p>Tasks are not managed through a container-based project extension, but they are part of a container that behaves in a similar way.
This means that you can configure tasks in the same way as you do for source sets, as you can see in this example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 519. Tasks</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">apply(plugin = &quot;java-library&quot;)

tasks {
    named&lt;Test&gt;(&quot;test&quot;) {
        testLogging.showExceptions = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We are using the Gradle API to refer to the tasks by name and type, rather than using accessors.
Note that it&#8217;s necessary to specify the type of the task explicitly, otherwise the script won&#8217;t compile because the inferred type will be <code>Task</code>, not <code>Test</code>, and the <code>testLogging</code> property is specific to the <code>Test</code> task type.
You can, however, omit the type if you only need to configure properties or to call methods that are common to all tasks, i.e. they are declared on the <code>Task</code> interface.</p>
</div>
<div class="paragraph">
<p>One can discover what tasks are available by running <code>gradle tasks</code>. You can then find out the type of a given task by running <code>gradle help --task &lt;taskName&gt;</code>, as demonstrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> ./gradlew help --task test
...
Type
     Test (org.gradle.api.tasks.testing.Test)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IDE can assist you with the required imports, so you only need the simple names of the types, i.e. without the package name part.
In this case, there&#8217;s no need to import the <code>Test</code> task type as it is part of the Gradle API and is therefore <a href="#sec:implicit_imports">imported implicitly</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_dsl_about_conventions"><a class="anchor" href="#sec:kotlin_dsl_about_conventions"></a><a class="link" href="#sec:kotlin_dsl_about_conventions">About conventions</a></h5>
<div class="paragraph">
<p>Some of the Gradle core plugins expose configurability with the help of a so-called <em>convention</em> object.
These serve a similar purpose to and have now been superseded by <em>extensions</em>.
Please avoid using convention objects when writing new plugins.
The long term plan is to migrate all Gradle core plugins to use extensions and remove the convention objects altogether.</p>
</div>
<div class="paragraph">
<p>As seen above, the Kotlin DSL provides accessors only for convention objects on <code>Project</code>.
There are situations that require you to interact with a Gradle plugin that uses convention objects on other types.
The Kotlin DSL provides the <code>withConvention(T::class) {}</code> extension function to do this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 520. Configuring source set conventions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
}

sourceSets {
    main {
        withConvention(GroovySourceSet::class) {
            groovy.srcDir(&quot;src/core/groovy&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique is most commonly required for source sets that are added by language plugins other than the Java Plugin, e.g. the Groovy Plugin and the Scala Plugin. You can see which plugins add which properties to source sets in the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSet.html">SourceSet</a> reference documentation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:multi_project_builds"><a class="anchor" href="#sec:multi_project_builds"></a><a class="link" href="#sec:multi_project_builds">Multi-project builds</a></h4>
<div class="paragraph">
<p>As with single-project builds, you should try to use the <code>plugins {}</code> block in your multi-project builds so that you can use the type-safe accessors. Another consideration with multi-project builds is that you won&#8217;t be able to use type-safe accessors when configuring subprojects within the root build script or with other forms of cross configuration between projects. We discuss both topics in more detail in the following sections.</p>
</div>
<div class="sect4">
<h5 id="sec:multi_project_builds_applying_plugins"><a class="anchor" href="#sec:multi_project_builds_applying_plugins"></a><a class="link" href="#sec:multi_project_builds_applying_plugins">Applying plugins</a></h5>
<div class="paragraph">
<p>You can declare your plugins within the subprojects to which they apply, but we recommend that you also declare them within the root project build script. This makes it easier to keep plugin versions consistent across projects within a build. The approach also improves the performance of the build.</p>
</div>
<div class="paragraph">
<p>The <a href="#sec:subprojects_plugins_dsl">Using Gradle plugins</a> chapter explains how you can declare plugins in the root project build script with a version and then apply them to the appropriate subprojects' build scripts. What follows is an example of this approach using three subprojects and three plugins. Note how the root build script only declares the community plugins as the Java Library Plugin is tied to the version of Gradle you are using:</p>
</div>
<div id="ex:multi_project_ratpack" class="exampleblock">
<div class="title">Example 521. Declare plugin dependencies in the root build script using the <code>plugins {}</code> block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;multi-project-build&quot;
include(&quot;domain&quot;, &quot;infra&quot;, &quot;http&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.github.johnrengelman.shadow&quot;) version &quot;4.0.1&quot; apply false
    id(&quot;io.ratpack.ratpack-java&quot;) version &quot;1.5.4&quot; apply false
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">domain/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}

dependencies {
    api(&quot;javax.measure:unit-api:1.0&quot;)
    implementation(&quot;tec.units:unit-ri:1.0.3&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">infra/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    id(&quot;com.github.johnrengelman.shadow&quot;)
}

shadow {
    applicationDistribution.from(&quot;src/dist&quot;)
}

tasks.shadowJar {
    minimize()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">http/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
    id(&quot;io.ratpack.ratpack-java&quot;)
}

dependencies {
    implementation(project(&quot;:domain&quot;))
    implementation(project(&quot;:infra&quot;))
    implementation(ratpack.dependency(&quot;dropwizard-metrics&quot;))
}

application {
    mainClass.set(&quot;example.App&quot;)
}

ratpack.baseDir = file(&quot;src/ratpack/baseDir&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your build requires additional plugin repositories on top of the Gradle Plugin Portal, you should declare them in the <code>pluginManagement {}</code> block in your <code>settings.gradle.kts</code> file, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 522. Declare additional plugin repositories</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        jcenter()
        gradlePluginPortal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Plugins fetched from a source other than the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a> can only be declared via the <code>plugins {}</code> block if they are published with their <a href="#sec:plugin_markers">plugin marker artifacts</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
At the time of writing, all versions of the Android Plugin for Gradle up to 3.2.0 present in the <code>google()</code> repository lack plugin marker artifacts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If those artifacts are missing, then you can&#8217;t use the <code>plugins {}</code> block. You must instead fall back to declaring your plugin dependencies using the <code>buildscript {}</code> block in the root project build script. Here&#8217;s an example of doing that for the Android Plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 523. Declare plugin dependencies in the root build script using the <code>buildscript {}</code> block</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">include(&quot;lib&quot;, &quot;app&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">buildscript {
    repositories {
        google()
        gradlePluginPortal()
    }
    dependencies {
        classpath(&quot;com.android.tools.build:gradle:3.2.0&quot;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">lib/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.library&quot;)
}

android {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">app/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.application&quot;)
}

android {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This technique is not that different from what Android Studio produces when creating a new build.
The main difference is that the subprojects' build scripts in the above sample declare their plugins using the <code>plugins {}</code> block. This means that you can use type-safe accessors for the model elements that they contribute.</p>
</div>
<div class="paragraph">
<p>Note that you can&#8217;t use this technique if you want to apply such a plugin either to the root project build script of a multi-project build (rather than solely to its subprojects) or to a single-project build. You&#8217;ll need to use a different approach in those cases that we detail in <a href="#sec:plugins_resolution_strategy">another section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_cross_project_configuration"><a class="anchor" href="#sec:kotlin_cross_project_configuration"></a><a class="link" href="#sec:kotlin_cross_project_configuration">Cross-configuring projects</a></h5>
<div class="paragraph">
<p><a href="#sec:cross_project_configuration">Cross project configuration</a> is a mechanism by which you can configure a project from another project&#8217;s build script. A common example is when you configure subprojects in the root project build script.</p>
</div>
<div class="paragraph">
<p>Taking this approach means that you won&#8217;t be able to use type-safe accessors for model elements contributed by the plugins. You will instead have to rely on string literals and the standard Gradle APIs.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s modify the <a href="#ex:multi_project_ratpack">Java/Ratpack sample build</a> to fully configure its subprojects from the root project build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 524. Cross-configuring projects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">rootProject.name = &quot;multi-project-build&quot;
include(&quot;domain&quot;, &quot;infra&quot;, &quot;http&quot;)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import com.github.jengelman.gradle.plugins.shadow.ShadowExtension
import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
import ratpack.gradle.RatpackExtension

plugins {
    id(&quot;com.github.johnrengelman.shadow&quot;) version &quot;4.0.1&quot; apply false
    id(&quot;io.ratpack.ratpack-java&quot;) version &quot;1.5.4&quot; apply false
}

project(&quot;:domain&quot;) {
    apply(plugin = &quot;java-library&quot;)
    dependencies {
        &quot;api&quot;(&quot;javax.measure:unit-api:1.0&quot;)
        &quot;implementation&quot;(&quot;tec.units:unit-ri:1.0.3&quot;)
    }
}

project(&quot;:infra&quot;) {
    apply(plugin = &quot;java-library&quot;)
    apply(plugin = &quot;com.github.johnrengelman.shadow&quot;)
    configure&lt;ShadowExtension&gt; {
        applicationDistribution.from(&quot;src/dist&quot;)
    }
    tasks.named&lt;ShadowJar&gt;(&quot;shadowJar&quot;) {
        minimize()
    }
}

project(&quot;:http&quot;) {
    apply(plugin = &quot;java&quot;)
    apply(plugin = &quot;io.ratpack.ratpack-java&quot;)
    val ratpack = the&lt;RatpackExtension&gt;()
    dependencies {
        &quot;implementation&quot;(project(&quot;:domain&quot;))
        &quot;implementation&quot;(project(&quot;:infra&quot;))
        &quot;implementation&quot;(ratpack.dependency(&quot;dropwizard-metrics&quot;))
        &quot;runtimeOnly&quot;(&quot;org.slf4j:slf4j-simple:1.7.25&quot;)
    }
    configure&lt;JavaApplication&gt; {
        mainClass.set(&quot;example.App&quot;)
    }
    ratpack.baseDir = file(&quot;src/ratpack/baseDir&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note how we&#8217;re using the <code>apply()</code> method to apply the plugins since the <code>plugins {}</code> block doesn&#8217;t work in this context.
We are also using standard APIs instead of type-safe accessors to configure tasks, extensions and conventions  an approach that we discussed in <a href="#sec:kotlin_using_standard_api">more detail elsewhere</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:plugins_resolution_strategy"><a class="anchor" href="#sec:plugins_resolution_strategy"></a><a class="link" href="#sec:plugins_resolution_strategy">When you can&#8217;t use the <code>plugins {}</code> block</a></h4>
<div class="paragraph">
<p>Plugins fetched from a source other than the <a href="https://plugins.gradle.org/">Gradle Plugin Portal</a> may or may not be usable with the <code>plugins {}</code> block.
It depends on how they have been published and, specifically, whether they have been published with the necessary <a href="#sec:plugin_markers">plugin marker artifacts</a>.</p>
</div>
<div class="paragraph">
<p>For example, the Android Plugin for Gradle is not published to the Gradle Plugin Portal and at least up to version 3.2.0 of the plugin the metadata required to resolve the artifacts for a given plugin identifier is not published to the Google repository.</p>
</div>
<div class="paragraph">
<p>If your build is a multi-project build and you don&#8217;t need to apply such a plugin to your <em>root</em> project, then you can get round this issue using the technique <a href="#sec:multi_project_builds_applying_plugins">described above</a>.
For any other situation, keep reading.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>When publishing plugins, please use Gradle&#8217;s built-in <a href="#java_gradle_plugin">Gradle Plugin Development Plugin</a>.
It automates the publication of the metadata necessary to make your plugins usable with the <code>plugins {}</code> block.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will show you in this section how to apply the Android Plugin to a single-project build or the root project of a multi-project build.
The goal is to instruct your build on how to map the <code>com.android.application</code> plugin identifier to a resolvable artifact.
This is done in two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a plugin repository to the build&#8217;s settings script</p>
</li>
<li>
<p>Map the plugin ID to the corresponding artifact coordinates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You accomplish both steps by configuring a <code>pluginManagement {}</code> block in the build&#8217;s settings script.
To demonstrate, the following sample adds the <code>google()</code> repository  where the Android plugin is published  to the repository search list, and uses a <code>resolutionStrategy {}</code> block to map the <code>com.android.application</code> plugin ID to the <code>com.android.tools.build:gradle:&lt;version&gt;</code> artifact available in the <code>google()</code> repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 525. Mapping plugin IDs to dependency coordinates</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pluginManagement {
    repositories {
        google()
        gradlePluginPortal()
    }
    resolutionStrategy {
        eachPlugin {
            if(requested.id.namespace == &quot;com.android&quot;) {
                useModule(&quot;com.android.tools.build:gradle:${requested.version}&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;com.android.application&quot;) version &quot;3.2.0&quot;
}

android {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In fact, the above sample will work for all <code>com.android.*</code> plugins that are provided by the specified module. That&#8217;s because the packaged module contains the details of which plugin ID maps to which plugin implementation class, using the properties-file mechanism described in the <a href="#sec:custom_plugins_standalone_project">Writing Custom Plugins</a> chapter.</p>
</div>
<div class="paragraph">
<p>See the <a href="#sec:plugin_management">Plugin Management</a> section of the Gradle user manual for more information on the <code>pluginManagement {}</code> block and what it can be used for.</p>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:containers"><a class="anchor" href="#kotdsl:containers"></a><a class="link" href="#kotdsl:containers">Working with container objects</a></h4>
<div class="paragraph">
<p>The Gradle build model makes heavy use of container objects (or just "containers").
For example, both <code>configurations</code> and <code>tasks</code> are container objects that contain <code>Configuration</code> and <code>Task</code> objects respectively.
Community plugins also contribute containers, like the <code>android.buildTypes</code> container contributed by the Android Plugin.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL provides several ways for build authors to interact with containers.
We look at each of those ways next, using the <code>tasks</code> container as an example.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that you can leverage the type-safe accessors described in <a href="#kotdsl:accessor_applicability">another section</a> if you are configuring existing elements on supported containers. That section also describes which containers support type-safe accessors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="using_the_container_api"><a class="anchor" href="#using_the_container_api"></a><a class="link" href="#using_the_container_api">Using the container API</a></h5>
<div class="paragraph">
<p>All containers in Gradle implement <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer">NamedDomainObjectContainer&lt;DomainObjectType&gt;</a>.
Some of them can contain objects of different types and implement <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.PolymorphicDomainObjectContainer.html#org.gradle.api.PolymorphicDomainObjectContainer">PolymorphicDomainObjectContainer&lt;BaseType&gt;</a>.
The simplest way to interact with containers is through these interfaces.</p>
</div>
<div class="paragraph">
<p>The following sample demonstrates how you can use the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer:named(java.lang.String)">named()</a> method to configure existing tasks and the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.NamedDomainObjectContainer.html#org.gradle.api.NamedDomainObjectContainer:register(java.lang.String)">register()</a> method to create new ones.</p>
</div>
<div class="exampleblock">
<div class="title">Example 526. Using the container API</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named(&quot;check&quot;)                    // <b class="conum">(1)</b>
tasks.register(&quot;myTask1&quot;)               // <b class="conum">(2)</b>

tasks.named&lt;JavaCompile&gt;(&quot;compileJava&quot;) // <b class="conum">(3)</b>
tasks.register&lt;Copy&gt;(&quot;myCopy1&quot;)         // <b class="conum">(4)</b>

tasks.named(&quot;assemble&quot;) {               // <b class="conum">(5)</b>
    dependsOn(&quot;:myTask1&quot;)
}
tasks.register(&quot;myTask2&quot;) {             // <b class="conum">(6)</b>
    description = &quot;Some meaningful words&quot;
}

tasks.named&lt;Test&gt;(&quot;test&quot;) {             // <b class="conum">(7)</b>
    testLogging.showStackTraces = true
}
tasks.register&lt;Copy&gt;(&quot;myCopy2&quot;) {       // <b class="conum">(8)</b>
    from(&quot;source&quot;)
    into(&quot;destination&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Gets a reference of type <code>Task</code> to the existing task named <code>check</code></p>
</li>
<li>
<p>Registers a new untyped task named <code>myTask1</code></p>
</li>
<li>
<p>Gets a reference to the existing task named <code>compileJava</code> of type <code>JavaCompile</code></p>
</li>
<li>
<p>Registers a new task named <code>myCopy1</code> of type <code>Copy</code></p>
</li>
<li>
<p>Gets a reference to the existing (untyped) task named <code>assemble</code> and configures it you can only configure properties and methods that are available on <code>Task</code> with this syntax</p>
</li>
<li>
<p>Registers a new untyped task named <code>myTask2</code> and configures it you can only configure properties and methods that are available on <code>Task</code> in this case</p>
</li>
<li>
<p>Gets a reference to the existing task named <code>test</code> of type <code>Test</code> and configures it in this case you have access to the properties and methods of the specified type</p>
</li>
<li>
<p>Registers a new task named <code>myCopy2</code> of type <code>Copy</code> and configures it</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above sample relies on the configuration avoidance APIs. If you need or want to eagerly configure or register container elements, simply replace <code>named()</code> with <code>getByName()</code> and <code>register()</code> with <code>create()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using_kotlin_delegated_properties"><a class="anchor" href="#using_kotlin_delegated_properties"></a><a class="link" href="#using_kotlin_delegated_properties">Using Kotlin delegated properties</a></h5>
<div class="paragraph">
<p>Another way to interact with containers is via Kotlin delegated properties.
These are particularly useful if you need a reference to a container element that you can use elsewhere in the build.
In addition, Kotlin delegated properties can easily be renamed via IDE refactoring.</p>
</div>
<div class="paragraph">
<p>The following sample does the exact same things as the one in the previous section, but it uses delegated properties and reuses those references in place of string-literal task paths:</p>
</div>
<div class="exampleblock">
<div class="title">Example 527. Using Kotlin delegated properties</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val check by tasks.existing
val myTask1 by tasks.registering

val compileJava by tasks.existing(JavaCompile::class)
val myCopy1 by tasks.registering(Copy::class)

val assemble by tasks.existing {
    dependsOn(myTask1)  // <b class="conum">(1)</b>
}
val myTask2 by tasks.registering {
    description = &quot;Some meaningful words&quot;
}

val test by tasks.existing(Test::class) {
    testLogging.showStackTraces = true
}
val myCopy2 by tasks.registering(Copy::class) {
    from(&quot;source&quot;)
    into(&quot;destination&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Uses the reference to the <code>myTask1</code> task rather than a task path</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above rely on configuration avoidance APIs. If you need to eagerly configure or register container elements simply replace <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-named-domain-object-container/existing.html"><code>existing()</code></a> with <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-named-domain-object-container/getting.html"><code>getting()</code></a> and <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-named-domain-object-container/registering.html"><code>registering()</code></a> with <a href="https://gradle.github.io/kotlin-dsl-docs/api/org.gradle.kotlin.dsl/org.gradle.api.-named-domain-object-container/creating.html"><code>creating()</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuring_multiple_container_elements_together"><a class="anchor" href="#configuring_multiple_container_elements_together"></a><a class="link" href="#configuring_multiple_container_elements_together">Configuring multiple container elements together</a></h5>
<div class="paragraph">
<p>When configuring several elements of a container one can group interactions in a block in order to avoid repeating the container&#8217;s name on each interaction.
The following example uses a combination of type-safe accessors, the container API and Kotlin delegated properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 528. Container scope</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    test {
        testLogging.showStackTraces = true
    }
    val myCheck by registering {
        doLast { /* assert on something meaningful */ }
    }
    check {
        dependsOn(myCheck)
    }
    register(&quot;myHelp&quot;) {
        doLast { /* do something helpful */ }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:properties"><a class="anchor" href="#kotdsl:properties"></a><a class="link" href="#kotdsl:properties">Working with runtime properties</a></h4>
<div class="paragraph">
<p>Gradle has two main sources of properties that are defined at runtime: <a href="#sec:project_properties"><em>project properties</em></a> and <a href="#sec:extra_properties"><em>extra properties</em></a>.
The Kotlin DSL provides specific syntax for working with these types of properties, which we look at in the following sections.</p>
</div>
<div class="sect4">
<h5 id="project_properties"><a class="anchor" href="#project_properties"></a><a class="link" href="#project_properties">Project properties</a></h5>
<div class="paragraph">
<p>The Kotlin DSL allows you to access project properties by binding them via Kotlin delegated properties.
Here&#8217;s a sample snippet that demonstrates the technique for a couple of project properties, one of which <em>must</em> be defined:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myProperty: String by project  // <b class="conum">(1)</b>
val myNullableProperty: String? by project // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Makes the <code>myProperty</code> project property available via a <code>myProperty</code> delegated property the project property must exist in this case, otherwise the build will fail when the build script attempts to use the <code>myProperty</code> value</p>
</li>
<li>
<p>Does the same for the <code>myNullableProperty</code> project property, but the build won&#8217;t fail on using the <code>myNullableProperty</code> value as long as you check for null (standard <a href="https://kotlinlang.org/docs/reference/null-safety.html">Kotlin rules for null safety</a> apply)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The same approach works in both settings and initialization scripts, except you use <code>by settings</code> and <code>by gradle</code> respectively in place of <code>by project</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="extra_properties"><a class="anchor" href="#extra_properties"></a><a class="link" href="#extra_properties">Extra properties</a></h5>
<div class="paragraph">
<p>Extra properties are available on any object that implements the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.ExtensionAware.html#org.gradle.api.plugins.ExtensionAware">ExtensionAware</a> interface.
Kotlin DSL allows you to access extra properties and create new ones via delegated properties, using any of the <code>by extra</code> forms demonstrated in the following sample:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myNewProperty by extra(&quot;initial value&quot;)  // <b class="conum">(1)</b>
val myOtherNewProperty by extra { &quot;calculated initial value&quot; }  // <b class="conum">(2)</b>

val myProperty: String by extra  // <b class="conum">(3)</b>
val myNullableProperty: String? by extra  // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new extra property called <code>myNewProperty</code> in the current context (the project in this case) and initializes it with the value <code>"initial value"</code>, which also determines the property&#8217;s <em>type</em></p>
</li>
<li>
<p>Create a new extra property whose initial value is calculated by the provided lambda</p>
</li>
<li>
<p>Binds an existing extra property from the current context (the project in this case) to a <code>myProperty</code> reference</p>
</li>
<li>
<p>Does the same as the previous line but allows the property to have a null value</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach works for all Gradle scripts: project build scripts, script plugins, settings scripts and initialization scripts.</p>
</div>
<div class="paragraph">
<p>You can also access extra properties on a root project from a subproject using the following syntax:</p>
</div>
<div class="listingblock">
<div class="title">my-sub-project/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val myNewProperty: String by rootProject.extra  // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Binds the root project&#8217;s <code>myNewProperty</code> extra property to a reference of the same name</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Extra properties aren&#8217;t just limited to projects.
For example, <code>Task</code> extends <code>ExtensionAware</code>, so you can attach extra properties to tasks as well.
Here&#8217;s an example that defines a new <code>myNewTaskProperty</code> on the <code>test</code> task and then uses that property to initialize another task:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks {
    test {
        val reportType by extra(&quot;dev&quot;)  // <b class="conum">(1)</b>
        doLast {
            // Use 'suffix' for post processing of reports
        }
    }

    register&lt;Zip&gt;(&quot;archiveTestReports&quot;) {
        val reportType: String by test.get().extra  // <b class="conum">(2)</b>
        archiveAppendix.set(reportType)
        from(test.get().reports.html.destination)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new <code>reportType</code> extra property on the <code>test</code> task</p>
</li>
<li>
<p>Makes the <code>test</code> task&#8217;s <code>reportType</code> extra property available to configure the <code>archiveTestReports</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you&#8217;re happy to use eager configuration rather than the configuration avoidance APIs, you could use a single, "global" property for the report type, like this:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test.doLast { ... }

val testReportType by tasks.test.get().extra(&quot;dev&quot;)  // <b class="conum">(1)</b>

tasks.create&lt;Zip&gt;(&quot;archiveTestReports&quot;) {
    archiveAppendix.set(testReportType)  // <b class="conum">(2)</b>
    from(test.get().reports.html.destination)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates and initializes an extra property on the <code>test</code> task, binding it to a "global" property</p>
</li>
<li>
<p>Uses the "global" property to initialize the <code>archiveTestReports</code> task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is one last syntax for extra properties that we should cover, one that treats <code>extra</code> as a map.
We recommend against using this in general as you lose the benefits of Kotlin&#8217;s type checking and it prevents IDEs from providing as much support as they could.
However, it is more succinct than the delegated properties syntax and can reasonably be used if you only need to set the value of an extra property without referencing it later.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example demonstrating how to set and read extra properties using the map syntax:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">extra[&quot;myNewProperty&quot;] = &quot;initial value&quot;  // <b class="conum">(1)</b>

tasks.create(&quot;myTask&quot;) {
    doLast {
        println(&quot;Property: ${project.extra[&quot;myNewProperty&quot;]}&quot;)  // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a new project extra property called <code>myNewProperty</code> and sets its value</p>
</li>
<li>
<p>Reads the value from the project extra property we created  note the <code>project.</code> qualifier on <code>extra[&#8230;&#8203;]</code>, otherwise Gradle will assume we want to read an extra property from the <em>task</em></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:kotlin-dsl_plugin"><a class="anchor" href="#sec:kotlin-dsl_plugin"></a><a class="link" href="#sec:kotlin-dsl_plugin">The Kotlin DSL Plugin</a></h4>
<div class="paragraph">
<p>The Kotlin DSL Plugin provides a convenient way to develop Kotlin-based projects that contribute build logic.
That includes <a href="#sec:build_sources">buildSrc projects</a>, <a href="#">included builds</a> and <a href="https://guides.gradle.org/designing-gradle-plugins/">Gradle plugins</a>.</p>
</div>
<div class="paragraph">
<p>The plugin achieves this by doing the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies the <a href="https://kotlinlang.org/docs/reference/using-gradle.html#targeting-the-jvm">Kotlin Plugin</a>, which adds support for compiling Kotlin source files.</p>
</li>
<li>
<p>Adds the <code>kotlin-stdlib-jdk8</code>, <code>kotlin-reflect</code> and <code>gradleKotlinDsl()</code> dependencies to the <code>compileOnly</code> and <code>testImplementation</code> configurations, which allows you to make use of those Kotlin libraries and the Gradle API in your Kotlin code.</p>
</li>
<li>
<p>Configures the Kotlin compiler with the same settings that are used for Kotlin DSL scripts, ensuring consistency between your build logic and those scripts.</p>
</li>
<li>
<p>Enables support for <a href="#sec:precompiled_plugins">precompiled script plugins</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="title">Avoid specifying a version for the <code>kotlin-dsl</code> plugin</div>
<div class="paragraph">
<p>Each Gradle release is meant to be used with a specific version of the <code>kotlin-dsl</code> plugin and compatibility between arbitrary Gradle releases and <code>kotlin-dsl</code> plugin versions is not guaranteed. Using an unexpected version of the <code>kotlin-dsl</code> plugin in a build will emit a warning and can cause hard to diagnose problems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the basic configuration you need to use the plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 529. Applying the Kotlin DSL Plugin to a <code>buildSrc</code> project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

repositories {
    // The org.jetbrains.kotlin.jvm plugin requires a repository
    // where to download the Kotlin compiler dependencies from.
    jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Be aware that the Kotlin DSL Plugin turns on experimental Kotlin compiler features.
See the <a href="#sec:kotlin_compiler_arguments">Kotlin compiler arguments</a> section below for more information.</p>
</div>
<div class="paragraph">
<p>By default, the plugin warns about using experimental features of the Kotlin compiler.
You can silence the warning by setting the <code>experimentalWarning</code> property of the <code>kotlinDslPluginOptions</code> extension to <code>false</code> as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 530. Disabling the warning about the use of experimental Kotlin compiler features</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">buildSrc/build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `kotlin-dsl`
}

kotlinDslPluginOptions {
    experimentalWarning.set(false)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:kotlin"><a class="anchor" href="#sec:kotlin"></a><a class="link" href="#sec:kotlin">The embedded Kotlin</a></h4>
<div class="paragraph">
<p>Gradle embeds Kotlin in order to provide support for Kotlin-based scripts.</p>
</div>
<div class="sect4">
<h5 id="kotlin_versions"><a class="anchor" href="#kotlin_versions"></a><a class="link" href="#kotlin_versions">Kotlin versions</a></h5>
<div class="paragraph">
<p>Gradle ships with <code>kotlin-compiler-embeddable</code> plus matching versions of <code>kotlin-stdlib</code> and <code>kotlin-reflect</code> libraries. For example, Gradle 4.3 ships with the Kotlin DSL v0.12.1 that includes Kotlin 1.1.51 versions of these modules. The <code>kotlin</code> package from those modules is visible through the Gradle classpath.</p>
</div>
<div class="paragraph">
<p>The <a href="https://kotlinlang.org/docs/reference/compatibility.html">compatibility guarantees</a> provided by Kotlin apply for both backward and forward compatibility.</p>
</div>
<div class="sect5">
<h6 id="backward_compatibility"><a class="anchor" href="#backward_compatibility"></a><a class="link" href="#backward_compatibility">Backward compatibility</a></h6>
<div class="paragraph">
<p>Our approach is to only do backwards-breaking Kotlin upgrades on a major Gradle release. We will always clearly document which Kotlin version we ship and announce upgrade plans before a major release.</p>
</div>
<div class="paragraph">
<p>Plugin authors who want to stay compatible with older Gradle versions need to limit their API usage to a subset that is compatible with these old versions. Its not really different from any other new API in Gradle. E.g. if we introduce a new API for dependency resolution and a plugin wants to use that API, then they either need to drop support for older Gradle versions or they need to do some clever organization of their code to only execute the new code path on newer versions.</p>
</div>
</div>
<div class="sect5">
<h6 id="forward_compatibility"><a class="anchor" href="#forward_compatibility"></a><a class="link" href="#forward_compatibility">Forward compatibility</a></h6>
<div class="paragraph">
<p>The biggest issue is the compatibility between the external <code>kotlin-gradle-plugin</code> version and the <code>kotlin-stdlib</code> version shipped with Gradle. More generally, between any plugin that transitively depends on <code>kotlin-stdlib</code> and its version shipped with Gradle. As long as the combination is compatible everything should work. This will become less of an issue as the language matures.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_compiler_arguments"><a class="anchor" href="#sec:kotlin_compiler_arguments"></a><a class="link" href="#sec:kotlin_compiler_arguments">Kotlin compiler arguments</a></h5>
<div class="paragraph">
<p>These are the Kotlin compiler arguments used for compiling Kotlin DSL scripts and Kotlin sources and scripts in a project that has the <code>kotlin-dsl</code> plugin applied:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-jvm-target=1.8</code></dt>
<dd>
<p>Sets the target version of the generated JVM bytecode to <code>1.8</code>.</p>
</dd>
<dt class="hdlist1"><code>-Xjsr305=strict</code></dt>
<dd>
<p>Sets up Kotlin&#8217;s Java interoperability to strictly follow JSR-305 annotations for increased null safety.
See <a href="https://kotlinlang.org/docs/reference/java-interop.html#compiler-configuration">Calling Java code from Kotlin</a> in the Kotlin documentation for more information.</p>
</dd>
<dt class="hdlist1"><code>-XX:NewInference</code></dt>
<dd>
<p>Enables the experimental Kotlin compiler inference engine (required for SAM conversion for Kotlin functions).</p>
</dd>
<dt class="hdlist1"><code>-XX:SamConversionForKotlinFunctions</code></dt>
<dd>
<p>Enables SAM (Single Abstract Method) conversion for Kotlin functions in order to allow Kotlin build logic to expose and consume <code>org.gradle.api.Action&lt;T&gt;</code> based APIs. Such APIs can then be used uniformly from both the Kotlin and Groovy DSLs.</p>
<div class="paragraph">
<p>As an example, given the following hypothetical Kotlin function with a Java SAM parameter type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">fun kotlinFunctionWithJavaSam(action: org.gradle.api.Action&lt;Any&gt;) = TODO()</code></pre>
</div>
</div>
<div class="paragraph">
<p>SAM conversion for Kotlin functions enables the following usage of the function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">kotlinFunctionWithJavaSam {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without SAM conversion for Kotlin functions one would have to explicitly convert the passed lambda:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">kotlinFunctionWithJavaSam(Action {
    // ...
})</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>-XX:ReferencesToSyntheticJavaProperties</code></dt>
<dd>
<p>Enables method references to synthetic Java Bean properties.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:interoperability"><a class="anchor" href="#sec:interoperability"></a><a class="link" href="#sec:interoperability">Interoperability</a></h4>
<div class="paragraph">
<p>When mixing languages in your build logic, you may have to cross language boundaries.
An extreme example would be a build that uses tasks and plugins that are implemented in Java, Groovy and Kotlin, while also using both Kotlin DSL and Groovy DSL build scripts.</p>
</div>
<div class="paragraph">
<p>Quoting the Kotlin reference documentation:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Kotlin is designed with Java Interoperability in mind. Existing Java code can be called from Kotlin in a natural way, and Kotlin code can be used from Java rather smoothly as well.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Both <a href="https://kotlinlang.org/docs/reference/java-interop.html">calling Java from Kotlin</a> and <a href="https://kotlinlang.org/docs/reference/java-to-kotlin-interop.html">calling Kotlin from Java</a> are very well covered in the Kotlin reference documentation.</p>
</div>
<div class="paragraph">
<p>The same mostly applies to interoperability with Groovy code.
In addition, the Kotlin DSL provides several ways to opt into Groovy semantics, which we look at next.</p>
</div>
<div class="sect4">
<h5 id="static_extensions"><a class="anchor" href="#static_extensions"></a><a class="link" href="#static_extensions">Static extensions</a></h5>
<div class="paragraph">
<p>Both the Groovy and Kotlin languages support extending existing classes via <a href="https://groovy-lang.org/metaprogramming.html#_extension_modules">Groovy Extension modules</a> and <a href="https://kotlinlang.org/docs/reference/extensions.html">Kotlin extensions</a>.</p>
</div>
<div class="paragraph">
<p>To call a Kotlin extension function from Groovy, call it as a static function, passing the receiver as the first parameter:</p>
</div>
<div class="exampleblock">
<div class="title">Example 531. Calling a Kotlin extension from Groovy</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">TheTargetTypeKt.kotlinExtensionFunction(receiver, <span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>, aReference)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Kotlin extension functions are package-level functions and you can learn how to locate the name of the type declaring a given Kotlin extension in the <a href="https://kotlinlang.org/docs/reference/java-to-kotlin-interop.html#package-level-functions">Package-Level Functions</a> section of the Kotlin reference documentation.</p>
</div>
<div class="paragraph">
<p>To call a Groovy extension method from Kotlin, the same approach applies: call it as a static function passing the receiver as the first parameter.
Here&#8217;s an example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 532. Calling a Groovy extension from Kotlin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">TheTargetTypeGroovyExtension.groovyExtensionMethod(receiver, &quot;parameters&quot;, 42, aReference)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="named_parameters_and_default_arguments"><a class="anchor" href="#named_parameters_and_default_arguments"></a><a class="link" href="#named_parameters_and_default_arguments">Named parameters and default arguments</a></h5>
<div class="paragraph">
<p>Both the Groovy and Kotlin languages support named function parameters and default arguments, although they are implemented very differently.
Kotlin has fully-fledged support for both, as described in the Kotlin language reference under<a href="https://kotlinlang.org/docs/reference/functions.html#named-arguments">named arguments</a> and <a href="https://kotlinlang.org/docs/reference/functions.html#default-arguments">default arguments</a>.
Groovy implements <a href="https://groovy-lang.org/objectorientation.html#_named_arguments">named arguments</a> in a non-type-safe way based on a <code>Map&lt;String, ?&gt;</code> parameter, which means they cannot be combined with <a href="https://groovy-lang.org/objectorientation.html#_default_arguments">default arguments</a>.
In other words, you can only use one or the other in Groovy for any given method.</p>
</div>
<div class="sect5">
<h6 id="calling_kotlin_from_groovy"><a class="anchor" href="#calling_kotlin_from_groovy"></a><a class="link" href="#calling_kotlin_from_groovy">Calling Kotlin from Groovy</a></h6>
<div class="paragraph">
<p>To call a Kotlin function that has named arguments from Groovy, just use a normal method call with positional parameters.
There is no way to provide values by argument name.</p>
</div>
<div class="paragraph">
<p>To call a Kotlin function that has default arguments from Groovy, always pass values for all the function parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="calling_groovy_from_kotlin"><a class="anchor" href="#calling_groovy_from_kotlin"></a><a class="link" href="#calling_groovy_from_kotlin">Calling Groovy from Kotlin</a></h6>
<div class="paragraph">
<p>To call a Groovy function with named arguments from Kotlin, you need to pass a <code>Map&lt;String, ?&gt;</code>, as shown in this example:</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="title">Example 533. Call Groovy function with named arguments from Kotlin</div>
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">groovyNamedArgumentTakingMethod(mapOf(
    &quot;parameterName&quot; to &quot;value&quot;,
    &quot;other&quot; to 42,
    &quot;and&quot; to aReference))</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To call a Groovy function with default arguments from Kotlin, always pass values for all the parameters.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovy_closures_from_kotlin"><a class="anchor" href="#groovy_closures_from_kotlin"></a><a class="link" href="#groovy_closures_from_kotlin">Groovy closures from Kotlin</a></h5>
<div class="paragraph">
<p>You may sometimes have to call Groovy methods that take <a href="https://groovy-lang.org/closures.html">Closure</a> arguments from Kotlin code.
For example, some third-party plugins written in Groovy expect closure arguments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Gradle plugins written in any language should prefer the type <code>Action&lt;T&gt;</code> type in place of closures. Groovy closures and Kotlin lambdas are automatically mapped to arguments of that type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to provide a way to construct closures while preserving Kotlin&#8217;s strong typing, two helper methods exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>closureOf&lt;T&gt; {}</code></p>
</li>
<li>
<p><code>delegateClosureOf&lt;T&gt; {}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods are useful in different circumstances and depend upon the method you are passing the <code>Closure</code> instance into.</p>
</div>
<div class="paragraph">
<p>Some plugins expect simple closures, as with the <a href="https://plugins.gradle.org/plugin/com.jfrog.bintray">Bintray</a> plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 534. Use <code>closureOf&lt;T&gt; {}</code></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">bintray {
    pkg(closureOf&lt;PackageConfig&gt; {
        // Config for the package here
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In other cases, like with the <a href="https://plugins.gradle.org/plugin/org.gretty">Gretty Plugin</a> when configuring farms, the plugin expects a delegate closure:</p>
</div>
<div class="exampleblock">
<div class="title">Example 535. Use <code>delegateClosureOf&lt;T&gt; {}</code></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;group:artifact:1.2.3&quot;) {
        artifact(delegateClosureOf&lt;DependencyArtifact&gt; {
            // configuration for the artifact
            name = &quot;artifact-name&quot;
        })
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There sometimes isn&#8217;t a good way to tell, from looking at the source code, which version to use.
Usually, if you get a <code>NullPointerException</code> with <code>closureOf&lt;T&gt; {}</code>, using <code>delegateClosureOf&lt;T&gt; {}</code>
will resolve the problem.</p>
</div>
<div class="paragraph">
<p>These two utility functions are useful for <em>configuration closures</em>, but some plugins might expect Groovy closures for other purposes.
The <code>KotlinClosure0</code> to <code>KotlinClosure2</code> types allows adapting Kotlin functions to Groovy closures with more flexibility.</p>
</div>
<div class="exampleblock">
<div class="title">Example 536. Use <code>KotlinClosureX</code> types</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">somePlugin {

    // Adapt parameter-less function
    takingParameterLessClosure(KotlinClosure0({
        &quot;result&quot;
    }))

    // Adapt unary function
    takingUnaryClosure(KotlinClosure1&lt;String, String&gt;({
        &quot;result from single parameter $this&quot;
    }))

    // Adapt binary function
    takingBinaryClosure(KotlinClosure2&lt;String, String, String&gt;({ a, b -&gt;
        &quot;result from parameters $a and $b&quot;
    }))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Also see the <a href="https://github.com/gradle/kotlin-dsl-samples/tree/master/samplesgroovy-interop">groovy-interop</a> sample.</p>
</div>
</div>
<div class="sect4">
<h5 id="the_kotlin_dsl_groovy_builder"><a class="anchor" href="#the_kotlin_dsl_groovy_builder"></a><a class="link" href="#the_kotlin_dsl_groovy_builder">The Kotlin DSL Groovy Builder</a></h5>
<div class="paragraph">
<p>If some plugin makes heavy use of <a href="https://groovy-lang.org/metaprogramming.html">Groovy metaprogramming</a>, then using it from Kotlin or Java or any statically-compiled language can be very cumbersome.</p>
</div>
<div class="paragraph">
<p>The Kotlin DSL provides a <code>withGroovyBuilder {}</code> utility extension that attaches the Groovy metaprogramming semantics to objects of type <code>Any</code>.
The following example demonstrates several features of the method on the object <code>target</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 537. Use <code>withGroovyBuilder {}</code></div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">target.withGroovyBuilder {                                          // <b class="conum">(1)</b>

    // GroovyObject methods available                               // <b class="conum">(2)</b>
    val foo = getProperty(&quot;foo&quot;)
    setProperty(&quot;foo&quot;, &quot;bar&quot;)
    invokeMethod(&quot;name&quot;, arrayOf(&quot;parameters&quot;, 42, aReference))

    // Kotlin DSL utilities
    &quot;name&quot;(&quot;parameters&quot;, 42, aReference)                            // <b class="conum">(3)</b>
        &quot;blockName&quot; {                                               // <b class="conum">(4)</b>
            // Same Groovy Builder semantics on `blockName`
        }
    &quot;another&quot;(&quot;name&quot; to &quot;example&quot;, &quot;url&quot; to &quot;https://example.com/&quot;) // <b class="conum">(5)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The receiver is a <a href="https://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyObject.html">GroovyObject</a> and provides Kotlin helpers</p>
</li>
<li>
<p>The <code>GroovyObject</code> API is available</p>
</li>
<li>
<p>Invoke the <code>methodName</code> method, passing some parameters</p>
</li>
<li>
<p>Configure the <code>blockName</code> property, maps to a <code>Closure</code> taking method invocation</p>
</li>
<li>
<p>Invoke <code>another</code> method taking named arguments, maps to a Groovy named arguments <code>Map&lt;String, ?&gt;</code> taking method invocation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/gradle/kotlin-dsl-samples/tree/master/samplesmaven-plugin">maven-plugin</a> sample demonstrates the use of the <code>withGroovyBuilder()</code> utility extensions for configuring the <code>uploadArchives</code> task to <a href="#sec:deploying_to_a_maven_repository">deploy to a Maven repository</a> with a custom POM using Gradle&#8217;s core <a href="#">Maven Plugin</a>.
Note that the recommended <a href="#">Maven Publish Plugin</a> provides a type-safe and Kotlin-friendly DSL that allows you to easily do <a href="#sec:modifying_the_generated_pom">the same and more</a> without resorting to <code>withGroovyBuilder()</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_a_groovy_script"><a class="anchor" href="#using_a_groovy_script"></a><a class="link" href="#using_a_groovy_script">Using a Groovy script</a></h5>
<div class="paragraph">
<p>Another option when dealing with problematic plugins that assume a Groovy DSL build script is to configure them in a Groovy DSL build script that is applied from the main Kotlin DSL build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 538. Using a Groovy script</div>
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    id(&quot;dynamic-groovy-plugin&quot;) version &quot;1.0&quot;               <b class="conum">(1)</b>
}
apply(from = &quot;dynamic-groovy-plugin-configuration.gradle&quot;)  <b class="conum">(2)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">dynamic-groovy-plugin-configuration.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">native</span> {                                                    <b class="conum">(3)</b>
    dynamic {
        groovy <span class="keyword">as</span> Usual
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Kotlin build script requests and applies the plugin</p>
</li>
<li>
<p>The Kotlin build script applies the Groovy script</p>
</li>
<li>
<p>The Groovy script uses dynamic Groovy to configure plugin</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotdsl:limitations"><a class="anchor" href="#kotdsl:limitations"></a><a class="link" href="#kotdsl:limitations">Limitations</a></h4>
<div class="ulist">
<ul>
<li>
<p>The Kotlin DSL is <a href="https://github.com/gradle/kotlin-dsl/issues/902">known to be slower than the Groovy DSL</a> on first use, for example with clean checkouts or on ephemeral continuous integration agents.
Changing something in the <em>buildSrc</em> directory also has an impact as it invalidates build-script caching.
The main reason for this is the slower script compilation for Kotlin DSL.</p>
</li>
<li>
<p>In IntelliJ IDEA, you must <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import">import your project from the Gradle model</a> in order to get content assist and refactoring support for your Kotlin DSL build scripts.</p>
</li>
<li>
<p>The Kotlin DSL will not support the <code>model {}</code> block, which is part of the <a href="https://blog.gradle.org/state-and-future-of-the-gradle-software-model">discontinued Gradle Software Model</a>.
However, you <em>can</em> apply model rules from scripts  see the <a href="https://github.com/gradle/kotlin-dsl-samples/tree/master/samplesmodel-rules">model rules</a> sample for more information.</p>
</li>
<li>
<p>We recommend against enabling the incubating <a href="#sec:configuration_on_demand">configuration on demand</a> feature as it can lead to very hard-to-diagnose problems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you run into trouble or discover a suspected bug, please report the issue in the <a href="https://github.com/gradle/gradle/issues/">Gradle issue tracker</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plugin_reference"><a class="anchor" href="#plugin_reference"></a><a class="link" href="#plugin_reference">Gradle Plugin Reference</a></h3>
<div class="paragraph">
<p>This page contains links and short descriptions for all the core plugins provided by Gradle itself.</p>
</div>
<div class="sect3">
<h4 id="jvm_languages_and_frameworks"><a class="anchor" href="#jvm_languages_and_frameworks"></a><a class="link" href="#jvm_languages_and_frameworks">JVM languages and frameworks</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#">Java</a></dt>
<dd>
<p>Provides support for building any type of Java project.</p>
</dd>
<dt class="hdlist1"><a href="#">Java Library</a></dt>
<dd>
<p>Provides support for building a Java library.</p>
</dd>
<dt class="hdlist1"><a href="#">Java Platform</a></dt>
<dd>
<p>Provides support for building a Java platform.</p>
</dd>
<dt class="hdlist1"><a href="#">Groovy</a></dt>
<dd>
<p>Provides support for building any type of <a href="https://groovy-lang.org/">Groovy</a> project.</p>
</dd>
<dt class="hdlist1"><a href="#">Scala</a></dt>
<dd>
<p>Provides support for building any type of <a href="https://www.scala-lang.org/">Scala</a> project.</p>
</dd>
<dt class="hdlist1"><a href="#">ANTLR</a></dt>
<dd>
<p>Provides support for generating parsers using <a href="http://www.antlr.org/">ANTLR</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="native_languages"><a class="anchor" href="#native_languages"></a><a class="link" href="#native_languages">Native languages</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="cpp_application_plugin.html">C++ Application</a></dt>
<dd>
<p>Provides support for building C++ applications on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="cpp_library_plugin.html">C++ Library</a></dt>
<dd>
<p>Provides support for building C++ libraries on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="cpp_unit_test_plugin.html">C++ Unit Test</a></dt>
<dd>
<p>Provides support for building and running C++ executable-based tests on Windows, Linux, and macOS.</p>
</dd>
<dt class="hdlist1"><a href="swift_application_plugin.html">Swift Application</a></dt>
<dd>
<p>Provides support for building Swift applications on Linux and macOS.</p>
</dd>
<dt class="hdlist1"><a href="swift_library_plugin.html">Swift Library</a></dt>
<dd>
<p>Provides support for building Swift libraries on Linux and macOS.</p>
</dd>
<dt class="hdlist1"><a href="xctest_plugin.html">XCTest</a></dt>
<dd>
<p>Provides support for building and running XCTest-based tests on Linux and macOS.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="packaging_and_distribution"><a class="anchor" href="#packaging_and_distribution"></a><a class="link" href="#packaging_and_distribution">Packaging and distribution</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#">Application</a></dt>
<dd>
<p>Provides support for building JVM-based, runnable applications.</p>
</dd>
<dt class="hdlist1"><a href="#">WAR</a></dt>
<dd>
<p>Provides support for building and packaging WAR-based Java web applications.</p>
</dd>
<dt class="hdlist1"><a href="#">EAR</a></dt>
<dd>
<p>Provides support for building and packaging Java EE applications.</p>
</dd>
<dt class="hdlist1"><a href="#">Maven Publish</a></dt>
<dd>
<p>Provides support for <a href="#">publishing artifacts</a> to Maven-compatible repositories.</p>
</dd>
<dt class="hdlist1"><a href="#">Ivy Publish</a></dt>
<dd>
<p>Provides support for <a href="#">publishing artifacts</a> to Ivy-compatible repositories.</p>
</dd>
<dt class="hdlist1"><a href="#">Legacy Maven Plugin</a></dt>
<dd>
<p>Provides support for publishing artifacts using the <a href="artifact_management.html">legacy mechanism</a> to Maven-compatible repositories.</p>
</dd>
<dt class="hdlist1"><a href="#">Distribution</a></dt>
<dd>
<p>Makes it easy to create ZIP and tarball distributions of your project.</p>
</dd>
<dt class="hdlist1"><a href="#">Java Library Distribution</a></dt>
<dd>
<p>Provides support for creating a ZIP distribution of a Java library project that includes its runtime dependencies.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="code_analysis"><a class="anchor" href="#code_analysis"></a><a class="link" href="#code_analysis">Code analysis</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#">Checkstyle</a></dt>
<dd>
<p>Performs quality checks on your projects Java source files using <a href="https://checkstyle.org/index.html">Checkstyle</a> and generates associated reports.</p>
</dd>
<dt class="hdlist1"><a href="#">PMD</a></dt>
<dd>
<p>Performs quality checks on your projects Java source files using <a href="http://pmd.github.io/">PMD</a> and generates associated reports.</p>
</dd>
<dt class="hdlist1"><a href="#">JaCoCo</a></dt>
<dd>
<p>Provides code coverage metrics for your Java project using <a href="http://www.eclemma.org/jacoco/">JaCoCo</a>.</p>
</dd>
<dt class="hdlist1"><a href="#">CodeNarc</a></dt>
<dd>
<p>Performs quality checks on your Groovy source files using <a href="http://codenarc.sourceforge.net/index.html">CodeNarc</a> and generates associated reports.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ide_integration"><a class="anchor" href="#ide_integration"></a><a class="link" href="#ide_integration">IDE integration</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#">Eclipse</a></dt>
<dd>
<p>Generates Eclipse project files for the build that can be opened by the IDE. This set of plugins can also be used to fine tune <a href="http://projects.eclipse.org/projects/tools.buildship">Buildship&#8217;s</a> import process for Gradle builds.</p>
</dd>
<dt class="hdlist1"><a href="#">IntelliJ IDEA</a></dt>
<dd>
<p>Generates IDEA project files for the build that can be opened by the IDE. It can also be used to fine tune IDEA&#8217;s import process for Gradle builds.</p>
</dd>
<dt class="hdlist1"><a href="visual_studio_plugin.html">Visual Studio</a></dt>
<dd>
<p>Generates Visual Studio solution and project files for build that can be opened by the IDE.</p>
</dd>
<dt class="hdlist1"><a href="xcode_plugin.html">Xcode</a></dt>
<dd>
<p>Generates Xcode workspace and project files for the build that can be opened by the IDE.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="utility"><a class="anchor" href="#utility"></a><a class="link" href="#utility">Utility</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#">Base</a></dt>
<dd>
<p>Provides common lifecycle tasks, such as <code>clean</code>, and other features common to most builds.</p>
</dd>
<dt class="hdlist1"><a href="#">Build Init</a></dt>
<dd>
<p>Generates a new Gradle build of a specified type, such as a Java library. It can also generate a build script from a Maven POM  see <a href="https://guides.gradle.org/migrating-from-maven/"><em>Migrating from Maven to Gradle</em></a> for more details.</p>
</dd>
<dt class="hdlist1"><a href="#">Signing</a></dt>
<dd>
<p>Provides support for digitally signing generated files and artifacts.</p>
</dd>
<dt class="hdlist1"><a href="#">Plugin Development</a></dt>
<dd>
<p>Makes it easier to develop and publish a Gradle plugin.</p>
</dd>
<dt class="hdlist1"><a href="project_report_plugin.html">Project Report Plugin</a></dt>
<dd>
<p>Helps to generate reports containing useful information about your build.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="command_line_interface"><a class="anchor" href="#command_line_interface"></a><a class="link" href="#command_line_interface">Command-Line Interface</a></h3>
<div class="paragraph lead">
<p>The command-line interface is one of the primary methods of interacting with Gradle. The following serves as a reference of executing and customizing Gradle use of a command-line or when writing scripts or configuring continuous integration.</p>
</div>
<div class="paragraph">
<p>Use of the <a href="#gradle_wrapper">Gradle Wrapper</a> is highly encouraged. You should substitute <code>./gradlew</code> or <code>gradlew.bat</code> for <code>gradle</code> in all following examples when using the Wrapper.</p>
</div>
<div class="paragraph">
<p>Executing Gradle on the command-line conforms to the following structure. Options are allowed before and after task names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gradle [taskName...] [--option-name...]</pre>
</div>
</div>
<div class="paragraph">
<p>If multiple tasks are specified, they should be separated with a space.</p>
</div>
<div class="paragraph">
<p>Options that accept values can be specified with or without <code>=</code> between the option and argument; however, use of <code>=</code> is recommended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--console=plain</pre>
</div>
</div>
<div class="paragraph">
<p>Options that enable behavior have long-form options with inverses specified with <code>--no-</code>. The following are opposites.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--build-cache
--no-build-cache</pre>
</div>
</div>
<div class="paragraph">
<p>Many long-form options, have short option equivalents. The following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--help
-h</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Many command-line flags can be specified in <code>gradle.properties</code> to avoid needing to be typed. See the <a href="#sec:gradle_configuration_properties">configuring build environment guide</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections describe use of the Gradle command-line interface, grouped roughly by user goal. Some plugins also add their own command line options, for example <a href="#test_filtering"><code>--tests</code> for Java test filtering</a>. For more information on exposing command line options for your own tasks, see <a href="#sec:declaring_and_using_command_line_options">Declaring and using command-line options</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:command_line_executing_tasks"><a class="anchor" href="#sec:command_line_executing_tasks"></a><a class="link" href="#sec:command_line_executing_tasks">Executing tasks</a></h4>
<div class="paragraph">
<p>You can run a task and all of its <a href="#sec:task_dependencies">dependencies</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle myTask</pre>
</div>
</div>
<div class="paragraph">
<p>You can learn about what projects and tasks are available in the <a href="#sec:command_line_project_reporting">project reporting section</a>.</p>
</div>
<div class="paragraph">
<p>Most builds support a common set of tasks known as <a href="#sec:lifecycle_tasks"><em>lifecycle tasks</em></a>. These include the <code>build</code>, <code>assemble</code>, and <code>check</code> tasks.</p>
</div>
<div class="sect4">
<h5 id="executing_tasks_in_multi_project_builds"><a class="anchor" href="#executing_tasks_in_multi_project_builds"></a><a class="link" href="#executing_tasks_in_multi_project_builds">Executing tasks in multi-project builds</a></h5>
<div class="paragraph">
<p>In a <a href="#intro_multi_project_builds">multi-project build</a>, subproject tasks can be executed with ":" separating subproject name and task name. The following are equivalent <em>when run from the root project</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle :mySubproject:taskName
$ gradle mySubproject:taskName</pre>
</div>
</div>
<div class="paragraph">
<p>You can also run a task for all subprojects using the task name only. For example, this will run the "test" task for all subprojects when invoked from the root project directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test</pre>
</div>
</div>
<div class="paragraph">
<p>When invoking Gradle from within a subproject, the project name should be omitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd mySubproject
$ gradle taskName</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When executing the Gradle Wrapper from subprojects, one must reference <code>gradlew</code> relatively. For example: <code>../gradlew taskName</code>. The community <a href="http://www.gdub.rocks/">gdub project</a> aims to make this more convenient.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="executing_multiple_tasks"><a class="anchor" href="#executing_multiple_tasks"></a><a class="link" href="#executing_multiple_tasks">Executing multiple tasks</a></h5>
<div class="paragraph">
<p>You can also specify multiple tasks. For example, the following will execute the <code>test</code> and <code>deploy</code> tasks in the order that they are listed on the command-line and will also execute the dependencies for each task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test deploy</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:excluding_tasks_from_the_command_line"><a class="anchor" href="#sec:excluding_tasks_from_the_command_line"></a><a class="link" href="#sec:excluding_tasks_from_the_command_line">Excluding tasks from execution</a></h5>
<div class="paragraph">
<p>You can exclude a task from being executed using the <code>-x</code> or <code>--exclude-task</code> command-line option and providing the name of the task to exclude.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/commandLineTutorialTasks.png" alt="commandLineTutorialTasks">
</div>
<div class="title">Figure 30. Simple Task Graph</div>
</div>
<div class="listingblock">
<div class="title">Excluding tasks</div>
<div class="content">
<pre>$ gradle dist --exclude-task test

&gt; Task :compile
compiling source

&gt; Task :dist
building the distribution

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the <code>test</code> task is not executed, even though it is a dependency of the <code>dist</code> task. The <code>test</code> task&#8217;s dependencies such as <code>compileTest</code> are not executed either. Those dependencies of <code>test</code> that are required by another task, such as <code>compile</code>, are still executed.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:rerun_tasks"><a class="anchor" href="#sec:rerun_tasks"></a><a class="link" href="#sec:rerun_tasks">Forcing tasks to execute</a></h5>
<div class="paragraph">
<p>You can force Gradle to execute all tasks ignoring <a href="#sec:up_to_date_checks">up-to-date checks</a> using the <code>--rerun-tasks</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --rerun-tasks</pre>
</div>
</div>
<div class="paragraph">
<p>This will force <code>test</code> and <em>all</em> task dependencies of <code>test</code> to execute. It&#8217;s a little like running <code>gradle clean test</code>, but without the build&#8217;s generated output being deleted.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:continue_build_on_failure"><a class="anchor" href="#sec:continue_build_on_failure"></a><a class="link" href="#sec:continue_build_on_failure">Continuing the build when a failure occurs</a></h5>
<div class="paragraph">
<p>By default, Gradle will abort execution and fail the build as soon as any task fails. This allows the build to complete sooner, but hides other failures that would have occurred. In order to discover as many failures as possible in a single build execution, you can use the <code>--continue</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --continue</pre>
</div>
</div>
<div class="paragraph">
<p>When executed with <code>--continue</code>, Gradle will execute <em>every</em> task to be executed where all of the dependencies for that task completed without failure, instead of stopping as soon as the first failure is encountered. Each of the encountered failures will be reported at the end of the build.</p>
</div>
<div class="paragraph">
<p>If a task fails, any subsequent tasks that were depending on it will not be executed. For example, tests will not run if there is a compilation failure in the code under test; because the test task will depend on the compilation task (either directly or indirectly).</p>
</div>
</div>
<div class="sect4">
<h5 id="task_name_abbreviation"><a class="anchor" href="#task_name_abbreviation"></a><a class="link" href="#task_name_abbreviation">Task name abbreviation</a></h5>
<div class="paragraph">
<p>When you specify tasks on the command-line, you dont have to provide the full name of the task. You only need to provide enough of the task name to uniquely identify the task. For example, it&#8217;s likely <code>gradle che</code> is enough for Gradle to identify the <code>check</code> task.</p>
</div>
<div class="paragraph">
<p>You can also abbreviate each word in a camel case task name. For example, you can execute task <code>compileTest</code> by running <code>gradle compTest</code> or even <code>gradle cT</code>.</p>
</div>
<div class="listingblock">
<div class="title">Abbreviated camel case task name</div>
<div class="content">
<pre>$ gradle cT

&gt; Task :compile
compiling source

&gt; Task :compileTest
compiling unit tests

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use these abbreviations with the -x command-line option.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="common_tasks"><a class="anchor" href="#common_tasks"></a><a class="link" href="#common_tasks">Common tasks</a></h4>
<div class="paragraph">
<p>The following are task conventions applied by built-in and most major Gradle plugins.</p>
</div>
<div class="sect4">
<h5 id="computing_all_outputs"><a class="anchor" href="#computing_all_outputs"></a><a class="link" href="#computing_all_outputs">Computing all outputs</a></h5>
<div class="paragraph">
<p>It is common in Gradle builds for the <code>build</code> task to designate assembling all outputs and running all checks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle build</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running_applications"><a class="anchor" href="#running_applications"></a><a class="link" href="#running_applications">Running applications</a></h5>
<div class="paragraph">
<p>It is common for applications to be run with the <code>run</code> task, which assembles the application and executes some script or binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle run</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running_all_checks"><a class="anchor" href="#running_all_checks"></a><a class="link" href="#running_all_checks">Running all checks</a></h5>
<div class="paragraph">
<p>It is common for <em>all</em> verification tasks, including tests and linting, to be executed using the <code>check</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle check</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cleaning_outputs"><a class="anchor" href="#cleaning_outputs"></a><a class="link" href="#cleaning_outputs">Cleaning outputs</a></h5>
<div class="paragraph">
<p>You can delete the contents of the build directory using the <code>clean</code> task, though doing so will cause pre-computed outputs to be lost, causing significant additional build time for the subsequent task execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle clean</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_project_reporting"><a class="anchor" href="#sec:command_line_project_reporting"></a><a class="link" href="#sec:command_line_project_reporting">Project reporting</a></h4>
<div class="paragraph">
<p>Gradle provides several built-in tasks which show particular details of your build. This can be useful for understanding the structure and dependencies of your build, and for debugging problems.</p>
</div>
<div class="paragraph">
<p>You can get basic help about available reporting options using <code>gradle help</code>.</p>
</div>
<div class="sect4">
<h5 id="listing_projects"><a class="anchor" href="#listing_projects"></a><a class="link" href="#listing_projects">Listing projects</a></h5>
<div class="paragraph">
<p>Running <code>gradle projects</code> gives you a list of the sub-projects of the selected project, displayed in a hierarchy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle projects</pre>
</div>
</div>
<div class="paragraph">
<p>You also get a project report within build scans. Learn more about <a href="https://guides.gradle.org/creating-build-scans/">creating build scans</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_tasks"><a class="anchor" href="#sec:listing_tasks"></a><a class="link" href="#sec:listing_tasks">Listing tasks</a></h5>
<div class="paragraph">
<p>Running <code>gradle tasks</code> gives you a list of the main tasks of the selected project. This report shows the default tasks for the project, if any, and a description for each task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks</pre>
</div>
</div>
<div class="paragraph">
<p>By default, this report shows only those tasks which have been assigned to a task group. You can obtain more information in the task listing using the <code>--all</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks --all</pre>
</div>
</div>
<div class="paragraph">
<p>If you need to be more precise, you can display only the tasks from a specific group using the <code>--group</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle tasks --group="build setup"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:show_task_details"><a class="anchor" href="#sec:show_task_details"></a><a class="link" href="#sec:show_task_details">Show task usage details</a></h5>
<div class="paragraph">
<p>Running <code>gradle help --task someTask</code> gives you detailed information about a specific task.</p>
</div>
<div class="listingblock">
<div class="title">Obtaining detailed help for tasks</div>
<div class="content">
<pre>$ gradle -q help --task libs
Detailed task information for libs

Paths
     :api:libs
     :webapp:libs

Type
     Task (org.gradle.api.Task)

Description
     Builds the JAR

Group
     build</pre>
</div>
</div>
<div class="paragraph">
<p>This information includes the full task path, the task type, possible command line options and the description of the given task.</p>
</div>
</div>
<div class="sect4">
<h5 id="reporting_dependencies"><a class="anchor" href="#reporting_dependencies"></a><a class="link" href="#reporting_dependencies">Reporting dependencies</a></h5>
<div class="paragraph">
<p>Build scans give a full, visual report of what dependencies exist on which configurations, transitive dependencies, and dependency version selection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle myTask --scan</pre>
</div>
</div>
<div class="paragraph">
<p>This will give you a link to a web-based report, where you can find dependency information like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-dependencies.png" alt="Build Scan dependencies report">
</div>
</div>
<div class="paragraph">
<p>Learn more in <a href="#">Viewing and debugging dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="listing_project_dependencies"><a class="anchor" href="#listing_project_dependencies"></a><a class="link" href="#listing_project_dependencies">Listing project dependencies</a></h5>
<div class="paragraph">
<p>Running <code>gradle dependencies</code> gives you a list of the dependencies of the selected project, broken down by configuration. For each configuration, the direct and transitive dependencies of that configuration are shown in a tree. Below is an example of this report:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle dependencies</pre>
</div>
</div>
<div class="paragraph">
<p>Concrete examples of build scripts and output available in the <a href="#">Viewing and debugging dependencies</a>.</p>
</div>
<div class="paragraph">
<p>Running <code>gradle buildEnvironment</code> visualises the buildscript dependencies of the selected project, similarly to how <code>gradle dependencies</code> visualizes the dependencies of the software being built.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle buildEnvironment</pre>
</div>
</div>
<div class="paragraph">
<p>Running <code>gradle dependencyInsight</code> gives you an insight into a particular dependency (or dependencies) that match specified input.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle dependencyInsight</pre>
</div>
</div>
<div class="paragraph">
<p>Since a dependency report can get large, it can be useful to restrict the report to a particular configuration. This is achieved with the optional <code>--configuration</code> parameter:</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:listing_properties"><a class="anchor" href="#sec:listing_properties"></a><a class="link" href="#sec:listing_properties">Listing project properties</a></h5>
<div class="paragraph">
<p>Running <code>gradle properties</code> gives you a list of the properties of the selected project.</p>
</div>
<div class="listingblock">
<div class="title">Information about properties</div>
<div class="content">
<pre>$ gradle -q api:properties

------------------------------------------------------------
Project :api - The shared API for the application
------------------------------------------------------------

allprojects: [project ':api']
ant: org.gradle.api.internal.project.DefaultAntBuilder@12345
antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@12345
artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler_Decorated@12345
asDynamicObject: DynamicObject for project ':api'
baseClassLoaderScope: org.gradle.api.internal.initialization.DefaultClassLoaderScope@12345</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="software_model_reports"><a class="anchor" href="#software_model_reports"></a><a class="link" href="#software_model_reports">Software Model reports</a></h5>
<div class="paragraph">
<p>You can get a hierarchical view of elements for <a href="#software_model">software model</a> projects using the <code>model</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle model</pre>
</div>
</div>
<div class="paragraph">
<p>Learn more about <a href="#model-report">the model report</a> in the software model documentation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_completion"><a class="anchor" href="#sec:command_line_completion"></a><a class="link" href="#sec:command_line_completion">Command-line completion</a></h4>
<div class="paragraph">
<p>Gradle provides bash and zsh tab completion support for tasks, options, and Gradle properties through <a href="https://github.com/gradle/gradle-completion">gradle-completion</a>, installed separately.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-completion-4.0.gif" alt="gradle completion 4.0">
</div>
<div class="title">Figure 31. Gradle Completion</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_debugging"><a class="anchor" href="#sec:command_line_debugging"></a><a class="link" href="#sec:command_line_debugging">Debugging options</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-?</code>, <code>-h</code>, <code>--help</code></dt>
<dd>
<p>Shows a help message with all available CLI options.</p>
</dd>
<dt class="hdlist1"><code>-v</code>, <code>--version</code></dt>
<dd>
<p>Prints Gradle, Groovy, Ant, JVM, and operating system version information.</p>
</dd>
<dt class="hdlist1"><code>-S</code>, <code>--full-stacktrace</code></dt>
<dd>
<p>Print out the full (very verbose) stacktrace for any exceptions. See also <a href="#sec:command_line_logging">logging options</a>.</p>
</dd>
<dt class="hdlist1"><code>-s</code>, <code>--stacktrace</code></dt>
<dd>
<p>Print out the stacktrace also for user exceptions (e.g. compile error).  See also <a href="#sec:command_line_logging">logging options</a>.</p>
</dd>
<dt class="hdlist1"><code>--scan</code></dt>
<dd>
<p>Create a <a href="https://gradle.com/build-scans">build scan</a> with fine-grained information about all aspects of your Gradle build.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.debug=true</code></dt>
<dd>
<p>Debug Gradle client (non-Daemon) process. Gradle will wait for you to attach a debugger at <code>localhost:5005</code> by default.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.daemon.debug=true</code></dt>
<dd>
<p>Debug <a href="#gradle_daemon">Gradle Daemon</a> process.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_performance"><a class="anchor" href="#sec:command_line_performance"></a><a class="link" href="#sec:command_line_performance">Performance options</a></h4>
<div class="paragraph">
<p>Try these options when optimizing build performance. Learn more about <a href="https://guides.gradle.org/performance/">improving performance of Gradle builds here</a>.</p>
</div>
<div class="paragraph">
<p>Many of these options can be specified in <code>gradle.properties</code> so command-line flags are not necessary. See the <a href="#sec:gradle_configuration_properties">configuring build environment guide</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--build-cache</code>, <code>--no-build-cache</code></dt>
<dd>
<p>Toggles the <a href="#build_cache">Gradle build cache</a>. Gradle will try to reuse outputs from previous builds. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--configure-on-demand</code>, <code>--no-configure-on-demand</code></dt>
<dd>
<p>Toggles <a href="#sec:configuration_on_demand">Configure-on-demand</a>. Only relevant projects are configured in this build run. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--max-workers</code></dt>
<dd>
<p>Sets maximum number of workers that Gradle may use. <em>Default is number of processors</em>.</p>
</dd>
<dt class="hdlist1"><code>--parallel</code>, <code>--no-parallel</code></dt>
<dd>
<p>Build projects in parallel. For limitations of this option, see <a href="#sec:parallel_execution">Parallel Project Execution</a>. <em>Default is off</em>.</p>
</dd>
<dt class="hdlist1"><code>--priority</code></dt>
<dd>
<p>Specifies the scheduling priority for the Gradle daemon and all processes launched by it. Values are <code>normal</code> or <code>low</code>. <em>Default is normal</em>.</p>
</dd>
<dt class="hdlist1"><code>--profile</code></dt>
<dd>
<p>Generates a high-level performance report in the <code>$buildDir/reports/profile</code> directory. <code>--scan</code> is preferred.</p>
</dd>
<dt class="hdlist1"><code>--scan</code></dt>
<dd>
<p>Generate a build scan with detailed performance diagnostics.</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="img/gradle-core-test-build-scan-performance.png" alt="Build Scan performance report">
</div>
</div>
<div class="sect4">
<h5 id="gradle_daemon_options"><a class="anchor" href="#gradle_daemon_options"></a><a class="link" href="#gradle_daemon_options">Gradle daemon options</a></h5>
<div class="paragraph">
<p>You can manage the <a href="#gradle_daemon">Gradle Daemon</a> through the following command line options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--daemon</code>, <code>--no-daemon</code></dt>
<dd>
<p>Use the <a href="#gradle_daemon">Gradle Daemon</a> to run the build. Starts the daemon if not running or existing daemon busy. <em>Default is on</em>.</p>
</dd>
<dt class="hdlist1"><code>--foreground</code></dt>
<dd>
<p>Starts the Gradle Daemon in a foreground process.</p>
</dd>
<dt class="hdlist1"><code>--status</code> (Standalone command)</dt>
<dd>
<p>Run <code>gradle --status</code> to list running and recently stopped Gradle daemons. Only displays daemons of the same Gradle version.</p>
</dd>
<dt class="hdlist1"><code>--stop</code> (Standalone command)</dt>
<dd>
<p>Run <code>gradle --stop</code> to stop all Gradle Daemons of the same version.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.daemon.idletimeout=(number of milliseconds)</code></dt>
<dd>
<p>Gradle Daemon will stop itself after this number of milliseconds of idle time. <em>Default is 10800000</em> (3 hours).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_logging"><a class="anchor" href="#sec:command_line_logging"></a><a class="link" href="#sec:command_line_logging">Logging options</a></h4>
<div class="sect4">
<h5 id="setting_log_level"><a class="anchor" href="#setting_log_level"></a><a class="link" href="#setting_log_level">Setting log level</a></h5>
<div class="paragraph">
<p>You can customize the verbosity of Gradle logging with the following options, ordered from least verbose to most verbose. Learn more in the <a href="#logging">logging documentation</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.logging.level=(quiet,warn,lifecycle,info,debug)</code></dt>
<dd>
<p>Set logging level via Gradle properties.</p>
</dd>
<dt class="hdlist1"><code>-q</code>, <code>--quiet</code></dt>
<dd>
<p>Log errors only.</p>
</dd>
<dt class="hdlist1"><code>-w</code>, <code>--warn</code></dt>
<dd>
<p>Set log level to warn.</p>
</dd>
<dt class="hdlist1"><code>-i</code>, <code>--info</code></dt>
<dd>
<p>Set log level to info.</p>
</dd>
<dt class="hdlist1"><code>-d</code>, <code>--debug</code></dt>
<dd>
<p>Log in debug mode (includes normal stacktrace).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Lifecycle is the default log level.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:command_line_customizing_log_format"><a class="anchor" href="#sec:command_line_customizing_log_format"></a><a class="link" href="#sec:command_line_customizing_log_format">Customizing log format</a></h5>
<div class="paragraph">
<p>You can control the use of rich output (colors and font variants) by specifying the "console" mode in the following ways:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>Specify console mode via Gradle properties. Different modes described immediately below.</p>
</dd>
<dt class="hdlist1"><code>--console=(auto,plain,rich,verbose)</code></dt>
<dd>
<p>Specifies which type of console output to generate.</p>
<div class="paragraph">
<p>Set to <code>plain</code> to generate plain text only. This option disables all color and other rich output in the console output. This is the default when Gradle is <em>not</em> attached to a terminal.</p>
</div>
<div class="paragraph">
<p>Set to <code>auto</code> (the default) to enable color and other rich output in the console output when the build process is attached to a console, or to generate plain text only when not attached to a console. <em>This is the default when Gradle is attached to a terminal.</em></p>
</div>
<div class="paragraph">
<p>Set to <code>rich</code> to enable color and other rich output in the console output, regardless of whether the build process is not attached to a console. When not attached to a console, the build output will use ANSI control characters to generate the rich output.</p>
</div>
<div class="paragraph">
<p>Set to <code>verbose</code> to enable color and other rich output like the <code>rich</code>, but output task names and outcomes at the lifecycle log level, as is done by default in Gradle 3.5 and earlier.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:command_line_warnings"><a class="anchor" href="#sec:command_line_warnings"></a><a class="link" href="#sec:command_line_warnings">Showing or hiding warnings</a></h5>
<div class="paragraph">
<p>By default, Gradle won&#8217;t display all warnings (e.g. deprecation warnings). Instead, Gradle will collect them and render a summary at the end of the build like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deprecated Gradle features were used in this build, making it incompatible with Gradle 5.0.</pre>
</div>
</div>
<div class="paragraph">
<p>You can control the verbosity of warnings on the console with the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Dorg.gradle.warning.mode=(all,fail,none,summary)</code></dt>
<dd>
<p>Specify warning mode via <a href="#sec:gradle_configuration_properties">Gradle properties</a>. Different modes described immediately below.</p>
</dd>
<dt class="hdlist1"><code>--warning-mode=(all,fail,none,summary)</code></dt>
<dd>
<p>Specifies how to log warnings. Default is <code>summary</code>.</p>
<div class="paragraph">
<p>Set to <code>all</code> to log all warnings.</p>
</div>
<div class="paragraph">
<p>Set to <code>fail</code> to log all warnings and fail the build if there are any warnings.</p>
</div>
<div class="paragraph">
<p>Set to <code>summary</code> to suppress all warnings and log a summary at the end of the build.</p>
</div>
<div class="paragraph">
<p>Set to <code>none</code> to suppress all warnings, including the summary at the end of the build.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:rich_console"><a class="anchor" href="#sec:rich_console"></a><a class="link" href="#sec:rich_console">Rich Console</a></h5>
<div class="paragraph">
<p>Gradle&#8217;s rich console displays extra information while builds are running.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/rich-cli.png" alt="Gradle Rich Console">
</div>
</div>
<div class="paragraph">
<p>Features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Progress bar and timer visually describe overall status</p>
</li>
<li>
<p>Parallel work-in-progress lines below describe what is happening now</p>
</li>
<li>
<p>Colors and fonts are used to highlight important output and errors</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_execution_options"><a class="anchor" href="#sec:command_line_execution_options"></a><a class="link" href="#sec:command_line_execution_options">Execution options</a></h4>
<div class="paragraph">
<p>The following options affect how builds are executed, by changing what is built or how dependencies are resolved.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--include-build</code></dt>
<dd>
<p>Run the build as a composite, including the specified build. See <a href="#composite_builds">Composite Builds</a>.</p>
</dd>
<dt class="hdlist1"><code>--offline</code></dt>
<dd>
<p>Specifies that the build should operate without accessing network resources. Learn more about <a href="#sec:controlling_dependency_caching_command_line">options to override dependency caching</a>.</p>
</dd>
<dt class="hdlist1"><code>--refresh-dependencies</code></dt>
<dd>
<p>Refresh the state of dependencies. Learn more about how to use this in the <a href="#sec:controlling_dependency_caching_command_line">dependency management docs</a>.</p>
</dd>
<dt class="hdlist1"><code>--dry-run</code></dt>
<dd>
<p>Run Gradle with all task actions disabled. Use this to show which task would have executed.</p>
</dd>
<dt class="hdlist1"><code>--write-locks</code></dt>
<dd>
<p>Indicates that all resolved configurations that are <em>lockable</em> should have their lock state persisted.
Learn more about this in <a href="#dependency-locking">dependency locking</a>.</p>
</dd>
<dt class="hdlist1"><code>--update-locks &lt;group:name&gt;[,&lt;group:name&gt;]*</code></dt>
<dd>
<p>Indicates that versions for the specified modules have to be updated in the lock file.
This flag also implies <code>--write-locks</code>.
Learn more about this in <a href="#dependency-locking">dependency locking</a>.</p>
</dd>
<dt class="hdlist1"><code>--no-rebuild</code></dt>
<dd>
<p>Do not rebuild project dependencies.
Useful for <a href="#sec:build_sources">debugging and fine-tuning <code>buildSrc</code></a>, but can lead to wrong results. Use with caution!</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="environment_options"><a class="anchor" href="#environment_options"></a><a class="link" href="#environment_options">Environment options</a></h4>
<div class="paragraph">
<p>You can customize many aspects about where build scripts, settings, caches, and so on through the options below. Learn more about customizing your <a href="#build_environment">build environment</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-b</code>, <code>--build-file</code></dt>
<dd>
<p>Specifies the build file. For example: <code>gradle --build-file=foo.gradle</code>. The default is <code>build.gradle</code>, then <code>build.gradle.kts</code>, then <code>myProjectName.gradle</code>.</p>
</dd>
<dt class="hdlist1"><code>-c</code>, <code>--settings-file</code></dt>
<dd>
<p>Specifies the settings file. For example: <code>gradle --settings-file=somewhere/else/settings.gradle</code></p>
</dd>
<dt class="hdlist1"><code>-g</code>, <code>--gradle-user-home</code></dt>
<dd>
<p>Specifies the Gradle user home directory. The default is the <code>.gradle</code> directory in the user&#8217;s home directory.</p>
</dd>
<dt class="hdlist1"><code>-p</code>, <code>--project-dir</code></dt>
<dd>
<p>Specifies the start directory for Gradle. Defaults to current directory.</p>
</dd>
<dt class="hdlist1"><code>--project-cache-dir</code></dt>
<dd>
<p>Specifies the project-specific cache directory. Default value is <code>.gradle</code> in the root project directory.</p>
</dd>
<dt class="hdlist1"><code>-D</code>, <code>--system-prop</code></dt>
<dd>
<p>Sets a system property of the JVM, for example <code>-Dmyprop=myvalue</code>. See <a href="#sec:gradle_system_properties">System Properties</a>.</p>
</dd>
<dt class="hdlist1"><code>-I</code>, <code>--init-script</code></dt>
<dd>
<p>Specifies an initialization script. See <a href="#init_scripts">Init Scripts</a>.</p>
</dd>
<dt class="hdlist1"><code>-P</code>, <code>--project-prop</code></dt>
<dd>
<p>Sets a project property of the root project, for example <code>-Pmyprop=myvalue</code>. See <a href="#sec:project_properties">System Properties</a>.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.jvmargs</code></dt>
<dd>
<p>Set JVM arguments.</p>
</dd>
<dt class="hdlist1"><code>-Dorg.gradle.java.home</code></dt>
<dd>
<p>Set JDK home dir.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:command_line_bootstrapping_projects"><a class="anchor" href="#sec:command_line_bootstrapping_projects"></a><a class="link" href="#sec:command_line_bootstrapping_projects">Bootstrapping new projects</a></h4>
<div class="sect4">
<h5 id="creating_new_gradle_builds"><a class="anchor" href="#creating_new_gradle_builds"></a><a class="link" href="#creating_new_gradle_builds">Creating new Gradle builds</a></h5>
<div class="paragraph">
<p>Use the built-in <code>gradle init</code> task to create a new Gradle builds, with new or existing projects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle init</pre>
</div>
</div>
<div class="paragraph">
<p>Most of the time you&#8217;ll want to specify a project type. Available types include <code>basic</code> (default), <code>java-library</code>, <code>java-application</code>, and more. See <a href="#build_init_plugin">init plugin documentation</a> for details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle init --type java-library</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="standardize_and_provision_gradle"><a class="anchor" href="#standardize_and_provision_gradle"></a><a class="link" href="#standardize_and_provision_gradle">Standardize and provision Gradle</a></h5>
<div class="paragraph">
<p>The built-in <code>gradle wrapper</code> task generates a script, <code>gradlew</code>, that invokes a declared version of Gradle, downloading it beforehand if necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle wrapper --gradle-version=4.4</pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify <code>--distribution-type=(bin|all)</code>, <code>--gradle-distribution-url</code>, <code>--gradle-distribution-sha256-sum</code> in addition to <code>--gradle-version</code>. Full details on how to use these options are documented in the <a href="#gradle_wrapper">Gradle wrapper section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:continuous_build"><a class="anchor" href="#sec:continuous_build"></a><a class="link" href="#sec:continuous_build">Continuous Build</a></h4>
<div class="paragraph">
<p>Continuous Build allows you to automatically re-execute the requested tasks when task inputs change.</p>
</div>
<div class="paragraph">
<p>For example, you can continuously run the <code>test</code> task and all dependent tasks by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle test --continuous</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle will behave as if you ran <code>gradle test</code> after a change to sources or tests that contribute to the requested tasks. This means that unrelated changes (such as changes to build scripts) will not trigger a rebuild. In order to incorporate build logic changes, the continuous build must be restarted manually.</p>
</div>
<div class="sect4">
<h5 id="terminating_continuous_build"><a class="anchor" href="#terminating_continuous_build"></a><a class="link" href="#terminating_continuous_build">Terminating Continuous Build</a></h5>
<div class="paragraph">
<p>If Gradle is attached to an interactive input source, such as a terminal, the continuous build can be exited by pressing <code>CTRL-D</code> (On Microsoft Windows, it is required to also press <code>ENTER</code> or <code>RETURN</code> after <code>CTRL-D</code>). If Gradle is not attached to an interactive input source (e.g. is running as part of a script), the build process must be terminated (e.g. using the <code>kill</code> command or similar). If the build is being executed via the Tooling API, the build can be cancelled using the Tooling API&#8217;s cancellation mechanism.</p>
</div>
</div>
<div class="sect4">
<h5 id="continuous_build_limitations"><a class="anchor" href="#continuous_build_limitations"></a><a class="link" href="#continuous_build_limitations">Limitations and quirks</a></h5>
<div class="paragraph">
<p>There are several issues to be aware with the current implementation of continuous build. These are likely to be addressed in future Gradle releases.</p>
</div>
<div class="sect5">
<h6 id="sec:build_cycles"><a class="anchor" href="#sec:build_cycles"></a><a class="link" href="#sec:build_cycles">Build cycles</a></h6>
<div class="paragraph">
<p>Gradle starts watching for changes just before a task executes. If a task modifies its own inputs while executing, Gradle will detect the change and trigger a new build. If every time the task executes, the inputs are modified again, the build will be triggered again. This isn&#8217;t unique to continuous build. A task that modifies its own inputs will never be considered up-to-date when run "normally" without continuous build.</p>
</div>
<div class="paragraph">
<p>If your build enters a build cycle like this, you can track down the task by looking at the list of files reported changed by Gradle. After identifying the file(s) that are changed during each build, you should look for a task that has that file as an input. In some cases, it may be obvious (e.g., a Java file is compiled with <code>compileJava</code>). In other cases, you can use <code>--info</code> logging to find the task that is out-of-date due to the identified files.</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:continuous_build_limitations_jdk9"><a class="anchor" href="#sec:continuous_build_limitations_jdk9"></a><a class="link" href="#sec:continuous_build_limitations_jdk9">Restrictions with Java 9</a></h6>
<div class="paragraph">
<p>Due to class access restrictions related to Java 9, Gradle cannot set some operating system specific options, which means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On macOS, Gradle will poll for file changes every 10 seconds instead of every 2 seconds.</p>
</li>
<li>
<p>On Windows, Gradle must use individual file watches (like on Linux/Mac OS), which may cause continuous build to no longer work on very large projects.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sec:performance_and_stability"><a class="anchor" href="#sec:performance_and_stability"></a><a class="link" href="#sec:performance_and_stability">Performance and stability</a></h6>
<div class="paragraph">
<p>The JDK file watching facility relies on inefficient file system polling on macOS (see: <a href="https://bugs.openjdk.java.net/browse/JDK-7133447">JDK-7133447</a>). This can significantly delay notification of changes on large projects with many source files.</p>
</div>
<div class="paragraph">
<p>Additionally, the watching mechanism may deadlock under <em>heavy</em> load on macOS (see: <a href="https://bugs.openjdk.java.net/browse/JDK-8079620">JDK-8079620</a>). This will manifest as Gradle appearing not to notice file changes. If you suspect this is occurring, exit continuous build and start again.</p>
</div>
<div class="paragraph">
<p>On Linux, OpenJDK&#8217;s implementation of the file watch service can sometimes miss file system events (see: <a href="https://bugs.openjdk.java.net/browse/JDK-8145981">JDK-8145981</a>).</p>
</div>
</div>
<div class="sect5">
<h6 id="sec:changes_to_symbolic_links"><a class="anchor" href="#sec:changes_to_symbolic_links"></a><a class="link" href="#sec:changes_to_symbolic_links">Changes to symbolic links</a></h6>
<div class="ulist">
<ul>
<li>
<p>Creating or removing symbolic link to files will initiate a build.</p>
</li>
<li>
<p>Modifying the target of a symbolic link will not cause a rebuild.</p>
</li>
<li>
<p>Creating or removing symbolic links to directories will not cause rebuilds.</p>
</li>
<li>
<p>Creating new files in the target directory of a symbolic link will not cause a rebuild.</p>
</li>
<li>
<p>Deleting the target directory will not cause a rebuild.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="sec:changes_to_build_logic_are_not_considered"><a class="anchor" href="#sec:changes_to_build_logic_are_not_considered"></a><a class="link" href="#sec:changes_to_build_logic_are_not_considered">Changes to build logic are not considered</a></h6>
<div class="paragraph">
<p>The current implementation does not recalculate the build model on subsequent builds. This means that changes to task configuration, or any other change to the build model, are effectively ignored.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="third_party_integration"><a class="anchor" href="#third_party_integration"></a><a class="link" href="#third_party_integration">Gradle &amp; Third-party Tools</a></h3>
<div class="paragraph">
<p>Gradle can be integrated with many different third-party tools such as IDEs and continuous integration platforms. Here we look at some of the more common ones as well as how to integrate your own tool with Gradle.</p>
</div>
<div class="sect3">
<h4 id="ides"><a class="anchor" href="#ides"></a><a class="link" href="#ides">IDEs</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Android Studio</dt>
<dd>
<p>As a variant of IntelliJ IDEA, <a href="https://developer.android.com/studio/">Android Studio</a> has built-in support for importing and building Gradle projects. You can also use the <a href="#">IDEA Plugin for Gradle</a> to fine-tune the import process if that&#8217;s necessary.</p>
<div class="paragraph">
<p>This IDE also has an <a href="https://developer.android.com/studio/intro/">extensive user guide</a> to help you get the most out of the IDE and Gradle.</p>
</div>
</dd>
<dt class="hdlist1">Eclipse</dt>
<dd>
<p>If you want to work on a project within Eclipse that has a Gradle build, you should use the <a href="https://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship plugin</a>. This will allow you to import and run Gradle builds. If you need to fine tune the import process so that the project loads correctly, you can use the <a href="#">Eclipse Plugins for Gradle</a>. See <a href="https://discuss.gradle.org/t/buildship-1-0-18-is-now-available/19012">the associated release announcement</a> for details on what fine tuning you can do.</p>
</dd>
<dt class="hdlist1">IntelliJ IDEA</dt>
<dd>
<p>IDEA has built-in support for importing Gradle projects. If you need to fine tune the import process so that the project loads correctly, you can use the <a href="#">IDEA Plugin for Gradle</a>.</p>
</dd>
<dt class="hdlist1">NetBeans</dt>
<dd>
<p>Add the <a href="http://plugins.netbeans.org/plugin/44510/gradle-support">Gradle Support</a> plugin to NetBeans in order to import and run projects with Gradle builds.</p>
</dd>
<dt class="hdlist1">Visual Studio</dt>
<dd>
<p>For developing C++ projects, Gradle comes with a <a href="visual_studio_plugin.html">Visual Studio plugin</a>.</p>
</dd>
<dt class="hdlist1">Xcode</dt>
<dd>
<p>For developing C++ projects, Gradle comes with a <a href="xcode_plugin.html">Xcode plugin</a>.</p>
</dd>
<dt class="hdlist1">CLion</dt>
<dd>
<p>JetBrains supports building <a href="https://blog.jetbrains.com/clion/2018/05/clion-starts-2018-2-eap-sanitizers-gradle-db-performance/">C++ projects with Gradle</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="continuous_integration"><a class="anchor" href="#continuous_integration"></a><a class="link" href="#continuous_integration">Continuous integration</a></h4>
<div class="paragraph">
<p>We have dedicated guides showing you how to integrate a Gradle project with the following CI platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.gradle.org/executing-gradle-builds-on-jenkins">Jenkins</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/executing-gradle-builds-on-teamcity">TeamCity</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/executing-gradle-builds-on-travisci">Travis CI</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even if you don&#8217;t use one of the above, you can almost certainly configure your CI platform to use the <a href="#">Gradle Wrapper</a> scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="how_to_integrate_with_gradle"><a class="anchor" href="#how_to_integrate_with_gradle"></a><a class="link" href="#how_to_integrate_with_gradle">How to integrate with Gradle</a></h4>
<div class="paragraph">
<p>There are two main ways to integrate a tool with Gradle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Gradle build uses the tool</p>
</li>
<li>
<p>The tool executes the Gradle build</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The former case is typically <a href="#">implemented as a Gradle plugin</a>. The latter can be accomplished by embedding Gradle through the Tooling API as described below.</p>
</div>
</div>
<div class="sect3">
<h4 id="embedding"><a class="anchor" href="#embedding"></a><a class="link" href="#embedding">Embedding Gradle using the Tooling API</a></h4>
<div class="sect4">
<h5 id="sec:embedding_introduction"><a class="anchor" href="#sec:embedding_introduction"></a><a class="link" href="#sec:embedding_introduction">Introduction to the Tooling API</a></h5>
<div class="paragraph">
<p>Gradle provides a programmatic API called the Tooling API, which you can use for embedding Gradle into your own software. This API allows you to execute and monitor builds and to query Gradle about the details of a build. The main audience for this API is IDE, CI server, other UI authors; however, the API is open for anyone who needs to embed Gradle in their application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test_kit">Gradle TestKit</a> uses the Tooling API for functional testing of your Gradle plugins.</p>
</li>
<li>
<p><a href="http://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship</a> uses the Tooling API for importing your Gradle project and running tasks.</p>
</li>
<li>
<p><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> uses the Tooling API for importing your Gradle project and running tasks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_features"><a class="anchor" href="#sec:embedding_features"></a><a class="link" href="#sec:embedding_features">Tooling API Features</a></h5>
<div class="paragraph">
<p>A fundamental characteristic of the Tooling API is that it operates in a version independent way. This means that you can use the same API to work with builds that use different versions of Gradle, including versions that are newer or older than the version of the Tooling API that you are using. The Tooling API is Gradle wrapper aware and, by default, uses the same Gradle version as that used by the wrapper-powered build.</p>
</div>
<div class="paragraph">
<p>Some features that the Tooling API provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query the details of a build, including the project hierarchy and the project dependencies, external dependencies (including source and Javadoc jars), source directories and tasks of each project.</p>
</li>
<li>
<p>Execute a build and listen to stdout and stderr logging and progress messages (e.g. the messages shown in the 'status bar' when you run on the command line).</p>
</li>
<li>
<p>Execute a specific test class or test method.</p>
</li>
<li>
<p>Receive interesting events as a build executes, such as project configuration, task execution or test execution.</p>
</li>
<li>
<p>Cancel a build that is running.</p>
</li>
<li>
<p>Combine multiple separate Gradle builds into a single composite build.</p>
</li>
<li>
<p>The Tooling API can download and install the appropriate Gradle version, similar to the wrapper.</p>
</li>
<li>
<p>The implementation is lightweight, with only a small number of dependencies. It is also a well-behaved library, and makes no assumptions about your classloader structure or logging configuration. This makes the API easy to embed in your application.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_daemon"><a class="anchor" href="#sec:embedding_daemon"></a><a class="link" href="#sec:embedding_daemon">Tooling API and the Gradle Build Daemon</a></h5>
<div class="paragraph">
<p>The Tooling API always uses the Gradle daemon. This means that subsequent calls to the Tooling API, be it model building requests or task executing requests will be executed in the same long-living process. <a href="#gradle_daemon">Gradle Daemon</a> contains more details about the daemon, specifically information on situations when new daemons are forked.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_quickstart"><a class="anchor" href="#sec:embedding_quickstart"></a><a class="link" href="#sec:embedding_quickstart">Quickstart</a></h5>
<div class="paragraph">
<p>As the Tooling API is an interface for developers, the Javadoc is the main documentation for it. We provide several <em>samples</em> that live in <code>samples/toolingApi</code> in your Gradle distribution. These samples specify all of the required dependencies for the Tooling API with examples for querying information from Gradle builds and executing tasks from the Tooling API.</p>
</div>
<div class="paragraph">
<p>To use the Tooling API, add the following repository and dependency declarations to your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 539. Using the tooling API</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    maven { url <span class="string"><span class="delimiter">'</span><span class="content">https://repo.gradle.org/gradle/libs-releases</span><span class="delimiter">'</span></span> }
}

dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle:gradle-tooling-api:</span><span class="inline"><span class="inline-delimiter">$</span>toolingApiVersion</span><span class="delimiter">&quot;</span></span>
    <span class="comment">// The tooling API need an SLF4J implementation available at runtime, replace this with any other implementation</span>
    runtimeOnly <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-simple:1.7.10</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    maven { url = uri(&quot;https://repo.gradle.org/gradle/libs-releases&quot;) }
}

dependencies {
    implementation(&quot;org.gradle:gradle-tooling-api:$toolingApiVersion&quot;)
    // The tooling API need an SLF4J implementation available at runtime, replace this with any other implementation
    runtimeOnly(&quot;org.slf4j:slf4j-simple:1.7.10&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The main entry point to the Tooling API is the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/tooling/GradleConnector.html">GradleConnector</a>. You can navigate from there to find code samples and explore the available Tooling API models. You can use <a href="https://docs.gradle.org/nightly/javadoc/org/gradle/tooling/GradleConnector.html#connect--">GradleConnector.connect()</a> to create a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/tooling/ProjectConnection.html">ProjectConnection</a>. A <code>ProjectConnection</code> connects to a single Gradle project. Using the connection you can execute tasks, tests and retrieve models relative to this project.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:embedding_compatibility"><a class="anchor" href="#sec:embedding_compatibility"></a><a class="link" href="#sec:embedding_compatibility">Gradle version and Java version compatibility</a></h5>
<div class="sect5">
<h6 id="provider_side"><a class="anchor" href="#provider_side"></a><a class="link" href="#provider_side">Provider side</a></h6>
<div class="paragraph">
<p>The current version of Tooling API supports running builds using Gradle versions 2.6 and later.</p>
</div>
</div>
<div class="sect5">
<h6 id="consumer_side"><a class="anchor" href="#consumer_side"></a><a class="link" href="#consumer_side">Consumer side</a></h6>
<div class="paragraph">
<p>The current version of Gradle supports running builds via Tooling API versions 3.0 and later.</p>
</div>
<div class="paragraph">
<p>You should note that not all features of the Tooling API are available for all versions of Gradle. Refer to the documentation for each class and method for more details.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java_version"><a class="anchor" href="#java_version"></a><a class="link" href="#java_version">Java version</a></h5>
<div class="paragraph">
<p>The Tooling API requires Java 8 or later. The Gradle version used by builds may have additional Java version requirements.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_wrapper"><a class="anchor" href="#gradle_wrapper"></a><a class="link" href="#gradle_wrapper">The Gradle Wrapper</a></h3>
<div class="paragraph">
<p>The recommended way to execute any Gradle build is with the help of the Gradle Wrapper (in short just Wrapper). The Wrapper is a script that invokes a declared version of Gradle, downloading it beforehand if necessary. As a result, developers can get up and running with a Gradle project quickly without having to follow manual installation processes saving your company time and money.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/wrapper-workflow.png" alt="wrapper workflow">
</div>
<div class="title">Figure 32. The Wrapper workflow</div>
</div>
<div class="paragraph">
<p><strong>In a nutshell you gain the following benefits:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standardizes a project on a given Gradle version, leading to more reliable and robust builds.</p>
</li>
<li>
<p>Provisioning a new Gradle version to different users and execution environment (e.g. IDEs or Continuous Integration servers) is as simple as changing the Wrapper definition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>So how does it work? For a user there are typically three different workflows:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You set up a new Gradle project and want to <a href="#sec:adding_wrapper">add the Wrapper</a> to it.</p>
</li>
<li>
<p>You want to <a href="#sec:using_wrapper">run a project with the Wrapper</a> that already provides it.</p>
</li>
<li>
<p>You want to <a href="#sec:upgrading_wrapper">upgrade the Wrapper</a> to a new version of Gradle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sections explain each of these use cases in more detail.</p>
</div>
<div class="sect3">
<h4 id="sec:adding_wrapper"><a class="anchor" href="#sec:adding_wrapper"></a><a class="link" href="#sec:adding_wrapper">Adding the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Generating the Wrapper files requires an installed version of the Gradle runtime on your machine as described in <a href="#installation">Installation</a>. Thankfully, generating the initial Wrapper files is a one-time process.</p>
</div>
<div class="paragraph">
<p>Every vanilla Gradle build comes with a built-in task called <code>wrapper</code>. Youll be able to find the task listed under the group "Build Setup tasks" when <a href="#sec:listing_tasks">listing the tasks</a>. Executing the <code>wrapper</code> task generates the necessary Wrapper files in the project directory.</p>
</div>
<div class="listingblock">
<div class="title">Running the Wrapper task</div>
<div class="content">
<pre>$ gradle wrapper
&gt; Task :wrapper

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To make the Wrapper files available to other developers and execution environments youll need to check them into version control. All Wrapper files including the JAR file are very small in size. Adding the JAR file to version control is expected. Some organizations do not allow projects to submit binary files to version control. At the moment there are no alternative options to the approach.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated Wrapper properties file, <code>gradle/wrapper/gradle-wrapper.properties</code>, stores the information about the Gradle distribution.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The server hosting the Gradle distribution.</p>
</li>
<li>
<p>The type of Gradle distribution. By default thats the <code>-bin</code> distribution containing only the runtime but no sample code and documentation.</p>
</li>
<li>
<p>The Gradle version used for executing the build. By default the <code>wrapper</code> task picks the exact same Gradle version that was used to generate the Wrapper files.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><code>gradle/wrapper/gradle-wrapper.properties</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionUrl=https\://services.gradle.org/distributions/gradle-6.4.1-bin.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of those aspects are configurable at the time of generating the Wrapper files with the help of the following command line options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--gradle-version</code></dt>
<dd>
<p>The Gradle version used for downloading and executing the Wrapper.</p>
</dd>
<dt class="hdlist1"><code>--distribution-type</code></dt>
<dd>
<p>The Gradle distribution type used for the Wrapper. Available options are <code>bin</code> and <code>all</code>. The default value is <code>bin</code>.</p>
</dd>
<dt class="hdlist1"><code>--gradle-distribution-url</code></dt>
<dd>
<p>The full URL pointing to Gradle distribution ZIP file. Using this option makes <code>--gradle-version</code> and <code>--distribution-type</code> obsolete as the URL already contains this information. This option is extremely valuable if you want to host the Gradle distribution inside your companys network.</p>
</dd>
<dt class="hdlist1"><code>--gradle-distribution-sha256-sum</code></dt>
<dd>
<p>The SHA256 hash sum used for <a href="#sec:verification">verifying the downloaded Gradle distribution</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Lets assume the following use case to illustrate the use of the command line options. You would like to generate the Wrapper with version 6.4.1 and use the <code>-all</code> distribution to enable your IDE to enable code-completion and being able to navigate to the Gradle source code. Those requirements are captured by the following command line execution:</p>
</div>
<div class="listingblock">
<div class="title">Providing options to Wrapper task</div>
<div class="content">
<pre>$ gradle wrapper --gradle-version 6.4.1 --distribution-type all
&gt; Task :wrapper

BUILD SUCCESSFUL in 0s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>As a result you can find the desired information in the Wrapper properties file.</p>
</div>
<div class="listingblock">
<div class="title">Example: The generated distribution URL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionUrl=https\://services.gradle.org/distributions/gradle-6.4.1-all.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets have a look at the following project layout to illustrate the expected Wrapper files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
 build.gradle
 settings.gradle
 gradle
    wrapper
        gradle-wrapper.jar
        gradle-wrapper.properties
 gradlew
 gradlew.bat</pre>
</div>
</div>
<div class="paragraph">
<p>A Gradle project typically provides a <code>build.gradle</code> and a <code>settings.gradle</code> file. The Wrapper files live alongside in the <code>gradle</code> directory and the root directory of the project. The following list explains their purpose.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>gradle-wrapper.jar</code></dt>
<dd>
<p>The Wrapper JAR file containing code for downloading the Gradle distribution.</p>
</dd>
<dt class="hdlist1"><code>gradle-wrapper.properties</code></dt>
<dd>
<p>A properties file responsible for configuring the Wrapper runtime behavior e.g. the Gradle version compatible with this version. Note that more generic settings, like <a href="#sec:accessing_the_web_via_a_proxy">configuring the Wrapper to use a proxy</a>, need to go into a <a href="#sec:gradle_configuration_properties">different file</a>.</p>
</dd>
<dt class="hdlist1"><code>gradlew</code>, <code>gradlew.bat</code></dt>
<dd>
<p>A shell script and a Windows batch script for executing the build with the Wrapper.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can go ahead and <a href="#sec:using_wrapper">execute the build with the Wrapper</a> without having to install the Gradle runtime. If the project you are working on does not contain those Wrapper files then youll need to <a href="#sec:adding_wrapper">generate them</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_wrapper"><a class="anchor" href="#sec:using_wrapper"></a><a class="link" href="#sec:using_wrapper">Using the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>It is recommended to always execute a build with the Wrapper to ensure a reliable, controlled and standardized execution of the build. Using the Wrapper looks almost exactly like running the build with a Gradle installation. Depending on the operating system you either run <code>gradlew</code> or <code>gradlew.bat</code> instead of the <code>gradle</code> command. The following console output demonstrate the use of the Wrapper on a Windows machine for a Java-based project.</p>
</div>
<div class="listingblock">
<div class="title">Executing the build with the Wrapper batch file</div>
<div class="content">
<pre>$ gradlew.bat build
Downloading https://services.gradle.org/distributions/gradle-5.0-all.zip
.....................................................................................
Unzipping C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0-all.zip to C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-al\ac27o8rbd0ic8ih41or9l32mv
Set executable permissions for: C:\Documents and Settings\Claudia\.gradle\wrapper\dists\gradle-5.0-all\ac27o8rbd0ic8ih41or9l32mv\gradle-5.0\bin\gradle

BUILD SUCCESSFUL in 12s
1 actionable task: 1 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In case the Gradle distribution is not available on the machine, the Wrapper will download it and store in the local file system. Any subsequent build invocation is going to reuse the existing local distribution as long as the distribution URL in the Gradle properties doesn&#8217;t change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Wrapper shell script and batch file reside in the root directory of a single or multi-project Gradle build. You will need to reference the correct path to those files in case you want to execute the build from a subproject directory e.g. <code>../../gradlew tasks</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:upgrading_wrapper"><a class="anchor" href="#sec:upgrading_wrapper"></a><a class="link" href="#sec:upgrading_wrapper">Upgrading the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Projects will typically want to keep up with the times and upgrade their Gradle version to benefit from new features and improvements. One way to upgrade the Gradle version is manually change the <code>distributionUrl</code> property in the Wrapper&#8217;s <code>gradle-wrapper.properties</code> file. The better and recommended option is to run the <code>wrapper</code> task and provide the target Gradle version as described in <a href="#sec:adding_wrapper">Adding the Gradle Wrapper</a>. Using the <code>wrapper</code> task ensures that any optimizations made to the Wrapper shell script or batch file with that specific Gradle version are applied to the project. As usual, you should commit the changes to the Wrapper files to version control.</p>
</div>
<div class="paragraph">
<p>Note that running the wrapper task once will update <code>gradle-wrapper.properties</code> only, but leave the wrapper itself in <code>gradle-wrapper.jar</code> untouched. This is usually fine as new versions of Gradle can be run even with ancient wrapper files. If you nevertheless want <strong>all</strong> the wrapper files to be completely up-to-date, you&#8217;ll need to run the <code>wrapper</code> task a second time.</p>
</div>
<div class="paragraph">
<p>Use the Gradle <code>wrapper</code> task to generate the wrapper, specifying a version. The default is the current version. Once you have upgraded the wrapper, you can check that it&#8217;s the version you expect by executing <code>./gradlew --version</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example: Upgrading the Wrapper version</div>
<div class="content">
<pre>$ ./gradlew wrapper --gradle-version 6.4.1

BUILD SUCCESSFUL in 4s
1 actionable task: 1 executed</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customizing_wrapper"><a class="anchor" href="#customizing_wrapper"></a><a class="link" href="#customizing_wrapper">Customizing the Gradle Wrapper</a></h4>
<div class="paragraph">
<p>Most users of Gradle are happy with the default runtime behavior of the Wrapper. However, organizational policies, security constraints or personal preferences might require you to dive deeper into customizing the Wrapper. Thankfully, the built-in <code>wrapper</code> task exposes numerous options to bend the runtime behavior to your needs. Most configuration options are exposed by the underlying task type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.wrapper.Wrapper.html">Wrapper</a>.</p>
</div>
<div class="paragraph">
<p>Lets assume you grew tired of defining the <code>-all</code> distribution type on the command line every time you upgrade the Wrapper. You can save yourself some keyboard strokes by re-configuring the <code>wrapper</code> task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 540. Customizing the Wrapper task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.named(<span class="string"><span class="delimiter">'</span><span class="content">wrapper</span><span class="delimiter">'</span></span>) {
    distributionType = Wrapper.DistributionType.ALL
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Wrapper&gt;(&quot;wrapper&quot;) {
    distributionType = Wrapper.DistributionType.ALL
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the configuration in place running <code>./gradlew wrapper --gradle-version 6.4.1</code> is enough to produce a <code>distributionUrl</code> value in the Wrapper properties file that will request the <code>-all</code> distribution.</p>
</div>
<div class="listingblock">
<div class="title">The generated distribution URL</div>
<div class="content">
<pre>distributionUrl=https\://services.gradle.org/distributions/gradle-6.4.1-all.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Check out the API documentation for more detail descriptions of the available configuration options. You can also find various samples for configuring the Wrapper in the Gradle distribution.</p>
</div>
<div class="sect4">
<h5 id="sec:authenticated_download"><a class="anchor" href="#sec:authenticated_download"></a><a class="link" href="#sec:authenticated_download">Authenticated Gradle distribution download</a></h5>
<div class="paragraph">
<p>The Gradle <code>Wrapper</code> can download Gradle distributions from servers using HTTP Basic Authentication. This enables you to host the Gradle distribution on a private protected server. You can specify a username and password in two different ways depending on your use case: as system properties or directly embedded in the <code>distributionUrl</code>. Credentials in system properties take precedence over the ones embedded in <code>distributionUrl</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Security Warning</div>
<div class="paragraph">
<p>HTTP Basic Authentication should only be used with <code>HTTPS</code> URLs and not plain <code>HTTP</code> ones. With Basic Authentication, the user credentials are sent in clear text.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using system properties can be done in the <code>.gradle/gradle.properties</code> file in the user&#8217;s home directory, or by other means, see <a href="#sec:gradle_configuration_properties">Gradle Configuration Properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Specifying the HTTP Basic Authentication credentials using system properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">systemProp.gradle.wrapperUser=username
systemProp.gradle.wrapperPassword=password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Embedding credentials in the <code>distributionUrl</code> in the <code>gradle/wrapper/gradle-wrapper.properties</code> file also works. Please note that this file is to be committed into your source control system. Shared credentials embedded in <code>distributionUrl</code> should only be used in a controlled environment.</p>
</div>
<div class="listingblock">
<div class="title">Specifying the HTTP Basic Authentication credentials in <code>distributionUrl</code></div>
<div class="content">
<pre>distributionUrl=https://username:password@somehost/path/to/gradle-distribution.zip</pre>
</div>
</div>
<div class="paragraph">
<p>This can be used in conjunction with a proxy, authenticated or not. See <a href="#sec:accessing_the_web_via_a_proxy">Accessing the web via a proxy</a> for more information on how to configure the <code>Wrapper</code> to use a proxy.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:verification"><a class="anchor" href="#sec:verification"></a><a class="link" href="#sec:verification">Verification of downloaded Gradle distributions</a></h5>
<div class="paragraph">
<p>The Gradle Wrapper allows for verification of the downloaded Gradle distribution via SHA-256 hash sum comparison. This increases security against targeted attacks by preventing a man-in-the-middle attacker from tampering with the downloaded Gradle distribution.</p>
</div>
<div class="paragraph">
<p>To enable this feature, download the <code>.sha256</code> file associated with the Gradle distribution you want to verify.</p>
</div>
<div class="sect5">
<h6 id="downloading_the_sha_256_file"><a class="anchor" href="#downloading_the_sha_256_file"></a><a class="link" href="#downloading_the_sha_256_file">Downloading the SHA-256 file</a></h6>
<div class="paragraph">
<p>You can download the <code>.sha256</code> file from the <a href="https://services.gradle.org/distributions/">stable releases</a> or <a href="https://services.gradle.org/distributions-snapshots/">release candidate and nightly releases</a>. The format of the file is a single line of text that is the SHA-256 hash of the corresponding zip file.</p>
</div>
<div class="paragraph">
<p>You can also reference the <a href="https://gradle.org/release-checksums/">list of Gradle distribution checksums</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring_checksum_verification"><a class="anchor" href="#configuring_checksum_verification"></a><a class="link" href="#configuring_checksum_verification">Configuring checksum verification</a></h6>
<div class="paragraph">
<p>Add the downloaded hash sum to <code>gradle-wrapper.properties</code> using the <code>distributionSha256Sum</code> property or use <code>--gradle-distribution-sha256-sum</code> on the command-line.</p>
</div>
<div class="listingblock">
<div class="title">Configuring SHA-256 checksum verification</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">distributionSha256Sum=371cb9fbebbe9880d147f59bab36d61eee122854ef8c9ee1ecf12b82368bcf10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle will report a build failure in case the configured checksum does not match the checksum found on the server for hosting the distribution. Checksum Verification is only performed if the configured Wrapper distribution hasn&#8217;t been downloaded yet.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wrapper_checksum_verification"><a class="anchor" href="#wrapper_checksum_verification"></a><a class="link" href="#wrapper_checksum_verification">Verifying the integrity of the Gradle Wrapper JAR</a></h4>
<div class="paragraph">
<p>The Wrapper JAR is a binary file that will be executed on the computers of developers and build servers.
As with all such files, you should be sure that it&#8217;s trustworthy before executing it.
Since the Wrapper JAR is usually checked into a project&#8217;s version control system, there is the potential for a malicious actor to replace the original JAR with a modified one by submitting a pull request that seemingly only upgrades the Gradle version.</p>
</div>
<div class="paragraph">
<p>To verify the integrity of the Wrapper JAR, Gradle has created a <a href="https://github.com/marketplace/actions/gradle-wrapper-validation">GitHub Action</a> that automatically checks Wrapper JARs in pull requests against a list of known good checksums.
Gradle also publishes the <a href="https://gradle.org/release-checksums/">checksums of all releases</a> (except for version 3.3 to 4.0.2, which did not generate reproducible JARs), so you can manually verify the integrity of the Wrapper JAR.</p>
</div>
<div class="sect4">
<h5 id="automatically_verifying_the_gradle_wrapper_jar_on_github"><a class="anchor" href="#automatically_verifying_the_gradle_wrapper_jar_on_github"></a><a class="link" href="#automatically_verifying_the_gradle_wrapper_jar_on_github">Automatically verifying the Gradle Wrapper JAR on GitHub</a></h5>
<div class="paragraph">
<p>The <a href="https://github.com/marketplace/actions/gradle-wrapper-validation">GitHub Action</a> is released separately from Gradle, so please check its documentation for how to apply it to your project.</p>
</div>
</div>
<div class="sect4">
<h5 id="manually_verifying_the_gradle_wrapper_jar"><a class="anchor" href="#manually_verifying_the_gradle_wrapper_jar"></a><a class="link" href="#manually_verifying_the_gradle_wrapper_jar">Manually verifying the Gradle Wrapper JAR</a></h5>
<div class="paragraph">
<p>You can manually verify the checksum of the Wrapper JAR to ensure that it has not been tampered with by running the following commands on one of the major operating systems:</p>
</div>
<div class="listingblock">
<div class="title">Manually verifying the checksum of the Wrapper JAR on Linux</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd gradle/wrapper
$ curl --location --output gradle-wrapper.jar.sha256 \
       https://services.gradle.org/distributions/gradle-6.4.1-wrapper.jar.sha256
$ echo &quot;  gradle-wrapper.jar&quot; &gt;&gt; gradle-wrapper.jar.sha256
$ sha256sum --check gradle-wrapper.jar.sha256
gradle-wrapper.jar: OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Manually verifying the checksum of the Wrapper JAR on macOS</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd gradle/wrapper
$ curl --location --output gradle-wrapper.jar.sha256 \
       https://services.gradle.org/distributions/gradle-6.4.1-wrapper.jar.sha256
$ echo &quot;  gradle-wrapper.jar&quot; &gt;&gt; gradle-wrapper.jar.sha256
$ shasum --check gradle-wrapper.jar.sha256
gradle-wrapper.jar: OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Manually verifying the checksum of the Wrapper JAR on Windows (using PowerShell)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="powershell">&gt; $expected = Invoke-RestMethod -Uri https://services.gradle.org/distributions/gradle-6.4.1-wrapper.jar.sha256
&gt; $actual = (Get-FileHash gradle\wrapper\gradle-wrapper.jar -Algorithm SHA256).Hash.ToLower()
&gt; @{$true = 'OK: Checksum match'; $false = &quot;ERROR: Checksum mismatch!`nExpected: $expected`nActual:   $actual&quot;}[$actual -eq $expected]
OK: Checksum match</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="troubleshooting_a_checksum_mismatch"><a class="anchor" href="#troubleshooting_a_checksum_mismatch"></a><a class="link" href="#troubleshooting_a_checksum_mismatch">Troubleshooting a checksum mismatch</a></h5>
<div class="paragraph">
<p>If the checksum does not match the one you expected, chances are the <code>wrapper</code> task wasn&#8217;t executed with the upgraded Gradle distribution.
Thus, you should first check whether the actual checksum matches the one of a different Gradle version.
Here are the commands you can run on the major operating systems to generate the actual checksum of the Wrapper JAR:</p>
</div>
<div class="listingblock">
<div class="title">Generating the actual checksum of the Wrapper JAR on Linux</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sha256sum gradle/wrapper/gradle-wrapper.jar
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95  gradle/wrapper/gradle-wrapper.jar</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generating the actual checksum of the Wrapper JAR on macOS</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shasum --algorithm=256 gradle/wrapper/gradle-wrapper.jar
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95  gradle/wrapper/gradle-wrapper.jar</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generating the actual checksum of the Wrapper JAR on Windows (using PowerShell)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="powershell">&gt; (Get-FileHash gradle\wrapper\gradle-wrapper.jar -Algorithm SHA256).Hash.ToLower()
d81e0f23ade952b35e55333dd5f1821585e887c6d24305aeea2fbc8dad564b95</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you know the actual checksum, check whether it&#8217;s listed on <a href="https://gradle.org/release-checksums/" class="bare">https://gradle.org/release-checksums/</a>.
If it is listed, you have verified the integrity of the Wrapper JAR.
If the version of Gradle that generated the Wrapper JAR doesn&#8217;t match the version in <code>gradle/wrapper/gradle-wrapper.properties</code>, it&#8217;s safe to run the <code>wrapper</code> task again to update the Wrapper JAR.</p>
</div>
<div class="paragraph">
<p>If the checksum is not listed on the page, the Wrapper JAR might be from a milestone, release candidate, or nightly build or may have been generated by Gradle 3.3 to 4.0.2.
You should try to find out how it was generated but treat it as untrustworthy until proven otherwise.
If you think the Wrapper JAR was compromised, please let the Gradle team know by sending an email to <a href="mailto:security@gradle.com">security@gradle.com</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="directory_layout"><a class="anchor" href="#directory_layout"></a><a class="link" href="#directory_layout">The Directories and Files Gradle Uses</a></h3>
<div class="paragraph">
<p>Gradle uses two main directories to perform and manage its work: the <a href="#dir:gradle_user_home">Gradle user home directory</a> and the <a href="#dir:project_root">Project root directory</a>. The following two sections describe what is stored in each of them and how transient files and directories are cleaned up.</p>
</div>
<div class="sect3">
<h4 id="dir:gradle_user_home"><a class="anchor" href="#dir:gradle_user_home"></a><a class="link" href="#dir:gradle_user_home">Gradle user home directory</a></h4>
<div class="paragraph">
<p>The Gradle user home directory (<code>$USER_HOME/.gradle</code> by default) is used to store global configuration properties and initialization scripts as well as caches and log files. It is roughly structured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> caches // <b class="conum">(1)</b>
  4.8 // <b class="conum">(2)</b>
  4.9 // <b class="conum">(2)</b>
  
  jars-3 // <b class="conum">(3)</b>
  modules-2 // <b class="conum">(3)</b>
 daemon // <b class="conum">(4)</b>
  
  4.8
  4.9
 init.d // <b class="conum">(5)</b>
  my-setup.gradle
 wrapper
    dists // <b class="conum">(6)</b>
        
        gradle-4.8-bin
        gradle-4.9-all
        gradle-4.9-bin
 gradle.properties // <b class="conum">(7)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Global cache directory (for everything that&#8217;s not project-specific)</p>
</li>
<li>
<p>Version-specific caches (e.g. to support incremental builds)</p>
</li>
<li>
<p>Shared caches (e.g. for artifacts of dependencies)</p>
</li>
<li>
<p>Registry and logs of the <a href="#gradle_daemon">Gradle Daemon</a></p>
</li>
<li>
<p>Global <a href="#init_scripts">initialization scripts</a></p>
</li>
<li>
<p>Distributions downloaded by the <a href="#gradle_wrapper">Gradle Wrapper</a></p>
</li>
<li>
<p>Global <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="dir:gradle_user_home:cache_cleanup"><a class="anchor" href="#dir:gradle_user_home:cache_cleanup"></a><a class="link" href="#dir:gradle_user_home:cache_cleanup">Cleanup of caches and distributions</a></h5>
<div class="paragraph">
<p>From version 4.10 onwards, Gradle automatically cleans its user home directory. The cleanup runs in the background when the Gradle daemon is stopped or shuts down. If using <code>--no-daemon</code>, it runs in the foreground after the build session with a visual progress indicator.</p>
</div>
<div class="paragraph">
<p>The following cleanup strategies are applied periodically (at most every 24 hours):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Version-specific caches in <code>caches/&lt;gradle-version&gt;/</code> are checked for whether they are still in use. If not, directories for release versions are deleted after 30 days of inactivity, snapshot versions after 7 days of inactivity.</p>
</li>
<li>
<p>Shared caches in <code>caches/</code> (e.g. <code>jars-*</code>) are checked for whether they are still in use. If there&#8217;s no Gradle version that still uses them, they are deleted.</p>
</li>
<li>
<p>Files in shared caches used by the current Gradle version in <code>caches/</code> (e.g. <code>jars-3</code> or <code>modules-2</code>) are checked for when they were last accessed. Depending on whether the file can be recreated locally or would have to be downloaded from a remote repository again, it will be deleted after 7 or 30 days of not being accessed, respectively.</p>
</li>
<li>
<p>Gradle distributions in <code>wrapper/dists/</code> are checked for whether they are still in use, i.e. whether there&#8217;s a corresponding version-specific cache directory. Unused distributions are deleted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dir:project_root"><a class="anchor" href="#dir:project_root"></a><a class="link" href="#dir:project_root">Project root directory</a></h4>
<div class="paragraph">
<p>The project root directory contains all source files that are part of your project. In addition, it contains files and directories that are generated by Gradle such as <code>.gradle</code> and <code>build</code>. While the former are usually checked in to source control, the latter are transient files used by Gradle to support features like incremental builds. Overall, the anatomy of a typical project root directory looks roughly as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> .gradle // <b class="conum">(1)</b>
  4.8 // <b class="conum">(2)</b>
  4.9 // <b class="conum">(2)</b>
  
 build // <b class="conum">(3)</b>
 gradle
  wrapper  // <b class="conum">(4)</b>
 build.gradle <em>or</em> build.gradle.kts // <b class="conum">(5)</b>
 gradle.properties // <b class="conum">(6)</b>
 gradlew // <b class="conum">(7)</b>
 gradlew.bat // <b class="conum">(7)</b>
 settings.gradle <em>or</em> settings.gradle.kts // <b class="conum">(8)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Project-specific cache directory generated by Gradle</p>
</li>
<li>
<p>Version-specific caches (e.g. to support incremental builds)</p>
</li>
<li>
<p>The build directory of this project into which Gradle generates all build artifacts.</p>
</li>
<li>
<p>Contains the JAR file and configuration of the <a href="#gradle_wrapper">Gradle Wrapper</a></p>
</li>
<li>
<p>The project&#8217;s Gradle build script</p>
</li>
<li>
<p>Project-specific <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a></p>
</li>
<li>
<p>Scripts for executing builds using the <a href="#gradle_wrapper">Gradle Wrapper</a></p>
</li>
<li>
<p>The project&#8217;s <a href="#sec:settings_file">settings file</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="dir:project_root:cache_cleanup"><a class="anchor" href="#dir:project_root:cache_cleanup"></a><a class="link" href="#dir:project_root:cache_cleanup">Project cache cleanup</a></h5>
<div class="paragraph">
<p>From version 4.10 onwards, Gradle automatically cleans the project-specific cache directory. After building the project, version-specific cache directories in <code>.gradle/&lt;gradle-version&gt;/</code> are checked periodically (at most every 24 hours) for whether they are still in use. They are deleted if they haven&#8217;t been used for 7 days.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part:plugins"><a class="anchor" href="#part:plugins"></a><a class="link" href="#part:plugins">Plugins</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="antlr_plugin"><a class="anchor" href="#antlr_plugin"></a><a class="link" href="#antlr_plugin">The ANTLR Plugin</a></h3>
<div class="paragraph">
<p>The ANTLR plugin extends the Java plugin to add support for generating parsers using <a href="http://www.antlr.org/">ANTLR</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The ANTLR plugin supports ANTLR version 2, 3 and 4.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:antlr_usage"><a class="anchor" href="#sec:antlr_usage"></a><a class="link" href="#sec:antlr_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the ANTLR plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 541. Using the ANTLR plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">antlr</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    antlr
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:antlr_tasks"><a class="anchor" href="#sec:antlr_tasks"></a><a class="link" href="#sec:antlr_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The ANTLR plugin adds a number of tasks to your project, as shown below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>generateGrammarSource</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a></dt>
<dd>
<p>Generates the source files for all production ANTLR grammars.</p>
</dd>
<dt class="hdlist1"><code>generateTestGrammarSource</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a></dt>
<dd>
<p>Generates the source files for all test ANTLR grammars.</p>
</dd>
<dt class="hdlist1"><code>generate<em>SourceSet</em>GrammarSource</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a></dt>
<dd>
<p>Generates the source files for all ANTLR grammars for the given source set.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The ANTLR plugin adds the following dependencies to tasks added by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. ANTLR plugin - additional task dependencies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileJava</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>generateGrammarSource</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileTestJava</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>generateTestGrammarSource</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compile<em>SourceSet</em>Java</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>generate<em>SourceSet</em>GrammarSource</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:antlr_project_layout"><a class="anchor" href="#sec:antlr_project_layout"></a><a class="link" href="#sec:antlr_project_layout">Project layout</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/antlr</code></dt>
<dd>
<p>Production ANTLR grammar files. If the ANTLR grammar is organized in packages, the structure in the antlr folder should reflect the package structure. This ensures that the generated sources end up in the correct target subfolder.</p>
</dd>
<dt class="hdlist1"><code>src/test/antlr</code></dt>
<dd>
<p>Test ANTLR grammar files.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/antlr</code></dt>
<dd>
<p>ANTLR grammar files for the given source set.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:antlr_dependency_management"><a class="anchor" href="#sec:antlr_dependency_management"></a><a class="link" href="#sec:antlr_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The ANTLR plugin adds an <code>antlr</code> dependency configuration which provides the ANTLR implementation to use. The following example shows how to use ANTLR version 3.</p>
</div>
<div class="exampleblock">
<div class="title">Example 542. Declare ANTLR version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    antlr <span class="string"><span class="delimiter">&quot;</span><span class="content">org.antlr:antlr:3.5.2</span><span class="delimiter">&quot;</span></span> <span class="comment">// use ANTLR version 3</span>
    <span class="comment">// antlr &quot;org.antlr:antlr4:4.5&quot; // use ANTLR version 4</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    antlr(&quot;org.antlr:antlr:3.5.2&quot;)   // use ANTLR version 3
    // antlr(&quot;org.antlr:antlr4:4.5&quot;) // use ANTLR version 4
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If no dependency is declared, <code>antlr:antlr:2.7.7</code> will be used as the default. To use a different ANTLR version add the appropriate dependency to the <code>antlr</code> dependency configuration as above.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:antlr_convention_properties"><a class="anchor" href="#sec:antlr_convention_properties"></a><a class="link" href="#sec:antlr_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The ANTLR plugin does not add any convention properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:antlr_source_set_properties"><a class="anchor" href="#sec:antlr_source_set_properties"></a><a class="link" href="#sec:antlr_source_set_properties">Source set properties</a></h4>
<div class="paragraph">
<p>The ANTLR plugin adds the following properties to each source set in the project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>antlr</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p>The ANTLR grammar files of this source set. Contains all <code>.g</code> or <code>.g4</code> files found in the ANTLR source directories, and excludes all other types of files. <em>Default value is non-null.</em></p>
</dd>
<dt class="hdlist1"><code>antlr.srcDirs</code>  <code>Set&lt;File&gt;</code></dt>
<dd>
<p>The source directories containing the ANTLR grammar files of this source set.
Can set using anything <a href="#sec:specifying_multiple_files">that implicitly converts to a file collection</a>.
Default value is <code>[<em>projectDir</em>/src/<em>name</em>/antlr]</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:controlling_the_antlr_generator_process"><a class="anchor" href="#sec:controlling_the_antlr_generator_process"></a><a class="link" href="#sec:controlling_the_antlr_generator_process">Controlling the ANTLR generator process</a></h4>
<div class="paragraph">
<p>The ANTLR tool is executed in a forked process. This allows fine grained control over memory settings for the ANTLR process. To set the heap size of an ANTLR process, the <code>maxHeapSize</code> property of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a> can be used. To pass additional command-line arguments, append to the <code>arguments</code> property of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.antlr.AntlrTask.html">AntlrTask</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 543. Setting custom max heap size and extra arguments for ANTLR</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">generateGrammarSource {
    maxHeapSize = <span class="string"><span class="delimiter">&quot;</span><span class="content">64m</span><span class="delimiter">&quot;</span></span>
    arguments += [<span class="string"><span class="delimiter">&quot;</span><span class="content">-visitor</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">-long-messages</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.generateGrammarSource {
    maxHeapSize = &quot;64m&quot;
    arguments = arguments + listOf(&quot;-visitor&quot;, &quot;-long-messages&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application_plugin"><a class="anchor" href="#application_plugin"></a><a class="link" href="#application_plugin">The Application Plugin</a></h3>
<div class="paragraph">
<p>The Application plugin facilitates creating an executable JVM application. It makes it easy to start the application locally during development, and to package the application as a TAR and/or ZIP including operating system specific start scripts.</p>
</div>
<div class="paragraph">
<p>Applying the Application plugin also implicitly applies the <a href="#java_plugin">Java plugin</a>. The <code>main</code> source set is effectively the application.</p>
</div>
<div class="paragraph">
<p>Applying the Application plugin also implicitly applies the <a href="#distribution_plugin">Distribution plugin</a>. A <code>main</code> distribution is created that packages up the application, including code dependencies and generated start scripts.</p>
</div>
<div class="sect3">
<h4 id="sec:application_usage"><a class="anchor" href="#sec:application_usage"></a><a class="link" href="#sec:application_usage">Building JVM applications</a></h4>
<div class="paragraph">
<p>To use the application plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 544. Using the application plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The only mandatory configuration for the plugin is the specification of the main class (i.e. entry point) of the application.</p>
</div>
<div class="exampleblock">
<div class="title">Example 545. Configure the application main class</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.Main</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    mainClass.set(&quot;org.gradle.sample.Main&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can run the application by executing the <code>run</code> task (type: <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/JavaExec.html">JavaExec</a>). This will compile the main source set, and launch a new JVM with its classes (along with all runtime dependencies) as the classpath and using the specified main class. You can launch the application in debug mode with <code>gradle run --debug-jvm</code> (see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/JavaExec.html#setDebug-boolean-">JavaExec.setDebug(boolean)</a>).</p>
</div>
<div class="paragraph">
<p>Since Gradle 4.9, the command line arguments can be passed with <code>--args</code>. For example, if you want to launch the application with command line arguments <code>foo --bar</code>, you can use <code>gradle run --args="foo --bar"</code> (see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/JavaExec.html#setArgsString-java.lang.String-">JavaExec.setArgsString(java.lang.String)</a>.</p>
</div>
<div class="paragraph">
<p>If your application requires a specific set of JVM settings or system properties, you can configure the <code>applicationDefaultJvmArgs</code> property. These JVM arguments are applied to the <code>run</code> task and also considered in the generated start scripts of your distribution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 546. Configure default JVM settings</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    applicationDefaultJvmArgs = [<span class="string"><span class="delimiter">'</span><span class="content">-Dgreeting.language=en</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    applicationDefaultJvmArgs = listOf(&quot;-Dgreeting.language=en&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your application&#8217;s start scripts should be in a different directory than <code>bin</code>, you can configure the <code>executableDir</code> property.</p>
</div>
<div class="exampleblock">
<div class="title">Example 547. Configure custom directory for start scripts</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    executableDir = <span class="string"><span class="delimiter">'</span><span class="content">custom_bin_dir</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    executableDir = &quot;custom_bin_dir&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_modular"><a class="anchor" href="#sec:application_modular"></a><a class="link" href="#sec:application_modular">Building applications using the Java Module System</a></h4>
<div class="paragraph">
<p>Gradle supports the building of <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">Java Modules</a> as described in the <a href="#sec:java_library_modular">corresponding section of the Java Library plugin documentation</a>.
Java modules can also be runnable and you can use the application plugin to run and package such a modular application.
For this, you need to do two things in addition to what you do for a non-modular application.</p>
</div>
<div class="paragraph">
<p>First, you need to add a <code>module-info.java</code> file to describe your application module.
Please refer to the <a href="#sec:java_library_modular">Java Library plugin documentation</a> for more details on this topic.</p>
</div>
<div class="paragraph">
<p>Second, you need to tell Gradle the name of the module you want to run in addition to the main class name like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 548. Configure the modular application&#8217;s main module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    mainModule = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.app</span><span class="delimiter">'</span></span> <span class="comment">// name defined in module-info.java</span>
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample.Main</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    mainModule.set(&quot;org.gradle.sample.app&quot;) // name defined in module-info.java
    mainClass.set(&quot;org.gradle.sample.Main&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all.
If you run your application, by executing the <code>run</code> task or through a <a href="#sec:the_distribution">generated start script</a>, it will run as module and respect module boundaries at runtime.
For example, reflective access to an internal package from another module can fail.</p>
</div>
<div class="paragraph">
<p>The configured <em>main class</em> is also baked into the <code>module-info.class</code> file of your application Jar.
If you run the modular application directly using the <code>java</code> command, it is then sufficient to provide the module name.</p>
</div>
<div class="paragraph">
<p>You can also look at a <a href="../samples/sample_java_modules_multi_project.html">ready made example</a> that includes a modular application as part of a multi-project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Java Module System support is an incubating feature and therefore you need to turn on <em>module path inference</em> explicitly as shown below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 549. Activate module path inference</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    modularity.inferModulePath = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    modularity.inferModulePath.set(true)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:the_distribution"><a class="anchor" href="#sec:the_distribution"></a><a class="link" href="#sec:the_distribution">Building a distribution</a></h4>
<div class="paragraph">
<p>A distribution of the application can be created, by way of the <a href="#distribution_plugin">Distribution plugin</a> (which is automatically applied). A <code>main</code> distribution is created with the following content:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 22. Distribution content</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(root dir)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/dist</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All runtime dependencies and main source set class files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start scripts (generated by <code>startScripts</code> task).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Static files to be added to the distribution can be simply added to <code>src/dist</code>. More advanced customization can be done by configuring the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a> exposed by the main distribution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 550. Include output from other tasks in the application distribution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task createDocs {
    <span class="keyword">def</span> docs = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/docs</span><span class="delimiter">&quot;</span></span>)
    outputs.dir docs
    doLast {
        docs.mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(docs, <span class="string"><span class="delimiter">'</span><span class="content">readme.txt</span><span class="delimiter">'</span></span>).write(<span class="string"><span class="delimiter">'</span><span class="content">Read me!</span><span class="delimiter">'</span></span>)
    }
}

distributions {
    main {
        contents {
            from(createDocs) {
                into <span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val createDocs by tasks.registering {
    val docs = file(&quot;$buildDir/docs&quot;)
    outputs.dir(docs)
    doLast {
        docs.mkdirs()
        File(docs, &quot;readme.txt&quot;).writeText(&quot;Read me!&quot;)
    }
}

distributions {
    main {
        contents {
            from(createDocs) {
                into(&quot;docs&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By specifying that the distribution should include the task&#8217;s output files (see <a href="#sec:task_inputs_outputs">more about tasks</a>), Gradle knows that the task that produces the files must be invoked before the distribution can be assembled and will take care of this for you.</p>
</div>
<div class="paragraph">
<p>You can run <code>gradle installDist</code> to create an image of the application in <code>build/install/<em>projectName</em></code>. You can run <code>gradle distZip</code> to create a ZIP containing the distribution, <code>gradle distTar</code> to create an application TAR or <code>gradle assemble</code> to build both.</p>
</div>
<div class="sect4">
<h5 id="sec:customizing_start_script_generation"><a class="anchor" href="#sec:customizing_start_script_generation"></a><a class="link" href="#sec:customizing_start_script_generation">Customizing start script generation</a></h5>
<div class="paragraph">
<p>The application plugin can generate Unix (suitable for Linux, macOS etc.) and Windows start scripts out of the box.
The start scripts launch a JVM with the specified settings defined as part of the original build and runtime environment (e.g. <code>JAVA_OPTS</code> env var).
The default script templates are based on the same scripts used to launch Gradle itself, that ship as part of a Gradle distribution.</p>
</div>
<div class="paragraph">
<p>The start scripts are completely customizable.
Please refer to the documentation of <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.jvm.application.tasks.CreateStartScripts.html">CreateStartScripts</a> for more details and customization examples.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_tasks"><a class="anchor" href="#sec:application_tasks"></a><a class="link" href="#sec:application_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Application plugin adds the following tasks to the project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>run</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.JavaExec.html">JavaExec</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code></p>
<div class="paragraph">
<p>Starts the application.</p>
</div>
</dd>
<dt class="hdlist1"><code>startScripts</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.jvm.application.tasks.CreateStartScripts.html">CreateStartScripts</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code></p>
<div class="paragraph">
<p>Creates OS specific scripts to run the project as a JVM application.</p>
</div>
</dd>
<dt class="hdlist1"><code>installDist</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Sync.html">Sync</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Installs the application into a specified directory.</p>
</div>
</dd>
<dt class="hdlist1"><code>distZip</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Creates a full distribution ZIP archive including runtime libraries and OS specific scripts.</p>
</div>
</dd>
<dt class="hdlist1"><code>distTar</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, <code>startScripts</code></p>
<div class="paragraph">
<p>Creates a full distribution TAR archive including runtime libraries and OS specific scripts.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_extension"><a class="anchor" href="#sec:application_extension"></a><a class="link" href="#sec:application_extension">Application extension</a></h4>
<div class="paragraph">
<p>The Application Plugin adds an extension to the project, which you can use to configure its behavior. See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.JavaApplication.html">JavaApplication</a> DSL documentation for more information on the properties available on the extension.</p>
</div>
<div class="paragraph">
<p>You can configure the extension via the <code>application {}</code> block shown earlier, for example using the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application {
    executableDir = <span class="string"><span class="delimiter">'</span><span class="content">custom_bin_dir</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application {
    executableDir = &quot;custom_bin_dir&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_licensing"><a class="anchor" href="#sec:application_licensing"></a><a class="link" href="#sec:application_licensing">Licensing</a></h4>
<div class="paragraph">
<p>The Gradle start scripts that are bundled with your application are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 Software License</a>. This does not affect your application, which you can license as you choose.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:application_convention_properties"><a class="anchor" href="#sec:application_convention_properties"></a><a class="link" href="#sec:application_convention_properties">Convention properties (deprecated)</a></h4>
<div class="paragraph">
<p>This plugin also adds some convention properties to the project, which you can use to configure its behavior. These are <strong>deprecated</strong> and superseded by the extension described above. See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#N14FED">Project</a> DSL documentation for information on them.</p>
</div>
<div class="paragraph">
<p>Unlike the extension properties, these properties appear as top-level project properties in the build script. For example, to change the application name you can just add the following to your build script:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">applicationName = <span class="string"><span class="delimiter">'</span><span class="content">my-app</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">application.applicationName = &quot;my-app&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="base_plugin"><a class="anchor" href="#base_plugin"></a><a class="link" href="#base_plugin">The Base Plugin</a></h3>
<div class="paragraph">
<p>The Base Plugin provides some tasks and conventions that are common to most builds and adds a structure to the build that promotes consistency in how they are run. Its most significant contribution is a set of <a href="#sec:lifecycle_tasks"><em>lifecycle</em> tasks</a> that act as an umbrella for the more specific tasks provided by other plugins and build authors.</p>
</div>
<div class="sect3">
<h4 id="sec:base_plugin_usage"><a class="anchor" href="#sec:base_plugin_usage"></a><a class="link" href="#sec:base_plugin_usage">Usage</a></h4>
<div class="exampleblock">
<div class="title">Example 551. Applying the Base Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">base</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    base
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:base_tasks"><a class="anchor" href="#sec:base_tasks"></a><a class="link" href="#sec:base_tasks">Task</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>clean</code>  <code>Delete</code></dt>
<dd>
<p>Deletes the build directory and everything in it, i.e. the path specified by the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:buildDir">Project.getBuildDir()</a> project property.</p>
</dd>
<dt class="hdlist1"><code>check</code> <em>lifecycle task</em></dt>
<dd>
<p>Plugins and build authors should attach their verification tasks, such as ones that run tests, to this lifecycle task using <code>check.dependsOn(<em>task</em>)</code>.</p>
</dd>
<dt class="hdlist1"><code>assemble</code>  <em>lifecycle task</em></dt>
<dd>
<p>Plugins and build authors should attach tasks that produce distributions and other consumable artifacts to this lifecycle task. For example, <code>jar</code> produces the consumable artifact for Java libraries. Attach tasks to this lifecycle task using <code>assemble.dependsOn(<em>task</em>)</code>.</p>
</dd>
<dt class="hdlist1"><code>build</code> <em>lifecycle task</em></dt>
<dd>
<p><em>Depends on</em>: <code>check</code>, <code>assemble</code></p>
<div class="paragraph">
<p>Intended to build everything, including running all tests, producing the production artifacts and generating documentation. You will probably rarely attach concrete tasks directly to <code>build</code> as <code>assemble</code> and <code>check</code> are typically more appropriate.</p>
</div>
</dd>
<dt class="hdlist1"><code>build<em>Configuration</em></code> task rule</dt>
<dd>
<p>Assembles those artifacts attached to the named configuration. For example, <code>buildArchives</code> will execute any task that is required to create any artifact attached to the <code>archives</code> configuration.</p>
</dd>
<dt class="hdlist1"><code>upload<em>Configuration</em></code> task rule</dt>
<dd>
<p>Does the same as <code>build<em>Configuration</em></code>, but also uploads all the artifacts attached to the given configuration.</p>
</dd>
<dt class="hdlist1"><code>clean<em>Task</em></code> task rule</dt>
<dd>
<p>Removes the <a href="#sec:task_inputs_outputs">defined outputs</a> of a task, e.g. <code>cleanJar</code> will delete the JAR file produced by the <code>jar</code> task of the Java Plugin.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:base_plugin_configurations"><a class="anchor" href="#sec:base_plugin_configurations"></a><a class="link" href="#sec:base_plugin_configurations">Dependency management</a></h4>
<div class="paragraph">
<p>The Base Plugin adds no <a href="#sec:what-are-dependency-configurations">configurations for dependencies</a>, but it does add the following configurations for <a href="artifact_management.html#sec:artifacts_and_configurations">artifacts</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default</code></dt>
<dd>
<p>A fallback configuration used by consumer projects. Let&#8217;s say you have project B with a <a href="#sub:project_dependencies">project dependency</a> on project A. Gradle uses some internal logic to determine which of project A&#8217;s artifacts and dependencies are added to the specified configuration of project B. If no other factors apply  you don&#8217;t need to worry what these are then Gradle falls back to using everything in project A&#8217;s <code>default</code> configuration.</p>
<div class="paragraph">
<p><strong>New builds and plugins should not be using the <code>default</code> configuration!</strong> It remains for the reason of backwards compatibility.</p>
</div>
</dd>
<dt class="hdlist1"><code>archives</code></dt>
<dd>
<p>A standard configuration for the production artifacts of a project. This results in an <code>uploadArchives</code> task for publishing artifacts attached to the <code>archives</code> configuration.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that the <code>assemble</code> task generates all artifacts that are attached to the <code>archives</code> configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:base_plugin_conventions"><a class="anchor" href="#sec:base_plugin_conventions"></a><a class="link" href="#sec:base_plugin_conventions">Conventions</a></h4>
<div class="paragraph">
<p>The Base Plugin only adds conventions related to the creation of archives, such as ZIPs, TARs and JARs. Specifically, it provides the following project properties that you can set:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>archivesBaseName</code> default: <code>$project.name</code></dt>
<dd>
<p>Provides the default <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html#org.gradle.api.tasks.bundling.AbstractArchiveTask:archiveBaseName">AbstractArchiveTask.getArchiveBaseName()</a> for archive tasks.</p>
</dd>
<dt class="hdlist1"><code>distsDirName</code> default: <em>distributions</em></dt>
<dd>
<p>Default name of the directory in which distribution archives, i.e. non-JARs, are created.</p>
</dd>
<dt class="hdlist1"><code>libsDirName</code> default: <em>libs</em></dt>
<dd>
<p>Default name of the directory in which library archives, i.e. JARs, are created.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The plugin also provides default values for the following properties on any task that extends <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>destinationDirectory</code></dt>
<dd>
<p>Defaults to <em><code>$buildDir</code>/<code>$distsDirName</code></em> for non-JAR archives and <em><code>$buildDir</code>/<code>$libsDirName</code></em> for JARs and derivatives of JAR, such as WARs.</p>
</dd>
<dt class="hdlist1"><code>archiveVersion</code></dt>
<dd>
<p>Defaults to <code>$project.version</code> or 'unspecified' if the project has no version.</p>
</dd>
<dt class="hdlist1"><code>archiveBaseName</code></dt>
<dd>
<p>Defaults to <code>$archivesBaseName</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build_init_plugin"><a class="anchor" href="#build_init_plugin"></a><a class="link" href="#build_init_plugin">Build Init Plugin</a></h3>
<div class="paragraph">
<p>The Build Init plugin can be used to create a new Gradle build. It supports creating brand new Gradle builds of various types as well as converting existing Apache Maven builds to Gradle.</p>
</div>
<div class="sect3">
<h4 id="supported_gradle_build_types"><a class="anchor" href="#supported_gradle_build_types"></a><a class="link" href="#supported_gradle_build_types">Supported Gradle build types</a></h4>
<div class="paragraph">
<p>The Build Init plugin supports generating various build <em>types</em>. These are listed below and more detail is available about each type in the following <a href="#sec:build_init_types">section</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Build init types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:pom_maven_conversion">pom</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts an existing Apache Maven build to Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:basic">basic</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A basic, empty, Gradle build</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:java_application">java-application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line application implemented in Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:java_gradle_plugin">java-gradle-plugin</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Gradle plugin implemented in Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:java_library">java-library</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:kotlin_application">kotlin-application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line application implemented in Kotlin/JVM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:kotlin_gradle_plugin">kotlin-gradle-plugin</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Gradle plugin implemented in Kotlin/JVM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:kotlin_library">kotlin-library</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Kotlin/JVM library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:groovy_application">groovy-application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line application implemented in Groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:groovy_gradle_plugin">groovy-gradle-plugin</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Gradle plugin implemented in Groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:groovy_library">groovy-library</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Groovy library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:scala_library">scala-library</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Scala library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:cpp_application">cpp-application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line application implemented in C++</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sec:cpp_library">cpp-library</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A C++ library</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:build_init_tasks"><a class="anchor" href="#sec:build_init_tasks"></a><a class="link" href="#sec:build_init_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The plugin adds the following tasks to the project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>init</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.buildinit.tasks.InitBuild.html">InitBuild</a></dt>
<dd>
<p><em>Depends on</em>: <code>wrapper</code></p>
<div class="paragraph">
<p>Generates a Gradle build.</p>
</div>
</dd>
<dt class="hdlist1"><code>wrapper</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.wrapper.Wrapper.html">Wrapper</a></dt>
<dd>
<p>Generates Gradle wrapper files.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Gradle plugins usually need to be <em>applied</em> to a project before they can be used (see <a href="#sec:using_plugins">Using plugins</a>). However, the Build Init plugin is automatically applied to the root project of every build, which means you do not need to apply it explicitly in order to use it. You can simply execute the task named <code>init</code> in the directory where you would like to create the Gradle build. There is no need to create a stub <code>build.gradle</code> file in order to apply the plugin.</p>
</div>
<div class="paragraph">
<p>The Build Init plugin also uses the <code>wrapper</code> task to <a href="#sec:adding_wrapper">generate the Gradle Wrapper files</a> for the build.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:what_to_set_up"><a class="anchor" href="#sec:what_to_set_up"></a><a class="link" href="#sec:what_to_set_up">What to create</a></h4>
<div class="paragraph">
<p>The simplest, and recommended, way to use the <code>init</code> task is to run <code>gradle init</code> from an interactive console. Gradle will list the available build types and ask you to select one. It will then ask some additional questions to allow you to fine-tune the result.</p>
</div>
<div class="paragraph">
<p>There are several command-line options available for the <code>init</code> task that control what it will generate. You can use these when Gradle is not running from an interactive console.</p>
</div>
<div class="paragraph">
<p>The build type can be specified by using the <code>--type</code> command-line option. For example, to create a Java library project run: <code>gradle init --type java-library</code>.</p>
</div>
<div class="paragraph">
<p>If a <code>--type</code> option is not provided, Gradle will attempt to infer the type from the environment. For example, it will infer a type of <code>pom</code> if it finds a <code>pom.xml</code> file to convert to a Gradle build. If the type could not be inferred, the type <code>basic</code> will be used.</p>
</div>
<div class="paragraph">
<p>The <code>init</code> task also supports generating build scripts using either the Gradle Groovy DSL or the Gradle Kotlin DSL. The build script DSL defaults to the Groovy DSL for most build types and to the Kotlin DSL for Kotlin build types. The DSL can be selected by using the <code>--dsl</code> command-line option. For example, to create a Java library project with Kotlin DSL build scripts  run: <code>gradle init --type java-library --dsl kotlin</code>.</p>
</div>
<div class="paragraph">
<p>You can change the name of the generated project using the <code>--project-name</code> option. It defaults to the name of the directory where the <code>init</code> task is run.</p>
</div>
<div class="paragraph">
<p>You can change the package used for generated source files using the <code>--package</code> option. It defaults to the project name.</p>
</div>
<div class="paragraph">
<p>All build types also setup the Gradle wrapper.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:build_init_types"><a class="anchor" href="#sec:build_init_types"></a><a class="link" href="#sec:build_init_types">Build init types</a></h4>
<div class="sect4">
<h5 id="sec:pom_maven_conversion"><a class="anchor" href="#sec:pom_maven_conversion"></a><a class="link" href="#sec:pom_maven_conversion"><code>pom</code> build type (Maven conversion)</a></h5>
<div class="paragraph">
<p>The <code>pom</code> type can be used to convert an Apache Maven build to a Gradle build. This works by converting the POM to one or more Gradle files. It is only able to be used if there is a valid <code>pom.xml</code> file in the directory that the <code>init</code> task is invoked in or, if invoked via the &#8220;-p&#8221; <a href="#command_line_interface">command line option</a>, in the specified project directory. This <code>pom</code> type will be automatically inferred if such a file exists.</p>
</div>
<div class="paragraph">
<p>The Maven conversion implementation was inspired by the <a href="https://github.com/jbaruch/maven2gradle">maven2gradle tool</a> that was originally developed by Gradle community members.</p>
</div>
<div class="paragraph">
<p>Note that the migration from Maven builds currently only supports the Groovy DSL for generated build scripts.</p>
</div>
<div class="paragraph">
<p>The conversion process has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses effective POM and effective settings (support for POM inheritance, dependency management, properties)</p>
</li>
<li>
<p>Supports both single module and multimodule projects</p>
</li>
<li>
<p>Supports custom module names (that differ from directory names)</p>
</li>
<li>
<p>Generates general metadata - id, description and version</p>
</li>
<li>
<p>Applies <a href="#">Maven Publish</a>, <a href="#">Java</a> and <a href="#">War</a> Plugins (as needed)</p>
</li>
<li>
<p>Supports packaging war projects as jars if needed</p>
</li>
<li>
<p>Generates dependencies (both external and inter-module)</p>
</li>
<li>
<p>Generates download repositories (inc. local Maven repository)</p>
</li>
<li>
<p>Adjusts Java compiler settings</p>
</li>
<li>
<p>Supports packaging of sources, tests, and javadocs</p>
</li>
<li>
<p>Supports TestNG runner</p>
</li>
<li>
<p>Generates global exclusions from Maven enforcer plugin settings</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_application"><a class="anchor" href="#sec:java_application"></a><a class="link" href="#sec:java_application"><code>java-application</code> build type</a></h5>
<div class="paragraph">
<p>The <code>java-application</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>application</code> plugin to produce a command-line application implemented in Java</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses <a href="https://junit.org/junit4/">JUnit 4</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample class and unit test, if there are no existing source or test files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternative test framework can be specified by supplying a <code>--test-framework</code> argument value. To use a different test framework, execute one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gradle init --type java-application --test-framework junit-jupiter</code>: Uses <a href="https://junit.org">JUnit Jupiter</a> for testing instead of JUnit 4</p>
</li>
<li>
<p><code>gradle init --type java-application --test-framework spock</code>: Uses <a href="http://code.google.com/p/spock/">Spock</a> for testing instead of JUnit 4</p>
</li>
<li>
<p><code>gradle init --type java-application --test-framework testng</code>: Uses <a href="http://testng.org/doc/index.html">TestNG</a> for testing instead of JUnit 4</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_library"><a class="anchor" href="#sec:java_library"></a><a class="link" href="#sec:java_library"><code>java-library</code> build type</a></h5>
<div class="paragraph">
<p>The <code>java-library</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>java</code> plugin to produce a library implemented in Java</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses <a href="https://junit.org/junit4/">JUnit 4</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample class and unit test, if there are no existing source or test files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternative test framework can be specified by supplying a <code>--test-framework</code> argument value. To use a different test framework, execute one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gradle init --type java-library --test-framework junit-jupiter</code>: Uses <a href="https://junit.org">JUnit Jupiter</a> for testing instead of JUnit 4</p>
</li>
<li>
<p><code>gradle init --type java-library --test-framework spock</code>: Uses <a href="http://code.google.com/p/spock/">Spock</a> for testing instead of JUnit 4</p>
</li>
<li>
<p><code>gradle init --type java-library --test-framework testng</code>: Uses <a href="http://testng.org/doc/index.html">TestNG</a> for testing instead of JUnit 4</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_gradle_plugin"><a class="anchor" href="#sec:java_gradle_plugin"></a><a class="link" href="#sec:java_gradle_plugin"><code>java-gradle-plugin</code> build type</a></h5>
<div class="paragraph">
<p>The <code>java-gradle-plugin</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>java-gradle-plugin</code> plugin to produce a Gradle plugin implemented in Java</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses <a href="https://junit.org/junit4/">JUnit 4</a> and TestKit for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample class and unit test, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_application"><a class="anchor" href="#sec:kotlin_application"></a><a class="link" href="#sec:kotlin_application"><code>kotlin-application</code> build type</a></h5>
<div class="paragraph">
<p>The <code>kotlin-application</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>org.jetbrains.kotlin.jvm</code> and <code>application</code> plugins to produce a command-line application implemented in Kotlin</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Kotlin 1.x</p>
</li>
<li>
<p>Uses <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html">Kotlin test library</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample Kotlin class and an associated Kotlin test class, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_library"><a class="anchor" href="#sec:kotlin_library"></a><a class="link" href="#sec:kotlin_library"><code>kotlin-library</code> build type</a></h5>
<div class="paragraph">
<p>The <code>kotlin-library</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>org.jetbrains.kotlin.jvm</code> plugin to produce a library implemented in Kotlin</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Kotlin 1.x</p>
</li>
<li>
<p>Uses <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html">Kotlin test library</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample Kotlin class and an associated Kotlin test class, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:kotlin_gradle_plugin"><a class="anchor" href="#sec:kotlin_gradle_plugin"></a><a class="link" href="#sec:kotlin_gradle_plugin"><code>kotlin-gradle-plugin</code> build type</a></h5>
<div class="paragraph">
<p>The <code>kotlin-gradle-plugin</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>java-gradle-plugin</code> and <code>org.jetbrains.kotlin.jvm</code> plugins to produce a Gradle plugin implemented in Kotlin</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Kotlin 1.x</p>
</li>
<li>
<p>Uses <a href="https://kotlinlang.org/api/latest/kotlin.test/index.html">Kotlin test library</a> and TestKit for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample class and unit test, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:scala_library"><a class="anchor" href="#sec:scala_library"></a><a class="link" href="#sec:scala_library"><code>scala-library</code> build type</a></h5>
<div class="paragraph">
<p>The <code>scala-library</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>scala</code> plugin to produce a library implemented in Scala</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Scala 2.11</p>
</li>
<li>
<p>Uses <a href="http://www.scalatest.org">ScalaTest</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample Scala class and an associated ScalaTest test suite, if there are no existing source or test files</p>
</li>
<li>
<p>Uses the Zinc Scala compiler by default</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:groovy_library"><a class="anchor" href="#sec:groovy_library"></a><a class="link" href="#sec:groovy_library"><code>groovy-library</code> build type</a></h5>
<div class="paragraph">
<p>The <code>groovy-library</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>groovy</code> plugin to produce a library implemented in Groovy</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Groovy 2.x</p>
</li>
<li>
<p>Uses <a href="http://spockframework.org">Spock testing framework</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample Groovy class and an associated Spock specification, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:groovy_application"><a class="anchor" href="#sec:groovy_application"></a><a class="link" href="#sec:groovy_application"><code>groovy-application</code> build type</a></h5>
<div class="paragraph">
<p>The <code>groovy-application</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>application</code> and <code>groovy</code> plugins to produce a command-line application implemented in Groovy</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Groovy 2.x</p>
</li>
<li>
<p>Uses <a href="http://spockframework.org">Spock testing framework</a> for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample Groovy class and an associated Spock specification, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:groovy_gradle_plugin"><a class="anchor" href="#sec:groovy_gradle_plugin"></a><a class="link" href="#sec:groovy_gradle_plugin"><code>groovy-gradle-plugin</code> build type</a></h5>
<div class="paragraph">
<p>The <code>groovy-gradle-plugin</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>java-gradle-plugin</code> and <code>groovy</code> plugins to produce a Gradle plugin implemented in Groovy</p>
</li>
<li>
<p>Uses the <code>jcenter</code> dependency repository</p>
</li>
<li>
<p>Uses Groovy 2.x</p>
</li>
<li>
<p>Uses <a href="http://spockframework.org">Spock testing framework</a> and TestKit for testing</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample class and unit test, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:cpp_application"><a class="anchor" href="#sec:cpp_application"></a><a class="link" href="#sec:cpp_application"><code>cpp-application</code> build type</a></h5>
<div class="paragraph">
<p>The <code>cpp-application</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>cpp-application</code> plugin to produce a command-line application implemented in C++</p>
</li>
<li>
<p>Uses the <code>cpp-unit-test</code> plugin to build and run simple unit tests</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample C++ class, a private header file and an associated test class, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:cpp_library"><a class="anchor" href="#sec:cpp_library"></a><a class="link" href="#sec:cpp_library"><code>cpp-library</code> build type</a></h5>
<div class="paragraph">
<p>The <code>cpp-library</code> build type is not inferable. It must be explicitly specified.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the <code>cpp-library</code> plugin to produce a C++ library</p>
</li>
<li>
<p>Uses the <code>cpp-unit-test</code> plugin to build and run simple unit tests</p>
</li>
<li>
<p>Has directories in the conventional locations for source code</p>
</li>
<li>
<p>Contains a sample C++ class, a public header file and an associated test class, if there are no existing source or test files</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sec:basic"><a class="anchor" href="#sec:basic"></a><a class="link" href="#sec:basic"><code>basic</code> build type</a></h5>
<div class="paragraph">
<p>The <code>basic</code> build type is useful for creating a new Gradle build. It creates sample settings and build files, with comments and links to help get started.</p>
</div>
<div class="paragraph">
<p>This type is used when no type was explicitly specified, and no type could be inferred.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checkstyle_plugin"><a class="anchor" href="#checkstyle_plugin"></a><a class="link" href="#checkstyle_plugin">The Checkstyle Plugin</a></h3>
<div class="paragraph">
<p>The Checkstyle plugin performs quality checks on your project&#8217;s Java source files using <a href="https://checkstyle.org/index.html">Checkstyle</a> and generates reports from these checks.</p>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_usage"><a class="anchor" href="#sec:checkstyle_usage"></a><a class="link" href="#sec:checkstyle_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Checkstyle plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 552. Using the Checkstyle plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">checkstyle</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    checkstyle
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin adds a number of tasks to the project that perform the quality checks. You can execute the checks by running <code>gradle check</code>.</p>
</div>
<div class="paragraph">
<p>Note that Checkstyle will run with the same Java version used to run Gradle.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_tasks"><a class="anchor" href="#sec:checkstyle_tasks"></a><a class="link" href="#sec:checkstyle_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Checkstyle plugin adds the following tasks to the project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>checkstyleMain</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code></p>
<div class="paragraph">
<p>Runs Checkstyle against the production Java source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>checkstyleTest</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a></dt>
<dd>
<p><em>Depends on</em>: <code>testClasses</code></p>
<div class="paragraph">
<p>Runs Checkstyle against the test Java source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>checkstyle<em>SourceSet</em></code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a></dt>
<dd>
<p><em>Depends on</em>: <code><em>sourceSet</em>Classes</code></p>
<div class="paragraph">
<p>Runs Checkstyle against the given source set&#8217;s Java source files.</p>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="dependencies_added_to_other_tasks"><a class="anchor" href="#dependencies_added_to_other_tasks"></a><a class="link" href="#dependencies_added_to_other_tasks">Dependencies added to other tasks</a></h5>
<div class="paragraph">
<p>The Checkstyle plugin adds the following dependencies to tasks defined by the Java plugin.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>check</code></dt>
<dd>
<p><em>Depends on</em>: All Checkstyle tasks, including <code>checkstyleMain</code> and <code>checkstyleTest</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_project_layout"><a class="anchor" href="#sec:checkstyle_project_layout"></a><a class="link" href="#sec:checkstyle_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>By default, the Checkstyle plugin expects configuration files to be placed in the root project, but this can be changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;root&gt;
 config
     checkstyle           // <b class="conum">(1)</b>
         checkstyle.xml   // <b class="conum">(2)</b>
         suppressions.xml</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Checkstyle configuration files go here</p>
</li>
<li>
<p>Primary Checkstyle configuration file</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_dependency_management"><a class="anchor" href="#sec:checkstyle_dependency_management"></a><a class="link" href="#sec:checkstyle_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The Checkstyle plugin adds the following dependency configurations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Checkstyle plugin - dependency configurations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>checkstyle</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Checkstyle libraries to use</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_configuration"><a class="anchor" href="#sec:checkstyle_configuration"></a><a class="link" href="#sec:checkstyle_configuration">Configuration</a></h4>
<div class="paragraph">
<p>See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CheckstyleExtension.html">CheckstyleExtension</a> class in the API documentation.</p>
</div>
<div class="sect4">
<h5 id="sec:checkstyle_built_in_variables"><a class="anchor" href="#sec:checkstyle_built_in_variables"></a><a class="link" href="#sec:checkstyle_built_in_variables">Built-in variables</a></h5>
<div class="paragraph">
<p>The Checkstyle plugin defines a <code>config_loc</code> property that can be used in Checkstyle configuration files to define paths to other configuration files like <code>suppressions.xml</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 553. Using the config_loc property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">checkstyle.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SuppressionFilter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${config_loc}/suppressions.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/module&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:checkstyle_customize_xsl"><a class="anchor" href="#sec:checkstyle_customize_xsl"></a><a class="link" href="#sec:checkstyle_customize_xsl">Customizing the HTML report</a></h4>
<div class="paragraph">
<p>The HTML report generated by the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Checkstyle.html">Checkstyle</a> task can be customized using a XSLT stylesheet, for example to highlight specific errors or change its appearance:</p>
</div>
<div class="exampleblock">
<div class="title">Example 554. Customizing the HTML report</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Checkstyle) {
    reports {
        xml.enabled <span class="predefined-constant">false</span>
        html.enabled <span class="predefined-constant">true</span>
        html.stylesheet resources.text.fromFile(<span class="string"><span class="delimiter">'</span><span class="content">config/xsl/checkstyle-custom.xsl</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Checkstyle&gt;().configureEach {
    reports {
        xml.isEnabled = false
        html.isEnabled = true
        html.stylesheet = resources.text.fromFile(&quot;config/xsl/checkstyle-custom.xsl&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/checkstyle/contribution/tree/master/xsl">View a sample Checkstyle stylesheet.</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="codenarc_plugin"><a class="anchor" href="#codenarc_plugin"></a><a class="link" href="#codenarc_plugin">The CodeNarc Plugin</a></h3>
<div class="paragraph">
<p>The CodeNarc plugin performs quality checks on your project&#8217;s Groovy source files using <a href="http://codenarc.sourceforge.net/index.html">CodeNarc</a> and generates reports from these checks.</p>
</div>
<div class="sect3">
<h4 id="sec:codenarc_usage"><a class="anchor" href="#sec:codenarc_usage"></a><a class="link" href="#sec:codenarc_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the CodeNarc plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 555. Using the CodeNarc plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">codenarc</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    codenarc
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin adds a number of tasks to the project that perform the quality checks when used with the <a href="#groovy_plugin">Groovy Plugin</a>. You can execute the checks by running <code>gradle check</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:codenarc_tasks"><a class="anchor" href="#sec:codenarc_tasks"></a><a class="link" href="#sec:codenarc_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The CodeNarc plugin adds the following tasks to the project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>codenarcMain</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CodeNarc.html">CodeNarc</a></dt>
<dd>
<div class="paragraph">
<p>Runs CodeNarc against the production Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>codenarcTest</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CodeNarc.html">CodeNarc</a></dt>
<dd>
<div class="paragraph">
<p>Runs CodeNarc against the test Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>codenarc<em>SourceSet</em></code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CodeNarc.html">CodeNarc</a></dt>
<dd>
<div class="paragraph">
<p>Runs CodeNarc against the given source set&#8217;s Groovy source files.</p>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="dependencies_added_to_other_tasks_2"><a class="anchor" href="#dependencies_added_to_other_tasks_2"></a><a class="link" href="#dependencies_added_to_other_tasks_2">Dependencies added to other tasks</a></h5>
<div class="paragraph">
<p>The CodeNarc plugin adds the following dependencies to tasks defined by the Groovy plugin.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>check</code></dt>
<dd>
<p><em>Depends on</em>: All CodeNarc tasks, including <code>codenarcMain</code> and <code>codenarcTest</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:codenarc_project_layout"><a class="anchor" href="#sec:codenarc_project_layout"></a><a class="link" href="#sec:codenarc_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The CodeNarc plugin expects the following project layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;root&gt;
 config
     codenarc           // <b class="conum">(1)</b>
         codenarc.xml   // <b class="conum">(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>CodeNarc configuration files go here</p>
</li>
<li>
<p>Primary CodeNarc configuration file</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:codenarc_dependency_management"><a class="anchor" href="#sec:codenarc_dependency_management"></a><a class="link" href="#sec:codenarc_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The CodeNarc plugin adds the following dependency configurations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. CodeNarc plugin - dependency configurations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>codenarc</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The CodeNarc libraries to use</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:codenarc_configuration"><a class="anchor" href="#sec:codenarc_configuration"></a><a class="link" href="#sec:codenarc_configuration">Configuration</a></h4>
<div class="paragraph">
<p>See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.CodeNarcExtension.html">CodeNarcExtension</a> class in the API documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distribution_plugin"><a class="anchor" href="#distribution_plugin"></a><a class="link" href="#distribution_plugin">The Distribution Plugin</a></h3>
<div class="paragraph">
<p>The Distribution Plugin facilitates building archives that serve as distributions of the project. Distribution archives typically contain the executable application and other supporting files, such as documentation.</p>
</div>
<div class="sect3">
<h4 id="sec:distribution_usage"><a class="anchor" href="#sec:distribution_usage"></a><a class="link" href="#sec:distribution_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Distribution Plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 556. Using the Distribution Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">distribution</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    distribution
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin adds an extension named <code>distributions</code> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.distribution.DistributionContainer.html">DistributionContainer</a> to the project. It also creates a single distribution in the distributions container extension named <code>main</code>. If your build only produces one distribution you only need to configure this distribution (or use the defaults).</p>
</div>
<div class="paragraph">
<p>You can run <code>gradle distZip</code> to package the main distribution as a ZIP, or <code>gradle distTar</code> to create a TAR file. To build both types of archives just run <code>gradle assembleDist</code>. The files will be created at <code><em>$buildDir</em>/distributions/<em>${project.name}</em>-<em>${project.version}</em>.<em>ext</em></code>.</p>
</div>
<div class="paragraph">
<p>You can run <code>gradle installDist</code> to assemble the uncompressed distribution into <code><em>$buildDir</em>/install/<em>${project.name}</em></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:distribution_tasks"><a class="anchor" href="#sec:distribution_tasks"></a><a class="link" href="#sec:distribution_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Distribution Plugin adds a number of tasks to your project, as shown below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>distZip</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a></dt>
<dd>
<p>Creates a ZIP archive of the distribution contents.</p>
</dd>
<dt class="hdlist1"><code>distTar</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a></dt>
<dd>
<p>Creates a TAR archive of the distribution contents.</p>
</dd>
<dt class="hdlist1"><code>assembleDist</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a></dt>
<dd>
<p><em>Depends on</em>: <code>distTar</code>, <code>distZip</code></p>
<div class="paragraph">
<p>Creates ZIP and TAR archives of the distribution contents.</p>
</div>
</dd>
<dt class="hdlist1"><code>installDist</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Sync.html">Sync</a></dt>
<dd>
<p>Assembles the distribution content and installs it on the current machine.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For each additional distribution you add to the project, the Distribution Plugin adds the following tasks, where <em>distributionName</em> comes from <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/distribution/Distribution.html#getName--">Distribution.getName()</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>distributionName</em>DistZip</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a></dt>
<dd>
<p>Creates a ZIP archive of the distribution contents.</p>
</dd>
<dt class="hdlist1"><code><em>distributionName</em>DistTar</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a></dt>
<dd>
<p>Creates a TAR archive of the distribution contents.</p>
</dd>
<dt class="hdlist1"><code>assemble<em>DistributionName</em>Dist</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a></dt>
<dd>
<p><em>Depends on</em>: <code><em>distributionName</em>DistTar</code>, <code><em>distributionName</em>DistZip</code></p>
<div class="paragraph">
<p>Creates ZIP and TAR archives of the distribution contents.</p>
</div>
</dd>
<dt class="hdlist1"><code>install<em>DistributionName</em>Dist</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Sync.html">Sync</a></dt>
<dd>
<p>Assembles the distribution content and installs it on the current machine.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following sample creates a <code>custom</code> distribution that will cause four additional tasks to be added to the project: <code>customDistZip</code>, <code>customDistTar</code>, <code>assembleCustomDist</code>, and <code>installCustomDist</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 557. Adding extra distributions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">distributions {
    custom {
        <span class="comment">// configure custom distribution</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">distributions {
    create(&quot;custom&quot;) {
        // configure custom distribution
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given that the project name is <code>myproject</code> and version <code>1.2</code>, running <code>gradle customDistZip</code> will produce a ZIP file named <code>myproject-custom-1.2.zip</code>.</p>
</div>
<div class="paragraph">
<p>Running <code>gradle installCustomDist</code> will install the distribution contents into <code><em>$buildDir</em>/install/custom</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:distribution_contents"><a class="anchor" href="#sec:distribution_contents"></a><a class="link" href="#sec:distribution_contents">Distribution contents</a></h4>
<div class="paragraph">
<p>All of the files in the <code>src/<em>$distribution.name</em>/dist</code> directory will automatically be included in the distribution. You can add additional files by configuring the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/distribution/Distribution.html">Distribution</a> object that is part of the container.</p>
</div>
<div class="exampleblock">
<div class="title">Example 558. Configuring the main distribution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">distributions {
    main {
        distributionBaseName = <span class="string"><span class="delimiter">'</span><span class="content">someName</span><span class="delimiter">'</span></span>
        contents {
            from <span class="string"><span class="delimiter">'</span><span class="content">src/readme</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">distributions {
    main {
        distributionBaseName.set(&quot;someName&quot;)
        contents {
            from(&quot;src/readme&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the content of the <code>src/readme</code> directory will be included in the distribution (along with the files in the <code>src/main/dist</code> directory which are added by default).</p>
</div>
<div class="paragraph">
<p>The <code>baseName</code> property has also been changed. This will cause the distribution archives to be created with a different name.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_distributions"><a class="anchor" href="#sec:publishing_distributions"></a><a class="link" href="#sec:publishing_distributions">Publishing</a></h4>
<div class="paragraph">
<p>A distribution can be published using the <a href="#publishing_ivy">Ivy Publish Plugin</a> or <a href="#publishing_maven">Maven Publish Plugin</a>, or via the <em>original</em> publishing mechanism using the <code>uploadArchives</code> task.</p>
</div>
<div class="sect4">
<h5 id="sec:publishing_distributions_publish_plugins"><a class="anchor" href="#sec:publishing_distributions_publish_plugins"></a><a class="link" href="#sec:publishing_distributions_publish_plugins">Using the Ivy/Maven Publish Plugins</a></h5>
<div class="paragraph">
<p>To publish a distribution to an Ivy repository with the <a href="#publishing_ivy">Ivy Publish Plugin</a>, simply add one or both of its archive tasks to an <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>. The following sample demonstrates how to add the ZIP archive of the <code>main</code> distribution and the TAR archive of the <code>custom</code> distribution to the <code>myDistribution</code> publication:</p>
</div>
<div class="exampleblock">
<div class="title">Example 559. Adding distribution archives to an Ivy publication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}

publishing {
    publications {
        myDistribution(IvyPublication) {
            artifact distZip
            artifact customDistTar
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `ivy-publish`
}

publishing {
    publications {
        create&lt;IvyPublication&gt;(&quot;myDistribution&quot;) {
            artifact(tasks.distZip.get())
            artifact(tasks[&quot;customDistTar&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, to publish a distribution to a Maven repository using the <a href="#publishing_maven">Maven Publish Plugin</a>, add one or both of its archive tasks to a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a> as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 560. Adding distribution archives to a Maven publication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}

publishing {
    publications {
        myDistribution(MavenPublication) {
            artifact distZip
            artifact customDistTar
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `maven-publish`
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myDistribution&quot;) {
            artifact(tasks.distZip.get())
            artifact(tasks[&quot;customDistTar&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:publishing_distributions_upload"><a class="anchor" href="#sec:publishing_distributions_upload"></a><a class="link" href="#sec:publishing_distributions_upload">Using the <code>uploadArchives</code> task</a></h5>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>uploadArchives</code> and <code>maven</code> plugin are deprecated.
You should use the <code>ivy-publish</code> or <code>maven-publish</code> plugin instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Distribution Plugin adds the distribution archives as default publishing artifact candidates.
With the <a href="#maven_plugin">Maven Plugin</a> applied, the distribution ZIP file will be published when running <code>uploadArchives</code> if no other default artifact is configured.</p>
</div>
<div class="exampleblock">
<div class="title">Example 561. Publishing the distribution ZIP with the Maven Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>
}

uploadArchives {
    repositories {
        mavenDeployer {
            repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">file://some/repo</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    maven
}

tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            &quot;repository&quot;(&quot;url&quot; to &quot;file://some/repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ear_plugin"><a class="anchor" href="#ear_plugin"></a><a class="link" href="#ear_plugin">The Ear Plugin</a></h3>
<div class="paragraph">
<p>The Ear plugin adds support for assembling web application EAR files.
It adds a default EAR archive task.
It doesn&#8217;t require the <a href="#">Java plugin</a>, but for projects that also use the Java plugin it disables the default JAR archive generation.</p>
</div>
<div class="sect3">
<h4 id="sec:ear_usage"><a class="anchor" href="#sec:ear_usage"></a><a class="link" href="#sec:ear_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Ear plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 562. Using the Ear plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">ear</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    ear
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_tasks"><a class="anchor" href="#sec:ear_tasks"></a><a class="link" href="#sec:ear_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Ear plugin adds the following tasks to the project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ear</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile</code> (only if the Java plugin is also applied)</p>
<div class="paragraph">
<p>Assembles the application EAR file.</p>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="dependencies_added_to_other_tasks_3"><a class="anchor" href="#dependencies_added_to_other_tasks_3"></a><a class="link" href="#dependencies_added_to_other_tasks_3">Dependencies added to other tasks</a></h5>
<div class="paragraph">
<p>The Ear plugin adds the following dependencies to tasks added by the <a href="#base_plugin">Base Plugin</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>assemble</code></dt>
<dd>
<p><em>Depends on</em>: <code>ear</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_project_layout"><a class="anchor" href="#sec:ear_project_layout"></a><a class="link" href="#sec:ear_project_layout">Project layout</a></h4>
<div class="listingblock">
<div class="content">
<pre>.
 src
     main
         application // <b class="conum">(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ear resources, such as a META-INF directory</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_dependency_management"><a class="anchor" href="#sec:ear_dependency_management"></a><a class="link" href="#sec:ear_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The Ear plugin adds two dependency configurations: <code>deploy</code> and <code>earlib</code>. All dependencies in the <code>deploy</code> configuration are placed in the root of the EAR archive, and are <em>not</em> transitive. All dependencies in the <code>earlib</code> configuration are placed in the 'lib' directory in the EAR archive and <em>are</em> transitive.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_convention_properties"><a class="anchor" href="#sec:ear_convention_properties"></a><a class="link" href="#sec:ear_convention_properties">Convention properties</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>appDirName</code>  <code>String</code></dt>
<dd>
<p>The name of the application source directory, relative to the project directory. <em>Default value: `src/main/application`</em>.</p>
</dd>
<dt class="hdlist1"><code>libDirName</code>  <code>String</code></dt>
<dd>
<p>The name of the lib directory inside the generated EAR. <em>Default value: `lib`</em>.</p>
</dd>
<dt class="hdlist1"><code>deploymentDescriptor</code>  <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ear/descriptor/DeploymentDescriptor.html">DeploymentDescriptor</a></dt>
<dd>
<p>Metadata to generate a deployment descriptor file, e.g. <code>application.xml</code>. <em>Default value: A deployment descriptor with sensible defaults named <code>application.xml`</em>. If this file already exists in the `appDirName/META-INF</code> then the existing file contents will be used and the explicit configuration in the <code>ear.deploymentDescriptor</code> will be ignored.</p>
</dd>
<dt class="hdlist1"><code>generateDeploymentDescriptor</code>  <code>Boolean</code></dt>
<dd>
<p>Specifies if deploymentDescriptor should be generated. <em>Default value: `true`</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.EarPluginConvention.html">EarPluginConvention</a> convention object.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_default_settings"><a class="anchor" href="#sec:ear_default_settings"></a><a class="link" href="#sec:ear_default_settings">Ear</a></h4>
<div class="paragraph">
<p>The default behavior of the Ear task is to copy the content of <code>src/main/application</code> to the root of the archive. If your <code>application</code> directory doesn&#8217;t contain a <code>META-INF/application.xml</code> deployment descriptor then one will be generated for you.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a> class in the API documentation has additional useful information.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:ear_customizing"><a class="anchor" href="#sec:ear_customizing"></a><a class="link" href="#sec:ear_customizing">Customizing</a></h4>
<div class="paragraph">
<p>Here is an example with the most important customization options:</p>
</div>
<div class="exampleblock">
<div class="title">Example 563. Customization of ear plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">ear</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}

repositories { mavenCentral() }

dependencies {
    <span class="comment">// The following dependencies will be the ear modules and</span>
    <span class="comment">// will be placed in the ear root</span>
    deploy project(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">:war</span><span class="delimiter">'</span></span>, <span class="key">configuration</span>: <span class="string"><span class="delimiter">'</span><span class="content">archives</span><span class="delimiter">'</span></span>)

    <span class="comment">// The following dependencies will become ear libs and will</span>
    <span class="comment">// be placed in a dir configured via the libDirName property</span>
    earlib <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">1.2.15</span><span class="delimiter">'</span></span>, <span class="key">ext</span>: <span class="string"><span class="delimiter">'</span><span class="content">jar</span><span class="delimiter">'</span></span>
}

ear {
    appDirName <span class="string"><span class="delimiter">'</span><span class="content">src/main/app</span><span class="delimiter">'</span></span>  <span class="comment">// use application metadata found in this folder</span>
    <span class="comment">// put dependent libraries into APP-INF/lib inside the generated EAR</span>
    libDirName <span class="string"><span class="delimiter">'</span><span class="content">APP-INF/lib</span><span class="delimiter">'</span></span>
    deploymentDescriptor {  <span class="comment">// custom entries for application.xml:</span>
<span class="comment">//      fileName = &quot;application.xml&quot;  // same as the default value</span>
<span class="comment">//      version = &quot;6&quot;  // same as the default value</span>
        applicationName = <span class="string"><span class="delimiter">&quot;</span><span class="content">customear</span><span class="delimiter">&quot;</span></span>
        initializeInOrder = <span class="predefined-constant">true</span>
        displayName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Custom Ear</span><span class="delimiter">&quot;</span></span>  <span class="comment">// defaults to project.name</span>
        <span class="comment">// defaults to project.description if not set</span>
        description = <span class="string"><span class="delimiter">&quot;</span><span class="content">My customized EAR for the Gradle documentation</span><span class="delimiter">&quot;</span></span>
<span class="comment">//      libraryDirectory = &quot;APP-INF/lib&quot;  // not needed, above libDirName setting does this</span>
<span class="comment">//      module(&quot;my.jar&quot;, &quot;java&quot;)  // won't deploy as my.jar isn't deploy dependency</span>
<span class="comment">//      webModule(&quot;my.war&quot;, &quot;/&quot;)  // won't deploy as my.war isn't deploy dependency</span>
        securityRole <span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>
        securityRole <span class="string"><span class="delimiter">&quot;</span><span class="content">superadmin</span><span class="delimiter">&quot;</span></span>
        withXml { provider -&gt; <span class="comment">// add a custom node to the XML</span>
            provider.asNode().appendNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">data-source</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my/data/source</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins  {
    ear
    java
}

repositories { mavenCentral() }

dependencies {
    // The following dependencies will be the ear modules and
    // will be placed in the ear root
    deploy(project(path = &quot;:war&quot;, configuration = &quot;archives&quot;))

    // The following dependencies will become ear libs and will
    // be placed in a dir configured via the libDirName property
    earlib(group = &quot;log4j&quot;, name = &quot;log4j&quot;, version = &quot;1.2.15&quot;, ext = &quot;jar&quot;)
}

ear {
    appDirName = &quot;src/main/app&quot;  // use application metadata found in this folder
    // put dependent libraries into APP-INF/lib inside the generated EAR
    libDirName = &quot;APP-INF/lib&quot;
    deploymentDescriptor {  // custom entries for application.xml:
//      fileName = &quot;application.xml&quot;  // same as the default value
//      version = &quot;6&quot;  // same as the default value
        applicationName = &quot;customear&quot;
        initializeInOrder = true
        displayName = &quot;Custom Ear&quot;  // defaults to project.name
        // defaults to project.description if not set
        description = &quot;My customized EAR for the Gradle documentation&quot;
//      libraryDirectory = &quot;APP-INF/lib&quot;  // not needed, above libDirName setting does this
//      module(&quot;my.jar&quot;, &quot;java&quot;)  // won't deploy as my.jar isn't deploy dependency
//      webModule(&quot;my.war&quot;, &quot;/&quot;)  // won't deploy as my.war isn't deploy dependency
        securityRole(&quot;admin&quot;)
        securityRole(&quot;superadmin&quot;)
        withXml { // add a custom node to the XML
            asElement().apply {
                appendChild(ownerDocument.createElement(&quot;data-source&quot;).apply { textContent = &quot;my/data/source&quot; })
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also use customization options that the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a> task provides, such as <code>from</code> and <code>metaInf</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_custom_app_xml"><a class="anchor" href="#sec:using_custom_app_xml"></a><a class="link" href="#sec:using_custom_app_xml">Using custom descriptor file</a></h4>
<div class="paragraph">
<p>You may already have appropriate settings in a <code>application.xml</code> file and want to use that instead of configuring the <code>ear.deploymentDescriptor</code> section of the build script. To accommodate that goal, place the <code>META-INF/application.xml</code> in the right place inside your source folders (see the <code>appDirName</code> property). The file contents will be used and the explicit configuration in the <code>ear.deploymentDescriptor</code> will be ignored.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipse_plugin"><a class="anchor" href="#eclipse_plugin"></a><a class="link" href="#eclipse_plugin">The Eclipse Plugins</a></h3>
<div class="paragraph">
<p>The Eclipse plugins generate files that are used by the <a href="http://eclipse.org">Eclipse IDE</a>, thus making it possible to import the project into Eclipse (<code>File</code> - <code>Import&#8230;&#8203;</code> - <code>Existing Projects into Workspace</code>).</p>
</div>
<div class="paragraph">
<p>The <code>eclipse-wtp</code> is automatically applied whenever the <code>eclipse</code> plugin is applied to a <a href="#war_plugin">War</a> or <a href="#ear_plugin">Ear</a> project. For utility projects (i.e. <a href="#java_plugin">Java</a> projects used by other web projects), you need to apply the <code>eclipse-wtp</code> plugin explicitly.</p>
</div>
<div class="paragraph">
<p>What exactly the <code>eclipse</code> plugin generates depends on which other plugins are used:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 26. Eclipse plugin behavior</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Plugin</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates minimal <code>.project</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#java_plugin">Java</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds Java configuration to <code>.project</code>. Generates <code>.classpath</code> and JDT settings file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#groovy_plugin">Groovy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds Groovy configuration to <code>.project</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#scala_plugin">Scala</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds Scala support to <code>.project</code> and <code>.classpath</code> files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#war_plugin">War</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds web application support to <code>.project</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ear_plugin">Ear</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds ear application support to <code>.project</code> file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>eclipse-wtp</code> plugin generates all WTP settings files and enhances the <code>.project</code> file. If a <a href="#java_plugin">Java</a> or <a href="#war_plugin">War</a> is applied, <code>.classpath</code> will be extended to get a proper packaging structure for this utility library or web application project.</p>
</div>
<div class="paragraph">
<p>Both Eclipse plugins are open to customization and provide a standardized set of hooks for adding and removing content from the generated files.</p>
</div>
<div class="sect3">
<h4 id="sec:eclipse_usage"><a class="anchor" href="#sec:eclipse_usage"></a><a class="link" href="#sec:eclipse_usage">Usage</a></h4>
<div class="paragraph">
<p>To use either the Eclipse or the Eclipse WTP plugin, include one of the lines in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 564. Using the Eclipse plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">eclipse</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    eclipse
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 565. Using the Eclipse WTP plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">eclipse-wtp</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `eclipse-wtp`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Note:</em> Internally, the <code>eclipse-wtp</code> plugin also applies the <code>eclipse</code> plugin so you don&#8217;t need to apply both.</p>
</div>
<div class="paragraph">
<p>Both Eclipse plugins add a number of tasks to your projects. The main tasks that you will use are the <code>eclipse</code> and <code>cleanEclipse</code> tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:eclipse_tasks"><a class="anchor" href="#sec:eclipse_tasks"></a><a class="link" href="#sec:eclipse_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Eclipse plugins add the tasks shown below to a project.</p>
</div>
<div class="sect4">
<h5 id="eclipsetasks"><a class="anchor" href="#eclipsetasks"></a><a class="link" href="#eclipsetasks">Eclipse Plugin tasks</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>eclipse</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a></dt>
<dd>
<p><em>Depends on</em>: all Eclipse configuration file generation tasks</p>
<div class="paragraph">
<p>Generates all Eclipse configuration files</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanEclipse</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p><em>Depends on</em>: all Eclipse configuration file clean tasks</p>
<div class="paragraph">
<p>Removes all Eclipse configuration files</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanEclipseProject</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<div class="paragraph">
<p>Removes the <code>.project</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanEclipseClasspath</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<div class="paragraph">
<p>Removes the <code>.classpath</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanEclipseJdt</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<div class="paragraph">
<p>Removes the <code>.settings/org.eclipse.jdt.core.prefs</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>eclipseProject</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.GenerateEclipseProject.html">GenerateEclipseProject</a></dt>
<dd>
<div class="paragraph">
<p>Generates the <code>.project</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>eclipseClasspath</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.GenerateEclipseClasspath.html">GenerateEclipseClasspath</a></dt>
<dd>
<div class="paragraph">
<p>Generates the <code>.classpath</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>eclipseJdt</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.GenerateEclipseJdt.html">GenerateEclipseJdt</a></dt>
<dd>
<div class="paragraph">
<p>Generates the <code>.settings/org.eclipse.jdt.core.prefs</code> file.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="eclipsewtptasks"><a class="anchor" href="#eclipsewtptasks"></a><a class="link" href="#eclipsewtptasks">Eclipse WTP Plugin  additional tasks</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>cleanEclipseWtpComponent</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<div class="paragraph">
<p>Removes the <code>.settings/org.eclipse.wst.common.component</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanEclipseWtpFacet</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<div class="paragraph">
<p>Removes the <code>.settings/org.eclipse.wst.common.project.facet.core.xml</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>eclipseWtpComponent</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.GenerateEclipseWtpComponent.html">GenerateEclipseWtpComponent</a></dt>
<dd>
<div class="paragraph">
<p>Generates the <code>.settings/org.eclipse.wst.common.component</code> file.</p>
</div>
</dd>
<dt class="hdlist1"><code>eclipseWtpFacet</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.GenerateEclipseWtpFacet.html">GenerateEclipseWtpFacet</a></dt>
<dd>
<div class="paragraph">
<p>Generates the <code>.settings/org.eclipse.wst.common.project.facet.core.xml</code> file.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:eclipse_configuration"><a class="anchor" href="#sec:eclipse_configuration"></a><a class="link" href="#sec:eclipse_configuration">Configuration</a></h4>
<table id="eclipse-configuration" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 27. Configuration of the Eclipse plugins</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Reference name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseModel.html">EclipseModel</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top level element that enables configuration of the Eclipse plugin in a DSL-friendly fashion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseProject.html">EclipseProject</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse.project</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring project information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseClasspath.html">EclipseClasspath</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse.classpath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring classpath information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseJdt.html">EclipseJdt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse.jdt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring jdt information (source/target Java compatibility).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseWtpComponent.html">EclipseWtpComponent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse.wtp.component</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring wtp component information only if <code>eclipse-wtp</code> plugin was applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseWtpFacet.html">EclipseWtpFacet</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eclipse.wtp.facet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring wtp facet information only if <code>eclipse-wtp</code> plugin was applied.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:eclipse_customizing_the_generated_files"><a class="anchor" href="#sec:eclipse_customizing_the_generated_files"></a><a class="link" href="#sec:eclipse_customizing_the_generated_files">Customizing the generated files</a></h4>
<div class="paragraph">
<p>The Eclipse plugins allow you to customize the generated metadata files. The plugins provide a DSL for configuring model objects that model the Eclipse view of the project. These model objects are then merged with the existing Eclipse XML metadata to ultimately generate new metadata. The model objects provide lower level hooks for working with domain objects representing the file content before and after merging with the model configuration. They also provide a very low level hook for working directly with the raw XML for adjustment before it is persisted, for fine tuning and configuration that the Eclipse and Eclipse WTP plugins do not model.</p>
</div>
<div class="sect4">
<h5 id="sec:merging_with_eclipse_files"><a class="anchor" href="#sec:merging_with_eclipse_files"></a><a class="link" href="#sec:merging_with_eclipse_files">Merging</a></h5>
<div class="paragraph">
<p>Sections of existing Eclipse files that are also the target of generated content will be amended or overwritten, depending on the particular section. The remaining sections will be left as-is.</p>
</div>
<div class="sect5">
<h6 id="sec:complete_rewrite_of_eclipse_files"><a class="anchor" href="#sec:complete_rewrite_of_eclipse_files"></a><a class="link" href="#sec:complete_rewrite_of_eclipse_files">Disabling merging with a complete rewrite</a></h6>
<div class="paragraph">
<p>To completely rewrite existing Eclipse files, execute a clean task together with its corresponding generation task, like <code>gradle cleanEclipse eclipse</code> (in that order). If you want to make this the default behavior, add <code>tasks.eclipse.dependsOn(cleanEclipse)</code> to your build script. This makes it unnecessary to execute the clean task explicitly.</p>
</div>
<div class="paragraph">
<p>This strategy can also be used for individual files that the plugins would generate. For instance, this can be done for the <code>.classpath</code> file with <code>gradle cleanEclipseClasspath eclipseClasspath</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:hooking_into_the_eclipse_generation_lifecycle"><a class="anchor" href="#sec:hooking_into_the_eclipse_generation_lifecycle"></a><a class="link" href="#sec:hooking_into_the_eclipse_generation_lifecycle">Hooking into the generation lifecycle</a></h5>
<div class="paragraph">
<p>The Eclipse plugins provide objects modeling the sections of the Eclipse files that are generated by Gradle. The generation lifecycle is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The file is read; or a default version provided by Gradle is used if it does not exist</p>
</li>
<li>
<p>The <code>beforeMerged</code> hook is executed with a domain object representing the existing file</p>
</li>
<li>
<p>The existing content is merged with the configuration inferred from the Gradle build or defined explicitly in the eclipse DSL</p>
</li>
<li>
<p>The <code>whenMerged</code> hook is executed with a domain object representing contents of the file to be persisted</p>
</li>
<li>
<p>The <code>withXml</code> hook is executed with a raw representation of the XML that will be persisted</p>
</li>
<li>
<p>The final XML is persisted</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="eclipse-plugin-hooks"><a class="anchor" href="#eclipse-plugin-hooks"></a><a class="link" href="#eclipse-plugin-hooks">Advanced configuration hooks</a></h6>
<div class="paragraph">
<p>The following list covers the domain object used for each of the Eclipse model types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseProject.html">EclipseProject</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Project.html">Project</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Project.html">Project</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseClasspath.html">EclipseClasspath</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Classpath.html">Classpath</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Classpath.html">Classpath</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseWtpComponent.html">EclipseWtpComponent</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/WtpComponent.html">WtpComponent</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/WtpComponent.html">WtpComponent</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseWtpFacet.html">EclipseWtpFacet</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/WtpFacet.html">WtpFacet</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/WtpFacet.html">WtpFacet</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.eclipse.model.EclipseJdt.html">EclipseJdt</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Jdt.html">Jdt</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/eclipse/model/Jdt.html">Jdt</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withProperties { arg -&gt; }</code> argument type &#8658; <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Properties.html"><code>java.util.Properties</code></a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="sec:partial-overwrite"><a class="anchor" href="#sec:partial-overwrite"></a><a class="link" href="#sec:partial-overwrite">Partial overwrite of existing content</a></h6>
<div class="paragraph">
<p>A complete overwrite causes all existing content to be discarded, thereby losing any changes made directly in the IDE. Alternatively, the <code>beforeMerged</code> hook makes it possible to overwrite just certain parts of the existing content. The following example removes all existing dependencies from the <code>Classpath</code> domain object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 566. Partial Overwrite for Classpath</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">eclipse.classpath.file {
    beforeMerged { classpath -&gt;
        classpath.entries.removeAll { entry -&gt; entry.kind == <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span> || entry.kind == <span class="string"><span class="delimiter">'</span><span class="content">var</span><span class="delimiter">'</span></span> }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.eclipse.model.Classpath

eclipse.classpath.file {
    beforeMerged(Action&lt;Classpath&gt; {
        entries.removeAll { entry -&gt; entry.kind == &quot;lib&quot; || entry.kind == &quot;var&quot; }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resulting <code>.classpath</code> file will only contain Gradle-generated dependency entries, but not any other dependency entries that may have been present in the original file. (In the case of dependency entries, this is also the default behavior.) Other sections of the <code>.classpath</code> file will be either left as-is or merged. The same could be done for the natures in the <code>.project</code> file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 567. Partial Overwrite for Project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">eclipse.project.file.beforeMerged { project -&gt;
    project.natures.clear()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.eclipse.model.Project

eclipse.project.file.beforeMerged(Action&lt;Project&gt; {
    natures.clear()
})</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:eclipse_modify_domain_objects"><a class="anchor" href="#sec:eclipse_modify_domain_objects"></a><a class="link" href="#sec:eclipse_modify_domain_objects">Modifying the fully populated domain objects</a></h6>
<div class="paragraph">
<p>The <code>whenMerged</code> hook allows to manipulate the fully populated domain objects. Often this is the preferred way to customize Eclipse files. Here is how you would export all the dependencies of an Eclipse project:</p>
</div>
<div class="exampleblock">
<div class="title">Example 568. Export Classpath Entries</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">eclipse.classpath.file {
    whenMerged { classpath -&gt;
        classpath.entries.findAll { entry -&gt; entry.kind == <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span> }*.exported = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.eclipse.model.AbstractClasspathEntry
import org.gradle.plugins.ide.eclipse.model.Classpath

eclipse.classpath.file {
    whenMerged(Action&lt;Classpath&gt; { -&gt;
        entries.filter { entry -&gt; entry.kind == &quot;lib&quot; }
            .forEach { (it as AbstractClasspathEntry).isExported = false }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:eclipse_modify_xml"><a class="anchor" href="#sec:eclipse_modify_xml"></a><a class="link" href="#sec:eclipse_modify_xml">Modifying the XML representation</a></h6>
<div class="paragraph">
<p>The <code>withXml</code> hook allows to manipulate the in-memory XML representation just before the file gets written to disk. Although Groovy&#8217;s XML support and Kotlin&#8217;s extension functions make up for a lot, this approach is less convenient than manipulating the domain objects. In return, you get total control over the generated file, including sections not modeled by the domain objects.</p>
</div>
<div class="exampleblock">
<div class="title">Example 569. Customizing the XML</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">eclipse.wtp.facet.file.withXml { provider -&gt;
    provider.asNode().fixed.find { <span class="local-variable">it</span>.@facet == <span class="string"><span class="delimiter">'</span><span class="content">jst.java</span><span class="delimiter">'</span></span> }.@facet = <span class="string"><span class="delimiter">'</span><span class="content">jst2.java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.w3c.dom.Element

eclipse.wtp.facet.file.withXml(Action&lt;XmlProvider&gt; {
    fun Element.firstElement(predicate: Element.() -&gt; Boolean) =
        childNodes
            .run { (0 until length).map(::item) }
            .filterIsInstance&lt;Element&gt;()
            .first { it.predicate() }

    asElement()
        .firstElement { tagName === &quot;fixed&quot; &amp;&amp; getAttribute(&quot;facet&quot;) == &quot;jst.java&quot; }
        .setAttribute(&quot;facet&quot;, &quot;jst2.java&quot;)
})</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy_plugin"><a class="anchor" href="#groovy_plugin"></a><a class="link" href="#groovy_plugin">The Groovy Plugin</a></h3>
<div class="paragraph">
<p>The Groovy plugin extends the <a href="#">Java plugin</a> to add support for <a href="https://groovy-lang.org/">Groovy</a> projects.
It can deal with Groovy code, mixed Groovy and Java code, and even pure Java code (although we don&#8217;t necessarily recommend to use it for the latter).
The plugin supports <em>joint compilation</em>, which allows you to freely mix and match Groovy and Java code, with dependencies in both directions.
For example, a Groovy class can extend a Java class that in turn extends a Groovy class.
This makes it possible to use the best language for the job, and to rewrite any class in the other language if needed.</p>
</div>
<div class="paragraph">
<p>Note that if you want to benefit from the <a href="#sec:java_library_separation">API / implementation separation</a>, you can also apply the <code>java-library</code> plugin to your Groovy project.</p>
</div>
<div class="sect3">
<h4 id="sec:groovy_usage"><a class="anchor" href="#sec:groovy_usage"></a><a class="link" href="#sec:groovy_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Groovy plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 570. Using the Groovy plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    groovy
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_tasks"><a class="anchor" href="#sec:groovy_tasks"></a><a class="link" href="#sec:groovy_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds the following tasks to the project.
Information about altering the dependencies to Java compile tasks are found <a href="#sec:building_jvm_lang">here</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compileGroovy</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileJava</code></p>
<div class="paragraph">
<p>Compiles production Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileTestGroovy</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileTestJava</code></p>
<div class="paragraph">
<p>Compiles test Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compile<em>SourceSet</em>Groovy</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile<em>SourceSet</em>Java</code></p>
<div class="paragraph">
<p>Compiles the given source set&#8217;s Groovy source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>groovydoc</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Groovydoc.html">Groovydoc</a></dt>
<dd>
<div class="paragraph">
<p>Generates API documentation for the production Groovy source files.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Groovy plugin adds the following dependencies to tasks added by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 28. Groovy plugin - additional task dependencies</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileGroovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testClasses</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileTestGroovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>Classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compile<em>SourceSet</em>Groovy</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="img/groovyPluginTasks.png" alt="groovyPluginTasks">
</div>
<div class="title">Figure 33. Groovy plugin - tasks</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_project_layout"><a class="anchor" href="#sec:groovy_project_layout"></a><a class="link" href="#sec:groovy_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The Groovy plugin assumes the project layout shown in <a href="#groovylayout">Groovy Layout</a>. All the Groovy source directories can contain Groovy <em>and</em> Java code. The Java source directories may only contain Java source code.<sup class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnotedef_20" title="View footnote.">20</a>]</sup> None of these directories need to exist or have anything in them; the Groovy plugin will simply compile whatever it finds.</p>
</div>
<div id="groovylayout" class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/java</code></dt>
<dd>
<p>Production Java source.</p>
</dd>
<dt class="hdlist1"><code>src/main/resources</code></dt>
<dd>
<p>Production resources, such as XML and properties files.</p>
</dd>
<dt class="hdlist1"><code>src/main/groovy</code></dt>
<dd>
<p>Production Groovy source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/test/java</code></dt>
<dd>
<p>Test Java source.</p>
</dd>
<dt class="hdlist1"><code>src/test/resources</code></dt>
<dd>
<p>Test resources.</p>
</dd>
<dt class="hdlist1"><code>src/test/groovy</code></dt>
<dd>
<p>Test Groovy source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/java</code></dt>
<dd>
<p>Java source for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/resources</code></dt>
<dd>
<p>Resources for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/groovy</code></dt>
<dd>
<p>Groovy source files for the given source set. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:changing_groovy_project_layout"><a class="anchor" href="#sec:changing_groovy_project_layout"></a><a class="link" href="#sec:changing_groovy_project_layout">Changing the project layout</a></h5>
<div class="paragraph">
<p>Just like the Java plugin, the Groovy plugin allows you to configure custom locations for Groovy production and test source files.</p>
</div>
<div class="exampleblock">
<div class="title">Example 571. Custom Groovy source layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/groovy</span><span class="delimiter">'</span></span>]
        }
    }

    test {
        groovy {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test/groovy</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        withConvention(GroovySourceSet::class) {
            groovy {
                setSrcDirs(listOf(&quot;src/groovy&quot;))
            }
        }
    }

    test {
        withConvention(GroovySourceSet::class) {
            groovy {
                setSrcDirs(listOf(&quot;test/groovy&quot;))
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_dependency_management"><a class="anchor" href="#sec:groovy_dependency_management"></a><a class="link" href="#sec:groovy_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>Because Gradle&#8217;s build language is based on Groovy, and parts of Gradle are implemented in Groovy, Gradle already ships with a Groovy library. Nevertheless, Groovy projects need to explicitly declare a Groovy dependency. This dependency will then be used on compile and runtime class paths. It will also be used to get hold of the Groovy compiler and Groovydoc tool, respectively.</p>
</div>
<div class="paragraph">
<p>If Groovy is used for production code, the Groovy dependency should be added to the <code>implementation</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 572. Configuration of Groovy dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.15</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.codehaus.groovy:groovy-all:2.4.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Groovy is only used for test code, the Groovy dependency should be added to the <code>testImplementation</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 573. Configuration of Groovy test dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.15</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.codehaus.groovy:groovy-all:2.4.15&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use the Groovy library that ships with Gradle, declare a <code>localGroovy()</code> dependency. Note that different Gradle versions ship with different Groovy versions; as such, using <code>localGroovy()</code> is less safe then declaring a regular Groovy dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 574. Configuration of bundled Groovy dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation localGroovy()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(localGroovy())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Groovy library doesn&#8217;t necessarily have to come from a remote repository. It could also come from a local <code>lib</code> directory, perhaps checked in to source control:</p>
</div>
<div class="exampleblock">
<div class="title">Example 575. Configuration of Groovy file dependency</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    flatDir { dirs <span class="string"><span class="delimiter">'</span><span class="content">lib</span><span class="delimiter">'</span></span> }
}

dependencies {
    implementation module(<span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:2.4.15</span><span class="delimiter">'</span></span>) {
        dependency(<span class="string"><span class="delimiter">'</span><span class="content">org.ow2.asm:asm-all:5.0.3</span><span class="delimiter">'</span></span>)
        dependency(<span class="string"><span class="delimiter">'</span><span class="content">antlr:antlr:2.7.7</span><span class="delimiter">'</span></span>)
        dependency(<span class="string"><span class="delimiter">'</span><span class="content">commons-cli:commons-cli:1.2</span><span class="delimiter">'</span></span>)
        module(<span class="string"><span class="delimiter">'</span><span class="content">org.apache.ant:ant:1.9.4</span><span class="delimiter">'</span></span>) {
            dependencies(<span class="string"><span class="delimiter">'</span><span class="content">org.apache.ant:ant-junit:1.9.4@jar</span><span class="delimiter">'</span></span>,
                         <span class="string"><span class="delimiter">'</span><span class="content">org.apache.ant:ant-launcher:1.9.4</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    flatDir { dirs(&quot;lib&quot;) }
}

dependencies {
    implementation(module(&quot;org.codehaus.groovy:groovy:2.4.15&quot;) {
        dependency(&quot;org.ow2.asm:asm-all:5.0.3&quot;)
        dependency(&quot;antlr:antlr:2.7.7&quot;)
        dependency(&quot;commons-cli:commons-cli:1.2&quot;)
        module(&quot;org.apache.ant:ant:1.9.4&quot;) {
            dependencies(&quot;org.apache.ant:ant-junit:1.9.4@jar&quot;,
                         &quot;org.apache.ant:ant-launcher:1.9.4&quot;)
        }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:automatic_configuration_of_groovyclasspath"><a class="anchor" href="#sec:automatic_configuration_of_groovyclasspath"></a><a class="link" href="#sec:automatic_configuration_of_groovyclasspath">Automatic configuration of groovyClasspath</a></h4>
<div class="paragraph">
<p>The <code>GroovyCompile</code> and <code>Groovydoc</code> tasks consume Groovy code in two ways: on their <code>classpath</code>, and on their <code>groovyClasspath</code>. The former is used to locate classes referenced by the source code, and will typically contain the Groovy library along with other libraries. The latter is used to load and execute the Groovy compiler and Groovydoc tool, respectively, and should only contain the Groovy library and its dependencies.</p>
</div>
<div class="paragraph">
<p>Unless a task&#8217;s <code>groovyClasspath</code> is configured explicitly, the Groovy (base) plugin will try to infer it from the task&#8217;s <code>classpath</code>. This is done as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>groovy-all(-indy)</code> Jar is found on <code>classpath</code>, that jar will be added to <code>groovyClasspath</code>.</p>
</li>
<li>
<p>If a <code>groovy(-indy)</code> jar is found on <code>classpath</code>, and the project has at least one repository declared, a corresponding <code>groovy(-indy)</code> repository dependency will be added to <code>groovyClasspath</code>.</p>
</li>
<li>
<p>Otherwise, execution of the task will fail with a message saying that <code>groovyClasspath</code> could not be inferred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the <code>-indy</code> variation of each jar refers to the version with <code>invokedynamic</code> support.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_convention_properties"><a class="anchor" href="#sec:groovy_convention_properties"></a><a class="link" href="#sec:groovy_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Groovy plugin does not add any convention properties to the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_source_set_properties"><a class="anchor" href="#sec:groovy_source_set_properties"></a><a class="link" href="#sec:groovy_source_set_properties">Source set properties</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds the following convention properties to each source set in the project. You can use these properties in your build script as though they were properties of the source set object.</p>
</div>
<div class="sect4">
<h5 id="groovy_plugin_source_set_properties"><a class="anchor" href="#groovy_plugin_source_set_properties"></a><a class="link" href="#groovy_plugin_source_set_properties">Groovy Plugin  source set properties</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>groovy</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a> (read-only)</dt>
<dd>
<p><em>Default value</em>: Not null</p>
<div class="paragraph">
<p>The Groovy source files of this source set. Contains all <code>.groovy</code> and <code>.java</code> files found in the Groovy source directories, and excludes all other types of files.</p>
</div>
</dd>
<dt class="hdlist1"><code>groovy.srcDirs</code>  <code>Set&lt;File&gt;</code></dt>
<dd>
<p><em>Default value</em>: <code>[<em>projectDir</em>/src/<em>name</em>/groovy]</code></p>
<div class="paragraph">
<p>The source directories containing the Groovy source files of this source set. May also contain Java source files for joint compilation. Can set using anything described in <a href="#sec:specifying_multiple_files">Specifying Multiple Files</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>allGroovy</code>  <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> (read-only)</dt>
<dd>
<p><em>Default value</em>: Not null</p>
<div class="paragraph">
<p>All Groovy source files of this source set. Contains only the <code>.groovy</code> files found in the Groovy source directories.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by a convention object of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.GroovySourceSet.html">GroovySourceSet</a>.</p>
</div>
<div class="paragraph">
<p>The Groovy plugin also modifies some source set properties:</p>
</div>
</div>
<div class="sect4">
<h5 id="groovy_plugin_modified_source_set_properties"><a class="anchor" href="#groovy_plugin_modified_source_set_properties"></a><a class="link" href="#groovy_plugin_modified_source_set_properties">Groovy Plugin - modified source set properties</a></h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Change</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allJava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all <code>.java</code> files found in the Groovy source directories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all source files found in the Groovy source directories.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovyCompile"><a class="anchor" href="#sec:groovyCompile"></a><a class="link" href="#sec:groovyCompile">GroovyCompile</a></h4>
<div class="paragraph">
<p>The Groovy plugin adds a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.GroovyCompile.html">GroovyCompile</a> task for each source set in the project. The task type extends the <code>JavaCompile</code> task (see <a href="#sec:compile">the relevant Java Plugin section</a>). The <code>GroovyCompile</code> task supports most configuration options of the official Groovy compiler.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 29. Groovy plugin - GroovyCompile properties</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classpath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.compileClasspath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a>. Can set using anything described in <a href="#sec:specifying_multiple_files">Specifying Multiple Files</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationDir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>File</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>sourceSet</em>.groovy.outputDir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovyClasspath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovy</code> configuration if non-empty; Groovy library found on <code>classpath</code> otherwise</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="sec:groovy_compilation_avoidance"><a class="anchor" href="#sec:groovy_compilation_avoidance"></a><a class="link" href="#sec:groovy_compilation_avoidance">Compilation avoidance</a></h5>
<div class="paragraph">
<p><em>Caveat: Groovy compilation avoidance is an incubating feature since Gradle 5.6. There are known inaccuracies so please enable it at your own risk.</em></p>
</div>
<div class="paragraph">
<p>To enable the incubating support for Groovy compilation avoidance, add a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/initialization/Settings.html#enableFeaturePreview-java.lang.String-"><code>enableFeaturePreview</code></a> to your settings file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">enableFeaturePreview(<span class="string"><span class="delimiter">'</span><span class="content">GROOVY_COMPILATION_AVOIDANCE</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">enableFeaturePreview(&quot;GROOVY_COMPILATION_AVOIDANCE&quot;)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a dependent project has changed in an <a href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a>-compatible way (only its private API has changed), then Groovy compilation tasks will be up-to-date.
This means that if project <code>A</code> depends on project <code>B</code> and a class in <code>B</code> is changed in an ABI-compatible way (typically, changing only the body of a method), then Gradle won&#8217;t recompile <code>A</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#sec:java_compile_avoidance">Java compile avoidance</a> for a detailed list of the types of changes that do not affect the ABI and are ignored.</p>
</div>
<div class="paragraph">
<p>However, similar to Java&#8217;s annotation processing, there are various ways to <a href="https://melix.github.io/blog/2011/05/12/customizing_groovy_compilation_process.html">customize the Groovy compilation process</a>, for which implementation details matter.
Some well-known examples are <a href="https://groovy-lang.org/metaprogramming.html#_code_generation_transformations">Groovy AST transformations</a>.
In these cases, these dependencies must be declared separately in a classpath called <code>astTransformationClasspath</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 576. Declaring AST transformations</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    configurations { astTransformation }
    dependencies {
        astTransformation(project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:astTransformation</span><span class="delimiter">&quot;</span></span>))
    }
    tasks.withType(GroovyCompile).configureEach {
        astTransformationClasspath.from(configurations.astTransformation)
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    val astTransformation by configurations.creating
    dependencies {
        astTransformation(project(&quot;:astTransformation&quot;))
    }
    tasks.withType&lt;GroovyCompile&gt;().configureEach {
        astTransformationClasspath.from(astTransformation)
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:incremental_groovy_compilation"><a class="anchor" href="#sec:incremental_groovy_compilation"></a><a class="link" href="#sec:incremental_groovy_compilation">Incremental Groovy compilation</a></h4>
<div class="paragraph">
<p>Since 5.6, Gradle introduces an experimental incremental Groovy compiler. To enable incremental compilation for Groovy, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable <a href="#sec:groovy_compilation_avoidance">Groovy compilation avoidance</a>.</p>
</li>
<li>
<p>Explicitly enable incremental Groovy compilation in the build script:</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 577. Enable incremental Groovy compilation</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    tasks.withType(GroovyCompile).configureEach {
        options.incremental = <span class="predefined-constant">true</span>
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    tasks.withType&lt;GroovyCompile&gt;().configureEach {
        options.isIncremental = true
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This gives you the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incremental builds are much faster.</p>
</li>
<li>
<p>If only a small set of Groovy source files are changed, only the affected source files will be recompiled.
Classes that don&#8217;t need to be recompiled remain unchanged in the output directory.
For example, if you only change a few Groovy test classes, you don&#8217;t need to recompile all Groovy test source files  only the changed ones need to be recompiled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To understand how incremental compilation works, see <a href="#sec:incremental_compile">Incremental Java compilation</a> for a detailed overview.
Note that there&#8217;re several differences from Java incremental compilation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unlike Java, Groovy compiler doesn&#8217;t inline constants, thus changes to constants won&#8217;t trigger a full recompilation.</p>
</li>
<li>
<p>Groovy compiler doesn&#8217;t keep <code>@Retention</code> in generated annotation class bytecode (<a href="https://issues.apache.org/jira/browse/GROOVY-9185">GROOVY-9185</a>), thus all annotations are <code>RUNTIME</code>.
This means that changes to source-retention annotations won&#8217;t trigger a full recompilation.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:incremental_groovy_compilation_known_issues"><a class="anchor" href="#sec:incremental_groovy_compilation_known_issues"></a><a class="link" href="#sec:incremental_groovy_compilation_known_issues">Known issues</a></h5>
<div class="paragraph">
<p>Also see <a href="#sec:incremental_compilation_known_issues">Known issues for incremental Java compilation</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to resources won&#8217;t trigger a recompilation, this might result in some incorrectness  for example <a href="https://mrhaki.blogspot.com/2013/01/groovy-goodness-adding-extra-methods.html">Extension Modules</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:groovy_cross_compilation"><a class="anchor" href="#sec:groovy_cross_compilation"></a><a class="link" href="#sec:groovy_cross_compilation">Compiling and testing for Java 6 or Java 7</a></h4>
<div class="paragraph">
<p>The Groovy compiler will always be executed with the same version of Java that was used to start Gradle. You should set <code>sourceCompatibility</code> and <code>targetCompatibility</code> to <code>1.6</code> or <code>1.7</code>. If you also have Java source files, you can follow the same steps as for the <a href="#sec:java_cross_compilation">Java plugin</a> to ensure the correct Java compiler is used.</p>
</div>
<div class="sect4">
<h5 id="example_configure_java_6_build_for_groovy"><a class="anchor" href="#example_configure_java_6_build_for_groovy"></a><a class="link" href="#example_configure_java_6_build_for_groovy">Example: Configure Java 6 build for Groovy</a></h5>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code># in $HOME/.gradle/gradle.properties
java6Home=/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    sourceCompatibility = JavaVersion.VERSION_1_6
    targetCompatibility = JavaVersion.VERSION_1_6
}

<span class="keyword">assert</span> hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">java6Home</span><span class="delimiter">'</span></span>) : <span class="string"><span class="delimiter">&quot;</span><span class="content">Set the property 'java6Home' in your your gradle.properties pointing to a Java 6 installation</span><span class="delimiter">&quot;</span></span>
<span class="keyword">def</span> javaExecutablesPath = <span class="keyword">new</span> <span class="predefined-type">File</span>(java6Home, <span class="string"><span class="delimiter">'</span><span class="content">bin</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> javaExecutables = [:].withDefault { execName -&gt;
    <span class="keyword">def</span> executable = <span class="keyword">new</span> <span class="predefined-type">File</span>(javaExecutablesPath, execName)
    <span class="keyword">assert</span> executable.exists() : <span class="string"><span class="delimiter">&quot;</span><span class="content">There is no </span><span class="inline"><span class="inline-delimiter">$</span>execName</span><span class="content"> executable in </span><span class="inline"><span class="inline-delimiter">$</span>javaExecutablesPath</span><span class="delimiter">&quot;</span></span>
    executable
}
tasks.withType(AbstractCompile) {
    options.with {
        fork = <span class="predefined-constant">true</span>
        forkOptions.javaHome = file(java6Home)
    }
}
tasks.withType(Javadoc) {
    executable = javaExecutables.javadoc
}
tasks.withType(Test) {
    executable = javaExecutables.java
}
tasks.withType(JavaExec) {
    executable = javaExecutables.java
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    sourceCompatibility = JavaVersion.VERSION_1_6
    targetCompatibility = JavaVersion.VERSION_1_6
}

require(hasProperty(&quot;java6Home&quot;)) { &quot;Set the property 'java6Home' in your your gradle.properties pointing to a Java 6 installation&quot; }
val java6Home: String by project
val javaExecutablesPath = File(java6Home, &quot;bin&quot;)
fun javaExecutable(execName: String): String {
    val executable = File(javaExecutablesPath, execName)
    require(executable.exists()) { &quot;There is no $execName executable in $javaExecutablesPath&quot; }
    return executable.toString()
}
tasks.withType&lt;JavaCompile&gt;().configureEach {
    options.apply {
        isFork = true
        forkOptions.javaHome = file(java6Home)
    }
}
tasks.withType&lt;Javadoc&gt;().configureEach {
    executable = javaExecutable(&quot;javadoc&quot;)
}
tasks.withType&lt;Test&gt;().configureEach {
    executable = javaExecutable(&quot;java&quot;)
}
tasks.withType&lt;JavaExec&gt;.configureEach {
    executable = javaExecutable(&quot;java&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="idea_plugin"><a class="anchor" href="#idea_plugin"></a><a class="link" href="#idea_plugin">The IDEA Plugin</a></h3>
<div class="paragraph">
<p>The IDEA plugin generates files that are used by <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a>, thus making it possible to open the project from IDEA (<code>File</code> - <code>Open Project</code>). Both external dependencies (including associated source and Javadoc files) and project dependencies are considered.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you simply want to load a Gradle project into IntelliJ IDEA, then use the IDE&#8217;s <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import">import facility</a>. You do not need to apply this plugin to import your project into IDEA, although if you do, the import will take account of any extra IDEA configuration you have that doesn&#8217;t directly modify the generated files  see the <a href="#sec:idea_configuration">Configuration</a> section for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What exactly the IDEA plugin generates depends on which other plugins are used:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Always</strong></dt>
<dd>
<p>Generates an IDEA module file. Also generates an IDEA project and workspace file if the project is the root project.</p>
</dd>
<dt class="hdlist1"><strong><a href="#java_plugin">Java Plugin</a></strong></dt>
<dd>
<p>Additionally adds Java configuration to the IDEA module and project files.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>One focus of the IDEA plugin is to be open to customization. The plugin provides a standardized set of hooks for adding and removing content from the generated files.</p>
</div>
<div class="sect3">
<h4 id="sec:idea_usage"><a class="anchor" href="#sec:idea_usage"></a><a class="link" href="#sec:idea_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the IDEA plugin, include this in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 578. Using the IDEA plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">idea</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    idea
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The IDEA plugin adds a number of tasks to your project. The <code>idea</code> task generates an IDEA module file for the project. When the project is the root project, the <code>idea</code> task also generates an IDEA project and workspace. The IDEA project includes modules for each of the projects in the Gradle build.</p>
</div>
<div class="paragraph">
<p>The IDEA plugin also adds an <code>openIdea</code> task when the project is the root project. This task generates the IDEA configuration files and opens the result in IDEA. This means you can simply run <code>./gradlew openIdea</code> from the root project to generate and open the IDEA project in one convenient step.</p>
</div>
<div class="paragraph">
<p>The IDEA plugin also adds a <code>cleanIdea</code> task to the project. This task deletes the generated files, if present.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:idea_tasks"><a class="anchor" href="#sec:idea_tasks"></a><a class="link" href="#sec:idea_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The IDEA plugin adds the tasks shown below to a project. Notice that the <code>clean</code> task does not depend on the <code>cleanIdeaWorkspace</code> task. This is because the workspace typically contains a lot of user specific temporary data and it is not desirable to manipulate it outside IDEA.</p>
</div>
<div id="ideatasks" class="dlist">
<dl>
<dt class="hdlist1"><code>idea</code></dt>
<dd>
<p><em>Depends on</em>: <code>ideaProject</code>, <code>ideaModule</code>, <code>ideaWorkspace</code></p>
<div class="paragraph">
<p>Generates all IDEA configuration files</p>
</div>
</dd>
<dt class="hdlist1"><code>openIdea</code></dt>
<dd>
<p><em>Depends on</em>: <code>idea</code></p>
<div class="paragraph">
<p>Generates all IDEA configuration files and opens the project in IDEA</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanIdea</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p><em>Depends on</em>: <code>cleanIdeaProject</code>, <code>cleanIdeaModule</code></p>
<div class="paragraph">
<p>Removes all IDEA configuration files</p>
</div>
</dd>
<dt class="hdlist1"><code>cleanIdeaProject</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p>Removes the IDEA project file</p>
</dd>
<dt class="hdlist1"><code>cleanIdeaModule</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p>Removes the IDEA module file</p>
</dd>
<dt class="hdlist1"><code>cleanIdeaWorkspace</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p>Removes the IDEA workspace file</p>
</dd>
<dt class="hdlist1"><code>ideaProject</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.GenerateIdeaProject.html">GenerateIdeaProject</a></dt>
<dd>
<p>Generates the <code>.ipr</code> file. This task is only added to the root project.</p>
</dd>
<dt class="hdlist1"><code>ideaModule</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.GenerateIdeaModule.html">GenerateIdeaModule</a></dt>
<dd>
<p>Generates the <code>.iml</code> file</p>
</dd>
<dt class="hdlist1"><code>ideaWorkspace</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.GenerateIdeaWorkspace.html">GenerateIdeaWorkspace</a></dt>
<dd>
<p>Generates the <code>.iws</code> file. This task is only added to the root project.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:idea_configuration"><a class="anchor" href="#sec:idea_configuration"></a><a class="link" href="#sec:idea_configuration">Configuration</a></h4>
<div class="paragraph">
<p>The plugin adds some configuration options that allow to customize the IDEA project and module files that it generates. These take the form of both model properties and lower-level mechanisms that modify the generated files directly. For example, you can add source and resource directories, as well as inject your own fragments of XML. The former type of configuration is honored by IDEA&#8217;s import facility, whereas the latter is not.</p>
</div>
<div class="paragraph">
<p>Here are the configuration properties you can use:</p>
</div>
<div id="idea-configuration" class="dlist">
<dl>
<dt class="hdlist1"><code>idea</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaModel.html">IdeaModel</a></dt>
<dd>
<p>Top level element that enables configuration of the idea plugin in a DSL-friendly fashion</p>
</dd>
<dt class="hdlist1"><code>idea.project</code> <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaProject.html">IdeaProject</a></dt>
<dd>
<p>Allows configuring project information</p>
</dd>
<dt class="hdlist1"><code>idea.module</code> <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaModule.html">IdeaModule</a></dt>
<dd>
<p>Allows configuring module information</p>
</dd>
<dt class="hdlist1"><code>idea.workspace</code> <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaWorkspace.html">IdeaWorkspace</a></dt>
<dd>
<p>Allows configuring the workspace XML</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Follow the links to the types for examples of using these configuration properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:idea_customizing_the_generated_files"><a class="anchor" href="#sec:idea_customizing_the_generated_files"></a><a class="link" href="#sec:idea_customizing_the_generated_files">Customizing the generated files</a></h4>
<div class="paragraph">
<p>The IDEA plugin provides hooks and behavior for customizing the generated content in a more controlled and detailed way. In addition, the <code>withXml</code> hook is the only practical way to modify the workspace file because its corresponding domain object is essentially empty.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The techniques we discuss in this section don&#8217;t work with IDEA&#8217;s import facility
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tasks recognize existing IDEA files and merge them with the generated content.</p>
</div>
<div class="sect4">
<h5 id="sec:merging_with_idea_files"><a class="anchor" href="#sec:merging_with_idea_files"></a><a class="link" href="#sec:merging_with_idea_files">Merging</a></h5>
<div class="paragraph">
<p>Sections of existing IDEA files that are also the target of generated content will be amended or overwritten, depending on the particular section. The remaining sections will be left as-is.</p>
</div>
<div class="sect5">
<h6 id="sec:complete_overwrite_of_idea_files"><a class="anchor" href="#sec:complete_overwrite_of_idea_files"></a><a class="link" href="#sec:complete_overwrite_of_idea_files">Disabling merging with a complete overwrite</a></h6>
<div class="paragraph">
<p>To completely rewrite existing IDEA files, execute a clean task together with its corresponding generation task, like <code>gradle cleanIdea idea</code> (in that order). If you want to make this the default behavior, add <code>tasks.idea.dependsOn(cleanIdea)</code> to your build script. This makes it unnecessary to execute the clean task explicitly.</p>
</div>
<div class="paragraph">
<p>This strategy can also be used for individual files that the plugin would generate. For instance, this can be done for the <code>.iml</code> file with <code>gradle cleanIdeaModule ideaModule</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:hooking_into_the_idea_generation_lifecycle"><a class="anchor" href="#sec:hooking_into_the_idea_generation_lifecycle"></a><a class="link" href="#sec:hooking_into_the_idea_generation_lifecycle">Hooking into the generation lifecycle</a></h5>
<div class="paragraph">
<p>The plugin provides objects modeling the sections of the metadata files that are generated by Gradle. The generation lifecycle is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The file is read; or a default version provided by Gradle is used if it does not exist</p>
</li>
<li>
<p>The <code>beforeMerged</code> hook is executed with a domain object representing the existing file</p>
</li>
<li>
<p>The existing content is merged with the configuration inferred from the Gradle build or defined explicitly in the eclipse DSL</p>
</li>
<li>
<p>The <code>whenMerged</code> hook is executed with a domain object representing contents of the file to be persisted</p>
</li>
<li>
<p>The <code>withXml</code> hook is executed with a raw representation of the XML that will be persisted</p>
</li>
<li>
<p>The final XML is persisted</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following are the domain objects used for each of the model types:</p>
</div>
<div id="idea-hooks" class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaProject.html">IdeaProject</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Project.html">Project</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Project.html">Project</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/IdeaModule.html">IdeaModule</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Module.html">Module</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Module.html">Module</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/IdeaWorkspace.html">IdeaWorkspace</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>beforeMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Workspace.html">Workspace</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>whenMerged { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/ide/idea/model/Workspace.html">Workspace</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
<li>
<p><code>withXml { <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/XmlProvider.html">XmlProvider</a> arg -&gt; &#8230;&#8203; }</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="sec:partial-rewrite"><a class="anchor" href="#sec:partial-rewrite"></a><a class="link" href="#sec:partial-rewrite">Partial rewrite of existing content</a></h6>
<div class="paragraph">
<p>A "complete rewrite" causes all existing content to be discarded, thereby losing any changes made directly in the IDE. The <code>beforeMerged</code> hook makes it possible to overwrite just certain parts of the existing content. The following example removes all existing dependencies from the <code>Module</code> domain object:</p>
</div>
<div class="exampleblock">
<div class="title">Example 579. Partial Rewrite for Module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea.module.iml {
    beforeMerged { module -&gt;
        module.dependencies.clear()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.idea.model.Module

idea.module.iml {
    beforeMerged(Action&lt;Module&gt; {
        dependencies.clear()
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resulting module file will only contain Gradle-generated dependency entries, but not any other dependency entries that may have been present in the original file. (In the case of dependency entries, this is also the default behavior.) Other sections of the module file will be either left as-is or merged. The same could be done for the module paths in the project file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 580. Partial Rewrite for Project</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea.project.ipr {
    beforeMerged { project -&gt;
        project.modulePaths.clear()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.idea.model.Project

idea.project.ipr {
    beforeMerged(Action&lt;Project&gt; {
        modulePaths.clear()
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:idea_modify_domain_objects"><a class="anchor" href="#sec:idea_modify_domain_objects"></a><a class="link" href="#sec:idea_modify_domain_objects">Modifying the fully populated domain objects</a></h6>
<div class="paragraph">
<p>The <code>whenMerged</code> hook allows you to manipulate the fully populated domain objects. Often this is the preferred way to customize IDEA files. Here is how you would export all the dependencies of an IDEA module:</p>
</div>
<div class="exampleblock">
<div class="title">Example 581. Export Dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea.module.iml {
    whenMerged { module -&gt;
        module.dependencies*.exported = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.gradle.plugins.ide.idea.model.Module
import org.gradle.plugins.ide.idea.model.ModuleDependency

idea.module.iml {
    whenMerged(Action&lt;Module&gt; {
        dependencies.forEach {
            (it as ModuleDependency).isExported = true
        }
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sec:idea_modify_xml"><a class="anchor" href="#sec:idea_modify_xml"></a><a class="link" href="#sec:idea_modify_xml">Modifying the XML representation</a></h6>
<div class="paragraph">
<p>The <code>withXml</code> hook allows you to manipulate the in-memory XML representation just before the file gets written to disk. Although Groovy&#8217;s XML support and Kotlin&#8217;s extension functions make up for a lot, this approach is less convenient than manipulating the domain objects. In return, you get total control over the generated file, including sections not modeled by the domain objects.</p>
</div>
<div class="exampleblock">
<div class="title">Example 582. Customizing the XML</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea.project.ipr {
    withXml { provider -&gt;
        provider.node.component
                .find { <span class="local-variable">it</span>.@name == <span class="string"><span class="delimiter">'</span><span class="content">VcsDirectoryMappings</span><span class="delimiter">'</span></span> }
                .mapping.@vcs = <span class="string"><span class="delimiter">'</span><span class="content">Git</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import org.w3c.dom.Element

idea.project.ipr {
    withXml(Action&lt;XmlProvider&gt; {
        fun Element.firstElement(predicate: (Element.() -&gt; Boolean)) =
            childNodes
                .run { (0 until length).map(::item) }
                .filterIsInstance&lt;Element&gt;()
                .first { it.predicate() }

        asElement()
            .firstElement { tagName == &quot;component&quot; &amp;&amp; getAttribute(&quot;name&quot;) == &quot;VcsDirectoryMappings&quot; }
            .firstElement { tagName == &quot;mapping&quot; }
            .setAttribute(&quot;vcs&quot;, &quot;Git&quot;)
    })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:further_things_to_consider"><a class="anchor" href="#sec:further_things_to_consider"></a><a class="link" href="#sec:further_things_to_consider">Further things to consider</a></h4>
<div class="paragraph">
<p>The paths of dependencies in the generated IDEA files are absolute. If you manually define a path variable pointing to the Gradle dependency cache, IDEA will automatically replace the absolute dependency paths with this path variable. you can configure this path variable via the <code>idea.pathVariables</code> property, so that it can do a proper merge without creating duplicates.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_ivy"><a class="anchor" href="#publishing_ivy"></a><a class="link" href="#publishing_ivy">Ivy Publish Plugin</a></h3>
<div class="paragraph">
<p>The Ivy Publish Plugin provides the ability to publish build artifacts in the <a href="http://ant.apache.org/ivy/">Apache Ivy</a> format, usually to a repository for consumption by other builds or projects. What is published is one or more artifacts created by the build, and an Ivy <em>module descriptor</em> (normally <code>ivy.xml</code>) that describes the artifacts and the dependencies of the artifacts, if any.</p>
</div>
<div class="paragraph">
<p>A published Ivy module can be consumed by Gradle (see <a href="#declaring-dependencies">Declaring Dependencies</a>) and other tools that understand the Ivy format. You can learn about the fundamentals of publishing in <a href="#publishing_overview">Publishing Overview</a>.</p>
</div>
<div class="sect3">
<h4 id="publishing_ivy:usage"><a class="anchor" href="#publishing_ivy:usage"></a><a class="link" href="#publishing_ivy:usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Ivy Publish Plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 583. Applying the Ivy Publish Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `ivy-publish`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Ivy Publish Plugin uses an extension on the project named <code>publishing</code> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>. This extension provides a container of named publications and a container of named repositories. The Ivy Publish Plugin works with <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a> publications and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a> repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:tasks"><a class="anchor" href="#publishing_ivy:tasks"></a><a class="link" href="#publishing_ivy:tasks">Tasks</a></h4>
<div id="publishing_ivy:descriptor" class="dlist">
<dl>
<dt class="hdlist1"><code>generateDescriptorFileFor<em>PubName</em>Publication</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.tasks.GenerateIvyDescriptor.html">GenerateIvyDescriptor</a></dt>
<dd>
<p>Creates an Ivy descriptor file for the publication named <em>PubName</em>, populating the known metadata such as project name, project version, and the dependencies. The default location for the descriptor file is <em>build/publications/$pubName/ivy.xml</em>.</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html">PublishToIvyRepository</a></dt>
<dd>
<p>Publishes the <em>PubName</em> publication to the repository named <em>RepoName</em>. If you have a repository definition without an explicit name, <em>RepoName</em> will be "Ivy".</p>
</dd>
<dt class="hdlist1"><code>publish</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks</p>
<div class="paragraph">
<p>An aggregate task that publishes all defined publications to all defined repositories.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:publications"><a class="anchor" href="#publishing_ivy:publications"></a><a class="link" href="#publishing_ivy:publications">Publications</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_publication">publications</a> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>. To learn how to define and use publications, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>There are four main things you can configure in an Ivy publication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="#sub:terminology_component">component</a> via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:from(org.gradle.api.component.SoftwareComponent)">IvyPublication.from(org.gradle.api.component.SoftwareComponent)</a>.</p>
</li>
<li>
<p><a href="#sec:publishing_custom_artifacts_to_maven">Custom artifacts</a> via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:artifact(java.lang.Object)">IvyPublication.artifact(java.lang.Object)</a> method. See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyArtifact.html">IvyArtifact</a> for the available configuration options for custom Ivy artifacts.</p>
</li>
<li>
<p>Standard metadata like <code>module</code>, <code>organisation</code> and <code>revision</code>.</p>
</li>
<li>
<p>Other contents of the module descriptor via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html#org.gradle.api.publish.ivy.IvyPublication:descriptor(org.gradle.api.Action)">IvyPublication.descriptor(org.gradle.api.Action)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see all of these in action in the <a href="#publishing_ivy:example">complete publishing example</a>. The API documentation for <code>IvyPublication</code> has additional code samples.</p>
</div>
<div class="sect4">
<h5 id="sec:identity_values_for_the_published_project"><a class="anchor" href="#sec:identity_values_for_the_published_project"></a><a class="link" href="#sec:identity_values_for_the_published_project">Identity values for the published project</a></h5>
<div class="paragraph">
<p>The generated Ivy module descriptor file contains an <code>&lt;info&gt;</code> element that identifies the module. The default identity values are derived from the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>organisation</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">Project.getGroup()</a></p>
</li>
<li>
<p><code>module</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.getName()</a></p>
</li>
<li>
<p><code>revision</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:version">Project.getVersion()</a></p>
</li>
<li>
<p><code>status</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:status">Project.getStatus()</a></p>
</li>
<li>
<p><code>branch</code> - (not set)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overriding the default identity values is easy: simply specify the <code>organisation</code>, <code>module</code> or <code>revision</code> properties when configuring the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyPublication.html">IvyPublication</a>. <code>status</code> and <code>branch</code> can be set via the <code>descriptor</code> property  see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html">IvyModuleDescriptorSpec</a>.</p>
</div>
<div class="paragraph">
<p>The <code>descriptor</code> property can also be used to add additional custom elements as children of the <code>&lt;info&gt;</code> element, like so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 584. customizing the publication identity</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        ivy(IvyPublication) {
            organisation = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
            module = <span class="string"><span class="delimiter">'</span><span class="content">project1-sample</span><span class="delimiter">'</span></span>
            revision = <span class="string"><span class="delimiter">'</span><span class="content">1.1</span><span class="delimiter">'</span></span>
            descriptor.status = <span class="string"><span class="delimiter">'</span><span class="content">milestone</span><span class="delimiter">'</span></span>
            descriptor.branch = <span class="string"><span class="delimiter">'</span><span class="content">testing</span><span class="delimiter">'</span></span>
            descriptor.extraInfo <span class="string"><span class="delimiter">'</span><span class="content">http://my.namespace</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myElement</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Some value</span><span class="delimiter">'</span></span>

            from components.java
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;IvyPublication&gt;(&quot;ivy&quot;) {
            organisation = &quot;org.gradle.sample&quot;
            module = &quot;project1-sample&quot;
            revision = &quot;1.1&quot;
            descriptor.status = &quot;milestone&quot;
            descriptor.branch = &quot;testing&quot;
            descriptor.extraInfo(&quot;http://my.namespace&quot;, &quot;myElement&quot;, &quot;Some value&quot;)

            from(components[&quot;java&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Certain repositories are not able to handle all supported characters. For example, the <code>:</code> character cannot be used as an identifier when publishing to a filesystem-backed repository on Windows.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gradle will handle any valid Unicode character for <code>organisation</code>, <code>module</code> and <code>revision</code> (as well as the artifact&#8217;s <code>name</code>, <code>extension</code> and <code>classifier</code>). The only values that are explicitly prohibited are <code>\</code>, <code>/</code> and any ISO control character. The supplied values are validated early during publication.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:modifying_the_generated_module_descriptor"><a class="anchor" href="#sec:modifying_the_generated_module_descriptor"></a><a class="link" href="#sec:modifying_the_generated_module_descriptor">Customizing the generated module descriptor</a></h5>
<div class="paragraph">
<p>At times, the module descriptor file generated from the project information will need to be tweaked before publishing. The Ivy Publish Plugin provides a DSL for that purpose. Please see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html">IvyModuleDescriptorSpec</a> in the DSL Reference for the complete documentation of available properties and methods.</p>
</div>
<div class="paragraph">
<p>The following sample shows how to use the most common aspects of the DSL:</p>
</div>
<div class="exampleblock">
<div class="title">Example 585. Customizing the module descriptor file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    publications {
        ivyCustom(IvyPublication) {
            descriptor {
                license {
                    name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                }
                author {
                    name = <span class="string"><span class="delimiter">'</span><span class="content">Jane Doe</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/users/jane</span><span class="delimiter">'</span></span>
                }
                description {
                    text = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                    homepage = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
                }
            }
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    publications {
        create&lt;IvyPublication&gt;(&quot;ivyCustom&quot;) {
            descriptor {
                license {
                    name.set(&quot;The Apache License, Version 2.0&quot;)
                    url.set(&quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;)
                }
                author {
                    name.set(&quot;Jane Doe&quot;)
                    url.set(&quot;http://example.com/users/jane&quot;)
                }
                description {
                    text.set(&quot;A concise description of my library&quot;)
                    homepage.set(&quot;http://www.example.com/library&quot;)
                }
            }
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example we are simply adding a 'description' element to the generated Ivy dependency descriptor, but this hook allows you to modify any aspect of the generated descriptor. For example, you could replace the version range for a dependency with the actual version used to produce the build.</p>
</div>
<div class="paragraph">
<p>You can also add arbitrary XML to the descriptor file via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.ivy.IvyModuleDescriptorSpec.html#org.gradle.api.publish.ivy.IvyModuleDescriptorSpec:withXml(org.gradle.api.Action)">IvyModuleDescriptorSpec.withXml(org.gradle.api.Action)</a>, but you cannot use it to modify any part of the module identifier (organisation, module, revision).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
It is possible to modify the descriptor in such a way that it is no longer a valid Ivy module descriptor, so care must be taken when using this feature.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="publishing_ivy:resolved_dependencies"><a class="anchor" href="#publishing_ivy:resolved_dependencies"></a><a class="link" href="#publishing_ivy:resolved_dependencies">Customizing dependencies versions</a></h5>
<div class="paragraph">
<p>Two strategies are supported for publishing dependencies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declared versions (default)</dt>
<dd>
<p>This strategy publishes the versions that are defined by the build script author with the dependency declarations in the <code>dependencies</code> block.
Any other kind of processing, for example through <a href="#">a rule changing the resolved version</a>, will not be taken into account for the publication.</p>
</dd>
<dt class="hdlist1">Resolved versions</dt>
<dd>
<p>This strategy publishes the versions that were resolved during the build, possibly by applying resolution rules and automatic conflict resolution.
This has the advantage that the published versions correspond to the ones the published artifact was tested against.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example use cases for resolved versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project uses dynamic versions for dependencies but prefers exposing the resolved version for a given release to its consumers.</p>
</li>
<li>
<p>In combination with <a href="#">dependency locking</a>, you want to publish the locked versions.</p>
</li>
<li>
<p>A project leverages the rich versions constraints of Gradle, which have a lossy conversion to Ivy.
Instead of relying on the conversion, it publishes the resolved versions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by using the <code>versionMapping</code> DSL method which allows to configure the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/publish/VersionMappingStrategy.html">VersionMappingStrategy</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 586. Using resolved versions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    publications {
        ivyCustom(IvyPublication) {
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    publications {
        create&lt;IvyPublication&gt;(&quot;ivyCustom&quot;) {
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, Gradle will use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>api</code>, which are mapped to the <code>compile</code> configuration of Ivy.
Gradle will also use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>implementation</code>, which are mapped to the <code>runtime</code> configuration of Ivy.
<code>fromResolutionResult()</code> indicates that Gradle should use the default classpath of a variant and <code>runtimeClasspath</code> is the default classpath of <code>java-runtime</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:repositories"><a class="anchor" href="#publishing_ivy:repositories"></a><a class="link" href="#publishing_ivy:repositories">Repositories</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_repository">repositories</a> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a>. To learn how to define and use repositories for publishing, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of defining a publishing repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 587. Declaring repositories to publish to</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        ivy {
            <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repo</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        ivy {
            // change to point to your repo, e.g. http://my.org/repo
            url = uri(&quot;$buildDir/repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The two main things you will want to configure are the repository&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL (required)</p>
</li>
<li>
<p>Name (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define multiple repositories as long as they have unique names within the build script. You may also declare one (and only one) repository without a name. That repository will take on an implicit name of "Ivy".</p>
</div>
<div class="paragraph">
<p>You can also configure any authentication details that are required to connect to the repository. See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.IvyArtifactRepository.html">IvyArtifactRepository</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_ivy:example"><a class="anchor" href="#publishing_ivy:example"></a><a class="link" href="#publishing_ivy:example">Complete example</a></h4>
<div class="paragraph">
<p>The following example demonstrates publishing with a multi-project build.
Each project publishes a Java component configured to also build and publish Javadoc and source code artifacts.
The descriptor file is customized to include the project description for each project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 588. Publishing a Java module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
    apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">ivy-publish</span><span class="delimiter">'</span></span>

    version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
    group = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>

    repositories {
        mavenCentral()
    }
    java {
        withJavadocJar()
        withSourcesJar()
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:project1</span><span class="delimiter">'</span></span>) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">The first project</span><span class="delimiter">'</span></span>

    dependencies {
        implementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
        implementation project(<span class="string"><span class="delimiter">'</span><span class="content">:project2</span><span class="delimiter">'</span></span>)
    }
}

project(<span class="string"><span class="delimiter">'</span><span class="content">:project2</span><span class="delimiter">'</span></span>) {
    description = <span class="string"><span class="delimiter">'</span><span class="content">The second project</span><span class="delimiter">'</span></span>

    dependencies {
        implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-collections:commons-collections:3.2.2</span><span class="delimiter">'</span></span>
    }
}

subprojects {
    publishing {
        repositories {
            ivy {
                <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
                url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rootProject.buildDir<span class="inline-delimiter">}</span></span><span class="content">/repo</span><span class="delimiter">&quot;</span></span>
            }
        }
        publications {
            ivy(IvyPublication) {
                from components.java
                descriptor.description {
                    text = description
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    apply(plugin = &quot;java&quot;)
    apply(plugin = &quot;ivy-publish&quot;)

    version = &quot;1.0&quot;
    group = &quot;org.gradle.sample&quot;

    repositories {
        mavenCentral()
    }
    val java = extensions.getByType&lt;JavaPluginExtension&gt;()
    java.withJavadocJar()
    java.withSourcesJar()
}

project(&quot;:project1&quot;) {
    description = &quot;The first project&quot;

    dependencies {
        &quot;implementation&quot;(&quot;junit:junit:4.12&quot;)
        &quot;implementation&quot;(project(&quot;:project2&quot;))
    }
}

project(&quot;:project2&quot;) {
    description = &quot;The second project&quot;

    dependencies {
        &quot;implementation&quot;(&quot;commons-collections:commons-collections:3.2.2&quot;)
    }
}

subprojects {
    configure&lt;PublishingExtension&gt;() {
        repositories {
            ivy {
                // change to point to your repo, e.g. http://my.org/repo
                url = uri(&quot;${rootProject.buildDir}/repo&quot;)
            }
        }
        publications {
            create&lt;IvyPublication&gt;(&quot;ivy&quot;) {
                from(components[&quot;java&quot;])
                descriptor.description {
                    text.set(description)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is that the following artifacts will be published for each project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Gradle Module Metadata file: <code>project1-1.0.module</code>.</p>
</li>
<li>
<p>The Ivy module metadata file: <code>ivy-1.0.xml</code>.</p>
</li>
<li>
<p>The primary JAR artifact for the Java component: <code>project1-1.0.jar</code>.</p>
</li>
<li>
<p>The Javadoc and sources JAR artifacts of the Java component (because we configured <code>withJavadocJar()</code> and <code>withSourcesJar()</code>): <code>project1-1.0-javadoc.jar</code>, <code>project1-1.0-source.jar</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:pub_ivy:legacy_migration"><a class="anchor" href="#sec:pub_ivy:legacy_migration"></a><a class="link" href="#sec:pub_ivy:legacy_migration">Migrating from legacy Ivy publication</a></h4>
<div class="paragraph">
<p>If you are migrating a project that used to rely on the <a href="artifact_management.html">legacy publishing</a> support, you will find the differences between the two solutions below.</p>
</div>
<div class="sect4">
<h5 id="configurations_marked_as_non_transitive"><a class="anchor" href="#configurations_marked_as_non_transitive"></a><a class="link" href="#configurations_marked_as_non_transitive">Configurations marked as non transitive</a></h5>
<div class="paragraph">
<p>When a configuration is marked as <code>transitive = false</code>, this is not mapped to Ivy.</p>
</div>
<div class="paragraph">
<p>Gradle will emit a warning that such a configuration is published. The recommendation, if this really needs to be published, is to use dependency level <code>transitive = false</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="forced_dependencies_are_not_mapped"><a class="anchor" href="#forced_dependencies_are_not_mapped"></a><a class="link" href="#forced_dependencies_are_not_mapped">Forced dependencies are not mapped</a></h5>
<div class="paragraph">
<p>While Ivy supports the concept of a <a href="https://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html#_forcing_revision"><code>force</code> on a dependency</a>, Gradle will not map its own deprecated <code>force</code> declarations to it.</p>
</div>
<div class="paragraph">
<p>Instead, it is recommended to replace the Gradle <code>force</code> with a <a href="#sec:strict-version"><code>strictly</code> version</a>, which provides <a href="#sec:enforcing_dependency_version">better semantics</a> and is supported by the Gradle Module Metadata format.</p>
</div>
<div class="paragraph">
<p>Note that if you absolutely need to publish a force, you can still <a href="#sec:modifying_the_generated_module_descriptor">modify the produced <code>ivy.xml</code></a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jacoco_plugin"><a class="anchor" href="#jacoco_plugin"></a><a class="link" href="#jacoco_plugin">The JaCoCo Plugin</a></h3>
<div class="paragraph">
<p>The JaCoCo plugin provides code coverage metrics for Java code via integration with <a href="http://www.eclemma.org/jacoco/">JaCoCo</a>.</p>
</div>
<div class="sect3">
<h4 id="sec:jacoco_getting_started"><a class="anchor" href="#sec:jacoco_getting_started"></a><a class="link" href="#sec:jacoco_getting_started">Getting Started</a></h4>
<div class="paragraph">
<p>To get started, apply the JaCoCo plugin to the project you want to calculate code coverage for.</p>
</div>
<div class="exampleblock">
<div class="title">Example 589. Applying the JaCoCo plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">jacoco</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    jacoco
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the Java plugin is also applied to your project, a new task named <code>jacocoTestReport</code> is created.
By default, a HTML report is generated at <code><em>$buildDir</em>/reports/jacoco/test</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>While tests should be executed before generation of the report, the <code>jacocoTestReport</code> task does not depend on the <code>test</code> task.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on your usecases, you may want to always generate the <code>jacocoTestReport</code> or run the <code>test</code> task before generating the report explicitly.</p>
</div>
<div class="exampleblock">
<div class="title">Example 590. Define dependencies between code coverage reports and test execution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    finalizedBy jacocoTestReport <span class="comment">// report is always generated after tests run</span>
}
jacocoTestReport {
    dependsOn test <span class="comment">// tests are required to run before generating the report</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    finalizedBy(tasks.jacocoTestReport) // report is always generated after tests run
}
tasks.jacocoTestReport {
    dependsOn(tasks.test) // tests are required to run before generating the report
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configuring_the_jacoco_plugin"><a class="anchor" href="#sec:configuring_the_jacoco_plugin"></a><a class="link" href="#sec:configuring_the_jacoco_plugin">Configuring the JaCoCo Plugin</a></h4>
<div class="paragraph">
<p>The JaCoCo plugin adds a project extension named <code>jacoco</code> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.plugins.JacocoPluginExtension.html">JacocoPluginExtension</a>, which allows configuring defaults for JaCoCo usage in your build.</p>
</div>
<div class="exampleblock">
<div class="title">Example 591. Configuring JaCoCo plugin settings</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jacoco {
    toolVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">0.8.5</span><span class="delimiter">&quot;</span></span>
    reportsDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/customJacocoReportDir</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">jacoco {
    toolVersion = &quot;0.8.5&quot;
    reportsDir = file(&quot;$buildDir/customJacocoReportDir&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 30. Gradle defaults for JaCoCo properties</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Gradle default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reportsDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>$buildDir</em>/reports/jacoco</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:jacoco_report_configuration"><a class="anchor" href="#sec:jacoco_report_configuration"></a><a class="link" href="#sec:jacoco_report_configuration">JaCoCo Report configuration</a></h4>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html">JacocoReport</a> task can be used to generate code coverage reports in different formats. It implements the standard Gradle type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.reporting.Reporting.html">Reporting</a> and exposes a report container of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testing/jacoco/tasks/JacocoReportsContainer.html">JacocoReportsContainer</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 592. Configuring test task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jacocoTestReport {
    reports {
        xml.enabled <span class="predefined-constant">false</span>
        csv.enabled <span class="predefined-constant">false</span>
        html.destination file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>buildDir<span class="inline-delimiter">}</span></span><span class="content">/jacocoHtml</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jacocoTestReport {
    reports {
        xml.isEnabled = false
        csv.isEnabled = false
        html.destination = file(&quot;${buildDir}/jacocoHtml&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/jacocoHtmlReport.png" alt="JaCoCo HTML report" width="903" height="277">
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:jacoco_report_violation_rules"><a class="anchor" href="#sec:jacoco_report_violation_rules"></a><a class="link" href="#sec:jacoco_report_violation_rules">Enforcing code coverage metrics</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature requires the use of JaCoCo version 0.6.3 or higher.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoCoverageVerification.html">JacocoCoverageVerification</a> task can be used to verify if code coverage metrics are met based on configured rules. Its API exposes the method <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testing/jacoco/tasks/JacocoCoverageVerification.html#violationRules-org.gradle.api.Action-">JacocoCoverageVerification.violationRules(org.gradle.api.Action)</a> which is used as main entry point for configuring rules. Invoking any of those methods returns an instance of <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/testing/jacoco/tasks/rules/JacocoViolationRulesContainer.html">JacocoViolationRulesContainer</a> providing extensive configuration options. The build fails if any of the configured rules are not met. JaCoCo only reports the first violated rule.</p>
</div>
<div class="paragraph">
<p>Code coverage requirements can be specified for a project as a whole, for individual files, and for particular JaCoCo-specific types of coverage, e.g., lines covered or branches covered. The following example describes the syntax.</p>
</div>
<div class="exampleblock">
<div class="title">Example 593. Configuring violation rules</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = <span class="float">0.5</span>
            }
        }

        rule {
            enabled = <span class="predefined-constant">false</span>
            element = <span class="string"><span class="delimiter">'</span><span class="content">CLASS</span><span class="delimiter">'</span></span>
            includes = [<span class="string"><span class="delimiter">'</span><span class="content">org.gradle.*</span><span class="delimiter">'</span></span>]

            limit {
                counter = <span class="string"><span class="delimiter">'</span><span class="content">LINE</span><span class="delimiter">'</span></span>
                value = <span class="string"><span class="delimiter">'</span><span class="content">TOTALCOUNT</span><span class="delimiter">'</span></span>
                maximum = <span class="float">0.3</span>
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = &quot;0.5&quot;.toBigDecimal()
            }
        }

        rule {
            enabled = false
            element = &quot;CLASS&quot;
            includes = listOf(&quot;org.gradle.*&quot;)

            limit {
                counter = &quot;LINE&quot;
                value = &quot;TOTALCOUNT&quot;
                maximum = &quot;0.3&quot;.toBigDecimal()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoCoverageVerification.html">JacocoCoverageVerification</a> task is not a task dependency of the <code>check</code> task provided by the Java plugin. There is a good reason for it. The task is currently not incremental as it doesn&#8217;t declare any outputs. Any violation of the declared rules would automatically result in a failed build when executing the <code>check</code> task. This behavior might not be desirable for all users. Future versions of Gradle might change the behavior.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:jacoco_specific_task_configuration"><a class="anchor" href="#sec:jacoco_specific_task_configuration"></a><a class="link" href="#sec:jacoco_specific_task_configuration">JaCoCo specific task configuration</a></h4>
<div class="paragraph">
<p>The JaCoCo plugin adds a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.plugins.JacocoTaskExtension.html">JacocoTaskExtension</a> extension to all tasks of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a>. This extension allows the configuration of the JaCoCo specific properties of the test task.</p>
</div>
<div class="exampleblock">
<div class="title">Example 594. Configuring test task</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    jacoco {
        destinationFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/jacoco/jacocoTest.exec</span><span class="delimiter">&quot;</span></span>)
        classDumpDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/jacoco/classpathdumps</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    extensions.configure(JacocoTaskExtension::class) {
        destinationFile = file(&quot;$buildDir/jacoco/jacocoTest.exec&quot;)
        classDumpDir = file(&quot;$buildDir/jacoco/classpathdumps&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Tasks configured for running with the JaCoCo agent delete the destination file for the execution data when the task starts executing.
This ensures that no stale coverage data is present in the execution data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="default_values_of_the_jacoco_task_extension"><a class="anchor" href="#default_values_of_the_jacoco_task_extension"></a><a class="link" href="#default_values_of_the_jacoco_task_extension">Default values of the JaCoCo Task extension</a></h5>
<div class="exampleblock">
<div class="title">Example 595. JaCoCo task extension default values</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    jacoco {
        enabled = <span class="predefined-constant">true</span>
        destinationFile = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/jacoco/</span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content">.exec</span><span class="delimiter">&quot;</span></span>)
        includes = <span class="type">[]</span>
        excludes = <span class="type">[]</span>
        excludeClassLoaders = <span class="type">[]</span>
        includeNoLocationClasses = <span class="predefined-constant">false</span>
        sessionId = <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;auto-generated value&gt;</span><span class="delimiter">&quot;</span></span>
        dumpOnExit = <span class="predefined-constant">true</span>
        classDumpDir = <span class="predefined-constant">null</span>
        output = JacocoTaskExtension.Output.FILE
        address = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
        port = <span class="integer">6300</span>
        jmx = <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.test {
    configure&lt;JacocoTaskExtension&gt; {
        isEnabled = true
        destinationFile = file(&quot;$buildDir/jacoco/$name.exec&quot;)
        includes = emptyList()
        excludes = emptyList()
        excludeClassLoaders = emptyList()
        isIncludeNoLocationClasses = false
        sessionId = &quot;&lt;auto-generated value&gt;&quot;
        isDumpOnExit = true
        classDumpDir = null
        output = JacocoTaskExtension.Output.FILE
        address = &quot;localhost&quot;
        port = 6300
        isJmx = false
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>While all tasks of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a> are automatically enhanced to provide coverage information when the <code>java</code> plugin has been applied, any task that implements <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/process/JavaForkOptions.html">JavaForkOptions</a> can be enhanced by the JaCoCo plugin. That is, any task that forks Java processes can be used to generate coverage information.</p>
</div>
<div class="paragraph">
<p>For example you can configure your build to generate code coverage using the <code>application</code> plugin.</p>
</div>
<div class="exampleblock">
<div class="title">Example 596. Using application plugin to generate code coverage data</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">jacoco</span><span class="delimiter">'</span></span>
}

application {
    mainClass = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.MyMain</span><span class="delimiter">'</span></span>
}

jacoco {
    applyTo run
}

task applicationCodeCoverageReport(<span class="key">type</span>:JacocoReport) {
    executionData run
    sourceSets sourceSets.main
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    application
    jacoco
}

application {
    mainClass.set(&quot;org.gradle.MyMain&quot;)
}

jacoco {
    applyTo(tasks.run.get())
}

tasks.register&lt;JacocoReport&gt;(&quot;applicationCodeCoverageReport&quot;) {
    executionData(tasks.run.get())
    sourceSets(sourceSets.main.get())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Coverage reports generated by applicationCodeCoverageReport</div>
<div class="content">
<pre>.
 build
     jacoco
      run.exec
     reports
         jacoco
             applicationCodeCoverageReport
                 html
                     index.html</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:jacoco_tasks"><a class="anchor" href="#sec:jacoco_tasks"></a><a class="link" href="#sec:jacoco_tasks">Tasks</a></h4>
<div class="paragraph">
<p>For projects that also apply the Java Plugin, the JaCoCo plugin automatically adds the following tasks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>jacocoTestReport</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoReport.html">JacocoReport</a></dt>
<dd>
<div class="paragraph">
<p>Generates code coverage report for the test task.</p>
</div>
</dd>
<dt class="hdlist1"><code>jacocoTestCoverageVerification</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.testing.jacoco.tasks.JacocoCoverageVerification.html">JacocoCoverageVerification</a></dt>
<dd>
<div class="paragraph">
<p>Verifies code coverage metrics based on specified rules for the test task.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:jacoco_dependency_management"><a class="anchor" href="#sec:jacoco_dependency_management"></a><a class="link" href="#sec:jacoco_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The JaCoCo plugin adds the following dependency configurations:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 31. JaCoCo plugin - dependency configurations</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jacocoAnt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JaCoCo Ant library used for running the <code>JacocoReport</code>, <code>JacocoMerge</code> and <code>JacocoCoverageVerification</code> tasks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jacocoAgent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JaCoCo agent library used for instrumenting the code under test.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java_plugin"><a class="anchor" href="#java_plugin"></a><a class="link" href="#java_plugin">The Java Plugin</a></h3>
<div class="paragraph">
<p>The Java plugin adds Java compilation along with testing and bundling capabilities to a project.
It serves as the basis for many of the other JVM language Gradle plugins.
You can find a comprehensive introduction and overview to the Java Plugin in the <a href="#building_java_projects">Building Java Projects</a> chapter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>As indicated above, this plugin adds basic building blocks for working with JVM projects.
Its feature set has been superseded by other plugins, offering more features based on your project type.
Instead of applying it directly to your project, you should look into the <code>java-library</code> or <code>application</code> plugins or one of the supported alternative JVM language.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_usage"><a class="anchor" href="#sec:java_usage"></a><a class="link" href="#sec:java_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 597. Using the Java plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    java
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_tasks"><a class="anchor" href="#sec:java_tasks"></a><a class="link" href="#sec:java_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Java plugin adds a number of tasks to your project, as shown below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compileJava</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a></dt>
<dd>
<p><em>Depends on</em>: All tasks which contribute to the compilation classpath, including <code>jar</code> tasks from projects that are on the classpath via project dependencies</p>
<div class="paragraph">
<p>Compiles production Java source files using the JDK compiler.</p>
</div>
</dd>
<dt class="hdlist1"><code>processResources</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a></dt>
<dd>
<p>Copies production resources into the production resources directory.</p>
</dd>
<dt class="hdlist1"><code>classes</code></dt>
<dd>
<p><em>Depends on</em>: <code>compileJava</code>, <code>processResources</code></p>
<div class="paragraph">
<p>This is an aggregate task that just depends on other tasks. Other plugins may attach additional compilation tasks to it.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileTestJava</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code>, and all tasks that contribute to the test compilation classpath</p>
<div class="paragraph">
<p>Compiles test Java source files using the JDK compiler.</p>
</div>
</dd>
<dt class="hdlist1"><code>processTestResources</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a></dt>
<dd>
<p>Copies test resources into the test resources directory.</p>
</dd>
<dt class="hdlist1"><code>testClasses</code></dt>
<dd>
<p><em>Depends on</em>: <code>compileTestJava</code>, <code>processTestResources</code></p>
<div class="paragraph">
<p>This is an aggregate task that just depends on other tasks. Other plugins may attach additional test compilation tasks to it.</p>
</div>
</dd>
<dt class="hdlist1"><code>jar</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code></p>
<div class="paragraph">
<p>Assembles the production JAR file, based on the classes and resources attached to the <code>main</code> source set.</p>
</div>
</dd>
<dt class="hdlist1"><code>javadoc</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.javadoc.Javadoc.html">Javadoc</a></dt>
<dd>
<p><em>Depends on</em>: <code>classes</code></p>
<div class="paragraph">
<p>Generates API documentation for the production Java source using Javadoc.</p>
</div>
</dd>
<dt class="hdlist1"><code>test</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.testing.Test.html">Test</a></dt>
<dd>
<p><em>Depends on</em>: <code>testClasses</code>, and all tasks which produce the test runtime classpath</p>
<div class="paragraph">
<p>Runs the unit tests using JUnit or TestNG.</p>
</div>
</dd>
<dt class="hdlist1"><code>uploadArchives</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Upload.html">Upload</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, and any other task that produces an artifact attached to the <code>archives</code> configuration</p>
<div class="paragraph">
<p>Uploads artifacts in the <code>archives</code> configuration including the production JAR file to the configured repositories.
This task is <em>deprecated</em>, you should use one of the <a href="#publishing_ivy">Ivy</a> or <a href="#publishing_maven">Maven</a> publishing plugins instead.</p>
</div>
</dd>
<dt class="hdlist1"><code>clean</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p>Deletes the project build directory.</p>
</dd>
<dt class="hdlist1"><code>clean<em>TaskName</em></code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Delete.html">Delete</a></dt>
<dd>
<p>Deletes files created by the specified task. For example, <code>cleanJar</code> will delete the JAR file created by the <code>jar</code> task and <code>cleanTest</code> will delete the test results created by the <code>test</code> task.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="java_source_set_tasks"><a class="anchor" href="#java_source_set_tasks"></a><a class="link" href="#java_source_set_tasks">SourceSet Tasks</a></h5>
<div class="paragraph">
<p>For each source set you add to the project, the Java plugin adds the following tasks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compile<em>SourceSet</em>Java</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.compile.JavaCompile.html">JavaCompile</a></dt>
<dd>
<p><em>Depends on</em>: All tasks which contribute to the source set&#8217;s compilation classpath</p>
<div class="paragraph">
<p>Compiles the given source set&#8217;s Java source files using the JDK compiler.</p>
</div>
</dd>
<dt class="hdlist1"><code>process<em>SourceSet</em>Resources</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Copy.html">Copy</a></dt>
<dd>
<p>Copies the given source set&#8217;s resources into the resources directory.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>Classes</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Task.html">Task</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile<em>SourceSet</em>Java</code>, <code>process<em>SourceSet</em>Resources</code></p>
<div class="paragraph">
<p>Prepares the given source set&#8217;s classes and resources for packaging and execution. Some plugins may add additional compilation tasks for the source set.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="lifecycle_tasks"><a class="anchor" href="#lifecycle_tasks"></a><a class="link" href="#lifecycle_tasks">Lifecycle Tasks</a></h5>
<div class="paragraph">
<p>The Java plugin attaches some of its tasks to the lifecycle tasks defined by the <a href="#sec:base_tasks">Base Plugin</a>  which the Java Plugin applies automatically  and it also adds a few other lifecycle tasks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>assemble</code></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code>, and all other tasks that create artifacts attached to the <code>archives</code> configuration</p>
<div class="paragraph">
<p>Aggregate task that assembles all the archives in the project. This task is added by the Base Plugin.</p>
</div>
</dd>
<dt class="hdlist1"><code>check</code></dt>
<dd>
<p><em>Depends on</em>: <code>test</code></p>
<div class="paragraph">
<p>Aggregate task that performs verification tasks, such as running the tests. Some plugins add their own verification tasks to <code>check</code>. You should also attach any custom <code>Test</code> tasks to this lifecycle task if you want them to execute for a full build. This task is added by the Base Plugin.</p>
</div>
</dd>
<dt class="hdlist1"><code>build</code></dt>
<dd>
<p><em>Depends on</em>: <code>check</code>, <code>assemble</code></p>
<div class="paragraph">
<p>Aggregate tasks that performs a full build of the project. This task is added by the Base Plugin.</p>
</div>
</dd>
<dt class="hdlist1"><code>buildNeeded</code></dt>
<dd>
<p><em>Depends on</em>: <code>build</code>, and <code>buildNeeded</code> tasks in all projects that are dependencies in the <code>testRuntimeClasspath</code> configuration.</p>
<div class="paragraph">
<p>Performs a full build of the project and all projects it depends on.</p>
</div>
</dd>
<dt class="hdlist1"><code>buildDependents</code></dt>
<dd>
<p><em>Depends on</em>: <code>build</code>, and <code>buildDependents</code> tasks in all projects that have this project as a dependency in their <code>testRuntimeClasspath</code> configurations</p>
<div class="paragraph">
<p>Performs a full build of the project and all projects which depend upon it.</p>
</div>
</dd>
<dt class="hdlist1"><code>build<em>ConfigName</em></code> <em>task rule</em></dt>
<dd>
<p><em>Depends on</em>: all tasks that generate the artifacts attached to the named <em>ConfigName</em>  configuration</p>
<div class="paragraph">
<p>Assembles the artifacts for the specified configuration. This rule is added by the Base Plugin.</p>
</div>
</dd>
<dt class="hdlist1"><code>upload<em>ConfigName</em></code> <em>task rule</em>, type: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Upload.html">Upload</a></dt>
<dd>
<p><em>Depends on</em>: all tasks that generate the artifacts attached to the named <em>ConfigName</em>  configuration</p>
<div class="paragraph">
<p>Assembles and uploads the artifacts in the specified configuration. This rule is added by the Base Plugin.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following diagram shows the relationships between these tasks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/javaPluginTasks.png" alt="javaPluginTasks">
</div>
<div class="title">Figure 34. Java plugin - tasks</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_project_layout"><a class="anchor" href="#sec:java_project_layout"></a><a class="link" href="#sec:java_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The Java plugin assumes the project layout shown below. None of these directories need to exist or have anything in them. The Java plugin will compile whatever it finds, and handles anything which is missing.</p>
</div>
<div id="javalayout" class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/java</code></dt>
<dd>
<p>Production Java source.</p>
</dd>
<dt class="hdlist1"><code>src/main/resources</code></dt>
<dd>
<p>Production resources, such as XML and properties files.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/test/java</code></dt>
<dd>
<p>Test Java source.</p>
</dd>
<dt class="hdlist1"><code>src/test/resources</code></dt>
<dd>
<p>Test resources.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/java</code></dt>
<dd>
<p>Java source for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/resources</code></dt>
<dd>
<p>Resources for the source set named <em>sourceSet</em>.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:changing_java_project_layout"><a class="anchor" href="#sec:changing_java_project_layout"></a><a class="link" href="#sec:changing_java_project_layout">Changing the project layout</a></h5>
<div class="paragraph">
<p>You configure the project layout by configuring the appropriate source set. This is discussed in more detail in the following sections. Here is a brief example which changes the main Java and resource source directories.</p>
</div>
<div class="exampleblock">
<div class="title">Example 598. Custom Java source layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        java {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/java</span><span class="delimiter">'</span></span>]
        }
        resources {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/resources</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        java {
            setSrcDirs(listOf(&quot;src/java&quot;))
        }
        resources {
            setSrcDirs(listOf(&quot;src/resources&quot;))
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="source_sets"><a class="anchor" href="#source_sets"></a><a class="link" href="#source_sets">Source sets</a></h4>
<div class="paragraph">
<p>The plugin adds the following <a href="#sec:java_source_sets">source sets</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>main</code></dt>
<dd>
<p>Contains the production source code of the project, which is compiled and assembled into a JAR.</p>
</dd>
<dt class="hdlist1"><code>test</code></dt>
<dd>
<p>Contains your test source code, which is compiled and executed using JUnit or TestNG. These are typically unit tests, but you can include any test in this source set as long as they all share the same compilation and runtime classpaths.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:source_set_properties"><a class="anchor" href="#sec:source_set_properties"></a><a class="link" href="#sec:source_set_properties">Source set properties</a></h5>
<div class="paragraph">
<p>The following table lists some of the important properties of a source set. You can find more details in the API documentation for <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSet.html">SourceSet</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>name</code> (read-only) <code>String</code></dt>
<dd>
<p>The name of the source set, used to identify it.</p>
</dd>
<dt class="hdlist1"><code>output</code> (read-only) <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.SourceSetOutput.html">SourceSetOutput</a></dt>
<dd>
<p>The output files of the source set, containing its compiled classes and resources.</p>
</dd>
<dt class="hdlist1"><code>output.classesDirs</code> (read-only) <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p><em>Default value</em>: <code>$buildDir/classes/java/$name</code>, e.g. <em>build/classes/java/main</em></p>
<div class="paragraph">
<p>The directories to generate the classes of this source set into. May contain directories for other JVM languages, e.g. <em>build/classes/kotlin/main</em>.</p>
</div>
</dd>
<dt class="hdlist1"><code>output.resourcesDir</code> <code>File</code></dt>
<dd>
<p><em>Default value</em>: <code>$buildDir/resources/$name</code>, e.g. <em>build/resources/main</em></p>
<div class="paragraph">
<p>The directory to generate the resources of this source set into.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileClasspath</code> <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p><em>Default value</em>: <code>${name}CompileClasspath</code> configuration</p>
<div class="paragraph">
<p>The classpath to use when compiling the source files of this source set.</p>
</div>
</dd>
<dt class="hdlist1"><code>annotationProcessorPath</code> <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p><em>Default value</em>: <code>${name}AnnotationProcessor</code> configuration</p>
<div class="paragraph">
<p>The processor path to use when compiling the source files of this source set.</p>
</div>
</dd>
<dt class="hdlist1"><code>runtimeClasspath</code> <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileCollection.html">FileCollection</a></dt>
<dd>
<p><em>Default value</em>: <code>$output</code>, <code>${name}RuntimeClasspath</code> configuration</p>
<div class="paragraph">
<p>The classpath to use when executing the classes of this source set.</p>
</div>
</dd>
<dt class="hdlist1"><code>java</code> (read-only) <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p>The Java source files of this source set. Contains only <code>.java</code> files found in the Java source directories, and excludes all other files.</p>
</dd>
<dt class="hdlist1"><code>java.srcDirs</code> <code>Set&lt;File&gt;</code></dt>
<dd>
<p><em>Default value</em>: <code>src/$name/java</code>, e.g. <em>src/main/java</em></p>
<div class="paragraph">
<p>The source directories containing the Java source files of this source set.  You can set this to any value that is described in <a href="#sec:specifying_multiple_files">this section</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>java.outputDir</code> <code>File</code></dt>
<dd>
<p><em>Default value</em>: <code>$buildDir/classes/java/$name</code>, e.g. <em>build/classes/java/main</em></p>
<div class="paragraph">
<p>The directory to generate compiled Java sources into. You can set this to any value that is described in <a href="#sec:single_file_paths">this section</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>resources</code> (read-only) <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p>The resources of this source set. Contains only resources, and excludes any <code>.java</code> files found in the resource directories. Other plugins, such as the <a href="#groovy_plugin">Groovy Plugin</a>, exclude additional types of files from this collection.</p>
</dd>
<dt class="hdlist1"><code>resources.srcDirs</code> <code>Set&lt;File&gt;</code></dt>
<dd>
<p><em>Default value</em>: <code>[src/$name/resources]</code></p>
<div class="paragraph">
<p>The directories containing the resources of this source set. You can set this to any type of value that is described in <a href="#sec:specifying_multiple_files">this section</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>allJava</code> (read-only) <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p><em>Default value</em>: Same as <code>java</code> property</p>
<div class="paragraph">
<p>All Java files of this source set. Some plugins, such as the Groovy Plugin, add additional Java source files to this collection.</p>
</div>
</dd>
<dt class="hdlist1"><code>allSource</code> (read-only) <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a></dt>
<dd>
<p><em>Default value</em>: Sum of everything in the <code>resources</code> and <code>java</code> properties</p>
<div class="paragraph">
<p>All source files of this source set of any language. This includes all resource files and all Java source files. Some plugins, such as the Groovy Plugin, add additional source files to this collection.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sec:defining_new_source_sets"><a class="anchor" href="#sec:defining_new_source_sets"></a><a class="link" href="#sec:defining_new_source_sets">Defining new source sets</a></h5>
<div class="paragraph">
<p>See the <a href="#sec:configuring_java_integration_tests">integration test example</a> in the <em>Testing in Java &amp; JVM projects</em> chapter.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:some_source_set_examples"><a class="anchor" href="#sec:some_source_set_examples"></a><a class="link" href="#sec:some_source_set_examples">Some other simple source set examples</a></h5>
<div class="paragraph">
<p>Adding a JAR containing the classes of a source set:</p>
</div>
<div class="exampleblock">
<div class="title">Example 599. Assembling a JAR for a source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task intTestJar(<span class="key">type</span>: Jar) {
    from sourceSets.intTest.output
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Jar&gt;(&quot;intTestJar&quot;) {
    from(sourceSets[&quot;intTest&quot;].output)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Generating Javadoc for a source set:</p>
</div>
<div class="exampleblock">
<div class="title">Example 600. Generating the Javadoc for a source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task intTestJavadoc(<span class="key">type</span>: Javadoc) {
    source sourceSets.intTest.allJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Javadoc&gt;(&quot;intTestJavadoc&quot;) {
    source(sourceSets[&quot;intTest&quot;].allJava)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Adding a test suite to run the tests in a source set:</p>
</div>
<div class="exampleblock">
<div class="title">Example 601. Running tests in a source set</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task intTest(<span class="key">type</span>: Test) {
    testClassesDirs = sourceSets.intTest.output.classesDirs
    classpath = sourceSets.intTest.runtimeClasspath
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Test&gt;(&quot;intTest&quot;) {
    testClassesDirs = sourceSets[&quot;intTest&quot;].output.classesDirs
    classpath = sourceSets[&quot;intTest&quot;].runtimeClasspath
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_plugin_and_dependency_management"><a class="anchor" href="#sec:java_plugin_and_dependency_management"></a><a class="link" href="#sec:java_plugin_and_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The Java plugin adds a number of <a href="#sec:what-are-dependency-configurations">dependency configurations</a> to your project, as shown below.
Tasks such as <code>compileJava</code> and <code>test</code> then use one or more of those configurations to get the corresponding files and use them, for example by placing them on a compilation or runtime classpath.</p>
</div>
<div class="sect4">
<h5 id="tab:configurations"><a class="anchor" href="#tab:configurations"></a><a class="link" href="#tab:configurations">Dependency configurations</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To find information on the <code>api</code> configuration, please consult the <a href="#sec:java_library_separation">Java Library Plugin</a> reference documentation and <a href="#dependency_management_for_java_projects">Dependency Management for Java Projects</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><span class="line-through"><code>compile</code></span>(Deprecated)</dt>
<dd>
<p>Compile time dependencies. Superseded by <code>implementation</code>.</p>
</dd>
<dt class="hdlist1"><code>implementation</code> extends <code>compile</code></dt>
<dd>
<p>Implementation only dependencies.</p>
</dd>
<dt class="hdlist1"><code>compileOnly</code></dt>
<dd>
<p>Compile time only dependencies, not used at runtime.</p>
</dd>
<dt class="hdlist1"><code>compileClasspath</code> extends <code>compile, compileOnly, implementation</code></dt>
<dd>
<p>Compile classpath, used when compiling source. Used by task <code>compileJava</code>.</p>
</dd>
<dt class="hdlist1"><code>annotationProcessor</code></dt>
<dd>
<p>Annotation processors used during compilation.</p>
</dd>
<dt class="hdlist1"><span class="line-through"><code>runtime</code></span>(Deprecated) extends <code>compile</code></dt>
<dd>
<p>Runtime dependencies. Superseded by <code>runtimeOnly</code>.</p>
</dd>
<dt class="hdlist1"><code>runtimeOnly</code></dt>
<dd>
<p>Runtime only dependencies.</p>
</dd>
<dt class="hdlist1"><code>runtimeClasspath</code> extends <code>runtimeOnly, runtime, implementation</code></dt>
<dd>
<p>Runtime classpath contains elements of the implementation, as well as runtime only elements.</p>
</dd>
<dt class="hdlist1"><span class="line-through"><code>testCompile</code></span>(Deprecated) extends <code>compile</code></dt>
<dd>
<p>Additional dependencies for compiling tests. Superseded by <code>testImplementation</code>.</p>
</dd>
<dt class="hdlist1"><code>testImplementation</code> extends <code>testCompile, implementation</code></dt>
<dd>
<p>Implementation only dependencies for tests.</p>
</dd>
<dt class="hdlist1"><code>testCompileOnly</code></dt>
<dd>
<p>Additional dependencies only for compiling tests, not used at runtime.</p>
</dd>
<dt class="hdlist1"><code>testCompileClasspath</code> extends <code>testCompile, testCompileOnly, testImplementation</code></dt>
<dd>
<p>Test compile classpath, used when compiling test sources. Used by task <code>compileTestJava</code>.</p>
</dd>
<dt class="hdlist1"><span class="line-through"><code>testRuntime</code></span>(Deprecated) extends <code>runtime, testCompile</code></dt>
<dd>
<p>Additional dependencies for running tests only. Superseded by <code>testRuntimeOnly</code>.</p>
</dd>
<dt class="hdlist1"><code>testRuntimeOnly</code> extends <code>runtimeOnly</code></dt>
<dd>
<p>Runtime only dependencies for running tests.</p>
</dd>
<dt class="hdlist1"><code>testRuntimeClasspath</code> extends <code>testRuntimeOnly, testRuntime, testImplementation</code></dt>
<dd>
<p>Runtime classpath for running tests. Used by task <code>test</code>.</p>
</dd>
<dt class="hdlist1"><code>archives</code></dt>
<dd>
<p>Artifacts (e.g. jars) produced by this project. Used by task <code>uploadArchives</code>.</p>
</dd>
<dt class="hdlist1"><code>default</code> extends <code>runtimeClasspath</code></dt>
<dd>
<p>The default configuration used by a project dependency on this project. Contains the artifacts and dependencies required by this project at runtime.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following diagrams show the dependency configurations for the <em>main</em> and <em>test</em> source sets respectively. You can use this legend to interpret the colors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gray text  the configuration is <em>deprecated</em>.</p>
</li>
<li>
<p>Green background you can declare dependencies against the configuration.</p>
</li>
<li>
<p>Blue-gray background the configuration is for consumption by tasks, not for you to declare dependencies.</p>
</li>
<li>
<p>Light blue background with monospace text a task.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-main-configurations.png" alt="java main configurations">
</div>
<div class="title">Figure 35. Java plugin - <em>main</em> source set dependency configurations</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-test-configurations.png" alt="java test configurations">
</div>
<div class="title">Figure 36. Java plugin - <em>test</em> source set dependency configurations</div>
</div>
<div class="paragraph">
<p>For each source set you add to the project, the Java plugins adds the following dependency configurations:</p>
</div>
</div>
<div class="sect4">
<h5 id="java_source_set_configurations"><a class="anchor" href="#java_source_set_configurations"></a><a class="link" href="#java_source_set_configurations">SourceSet dependency configurations</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><span class="line-through"><code><em>sourceSet</em>Compile</code></span>(Deprecated)</dt>
<dd>
<p>Compile time dependencies for the given source set. Superseded by <code><em>sourceSet</em>Implementation</code>.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>Implementation</code> extends <code><em>sourceSet</em>Compile</code></dt>
<dd>
<p>Compile time dependencies for the given source set. Used by <code><em>sourceSet</em>CompileClasspath, <em>sourceSet</em>RuntimeClasspath</code>.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>CompileOnly</code></dt>
<dd>
<p>Compile time only dependencies for the given source set, not used at runtime.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>CompileClasspath</code> extends <code><em>sourceSet</em>Compile, <em>sourceSet</em>CompileOnly, <em>sourceSet</em>Implementation</code></dt>
<dd>
<p>Compile classpath, used when compiling source. Used by <code>compile<em>SourceSet</em>Java</code>.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>AnnotationProcessor</code></dt>
<dd>
<p>Annotation processors used during compilation of this source set.</p>
</dd>
<dt class="hdlist1"><span class="line-through"><code><em>sourceSet</em>Runtime</code></span>(Deprecated)</dt>
<dd>
<p>Runtime dependencies for the given source set. Superseded by <code><em>sourceSet</em>RuntimeOnly</code>.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>RuntimeOnly</code></dt>
<dd>
<p>Runtime only dependencies for the given source set.</p>
</dd>
<dt class="hdlist1"><code><em>sourceSet</em>RuntimeClasspath</code> extends <code><em>sourceSet</em>RuntimeOnly, <em>sourceSet</em>Runtime, <em>sourceSet</em>Implementation</code></dt>
<dd>
<p>Runtime classpath contains elements of the implementation, as well as runtime only elements.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java-extension"><a class="anchor" href="#sec:java-extension"></a><a class="link" href="#sec:java-extension">Contributed extension</a></h4>
<div class="paragraph">
<p>The Java plugin adds the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.JavaPluginExtension.html"><code>java</code> extension</a> to the project.
This allows to configure a number of Java related properties inside a dedicated DSL block.</p>
</div>
<div class="exampleblock">
<div class="title">Example 602. Using the <code>java</code> extension</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/JavaVersion.html">JavaVersion</a> sourceCompatibility</code></dt>
<dd>
<p>Java version compatibility to use when compiling Java source. Default value: version of the current JVM in use.</p>
</dd>
<dt class="hdlist1"><code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/JavaVersion.html">JavaVersion</a> targetCompatibility</code></dt>
<dd>
<p>Java version to generate classes for. Default value: <code><em>sourceCompatibility</em></code>.</p>
</dd>
<dt class="hdlist1"><code>withJavadocJar()</code></dt>
<dd>
<p>Automatically packages Javadoc and creates a variant <code>javadocElements</code> with an artifact <code>-javadoc.jar</code>, which will be part of the publication.</p>
</dd>
<dt class="hdlist1"><code>withSourcesJar()</code></dt>
<dd>
<p>Automatically packages source code and creates a variant <code>sourceElements</code> with an artifact <code>-sources.jar</code>, which will be part of the publication.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="convention_properties"><a class="anchor" href="#convention_properties"></a><a class="link" href="#convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Java Plugin adds a number of convention properties to the project, shown below. You can use these properties in your build script as though they were properties of the project object.</p>
</div>
<div class="sect4">
<h5 id="directory_properties"><a class="anchor" href="#directory_properties"></a><a class="link" href="#directory_properties">Directory properties</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>String reporting.baseDir</code></dt>
<dd>
<p>The name of the directory to generate reports into, relative to the build directory. Default value: <code>reports</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File reportsDir</code></dt>
<dd>
<p>The directory to generate reports into. Default value: <code><em>buildDir</em>/<em>reporting.baseDir</em></code></p>
</dd>
<dt class="hdlist1"><code>String testResultsDirName</code></dt>
<dd>
<p>The name of the directory to generate test result .xml files into, relative to the build directory. Default value: <code>test-results</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File testResultsDir</code></dt>
<dd>
<p>The directory to generate test result .xml files into. Default value: <code><em>buildDir</em>/<em>testResultsDirName</em></code></p>
</dd>
<dt class="hdlist1"><code>String testReportDirName</code></dt>
<dd>
<p>The name of the directory to generate the test report into, relative to the reports directory. Default value: <code>tests</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File testReportDir</code></dt>
<dd>
<p>The directory to generate the test report into. Default value: <code><em>reportsDir</em>/testReportDirName</code></p>
</dd>
<dt class="hdlist1"><code>String libsDirName</code></dt>
<dd>
<p>The name of the directory to generate libraries into, relative to the build directory. Default value: <code>libs</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File libsDir</code></dt>
<dd>
<p>The directory to generate libraries into. Default value: <code><em>buildDir</em>/<em>libsDirName</em></code></p>
</dd>
<dt class="hdlist1"><code>String distsDirName</code></dt>
<dd>
<p>The name of the directory to generate distributions into, relative to the build directory. Default value: <code>distributions</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File distsDir</code></dt>
<dd>
<p>The directory to generate distributions into. Default value: <code><em>buildDir</em>/<em>distsDirName</em></code></p>
</dd>
<dt class="hdlist1"><code>String docsDirName</code></dt>
<dd>
<p>The name of the directory to generate documentation into, relative to the build directory. Default value: <code>docs</code></p>
</dd>
<dt class="hdlist1"><code>(read-only) File docsDir</code></dt>
<dd>
<p>The directory to generate documentation into. Default value: <code><em>buildDir</em>/<em>docsDirName</em></code></p>
</dd>
<dt class="hdlist1"><code>String dependencyCacheDirName</code></dt>
<dd>
<p>The name of the directory to use to cache source dependency information, relative to the build directory. Default value: <code>dependency-cache</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="other_convention_properties"><a class="anchor" href="#other_convention_properties"></a><a class="link" href="#other_convention_properties">Other convention properties</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(read-only) <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/SourceSetContainer.html">SourceSetContainer</a> sourceSets</code></dt>
<dd>
<p>Contains the project&#8217;s source sets. Default value: Not null <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/tasks/SourceSetContainer.html">SourceSetContainer</a></p>
</dd>
<dt class="hdlist1"><code>String archivesBaseName</code></dt>
<dd>
<p>The basename to use for archives, such as JAR or ZIP files. Default value: <code><em>projectName</em></code></p>
</dd>
<dt class="hdlist1"><code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/java/archives/Manifest.html">Manifest</a> manifest</code></dt>
<dd>
<p>The manifest to include in all JAR files. Default value: an empty manifest.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by convention objects of type <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/JavaPluginConvention.html">JavaPluginConvention</a>, and <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/plugins/BasePluginConvention.html">BasePluginConvention</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_test"><a class="anchor" href="#sec:java_test"></a><a class="link" href="#sec:java_test">Testing</a></h4>
<div class="paragraph">
<p>See the <a href="#java_testing">Testing in Java &amp; JVM projects</a> chapter for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_plugin_publishing"><a class="anchor" href="#sec:java_plugin_publishing"></a><a class="link" href="#sec:java_plugin_publishing">Publishing</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>components.java</code></dt>
<dd>
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/SoftwareComponent.html">SoftwareComponent</a> for <a href="#publishing_overview">publishing</a> the production JAR created by the <code>jar</code> task. This component includes the runtime dependency information for the JAR.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See also the <a href="#sec:java-extension"><code>java</code> extension</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:incremental_compile"><a class="anchor" href="#sec:incremental_compile"></a><a class="link" href="#sec:incremental_compile">Incremental Java compilation</a></h4>
<div class="paragraph">
<p>Gradle comes with a sophisticated incremental Java compiler that is active by default.</p>
</div>
<div class="paragraph">
<p>This gives you the following benefits</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incremental builds are much faster.</p>
</li>
<li>
<p>The smallest possible number of class files are changed.
Classes that don&#8217;t need to be recompiled remain unchanged in the output directory.
An example scenario when this is really useful is using JRebel  the fewer output classes are changed the quicker the JVM can use refreshed classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To help you understand how incremental compilation works, the following provides a high-level overview:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle will recompile all classes <em>affected</em> by a change.</p>
</li>
<li>
<p>A class is <em>affected</em> if it has been changed or if it depends on another affected class.
This works no matter if the other class is defined in the same project, another project or even an external library.</p>
</li>
<li>
<p>A class&#8217;s dependencies are determined from type references in its bytecode.</p>
</li>
<li>
<p>Since constants can be inlined, any change to a constant will result in Gradle recompiling all source files.
For that reason, you should try to minimize the use of constants in your source code and replace them with static methods where possible.</p>
</li>
<li>
<p>Since source-retention annotations are not visible in bytecode, changes to a source-retention annotation will result in full recompilation.</p>
</li>
<li>
<p>You can improve incremental compilation performance by applying good software design principles like loose coupling.
For instance, if you put an interface between a concrete class and its dependents, the dependent classes are only recompiled when the interface changes, but not when the implementation changes.</p>
</li>
<li>
<p>The class analysis is cached in the project directory, so the first build after a clean checkout can be slower. Consider turning off the incremental compiler on your build server.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="sec:incremental_compilation_known_issues"><a class="anchor" href="#sec:incremental_compilation_known_issues"></a><a class="link" href="#sec:incremental_compilation_known_issues">Known issues</a></h5>
<div class="ulist">
<ul>
<li>
<p>If a compile task fails due to a compile error, it will do a full compilation again the next time it is invoked.</p>
</li>
<li>
<p>If you are using an annotation processor that reads resources (e.g. a configuration file), you need to declare those resources as an input of the compile task.</p>
</li>
<li>
<p>If a resource file is changed, Gradle will trigger a full recompilation.</p>
</li>
<li>
<p>If there is a mismatch in the package declaration and the directory structure of source files (e.g. <code>package foo</code> vs location <code>bar/MyClass.java</code>), then incremental compilation can produce broken output. Wrong classes might be recompiled and there might be leftover class files in the output.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:incremental_annotation_processing"><a class="anchor" href="#sec:incremental_annotation_processing"></a><a class="link" href="#sec:incremental_annotation_processing">Incremental annotation processing</a></h4>
<div class="paragraph">
<p>Starting with Gradle 4.7, the incremental compiler also supports incremental annotation processing.
All annotation processors need to opt in to this feature, otherwise they will trigger a full recompilation.</p>
</div>
<div class="paragraph">
<p>As a user you can see which annotation processors are triggering full recompilations in the <code>--info</code> log.
Incremental annotation processing will be deactivated if a custom <code>executable</code> or <code>javaHome</code> is configured on the compile task.</p>
</div>
<div class="sect4">
<h5 id="making_an_annotation_processor_incremental"><a class="anchor" href="#making_an_annotation_processor_incremental"></a><a class="link" href="#making_an_annotation_processor_incremental">Making an annotation processor incremental</a></h5>
<div class="paragraph">
<p>Please first have a look at <a href="#sec:incremental_compile">incremental Java compilation</a>, as incremental annotation processing builds on top of it.</p>
</div>
<div class="paragraph">
<p>Gradle supports incremental compilation for two common categories of annotation processors: "isolating" and "aggregating".
Please consult the information below to decide which category fits your processor.</p>
</div>
<div class="paragraph">
<p>You can then register your processor for incremental compilation using a file in the processor&#8217;s META-INF directory.
The format is one line per processor, with the fully qualified name of the processor class and its category separated by a comma.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_registering_incremental_annotation_processors"><a class="anchor" href="#example_registering_incremental_annotation_processors"></a><a class="link" href="#example_registering_incremental_annotation_processors">Example: Registering incremental annotation processors</a></h5>
<div class="listingblock">
<div class="title">processor/src/main/resources/META-INF/gradle/incremental.annotation.processors</div>
<div class="content">
<pre>EntityProcessor,isolating
ServiceRegistryProcessor,dynamic</pre>
</div>
</div>
<div class="paragraph">
<p>If your processor can only decide at runtime whether it is incremental or not, you can declare it as "dynamic" in the META-INF descriptor
and return its true type at runtime using the <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/Processor.html#getSupportedOptions--">Processor#getSupportedOptions()</a> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_registering_incremental_annotation_processors_dynamically"><a class="anchor" href="#example_registering_incremental_annotation_processors_dynamically"></a><a class="link" href="#example_registering_incremental_annotation_processors_dynamically">Example: Registering incremental annotation processors dynamically</a></h5>
<div class="listingblock">
<div class="title">processor/src/main/java/ServiceRegistryProcessor.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getSupportedOptions() {
    <span class="keyword">return</span> <span class="predefined-type">Collections</span>.singleton(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gradle.annotation.processing.aggregating</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both categories have the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They must generate their files using the <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/Filer.html">Filer API</a>.
Writing files any other way will result in silent failures later on, as these files won&#8217;t be cleaned up correctly.
If your processor does this, it cannot be incremental.</p>
</li>
<li>
<p>They must not depend on compiler-specific APIs like <code>com.sun.source.util.Trees</code>.
Gradle wraps the processing APIs, so attempts to cast to compiler-specific types will fail.
If your processor does this, it cannot be incremental, unless you have some fallback mechanism.</p>
</li>
<li>
<p>If they use <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/Filer.html#createResource(javax.tools.JavaFileManager.Location,java.lang.CharSequence,java.lang.CharSequence,javax.lang.model.element.Element...)">Filer#createResource</a>,
the <code>location</code> argument must be one of these values from <a href="https://docs.oracle.com/javase/8/docs/api/javax/tools/StandardLocation.html">StandardLocation</a>: <code>CLASS_OUTPUT</code>, <code>SOURCE_OUTPUT</code>, or <code>NATIVE_HEADER_OUTPUT</code>.
Any other argument will disable incremental processing.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="isolating_annotation_processors"><a class="anchor" href="#isolating_annotation_processors"></a><a class="link" href="#isolating_annotation_processors">"Isolating" annotation processors</a></h5>
<div class="paragraph">
<p>The fastest category, these look at each annotated element in isolation, creating generated files or validation messages for it.
For instance an <code>EntityProcessor</code> could create a <code>&lt;TypeName&gt;Repository</code> for each type annotated  with <code>@Entity</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_an_isolated_annotation_processor"><a class="anchor" href="#example_an_isolated_annotation_processor"></a><a class="link" href="#example_an_isolated_annotation_processor">Example: An isolated annotation processor</a></h5>
<div class="listingblock">
<div class="title">processor/src/main/java/EntityProcessor.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Element</span>&gt; entities = roundEnv.getElementsAnnotatedWith(entityAnnotation);
<span class="keyword">for</span> (<span class="predefined-type">Element</span> entity : entities) {
    createRepository((TypeElement) entity);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>"Isolating" processors have the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They must make all decisions (code generation, validation messages) for an annotated type based on information reachable from its AST.
This means you can analyze the types' super-class, method return types, annotations etc., even transitively.
But you cannot make decisions based on unrelated elements in the RoundEnvironment.
Doing so will result in silent failures because too few files will be recompiled later.
If your processor needs to make decisions based on a combination of otherwise unrelated elements, mark it as "aggregating" instead.</p>
</li>
<li>
<p>They must provide exactly one originating element for each file generated with the <code>Filer</code> API.
If zero or many originating elements are provided, Gradle will recompile all source files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a source file is recompiled, Gradle will recompile all files generated from it.
When a source file is deleted, the files generated from it are deleted.</p>
</div>
</div>
<div class="sect4">
<h5 id="aggregating_annotation_processors"><a class="anchor" href="#aggregating_annotation_processors"></a><a class="link" href="#aggregating_annotation_processors">"Aggregating" annotation processors</a></h5>
<div class="paragraph">
<p>These can aggregate several source files into one or more output files or validation messages.
For instance, a <code>ServiceRegistryProcessor</code> could create a single <code>ServiceRegistry</code> with one method for each type annotated with <code>@Service</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_an_aggregating_annotation_processor"><a class="anchor" href="#example_an_aggregating_annotation_processor"></a><a class="link" href="#example_an_aggregating_annotation_processor">Example: An aggregating annotation processor</a></h5>
<div class="listingblock">
<div class="title">processor/src/main/java/ServiceRegistryProcessor.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JavaFileObject serviceRegistry = filer.createSourceFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">ServiceRegistry</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Writer</span> writer = serviceRegistry.openWriter();
writer.write(<span class="string"><span class="delimiter">&quot;</span><span class="content">public class ServiceRegistry {</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">for</span> (<span class="predefined-type">Element</span> service : roundEnv.getElementsAnnotatedWith(serviceAnnotation)) {
    addServiceCreationMethod(writer, (TypeElement) service);
}
writer.write(<span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>);
writer.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>"Aggregating" processors have the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They can only read <code>CLASS</code> or <code>RUNTIME</code> retention annotations</p>
</li>
<li>
<p>They can only read parameter names if the user passes the <code>-parameters</code> compiler argument.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gradle will always reprocess (but not recompile) all annotated files that the processor was registered for.
Gradle will always recompile any files the processor generates.</p>
</div>
</div>
<div class="sect4">
<h5 id="state_of_support_in_popular_annotation_processors"><a class="anchor" href="#state_of_support_in_popular_annotation_processors"></a><a class="link" href="#state_of_support_in_popular_annotation_processors">State of support in popular annotation processors</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Many popular annotation processors support incremental annotation processing (see the table below). Check with the annotation processor project directly for the most up-to-date information and documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation Processor</th>
<th class="tableblock halign-left valign-top">Supported since</th>
<th class="tableblock halign-left valign-top">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto">Auto Value</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto/releases/tag/auto-value-1.6.3">1.6.3</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto">Auto Service</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto/releases/tag/auto-value-1.6.3">1.6.3</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto">Auto Value extensions</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Partly supported.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/auto/issues/673">Details in issue</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/JakeWharton/butterknife">Butterknife</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/JakeWharton/butterknife/commit/2acac62c7354fee46a5201d50a4712732f6dd1ed">10.2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/rzwitserloot/lombok">Lombok</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/rzwitserloot/lombok/releases/tag/v1.16.22">1.16.22</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DataBinding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://issuetracker.google.com/issues/110061530#comment28">AGP 3.5.0-alpha5</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Hidden behind a feature toggle</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Dagger</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/google/dagger/issues/1120">2.18</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.18 Feature toggle support, 2.24 Enabled by default</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>kapt</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://youtrack.jetbrains.com/issue/KT-23880">1.3.30</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Hidden behind a feature toggle</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Toothpick</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/stephanenicolas/toothpick/pull/320">2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Glide</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/bumptech/glide/releases/tag/v4.9.0">4.9.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Toothpick</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/stephanenicolas/toothpick/pull/320">2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Android-State</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/evernote/android-state/releases/tag/v1.3.0">1.3.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Parceler</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/johncarl81/parceler/releases/tag/parceler-project-1.1.11">1.1.11</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Dart and Henson</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/f2prateek/dart/releases/tag/3.1.0">3.1.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MapStruct</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/mapstruct/mapstruct/issues/1420">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/square/AssistedInject">Assisted Inject</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/square/AssistedInject/blob/master/CHANGELOG.md#version-050-2019-08-08">0.5.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Realm</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/realm/realm-java/issues/5906">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Requery</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/requery/requery/issues/773">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>EventBus</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/greenrobot/EventBus/issues/528">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>EclipseLink</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=535985">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher">PermissionsDispatcher</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher/releases/tag/4.2.0">4.2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Immutables</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/immutables/immutables/issues/804">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://developer.android.com/topic/libraries/architecture/room">Room</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://developer.android.com/jetpack/androidx/releases/room#version_220_3">2.2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Hidden behind a feature toggle</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://developer.android.com/jetpack/androidx/releases/lifecycle">Lifecycle</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://issuetracker.google.com/issues/129115778">2.2.0-alpha02</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Android Annotations</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/androidannotations/androidannotations/issues/2193">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DBFlow</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/agrosner/DBFlow/issues/1648">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>AndServer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/yanzhenjie/AndServer/issues/152">Open issue</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/facebook/litho">Litho</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/facebook/litho/blob/master/CHANGELOG.md#version-0250">0.25.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/moxy-community/Moxy/">Moxy</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/moxy-community/Moxy/releases/tag/2.0.0">2.0</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Epoxy</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/airbnb/epoxy/pull/902">Open PR</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://docs.jboss.org/hibernate/orm/5.4/topical/html_single/metamodelgen/MetamodelGenerator.html">JPA Static Metamodel Generator</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://github.com/hibernate/hibernate-orm/releases/tag/5.4.11">5.4.11</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_compile_avoidance"><a class="anchor" href="#sec:java_compile_avoidance"></a><a class="link" href="#sec:java_compile_avoidance">Compilation avoidance</a></h4>
<div class="paragraph">
<p>If a dependent project has changed in an <a href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a>-compatible way (only its private API has changed), then Java compilation tasks will be up-to-date. This means that if project <code>A</code> depends on project <code>B</code> and a class in <code>B</code> is changed in an ABI-compatible way (typically, changing only the body of a method), then Gradle won&#8217;t recompile <code>A</code>.</p>
</div>
<div class="paragraph">
<p>Some of the types of changes that do not affect the public API and are ignored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changing a method body</p>
</li>
<li>
<p>Changing a comment</p>
</li>
<li>
<p>Adding, removing or changing private methods, fields, or inner classes</p>
</li>
<li>
<p>Adding, removing or changing a resource</p>
</li>
<li>
<p>Changing the name of jars or directories in the classpath</p>
</li>
<li>
<p>Renaming a parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since implementation details matter for annotation processors, they must be declared separately on the annotation processor path.
Gradle ignores annotation processors on the compile classpath.</p>
</div>
<div class="exampleblock">
<div class="title">Example 603. Declaring annotation processors</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// The dagger compiler and its transitive dependencies will only be found on annotation processing classpath</span>
    annotationProcessor <span class="string"><span class="delimiter">'</span><span class="content">com.google.dagger:dagger-compiler:2.8</span><span class="delimiter">'</span></span>

    <span class="comment">// And we still need the Dagger library on the compile classpath itself</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.dagger:dagger:2.8</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // The dagger compiler and its transitive dependencies will only be found on annotation processing classpath
    annotationProcessor(&quot;com.google.dagger:dagger-compiler:2.8&quot;)

    // And we still need the Dagger library on the compile classpath itself
    implementation(&quot;com.google.dagger:dagger:2.8&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="variant_aware_selection"><a class="anchor" href="#variant_aware_selection"></a><a class="link" href="#variant_aware_selection">Variant aware selection</a></h4>
<div class="paragraph">
<p>The whole set of JVM plugins leverage <a href="#">variant aware resolution</a> for the dependencies used.
They also install a set of attributes compatibility and disambiguation rules to <a href="#sub:jvm_default_attributes">configure the Gradle attributes</a> for the specifics of the JVM ecosystem.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_library_plugin"><a class="anchor" href="#java_library_plugin"></a><a class="link" href="#java_library_plugin">The Java Library Plugin</a></h3>
<div class="paragraph">
<p>The Java Library plugin expands the capabilities of the <a href="#">Java plugin</a> by providing specific knowledge about Java libraries.
In particular, a Java library exposes an API to consumers (i.e., other projects using the Java or the Java Library plugin).
All the source sets, tasks and configurations exposed by the Java plugin are implicitly available when using this plugin.</p>
</div>
<div class="sect3">
<h4 id="sec:java_library_usage"><a class="anchor" href="#sec:java_library_usage"></a><a class="link" href="#sec:java_library_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java Library plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 604. Using the Java Library plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_separation"><a class="anchor" href="#sec:java_library_separation"></a><a class="link" href="#sec:java_library_separation">API and implementation separation</a></h4>
<div class="paragraph">
<p>The key difference between the standard Java plugin and the Java Library plugin is that the latter introduces the concept of an <em>API</em> exposed to consumers. A library is a Java component meant to be consumed by other components. It&#8217;s a very common use case in multi-project builds, but also as soon as you have external dependencies.</p>
</div>
<div class="paragraph">
<p>The plugin exposes two <a href="#sec:what-are-dependency-configurations">configurations</a> that can be used to declare dependencies: <code>api</code> and <code>implementation</code>.
The <code>api</code> configuration should be used to declare dependencies which are exported by the library API, whereas the <code>implementation</code> configuration should be used to declare dependencies which are internal to the component.</p>
</div>
<div class="exampleblock">
<div class="title">Example 605. Declaring API and implementation dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.7</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    api(&quot;org.apache.httpcomponents:httpclient:4.5.7&quot;)
    implementation(&quot;org.apache.commons:commons-lang3:3.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Dependencies appearing in the <code>api</code> configurations will be transitively exposed to consumers of the library, and as such will appear on the compile classpath of consumers. Dependencies found in the <code>implementation</code> configuration will, on the other hand, not be exposed to consumers, and therefore not leak into the consumers' compile classpath. This comes with several benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dependencies do not leak into the compile classpath of consumers anymore, so you will never accidentally depend on a transitive dependency</p>
</li>
<li>
<p>faster compilation thanks to reduced classpath size</p>
</li>
<li>
<p>less recompilations when implementation dependencies change: consumers would not need to be recompiled</p>
</li>
<li>
<p>cleaner publishing: when used in conjunction with the new <code>maven-publish</code> plugin, Java libraries produce POM files that distinguish exactly between what is required to compile against the library and what is required to use the library at runtime (in other words, don&#8217;t mix what is needed to compile the library itself and what is needed to compile against the library).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>compile</code> configuration still exists but should not be used as it will not offer the guarantees that the <code>api</code> and <code>implementation</code> configurations provide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your build consumes a published module with POM metadata, the Java and Java Library plugins both honor api and implementation separation through the scopes used in the pom.
Meaning that the compile classpath only includes <code>compile</code> scoped dependencies, while the runtime classpath adds the <code>runtime</code> scoped dependencies as well.</p>
</div>
<div class="paragraph">
<p>This often does not have an effect on modules published with Maven, where the POM that defines the project is directly published as metadata.
There, the compile scope includes both dependencies that were required to compile the project (i.e. implementation dependencies) and dependencies required to compile against the published library (i.e. API dependencies).
For most published libraries, this means that all dependencies belong to the compile scope.
If you encounter such an issue with an existing library, you can consider a <a href="#sec:component_metadata_rules">component metadata rule</a> to fix the incorrect metadata in your build.
However, as mentioned above, if the library is published with Gradle, the produced POM file only puts <code>api</code> dependencies into the compile scope and the remaining <code>implementation</code> dependencies into the runtime scope.</p>
</div>
<div class="paragraph">
<p>If your build consumes modules with Ivy metadata, you might be able to activate api and implementation separation as described <a href="#sub:ivy-mapping-to-variants">here</a> if all modules follow a certain structure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Separating compile and runtime scope of modules is active by default in Gradle 5.0+. In Gradle 4.6+, you need to activate it by adding <code>enableFeaturePreview('IMPROVED_POM_SUPPORT')</code> in <em>settings.gradle</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_recognizing_dependencies"><a class="anchor" href="#sec:java_library_recognizing_dependencies"></a><a class="link" href="#sec:java_library_recognizing_dependencies">Recognizing API and implementation dependencies</a></h4>
<div class="paragraph">
<p>This section will help you identify API and Implementation dependencies in your code using simple rules of thumb. The first of these is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prefer the <code>implementation</code> configuration over <code>api</code> when possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This keeps the dependencies off of the consumer&#8217;s compilation classpath. In addition, the consumers will immediately fail to compile if any implementation types accidentally leak into the public API.</p>
</div>
<div class="paragraph">
<p>So when should you use the <code>api</code> configuration? An API dependency is one that contains at least one type that is exposed in the library binary interface, often referred to as its ABI (Application Binary Interface). This includes, but is not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>types used in super classes or interfaces</p>
</li>
<li>
<p>types used in public method parameters, including generic parameter types (where <em>public</em> is something that is visible to compilers. I.e. , <em>public</em>, <em>protected</em> and <em>package private</em> members in the Java world)</p>
</li>
<li>
<p>types used in public fields</p>
</li>
<li>
<p>public annotation types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By contrast, any type that is used in the following list is irrelevant to the ABI, and therefore should be declared as an <code>implementation</code> dependency:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>types exclusively used in method bodies</p>
</li>
<li>
<p>types exclusively used in private members</p>
</li>
<li>
<p>types exclusively found in internal classes (future versions of Gradle will let you declare which packages belong to the public API)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following class makes use of a couple of third-party libraries, one of which is exposed in the class&#8217;s public API and the other is only used internally. The import statements don&#8217;t help us determine which is which, so we have to look at the fields, constructors and methods instead:</p>
</div>
<div class="sect4">
<h5 id="example_making_the_difference_between_api_and_implementation"><a class="anchor" href="#example_making_the_difference_between_api_and_implementation"></a><a class="link" href="#example_making_the_difference_between_api_and_implementation">Example: Making the difference between API and implementation</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">src/main/java/org/gradle/HttpClientWrapper.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// The following types can appear anywhere in the code</span>
<span class="comment">// but say nothing about API or implementation usage</span>
<span class="keyword">import</span> <span class="include">org.apache.commons.lang3.exception.ExceptionUtils</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpEntity</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpResponse</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">org.apache.http.client.methods.HttpGet</span>;

<span class="keyword">import</span> <span class="include">java.io.ByteArrayOutputStream</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.UnsupportedEncodingException</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HttpClientWrapper</span> {

    <span class="directive">private</span> <span class="directive">final</span> HttpClient client; <span class="comment">// private member: implementation details</span>

    <span class="comment">// HttpClient is used as a parameter of a public method</span>
    <span class="comment">// so &quot;leaks&quot; into the public API of this component</span>
    <span class="directive">public</span> HttpClientWrapper(HttpClient client) {
        <span class="local-variable">this</span>.client = client;
    }

    <span class="comment">// public methods belongs to your API</span>
    <span class="directive">public</span> <span class="type">byte</span><span class="type">[]</span> doRawGet(<span class="predefined-type">String</span> url) {
        HttpGet request = <span class="keyword">new</span> HttpGet(url);
        <span class="keyword">try</span> {
            HttpEntity entity = doGet(request);
            <span class="predefined-type">ByteArrayOutputStream</span> baos = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>();
            entity.writeTo(baos);
            <span class="keyword">return</span> baos.toByteArray();
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            ExceptionUtils.rethrow(e); <span class="comment">// this dependency is internal only</span>
        } <span class="keyword">finally</span> {
            request.releaseConnection();
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="comment">// HttpGet and HttpEntity are used in a private method, so they don't belong to the API</span>
    <span class="directive">private</span> HttpEntity doGet(HttpGet get) <span class="directive">throws</span> <span class="exception">Exception</span> {
        HttpResponse response = client.execute(get);
        <span class="keyword">if</span> (response.getStatusLine().getStatusCode() != HttpStatus.SC_OK) {
            <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Method failed: </span><span class="delimiter">&quot;</span></span> + response.getStatusLine());
        }
        <span class="keyword">return</span> response.getEntity();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>public</em> constructor of <code>HttpClientWrapper</code> uses <code>HttpClient</code> as a parameter, so it is exposed to consumers and therefore belongs to the API. Note that <code>HttpGet</code> and <code>HttpEntity</code> are used in the signature of a <em>private</em> method, and so they don&#8217;t count towards making HttpClient an API dependency.</p>
</div>
<div class="paragraph">
<p>On the other hand, the <code>ExceptionUtils</code> type, coming from the <code>commons-lang</code> library, is only used in a method body (not in its signature), so it&#8217;s an implementation dependency.</p>
</div>
<div class="paragraph">
<p>Therefore, we can deduce that <code>httpclient</code> is an API dependency, whereas <code>commons-lang</code> is an implementation dependency. This conclusion translates into the following declaration in the build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 606. Declaring API and implementation dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.httpcomponents:httpclient:4.5.7</span><span class="delimiter">'</span></span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    api(&quot;org.apache.httpcomponents:httpclient:4.5.7&quot;)
    implementation(&quot;org.apache.commons:commons-lang3:3.5&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_configurations_graph"><a class="anchor" href="#sec:java_library_configurations_graph"></a><a class="link" href="#sec:java_library_configurations_graph">The Java Library plugin configurations</a></h4>
<div class="paragraph">
<p>The following graph describes the main configurations setup when the Java Library plugin is in use.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-library-ignore-deprecated-main.png" alt="java library ignore deprecated main">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The configurations in <em>green</em> are the ones a user should use to declare dependencies</p>
</li>
<li>
<p>The configurations in <em>pink</em> are the ones used when a component compiles, or runs against the library</p>
</li>
<li>
<p>The configurations in <em>blue</em> are internal to the component, for its own use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And the next graph describes the test configurations setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/java-library-ignore-deprecated-test.png" alt="java library ignore deprecated test">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>compile</em>, <em>testCompile</em>, <em>runtime</em> and <em>testRuntime</em> configurations inherited from the Java plugin are still available but are deprecated. You should avoid using them, as they are only kept for backwards compatibility.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The role of each configuration is described in the following tables:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 32. Java Library plugin - configurations used to declare dependencies</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring API dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are transitively exported to consumers, for compile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>implementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring implementation dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are purely internal and not meant to be exposed to consumers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are only required at compile time, but should not leak into the runtime. This typically includes dependencies which are shaded when found at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtimeOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring runtime dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are only required at runtime, and not at compile time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are used to compile tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testCompileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring test compile only dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are only required at test compile time, but should not leak into the runtime. This typically includes dependencies which are shaded when found at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>testRuntimeOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring test runtime dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where you should declare dependencies which are only required at test runtime, and not at test compile time.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 33. Java Library plugin  configurations used by consumers</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiElements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling against this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration is meant to be used by consumers, to retrieve all the elements necessary to compile against this library. Unlike the <code>default</code> configuration, this doesn&#8217;t leak implementation or runtime dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtimeElements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration is meant to be used by consumers, to retrieve all the elements necessary to run against this library.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 34. Java Library plugin - configurations used by the library itself</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Consumable?</th>
<th class="tableblock halign-left valign-top">Resolvable?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compileClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the compile classpath of this library, and is therefore used when invoking the java compiler to compile it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtimeClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the runtime classpath of this library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testCompileClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For compiling the tests of this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the test compile classpath of this library.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">testRuntimeClasspath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For executing tests of this library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration contains the test runtime classpath of this library</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_library_modular"><a class="anchor" href="#sec:java_library_modular"></a><a class="link" href="#sec:java_library_modular">Building Modules for the Java Module System</a></h4>
<div class="paragraph">
<p>Since Java 9, Java itself offers a <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">module system</a> that allows for strict encapsulation during compile and runtime.
You can turn a Java library into a <em>Java Module</em> by creating a <code>module-info.java</code> file in the <code>main/java</code> source folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>src
 main
     java
         module-info.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the module info file, you declare a <em>module name</em>, which packages of your module you want to <em>export</em> and which other modules you <em>require</em>.</p>
</div>
<div class="listingblock">
<div class="title">module-info.java file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module org.gradle.sample {
    exports org.gradle.sample;
    requires com.google.gson;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To tell the Java compiler that a Jar is a module, as opposed to a traditional Java library, Gradle needs to place it on the so called <em>module path</em>.
It is an alternative to the <em>classpath</em>, which is the traditional way to tell the compiler about compiled dependencies.
Gradle will automatically put a Jar of your dependencies on the module path, instead of the classpath, if these three things are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Module path inference is turned on via <code>java. modularity.inferModulePath.set(true)</code></p>
</li>
<li>
<p>We are actually building a module (as opposed to a traditional library) which we expressed by adding the <code>module-info.java</code> file.
(Another option is to add the <code>Automatic-Module-Name</code> Jar manifest attribute as <a href="#sec:java_library_modular_auto">described further down</a>.)</p>
</li>
<li>
<p>The Jar our module depends on is itself a module, which Gradles decides based on the presence of a <code>module-info.class</code>&#8201;&#8212;&#8201;the compiled version of the module descriptor&#8201;&#8212;&#8201;in the Jar.
(Or, alternatively, the presence of an <code>Automatic-Module-Name</code> attribute the Jar manifest)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following, some more details about defining Java modules and how that interacts with Gradle&#8217;s dependency management are described.
You can also look at a <a href="../samples/sample_java_modules_multi_project.html">ready made example</a> to try out the Java Module support directly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Java Module System support is an incubating feature and therefore you need to turn on <em>module path inference</em> explicitly as shown below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 607. Activate module path inference</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    modularity.inferModulePath = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    modularity.inferModulePath.set(true)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declaring_module_dependencies"><a class="anchor" href="#declaring_module_dependencies"></a><a class="link" href="#declaring_module_dependencies">Declaring module dependencies</a></h5>
<div class="paragraph">
<p>There is a direct relationship to the dependencies you declare in the build file and the module dependencies you declare in the <code>module-info.java</code> file.
Ideally the declarations should be in sync as seen in the following table.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 35. Mapping between Java module directives and Gradle configurations to declare dependencies</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Module Directive</th>
<th class="tableblock halign-left valign-top">Gradle Configuration</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>implementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring implementation dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires transitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring API dependencies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requires static</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compileOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring compile only dependencies</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Gradle currently does not automatically check if the dependency declarations are in sync.
This may be added in future versions.</p>
</div>
<div class="paragraph">
<p>For more details on declaring module dependencies, please refer to <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">documentation on the Java Module System</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_package_visibility_and_services"><a class="anchor" href="#declaring_package_visibility_and_services"></a><a class="link" href="#declaring_package_visibility_and_services">Declaring package visibility and services</a></h5>
<div class="paragraph">
<p>The Java module system supports additional more fine granular encapsulation concepts than Gradle itself currently does.
For example, you explicitly need to declare which packages are part of your API and which are only visible inside your module.
Some of these capabilities might be added to Gradle itself in future versions.
For now, please refer to <a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">documentation on the Java Module System</a> to learn how to use these features in Java Modules.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring_module_versions"><a class="anchor" href="#declaring_module_versions"></a><a class="link" href="#declaring_module_versions">Declaring module versions</a></h5>
<div class="paragraph">
<p>Java Modules also have a version that is encoded as part of the module identity in the <code>module-info.class</code> file.
This version can be inspected when a module is running.</p>
</div>
<div class="exampleblock">
<div class="title">Example 608. Declare the module version in the build script or directly as compile task option</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.2</span><span class="delimiter">'</span></span>

tasks.compileJava {
    <span class="comment">// use the project's version or define one directly</span>
    options.javaModuleVersion = provider { project.version }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">version = &quot;1.2&quot;

tasks.compileJava {
    // use the project's version or define one directly
    options.javaModuleVersion.set(provider { project.version as String })
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using_libraries_that_are_not_modules"><a class="anchor" href="#using_libraries_that_are_not_modules"></a><a class="link" href="#using_libraries_that_are_not_modules">Using libraries that are not modules</a></h5>
<div class="paragraph">
<p>You probably want to use external libraries, like OSS libraries from Maven Central, in your modular Java project.
Some libraries, in their newer versions, are already full modules with a module descriptor.
For example, <code>com.google.code.gson:gson:2.8.6</code> that has the module name <code>com.google.gson</code>.</p>
</div>
<div class="paragraph">
<p>Others, like <code>org.apache.commons:commons-lang3:3.10</code>, may not offer a full module descriptor but will at least contain an <code>Automatic-Module-Name</code> entry in their manifest file to define the module&#8217;s name (<code>org.apache.commons.lang3</code> in the example).
Such modules, that only have a name as module description, are called <em>automatic module</em> that export <strong>all</strong> their packages and can read <strong>all</strong> modules on the module path.</p>
</div>
<div class="paragraph">
<p>A third case are traditional libraries that provide no module information at all&#8201;&#8212;&#8201;for example <code>commons-cli:commons-cli:1.4</code>.
Gradle puts such libraries on the classpath instead of the module path.
The classpath is then treated as one module (the so called <em>unnamed</em> module) by Java.</p>
</div>
<div class="exampleblock">
<div class="title">Example 609. Dependencies to modules and libraries declared in build file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.code.gson:gson:2.8.6</span><span class="delimiter">'</span></span>       <span class="comment">// real module</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.10</span><span class="delimiter">'</span></span> <span class="comment">// automatic module</span>
    implementation <span class="string"><span class="delimiter">'</span><span class="content">commons-cli:commons-cli:1.4</span><span class="delimiter">'</span></span>           <span class="comment">// plain library</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;com.google.code.gson:gson:2.8.6&quot;)       // real module
    implementation(&quot;org.apache.commons:commons-lang3:3.10&quot;) // automatic module
    implementation(&quot;commons-cli:commons-cli:1.4&quot;)           // plain library
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Module dependencies declared in module-info.java file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module org.gradle.sample.lib {
    requires com.google.gson;          <span class="comment">// real module</span>
    requires org.apache.commons.lang3; <span class="comment">// automatic module</span>
    <span class="comment">// commons-cli-1.4.jar is not a module and cannot be required</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While a real module cannot directly depend on the unnamed module (only by adding command line flags), automatic modules can also see the unnamed module.
Thus, if you cannot avoid to rely on a library without module information, you can wrap that library in an automatic module as part of your project.
How you do that is described in the next section.</p>
</div>
<div class="paragraph">
<p>Another way to deal with non-modules is to enrich existing Jars with module descriptors yourself using <a href="#">artifact transforms</a>.
<a href="../samples/sample_java_modules_with_transform.html">This sample</a> contains a small <em>buildSrc</em> plugin registering such a transform which you may use and adjust to your needs.
This can be interesting if you want to build a fully <a href="#sec:application_modular">modular application</a> and want the java runtime to treat everything as a real module.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:java_library_modular_auto"><a class="anchor" href="#sec:java_library_modular_auto"></a><a class="link" href="#sec:java_library_modular_auto">Building an automatic module</a></h5>
<div class="paragraph">
<p>If you can, you should always write complete <code>module-info.java</code> descriptors for your modules.
Still, there are a few cases where you might consider to (initally) only provide a <em>module name</em> for an automatic module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You are working on a library that is <strong>not</strong> a module but you want to make it usable as such in the next release.
Adding an <code>Automatic-Module-Name</code> is a good first step (most popular OSS libraries on Maven central have done it by now).</p>
</li>
<li>
<p>As discussed in the previous section, an automatic module can be used as an adapter between your real modules and a traditional library on the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To turn a normal Java project into an <em>automatic module</em>, just add the manifest entry with the module name:</p>
</div>
<div class="exampleblock">
<div class="title">Example 610. Declare an automatic module name as Jar manifest attribute</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.jar {
    manifest {
        attributes(<span class="string"><span class="delimiter">'</span><span class="content">Automatic-Module-Name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.jar {
    manifest {
        attributes(&quot;Automatic-Module-Name&quot; to &quot;org.gradle.sample&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can define an automatic module as part of a multi-project that otherwise defines real modules (e.g. as an adapter to another library).
While this works fine in the Gradle build, such automatic module projects are not correctly recognized by IDEA/Eclipse at the moment.
You can work around it by manually adding the Jar built for the automatic module to the dependencies of the project that does not find it in the IDE&#8217;s UI.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_classes_usage"><a class="anchor" href="#sec:java_library_classes_usage"></a><a class="link" href="#sec:java_library_classes_usage">Using classes instead of jar for compilation</a></h4>
<div class="paragraph">
<p>A feature of the <code>java-library</code> plugin is that projects which consume the library only require the classes folder for compilation, instead of the full JAR.
This enables lighter inter-project dependencies as resources processing (<code>processResources</code> task) and archive construction (<code>jar</code> task) are no longer executed when only Java code compilation is performed during development.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The usage or not of the classes output instead of the JAR is a <em>consumer</em> decision.
For example, Groovy consumers will request classes <em>and</em> processed resources as these may be needed for executing AST transformation as part of the compilation process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sub:java_library_known_issues_memory"><a class="anchor" href="#sub:java_library_known_issues_memory"></a><a class="link" href="#sub:java_library_known_issues_memory">Increased memory usage for consumers</a></h5>
<div class="paragraph">
<p>An indirect consequence is that up-to-date checking will require more memory, because Gradle will snapshot individual class files instead of a single jar.
This may lead to increased memory consumption for large projects, with the benefit of having the <code>compileJava</code> task up-to-date in more cases (e.g. changing resources no longer changes the input for <code>compileJava</code> tasks of upstream projects)</p>
</div>
</div>
<div class="sect4">
<h5 id="sub:java_library_known_issues_windows_performance"><a class="anchor" href="#sub:java_library_known_issues_windows_performance"></a><a class="link" href="#sub:java_library_known_issues_windows_performance">Significant build performance drop on Windows for huge multi-projects</a></h5>
<div class="paragraph">
<p>Another side effect of the snapshotting of individual class files, only affecting Windows systems, is that the performance can significantly drop when processing a very large amount of class files on the compile classpath.
This only concerns very large multi-projects where a lot of classes are present on the classpath by using many <code>api</code> or (deprecated) <code>compile</code> dependencies.
To mitigate this, you can set the <code>org.gradle.java.compile-classpath-packaging</code> system property to <code>true</code> to change the behavior of the Java Library plugin to use jars instead of class folders for everything on the compile classpath.
Note, since this has other performance impacts and potentially side effects, by triggering all jar tasks at compile time, it is only recommended to activate this if you suffer from the described performance issue on Windows.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:library_distribution"><a class="anchor" href="#sec:library_distribution"></a><a class="link" href="#sec:library_distribution">Distributing a library</a></h4>
<div class="paragraph">
<p>Aside from <a href="#">publishing</a> a library to a component repository, you may sometimes need to package a library and its dependencies in a distribution deliverable.
The <a href="#">Java Library Distribution Plugin</a> is there to help you do just that.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_library_distribution_plugin"><a class="anchor" href="#java_library_distribution_plugin"></a><a class="link" href="#java_library_distribution_plugin">The Java Library Distribution Plugin</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Java library distribution plugin is currently <a href="feature_lifecycle.html#feature_lifecycle">incubating</a>. Please be aware that the DSL and other configuration may change in later Gradle versions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Java library distribution plugin adds support for building a distribution ZIP for a Java library. The distribution contains the JAR file for the library and its dependencies.</p>
</div>
<div class="sect3">
<h4 id="sec:java_library_distribution_usage"><a class="anchor" href="#sec:java_library_distribution_usage"></a><a class="link" href="#sec:java_library_distribution_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java library distribution plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 611. Using the Java library distribution plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library-distribution</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library-distribution`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To define the name for the distribution you have to set the <code>baseName</code> property as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 612. Configure the distribution name</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">distributions {
    main {
        distributionBaseName = <span class="string"><span class="delimiter">'</span><span class="content">my-name</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">distributions {
    main {
        distributionBaseName.set(&quot;my-name&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin builds a distribution for your library. The distribution will package up the runtime dependencies of the library. All files stored in <code>src/main/dist</code> will be added to the root of the archive distribution. You can run <code>gradle distZip</code> to create a ZIP file containing the distribution.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_library_distribution_tasks"><a class="anchor" href="#sec:java_library_distribution_tasks"></a><a class="link" href="#sec:java_library_distribution_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Java library distribution plugin adds the following tasks to the project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>distZip</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a></dt>
<dd>
<p><em>Depends on</em>: <code>jar</code></p>
<div class="paragraph">
<p>Creates a full distribution ZIP archive including runtime libraries.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="java_library_distribution_resources"><a class="anchor" href="#java_library_distribution_resources"></a><a class="link" href="#java_library_distribution_resources">Including other resources in the distribution</a></h4>
<div class="paragraph">
<p>All of the files from the <code>src/dist</code> directory are copied. To include any static files in the distribution, simply arrange them in the <code>src/dist</code> directory, or add them to the content of the distribution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 613. Include files in the distribution</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">distributions {
    main {
        distributionBaseName = <span class="string"><span class="delimiter">'</span><span class="content">my-name</span><span class="delimiter">'</span></span>
        contents {
            from <span class="string"><span class="delimiter">'</span><span class="content">src/dist</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">distributions {
    main {
        distributionBaseName.set(&quot;my-name&quot;)
        contents {
            from(&quot;src/dist&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java_platform_plugin"><a class="anchor" href="#java_platform_plugin"></a><a class="link" href="#java_platform_plugin">The Java Platform Plugin</a></h3>
<div class="paragraph">
<p>The Java Platform plugin brings the ability to declare platforms for the Java ecosystem.
A platform can be used for different purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a description of modules which are published together (and for example, share the same version)</p>
</li>
<li>
<p>a set of recommended versions for heterogeneous libraries. A typical example includes the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html#using-boot-dependency-management">Spring Boot BOM</a></p>
</li>
<li>
<p><a href="#sec:java_platform_consumption">sharing a set of dependency versions</a> between subprojects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A platform is a special kind of software component which doesn&#8217;t contain any sources:
it is only used to reference other libraries, so that they play well together during dependency resolution.</p>
</div>
<div class="paragraph">
<p>Platforms can be published as <a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/docs/design/gradle-module-metadata-latest-specification.md">Gradle Module Metadata</a> and <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Management">Maven BOMs</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>java-platform</code> plugin cannot be used in combination with the <code>java</code> or <code>java-library</code> plugins in a given project.
Conceptually a project is either a platform, with no binaries, <em>or</em> produces binaries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sec:java_platform_usage"><a class="anchor" href="#sec:java_platform_usage"></a><a class="link" href="#sec:java_platform_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Java Platform plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 614. Using the Java Platform plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-platform</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-platform`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_separation"><a class="anchor" href="#sec:java_platform_separation"></a><a class="link" href="#sec:java_platform_separation">API and runtime separation</a></h4>
<div class="paragraph">
<p>A major difference between a Maven BOM and a Java platform is that in Gradle dependencies and <a href="#sub:terminology_dependency_constraint">constraints</a> are declared and scoped to a configuration and the ones extending it.
While many users will only care about declaring constraints for <em>compile time</em> dependencies, thus inherited by runtime and tests ones, it allows declaring dependencies or constraints that only apply to runtime or test.</p>
</div>
<div class="paragraph">
<p>For this purpose, the plugin exposes two <a href="#sec:what-are-dependency-configurations">configurations</a> that can be used to declare dependencies: <code>api</code> and <code>runtime</code>.
The <code>api</code> configuration should be used to declare constraints and dependencies which should be used when compiling against the platform, whereas the <code>runtime</code> configuration should be used to declare constraints or dependencies which are visible at runtime.</p>
</div>
<div class="exampleblock">
<div class="title">Example 615. Declaring API and runtime constraints</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient:3.1</span><span class="delimiter">'</span></span>
        runtime <span class="string"><span class="delimiter">'</span><span class="content">org.postgresql:postgresql:42.2.5</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        api(&quot;commons-httpclient:commons-httpclient:3.1&quot;)
        runtime(&quot;org.postgresql:postgresql:42.2.5&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this example makes use of <em>constraints</em> and not dependencies.
In general, this is what you would like to do: constraints will only apply if such a component is added to the dependency graph, either directly or transitively.
This means that all constraints listed in a platform would not add a dependency unless another component brings it in: they can be seen as <em>recommendations</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For example, if a platform declares a constraint on <code>org:foo:1.1</code>, and that nothing else brings in a dependency on <code>foo</code>, <code>foo</code> will <em>not</em> appear in the graph.
However, if <code>foo</code> appears, then usual conflict resolution would kick in. If a dependency brings in <code>org:foo:1.0</code>, then we would select <code>org:foo:1.1</code> to satisfy the platform constraint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, in order to avoid the common mistake of adding a dependency in a platform instead of a constraint, Gradle will fail if you try to do so.
If, for some reason, you also want to add <em>dependencies</em> in addition to constraints, you need to enable it explicitly:</p>
</div>
<div class="exampleblock">
<div class="title">Example 616. Allowing declaration of dependencies</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">javaPlatform {
    allowDependencies()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">javaPlatform {
    allowDependencies()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_project_constraints"><a class="anchor" href="#sec:java_platform_project_constraints"></a><a class="link" href="#sec:java_platform_project_constraints">Local project constraints</a></h4>
<div class="paragraph">
<p>If you have a multi-project build and want to publish a platform that links to subprojects, you can do it by declaring constraints on the subprojects which belong to the platform, as in the example below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 617. Declaring constraints on subprojects</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        api project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:core</span><span class="delimiter">&quot;</span></span>)
        api project(<span class="string"><span class="delimiter">&quot;</span><span class="content">:lib</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        api(project(&quot;:core&quot;))
        api(project(&quot;:lib&quot;))
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The project notation will become a classical <code>group:name:version</code> notation in the published metadata.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_bom_import"><a class="anchor" href="#sec:java_platform_bom_import"></a><a class="link" href="#sec:java_platform_bom_import">Sourcing constraints from another platform</a></h4>
<div class="paragraph">
<p>Sometimes the platform you define is an extension of another existing platform.</p>
</div>
<div class="paragraph">
<p>In order to have your platform include the constraints from that third party platform, it needs to be imported as a <code>platform</code> <em>dependency</em>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 618. Importing a platform</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">javaPlatform {
    allowDependencies()
}

dependencies {
    api platform(<span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson:jackson-bom:2.9.8</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">javaPlatform {
    allowDependencies()
}

dependencies {
    api(platform(&quot;com.fasterxml.jackson:jackson-bom:2.9.8&quot;))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_publishing"><a class="anchor" href="#sec:java_platform_publishing"></a><a class="link" href="#sec:java_platform_publishing">Publishing platforms</a></h4>
<div class="paragraph">
<p>Publishing Java platforms is done by applying the <code>maven-publish</code> plugin and configuring a Maven publication that uses the <code>javaPlatform</code> component:</p>
</div>
<div class="exampleblock">
<div class="title">Example 619. Publishing as a BOM</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        myPlatform(MavenPublication) {
            from components.javaPlatform
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;myPlatform&quot;) {
            from(components[&quot;javaPlatform&quot;])
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will generate a BOM file for the platform, with a <code>&lt;dependencyManagement&gt;</code> block where its <code>&lt;dependencies&gt;</code> correspond to the constraints defined in the platform module.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:java_platform_consumption"><a class="anchor" href="#sec:java_platform_consumption"></a><a class="link" href="#sec:java_platform_consumption">Consuming platforms</a></h4>
<div class="paragraph">
<p>Because a Java Platform is a special kind of component, a dependency on a Java platform has to be declared using the <code>platform</code> or <code>enforcedPlatform</code> keyword, as explained in the <a href="#sub:bom_import">managing transitive dependencies</a> section.
For example, if you want to share dependency versions between subprojects, you can define a platform module which would declare all versions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 620. Recommend versions in a platform module</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    constraints {
        <span class="comment">// Platform declares some versions of libraries used in subprojects</span>
        api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient:3.1</span><span class="delimiter">'</span></span>
        api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-lang3:3.8.1</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    constraints {
        // Platform declares some versions of libraries used in subprojects
        api(&quot;commons-httpclient:commons-httpclient:3.1&quot;)
        api(&quot;org.apache.commons:commons-lang3:3.8.1&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And then have subprojects depend on the platform to get recommendations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 621. Get recommendations from a platform</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// get recommended versions from the platform project</span>
    api platform(project(<span class="string"><span class="delimiter">'</span><span class="content">:platform</span><span class="delimiter">'</span></span>))
    <span class="comment">// no version required</span>
    api <span class="string"><span class="delimiter">'</span><span class="content">commons-httpclient:commons-httpclient</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    // get recommended versions from the platform project
    api(platform(project(&quot;:platform&quot;)))
    // no version required
    api(&quot;commons-httpclient:commons-httpclient&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publishing_maven"><a class="anchor" href="#publishing_maven"></a><a class="link" href="#publishing_maven">Maven Publish Plugin</a></h3>
<div class="paragraph">
<p>The Maven Publish Plugin provides the ability to publish build artifacts to an <a href="http://maven.apache.org/">Apache Maven</a> repository.
A module published to a Maven repository can be consumed by Maven, Gradle (see <a href="#">Declaring Dependencies</a>) and other tools that understand the Maven repository format.
You can learn about the fundamentals of publishing in <a href="#publishing_overview">Publishing Overview</a>.</p>
</div>
<div class="sect3">
<h4 id="publishing_maven:usage"><a class="anchor" href="#publishing_maven:usage"></a><a class="link" href="#publishing_maven:usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Maven Publish Plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 622. Applying the Maven Publish Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `maven-publish`
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Maven Publish Plugin uses an extension on the project named <code>publishing</code> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.PublishingExtension.html">PublishingExtension</a>. This extension provides a container of named publications and a container of named repositories. The Maven Publish Plugin works with <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a> publications and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a> repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:tasks"><a class="anchor" href="#publishing_maven:tasks"></a><a class="link" href="#publishing_maven:tasks">Tasks</a></h4>
<div id="publishing_maven:generate-pom" class="dlist">
<dl>
<dt class="hdlist1"><code>generatePomFileFor<em>PubName</em>Publication</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.tasks.GenerateMavenPom.html">GenerateMavenPom</a></dt>
<dd>
<p>Creates a POM file for the publication named <em>PubName</em>, populating the known metadata such as project name, project version, and the dependencies. The default location for the POM file is <em>build/publications/$pubName/pom-default.xml</em>.</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html">PublishToMavenRepository</a></dt>
<dd>
<p>Publishes the <em>PubName</em> publication to the repository named <em>RepoName</em>. If you have a repository definition without an explicit name, <em>RepoName</em> will be "Maven".</p>
</dd>
<dt class="hdlist1"><code>publish<em>PubName</em>PublicationToMavenLocal</code>  <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html">PublishToMavenLocal</a></dt>
<dd>
<p>Copies the <em>PubName</em> publication to the local Maven cache typically <em>$USER_HOME/.m2/repository</em> along with the publication&#8217;s POM file and other metadata.</p>
</dd>
<dt class="hdlist1"><code>publish</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationTo<em>RepoName</em>Repository</code> tasks</p>
<div class="paragraph">
<p>An aggregate task that publishes all defined publications to all defined repositories. It does <em>not</em> include copying publications to the local Maven cache.</p>
</div>
</dd>
<dt class="hdlist1"><code>publishToMavenLocal</code></dt>
<dd>
<p><em>Depends on</em>: All <code>publish<em>PubName</em>PublicationToMavenLocal</code> tasks</p>
<div class="paragraph">
<p>Copies all defined publications to the local Maven cache, including their metadata (POM files, etc.).</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:publications"><a class="anchor" href="#publishing_maven:publications"></a><a class="link" href="#publishing_maven:publications">Publications</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_publication">publications</a> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>. To learn how to define and use publications, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>There are four main things you can configure in a Maven publication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="#sub:terminology_component">component</a> via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:from(org.gradle.api.component.SoftwareComponent)">MavenPublication.from(org.gradle.api.component.SoftwareComponent)</a>.</p>
</li>
<li>
<p><a href="#sec:publishing_custom_artifacts_to_maven">Custom artifacts</a> via the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:artifact(java.lang.Object)">MavenPublication.artifact(java.lang.Object)</a> method. See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenArtifact.html">MavenArtifact</a> for the available configuration options for custom Maven artifacts.</p>
</li>
<li>
<p>Standard metadata like <code>artifactId</code>, <code>groupId</code> and <code>version</code>.</p>
</li>
<li>
<p>Other contents of the POM file via <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication:pom(org.gradle.api.Action)">MavenPublication.pom(org.gradle.api.Action)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see all of these in action in the <a href="#publishing_maven:complete_example">complete publishing example</a>. The API documentation for <code>MavenPublication</code> has additional code samples.</p>
</div>
<div class="sect4">
<h5 id="sec:identity_values_in_the_generated_pom"><a class="anchor" href="#sec:identity_values_in_the_generated_pom"></a><a class="link" href="#sec:identity_values_in_the_generated_pom">Identity values in the generated POM</a></h5>
<div class="paragraph">
<p>The attributes of the generated POM file will contain identity values derived from the following project properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groupId</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:group">Project.getGroup()</a></p>
</li>
<li>
<p><code>artifactId</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:name">Project.getName()</a></p>
</li>
<li>
<p><code>version</code> - <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.Project.html#org.gradle.api.Project:version">Project.getVersion()</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overriding the default identity values is easy: simply specify the <code>groupId</code>, <code>artifactId</code> or <code>version</code> attributes when configuring the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 623. Customizing the publication identity</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    publishing {
        publications {
            maven(MavenPublication) {
                groupId = <span class="string"><span class="delimiter">'</span><span class="content">org.gradle.sample</span><span class="delimiter">'</span></span>
                artifactId = <span class="string"><span class="delimiter">'</span><span class="content">project1-sample</span><span class="delimiter">'</span></span>
                version = <span class="string"><span class="delimiter">'</span><span class="content">1.1</span><span class="delimiter">'</span></span>

                from components.java
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">    publishing {
        publications {
            create&lt;MavenPublication&gt;(&quot;maven&quot;) {
                groupId = &quot;org.gradle.sample&quot;
                artifactId = &quot;project1-sample&quot;
                version = &quot;1.1&quot;

                from(components[&quot;java&quot;])
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Certain repositories will not be able to handle all supported characters. For example, the <code>:</code> character cannot be used as an identifier when publishing to a filesystem-backed repository on Windows.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Maven restricts <code>groupId</code> and <code>artifactId</code> to a limited character set (<code>[A-Za-z0-9_\\-.]+</code>) and Gradle enforces this restriction. For <code>version</code> (as well as the artifact <code>extension</code> and <code>classifier</code> properties), Gradle will handle any valid Unicode character.</p>
</div>
<div class="paragraph">
<p>The only Unicode values that are explicitly prohibited are <code>\</code>, <code>/</code> and any ISO control character. Supplied values are validated early in publication.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:modifying_the_generated_pom"><a class="anchor" href="#sec:modifying_the_generated_pom"></a><a class="link" href="#sec:modifying_the_generated_pom">Customizing the generated POM</a></h5>
<div class="paragraph">
<p>The generated POM file can be customized before publishing. For example, when publishing a library to Maven Central you will need to set certain metadata. The Maven Publish Plugin provides a DSL for that purpose. Please see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPom.html">MavenPom</a> in the DSL Reference for the complete documentation of available properties and methods. The following sample shows how to use the most common ones:</p>
</div>
<div class="exampleblock">
<div class="title">Example 624. Customizing the POM file</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        mavenJava(MavenPublication) {
            pom {
                name = <span class="string"><span class="delimiter">'</span><span class="content">My Library</span><span class="delimiter">'</span></span>
                description = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
                properties = [
                    <span class="key">myProp</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">prop.with.dots</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">anotherValue</span><span class="delimiter">&quot;</span></span>
                ]
                licenses {
                    license {
                        name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                        url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                    }
                }
                developers {
                    developer {
                        id = <span class="string"><span class="delimiter">'</span><span class="content">johnd</span><span class="delimiter">'</span></span>
                        name = <span class="string"><span class="delimiter">'</span><span class="content">John Doe</span><span class="delimiter">'</span></span>
                        email = <span class="string"><span class="delimiter">'</span><span class="content">john.doe@example.com</span><span class="delimiter">'</span></span>
                    }
                }
                scm {
                    connection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:git://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    developerConnection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:ssh://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/my-library/</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            pom {
                name.set(&quot;My Library&quot;)
                description.set(&quot;A concise description of my library&quot;)
                url.set(&quot;http://www.example.com/library&quot;)
                properties.set(mapOf(
                    &quot;myProp&quot; to &quot;value&quot;,
                    &quot;prop.with.dots&quot; to &quot;anotherValue&quot;
                ))
                licenses {
                    license {
                        name.set(&quot;The Apache License, Version 2.0&quot;)
                        url.set(&quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;)
                    }
                }
                developers {
                    developer {
                        id.set(&quot;johnd&quot;)
                        name.set(&quot;John Doe&quot;)
                        email.set(&quot;john.doe@example.com&quot;)
                    }
                }
                scm {
                    connection.set(&quot;scm:git:git://example.com/my-library.git&quot;)
                    developerConnection.set(&quot;scm:git:ssh://example.com/my-library.git&quot;)
                    url.set(&quot;http://example.com/my-library/&quot;)
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="publishing_maven:resolved_dependencies"><a class="anchor" href="#publishing_maven:resolved_dependencies"></a><a class="link" href="#publishing_maven:resolved_dependencies">Customizing dependencies versions</a></h5>
<div class="paragraph">
<p>Two strategies are supported for publishing dependencies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declared versions (default)</dt>
<dd>
<p>This strategy publishes the versions that are defined by the build script author with the dependency declarations in the <code>dependencies</code> block.
Any other kind of processing, for example through <a href="#">a rule changing the resolved version</a>, will not be taken into account for the publication.</p>
</dd>
<dt class="hdlist1">Resolved versions</dt>
<dd>
<p>This strategy publishes the versions that were resolved during the build, possibly by applying resolution rules and automatic conflict resolution.
This has the advantage that the published versions correspond to the ones the published artifact was tested against.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example use cases for resolved versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project uses dynamic versions for dependencies but prefers exposing the resolved version for a given release to its consumers.</p>
</li>
<li>
<p>In combination with <a href="#">dependency locking</a>, you want to publish the locked versions.</p>
</li>
<li>
<p>A project leverages the rich versions constraints of Gradle, which have a lossy conversion to Maven.
Instead of relying on the conversion, it publishes the resolved versions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done by using the <code>versionMapping</code> DSL method which allows to configure the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/publish/VersionMappingStrategy.html">VersionMappingStrategy</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 625. Using resolved versions</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    publications {
        mavenJava(MavenPublication) {
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, Gradle will use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>api</code>, which are mapped to the <code>compile</code> scope of Maven.
Gradle will also use the versions resolved on the <code>runtimeClasspath</code> for dependencies declared in <code>implementation</code>, which are mapped to the <code>runtime</code> scope of Maven.
<code>fromResolutionResult()</code> indicates that Gradle should use the default classpath of a variant and <code>runtimeClasspath</code> is the default classpath of <code>java-runtime</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:repositories"><a class="anchor" href="#publishing_maven:repositories"></a><a class="link" href="#publishing_maven:repositories">Repositories</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="#sub:terminology_repository">repositories</a> of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a>. To learn how to define and use repositories for publishing, see the section on <a href="#sec:basic_publishing">basic publishing</a>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example of defining a publishing repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 626. Declaring repositories to publish to</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="comment">// change to point to your repo, e.g. http://my.org/repo</span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repo</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            // change to point to your repo, e.g. http://my.org/repo
            url = uri(&quot;$buildDir/repo&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The two main things you will want to configure are the repository&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL (required)</p>
</li>
<li>
<p>Name (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define multiple repositories as long as they have unique names within the build script. You may also declare one (and only one) repository without a name. That repository will take on an implicit name of "Maven".</p>
</div>
<div class="paragraph">
<p>You can also configure any authentication details that are required to connect to the repository. See <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.artifacts.repositories.MavenArtifactRepository.html">MavenArtifactRepository</a> for more details.</p>
</div>
<div class="sect4">
<h5 id="publishing_maven:snapshot_and_release_repositories"><a class="anchor" href="#publishing_maven:snapshot_and_release_repositories"></a><a class="link" href="#publishing_maven:snapshot_and_release_repositories">Snapshot and release repositories</a></h5>
<div class="paragraph">
<p>It is a common practice to publish snapshots and releases to different Maven repositories. A simple way to accomplish this is to configure the repository URL based on the project version. The following sample uses one URL for versions that end with "SNAPSHOT" and a different URL for the rest:</p>
</div>
<div class="exampleblock">
<div class="title">Example 627. Configuring repository URL based on project version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="keyword">def</span> releasesRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/releases</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> snapshotsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/snapshots</span><span class="delimiter">&quot;</span></span>
            url = version.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">SNAPSHOT</span><span class="delimiter">'</span></span>) ? snapshotsRepoUrl : releasesRepoUrl
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            val releasesRepoUrl = &quot;$buildDir/repos/releases&quot;
            val snapshotsRepoUrl = &quot;$buildDir/repos/snapshots&quot;
            url = uri(if (version.toString().endsWith(&quot;SNAPSHOT&quot;)) snapshotsRepoUrl else releasesRepoUrl)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can use a <a href="#build_environment">project or system property</a> to decide which repository to publish to. The following example uses the release repository if the project property <code>release</code> is set, such as when a user runs <code>gradle -Prelease publish</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 628. Configuring repository URL based on project property</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            <span class="keyword">def</span> releasesRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/releases</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> snapshotsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/snapshots</span><span class="delimiter">&quot;</span></span>
            url = project.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">release</span><span class="delimiter">'</span></span>) ? releasesRepoUrl : snapshotsRepoUrl
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">publishing {
    repositories {
        maven {
            val releasesRepoUrl = &quot;$buildDir/repos/releases&quot;
            val snapshotsRepoUrl = &quot;$buildDir/repos/snapshots&quot;
            url = uri(if (project.hasProperty(&quot;release&quot;)) releasesRepoUrl else snapshotsRepoUrl)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:install"><a class="anchor" href="#publishing_maven:install"></a><a class="link" href="#publishing_maven:install">Publishing to Maven Local</a></h4>
<div class="paragraph">
<p>For integration with a local Maven installation, it is sometimes useful to publish the module into the Maven local repository (typically at <em>$USER_HOME/.m2/repository</em>), along with its POM file and other metadata. In Maven parlance, this is referred to as 'installing' the module.</p>
</div>
<div class="paragraph">
<p>The Maven Publish Plugin makes this easy to do by automatically creating a <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/publish/maven/tasks/PublishToMavenLocal.html">PublishToMavenLocal</a> task for each <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a> in the <code>publishing.publications</code> container. The task name follows the pattern of <code>publish<em>PubName</em>PublicationToMavenLocal</code>. Each of these tasks is wired into the <code>publishToMavenLocal</code> aggregate task. You do not need to have <code>mavenLocal()</code> in your <code>publishing.repositories</code> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:complete_example"><a class="anchor" href="#publishing_maven:complete_example"></a><a class="link" href="#publishing_maven:complete_example">Complete example</a></h4>
<div class="paragraph">
<p>The following example demonstrates how to sign and publish a Java library including sources, Javadoc, and a customized POM:</p>
</div>
<div class="exampleblock">
<div class="title">Example 629. Publishing a Java library</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>
    id <span class="string"><span class="delimiter">'</span><span class="content">signing</span><span class="delimiter">'</span></span>
}

group = <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            artifactId = <span class="string"><span class="delimiter">'</span><span class="content">my-library</span><span class="delimiter">'</span></span>
            from components.java
            versionMapping {
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-api</span><span class="delimiter">'</span></span>) {
                    fromResolutionOf(<span class="string"><span class="delimiter">'</span><span class="content">runtimeClasspath</span><span class="delimiter">'</span></span>)
                }
                usage(<span class="string"><span class="delimiter">'</span><span class="content">java-runtime</span><span class="delimiter">'</span></span>) {
                    fromResolutionResult()
                }
            }
            pom {
                name = <span class="string"><span class="delimiter">'</span><span class="content">My Library</span><span class="delimiter">'</span></span>
                description = <span class="string"><span class="delimiter">'</span><span class="content">A concise description of my library</span><span class="delimiter">'</span></span>
                url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.example.com/library</span><span class="delimiter">'</span></span>
                properties = [
                    <span class="key">myProp</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">prop.with.dots</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">anotherValue</span><span class="delimiter">&quot;</span></span>
                ]
                licenses {
                    license {
                        name = <span class="string"><span class="delimiter">'</span><span class="content">The Apache License, Version 2.0</span><span class="delimiter">'</span></span>
                        url = <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                    }
                }
                developers {
                    developer {
                        id = <span class="string"><span class="delimiter">'</span><span class="content">johnd</span><span class="delimiter">'</span></span>
                        name = <span class="string"><span class="delimiter">'</span><span class="content">John Doe</span><span class="delimiter">'</span></span>
                        email = <span class="string"><span class="delimiter">'</span><span class="content">john.doe@example.com</span><span class="delimiter">'</span></span>
                    }
                }
                scm {
                    connection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:git://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    developerConnection = <span class="string"><span class="delimiter">'</span><span class="content">scm:git:ssh://example.com/my-library.git</span><span class="delimiter">'</span></span>
                    url = <span class="string"><span class="delimiter">'</span><span class="content">http://example.com/my-library/</span><span class="delimiter">'</span></span>
                }
            }
        }
    }
    repositories {
        maven {
            <span class="comment">// change URLs to point to your repos, e.g. http://my.org/repo</span>
            <span class="keyword">def</span> releasesRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/releases</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> snapshotsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/repos/snapshots</span><span class="delimiter">&quot;</span></span>
            url = version.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">SNAPSHOT</span><span class="delimiter">'</span></span>) ? snapshotsRepoUrl : releasesRepoUrl
        }
    }
}

signing {
    sign publishing.publications.mavenJava
}


javadoc {
    <span class="keyword">if</span>(JavaVersion.current().isJava9Compatible()) {
        options.addBooleanOption(<span class="string"><span class="delimiter">'</span><span class="content">html5</span><span class="delimiter">'</span></span>, <span class="predefined-constant">true</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    `java-library`
    `maven-publish`
    signing
}

group = &quot;com.example&quot;
version = &quot;1.0&quot;

java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    publications {
        create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
            artifactId = &quot;my-library&quot;
            from(components[&quot;java&quot;])
            versionMapping {
                usage(&quot;java-api&quot;) {
                    fromResolutionOf(&quot;runtimeClasspath&quot;)
                }
                usage(&quot;java-runtime&quot;) {
                    fromResolutionResult()
                }
            }
            pom {
                name.set(&quot;My Library&quot;)
                description.set(&quot;A concise description of my library&quot;)
                url.set(&quot;http://www.example.com/library&quot;)
                properties.set(mapOf(
                    &quot;myProp&quot; to &quot;value&quot;,
                    &quot;prop.with.dots&quot; to &quot;anotherValue&quot;
                ))
                licenses {
                    license {
                        name.set(&quot;The Apache License, Version 2.0&quot;)
                        url.set(&quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;)
                    }
                }
                developers {
                    developer {
                        id.set(&quot;johnd&quot;)
                        name.set(&quot;John Doe&quot;)
                        email.set(&quot;john.doe@example.com&quot;)
                    }
                }
                scm {
                    connection.set(&quot;scm:git:git://example.com/my-library.git&quot;)
                    developerConnection.set(&quot;scm:git:ssh://example.com/my-library.git&quot;)
                    url.set(&quot;http://example.com/my-library/&quot;)
                }
            }
        }
    }
    repositories {
        maven {
            // change URLs to point to your repos, e.g. http://my.org/repo
            val releasesRepoUrl = uri(&quot;$buildDir/repos/releases&quot;)
            val snapshotsRepoUrl = uri(&quot;$buildDir/repos/snapshots&quot;)
            url = if (version.toString().endsWith(&quot;SNAPSHOT&quot;)) snapshotsRepoUrl else releasesRepoUrl
        }
    }
}

signing {
    sign(publishing.publications[&quot;mavenJava&quot;])
}

tasks.javadoc {
    if (JavaVersion.current().isJava9Compatible) {
        (options as StandardJavadocDocletOptions).addBooleanOption(&quot;html5&quot;, true)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is that the following artifacts will be published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The POM: <code>my-library-1.0.pom</code></p>
</li>
<li>
<p>The primary JAR artifact for the Java component: <code>my-library-1.0.jar</code></p>
</li>
<li>
<p>The sources JAR artifact that has been explicitly configured: <code>my-library-1.0-sources.jar</code></p>
</li>
<li>
<p>The Javadoc JAR artifact that has been explicitly configured: <code>my-library-1.0-javadoc.jar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#signing_plugin">Signing Plugin</a> is used to generate a signature file for each artifact. In addition, checksum files will be generated for all artifacts and signature files.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_maven:deferred_configuration"><a class="anchor" href="#publishing_maven:deferred_configuration"></a><a class="link" href="#publishing_maven:deferred_configuration">Removal of deferred configuration behavior</a></h4>
<div class="paragraph">
<p>Prior to Gradle 5.0, the <code>publishing {}</code> block was (by default) implicitly treated as if all the logic inside it was executed after the project is evaluated.
This behavior caused quite a bit of confusion and was deprecated in Gradle 4.8, because it was the only block that behaved that way.</p>
</div>
<div class="paragraph">
<p>You may have some logic inside your publishing block or in a plugin that is depending on the deferred configuration behavior.
For instance, the following logic assumes that the subprojects will be evaluated when the artifactId is set:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
                artifactId = jar.archiveBaseName
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                artifactId = tasks.jar.get().archiveBaseName.get()
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This kind of logic must now be wrapped in an <code>afterEvaluate {}</code> block.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
                afterEvaluate {
                    artifactId = jar.archiveBaseName
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">subprojects {
    publishing {
        publications {
            create&lt;MavenPublication&gt;(&quot;mavenJava&quot;) {
                from(components[&quot;java&quot;])
                afterEvaluate {
                    artifactId = tasks.jar.get().archiveBaseName.get()
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maven_plugin"><a class="anchor" href="#maven_plugin"></a><a class="link" href="#maven_plugin">Maven Plugin</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>This chapter describes deploying artifacts to Maven repositories using the <em>original</em>, <em>deprecated</em> publishing mechanism available in Gradle 1.0: in Gradle 1.3 a new mechanism for publishing was introduced. This new mechanism introduces some new concepts and features that make Gradle publishing even more powerful and is now the preferred option for publishing artifacts.</p>
</div>
<div class="paragraph">
<p>You can read about the new publishing plugins in <a href="#publishing_ivy">Publishing Ivy</a> and <a href="#publishing_maven">Publishing Maven</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Maven plugin adds support for deploying artifacts to Maven repositories.</p>
</div>
<div class="sect3">
<h4 id="sec:maven_usage"><a class="anchor" href="#sec:maven_usage"></a><a class="link" href="#sec:maven_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Maven plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 630. Using the Maven plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    maven
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:maven_tasks"><a class="anchor" href="#sec:maven_tasks"></a><a class="link" href="#sec:maven_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Maven plugin defines the following tasks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>install</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.Upload.html">Upload</a></dt>
<dd>
<p><em>Depends on</em>: All tasks that build the associated archives.</p>
<div class="paragraph">
<p>Installs the associated artifacts to the local Maven cache, including Maven metadata generation. By default the install task is associated with the <code>archives</code> configuration. This configuration has by default only the default jar as an element. To learn more about installing to the local repository, see <a href="#sub:installing_to_the_local_repository">Installing to the local repository</a></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:maven_dependency_management"><a class="anchor" href="#sec:maven_dependency_management"></a><a class="link" href="#sec:maven_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The Maven plugin does not define any dependency configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:maven_convention_properties"><a class="anchor" href="#sec:maven_convention_properties"></a><a class="link" href="#sec:maven_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Maven plugin defines the following convention properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>mavenPomDir</code>  <code>File</code></dt>
<dd>
<p>The directory where the generated POMs are written to. <em>Default value</em>: <code><em>${project.buildDir}</em>/poms</code></p>
</dd>
<dt class="hdlist1"><code>conf2ScopeMappings</code>  <code><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/Conf2ScopeMappingContainer.html">Conf2ScopeMappingContainer</a></code></dt>
<dd>
<p>Instructions for mapping Gradle configurations to Maven scopes. See <a href="#sub:dependency_mapping">Dependency mapping</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.MavenPluginConvention.html">MavenPluginConvention</a> convention object.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:maven_convention_methods"><a class="anchor" href="#sec:maven_convention_methods"></a><a class="link" href="#sec:maven_convention_methods">Convention methods</a></h4>
<div class="paragraph">
<p>The maven plugin provides a factory method for creating a POM. This is useful if you need a POM without the context of uploading to a Maven repo.</p>
</div>
<div class="exampleblock">
<div class="title">Example 631. Creating a standalone pom.</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task writeNewPom {
    doLast {
        pom {
            project {
                inceptionYear <span class="string"><span class="delimiter">'</span><span class="content">2008</span><span class="delimiter">'</span></span>
                licenses {
                    license {
                        name <span class="string"><span class="delimiter">'</span><span class="content">The Apache Software License, Version 2.0</span><span class="delimiter">'</span></span>
                        url <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                        distribution <span class="string"><span class="delimiter">'</span><span class="content">repo</span><span class="delimiter">'</span></span>
                    }
                }
            }
        }.writeTo(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/newpom.xml</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">task(&quot;writeNewPom&quot;) {
    doLast {
        maven.pom {
            withGroovyBuilder {
                &quot;project&quot; {
                    setProperty(&quot;inceptionYear&quot;, &quot;2008&quot;)
                    &quot;licenses&quot; {
                        &quot;license&quot; {
                            setProperty(&quot;name&quot;, &quot;The Apache Software License, Version 2.0&quot;)
                            setProperty(&quot;url&quot;, &quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;)
                            setProperty(&quot;distribution&quot;, &quot;repo&quot;)
                        }
                    }
                }
            }
        }.writeTo(&quot;$buildDir/newpom.xml&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Amongst other things, Gradle supports the same builder syntax as polyglot Maven. To learn more about the Gradle Maven POM object, see <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/MavenPom.html">MavenPom</a>. See also: <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.MavenPluginConvention.html">MavenPluginConvention</a></p>
</div>
</div>
<div class="sect3">
<h4 id="uploading_to_maven_repositories"><a class="anchor" href="#uploading_to_maven_repositories"></a><a class="link" href="#uploading_to_maven_repositories">Interacting with Maven repositories</a></h4>
<div class="sect4">
<h5 id="sec:maven_upload_intro"><a class="anchor" href="#sec:maven_upload_intro"></a><a class="link" href="#sec:maven_upload_intro">Introduction</a></h5>
<div class="paragraph">
<p>With Gradle you can deploy to remote Maven repositories or install to your local Maven repository. This includes all Maven metadata manipulation and works also for Maven snapshots. In fact, Gradle&#8217;s deployment is 100 percent Maven compatible as we use the native Maven Ant tasks under the hood.</p>
</div>
<div class="paragraph">
<p>Deploying to a Maven repository is only half the fun if you don&#8217;t have a POM. Fortunately Gradle can generate this POM for you using the dependency information it has.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:deploying_to_a_maven_repository"><a class="anchor" href="#sec:deploying_to_a_maven_repository"></a><a class="link" href="#sec:deploying_to_a_maven_repository">Deploying to a Maven repository</a></h5>
<div class="paragraph">
<p>Let&#8217;s assume your project produces just the default jar file. Now you want to deploy this jar file to a remote Maven repository.</p>
</div>
<div class="exampleblock">
<div class="title">Example 632. Upload of file to remote Maven repository</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>
}

uploadArchives {
    repositories {
        mavenDeployer {
            repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">file://localhost/tmp/myRepo/</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    maven
}

tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            &quot;repository&quot;(&quot;url&quot; to &quot;file://localhost/tmp/myRepo/&quot;)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That is all. Calling the <code>uploadArchives</code> task will generate the POM and deploys the artifact and the POM to the specified repository.</p>
</div>
<div class="paragraph">
<p>There is more work to do if you need support for protocols other than <code>file</code>. In this case the native Maven code we delegate to needs additional libraries. Which libraries are needed depends on what protocol you plan to use. The available protocols and the corresponding libraries are listed in <a href="#wagonLibs">Protocol JARs for Maven deployment</a> (those libraries have transitive dependencies which have transitive dependencies).<sup class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnotedef_21" title="View footnote.">21</a>]</sup> For example, to use the ssh protocol you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 633. Upload of file via SSH</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
    deployerJars
}

repositories {
    mavenCentral()
}

dependencies {
    deployerJars <span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.maven.wagon:wagon-ssh:2.2</span><span class="delimiter">&quot;</span></span>
}

uploadArchives {
    repositories.mavenDeployer {
        configuration = configurations.deployerJars
        repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">scp://repos.mycompany.com/releases</span><span class="delimiter">&quot;</span></span>) {
            authentication(<span class="key">userName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">me</span><span class="delimiter">&quot;</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myPassword</span><span class="delimiter">&quot;</span></span>)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val deployerJars by configurations.creating

repositories {
    mavenCentral()
}

dependencies {
    deployerJars(&quot;org.apache.maven.wagon:wagon-ssh:2.2&quot;)
}

tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            setProperty(&quot;configuration&quot;, deployerJars)
            &quot;repository&quot;(&quot;url&quot; to &quot;scp://repos.mycompany.com/releases&quot;) {
                &quot;authentication&quot;(&quot;userName&quot; to &quot;me&quot;, &quot;password&quot; to &quot;myPassword&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are many configuration options for the Maven deployer. The configuration is done via a Groovy builder. All the elements of this tree are Java beans. To configure the simple attributes you pass a map to the bean elements. To add bean elements to its parent, you use a closure. In the example above <em>repository</em> and <em>authentication</em> are such bean elements. <a href="#deployerConfig">Configuration elements of Maven deployer</a> lists the available bean elements and a link to the Javadoc of the corresponding class. In the Javadoc you can see the possible attributes you can set for a particular element.</p>
</div>
<div class="paragraph">
<p>In Maven you can define repositories and optionally snapshot repositories. If no snapshot repository is defined, releases and snapshots are both deployed to the <code>repository</code> element. Otherwise snapshots are deployed to the <code>snapshotRepository</code> element.</p>
</div>
<table id="wagonLibs" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 36. Protocol jars for Maven deployment</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Library</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.maven.wagon:wagon-http:2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.maven.wagon:wagon-ssh:2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh-external</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.maven.wagon:wagon-ssh-external:2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ftp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.maven.wagon:wagon-ftp:2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">webdav</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.maven.wagon:wagon-webdav:1.0-beta-2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<table id="deployerConfig" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 37. Configuration elements of the MavenDeployer</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Javadoc</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/MavenDeployer.html">MavenDeployer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/RemoteRepository.html">org.apache.maven.artifact.ant.RemoteRepository</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/Authentication.html">org.apache.maven.artifact.ant.Authentication</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">releases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/RepositoryPolicy.html">org.apache.maven.artifact.ant.RepositoryPolicy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshots</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/RepositoryPolicy.html">org.apache.maven.artifact.ant.RepositoryPolicy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/Proxy.html">org.apache.maven.artifact.ant.Proxy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshotRepository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.docjar.com/docs/api/org/apache/maven/artifact/ant/RemoteRepository.html">org.apache.maven.artifact.ant.RemoteRepository</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sub:installing_to_the_local_repository"><a class="anchor" href="#sub:installing_to_the_local_repository"></a><a class="link" href="#sub:installing_to_the_local_repository">Installing to the local repository</a></h5>
<div class="paragraph">
<p>The Maven plugin adds an <code>install</code> task to your project. This task depends on all the archives task of the <code>archives</code> configuration. It installs those archives to your local Maven repository. If the default location for the local repository is redefined in a Maven <code>settings.xml</code>, this is considered by this task.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:maven_pom_generation"><a class="anchor" href="#sec:maven_pom_generation"></a><a class="link" href="#sec:maven_pom_generation">Maven POM generation</a></h5>
<div class="paragraph">
<p>When deploying an artifact to a Maven repository, Gradle automatically generates a POM for it. The <code>groupId</code>, <code>artifactId</code>, <code>version</code> and <code>packaging</code> elements used for the POM default to the values shown in the table below. The <code>dependency</code> elements are created from the project&#8217;s dependency declarations.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 38. Default Values for Maven POM generation</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Maven Element</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">project.group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uploadTask.repositories.mavenDeployer.pom.artifactId (if set) or archiveTask.archiveBaseName.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">project.version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archiveTask.archiveExtension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here, <code>uploadTask</code> and <code>archiveTask</code> refer to the tasks used for uploading and generating the archive, respectively (for example <code>uploadArchives</code> and <code>jar</code>).
<code>archiveTask.archiveBaseName</code> defaults to <code>project.archivesBaseName</code> which in turn defaults to <code>project.name</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When you set the <code>archiveTask.archiveBaseName</code> property to a value other than the default, you&#8217;ll also have to set <code>uploadTask.repositories.mavenDeployer.pom.artifactId</code> to the same value.
Otherwise, the project at hand may be referenced with the wrong artifact ID from generated POMs for other projects in the same build.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generated POMs can be found in <code>&lt;buildDir&gt;/poms</code>. They can be further customized via the <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/MavenPom.html">MavenPom</a> API. For example, you might want the artifact deployed to the Maven repository to have a different version or name than the artifact generated by Gradle. To customize these you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 634. Customization of pom</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">uploadArchives {
    repositories {
        mavenDeployer {
            repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">file://localhost/tmp/myRepo/</span><span class="delimiter">&quot;</span></span>)
            pom.version = <span class="string"><span class="delimiter">'</span><span class="content">1.0Maven</span><span class="delimiter">'</span></span>
            pom.artifactId = <span class="string"><span class="delimiter">'</span><span class="content">myMavenName</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            &quot;repository&quot;(&quot;url&quot; to &quot;file://localhost/tmp/myRepo/&quot;)
            &quot;pom&quot; {
                setProperty(&quot;version&quot;, &quot;1.0Maven&quot;)
                setProperty(&quot;artifactId&quot;, &quot;myMavenName&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To add additional content to the POM, the <code>pom.project</code> builder can be used. With this builder, any element listed in the <a href="http://maven.apache.org/pom.html">Maven POM reference</a> can be added.</p>
</div>
<div class="exampleblock">
<div class="title">Example 635. Builder style customization of pom</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">uploadArchives {
    repositories {
        mavenDeployer {
            repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">file://localhost/tmp/myRepo/</span><span class="delimiter">&quot;</span></span>)
            pom.project {
                licenses {
                    license {
                        name <span class="string"><span class="delimiter">'</span><span class="content">The Apache Software License, Version 2.0</span><span class="delimiter">'</span></span>
                        url <span class="string"><span class="delimiter">'</span><span class="content">http://www.apache.org/licenses/LICENSE-2.0.txt</span><span class="delimiter">'</span></span>
                        distribution <span class="string"><span class="delimiter">'</span><span class="content">repo</span><span class="delimiter">'</span></span>
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            &quot;repository&quot;(&quot;url&quot; to &quot;file://localhost/tmp/myRepo/&quot;)
            &quot;pom&quot; {
                &quot;project&quot; {
                    &quot;licenses&quot; {
                        &quot;license&quot; {
                            setProperty(&quot;name&quot;, &quot;The Apache Software License, Version 2.0&quot;)
                            setProperty(&quot;url&quot;, &quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot;)
                            setProperty(&quot;distribution&quot;, &quot;repo&quot;)
                        }
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note: <code>groupId</code>, <code>artifactId</code>, <code>version</code>, and <code>packaging</code> should always be set directly on the <code>pom</code> object.</p>
</div>
<div class="exampleblock">
<div class="title">Example 636. Modifying auto-generated content</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> installer = install.repositories.mavenInstaller
<span class="keyword">def</span> deployer = uploadArchives.repositories.mavenDeployer

[installer, deployer]*.pom*.whenConfigured {pom -&gt;
    pom.dependencies.find {dep -&gt; dep.groupId == <span class="string"><span class="delimiter">'</span><span class="content">group3</span><span class="delimiter">'</span></span> &amp;&amp; dep.artifactId == <span class="string"><span class="delimiter">'</span><span class="content">runtime</span><span class="delimiter">'</span></span> }.optional = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val uploadArchives by tasks.getting(Upload::class)
val installer = tasks.install.get().repositories.withGroovyBuilder { getProperty(&quot;mavenInstaller&quot;) as MavenResolver }
val deployer = uploadArchives.repositories.withGroovyBuilder { getProperty(&quot;mavenDeployer&quot;) as MavenResolver }

listOf(installer, deployer).forEach {
    it.pom.whenConfigured {
        dependencies.firstOrNull { dep -&gt;
            dep!!.withGroovyBuilder {
                getProperty(&quot;groupId&quot;) == &quot;group3&quot; &amp;&amp; getProperty(&quot;artifactId&quot;) == &quot;runtime&quot;
            }
        }?.withGroovyBuilder {
            setProperty(&quot;optional&quot;, true)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have more than one artifact to publish, things work a little bit differently. See <a href="#sub:multiple_artifacts_per_project">Multiple artifacts per project</a>.</p>
</div>
<div class="paragraph">
<p>To customize the settings for the Maven installer (see <a href="#sub:installing_to_the_local_repository">Installing to the local repository</a>), you can do:</p>
</div>
<div class="exampleblock">
<div class="title">Example 637. Customization of Maven installer</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">install {
    repositories.mavenInstaller {
        pom.version = <span class="string"><span class="delimiter">'</span><span class="content">1.0Maven</span><span class="delimiter">'</span></span>
        pom.artifactId = <span class="string"><span class="delimiter">'</span><span class="content">myName</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.install {
    repositories.withGroovyBuilder {
        &quot;mavenInstaller&quot; {
            &quot;pom&quot; {
                setProperty(&quot;version&quot;, &quot;1.0Maven&quot;)
                setProperty(&quot;artifactId&quot;, &quot;myName&quot;)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sub:multiple_artifacts_per_project"><a class="anchor" href="#sub:multiple_artifacts_per_project"></a><a class="link" href="#sub:multiple_artifacts_per_project">Multiple artifacts per project</a></h6>
<div class="paragraph">
<p>Maven can only deal with one artifact per project. This is reflected in the structure of the Maven POM. We think there are many situations where it makes sense to have more than one artifact per project. In such a case you need to generate multiple POMs. In such a case you have to explicitly declare each artifact you want to publish to a Maven repository. The <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/MavenDeployer.html">MavenDeployer</a> and the MavenInstaller both provide an API for this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 638. Generation of multiple poms</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">uploadArchives {
    repositories {
        mavenDeployer {
            repository(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">file://localhost/tmp/myRepo/</span><span class="delimiter">&quot;</span></span>)
            addFilter(<span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>) {artifact, file -&gt;
                artifact.name == <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>
            }
            addFilter(<span class="string"><span class="delimiter">'</span><span class="content">service</span><span class="delimiter">'</span></span>) {artifact, file -&gt;
                artifact.name == <span class="string"><span class="delimiter">'</span><span class="content">service</span><span class="delimiter">'</span></span>
            }
            pom(<span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>).version = <span class="string"><span class="delimiter">'</span><span class="content">mySpecialMavenVersion</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories.withGroovyBuilder {
        &quot;mavenDeployer&quot; {
            &quot;repository&quot;(&quot;url&quot; to &quot;file://localhost/tmp/myRepo/&quot;)
            &quot;addFilter&quot;(&quot;api&quot;) {
                getProperty(&quot;artifact&quot;).withGroovyBuilder { setProperty(&quot;name&quot;, &quot;api&quot;) }
            }
            &quot;addFilter&quot;(&quot;service&quot;) {
                getProperty(&quot;artifact&quot;).withGroovyBuilder { setProperty(&quot;name&quot;, &quot;service&quot;) }
            }
            &quot;pom&quot;(&quot;api&quot;)?.withGroovyBuilder { setProperty(&quot;version&quot;, &quot;mySpecialMavenVersion&quot;) }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You need to declare a filter for each artifact you want to publish. This filter defines a boolean expression for which Gradle artifact it accepts. Each filter has a POM associated with it which you can configure. To learn more about this have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/PomFilterContainer.html">PomFilterContainer</a> and its associated classes.</p>
</div>
</div>
<div class="sect5">
<h6 id="sub:dependency_mapping"><a class="anchor" href="#sub:dependency_mapping"></a><a class="link" href="#sub:dependency_mapping">Dependency mapping</a></h6>
<div class="paragraph">
<p>The Maven plugin configures the default mapping between the Gradle configurations added by the Java and War plugin and the Maven scopes. Most of the time you don&#8217;t need to touch this and you can safely skip this section. The mapping works like the following. You can map a configuration to one and only one scope. Different configurations can be mapped to one or different scopes. You can also assign a priority to a particular configuration-to-scope mapping. Have a look at <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/artifacts/maven/Conf2ScopeMappingContainer.html">Conf2ScopeMappingContainer</a> to learn more. To access the mapping configuration you can say:</p>
</div>
<div class="exampleblock">
<div class="title">Example 639. Accessing a mapping configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task mappings {
    doLast {
        println conf2ScopeMappings.mappings
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register(&quot;mappings&quot;) {
    doLast {
        println(maven.conf2ScopeMappings.mappings)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Gradle exclude rules are converted to Maven excludes if possible. Such a conversion is possible if in the Gradle exclude rule the group as well as the module name is specified (as Maven needs both in contrast to Ivy). Per-configuration excludes are also included in the Maven POM, if they are convertible.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmd_plugin"><a class="anchor" href="#pmd_plugin"></a><a class="link" href="#pmd_plugin">The PMD Plugin</a></h3>
<div class="paragraph">
<p>The PMD plugin performs quality checks on your project&#8217;s Java source files using <a href="https://pmd.github.io/">PMD</a> and generates reports from these checks.</p>
</div>
<div class="sect3">
<h4 id="sec:pmd_usage"><a class="anchor" href="#sec:pmd_usage"></a><a class="link" href="#sec:pmd_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the PMD plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 640. Using the PMD plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">pmd</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    pmd
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin adds a number of tasks to the project that perform the quality checks. You can execute the checks by running <code>gradle check</code>.</p>
</div>
<div class="paragraph">
<p>Note that PMD will run with the same Java version used to run Gradle.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:pmd_tasks"><a class="anchor" href="#sec:pmd_tasks"></a><a class="link" href="#sec:pmd_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The PMD plugin adds the following tasks to the project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pmdMain</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Pmd.html">Pmd</a></dt>
<dd>
<div class="paragraph">
<p>Runs PMD against the production Java source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>pmdTest</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Pmd.html">Pmd</a></dt>
<dd>
<div class="paragraph">
<p>Runs PMD against the test Java source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>pmd<em>SourceSet</em></code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.Pmd.html">Pmd</a></dt>
<dd>
<div class="paragraph">
<p>Runs PMD against the given source set&#8217;s Java source files.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The PMD plugin adds the following dependencies to tasks defined by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 39. PMD plugin - additional task dependencies</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All PMD tasks, including <code>pmdMain</code> and <code>pmdTest</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:pmd_dependency_management"><a class="anchor" href="#sec:pmd_dependency_management"></a><a class="link" href="#sec:pmd_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The PMD plugin adds the following dependency configurations:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 40. PMD plugin - dependency configurations</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The PMD libraries to use</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:pmd_configuration"><a class="anchor" href="#sec:pmd_configuration"></a><a class="link" href="#sec:pmd_configuration">Configuration</a></h4>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">pmd {
    consoleOutput = <span class="predefined-constant">true</span>
    toolVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">6.21.0</span><span class="delimiter">&quot;</span></span>
    rulePriority = <span class="integer">5</span>
    ruleSets = [<span class="string"><span class="delimiter">&quot;</span><span class="content">category/java/errorprone.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">category/java/bestpractices.xml</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">pmd {
    isConsoleOutput = true
    toolVersion = &quot;6.21.0&quot;
    rulePriority = 5
    ruleSets = listOf(&quot;category/java/errorprone.xml&quot;, &quot;category/java/bestpractices.xml&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.quality.PmdExtension.html">PmdExtension</a> class in the API documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scala_plugin"><a class="anchor" href="#scala_plugin"></a><a class="link" href="#scala_plugin">The Scala Plugin</a></h3>
<div class="paragraph">
<p>The Scala plugin extends the <a href="#">Java plugin</a> to add support for <a href="https://www.scala-lang.org/">Scala</a> projects.
It can deal with Scala code, mixed Scala and Java code, and even pure Java code (although we don&#8217;t necessarily recommend to use it for the latter).
The plugin supports <em>joint compilation</em>, which allows you to freely mix and match Scala and Java code, with dependencies in both directions.
For example, a Scala class can extend a Java class that in turn extends a Scala class.
This makes it possible to use the best language for the job, and to rewrite any class in the other language if needed.</p>
</div>
<div class="paragraph">
<p>Note that if you want to benefit from the <a href="#sec:java_library_separation">API / implementation separation</a>, you can also apply the <code>java-library</code> plugin to your Scala project.</p>
</div>
<div class="sect3">
<h4 id="sec:scala_usage"><a class="anchor" href="#sec:scala_usage"></a><a class="link" href="#sec:scala_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Scala plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 641. Using the Scala plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">scala</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    scala
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_tasks"><a class="anchor" href="#sec:scala_tasks"></a><a class="link" href="#sec:scala_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The Scala plugin adds the following tasks to the project.
Information about altering the dependencies to Java compile tasks are found <a href="#sec:building_jvm_lang">here</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>compileScala</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileJava</code></p>
<div class="paragraph">
<p>Compiles production Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compileTestScala</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compileTestJava</code></p>
<div class="paragraph">
<p>Compiles test Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>compile<em>SourceSet</em>Scala</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaCompile.html">ScalaCompile</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile<em>SourceSet</em>Java</code></p>
<div class="paragraph">
<p>Compiles the given source set&#8217;s Scala source files.</p>
</div>
</dd>
<dt class="hdlist1"><code>scaladoc</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.scala.ScalaDoc.html">ScalaDoc</a></dt>
<dd>
<div class="paragraph">
<p>Generates API documentation for the production Scala source files.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Scala plugin adds the following dependencies to tasks added by the Java plugin.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Scala plugin - additional task dependencies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task name</th>
<th class="tableblock halign-left valign-top">Depends on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>classes</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileScala</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>testClasses</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compileTestScala</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><em>sourceSet</em>Classes</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>compile<em>SourceSet</em>Scala</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="img/scalaPluginTasks.png" alt="scalaPluginTasks">
</div>
<div class="title">Figure 37. Scala plugin - tasks</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_project_layout"><a class="anchor" href="#sec:scala_project_layout"></a><a class="link" href="#sec:scala_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>The Scala plugin assumes the project layout shown below. All the Scala source directories can contain Scala <em>and</em> Java code. The Java source directories may only contain Java source code. None of these directories need to exist or have anything in them; the Scala plugin will simply compile whatever it finds.</p>
</div>
<div id="scalalayout" class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/java</code></dt>
<dd>
<p>Production Java source.</p>
</dd>
<dt class="hdlist1"><code>src/main/resources</code></dt>
<dd>
<p>Production resources, such as XML and properties files.</p>
</dd>
<dt class="hdlist1"><code>src/main/scala</code></dt>
<dd>
<p>Production Scala source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/test/java</code></dt>
<dd>
<p>Test Java source.</p>
</dd>
<dt class="hdlist1"><code>src/test/resources</code></dt>
<dd>
<p>Test resources.</p>
</dd>
<dt class="hdlist1"><code>src/test/scala</code></dt>
<dd>
<p>Test Scala source. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/java</code></dt>
<dd>
<p>Java source for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/resources</code></dt>
<dd>
<p>Resources for the source set named <em>sourceSet</em>.</p>
</dd>
<dt class="hdlist1"><code>src/<em>sourceSet</em>/scala</code></dt>
<dd>
<p>Scala source files for the given source set. May also contain Java source files for joint compilation.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec:changing_scala_project_layout"><a class="anchor" href="#sec:changing_scala_project_layout"></a><a class="link" href="#sec:changing_scala_project_layout">Changing the project layout</a></h5>
<div class="paragraph">
<p>Just like the Java plugin, the Scala plugin allows you to configure custom locations for Scala production and test source files.</p>
</div>
<div class="exampleblock">
<div class="title">Example 642. Custom Scala source layout</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    main {
        scala {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">src/scala</span><span class="delimiter">'</span></span>]
        }
    }
    test {
        scala {
            srcDirs = [<span class="string"><span class="delimiter">'</span><span class="content">test/scala</span><span class="delimiter">'</span></span>]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sourceSets {
    main {
        withConvention(ScalaSourceSet::class) {
            scala {
                setSrcDirs(listOf(&quot;src/scala&quot;))
            }
        }
    }
    test {
        withConvention(ScalaSourceSet::class) {
            scala {
                setSrcDirs(listOf(&quot;test/scala&quot;))
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_dependency_management"><a class="anchor" href="#sec:scala_dependency_management"></a><a class="link" href="#sec:scala_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>Scala projects need to declare a <code>scala-library</code> dependency. This dependency will then be used on compile and runtime class paths. It will also be used to get hold of the Scala compiler and Scaladoc tool, respectively.<sup class="footnote">[<a id="_footnoteref_22" class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup></p>
</div>
<div class="paragraph">
<p>If Scala is used for production code, the <code>scala-library</code> dependency should be added to the <code>compile</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 643. Declaring a Scala dependency for production code</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.scala-lang:scala-library:2.11.12</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.scalatest:scalatest_2.11:3.0.0</span><span class="delimiter">'</span></span>
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation(&quot;org.scala-lang:scala-library:2.11.12&quot;)
    testImplementation(&quot;org.scalatest:scalatest_2.11:3.0.0&quot;)
    testImplementation(&quot;junit:junit:4.12&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Scala is only used for test code, the <code>scala-library</code> dependency should be added to the <code>testCompile</code> configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 644. Declaring a Scala dependency for test code</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">org.scala-lang:scala-library:2.11.1</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    testImplementation(&quot;org.scala-lang:scala-library:2.11.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:configure_scala_classpath"><a class="anchor" href="#sec:configure_scala_classpath"></a><a class="link" href="#sec:configure_scala_classpath">Automatic configuration of scalaClasspath</a></h4>
<div class="paragraph">
<p>The <code>ScalaCompile</code> and <code>ScalaDoc</code> tasks consume Scala code in two ways: on their <code>classpath</code>, and on their <code>scalaClasspath</code>. The former is used to locate classes referenced by the source code, and will typically contain <code>scala-library</code> along with other libraries. The latter is used to load and execute the Scala compiler and Scaladoc tool, respectively, and should only contain the <code>scala-compiler</code> library and its dependencies.</p>
</div>
<div class="paragraph">
<p>Unless a task&#8217;s <code>scalaClasspath</code> is configured explicitly, the Scala (base) plugin will try to infer it from the task&#8217;s <code>classpath</code>. This is done as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>scala-library</code> jar is found on <code>classpath</code>, and the project has at least one repository declared, a corresponding <code>scala-compiler</code> repository dependency will be added to <code>scalaClasspath</code>.</p>
</li>
<li>
<p>Otherwise, execution of the task will fail with a message saying that <code>scalaClasspath</code> could not be inferred.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sec:configure_zinc_compiler"><a class="anchor" href="#sec:configure_zinc_compiler"></a><a class="link" href="#sec:configure_zinc_compiler">Configuring the Zinc compiler</a></h4>
<div class="paragraph">
<p>The Scala plugin uses a configuration named <code>zinc</code> to resolve the <a href="https://github.com/typesafehub/zinc">Zinc compiler</a> and its dependencies.
Gradle will provide a default version of Zinc, but if you need to use a particular Zinc version, you can change it.
Gradle supports version 1.2.0 of Zinc and above.</p>
</div>
<div class="exampleblock">
<div class="title">Example 645. Declaring a version of the Zinc compiler to use</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">scala {
    zincVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2.1</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">scala {
    zincVersion.set(&quot;1.2.1&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Zinc compiler itself needs a compatible version of <code>scala-library</code> that may be different from the version required by your application.
Gradle takes care of specifying a compatible version of <code>scala-library</code> for you.
<sup class="footnote">[<a id="_footnoteref_23" class="footnote" href="#_footnotedef_23" title="View footnote.">23</a>]</sup></p>
</div>
<div class="paragraph">
<p>You can diagnose problems with the version of the Zinc compiler selected by running <a href="#">dependencyInsight</a> for the <code>zinc</code> configuration.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 42. Zinc compatibility table</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle version</th>
<th class="tableblock halign-left valign-top">Supported Zinc versions</th>
<th class="tableblock halign-left valign-top">Zinc coordinates</th>
<th class="tableblock halign-left valign-top">Required Scala version</th>
<th class="tableblock halign-left valign-top">Supported Scala compilation version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.0 and newer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/sbt/zinc">SBT Zinc</a>. Versions 1.2.0 and above.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.scala-sbt:zinc_2.12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.12.x</code> is required for <em>running</em> Zinc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.10.x</code> through <code>2.13.x</code> can be compiled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.x through 5.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/typesafehub/zinc"><strong>Deprecated</strong> Typesafe Zinc compiler.</a> Versions 0.3.0 and above, except for 0.3.2 through 0.3.5.2.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.typesafe.zinc:zinc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.10.x</code> is required for <em>running</em> Zinc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala <code>2.9.x</code> through <code>2.12.x</code> can be compiled.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:scala_compiler_plugins"><a class="anchor" href="#sec:scala_compiler_plugins"></a><a class="link" href="#sec:scala_compiler_plugins">Adding plugins to the Scala compiler</a></h4>
<div class="paragraph">
<p>The Scala plugin adds a configuration named <code>scalaCompilerPlugins</code> which is used to declare and resolve optional compiler plugins.</p>
</div>
<div class="exampleblock">
<div class="title">Example 646. Adding a dependency on a Scala compiler plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">&quot;</span><span class="content">org.scala-lang:scala-library:2.13.1</span><span class="delimiter">&quot;</span></span>
    scalaCompilerPlugins <span class="string"><span class="delimiter">&quot;</span><span class="content">org.typelevel:kind-projector_2.13.1:0.11.0</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">dependencies {
    implementation(&quot;org.scala-lang:scala-library:2.13.1&quot;)
    scalaCompilerPlugins(&quot;org.typelevel:kind-projector_2.13.1:0.11.0&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_convention_properties"><a class="anchor" href="#sec:scala_convention_properties"></a><a class="link" href="#sec:scala_convention_properties">Convention properties</a></h4>
<div class="paragraph">
<p>The Scala plugin does not add any convention properties to the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_source_set_properties"><a class="anchor" href="#sec:scala_source_set_properties"></a><a class="link" href="#sec:scala_source_set_properties">Source set properties</a></h4>
<div class="paragraph">
<p>The Scala plugin adds the following convention properties to each source set in the project. You can use these properties in your build script as though they were properties of the source set object.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>scala</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.file.SourceDirectorySet.html">SourceDirectorySet</a> (read-only)</dt>
<dd>
<p>The Scala source files of this source set. Contains all <code>.scala</code> and <code>.java</code> files found in the Scala source directories, and excludes all other types of files. <em>Default value:</em> non-null.</p>
</dd>
<dt class="hdlist1"><code>scala.srcDirs</code>  <code>Set&lt;File&gt;</code></dt>
<dd>
<p>The source directories containing the Scala source files of this source set. May also contain Java source files for joint compilation.
Can set using anything described in <a href="#sec:specifying_multiple_files">Understanding implicit conversion to file collections</a>.
<em>Default value:</em> <code>[<em>projectDir</em>/src/<em>name</em>/scala]</code>.</p>
</dd>
<dt class="hdlist1"><code>allScala</code>  <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/file/FileTree.html">FileTree</a> (read-only)</dt>
<dd>
<p>All Scala source files of this source set. Contains only the <code>.scala</code> files found in the Scala source directories. <em>Default value:</em> non-null.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These convention properties are provided by a convention object of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.ScalaSourceSet.html">ScalaSourceSet</a>.</p>
</div>
<div class="paragraph">
<p>The Scala plugin also modifies some source set properties:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 43. Scala plugin - source set properties</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Change</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allJava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all <code>.java</code> files found in the Scala source directories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds all source files found in the Scala source directories.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sec:scala_compiling_in_external_process"><a class="anchor" href="#sec:scala_compiling_in_external_process"></a><a class="link" href="#sec:scala_compiling_in_external_process">Compiling in external process</a></h4>
<div class="paragraph">
<p>Scala compilation takes place in an external process.</p>
</div>
<div class="paragraph">
<p>Memory settings for the external process default to the defaults of the JVM. To adjust memory settings, configure the <code>scalaCompileOptions.forkOptions</code> property as needed:</p>
</div>
<div class="exampleblock">
<div class="title">Example 647. Adjusting memory settings</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(ScalaCompile) {
    scalaCompileOptions.forkOptions.with {
        memoryMaximumSize = <span class="string"><span class="delimiter">'</span><span class="content">1g</span><span class="delimiter">'</span></span>
        jvmArgs = [<span class="string"><span class="delimiter">'</span><span class="content">-XX:MaxPermSize=512m</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;ScalaCompile&gt;().configureEach {
    scalaCompileOptions.forkOptions.apply {
        memoryMaximumSize = &quot;1g&quot;
        jvmArgs = listOf(&quot;-XX:MaxPermSize=512m&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_incremental_compilation"><a class="anchor" href="#sec:scala_incremental_compilation"></a><a class="link" href="#sec:scala_incremental_compilation">Incremental compilation</a></h4>
<div class="paragraph">
<p>By compiling only classes whose source code has changed since the previous compilation, and classes affected by these changes, incremental compilation can significantly reduce Scala compilation time. It is particularly effective when frequently compiling small code increments, as is often done at development time.</p>
</div>
<div class="paragraph">
<p>The Scala plugin defaults to incremental compilation by integrating with <a href="https://github.com/typesafehub/zinc">Zinc</a>, a standalone version of <a href="https://github.com/harrah/xsbt">sbt</a>'s incremental Scala compiler. If you want to disable the incremental compilation, set <code>force = true</code> in your build file:</p>
</div>
<div class="exampleblock">
<div class="title">Example 648. Forcing all code to be compiled</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(ScalaCompile) {
    scalaCompileOptions.with {
        force = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;ScalaCompile&gt;().configureEach {
    scalaCompileOptions.apply {
        isForce = true
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Note:</em> This will only cause all classes to be recompiled if at least one input source file has changed. If there are no changes to the source files, the <code>compileScala</code> task will still be considered <code>UP-TO-DATE</code> as usual.</p>
</div>
<div class="paragraph">
<p>The Zinc-based Scala Compiler supports joint compilation of Java and Scala code. By default, all Java and Scala code under <code>src/main/scala</code> will participate in joint compilation. Even Java code will be compiled incrementally.</p>
</div>
<div class="paragraph">
<p>Incremental compilation requires dependency analysis of the source code. The results of this analysis are stored in the file designated by <code>scalaCompileOptions.incrementalOptions.analysisFile</code> (which has a sensible default). In a multi-project build, analysis files are passed on to downstream <code>ScalaCompile</code> tasks to enable incremental compilation across project boundaries. For <code>ScalaCompile</code> tasks added by the Scala plugin, no configuration is necessary to make this work. For other <code>ScalaCompile</code> tasks that you might add, the property <code>scalaCompileOptions.incrementalOptions.publishedCode</code> needs to be configured to point to the classes folder or Jar archive by which the code is passed on to compile class paths of downstream <code>ScalaCompile</code> tasks. Note that if <code>publishedCode</code> is not set correctly, downstream tasks may not recompile code affected by upstream changes, leading to incorrect compilation results.</p>
</div>
<div class="paragraph">
<p>Note that Zinc&#8217;s Nailgun based daemon mode is not supported. Instead, we plan to enhance Gradle&#8217;s own compiler daemon to stay alive across Gradle invocations, reusing the same Scala compiler. This is expected to yield another significant speedup for Scala compilation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:scala_cross_compilation"><a class="anchor" href="#sec:scala_cross_compilation"></a><a class="link" href="#sec:scala_cross_compilation">Compiling and testing for Java 6 or Java 7</a></h4>
<div class="paragraph">
<p>The Scala compiler ignores Gradle&#8217;s <code>targetCompatibility</code> and <code>sourceCompatibility</code> settings. In Scala 2.11, the Scala compiler always compiles to Java 6 compatible bytecode. In Scala 2.12, the Scala compiler always compiles to Java 8 compatible bytecode. If you also have Java source, you can follow the same steps as for the <a href="#sec:java_cross_compilation">Java plugin</a> to ensure the correct Java compiler is used.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># in $HOME/.gradle/gradle.properties
java6Home=/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java {
    sourceCompatibility = JavaVersion.VERSION_1_6
}

<span class="keyword">assert</span> hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">java6Home</span><span class="delimiter">'</span></span>) : <span class="string"><span class="delimiter">&quot;</span><span class="content">Set the property 'java6Home' in your your gradle.properties pointing to a Java 6 installation</span><span class="delimiter">&quot;</span></span>
<span class="keyword">def</span> javaExecutablesPath = <span class="keyword">new</span> <span class="predefined-type">File</span>(java6Home, <span class="string"><span class="delimiter">'</span><span class="content">bin</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> javaExecutables = [:].withDefault { execName -&gt;
    <span class="keyword">def</span> executable = <span class="keyword">new</span> <span class="predefined-type">File</span>(javaExecutablesPath, execName)
    <span class="keyword">assert</span> executable.exists() : <span class="string"><span class="delimiter">&quot;</span><span class="content">There is no </span><span class="inline"><span class="inline-delimiter">${</span>execName<span class="inline-delimiter">}</span></span><span class="content"> executable in </span><span class="inline"><span class="inline-delimiter">${</span>javaExecutablesPath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    executable
}

tasks.withType(AbstractCompile) {
    options.with {
        fork = <span class="predefined-constant">true</span>
        forkOptions.javaHome = file(java6Home)
    }
}
tasks.withType(Test) {
    executable = javaExecutables.java
}
tasks.withType(JavaExec) {
    executable = javaExecutables.java
}
tasks.withType(Javadoc) {
    executable = javaExecutables.javadoc
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">java {
    sourceCompatibility = JavaVersion.VERSION_1_6
}

require(hasProperty(&quot;java6Home&quot;)) { &quot;Set the property 'java6Home' in your your gradle.properties pointing to a Java 6 installation&quot; }
val java6Home: String by project
val javaExecutablesPath = File(java6Home, &quot;bin&quot;)
fun javaExecutable(execName: String): String {
    val executable = File(javaExecutablesPath, execName)
    require(executable.exists()) { &quot;There is no ${execName} executable in ${javaExecutablesPath}&quot; }
    return executable.toString()
}

tasks.withType&lt;ScalaCompile&gt;().configureEach {
    options.apply {
        isFork = true
        forkOptions.javaHome = file(java6Home)
    }
}
tasks.withType&lt;Test&gt;().configureEach {
    executable = javaExecutable(&quot;java&quot;)
}
tasks.withType&lt;JavaExec&gt;().configureEach {
    executable = javaExecutable(&quot;java&quot;)
}
tasks.withType&lt;Javadoc&gt;().configureEach {
    executable = javaExecutable(&quot;javadoc&quot;)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:eclipse_integration"><a class="anchor" href="#sec:eclipse_integration"></a><a class="link" href="#sec:eclipse_integration">Eclipse Integration</a></h4>
<div class="paragraph">
<p>When the Eclipse plugin encounters a Scala project, it adds additional configuration to make the project work with Scala IDE out of the box. Specifically, the plugin adds a Scala nature and dependency container.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:intellij_idea_integration"><a class="anchor" href="#sec:intellij_idea_integration"></a><a class="link" href="#sec:intellij_idea_integration">IntelliJ IDEA Integration</a></h4>
<div class="paragraph">
<p>When the IDEA plugin encounters a Scala project, it adds additional configuration to make the project work with IDEA out of the box. Specifically, the plugin adds a Scala SDK (IntelliJ IDEA 14+) and a Scala compiler library that matches the Scala version on the project&#8217;s class path. The Scala plugin is backwards compatible with earlier versions of IntelliJ IDEA and it is possible to add a Scala facet instead of the default Scala SDK by configuring <code>targetVersion</code> on <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ide.idea.model.IdeaModel.html">IdeaModel</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 649. Explicitly specify a target IntelliJ IDEA version</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">idea {
    targetVersion = <span class="string"><span class="delimiter">'</span><span class="content">13</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">idea {
    targetVersion = &quot;13&quot;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="signing_plugin"><a class="anchor" href="#signing_plugin"></a><a class="link" href="#signing_plugin">The Signing Plugin</a></h3>
<div class="paragraph">
<p>The Signing Plugin adds the ability to digitally sign built files and artifacts. These digital signatures can then be used to prove who built the artifact the signature is attached to as well as other information such as when the signature was generated.</p>
</div>
<div class="paragraph">
<p>The Signing Plugin currently only provides support for generating <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy#OpenPGP">OpenPGP signatures</a> (which is the signature format <a href="http://central.sonatype.org/pages/requirements.html#sign-files-with-gpgpgp">required for publication to the Maven Central Repository</a>).</p>
</div>
<div class="sect3">
<h4 id="sec:signing_usage"><a class="anchor" href="#sec:signing_usage"></a><a class="link" href="#sec:signing_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the Signing Plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 650. Using the Signing Plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">signing</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    signing
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:signatory_credentials"><a class="anchor" href="#sec:signatory_credentials"></a><a class="link" href="#sec:signatory_credentials">Signatory credentials</a></h4>
<div class="paragraph">
<p>In order to create OpenPGP signatures, you will need a key pair (instructions on creating a key pair using the <a href="https://www.gnupg.org/">GnuPG tools</a> can be found in the <a href="https://www.gnupg.org/documentation/howtos.html">GnuPG HOWTOs</a>). You need to provide the Signing Plugin with your key information, which means three things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The public key ID (The last 8 symbols of the keyId. You can use <code>gpg -K</code> to get it).</p>
</li>
<li>
<p>The absolute path to the secret key ring file containing your private key. (Since gpg 2.1, you need to export the keys with command <code>gpg --keyring secring.gpg --export-secret-keys &gt; ~/.gnupg/secring.gpg</code>).</p>
</li>
<li>
<p>The passphrase used to protect your private key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These items must be supplied as the values of the <code>signing.keyId</code>, <code>signing.secretKeyRingFile</code>, and <code>signing.password</code> properties, respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Given the personal and private nature of these values, a good practice is to store them in the <code>gradle.properties</code> file in the user&#8217;s Gradle home directory (described in <a href="#sec:gradle_system_properties">System properties</a>) instead of in the project directory itself.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">signing.keyId=24875D73
signing.password=secret
signing.secretKeyRingFile=/Users/me/.gnupg/secring.gpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>If specifying this information (especially <code>signing.password</code>) in the user <code>gradle.properties</code> file is not feasible for your environment, you can source the information however you need to and set the project properties manually.</p>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle.taskGraph.whenReady { taskGraph -&gt;
    <span class="keyword">if</span> (taskGraph.allTasks.any { <span class="local-variable">it</span> <span class="keyword">instanceof</span> Sign }) {
        <span class="comment">// Use Java's console to read from the console (no good for</span>
        <span class="comment">// a CI environment)</span>
        <span class="keyword">def</span> console = <span class="predefined-type">System</span>.console()
        console.printf <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="char">\n</span><span class="content">We have to sign some things in this build.</span><span class="delimiter">&quot;</span></span> +
                       <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="char">\n</span><span class="content">Please enter your signing details.</span><span class="char">\n</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>

        <span class="keyword">def</span> id = console.readLine(<span class="string"><span class="delimiter">&quot;</span><span class="content">PGP Key Id: </span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> file = console.readLine(<span class="string"><span class="delimiter">&quot;</span><span class="content">PGP Secret Key Ring File (absolute path): </span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> password = console.readPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">PGP Private Key Password: </span><span class="delimiter">&quot;</span></span>)

        allprojects {
            ext.<span class="string"><span class="delimiter">&quot;</span><span class="content">signing.keyId</span><span class="delimiter">&quot;</span></span> = id
            ext.<span class="string"><span class="delimiter">&quot;</span><span class="content">signing.secretKeyRingFile</span><span class="delimiter">&quot;</span></span> = file
            ext.<span class="string"><span class="delimiter">&quot;</span><span class="content">signing.password</span><span class="delimiter">&quot;</span></span> = password
        }

        console.printf <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Thanks.</span><span class="char">\n</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">gradle.taskGraph.whenReady {
    if (allTasks.any { it is Sign }) {
        // Use Java's console to read from the console (no good for
        // a CI environment)
        val console = System.console()
        console.printf(&quot;\n\nWe have to sign some things in this build.&quot; +
                       &quot;\n\nPlease enter your signing details.\n\n&quot;)

        val id = console.readLine(&quot;PGP Key Id: &quot;)
        val file = console.readLine(&quot;PGP Secret Key Ring File (absolute path): &quot;)
        val password = console.readPassword(&quot;PGP Private Key Password: &quot;)

        allprojects {
            extra[&quot;signing.keyId&quot;] = id
            extra[&quot;signing.secretKeyRingFile&quot;] = file
            extra[&quot;signing.password&quot;] = password
        }

        console.printf(&quot;\nThanks.\n\n&quot;)
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the presence of a null value for any these three properties will cause an exception.</p>
</div>
<div class="sect4">
<h5 id="sec:in-memory-keys"><a class="anchor" href="#sec:in-memory-keys"></a><a class="link" href="#sec:in-memory-keys">Using in-memory ascii-armored keys</a></h5>
<div class="paragraph">
<p>In some setups it is easier to use environment variables to pass the secret key and password used for signing.
For instance, when using a CI server to sign artifacts, securely providing the keyring file is often troublesome.
On the other hand, most CI servers provide means to securely store environment variables and provide them to builds.
Using the following setup, you can pass the secret key (in ascii-armored format) and the password using the <code>ORG_GRADLE_PROJECT_signingKey</code> and <code>ORG_GRADLE_PROJECT_signingPassword</code> environment variables, respectively:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    <span class="keyword">def</span> signingKey = findProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">signingKey</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">def</span> signingPassword = findProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">signingPassword</span><span class="delimiter">&quot;</span></span>)
    useInMemoryPgpKeys(signingKey, signingPassword)
    sign stuffZip
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    val signingKey: String? by project
    val signingPassword: String? by project
    useInMemoryPgpKeys(signingKey, signingPassword)
    sign(tasks[&quot;stuffZip&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using_in_memory_ascii_armored_openpgp_subkeys"><a class="anchor" href="#using_in_memory_ascii_armored_openpgp_subkeys"></a><a class="link" href="#using_in_memory_ascii_armored_openpgp_subkeys">Using in-memory ascii-armored OpenPGP subkeys</a></h5>
<div class="paragraph">
<p>To prevent sharing of the master key and to keep it secure it is also possible to use in-memory ascii-armored subkeys.
The main difference between using in-memory ascii-armored keys and subkeys is that it is necessary to specify key identifier as well.
Using the following setup, you can pass the key identifier, secret key (in ascii-armored format) and the password using the <code>ORG_GRADLE_PROJECT_signingKeyId</code>, <code>ORG_GRADLE_PROJECT_signingKey</code> and <code>ORG_GRADLE_PROJECT_signingPassword</code>
environment variables respectively:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    <span class="keyword">def</span> signingKeyId = findProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">signingKeyId</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">def</span> signingKey = findProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">signingKey</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">def</span> signingPassword = findProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">signingPassword</span><span class="delimiter">&quot;</span></span>)
    useInMemoryPgpKeys(signingKeyId, signingKey, signingPassword)
    sign stuffZip
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    val signingKeyId: String? by project
    val signingKey: String? by project
    val signingPassword: String? by project
    useInMemoryPgpKeys(signingKeyId, signingKey, signingPassword)
    sign(tasks[&quot;stuffZip&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:subkeys"><a class="anchor" href="#sec:subkeys"></a><a class="link" href="#sec:subkeys">Using OpenPGP subkeys</a></h5>
<div class="paragraph">
<p>OpenPGP supports subkeys, which are like the normal keys, except they&#8217;re bound to a master key pair. One feature of OpenPGP subkeys is that they can be revoked independently of the master keys which makes key management easier. A practical case study of how subkeys can be leveraged in software development can be read on the <a href="https://wiki.debian.org/Subkeys">Debian wiki</a>.</p>
</div>
<div class="paragraph">
<p>The Signing Plugin supports OpenPGP subkeys out of the box. Just specify a subkey ID as the value in the <code>signing.keyId</code> property.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:using_gpg_agent"><a class="anchor" href="#sec:using_gpg_agent"></a><a class="link" href="#sec:using_gpg_agent">Using gpg-agent</a></h4>
<div class="paragraph">
<p>By default the Signing Plugin uses a Java-based implementation of PGP for signing. This implementation cannot use the gpg-agent program for managing private keys, though. If you want to use the gpg-agent, you can change the signatory implementation used by the Signing Plugin:</p>
</div>
<div class="exampleblock">
<div class="title">Example 651. Sign with GnuPG</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    useGpgCmd()
    sign configurations.archives
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    useGpgCmd()
    sign(configurations.archives.get())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells the Signing Plugin to use the <code>GnupgSignatory</code> instead of the default <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/signing/signatory/pgp/PgpSignatory.html">PgpSignatory</a>. The <code>GnupgSignatory</code> relies on the gpg2 program to sign the artifacts. Of course, this requires that GnuPG is installed.</p>
</div>
<div class="paragraph">
<p>Without any further configuration the <code>gpg2</code> (on Windows: <code>gpg2.exe</code>) executable found on the <code>PATH</code> will be used. The password is supplied by the <code>gpg-agent</code> and the default key is used for signing.</p>
</div>
<div class="sect4">
<h5 id="sec:sec:gnupg_signatory_configuration"><a class="anchor" href="#sec:sec:gnupg_signatory_configuration"></a><a class="link" href="#sec:sec:gnupg_signatory_configuration">Gnupg signatory configuration</a></h5>
<div class="paragraph">
<p>The <code>GnupgSignatory</code> supports a number of configuration options for controlling how gpg is invoked. These are typically set in gradle.properties:</p>
</div>
</div>
<div class="sect4">
<h5 id="example_configure_the_gnupgsignatory"><a class="anchor" href="#example_configure_the_gnupgsignatory"></a><a class="link" href="#example_configure_the_gnupgsignatory">Example: Configure the GnupgSignatory</a></h5>
<div class="listingblock multi-language-sample">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">signing.gnupg.executable=gpg
signing.gnupg.useLegacyGpg=true
signing.gnupg.homeDir=gnupg-home
signing.gnupg.optionsFile=gnupg-home/gpg.conf
signing.gnupg.keyName=24875D73
signing.gnupg.passphrase=gradle</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>signing.gnupg.executable</code></dt>
<dd>
<p>The gpg executable that is invoked for signing. The default value of this property depends on <code>useLegacyGpg</code>. If that is <code>true</code> then the default value of executable is "gpg" otherwise it is "gpg2".</p>
</dd>
<dt class="hdlist1"><code>signing.gnupg.useLegacyGpg</code></dt>
<dd>
<p>Must be <code>true</code> if GnuPG version 1 is used and <code>false</code> otherwise. The default value of the property is <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>signing.gnupg.homeDir</code></dt>
<dd>
<p>Sets the home directory for GnuPG. If not given the default home directory of GnuPG is used.</p>
</dd>
<dt class="hdlist1"><code>signing.gnupg.optionsFile</code></dt>
<dd>
<p>Sets a custom options file for GnuPG. If not given GnuPG&#8217;s default configuration file is used.</p>
</dd>
<dt class="hdlist1"><code>signing.gnupg.keyName</code></dt>
<dd>
<p>The id of the key that should be used for signing. If not given then the default key configured in GnuPG will be used.</p>
</dd>
<dt class="hdlist1"><code>signing.gnupg.passphrase</code></dt>
<dd>
<p>The passphrase for unlocking the secret key. If not given then the gpg-agent program is used for getting the passphrase.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All configuration properties are optional.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:specifying_what_to_sign"><a class="anchor" href="#sec:specifying_what_to_sign"></a><a class="link" href="#sec:specifying_what_to_sign">Specifying what to sign</a></h4>
<div class="paragraph">
<p>As well as configuring how things are to be signed (i.e. the signatory configuration), you must also specify what is to be signed. The Signing Plugin provides a DSL that allows you to specify the tasks and/or configurations that should be signed.</p>
</div>
<div class="sect4">
<h5 id="sec:signing_publications"><a class="anchor" href="#sec:signing_publications"></a><a class="link" href="#sec:signing_publications">Signing Publications</a></h5>
<div class="paragraph">
<p>When publishing artifacts, you often want to sign them so the consumer of your artifacts can verify their signature. For example, the <a href="#java_plugin">Java plugin</a> defines a component that you can use to define a publication to a Maven (or Ivy) repository using the <a href="#publishing_maven">Maven Publish Plugin</a> (or the <a href="#publishing_ivy">Ivy Publish Plugin</a>, respectively). Using the Signing DSL, you can specify that all of the artifacts of this publication should be signed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 652. Signing a publication</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    sign publishing.publications.mavenJava
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    sign(publishing.publications[&quot;mavenJava&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will create a task (of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.signing.Sign.html">Sign</a>) in your project named <code>signMavenJavaPublication</code> that will build all artifacts that are part of the publication (if needed) and then generate signatures for them. The signature files will be placed alongside the artifacts being signed.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_signing_a_publication_output"><a class="anchor" href="#example_signing_a_publication_output"></a><a class="link" href="#example_signing_a_publication_output">Example: Signing a publication output</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle signMavenJavaPublication</code></strong></div>
<div class="content">
<pre>&gt; gradle signMavenJavaPublication
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :javadoc
&gt; Task :javadocJar
&gt; Task :sourcesJar
&gt; Task :generateMetadataFileForMavenJavaPublication
&gt; Task :generatePomFileForMavenJavaPublication
&gt; Task :signMavenJavaPublication

BUILD SUCCESSFUL in 0s
9 actionable tasks: 9 executed</pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the above DSL allows to <code>sign</code> multiple comma-separated publications. Alternatively, you may specify <code>publishing.publications</code> to sign all publications, or use <code>publishing.publications.matching {  }</code> to sign all publications that match the specified predicate.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:signing_configurations"><a class="anchor" href="#sec:signing_configurations"></a><a class="link" href="#sec:signing_configurations">Signing Configurations</a></h5>
<div class="paragraph">
<p>It is common to want to sign the artifacts of a configuration. For example, the <a href="#java_plugin">Java plugin</a> configures a jar to build and this jar artifact is added to the <code>archives</code> configuration. Using the Signing DSL, you can specify that all of the artifacts of this configuration should be signed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 653. Signing a configuration</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">signing {
    sign configurations.archives
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">signing {
    sign(configurations.archives.get())
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will create a task (of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.signing.Sign.html">Sign</a>) in your project named <code>signArchives</code>, that will build any <code>archives</code> artifacts (if needed) and then generate signatures for them. The signature files will be placed alongside the artifacts being signed.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_signing_a_configuration_output"><a class="anchor" href="#example_signing_a_configuration_output"></a><a class="link" href="#example_signing_a_configuration_output">Example: Signing a configuration output</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle signArchives</code></strong></div>
<div class="content">
<pre>&gt; gradle signArchives
&gt; Task :compileJava
&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :signArchives

BUILD SUCCESSFUL in 0s
4 actionable tasks: 4 executed</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sec:signing_tasks"><a class="anchor" href="#sec:signing_tasks"></a><a class="link" href="#sec:signing_tasks">Signing Task Output</a></h5>
<div class="paragraph">
<p>In some cases the artifact that you need to sign may not be part of a configuration.
In this case you can directly sign the task that produces the artifact to sign.</p>
</div>
<div class="exampleblock">
<div class="title">Example 654. Signing a task output</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task stuffZip(<span class="key">type</span>: Zip) {
    archiveBaseName = <span class="string"><span class="delimiter">'</span><span class="content">stuff</span><span class="delimiter">'</span></span>
    from <span class="string"><span class="delimiter">'</span><span class="content">src/stuff</span><span class="delimiter">'</span></span>
}

signing {
    sign stuffZip
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.register&lt;Zip&gt;(&quot;stuffZip&quot;) {
    archiveBaseName.set(&quot;stuff&quot;)
    from(&quot;src/stuff&quot;)
}

signing {
    sign(tasks[&quot;stuffZip&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will create a task (of type <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.signing.Sign.html">Sign</a>) in your project named <code>signStuffZip</code>, that will build the input task&#8217;s archive (if needed) and then sign it.
The signature file will be placed alongside the artifact being signed.</p>
</div>
</div>
<div class="sect4">
<h5 id="example_signing_a_task_output"><a class="anchor" href="#example_signing_a_task_output"></a><a class="link" href="#example_signing_a_task_output">Example: Signing a task output</a></h5>
<div class="listingblock">
<div class="title">Output of <strong><code>gradle signStuffZip</code></strong></div>
<div class="content">
<pre>&gt; gradle signStuffZip
&gt; Task :stuffZip
&gt; Task :signStuffZip

BUILD SUCCESSFUL in 0s
2 actionable tasks: 2 executed</pre>
</div>
</div>
<div class="paragraph">
<p>For a task to be <em>signable</em>, it must produce an archive of some type, i.e. it must extend <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.AbstractArchiveTask.html">AbstractArchiveTask</a>.
Tasks that do this are the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Tar.html">Tar</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Zip.html">Zip</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar</a>, <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.War.html">War</a> and <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.ear.Ear.html">Ear</a> tasks.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec:conditional_signing"><a class="anchor" href="#sec:conditional_signing"></a><a class="link" href="#sec:conditional_signing">Conditional Signing</a></h5>
<div class="paragraph">
<p>A common usage pattern is to require the signing of build artifacts only under certain conditions.
For example, you may not need to sign artifacts for non-release versions.
To achieve this, you can specify the condition as an argument of the <code>required()</code> method.</p>
</div>
<div class="exampleblock">
<div class="title">Example 655. Specifying when signing is required</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">1.0-SNAPSHOT</span><span class="delimiter">'</span></span>
ext.isReleaseVersion = !version.endsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">SNAPSHOT</span><span class="delimiter">&quot;</span></span>)

signing {
    required { isReleaseVersion &amp;&amp; gradle.taskGraph.hasTask(<span class="string"><span class="delimiter">&quot;</span><span class="content">publish</span><span class="delimiter">&quot;</span></span>) }
    sign publishing.publications.main
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">version = &quot;1.0-SNAPSHOT&quot;
extra[&quot;isReleaseVersion&quot;] = !version.toString().endsWith(&quot;SNAPSHOT&quot;)

signing {
    setRequired({
        (project.extra[&quot;isReleaseVersion&quot;] as Boolean) &amp;&amp; gradle.taskGraph.hasTask(&quot;publish&quot;)
    })
    sign(publishing.publications[&quot;main&quot;])
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, we only want to require signing if we are building a release version and we are going to publish it.
Because we are inspecting the task graph to determine if we are going to be publishing, we must set the <code>signing.required</code> property to a closure to defer the evaluation.
See <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/plugins/signing/SigningExtension.html#setRequired-java.lang.Object-">SigningExtension.setRequired(java.lang.Object)</a> for more information.</p>
</div>
<div class="paragraph">
<p>If the <code>required</code> condition does not hold true, artifacts will only be signed if signatory credentials are configured.
Alternatively, you may want to skip signing entirely whether or not signatory credentials are available.
If so, you can configure the <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.signing.Sign.html">Sign</a> tasks to be skipped, for example by attaching a predicate using the <code>onlyIf()</code> method shown in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 656. Specifying when signing is skipped</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tasks.withType(Sign) {
    onlyIf { isReleaseVersion }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.withType&lt;Sign&gt;().configureEach {
    onlyIf { project.extra[&quot;isReleaseVersion&quot;] as Boolean }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:publishing_the_signatures"><a class="anchor" href="#sec:publishing_the_signatures"></a><a class="link" href="#sec:publishing_the_signatures">Publishing the signatures</a></h4>
<div class="paragraph">
<p>When signing <a href="#sec:signing_publications">publications</a>, the resultant signature artifacts are automatically added to the corresponding publication.
Thus, when publishing to a repository, e.g. by executing the <code>publish</code> task, your signatures will be distributed along with the other artifacts without any additional configuration.</p>
</div>
<div class="paragraph">
<p>When signing <a href="#sec:signing_configurations">configurations</a> and <a href="#sec:signing_tasks">tasks</a>, the resultant signature artifacts are automatically added to the <code>signatures</code> and <code>archives</code> dependency configurations.
This means that if you want to upload your signatures to your distribution repository along with the artifacts you simply execute the <code>uploadArchives</code> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:signing_pom_files"><a class="anchor" href="#sec:signing_pom_files"></a><a class="link" href="#sec:signing_pom_files">Signing POM files</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This section covers signing POM files for the <em>legacy</em> publishing mechanism available in Gradle 1.0.
The POM file generated by the <em>new</em> Maven publishing support provided by the <a href="#publishing_maven">Maven Publishing plugin</a> is automatically signed if the corresponding publication is <a href="#sec:signing_publications">specified to be signed</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When deploying signatures for your artifacts to a Maven repository, you will also want to sign the published POM file. The Signing Plugin adds a <code>signing.signPom()</code> (see <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.plugins.signing.SigningExtension.html#org.gradle.plugins.signing.SigningExtension:signPom(org.gradle.api.artifacts.maven.MavenDeployment,%20groovy.lang.Closure)">SigningExtension.signPom(org.gradle.api.artifacts.maven.MavenDeployment, groovy.lang.Closure)</a>) method that can be used in the <code>beforeDeployment()</code> block in your upload task configuration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 657. Signing a POM for deployment</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">uploadArchives {
    repositories {
        mavenDeployer {
            beforeDeployment { MavenDeployment deployment -&gt; signing.signPom(deployment) }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">tasks.named&lt;Upload&gt;(&quot;uploadArchives&quot;) {
    repositories {
        withConvention(MavenRepositoryHandlerConvention::class) {
            mavenDeployer {
                beforeDeployment { signing.signPom(this) }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When signing is not required and the POM cannot be signed due to insufficient configuration (i.e. no credentials for signing) then the <code>signPom()</code> method will silently do nothing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="war_plugin"><a class="anchor" href="#war_plugin"></a><a class="link" href="#war_plugin">The War Plugin</a></h3>
<div class="paragraph">
<p>The War plugin extends the <a href="#">Java plugin</a> to add support for assembling web application WAR files.
It disables the default JAR archive generation of the Java plugin and adds a default WAR archive task.</p>
</div>
<div class="sect3">
<h4 id="sec:war_usage"><a class="anchor" href="#sec:war_usage"></a><a class="link" href="#sec:war_usage">Usage</a></h4>
<div class="paragraph">
<p>To use the War plugin, include the following in your build script:</p>
</div>
<div class="exampleblock">
<div class="title">Example 658. Using the War plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">'</span><span class="content">war</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">plugins {
    war
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_project_layout"><a class="anchor" href="#sec:war_project_layout"></a><a class="link" href="#sec:war_project_layout">Project layout</a></h4>
<div class="paragraph">
<p>In addition to the <a href="#sec:java_project_layout">standard Java project layout</a>, the War Plugin adds:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>src/main/webapp</code></dt>
<dd>
<p>Web application sources</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_tasks"><a class="anchor" href="#sec:war_tasks"></a><a class="link" href="#sec:war_tasks">Tasks</a></h4>
<div class="paragraph">
<p>The War plugin adds and modifies the following tasks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>war</code>  <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.War.html">War</a></dt>
<dd>
<p><em>Depends on</em>: <code>compile</code></p>
<div class="paragraph">
<p>Assembles the application WAR file.</p>
</div>
</dd>
<dt class="hdlist1"><code>assemble</code> - <em>lifecycle task</em></dt>
<dd>
<p><em>Depends on</em>: <code>war</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The War plugin adds the following dependencies to tasks added by the Java plugin;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/warPluginTasks.png" alt="warPluginTasks">
</div>
<div class="title">Figure 38. War plugin - tasks</div>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_dependency_management"><a class="anchor" href="#sec:war_dependency_management"></a><a class="link" href="#sec:war_dependency_management">Dependency management</a></h4>
<div class="paragraph">
<p>The War plugin adds two dependency configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>providedCompile</code></p>
</li>
<li>
<p><code>providedRuntime</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two configurations have the same scope as the respective <code>compile</code> and <code>runtime</code> configurations, except that they are not added to the WAR archive.</p>
</div>
<div class="paragraph">
<p>It is important to note that these <code>provided</code> configurations work transitively. Let&#8217;s say you add <code>commons-httpclient:commons-httpclient:3.0</code> to any of the provided configurations. This dependency has a dependency on <code>commons-codec</code>. Because this is a provided configuration, this means that neither of these dependencies will be added to your WAR, even if the <code>commons-codec</code> library is an explicit dependency of your <code>compile</code> configuration. If you don&#8217;t want this transitive behavior, simply declare your <code>provided</code> dependencies like <code>commons-httpclient:commons-httpclient:3.0@jar</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_plugin_publishing"><a class="anchor" href="#sec:war_plugin_publishing"></a><a class="link" href="#sec:war_plugin_publishing">Publishing</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>components.web</code></dt>
<dd>
<p>A <a href="https://docs.gradle.org/6.4.1/javadoc/org/gradle/api/component/SoftwareComponent.html">SoftwareComponent</a> for <a href="#publishing_overview">publishing</a> the production WAR created by the <code>war</code> task.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_convention_properties"><a class="anchor" href="#sec:war_convention_properties"></a><a class="link" href="#sec:war_convention_properties">Convention properties</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>webAppDirName</code> <code>String</code></dt>
<dd>
<p><em>Default value</em>: <code>src/main/webapp</code></p>
<div class="paragraph">
<p>The name of the web application source directory, relative to the project directory.</p>
</div>
</dd>
<dt class="hdlist1"><code>webAppDir</code> (read-only) <code>File</code></dt>
<dd>
<p><em>Default value</em>: <code>$webAppDirName</code>, e.g. <em>src/main/webapp</em></p>
<div class="paragraph">
<p>The path to the web application source directory.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These properties are provided by a <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.plugins.WarPluginConvention.html">WarPluginConvention</a> object.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_default_settings"><a class="anchor" href="#sec:war_default_settings"></a><a class="link" href="#sec:war_default_settings">War</a></h4>
<div class="paragraph">
<p>The default behavior of the <code>War</code> task is to copy the content of <code>src/main/webapp</code> to the root of the archive. Your <code>webapp</code> directory may of course contain a <code>WEB-INF</code> sub-directory, which may contain a <code>web.xml</code> file. Your compiled classes are compiled to <code>WEB-INF/classes</code>. All the dependencies of the <code>runtime</code> <sup class="footnote">[<a id="_footnoteref_24" class="footnote" href="#_footnotedef_24" title="View footnote.">24</a>]</sup> configuration are copied to <code>WEB-INF/lib</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/6.4.1/dsl/org.gradle.api.tasks.bundling.War.html">War</a> class in the API documentation has additional useful information.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec:war_customizing"><a class="anchor" href="#sec:war_customizing"></a><a class="link" href="#sec:war_customizing">Customizing</a></h4>
<div class="paragraph">
<p>Here is an example with the most important customization options:</p>
</div>
<div class="exampleblock">
<div class="title">Example 659. Customization of war plugin</div>
<div class="content">
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
   moreLibs
}

repositories {
   flatDir { dirs <span class="string"><span class="delimiter">&quot;</span><span class="content">lib</span><span class="delimiter">&quot;</span></span> }
   jcenter()
}

dependencies {
    implementation module(<span class="string"><span class="delimiter">&quot;</span><span class="content">:compile:1.0</span><span class="delimiter">&quot;</span></span>) {
        dependency <span class="string"><span class="delimiter">&quot;</span><span class="content">:compile-transitive-1.0@jar</span><span class="delimiter">&quot;</span></span>
        dependency <span class="string"><span class="delimiter">&quot;</span><span class="content">:providedCompile-transitive:1.0@jar</span><span class="delimiter">&quot;</span></span>
    }
    providedCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.servlet:servlet-api:2.5</span><span class="delimiter">&quot;</span></span>
    providedCompile module(<span class="string"><span class="delimiter">&quot;</span><span class="content">:providedCompile:1.0</span><span class="delimiter">&quot;</span></span>) {
        dependency <span class="string"><span class="delimiter">&quot;</span><span class="content">:providedCompile-transitive:1.0@jar</span><span class="delimiter">&quot;</span></span>
    }
    runtimeOnly <span class="string"><span class="delimiter">&quot;</span><span class="content">:runtime:1.0</span><span class="delimiter">&quot;</span></span>
    providedRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">:providedRuntime:1.0@jar</span><span class="delimiter">&quot;</span></span>
    testImplementation <span class="string"><span class="delimiter">&quot;</span><span class="content">junit:junit:4.12</span><span class="delimiter">&quot;</span></span>
    moreLibs <span class="string"><span class="delimiter">&quot;</span><span class="content">:otherLib:1.0</span><span class="delimiter">&quot;</span></span>
}

war {
    from <span class="string"><span class="delimiter">'</span><span class="content">src/rootContent</span><span class="delimiter">'</span></span> <span class="comment">// adds a file-set to the root of the archive</span>
    webInf { from <span class="string"><span class="delimiter">'</span><span class="content">src/additionalWebInf</span><span class="delimiter">'</span></span> } <span class="comment">// adds a file-set to the WEB-INF dir.</span>
    classpath fileTree(<span class="string"><span class="delimiter">'</span><span class="content">additionalLibs</span><span class="delimiter">'</span></span>) <span class="comment">// adds a file-set to the WEB-INF/lib dir.</span>
    classpath configurations.moreLibs <span class="comment">// adds a configuration to the WEB-INF/lib dir.</span>
    webXml = file(<span class="string"><span class="delimiter">'</span><span class="content">src/someWeb.xml</span><span class="delimiter">'</span></span>) <span class="comment">// copies a file to WEB-INF/web.xml</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock testable-sample multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val moreLibs = configurations.create(&quot;moreLibs&quot;)

repositories {
    flatDir { dir(&quot;lib&quot;) }
    jcenter()
}

dependencies {
    implementation(module(&quot;:compile:1.0&quot;) {
        dependency(&quot;:compile-transitive-1.0@jar&quot;)
        dependency( &quot;:providedCompile-transitive:1.0@jar&quot;)
    })
    providedCompile(&quot;javax.servlet:servlet-api:2.5&quot;)
    providedCompile(module(&quot;:providedCompile:1.0&quot;) {
        dependency(&quot;:providedCompile-transitive:1.0@jar&quot;)
    })
    runtimeOnly(&quot;:runtime:1.0&quot;)
    providedRuntime(&quot;:providedRuntime:1.0@jar&quot;)
    testImplementation(&quot;junit:junit:4.12&quot;)
    moreLibs(&quot;:otherLib:1.0&quot;)
}

tasks.war {
    from(&quot;src/rootContent&quot;) // adds a file-set to the root of the archive
    webInf { from(&quot;src/additionalWebInf&quot;) } // adds a file-set to the WEB-INF dir.
    classpath(fileTree(&quot;additionalLibs&quot;)) // adds a file-set to the WEB-INF/lib dir.
    classpath(moreLibs) // adds a configuration to the WEB-INF/lib dir.
    webXml = file(&quot;src/someWeb.xml&quot;) // copies a file to WEB-INF/web.xml
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Of course one can configure the different file-sets with a closure to define excludes and includes.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license_information"><a class="anchor" href="#license_information"></a><a class="link" href="#license_information">License Information</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="licenses"><a class="anchor" href="#licenses"></a><a class="link" href="#licenses">License Information</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sec:gradle_documentation"><a class="anchor" href="#sec:gradle_documentation"></a><a class="link" href="#sec:gradle_documentation">Gradle Documentation</a></h3>
<div class="paragraph">
<p><em>Copyright  2007-2019 Gradle, Inc.</em></p>
</div>
<div class="paragraph">
<p>Gradle build tool source code is open-source and licensed under the <a href="https://github.com/gradle/gradle/blob/master/LICENSE">Apache License 2.0</a>.</p>
</div>
<div class="paragraph">
<p>Gradle user manual and DSL references are licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="licenses:build_scan_plugin"><a class="anchor" href="#licenses:build_scan_plugin"></a><a class="link" href="#licenses:build_scan_plugin">Gradle Build Scan Plugin</a></h3>
<div class="paragraph">
<p>Use of the <a href="https://scans.gradle.com/plugin/">build scan plugin</a> is subject to <a href="https://gradle.com/legal/terms-of-service/">Gradle&#8217;s Terms of Service</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. There are command line switches to change this behavior. See <a href="#command_line_interface">Command-Line Interface</a>)
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. There are command line switches to change this behavior. See <a href="#command_line_interface">Command-Line Interface</a>)
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. You might be wondering why there is neither an import for the <code>StopExecutionException</code> nor do we access it via its fully qualified name. The reason is, that Gradle adds a set of default imports to your script (see <a href="#script-default-imports">Default imports</a>).
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Any language element except for statement labels.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Gradle supports partial multi-project builds (see <a href="#multi_project_builds">Authoring Multi-Project Builds</a>).
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. The real use case we had, was using <a href="http://lucene.apache.org/solr" class="bare">http://lucene.apache.org/solr</a>, where you need a separate war for each index you are accessing. That was one reason why we have created a distribution of webapps. The Resin servlet container allows us, to let such a distribution point to a base installation of the servlet container.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. We do this here, as it makes the layout a bit easier. We usually put the project specific stuff into the build script of the respective projects.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. In Groovy you can execute Strings. To learn more about executing external processes with Groovy have a look in 'Groovy in Action' 9.3.2 or at the Groovy wiki
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. In fact, any artifact added to the <code>archives</code> configuration will be built by <code>assemble</code>
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. For more details on <code>gradle.properties</code> see <a href="#sec:gradle_configuration_properties">Gradle configuration properties</a>
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. The JUnit wiki contains a detailed description on how to work with JUnit categories: <a href="https://github.com/junit-team/junit/wiki/Categories" class="bare">https://github.com/junit-team/junit/wiki/Categories</a>.
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. The TestNG documentation contains more details about test groups: <a href="http://testng.org/doc/documentation-main.html#test-groups" class="bare">http://testng.org/doc/documentation-main.html#test-groups</a>.
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. The TestNG documentation contains more details about test ordering when working with <code>testng.xml</code> files: <a href="http://testng.org/doc/documentation-main.html#testng-xml" class="bare">http://testng.org/doc/documentation-main.html#testng-xml</a>.
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. Unfortunately, Conan and Nuget repositories arent yet supported as core features
</div>
<div class="footnote" id="_footnotedef_15">
<a href="#_footnoteref_15">15</a>. Installed with Xcode on macOS
</div>
<div class="footnote" id="_footnotedef_16">
<a href="#_footnoteref_16">16</a>. Installed through Cygwin and MinGW for 32- and 64-bits architecture on Windows
</div>
<div class="footnote" id="_footnotedef_17">
<a href="#_footnoteref_17">17</a>. Installed with Visual Studio 2010 to 2019
</div>
<div class="footnote" id="_footnotedef_18">
<a href="#_footnoteref_18">18</a>. Macports and Homebrew installation of GCC and Clang is not officially supported
</div>
<div class="footnote" id="_footnotedef_19">
<a href="#_footnoteref_19">19</a>. Unfortunately, Cocoapods repositories arent yet supported as core features
</div>
<div class="footnote" id="_footnotedef_20">
<a href="#_footnoteref_20">20</a>. Gradle uses the same conventions as introduced by Russel Winder&#8217;s <a href="https://gant.github.io/">Gant tool</a>.
</div>
<div class="footnote" id="_footnotedef_21">
<a href="#_footnoteref_21">21</a>. It is planned for a future release to provide out-of-the-box support for this
</div>
<div class="footnote" id="_footnotedef_22">
<a href="#_footnoteref_22">22</a>. See <a href="#sec:configure_scala_classpath">Automatic configuration of Scala classpath</a>.
</div>
<div class="footnote" id="_footnotedef_23">
<a href="#_footnoteref_23">23</a>. Gradle does not support running the Zinc compiler v1.2.0 with Scala 2.11.
</div>
<div class="footnote" id="_footnotedef_24">
<a href="#_footnoteref_24">24</a>. The <code>runtime</code> configuration extends the <code>compile</code> configuration.
</div>
</div>
</div>
<!-- end div class="chapter" -->
<aside class="secondary-navigation"></aside>
</main>

<footer class="site-layout__footer site-footer" itemscope="itemscope" itemtype="https://schema.org/WPFooter">
    <nav class="site-footer__navigation" itemtype="https://schema.org/SiteNavigationElement">
        <section class="site-footer__links">
            <div class="site-footer__link-group">
                <header><strong>Docs</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="/userguide/userguide.html" itemprop="url">User Manual</a></li>
                    <li itemprop="name"><a href="/dsl/" itemprop="url">DSL Reference</a></li>
                    <li itemprop="name"><a href="/release-notes.html" itemprop="url">Release Notes</a></li>
                    <li itemprop="name"><a href="/javadoc/" itemprop="url">Javadoc</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>News</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://blog.gradle.org/" itemprop="url">Blog</a></li>
                    <li itemprop="name"><a href="https://newsletter.gradle.com/" itemprop="url">Newsletter</a></li>
                    <li itemprop="name"><a href="https://twitter.com/gradle" itemprop="url">Twitter</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Products</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://gradle.com/build-scans/" itemprop="url">Build Scans</a></li>
                    <li itemprop="name"><a href="https://gradle.com/build-cache/" itemprop="url">Build Cache</a></li>
                    <li itemprop="name"><a href="https://gradle.com/enterprise/resources/" itemprop="url">Enterprise Docs</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Get Help</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://discuss.gradle.org/c/help-discuss" itemprop="url">Forums</a></li>
                    <li itemprop="name"><a href="https://github.com/gradle/" itemprop="url">GitHub</a></li>
                    <li itemprop="name"><a href="https://gradle.com/training/" itemprop="url">Training</a></li>
                    <li itemprop="name"><a href="https://gradle.org/services/" itemprop="url">Services</a></li>
                </ul>
            </div>
        </section>
        <section class="site-footer__subscribe-newsletter" id="newsletter-form-container">
            <header class="newsletter-form__header"><h5>Stay <code>UP-TO-DATE</code> on new features and news</h5></header>
            <p class="disclaimer">By entering your email, you agree to our <a href="https://gradle.com/legal/terms-of-service/">Terms</a> and <a href="https://gradle.com/legal/privacy/">Privacy Policy</a>, including receipt of emails. You can unsubscribe at any time.</p>
            <div class="newsletter-form__container">
                <form id="newsletter-form" class="newsletter-form" action="https://go.gradle.com/l/68052/2018-09-07/bk6wml" method="post">
                    <input id="email" class="email" name="email" type="email" placeholder="name@email.com" pattern="[^@\s]+@[^@\s]+\.[^@\s]+" maxlength="255" required=""/>
                    <button id="submit" class="submit" type="submit">Subscribe</button>
                </form>
            </div>
        </section>
    </nav>
    <div class="site-footer-secondary">
        <div class="site-footer-secondary__contents">
            <div class="site-footer__copy"> <a href="https://gradle.com">Gradle Inc.</a>
                <time>2018</time>
                All rights reserved.
            </div>
            <div class="site-footer__logo"><a href="/">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 66.06">
                    <defs>
                        <style>.cls-1 {
                            fill: #02303a;
                        }</style>
                    </defs>
                    <title>gradle</title>
                    <path class="cls-1"
                          d="M85.11,4.18a14.27,14.27,0,0,0-19.83-.34,1.38,1.38,0,0,0,0,2L67,7.6a1.36,1.36,0,0,0,1.78.12A8.18,8.18,0,0,1,79.5,20.06C68.17,31.38,53.05-.36,18.73,16a4.65,4.65,0,0,0-2,6.54l5.89,10.17a4.64,4.64,0,0,0,6.3,1.73l.14-.08-.11.08L31.53,33a60.29,60.29,0,0,0,8.22-6.13,1.44,1.44,0,0,1,1.87-.06h0a1.34,1.34,0,0,1,.06,2A61.61,61.61,0,0,1,33,35.34l-.09,0-2.61,1.46a7.34,7.34,0,0,1-3.61.94,7.45,7.45,0,0,1-6.47-3.71l-5.57-9.61C4,32-2.54,46.56,1,65a1.36,1.36,0,0,0,1.33,1.11H8.61A1.36,1.36,0,0,0,10,64.87a9.29,9.29,0,0,1,18.42,0,1.35,1.35,0,0,0,1.34,1.19H35.9a1.36,1.36,0,0,0,1.34-1.19,9.29,9.29,0,0,1,18.42,0A1.36,1.36,0,0,0,57,66.06H63.1a1.36,1.36,0,0,0,1.36-1.34c.14-8.6,2.46-18.48,9.07-23.43C96.43,24.16,90.41,9.48,85.11,4.18ZM61.76,30.05l-4.37-2.19h0a2.74,2.74,0,1,1,4.37,2.2Z"/>
                </svg>
            </a></div>
            <div class="site-footer-secondary__links">
                <a href="https://gradle.com/careers/">Careers</a> |
                <a href="https://gradle.com/legal/privacy/">Privacy</a> |
                <a href="https://gradle.com/legal/terms-of-service/">Terms of Service</a> |
                <a href="https://gradle.org/contact/">Contact</a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    // Polyfill Element.matches()
    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }
    // Polyfill Element.closest()
    if (!Element.prototype.closest) {
        Element.prototype.closest = function (s) {
            var el = this;
            if (!document.documentElement.contains(el)) return null;
            do {
                if (typeof el.matches === "function" && el.matches(s)) return el;
                el = el.parentElement || el.parentNode;
            } while (el !== null);
            return null;
        };
    }

    var currentChapterFileName = window.location.pathname.substr(window.location.pathname.lastIndexOf("/") + 1);
    if (currentChapterFileName === "index.html") {
        currentChapterFileName = window.location.pathname.substr(0, window.location.pathname.lastIndexOf("/"));
        currentChapterFileName = currentChapterFileName.substr(currentChapterFileName.lastIndexOf("/") + 1) + "/index.html";
    }
    [].forEach.call(document.querySelectorAll(".docs-navigation a[href$='" + currentChapterFileName + "']"), function (link) {
        // Add "active" to all links same as current URL
        link.classList.add("active");

        // Expand all parent navigation
        var parentListEl = link.closest("li");
        while (parentListEl !== null) {
            var dropDownEl = parentListEl.querySelector(".nav-dropdown");
            if (dropDownEl !== null) {
                dropDownEl.classList.add("expanded");
            }
            parentListEl = parentListEl.parentNode.closest("li");
        }
    });

    // Expand/contract multi-level side navigation
    [].forEach.call(document.querySelectorAll(".docs-navigation .nav-dropdown"), function registerSideNavActions(collapsibleElement) {
        collapsibleElement.addEventListener("click", function toggleExpandedSideNav(evt) {
            evt.preventDefault();
            evt.target.classList.toggle("expanded");
            evt.target.setAttribute("aria-expanded", evt.target.classList.contains("expanded").toString());
            return false;
        }, false);
    });

    function postProcessCodeBlocks() {
        // Assumptions:
        //  1) All siblings that are marked with class="multi-language-sample" should be grouped
        //  2) Only one language can be selected per domain (to allow selection to persist across all docs pages)
        //  3) There is exactly 1 small set of languages to choose from. This does not allow for multiple language preferences. For example, users cannot prefer both Kotlin and ZSH.
        //  4) Only 1 sample of each language can exist in the same collection.

        var GRADLE_DSLs = ["groovy", "kotlin"];
        var preferredBuildScriptLanguage = initPreferredBuildScriptLanguage();

        // Ensure preferred DSL is valid, defaulting to Groovy DSL
        function initPreferredBuildScriptLanguage() {
            var lang = window.localStorage.getItem("preferred-gradle-dsl");
            if (GRADLE_DSLs.indexOf(lang) === -1) {
                window.localStorage.setItem("preferred-gradle-dsl", "groovy");
                lang = "groovy";
            }
            return lang;
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function processSampleEl(sampleEl, prefLangId) {
            var codeEl = sampleEl.querySelector("code[data-lang]");
            if (codeEl != null) {
                sampleEl.setAttribute("data-lang", codeEl.getAttribute("data-lang"));
                if (codeEl.getAttribute("data-lang") !== prefLangId) {
                    sampleEl.classList.add("hidden");
                } else {
                    sampleEl.classList.remove("hidden");
                }
            }
        }

        function switchSampleLanguage(languageId) {
            var multiLanguageSampleElements = [].slice.call(document.querySelectorAll(".multi-language-sample"));

            // Array of Arrays, each top-level array representing a single collection of samples
            var multiLanguageSets = [];
            for (var i = 0; i < multiLanguageSampleElements.length; i++) {
                var currentCollection = [multiLanguageSampleElements[i]];
                var currentSampleElement = multiLanguageSampleElements[i];
                processSampleEl(currentSampleElement, languageId);
                while (currentSampleElement.nextElementSibling != null && currentSampleElement.nextElementSibling.classList.contains("multi-language-sample")) {
                    currentCollection.push(currentSampleElement.nextElementSibling);
                    currentSampleElement = currentSampleElement.nextElementSibling;
                    processSampleEl(currentSampleElement, languageId);
                    i++;
                }

                multiLanguageSets.push(currentCollection);
            }

            multiLanguageSets.forEach(function (sampleCollection) {
                // Create selector element if not existing
                if (sampleCollection.length > 1 &&
                    (sampleCollection[0].previousElementSibling == null ||
                        !sampleCollection[0].previousElementSibling.classList.contains("multi-language-selector"))) {
                    var languageSelectorFragment = document.createDocumentFragment();
                    var multiLanguageSelectorElement = document.createElement("div");
                    multiLanguageSelectorElement.classList.add("multi-language-selector");
                    languageSelectorFragment.appendChild(multiLanguageSelectorElement);


                    sampleCollection.forEach(function (sampleEl) {
                        var optionEl = document.createElement("code");
                        var sampleLanguage = sampleEl.getAttribute("data-lang");
                        optionEl.setAttribute("data-lang", sampleLanguage);
                        optionEl.setAttribute("role", "button");
                        optionEl.classList.add("language-option");

                        optionEl.innerText = capitalizeFirstLetter(sampleLanguage);

                        optionEl.addEventListener("click", function updatePreferredLanguage(evt) {
                            var preferredLanguageId = optionEl.getAttribute("data-lang");
                            window.localStorage.setItem("preferred-gradle-dsl", preferredLanguageId);

                            // Record how far down the page the clicked element is before switching all samples
                            var beforeOffset = evt.target.offsetTop;

                            switchSampleLanguage(preferredLanguageId);

                            // Scroll the window to account for content height differences between different sample languages
                            window.scrollBy(0, evt.target.offsetTop - beforeOffset);
                        });
                        multiLanguageSelectorElement.appendChild(optionEl);
                    });
                    sampleCollection[0].parentNode.insertBefore(languageSelectorFragment, sampleCollection[0]);
                }
            });

            [].slice.call(document.querySelectorAll(".multi-language-selector .language-option")).forEach(function (optionEl) {
                if (optionEl.getAttribute("data-lang") === languageId) {
                    optionEl.classList.add("selected");
                } else {
                    optionEl.classList.remove("selected");
                }
            });

            [].slice.call(document.querySelectorAll(".multi-language-text")).forEach(function (el) {
                if (!el.classList.contains("lang-" + languageId)) {
                    el.classList.add("hidden");
                } else {
                    el.classList.remove("hidden");
                }
            });
        }

        switchSampleLanguage(preferredBuildScriptLanguage);
    }

    document.addEventListener("DOMContentLoaded", postProcessCodeBlocks);
</script>

</body>
</html>